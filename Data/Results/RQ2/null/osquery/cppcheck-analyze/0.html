
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cppcheck - HTML report - [project name]</title>
    <link rel="stylesheet" href="style.css">
    <style>
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #ffffff; }
.highlight .c { color: #888888 } /* Comment */
.highlight .err { color: #FF0000; background-color: #FFAAAA } /* Error */
.highlight .k { color: #008800; font-weight: bold } /* Keyword */
.highlight .o { color: #333333 } /* Operator */
.highlight .ch { color: #888888 } /* Comment.Hashbang */
.highlight .cm { color: #888888 } /* Comment.Multiline */
.highlight .cp { color: #557799 } /* Comment.Preproc */
.highlight .cpf { color: #888888 } /* Comment.PreprocFile */
.highlight .c1 { color: #888888 } /* Comment.Single */
.highlight .cs { color: #cc0000; font-weight: bold } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #003388; font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #333399; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #6600EE; font-weight: bold } /* Literal.Number */
.highlight .s { background-color: #fff0f0 } /* Literal.String */
.highlight .na { color: #0000CC } /* Name.Attribute */
.highlight .nb { color: #007020 } /* Name.Builtin */
.highlight .nc { color: #BB0066; font-weight: bold } /* Name.Class */
.highlight .no { color: #003366; font-weight: bold } /* Name.Constant */
.highlight .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.highlight .ni { color: #880000; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #FF0000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0066BB; font-weight: bold } /* Name.Function */
.highlight .nl { color: #997700; font-weight: bold } /* Name.Label */
.highlight .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #007700 } /* Name.Tag */
.highlight .nv { color: #996633 } /* Name.Variable */
.highlight .ow { color: #000000; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #6600EE; font-weight: bold } /* Literal.Number.Bin */
.highlight .mf { color: #6600EE; font-weight: bold } /* Literal.Number.Float */
.highlight .mh { color: #005588; font-weight: bold } /* Literal.Number.Hex */
.highlight .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.highlight .mo { color: #4400EE; font-weight: bold } /* Literal.Number.Oct */
.highlight .sa { background-color: #fff0f0 } /* Literal.String.Affix */
.highlight .sb { background-color: #fff0f0 } /* Literal.String.Backtick */
.highlight .sc { color: #0044DD } /* Literal.String.Char */
.highlight .dl { background-color: #fff0f0 } /* Literal.String.Delimiter */
.highlight .sd { color: #DD4422 } /* Literal.String.Doc */
.highlight .s2 { background-color: #fff0f0 } /* Literal.String.Double */
.highlight .se { color: #666666; font-weight: bold; background-color: #fff0f0 } /* Literal.String.Escape */
.highlight .sh { background-color: #fff0f0 } /* Literal.String.Heredoc */
.highlight .si { background-color: #eeeeee } /* Literal.String.Interpol */
.highlight .sx { color: #DD2200; background-color: #fff0f0 } /* Literal.String.Other */
.highlight .sr { color: #000000; background-color: #fff0ff } /* Literal.String.Regex */
.highlight .s1 { background-color: #fff0f0 } /* Literal.String.Single */
.highlight .ss { color: #AA6600 } /* Literal.String.Symbol */
.highlight .bp { color: #007020 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0066BB; font-weight: bold } /* Name.Function.Magic */
.highlight .vc { color: #336699 } /* Name.Variable.Class */
.highlight .vg { color: #dd7700; font-weight: bold } /* Name.Variable.Global */
.highlight .vi { color: #3333BB } /* Name.Variable.Instance */
.highlight .vm { color: #996633 } /* Name.Variable.Magic */
.highlight .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */
    </style>
    <script language="javascript">
      function getStyle(el,styleProp) {
        if (el.currentStyle)
          var y = el.currentStyle[styleProp];
        else if (window.getComputedStyle)
          var y = document.defaultView.getComputedStyle(el,null).getPropertyValue(styleProp);
        return y;
      }
      function toggle() {
        var el = this.expandable_content;
        var mark = this.expandable_marker;
        if (el.style.display == "block") {
          el.style.display = "none";
          mark.innerHTML = "[+]";
        } else {
          el.style.display = "block";
          mark.innerHTML = "[-]";
        }
      }
      function init_expandables() {
        var elts = document.getElementsByClassName("expandable");
        for (var i = 0; i < elts.length; i++) {
          var el = elts[i];
          var clickable = el.getElementsByTagName("span")[0];
          var marker = clickable.getElementsByClassName("marker")[0];
          var content = el.getElementsByClassName("content")[0];
          var width = clickable.clientWidth - parseInt(getStyle(content, "padding-left")) - parseInt(getStyle(content, "padding-right"));
          content.style.width = width + "px";
          clickable.expandable_content = content;
          clickable.expandable_marker = marker;
          clickable.onclick = toggle;
        }
      }
      function set_class_display(c, st) {
        var elements = document.querySelectorAll('.' + c),
            len = elements.length;
        for (i = 0; i < len; i++) {
            elements[i].style.display = st;
        }
      }
      function toggle_class_visibility(id) {
        var box = document.getElementById(id);
        set_class_display(id, box.checked ? '' : 'none');
      }
      function toggle_all(){
        var elts = document.getElementsByTagName("input");
        for (var i = 1; i < elts.length; i++) {           
          var el = elts[i];
          el.checked ? el.checked=false : el.checked=true;
          toggle_class_visibility(el.id);        
        }            
      }

    </script>
  </head>
  <body onload="init_expandables()">
      <div id="header">
        <h1>Cppcheck report - [project name]: /home/zhh/inject/null/osquery/libraries/cmake/source/glog/generated/linux/public/glog/logging.h </h1>
      </div>
      <div id="menu" dir="rtl">
       <p id="filename"><a href="index.html">Defects:</a> logging.h</p>
<a href='0.html#line-645'> syntaxError 645</a>
      </div>
      <div id="content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
  11
  12
  13
  14
  15
  16
  17
  18
  19
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
  31
  32
  33
  34
  35
  36
  37
  38
  39
  40
  41
  42
  43
  44
  45
  46
  47
  48
  49
  50
  51
  52
  53
  54
  55
  56
  57
  58
  59
  60
  61
  62
  63
  64
  65
  66
  67
  68
  69
  70
  71
  72
  73
  74
  75
  76
  77
  78
  79
  80
  81
  82
  83
  84
  85
  86
  87
  88
  89
  90
  91
  92
  93
  94
  95
  96
  97
  98
  99
 100
 101
 102
 103
 104
 105
 106
 107
 108
 109
 110
 111
 112
 113
 114
 115
 116
 117
 118
 119
 120
 121
 122
 123
 124
 125
 126
 127
 128
 129
 130
 131
 132
 133
 134
 135
 136
 137
 138
 139
 140
 141
 142
 143
 144
 145
 146
 147
 148
 149
 150
 151
 152
 153
 154
 155
 156
 157
 158
 159
 160
 161
 162
 163
 164
 165
 166
 167
 168
 169
 170
 171
 172
 173
 174
 175
 176
 177
 178
 179
 180
 181
 182
 183
 184
 185
 186
 187
 188
 189
 190
 191
 192
 193
 194
 195
 196
 197
 198
 199
 200
 201
 202
 203
 204
 205
 206
 207
 208
 209
 210
 211
 212
 213
 214
 215
 216
 217
 218
 219
 220
 221
 222
 223
 224
 225
 226
 227
 228
 229
 230
 231
 232
 233
 234
 235
 236
 237
 238
 239
 240
 241
 242
 243
 244
 245
 246
 247
 248
 249
 250
 251
 252
 253
 254
 255
 256
 257
 258
 259
 260
 261
 262
 263
 264
 265
 266
 267
 268
 269
 270
 271
 272
 273
 274
 275
 276
 277
 278
 279
 280
 281
 282
 283
 284
 285
 286
 287
 288
 289
 290
 291
 292
 293
 294
 295
 296
 297
 298
 299
 300
 301
 302
 303
 304
 305
 306
 307
 308
 309
 310
 311
 312
 313
 314
 315
 316
 317
 318
 319
 320
 321
 322
 323
 324
 325
 326
 327
 328
 329
 330
 331
 332
 333
 334
 335
 336
 337
 338
 339
 340
 341
 342
 343
 344
 345
 346
 347
 348
 349
 350
 351
 352
 353
 354
 355
 356
 357
 358
 359
 360
 361
 362
 363
 364
 365
 366
 367
 368
 369
 370
 371
 372
 373
 374
 375
 376
 377
 378
 379
 380
 381
 382
 383
 384
 385
 386
 387
 388
 389
 390
 391
 392
 393
 394
 395
 396
 397
 398
 399
 400
 401
 402
 403
 404
 405
 406
 407
 408
 409
 410
 411
 412
 413
 414
 415
 416
 417
 418
 419
 420
 421
 422
 423
 424
 425
 426
 427
 428
 429
 430
 431
 432
 433
 434
 435
 436
 437
 438
 439
 440
 441
 442
 443
 444
 445
 446
 447
 448
 449
 450
 451
 452
 453
 454
 455
 456
 457
 458
 459
 460
 461
 462
 463
 464
 465
 466
 467
 468
 469
 470
 471
 472
 473
 474
 475
 476
 477
 478
 479
 480
 481
 482
 483
 484
 485
 486
 487
 488
 489
 490
 491
 492
 493
 494
 495
 496
 497
 498
 499
 500
 501
 502
 503
 504
 505
 506
 507
 508
 509
 510
 511
 512
 513
 514
 515
 516
 517
 518
 519
 520
 521
 522
 523
 524
 525
 526
 527
 528
 529
 530
 531
 532
 533
 534
 535
 536
 537
 538
 539
 540
 541
 542
 543
 544
 545
 546
 547
 548
 549
 550
 551
 552
 553
 554
 555
 556
 557
 558
 559
 560
 561
 562
 563
 564
 565
 566
 567
 568
 569
 570
 571
 572
 573
 574
 575
 576
 577
 578
 579
 580
 581
 582
 583
 584
 585
 586
 587
 588
 589
 590
 591
 592
 593
 594
 595
 596
 597
 598
 599
 600
 601
 602
 603
 604
 605
 606
 607
 608
 609
 610
 611
 612
 613
 614
 615
 616
 617
 618
 619
 620
 621
 622
 623
 624
 625
 626
 627
 628
 629
 630
 631
 632
 633
 634
 635
 636
 637
 638
 639
 640
 641
 642
 643
 644
 645
 646
 647
 648
 649
 650
 651
 652
 653
 654
 655
 656
 657
 658
 659
 660
 661
 662
 663
 664
 665
 666
 667
 668
 669
 670
 671
 672
 673
 674
 675
 676
 677
 678
 679
 680
 681
 682
 683
 684
 685
 686
 687
 688
 689
 690
 691
 692
 693
 694
 695
 696
 697
 698
 699
 700
 701
 702
 703
 704
 705
 706
 707
 708
 709
 710
 711
 712
 713
 714
 715
 716
 717
 718
 719
 720
 721
 722
 723
 724
 725
 726
 727
 728
 729
 730
 731
 732
 733
 734
 735
 736
 737
 738
 739
 740
 741
 742
 743
 744
 745
 746
 747
 748
 749
 750
 751
 752
 753
 754
 755
 756
 757
 758
 759
 760
 761
 762
 763
 764
 765
 766
 767
 768
 769
 770
 771
 772
 773
 774
 775
 776
 777
 778
 779
 780
 781
 782
 783
 784
 785
 786
 787
 788
 789
 790
 791
 792
 793
 794
 795
 796
 797
 798
 799
 800
 801
 802
 803
 804
 805
 806
 807
 808
 809
 810
 811
 812
 813
 814
 815
 816
 817
 818
 819
 820
 821
 822
 823
 824
 825
 826
 827
 828
 829
 830
 831
 832
 833
 834
 835
 836
 837
 838
 839
 840
 841
 842
 843
 844
 845
 846
 847
 848
 849
 850
 851
 852
 853
 854
 855
 856
 857
 858
 859
 860
 861
 862
 863
 864
 865
 866
 867
 868
 869
 870
 871
 872
 873
 874
 875
 876
 877
 878
 879
 880
 881
 882
 883
 884
 885
 886
 887
 888
 889
 890
 891
 892
 893
 894
 895
 896
 897
 898
 899
 900
 901
 902
 903
 904
 905
 906
 907
 908
 909
 910
 911
 912
 913
 914
 915
 916
 917
 918
 919
 920
 921
 922
 923
 924
 925
 926
 927
 928
 929
 930
 931
 932
 933
 934
 935
 936
 937
 938
 939
 940
 941
 942
 943
 944
 945
 946
 947
 948
 949
 950
 951
 952
 953
 954
 955
 956
 957
 958
 959
 960
 961
 962
 963
 964
 965
 966
 967
 968
 969
 970
 971
 972
 973
 974
 975
 976
 977
 978
 979
 980
 981
 982
 983
 984
 985
 986
 987
 988
 989
 990
 991
 992
 993
 994
 995
 996
 997
 998
 999
1000
1001
1002
1003
1004
1005
1006
1007
1008
1009
1010
1011
1012
1013
1014
1015
1016
1017
1018
1019
1020
1021
1022
1023
1024
1025
1026
1027
1028
1029
1030
1031
1032
1033
1034
1035
1036
1037
1038
1039
1040
1041
1042
1043
1044
1045
1046
1047
1048
1049
1050
1051
1052
1053
1054
1055
1056
1057
1058
1059
1060
1061
1062
1063
1064
1065
1066
1067
1068
1069
1070
1071
1072
1073
1074
1075
1076
1077
1078
1079
1080
1081
1082
1083
1084
1085
1086
1087
1088
1089
1090
1091
1092
1093
1094
1095
1096
1097
1098
1099
1100
1101
1102
1103
1104
1105
1106
1107
1108
1109
1110
1111
1112
1113
1114
1115
1116
1117
1118
1119
1120
1121
1122
1123
1124
1125
1126
1127
1128
1129
1130
1131
1132
1133
1134
1135
1136
1137
1138
1139
1140
1141
1142
1143
1144
1145
1146
1147
1148
1149
1150
1151
1152
1153
1154
1155
1156
1157
1158
1159
1160
1161
1162
1163
1164
1165
1166
1167
1168
1169
1170
1171
1172
1173
1174
1175
1176
1177
1178
1179
1180
1181
1182
1183
1184
1185
1186
1187
1188
1189
1190
1191
1192
1193
1194
1195
1196
1197
1198
1199
1200
1201
1202
1203
1204
1205
1206
1207
1208
1209
1210
1211
1212
1213
1214
1215
1216
1217
1218
1219
1220
1221
1222
1223
1224
1225
1226
1227
1228
1229
1230
1231
1232
1233
1234
1235
1236
1237
1238
1239
1240
1241
1242
1243
1244
1245
1246
1247
1248
1249
1250
1251
1252
1253
1254
1255
1256
1257
1258
1259
1260
1261
1262
1263
1264
1265
1266
1267
1268
1269
1270
1271
1272
1273
1274
1275
1276
1277
1278
1279
1280
1281
1282
1283
1284
1285
1286
1287
1288
1289
1290
1291
1292
1293
1294
1295
1296
1297
1298
1299
1300
1301
1302
1303
1304
1305
1306
1307
1308
1309
1310
1311
1312
1313
1314
1315
1316
1317
1318
1319
1320
1321
1322
1323
1324
1325
1326
1327
1328
1329
1330
1331
1332
1333
1334
1335
1336
1337
1338
1339
1340
1341
1342
1343
1344
1345
1346
1347
1348
1349
1350
1351
1352
1353
1354
1355
1356
1357
1358
1359
1360
1361
1362
1363
1364
1365
1366
1367
1368
1369
1370
1371
1372
1373
1374
1375
1376
1377
1378
1379
1380
1381
1382
1383
1384
1385
1386
1387
1388
1389
1390
1391
1392
1393
1394
1395
1396
1397
1398
1399
1400
1401
1402
1403
1404
1405
1406
1407
1408
1409
1410
1411
1412
1413
1414
1415
1416
1417
1418
1419
1420
1421
1422
1423
1424
1425
1426
1427
1428
1429
1430
1431
1432
1433
1434
1435
1436
1437
1438
1439
1440
1441
1442
1443
1444
1445
1446
1447
1448
1449
1450
1451
1452
1453
1454
1455
1456
1457
1458
1459
1460
1461
1462
1463
1464
1465
1466
1467
1468
1469
1470
1471
1472
1473
1474
1475
1476
1477
1478
1479
1480
1481
1482
1483
1484
1485
1486
1487
1488
1489
1490
1491
1492
1493
1494
1495
1496
1497
1498
1499
1500
1501
1502
1503
1504
1505
1506
1507
1508
1509
1510
1511
1512
1513
1514
1515
1516
1517
1518
1519
1520
1521
1522
1523
1524
1525
1526
1527
1528
1529
1530
1531
1532
1533
1534
1535
1536
1537
1538
1539
1540
1541
1542
1543
1544
1545
1546
1547
1548
1549
1550
1551
1552
1553
1554
1555
1556
1557
1558
1559
1560
1561
1562
1563
1564
1565
1566
1567
1568
1569
1570
1571
1572
1573
1574
1575
1576
1577
1578
1579
1580
1581
1582
1583
1584
1585
1586
1587
1588
1589
1590
1591
1592
1593
1594
1595
1596
1597
1598
1599
1600
1601
1602
1603
1604
1605
1606
1607
1608
1609
1610
1611
1612
1613
1614
1615
1616
1617
1618
1619
1620
1621
1622
1623
1624
1625
1626
1627
1628
1629
1630
1631
1632
1633
1634
1635
1636
1637
1638
1639
1640
1641
1642
1643
1644
1645
1646
1647
1648
1649
1650
1651
1652
1653
1654
1655
1656
1657
1658
1659
1660
1661
1662</pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="line-1"></a><span class="c1">// Copyright (c) 1999, Google Inc.</span>
<a name="line-2"></a><span class="c1">// All rights reserved.</span>
<a name="line-3"></a><span class="c1">//</span>
<a name="line-4"></a><span class="c1">// Redistribution and use in source and binary forms, with or without</span>
<a name="line-5"></a><span class="c1">// modification, are permitted provided that the following conditions are</span>
<a name="line-6"></a><span class="c1">// met:</span>
<a name="line-7"></a><span class="c1">//</span>
<a name="line-8"></a><span class="c1">//     * Redistributions of source code must retain the above copyright</span>
<a name="line-9"></a><span class="c1">// notice, this list of conditions and the following disclaimer.</span>
<a name="line-10"></a><span class="c1">//     * Redistributions in binary form must reproduce the above</span>
<a name="line-11"></a><span class="c1">// copyright notice, this list of conditions and the following disclaimer</span>
<a name="line-12"></a><span class="c1">// in the documentation and/or other materials provided with the</span>
<a name="line-13"></a><span class="c1">// distribution.</span>
<a name="line-14"></a><span class="c1">//     * Neither the name of Google Inc. nor the names of its</span>
<a name="line-15"></a><span class="c1">// contributors may be used to endorse or promote products derived from</span>
<a name="line-16"></a><span class="c1">// this software without specific prior written permission.</span>
<a name="line-17"></a><span class="c1">//</span>
<a name="line-18"></a><span class="c1">// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="line-19"></a><span class="c1">// &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="line-20"></a><span class="c1">// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="line-21"></a><span class="c1">// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="line-22"></a><span class="c1">// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="line-23"></a><span class="c1">// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="line-24"></a><span class="c1">// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="line-25"></a><span class="c1">// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="line-26"></a><span class="c1">// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="line-27"></a><span class="c1">// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="line-28"></a><span class="c1">// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="line-29"></a><span class="c1">//</span>
<a name="line-30"></a><span class="c1">// Author: Ray Sidney</span>
<a name="line-31"></a><span class="c1">//</span>
<a name="line-32"></a><span class="c1">// This file contains #include information about logging-related stuff.</span>
<a name="line-33"></a><span class="c1">// Pretty much everybody needs to #include this file so that they can</span>
<a name="line-34"></a><span class="c1">// log various happenings.</span>
<a name="line-35"></a><span class="c1">//</span>
<a name="line-36"></a><span class="cp">#ifndef _LOGGING_H_</span>
<a name="line-37"></a><span class="cp">#define _LOGGING_H_</span>
<a name="line-38"></a>
<a name="line-39"></a><span class="cp">#include</span> <span class="cpf">&lt;errno.h&gt;</span><span class="cp"></span>
<a name="line-40"></a><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<a name="line-41"></a><span class="cp">#include</span> <span class="cpf">&lt;time.h&gt;</span><span class="cp"></span>
<a name="line-42"></a><span class="cp">#include</span> <span class="cpf">&lt;iosfwd&gt;</span><span class="cp"></span>
<a name="line-43"></a><span class="cp">#include</span> <span class="cpf">&lt;ostream&gt;</span><span class="cp"></span>
<a name="line-44"></a><span class="cp">#include</span> <span class="cpf">&lt;sstream&gt;</span><span class="cp"></span>
<a name="line-45"></a><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>
<a name="line-46"></a><span class="cp">#if 1</span>
<a name="line-47"></a><span class="cp"># include &lt;unistd.h&gt;</span>
<a name="line-48"></a><span class="cp">#endif</span>
<a name="line-49"></a><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<a name="line-50"></a>
<a name="line-51"></a><span class="cp">#if defined(_MSC_VER)</span>
<a name="line-52"></a><span class="cp">#define GLOG_MSVC_PUSH_DISABLE_WARNING(n) __pragma(warning(push)) \</span>
<a name="line-53"></a><span class="cp">                                     __pragma(warning(disable:n))</span>
<a name="line-54"></a><span class="cp">#define GLOG_MSVC_POP_WARNING() __pragma(warning(pop))</span>
<a name="line-55"></a><span class="cp">#else</span>
<a name="line-56"></a><span class="cp">#define GLOG_MSVC_PUSH_DISABLE_WARNING(n)</span>
<a name="line-57"></a><span class="cp">#define GLOG_MSVC_POP_WARNING()</span>
<a name="line-58"></a><span class="cp">#endif</span>
<a name="line-59"></a>
<a name="line-60"></a><span class="c1">// Annoying stuff for windows -- makes sure clients can import these functions</span>
<a name="line-61"></a><span class="cp">#ifndef GOOGLE_GLOG_DLL_DECL</span>
<a name="line-62"></a><span class="cp"># if defined(_WIN32) &amp;&amp; !defined(__CYGWIN__)</span>
<a name="line-63"></a><span class="cp">#   define GOOGLE_GLOG_DLL_DECL  __declspec(dllimport)</span>
<a name="line-64"></a><span class="cp"># else</span>
<a name="line-65"></a><span class="cp">#   define GOOGLE_GLOG_DLL_DECL</span>
<a name="line-66"></a><span class="cp"># endif</span>
<a name="line-67"></a><span class="cp">#endif</span>
<a name="line-68"></a>
<a name="line-69"></a><span class="c1">// We care a lot about number of bits things take up.  Unfortunately,</span>
<a name="line-70"></a><span class="c1">// systems define their bit-specific ints in a lot of different ways.</span>
<a name="line-71"></a><span class="c1">// We use our own way, and have a typedef to get there.</span>
<a name="line-72"></a><span class="c1">// Note: these commands below may look like &quot;#if 1&quot; or &quot;#if 0&quot;, but</span>
<a name="line-73"></a><span class="c1">// that&#39;s because they were constructed that way at ./configure time.</span>
<a name="line-74"></a><span class="c1">// Look at logging.h.in to see how they&#39;re calculated (based on your config).</span>
<a name="line-75"></a><span class="cp">#if 1</span>
<a name="line-76"></a><span class="cp">#include</span> <span class="cpf">&lt;stdint.h&gt;             // the normal place uint16_t is defined</span><span class="cp"></span>
<a name="line-77"></a><span class="cp">#endif</span>
<a name="line-78"></a><span class="cp">#if 1</span>
<a name="line-79"></a><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;          // the normal place u_int16_t is defined</span><span class="cp"></span>
<a name="line-80"></a><span class="cp">#endif</span>
<a name="line-81"></a><span class="cp">#if 1</span>
<a name="line-82"></a><span class="cp">#include</span> <span class="cpf">&lt;inttypes.h&gt;           // a third place for uint16_t or u_int16_t</span><span class="cp"></span>
<a name="line-83"></a><span class="cp">#endif</span>
<a name="line-84"></a>
<a name="line-85"></a><span class="cp">#if 1</span>
<a name="line-86"></a><span class="cp">#include</span> <span class="cpf">&lt;gflags/gflags.h&gt;</span><span class="cp"></span>
<a name="line-87"></a><span class="cp">#endif</span>
<a name="line-88"></a>
<a name="line-89"></a><span class="n">namespace</span> <span class="n">google</span> <span class="p">{</span>
<a name="line-90"></a>
<a name="line-91"></a><span class="cp">#if 1      </span><span class="c1">// the C99 format</span>
<a name="line-92"></a><span class="k">typedef</span> <span class="kt">int32_t</span> <span class="n">int32</span><span class="p">;</span>
<a name="line-93"></a><span class="k">typedef</span> <span class="kt">uint32_t</span> <span class="n">uint32</span><span class="p">;</span>
<a name="line-94"></a><span class="k">typedef</span> <span class="kt">int64_t</span> <span class="n">int64</span><span class="p">;</span>
<a name="line-95"></a><span class="k">typedef</span> <span class="kt">uint64_t</span> <span class="n">uint64</span><span class="p">;</span>
<a name="line-96"></a><span class="cp">#elif 1   </span><span class="c1">// the BSD format</span>
<a name="line-97"></a><span class="k">typedef</span> <span class="kt">int32_t</span> <span class="n">int32</span><span class="p">;</span>
<a name="line-98"></a><span class="k">typedef</span> <span class="n">u_int32_t</span> <span class="n">uint32</span><span class="p">;</span>
<a name="line-99"></a><span class="k">typedef</span> <span class="kt">int64_t</span> <span class="n">int64</span><span class="p">;</span>
<a name="line-100"></a><span class="k">typedef</span> <span class="n">u_int64_t</span> <span class="n">uint64</span><span class="p">;</span>
<a name="line-101"></a><span class="cp">#elif 0    </span><span class="c1">// the windows (vc7) format</span>
<a name="line-102"></a><span class="k">typedef</span> <span class="kr">__int32</span> <span class="n">int32</span><span class="p">;</span>
<a name="line-103"></a><span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kr">__int32</span> <span class="n">uint32</span><span class="p">;</span>
<a name="line-104"></a><span class="k">typedef</span> <span class="kr">__int64</span> <span class="n">int64</span><span class="p">;</span>
<a name="line-105"></a><span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="n">uint64</span><span class="p">;</span>
<a name="line-106"></a><span class="cp">#else</span>
<a name="line-107"></a><span class="cp">#error Do not know how to define a 32-bit integer quantity on your system</span>
<a name="line-108"></a><span class="cp">#endif</span>
<a name="line-109"></a>
<a name="line-110"></a><span class="p">}</span>
<a name="line-111"></a>
<a name="line-112"></a><span class="c1">// The global value of GOOGLE_STRIP_LOG. All the messages logged to</span>
<a name="line-113"></a><span class="c1">// LOG(XXX) with severity less than GOOGLE_STRIP_LOG will not be displayed.</span>
<a name="line-114"></a><span class="c1">// If it can be determined at compile time that the message will not be</span>
<a name="line-115"></a><span class="c1">// printed, the statement will be compiled out.</span>
<a name="line-116"></a><span class="c1">//</span>
<a name="line-117"></a><span class="c1">// Example: to strip out all INFO and WARNING messages, use the value</span>
<a name="line-118"></a><span class="c1">// of 2 below. To make an exception for WARNING messages from a single</span>
<a name="line-119"></a><span class="c1">// file, add &quot;#define GOOGLE_STRIP_LOG 1&quot; to that file _before_ including</span>
<a name="line-120"></a><span class="c1">// base/logging.h</span>
<a name="line-121"></a><span class="cp">#ifndef GOOGLE_STRIP_LOG</span>
<a name="line-122"></a><span class="cp">#define GOOGLE_STRIP_LOG 0</span>
<a name="line-123"></a><span class="cp">#endif</span>
<a name="line-124"></a>
<a name="line-125"></a><span class="c1">// GCC can be told that a certain branch is not likely to be taken (for</span>
<a name="line-126"></a><span class="c1">// instance, a CHECK failure), and use that information in static analysis.</span>
<a name="line-127"></a><span class="c1">// Giving it this information can help it optimize for the common case in</span>
<a name="line-128"></a><span class="c1">// the absence of better information (ie. -fprofile-arcs).</span>
<a name="line-129"></a><span class="c1">//</span>
<a name="line-130"></a><span class="cp">#ifndef GOOGLE_PREDICT_BRANCH_NOT_TAKEN</span>
<a name="line-131"></a><span class="cp">#if 1</span>
<a name="line-132"></a><span class="cp">#define GOOGLE_PREDICT_BRANCH_NOT_TAKEN(x) (__builtin_expect(x, 0))</span>
<a name="line-133"></a><span class="cp">#else</span>
<a name="line-134"></a><span class="cp">#define GOOGLE_PREDICT_BRANCH_NOT_TAKEN(x) x</span>
<a name="line-135"></a><span class="cp">#endif</span>
<a name="line-136"></a><span class="cp">#endif</span>
<a name="line-137"></a>
<a name="line-138"></a><span class="cp">#ifndef GOOGLE_PREDICT_FALSE</span>
<a name="line-139"></a><span class="cp">#if 1</span>
<a name="line-140"></a><span class="cp">#define GOOGLE_PREDICT_FALSE(x) (__builtin_expect(x, 0))</span>
<a name="line-141"></a><span class="cp">#else</span>
<a name="line-142"></a><span class="cp">#define GOOGLE_PREDICT_FALSE(x) x</span>
<a name="line-143"></a><span class="cp">#endif</span>
<a name="line-144"></a><span class="cp">#endif</span>
<a name="line-145"></a>
<a name="line-146"></a><span class="cp">#ifndef GOOGLE_PREDICT_TRUE</span>
<a name="line-147"></a><span class="cp">#if 1</span>
<a name="line-148"></a><span class="cp">#define GOOGLE_PREDICT_TRUE(x) (__builtin_expect(!!(x), 1))</span>
<a name="line-149"></a><span class="cp">#else</span>
<a name="line-150"></a><span class="cp">#define GOOGLE_PREDICT_TRUE(x) x</span>
<a name="line-151"></a><span class="cp">#endif</span>
<a name="line-152"></a><span class="cp">#endif</span>
<a name="line-153"></a>
<a name="line-154"></a>
<a name="line-155"></a><span class="c1">// Make a bunch of macros for logging.  The way to log things is to stream</span>
<a name="line-156"></a><span class="c1">// things to LOG(&lt;a particular severity level&gt;).  E.g.,</span>
<a name="line-157"></a><span class="c1">//</span>
<a name="line-158"></a><span class="c1">//   LOG(INFO) &lt;&lt; &quot;Found &quot; &lt;&lt; num_cookies &lt;&lt; &quot; cookies&quot;;</span>
<a name="line-159"></a><span class="c1">//</span>
<a name="line-160"></a><span class="c1">// You can capture log messages in a string, rather than reporting them</span>
<a name="line-161"></a><span class="c1">// immediately:</span>
<a name="line-162"></a><span class="c1">//</span>
<a name="line-163"></a><span class="c1">//   vector&lt;string&gt; errors;</span>
<a name="line-164"></a><span class="c1">//   LOG_STRING(ERROR, &amp;errors) &lt;&lt; &quot;Couldn&#39;t parse cookie #&quot; &lt;&lt; cookie_num;</span>
<a name="line-165"></a><span class="c1">//</span>
<a name="line-166"></a><span class="c1">// This pushes back the new error onto &#39;errors&#39;; if given a NULL pointer,</span>
<a name="line-167"></a><span class="c1">// it reports the error via LOG(ERROR).</span>
<a name="line-168"></a><span class="c1">//</span>
<a name="line-169"></a><span class="c1">// You can also do conditional logging:</span>
<a name="line-170"></a><span class="c1">//</span>
<a name="line-171"></a><span class="c1">//   LOG_IF(INFO, num_cookies &gt; 10) &lt;&lt; &quot;Got lots of cookies&quot;;</span>
<a name="line-172"></a><span class="c1">//</span>
<a name="line-173"></a><span class="c1">// You can also do occasional logging (log every n&#39;th occurrence of an</span>
<a name="line-174"></a><span class="c1">// event):</span>
<a name="line-175"></a><span class="c1">//</span>
<a name="line-176"></a><span class="c1">//   LOG_EVERY_N(INFO, 10) &lt;&lt; &quot;Got the &quot; &lt;&lt; google::COUNTER &lt;&lt; &quot;th cookie&quot;;</span>
<a name="line-177"></a><span class="c1">//</span>
<a name="line-178"></a><span class="c1">// The above will cause log messages to be output on the 1st, 11th, 21st, ...</span>
<a name="line-179"></a><span class="c1">// times it is executed.  Note that the special google::COUNTER value is used</span>
<a name="line-180"></a><span class="c1">// to identify which repetition is happening.</span>
<a name="line-181"></a><span class="c1">//</span>
<a name="line-182"></a><span class="c1">// You can also do occasional conditional logging (log every n&#39;th</span>
<a name="line-183"></a><span class="c1">// occurrence of an event, when condition is satisfied):</span>
<a name="line-184"></a><span class="c1">//</span>
<a name="line-185"></a><span class="c1">//   LOG_IF_EVERY_N(INFO, (size &gt; 1024), 10) &lt;&lt; &quot;Got the &quot; &lt;&lt; google::COUNTER</span>
<a name="line-186"></a><span class="c1">//                                           &lt;&lt; &quot;th big cookie&quot;;</span>
<a name="line-187"></a><span class="c1">//</span>
<a name="line-188"></a><span class="c1">// You can log messages the first N times your code executes a line. E.g.</span>
<a name="line-189"></a><span class="c1">//</span>
<a name="line-190"></a><span class="c1">//   LOG_FIRST_N(INFO, 20) &lt;&lt; &quot;Got the &quot; &lt;&lt; google::COUNTER &lt;&lt; &quot;th cookie&quot;;</span>
<a name="line-191"></a><span class="c1">//</span>
<a name="line-192"></a><span class="c1">// Outputs log messages for the first 20 times it is executed.</span>
<a name="line-193"></a><span class="c1">//</span>
<a name="line-194"></a><span class="c1">// Analogous SYSLOG, SYSLOG_IF, and SYSLOG_EVERY_N macros are available.</span>
<a name="line-195"></a><span class="c1">// These log to syslog as well as to the normal logs.  If you use these at</span>
<a name="line-196"></a><span class="c1">// all, you need to be aware that syslog can drastically reduce performance,</span>
<a name="line-197"></a><span class="c1">// especially if it is configured for remote logging!  Don&#39;t use these</span>
<a name="line-198"></a><span class="c1">// unless you fully understand this and have a concrete need to use them.</span>
<a name="line-199"></a><span class="c1">// Even then, try to minimize your use of them.</span>
<a name="line-200"></a><span class="c1">//</span>
<a name="line-201"></a><span class="c1">// There are also &quot;debug mode&quot; logging macros like the ones above:</span>
<a name="line-202"></a><span class="c1">//</span>
<a name="line-203"></a><span class="c1">//   DLOG(INFO) &lt;&lt; &quot;Found cookies&quot;;</span>
<a name="line-204"></a><span class="c1">//</span>
<a name="line-205"></a><span class="c1">//   DLOG_IF(INFO, num_cookies &gt; 10) &lt;&lt; &quot;Got lots of cookies&quot;;</span>
<a name="line-206"></a><span class="c1">//</span>
<a name="line-207"></a><span class="c1">//   DLOG_EVERY_N(INFO, 10) &lt;&lt; &quot;Got the &quot; &lt;&lt; google::COUNTER &lt;&lt; &quot;th cookie&quot;;</span>
<a name="line-208"></a><span class="c1">//</span>
<a name="line-209"></a><span class="c1">// All &quot;debug mode&quot; logging is compiled away to nothing for non-debug mode</span>
<a name="line-210"></a><span class="c1">// compiles.</span>
<a name="line-211"></a><span class="c1">//</span>
<a name="line-212"></a><span class="c1">// We also have</span>
<a name="line-213"></a><span class="c1">//</span>
<a name="line-214"></a><span class="c1">//   LOG_ASSERT(assertion);</span>
<a name="line-215"></a><span class="c1">//   DLOG_ASSERT(assertion);</span>
<a name="line-216"></a><span class="c1">//</span>
<a name="line-217"></a><span class="c1">// which is syntactic sugar for {,D}LOG_IF(FATAL, assert fails) &lt;&lt; assertion;</span>
<a name="line-218"></a><span class="c1">//</span>
<a name="line-219"></a><span class="c1">// There are &quot;verbose level&quot; logging macros.  They look like</span>
<a name="line-220"></a><span class="c1">//</span>
<a name="line-221"></a><span class="c1">//   VLOG(1) &lt;&lt; &quot;I&#39;m printed when you run the program with --v=1 or more&quot;;</span>
<a name="line-222"></a><span class="c1">//   VLOG(2) &lt;&lt; &quot;I&#39;m printed when you run the program with --v=2 or more&quot;;</span>
<a name="line-223"></a><span class="c1">//</span>
<a name="line-224"></a><span class="c1">// These always log at the INFO log level (when they log at all).</span>
<a name="line-225"></a><span class="c1">// The verbose logging can also be turned on module-by-module.  For instance,</span>
<a name="line-226"></a><span class="c1">//    --vmodule=mapreduce=2,file=1,gfs*=3 --v=0</span>
<a name="line-227"></a><span class="c1">// will cause:</span>
<a name="line-228"></a><span class="c1">//   a. VLOG(2) and lower messages to be printed from mapreduce.{h,cc}</span>
<a name="line-229"></a><span class="c1">//   b. VLOG(1) and lower messages to be printed from file.{h,cc}</span>
<a name="line-230"></a><span class="c1">//   c. VLOG(3) and lower messages to be printed from files prefixed with &quot;gfs&quot;</span>
<a name="line-231"></a><span class="c1">//   d. VLOG(0) and lower messages to be printed from elsewhere</span>
<a name="line-232"></a><span class="c1">//</span>
<a name="line-233"></a><span class="c1">// The wildcarding functionality shown by (c) supports both &#39;*&#39; (match</span>
<a name="line-234"></a><span class="c1">// 0 or more characters) and &#39;?&#39; (match any single character) wildcards.</span>
<a name="line-235"></a><span class="c1">//</span>
<a name="line-236"></a><span class="c1">// There&#39;s also VLOG_IS_ON(n) &quot;verbose level&quot; condition macro. To be used as</span>
<a name="line-237"></a><span class="c1">//</span>
<a name="line-238"></a><span class="c1">//   if (VLOG_IS_ON(2)) {</span>
<a name="line-239"></a><span class="c1">//     // do some logging preparation and logging</span>
<a name="line-240"></a><span class="c1">//     // that can&#39;t be accomplished with just VLOG(2) &lt;&lt; ...;</span>
<a name="line-241"></a><span class="c1">//   }</span>
<a name="line-242"></a><span class="c1">//</span>
<a name="line-243"></a><span class="c1">// There are also VLOG_IF, VLOG_EVERY_N and VLOG_IF_EVERY_N &quot;verbose level&quot;</span>
<a name="line-244"></a><span class="c1">// condition macros for sample cases, when some extra computation and</span>
<a name="line-245"></a><span class="c1">// preparation for logs is not needed.</span>
<a name="line-246"></a><span class="c1">//   VLOG_IF(1, (size &gt; 1024))</span>
<a name="line-247"></a><span class="c1">//      &lt;&lt; &quot;I&#39;m printed when size is more than 1024 and when you run the &quot;</span>
<a name="line-248"></a><span class="c1">//         &quot;program with --v=1 or more&quot;;</span>
<a name="line-249"></a><span class="c1">//   VLOG_EVERY_N(1, 10)</span>
<a name="line-250"></a><span class="c1">//      &lt;&lt; &quot;I&#39;m printed every 10th occurrence, and when you run the program &quot;</span>
<a name="line-251"></a><span class="c1">//         &quot;with --v=1 or more. Present occurence is &quot; &lt;&lt; google::COUNTER;</span>
<a name="line-252"></a><span class="c1">//   VLOG_IF_EVERY_N(1, (size &gt; 1024), 10)</span>
<a name="line-253"></a><span class="c1">//      &lt;&lt; &quot;I&#39;m printed on every 10th occurence of case when size is more &quot;</span>
<a name="line-254"></a><span class="c1">//         &quot; than 1024, when you run the program with --v=1 or more. &quot;;</span>
<a name="line-255"></a><span class="c1">//         &quot;Present occurence is &quot; &lt;&lt; google::COUNTER;</span>
<a name="line-256"></a><span class="c1">//</span>
<a name="line-257"></a><span class="c1">// The supported severity levels for macros that allow you to specify one</span>
<a name="line-258"></a><span class="c1">// are (in increasing order of severity) INFO, WARNING, ERROR, and FATAL.</span>
<a name="line-259"></a><span class="c1">// Note that messages of a given severity are logged not only in the</span>
<a name="line-260"></a><span class="c1">// logfile for that severity, but also in all logfiles of lower severity.</span>
<a name="line-261"></a><span class="c1">// E.g., a message of severity FATAL will be logged to the logfiles of</span>
<a name="line-262"></a><span class="c1">// severity FATAL, ERROR, WARNING, and INFO.</span>
<a name="line-263"></a><span class="c1">//</span>
<a name="line-264"></a><span class="c1">// There is also the special severity of DFATAL, which logs FATAL in</span>
<a name="line-265"></a><span class="c1">// debug mode, ERROR in normal mode.</span>
<a name="line-266"></a><span class="c1">//</span>
<a name="line-267"></a><span class="c1">// Very important: logging a message at the FATAL severity level causes</span>
<a name="line-268"></a><span class="c1">// the program to terminate (after the message is logged).</span>
<a name="line-269"></a><span class="c1">//</span>
<a name="line-270"></a><span class="c1">// Unless otherwise specified, logs will be written to the filename</span>
<a name="line-271"></a><span class="c1">// &quot;&lt;program name&gt;.&lt;hostname&gt;.&lt;user name&gt;.log.&lt;severity level&gt;.&quot;, followed</span>
<a name="line-272"></a><span class="c1">// by the date, time, and pid (you can&#39;t prevent the date, time, and pid</span>
<a name="line-273"></a><span class="c1">// from being in the filename).</span>
<a name="line-274"></a><span class="c1">//</span>
<a name="line-275"></a><span class="c1">// The logging code takes two flags:</span>
<a name="line-276"></a><span class="c1">//     --v=#           set the verbose level</span>
<a name="line-277"></a><span class="c1">//     --logtostderr   log all the messages to stderr instead of to logfiles</span>
<a name="line-278"></a>
<a name="line-279"></a><span class="c1">// LOG LINE PREFIX FORMAT</span>
<a name="line-280"></a><span class="c1">//</span>
<a name="line-281"></a><span class="c1">// Log lines have this form:</span>
<a name="line-282"></a><span class="c1">//</span>
<a name="line-283"></a><span class="c1">//     Lmmdd hh:mm:ss.uuuuuu threadid file:line] msg...</span>
<a name="line-284"></a><span class="c1">//</span>
<a name="line-285"></a><span class="c1">// where the fields are defined as follows:</span>
<a name="line-286"></a><span class="c1">//</span>
<a name="line-287"></a><span class="c1">//   L                A single character, representing the log level</span>
<a name="line-288"></a><span class="c1">//                    (eg &#39;I&#39; for INFO)</span>
<a name="line-289"></a><span class="c1">//   mm               The month (zero padded; ie May is &#39;05&#39;)</span>
<a name="line-290"></a><span class="c1">//   dd               The day (zero padded)</span>
<a name="line-291"></a><span class="c1">//   hh:mm:ss.uuuuuu  Time in hours, minutes and fractional seconds</span>
<a name="line-292"></a><span class="c1">//   threadid         The space-padded thread ID as returned by GetTID()</span>
<a name="line-293"></a><span class="c1">//                    (this matches the PID on Linux)</span>
<a name="line-294"></a><span class="c1">//   file             The file name</span>
<a name="line-295"></a><span class="c1">//   line             The line number</span>
<a name="line-296"></a><span class="c1">//   msg              The user-supplied message</span>
<a name="line-297"></a><span class="c1">//</span>
<a name="line-298"></a><span class="c1">// Example:</span>
<a name="line-299"></a><span class="c1">//</span>
<a name="line-300"></a><span class="c1">//   I1103 11:57:31.739339 24395 google.cc:2341] Command line: ./some_prog</span>
<a name="line-301"></a><span class="c1">//   I1103 11:57:31.739403 24395 google.cc:2342] Process id 24395</span>
<a name="line-302"></a><span class="c1">//</span>
<a name="line-303"></a><span class="c1">// NOTE: although the microseconds are useful for comparing events on</span>
<a name="line-304"></a><span class="c1">// a single machine, clocks on different machines may not be well</span>
<a name="line-305"></a><span class="c1">// synchronized.  Hence, use caution when comparing the low bits of</span>
<a name="line-306"></a><span class="c1">// timestamps from different machines.</span>
<a name="line-307"></a>
<a name="line-308"></a><span class="cp">#ifndef DECLARE_VARIABLE</span>
<a name="line-309"></a><span class="cp">#define MUST_UNDEF_GFLAGS_DECLARE_MACROS</span>
<a name="line-310"></a><span class="cp">#define DECLARE_VARIABLE(type, shorttype, name, tn)                     \</span>
<a name="line-311"></a><span class="cp">  namespace fL##shorttype {                                             \</span>
<a name="line-312"></a><span class="cp">    extern GOOGLE_GLOG_DLL_DECL type FLAGS_##name;                      \</span>
<a name="line-313"></a><span class="cp">  }                                                                     \</span>
<a name="line-314"></a><span class="cp">  using fL##shorttype::FLAGS_##name</span>
<a name="line-315"></a>
<a name="line-316"></a><span class="c1">// bool specialization</span>
<a name="line-317"></a><span class="cp">#define DECLARE_bool(name) \</span>
<a name="line-318"></a><span class="cp">  DECLARE_VARIABLE(bool, B, name, bool)</span>
<a name="line-319"></a>
<a name="line-320"></a><span class="c1">// int32 specialization</span>
<a name="line-321"></a><span class="cp">#define DECLARE_int32(name) \</span>
<a name="line-322"></a><span class="cp">  DECLARE_VARIABLE(google::int32, I, name, int32)</span>
<a name="line-323"></a>
<a name="line-324"></a><span class="c1">// Special case for string, because we have to specify the namespace</span>
<a name="line-325"></a><span class="c1">// std::string, which doesn&#39;t play nicely with our FLAG__namespace hackery.</span>
<a name="line-326"></a><span class="cp">#define DECLARE_string(name)                                            \</span>
<a name="line-327"></a><span class="cp">  namespace fLS {                                                       \</span>
<a name="line-328"></a><span class="cp">    extern GOOGLE_GLOG_DLL_DECL std::string&amp; FLAGS_##name;              \</span>
<a name="line-329"></a><span class="cp">  }                                                                     \</span>
<a name="line-330"></a><span class="cp">  using fLS::FLAGS_##name</span>
<a name="line-331"></a><span class="cp">#endif</span>
<a name="line-332"></a>
<a name="line-333"></a><span class="c1">// Set whether log messages go to stderr instead of logfiles</span>
<a name="line-334"></a><span class="n">DECLARE_bool</span><span class="p">(</span><span class="n">logtostderr</span><span class="p">);</span>
<a name="line-335"></a>
<a name="line-336"></a><span class="c1">// Set whether log messages go to stderr in addition to logfiles.</span>
<a name="line-337"></a><span class="n">DECLARE_bool</span><span class="p">(</span><span class="n">alsologtostderr</span><span class="p">);</span>
<a name="line-338"></a>
<a name="line-339"></a><span class="c1">// Set color messages logged to stderr (if supported by terminal).</span>
<a name="line-340"></a><span class="n">DECLARE_bool</span><span class="p">(</span><span class="n">colorlogtostderr</span><span class="p">);</span>
<a name="line-341"></a>
<a name="line-342"></a><span class="c1">// Log messages at a level &gt;= this flag are automatically sent to</span>
<a name="line-343"></a><span class="c1">// stderr in addition to log files.</span>
<a name="line-344"></a><span class="n">DECLARE_int32</span><span class="p">(</span><span class="n">stderrthreshold</span><span class="p">);</span>
<a name="line-345"></a>
<a name="line-346"></a><span class="c1">// Set whether the log prefix should be prepended to each line of output.</span>
<a name="line-347"></a><span class="n">DECLARE_bool</span><span class="p">(</span><span class="n">log_prefix</span><span class="p">);</span>
<a name="line-348"></a>
<a name="line-349"></a><span class="c1">// Log messages at a level &lt;= this flag are buffered.</span>
<a name="line-350"></a><span class="c1">// Log messages at a higher level are flushed immediately.</span>
<a name="line-351"></a><span class="n">DECLARE_int32</span><span class="p">(</span><span class="n">logbuflevel</span><span class="p">);</span>
<a name="line-352"></a>
<a name="line-353"></a><span class="c1">// Sets the maximum number of seconds which logs may be buffered for.</span>
<a name="line-354"></a><span class="n">DECLARE_int32</span><span class="p">(</span><span class="n">logbufsecs</span><span class="p">);</span>
<a name="line-355"></a>
<a name="line-356"></a><span class="c1">// Log suppression level: messages logged at a lower level than this</span>
<a name="line-357"></a><span class="c1">// are suppressed.</span>
<a name="line-358"></a><span class="n">DECLARE_int32</span><span class="p">(</span><span class="n">minloglevel</span><span class="p">);</span>
<a name="line-359"></a>
<a name="line-360"></a><span class="c1">// If specified, logfiles are written into this directory instead of the</span>
<a name="line-361"></a><span class="c1">// default logging directory.</span>
<a name="line-362"></a><span class="n">DECLARE_string</span><span class="p">(</span><span class="n">log_dir</span><span class="p">);</span>
<a name="line-363"></a>
<a name="line-364"></a><span class="c1">// Set the log file mode.</span>
<a name="line-365"></a><span class="n">DECLARE_int32</span><span class="p">(</span><span class="n">logfile_mode</span><span class="p">);</span>
<a name="line-366"></a>
<a name="line-367"></a><span class="c1">// Sets the path of the directory into which to put additional links</span>
<a name="line-368"></a><span class="c1">// to the log files.</span>
<a name="line-369"></a><span class="n">DECLARE_string</span><span class="p">(</span><span class="n">log_link</span><span class="p">);</span>
<a name="line-370"></a>
<a name="line-371"></a><span class="n">DECLARE_int32</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>  <span class="c1">// in vlog_is_on.cc</span>
<a name="line-372"></a>
<a name="line-373"></a><span class="c1">// Sets the maximum log file size (in MB).</span>
<a name="line-374"></a><span class="n">DECLARE_int32</span><span class="p">(</span><span class="n">max_log_size</span><span class="p">);</span>
<a name="line-375"></a>
<a name="line-376"></a><span class="c1">// Sets whether to avoid logging to the disk if the disk is full.</span>
<a name="line-377"></a><span class="n">DECLARE_bool</span><span class="p">(</span><span class="n">stop_logging_if_full_disk</span><span class="p">);</span>
<a name="line-378"></a>
<a name="line-379"></a><span class="cp">#ifdef MUST_UNDEF_GFLAGS_DECLARE_MACROS</span>
<a name="line-380"></a><span class="cp">#undef MUST_UNDEF_GFLAGS_DECLARE_MACROS</span>
<a name="line-381"></a><span class="cp">#undef DECLARE_VARIABLE</span>
<a name="line-382"></a><span class="cp">#undef DECLARE_bool</span>
<a name="line-383"></a><span class="cp">#undef DECLARE_int32</span>
<a name="line-384"></a><span class="cp">#undef DECLARE_string</span>
<a name="line-385"></a><span class="cp">#endif</span>
<a name="line-386"></a>
<a name="line-387"></a><span class="c1">// Log messages below the GOOGLE_STRIP_LOG level will be compiled away for</span>
<a name="line-388"></a><span class="c1">// security reasons. See LOG(severtiy) below.</span>
<a name="line-389"></a>
<a name="line-390"></a><span class="c1">// A few definitions of macros that don&#39;t generate much code.  Since</span>
<a name="line-391"></a><span class="c1">// LOG(INFO) and its ilk are used all over our code, it&#39;s</span>
<a name="line-392"></a><span class="c1">// better to have compact code for these operations.</span>
<a name="line-393"></a>
<a name="line-394"></a><span class="cp">#if GOOGLE_STRIP_LOG == 0</span>
<a name="line-395"></a><span class="cp">#define COMPACT_GOOGLE_LOG_INFO google::LogMessage( \</span>
<a name="line-396"></a><span class="cp">      __FILE__, __LINE__)</span>
<a name="line-397"></a><span class="cp">#define LOG_TO_STRING_INFO(message) google::LogMessage( \</span>
<a name="line-398"></a><span class="cp">      __FILE__, __LINE__, google::GLOG_INFO, message)</span>
<a name="line-399"></a><span class="cp">#else</span>
<a name="line-400"></a><span class="cp">#define COMPACT_GOOGLE_LOG_INFO google::NullStream()</span>
<a name="line-401"></a><span class="cp">#define LOG_TO_STRING_INFO(message) google::NullStream()</span>
<a name="line-402"></a><span class="cp">#endif</span>
<a name="line-403"></a>
<a name="line-404"></a><span class="cp">#if GOOGLE_STRIP_LOG &lt;= 1</span>
<a name="line-405"></a><span class="cp">#define COMPACT_GOOGLE_LOG_WARNING google::LogMessage( \</span>
<a name="line-406"></a><span class="cp">      __FILE__, __LINE__, google::GLOG_WARNING)</span>
<a name="line-407"></a><span class="cp">#define LOG_TO_STRING_WARNING(message) google::LogMessage( \</span>
<a name="line-408"></a><span class="cp">      __FILE__, __LINE__, google::GLOG_WARNING, message)</span>
<a name="line-409"></a><span class="cp">#else</span>
<a name="line-410"></a><span class="cp">#define COMPACT_GOOGLE_LOG_WARNING google::NullStream()</span>
<a name="line-411"></a><span class="cp">#define LOG_TO_STRING_WARNING(message) google::NullStream()</span>
<a name="line-412"></a><span class="cp">#endif</span>
<a name="line-413"></a>
<a name="line-414"></a><span class="cp">#if GOOGLE_STRIP_LOG &lt;= 2</span>
<a name="line-415"></a><span class="cp">#define COMPACT_GOOGLE_LOG_ERROR google::LogMessage( \</span>
<a name="line-416"></a><span class="cp">      __FILE__, __LINE__, google::GLOG_ERROR)</span>
<a name="line-417"></a><span class="cp">#define LOG_TO_STRING_ERROR(message) google::LogMessage( \</span>
<a name="line-418"></a><span class="cp">      __FILE__, __LINE__, google::GLOG_ERROR, message)</span>
<a name="line-419"></a><span class="cp">#else</span>
<a name="line-420"></a><span class="cp">#define COMPACT_GOOGLE_LOG_ERROR google::NullStream()</span>
<a name="line-421"></a><span class="cp">#define LOG_TO_STRING_ERROR(message) google::NullStream()</span>
<a name="line-422"></a><span class="cp">#endif</span>
<a name="line-423"></a>
<a name="line-424"></a><span class="cp">#if GOOGLE_STRIP_LOG &lt;= 3</span>
<a name="line-425"></a><span class="cp">#define COMPACT_GOOGLE_LOG_FATAL google::LogMessageFatal( \</span>
<a name="line-426"></a><span class="cp">      __FILE__, __LINE__)</span>
<a name="line-427"></a><span class="cp">#define LOG_TO_STRING_FATAL(message) google::LogMessage( \</span>
<a name="line-428"></a><span class="cp">      __FILE__, __LINE__, google::GLOG_FATAL, message)</span>
<a name="line-429"></a><span class="cp">#else</span>
<a name="line-430"></a><span class="cp">#define COMPACT_GOOGLE_LOG_FATAL google::NullStreamFatal()</span>
<a name="line-431"></a><span class="cp">#define LOG_TO_STRING_FATAL(message) google::NullStreamFatal()</span>
<a name="line-432"></a><span class="cp">#endif</span>
<a name="line-433"></a>
<a name="line-434"></a><span class="cp">#if defined(NDEBUG) &amp;&amp; !defined(DCHECK_ALWAYS_ON)</span>
<a name="line-435"></a><span class="cp">#define DCHECK_IS_ON() 0</span>
<a name="line-436"></a><span class="cp">#else</span>
<a name="line-437"></a><span class="cp">#define DCHECK_IS_ON() 1</span>
<a name="line-438"></a><span class="cp">#endif</span>
<a name="line-439"></a>
<a name="line-440"></a><span class="c1">// For DFATAL, we want to use LogMessage (as opposed to</span>
<a name="line-441"></a><span class="c1">// LogMessageFatal), to be consistent with the original behavior.</span>
<a name="line-442"></a><span class="cp">#if !DCHECK_IS_ON()</span>
<a name="line-443"></a><span class="cp">#define COMPACT_GOOGLE_LOG_DFATAL COMPACT_GOOGLE_LOG_ERROR</span>
<a name="line-444"></a><span class="cp">#elif GOOGLE_STRIP_LOG &lt;= 3</span>
<a name="line-445"></a><span class="cp">#define COMPACT_GOOGLE_LOG_DFATAL google::LogMessage( \</span>
<a name="line-446"></a><span class="cp">      __FILE__, __LINE__, google::GLOG_FATAL)</span>
<a name="line-447"></a><span class="cp">#else</span>
<a name="line-448"></a><span class="cp">#define COMPACT_GOOGLE_LOG_DFATAL google::NullStreamFatal()</span>
<a name="line-449"></a><span class="cp">#endif</span>
<a name="line-450"></a>
<a name="line-451"></a><span class="cp">#define GOOGLE_LOG_INFO(counter) google::LogMessage(__FILE__, __LINE__, google::GLOG_INFO, counter, &amp;google::LogMessage::SendToLog)</span>
<a name="line-452"></a><span class="cp">#define SYSLOG_INFO(counter) \</span>
<a name="line-453"></a><span class="cp">  google::LogMessage(__FILE__, __LINE__, google::GLOG_INFO, counter, \</span>
<a name="line-454"></a><span class="cp">  &amp;google::LogMessage::SendToSyslogAndLog)</span>
<a name="line-455"></a><span class="cp">#define GOOGLE_LOG_WARNING(counter)  \</span>
<a name="line-456"></a><span class="cp">  google::LogMessage(__FILE__, __LINE__, google::GLOG_WARNING, counter, \</span>
<a name="line-457"></a><span class="cp">  &amp;google::LogMessage::SendToLog)</span>
<a name="line-458"></a><span class="cp">#define SYSLOG_WARNING(counter)  \</span>
<a name="line-459"></a><span class="cp">  google::LogMessage(__FILE__, __LINE__, google::GLOG_WARNING, counter, \</span>
<a name="line-460"></a><span class="cp">  &amp;google::LogMessage::SendToSyslogAndLog)</span>
<a name="line-461"></a><span class="cp">#define GOOGLE_LOG_ERROR(counter)  \</span>
<a name="line-462"></a><span class="cp">  google::LogMessage(__FILE__, __LINE__, google::GLOG_ERROR, counter, \</span>
<a name="line-463"></a><span class="cp">  &amp;google::LogMessage::SendToLog)</span>
<a name="line-464"></a><span class="cp">#define SYSLOG_ERROR(counter)  \</span>
<a name="line-465"></a><span class="cp">  google::LogMessage(__FILE__, __LINE__, google::GLOG_ERROR, counter, \</span>
<a name="line-466"></a><span class="cp">  &amp;google::LogMessage::SendToSyslogAndLog)</span>
<a name="line-467"></a><span class="cp">#define GOOGLE_LOG_FATAL(counter) \</span>
<a name="line-468"></a><span class="cp">  google::LogMessage(__FILE__, __LINE__, google::GLOG_FATAL, counter, \</span>
<a name="line-469"></a><span class="cp">  &amp;google::LogMessage::SendToLog)</span>
<a name="line-470"></a><span class="cp">#define SYSLOG_FATAL(counter) \</span>
<a name="line-471"></a><span class="cp">  google::LogMessage(__FILE__, __LINE__, google::GLOG_FATAL, counter, \</span>
<a name="line-472"></a><span class="cp">  &amp;google::LogMessage::SendToSyslogAndLog)</span>
<a name="line-473"></a><span class="cp">#define GOOGLE_LOG_DFATAL(counter) \</span>
<a name="line-474"></a><span class="cp">  google::LogMessage(__FILE__, __LINE__, google::DFATAL_LEVEL, counter, \</span>
<a name="line-475"></a><span class="cp">  &amp;google::LogMessage::SendToLog)</span>
<a name="line-476"></a><span class="cp">#define SYSLOG_DFATAL(counter) \</span>
<a name="line-477"></a><span class="cp">  google::LogMessage(__FILE__, __LINE__, google::DFATAL_LEVEL, counter, \</span>
<a name="line-478"></a><span class="cp">  &amp;google::LogMessage::SendToSyslogAndLog)</span>
<a name="line-479"></a>
<a name="line-480"></a><span class="cp">#if defined(WIN32) || defined(_WIN32) || defined(__WIN32__) || defined(__CYGWIN__) || defined(__CYGWIN32__)</span>
<a name="line-481"></a><span class="c1">// A very useful logging macro to log windows errors:</span>
<a name="line-482"></a><span class="cp">#define LOG_SYSRESULT(result) \</span>
<a name="line-483"></a><span class="cp">  if (FAILED(HRESULT_FROM_WIN32(result))) { \</span>
<a name="line-484"></a><span class="cp">    LPSTR message = NULL; \</span>
<a name="line-485"></a><span class="cp">    LPSTR msg = reinterpret_cast&lt;LPSTR&gt;(&amp;message); \</span>
<a name="line-486"></a><span class="cp">    DWORD message_length = FormatMessageA(FORMAT_MESSAGE_ALLOCATE_BUFFER | \</span>
<a name="line-487"></a><span class="cp">                         FORMAT_MESSAGE_FROM_SYSTEM, \</span>
<a name="line-488"></a><span class="cp">                         0, result, 0, msg, 100, NULL); \</span>
<a name="line-489"></a><span class="cp">    if (message_length &gt; 0) { \</span>
<a name="line-490"></a><span class="cp">      google::LogMessage(__FILE__, __LINE__, google::GLOG_ERROR, 0, \</span>
<a name="line-491"></a><span class="cp">          &amp;google::LogMessage::SendToLog).stream() \</span>
<a name="line-492"></a><span class="cp">          &lt;&lt; reinterpret_cast&lt;const char*&gt;(message); \</span>
<a name="line-493"></a><span class="cp">      LocalFree(message); \</span>
<a name="line-494"></a><span class="cp">    } \</span>
<a name="line-495"></a><span class="cp">  }</span>
<a name="line-496"></a><span class="cp">#endif</span>
<a name="line-497"></a>
<a name="line-498"></a><span class="c1">// We use the preprocessor&#39;s merging operator, &quot;##&quot;, so that, e.g.,</span>
<a name="line-499"></a><span class="c1">// LOG(INFO) becomes the token GOOGLE_LOG_INFO.  There&#39;s some funny</span>
<a name="line-500"></a><span class="c1">// subtle difference between ostream member streaming functions (e.g.,</span>
<a name="line-501"></a><span class="c1">// ostream::operator&lt;&lt;(int) and ostream non-member streaming functions</span>
<a name="line-502"></a><span class="c1">// (e.g., ::operator&lt;&lt;(ostream&amp;, string&amp;): it turns out that it&#39;s</span>
<a name="line-503"></a><span class="c1">// impossible to stream something like a string directly to an unnamed</span>
<a name="line-504"></a><span class="c1">// ostream. We employ a neat hack by calling the stream() member</span>
<a name="line-505"></a><span class="c1">// function of LogMessage which seems to avoid the problem.</span>
<a name="line-506"></a><span class="cp">#define LOG(severity) COMPACT_GOOGLE_LOG_ ## severity.stream()</span>
<a name="line-507"></a><span class="cp">#define SYSLOG(severity) SYSLOG_ ## severity(0).stream()</span>
<a name="line-508"></a>
<a name="line-509"></a><span class="n">namespace</span> <span class="n">google</span> <span class="p">{</span>
<a name="line-510"></a>
<a name="line-511"></a><span class="c1">// They need the definitions of integer types.</span>
<a name="line-512"></a><span class="cp">#include</span> <span class="cpf">&quot;glog/log_severity.h&quot;</span><span class="cp"></span>
<a name="line-513"></a><span class="cp">#include</span> <span class="cpf">&quot;glog/vlog_is_on.h&quot;</span><span class="cp"></span>
<a name="line-514"></a>
<a name="line-515"></a><span class="c1">// Initialize google&#39;s logging library. You will see the program name</span>
<a name="line-516"></a><span class="c1">// specified by argv0 in log outputs.</span>
<a name="line-517"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="kt">void</span> <span class="n">InitGoogleLogging</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv0</span><span class="p">);</span>
<a name="line-518"></a>
<a name="line-519"></a><span class="c1">// Shutdown google&#39;s logging library.</span>
<a name="line-520"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="kt">void</span> <span class="nf">ShutdownGoogleLogging</span><span class="p">();</span>
<a name="line-521"></a>
<a name="line-522"></a><span class="c1">// Install a function which will be called after LOG(FATAL).</span>
<a name="line-523"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="kt">void</span> <span class="nf">InstallFailureFunction</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">fail_func</span><span class="p">)());</span>
<a name="line-524"></a>
<a name="line-525"></a><span class="n">class</span> <span class="n">LogSink</span><span class="p">;</span>  <span class="c1">// defined below</span>
<a name="line-526"></a>
<a name="line-527"></a><span class="c1">// If a non-NULL sink pointer is given, we push this message to that sink.</span>
<a name="line-528"></a><span class="c1">// For LOG_TO_SINK we then do normal LOG(severity) logging as well.</span>
<a name="line-529"></a><span class="c1">// This is useful for capturing messages and passing/storing them</span>
<a name="line-530"></a><span class="c1">// somewhere more specific than the global log of the process.</span>
<a name="line-531"></a><span class="c1">// Argument types:</span>
<a name="line-532"></a><span class="c1">//   LogSink* sink;</span>
<a name="line-533"></a><span class="c1">//   LogSeverity severity;</span>
<a name="line-534"></a><span class="c1">// The cast is to disambiguate NULL arguments.</span>
<a name="line-535"></a><span class="cp">#define LOG_TO_SINK(sink, severity) \</span>
<a name="line-536"></a><span class="cp">  google::LogMessage(                                    \</span>
<a name="line-537"></a><span class="cp">      __FILE__, __LINE__,                                               \</span>
<a name="line-538"></a><span class="cp">      google::GLOG_ ## severity,                         \</span>
<a name="line-539"></a><span class="cp">      static_cast&lt;google::LogSink*&gt;(sink), true).stream()</span>
<a name="line-540"></a><span class="cp">#define LOG_TO_SINK_BUT_NOT_TO_LOGFILE(sink, severity)                  \</span>
<a name="line-541"></a><span class="cp">  google::LogMessage(                                    \</span>
<a name="line-542"></a><span class="cp">      __FILE__, __LINE__,                                               \</span>
<a name="line-543"></a><span class="cp">      google::GLOG_ ## severity,                         \</span>
<a name="line-544"></a><span class="cp">      static_cast&lt;google::LogSink*&gt;(sink), false).stream()</span>
<a name="line-545"></a>
<a name="line-546"></a><span class="c1">// If a non-NULL string pointer is given, we write this message to that string.</span>
<a name="line-547"></a><span class="c1">// We then do normal LOG(severity) logging as well.</span>
<a name="line-548"></a><span class="c1">// This is useful for capturing messages and storing them somewhere more</span>
<a name="line-549"></a><span class="c1">// specific than the global log of the process.</span>
<a name="line-550"></a><span class="c1">// Argument types:</span>
<a name="line-551"></a><span class="c1">//   string* message;</span>
<a name="line-552"></a><span class="c1">//   LogSeverity severity;</span>
<a name="line-553"></a><span class="c1">// The cast is to disambiguate NULL arguments.</span>
<a name="line-554"></a><span class="c1">// NOTE: LOG(severity) expands to LogMessage().stream() for the specified</span>
<a name="line-555"></a><span class="c1">// severity.</span>
<a name="line-556"></a><span class="cp">#define LOG_TO_STRING(severity, message) \</span>
<a name="line-557"></a><span class="cp">  LOG_TO_STRING_##severity(static_cast&lt;string*&gt;(message)).stream()</span>
<a name="line-558"></a>
<a name="line-559"></a><span class="c1">// If a non-NULL pointer is given, we push the message onto the end</span>
<a name="line-560"></a><span class="c1">// of a vector of strings; otherwise, we report it with LOG(severity).</span>
<a name="line-561"></a><span class="c1">// This is handy for capturing messages and perhaps passing them back</span>
<a name="line-562"></a><span class="c1">// to the caller, rather than reporting them immediately.</span>
<a name="line-563"></a><span class="c1">// Argument types:</span>
<a name="line-564"></a><span class="c1">//   LogSeverity severity;</span>
<a name="line-565"></a><span class="c1">//   vector&lt;string&gt; *outvec;</span>
<a name="line-566"></a><span class="c1">// The cast is to disambiguate NULL arguments.</span>
<a name="line-567"></a><span class="cp">#define LOG_STRING(severity, outvec) \</span>
<a name="line-568"></a><span class="cp">  LOG_TO_STRING_##severity(static_cast&lt;std::vector&lt;std::string&gt;*&gt;(outvec)).stream()</span>
<a name="line-569"></a>
<a name="line-570"></a><span class="cp">#define LOG_IF(severity, condition) \</span>
<a name="line-571"></a><span class="cp">  static_cast&lt;void&gt;(0),             \</span>
<a name="line-572"></a><span class="cp">  !(condition) ? (void) 0 : google::LogMessageVoidify() &amp; LOG(severity)</span>
<a name="line-573"></a><span class="cp">#define SYSLOG_IF(severity, condition) \</span>
<a name="line-574"></a><span class="cp">  static_cast&lt;void&gt;(0),                \</span>
<a name="line-575"></a><span class="cp">  !(condition) ? (void) 0 : google::LogMessageVoidify() &amp; SYSLOG(severity)</span>
<a name="line-576"></a>
<a name="line-577"></a><span class="cp">#define LOG_ASSERT(condition)  \</span>
<a name="line-578"></a><span class="cp">  LOG_IF(FATAL, !(condition)) &lt;&lt; &quot;Assert failed: &quot; #condition</span>
<a name="line-579"></a><span class="cp">#define SYSLOG_ASSERT(condition) \</span>
<a name="line-580"></a><span class="cp">  SYSLOG_IF(FATAL, !(condition)) &lt;&lt; &quot;Assert failed: &quot; #condition</span>
<a name="line-581"></a>
<a name="line-582"></a><span class="c1">// CHECK dies with a fatal error if condition is not true.  It is *not*</span>
<a name="line-583"></a><span class="c1">// controlled by DCHECK_IS_ON(), so the check will be executed regardless of</span>
<a name="line-584"></a><span class="c1">// compilation mode.  Therefore, it is safe to do things like:</span>
<a name="line-585"></a><span class="c1">//    CHECK(fp-&gt;Write(x) == 4)</span>
<a name="line-586"></a><span class="cp">#define CHECK(condition)  \</span>
<a name="line-587"></a><span class="cp">      LOG_IF(FATAL, GOOGLE_PREDICT_BRANCH_NOT_TAKEN(!(condition))) \</span>
<a name="line-588"></a><span class="cp">             &lt;&lt; &quot;Check failed: &quot; #condition &quot; &quot;</span>
<a name="line-589"></a>
<a name="line-590"></a><span class="c1">// A container for a string pointer which can be evaluated to a bool -</span>
<a name="line-591"></a><span class="c1">// true iff the pointer is NULL.</span>
<a name="line-592"></a><span class="k">struct</span> <span class="n">CheckOpString</span> <span class="p">{</span>
<a name="line-593"></a>  <span class="n">CheckOpString</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">*</span> <span class="n">str</span><span class="p">)</span> <span class="o">:</span> <span class="n">str_</span><span class="p">(</span><span class="n">str</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<a name="line-594"></a>  <span class="c1">// No destructor: if str_ is non-NULL, we&#39;re about to LOG(FATAL),</span>
<a name="line-595"></a>  <span class="c1">// so there&#39;s no point in cleaning up str_.</span>
<a name="line-596"></a>  <span class="n">operator</span> <span class="kt">bool</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
<a name="line-597"></a>    <span class="k">return</span> <span class="n">GOOGLE_PREDICT_BRANCH_NOT_TAKEN</span><span class="p">(</span><span class="n">str_</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-598"></a>  <span class="p">}</span>
<a name="line-599"></a>  <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">*</span> <span class="n">str_</span><span class="p">;</span>
<a name="line-600"></a><span class="p">};</span>
<a name="line-601"></a>
<a name="line-602"></a><span class="c1">// Function is overloaded for integral types to allow static const</span>
<a name="line-603"></a><span class="c1">// integrals declared in classes and not defined to be used as arguments to</span>
<a name="line-604"></a><span class="c1">// CHECK* macros. It&#39;s not encouraged though.</span>
<a name="line-605"></a><span class="n">template</span> <span class="o">&lt;</span><span class="n">class</span> <span class="n">T</span><span class="o">&gt;</span>
<a name="line-606"></a><span class="kr">inline</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span>       <span class="n">GetReferenceableValue</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span>           <span class="n">t</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">t</span><span class="p">;</span> <span class="p">}</span>
<a name="line-607"></a><span class="kr">inline</span> <span class="kt">char</span>           <span class="n">GetReferenceableValue</span><span class="p">(</span><span class="kt">char</span>               <span class="n">t</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">t</span><span class="p">;</span> <span class="p">}</span>
<a name="line-608"></a><span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">GetReferenceableValue</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span>      <span class="n">t</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">t</span><span class="p">;</span> <span class="p">}</span>
<a name="line-609"></a><span class="kr">inline</span> <span class="kt">signed</span> <span class="kt">char</span>    <span class="n">GetReferenceableValue</span><span class="p">(</span><span class="kt">signed</span> <span class="kt">char</span>        <span class="n">t</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">t</span><span class="p">;</span> <span class="p">}</span>
<a name="line-610"></a><span class="kr">inline</span> <span class="kt">short</span>          <span class="n">GetReferenceableValue</span><span class="p">(</span><span class="kt">short</span>              <span class="n">t</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">t</span><span class="p">;</span> <span class="p">}</span>
<a name="line-611"></a><span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">GetReferenceableValue</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span>     <span class="n">t</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">t</span><span class="p">;</span> <span class="p">}</span>
<a name="line-612"></a><span class="kr">inline</span> <span class="kt">int</span>            <span class="n">GetReferenceableValue</span><span class="p">(</span><span class="kt">int</span>                <span class="n">t</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">t</span><span class="p">;</span> <span class="p">}</span>
<a name="line-613"></a><span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span>   <span class="n">GetReferenceableValue</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span>       <span class="n">t</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">t</span><span class="p">;</span> <span class="p">}</span>
<a name="line-614"></a><span class="kr">inline</span> <span class="kt">long</span>           <span class="n">GetReferenceableValue</span><span class="p">(</span><span class="kt">long</span>               <span class="n">t</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">t</span><span class="p">;</span> <span class="p">}</span>
<a name="line-615"></a><span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">long</span>  <span class="n">GetReferenceableValue</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span>      <span class="n">t</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">t</span><span class="p">;</span> <span class="p">}</span>
<a name="line-616"></a><span class="kr">inline</span> <span class="kt">long</span> <span class="kt">long</span>      <span class="n">GetReferenceableValue</span><span class="p">(</span><span class="kt">long</span> <span class="kt">long</span>          <span class="n">t</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">t</span><span class="p">;</span> <span class="p">}</span>
<a name="line-617"></a><span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">GetReferenceableValue</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
<a name="line-618"></a>  <span class="k">return</span> <span class="n">t</span><span class="p">;</span>
<a name="line-619"></a><span class="p">}</span>
<a name="line-620"></a>
<a name="line-621"></a><span class="c1">// This is a dummy class to define the following operator.</span>
<a name="line-622"></a><span class="k">struct</span> <span class="n">DummyClassToDefineOperator</span> <span class="p">{};</span>
<a name="line-623"></a>
<a name="line-624"></a><span class="p">}</span>
<a name="line-625"></a>
<a name="line-626"></a><span class="c1">// Define global operator&lt;&lt; to declare using ::operator&lt;&lt;.</span>
<a name="line-627"></a><span class="c1">// This declaration will allow use to use CHECK macros for user</span>
<a name="line-628"></a><span class="c1">// defined classes which have operator&lt;&lt; (e.g., stl_logging.h).</span>
<a name="line-629"></a><span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span>
<a name="line-630"></a>    <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">out</span><span class="p">,</span> <span class="k">const</span> <span class="n">google</span><span class="o">::</span><span class="n">DummyClassToDefineOperator</span><span class="o">&amp;</span><span class="p">)</span> <span class="p">{</span>
<a name="line-631"></a>  <span class="k">return</span> <span class="n">out</span><span class="p">;</span>
<a name="line-632"></a><span class="p">}</span>
<a name="line-633"></a>
<a name="line-634"></a><span class="n">namespace</span> <span class="n">google</span> <span class="p">{</span>
<a name="line-635"></a>
<a name="line-636"></a><span class="c1">// This formats a value for a failing CHECK_XX statement.  Ordinarily,</span>
<a name="line-637"></a><span class="c1">// it uses the definition for operator&lt;&lt;, with a few special cases below.</span>
<a name="line-638"></a><span class="n">template</span> <span class="o">&lt;</span><span class="kr">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<a name="line-639"></a><span class="kr">inline</span> <span class="kt">void</span> <span class="n">MakeCheckOpValueString</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
<a name="line-640"></a>  <span class="p">(</span><span class="o">*</span><span class="n">os</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="p">;</span>
<a name="line-641"></a><span class="p">}</span>
<a name="line-642"></a>
<a name="line-643"></a><span class="c1">// Overrides for char types provide readable values for unprintable</span>
<a name="line-644"></a><span class="c1">// characters.</span>
<a name="line-645"></a><span class="hll"><span class="n">template</span> <span class="o">&lt;&gt;</span> <span class="n">GOOGLE_GLOG_DLL_DECL</span><span class='error2'>&lt;--- syntax error</span>
</span><a name="line-646"></a><span class="kt">void</span> <span class="n">MakeCheckOpValueString</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">&amp;</span> <span class="n">v</span><span class="p">);</span>
<a name="line-647"></a><span class="n">template</span> <span class="o">&lt;&gt;</span> <span class="n">GOOGLE_GLOG_DLL_DECL</span>
<a name="line-648"></a><span class="kt">void</span> <span class="n">MakeCheckOpValueString</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="kt">signed</span> <span class="kt">char</span><span class="o">&amp;</span> <span class="n">v</span><span class="p">);</span>
<a name="line-649"></a><span class="n">template</span> <span class="o">&lt;&gt;</span> <span class="n">GOOGLE_GLOG_DLL_DECL</span>
<a name="line-650"></a><span class="kt">void</span> <span class="n">MakeCheckOpValueString</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">&amp;</span> <span class="n">v</span><span class="p">);</span>
<a name="line-651"></a>
<a name="line-652"></a><span class="c1">// Build the error message string. Specify no inlining for code size.</span>
<a name="line-653"></a><span class="n">template</span> <span class="o">&lt;</span><span class="kr">typename</span> <span class="n">T1</span><span class="p">,</span> <span class="kr">typename</span> <span class="n">T2</span><span class="o">&gt;</span>
<a name="line-654"></a><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">*</span> <span class="n">MakeCheckOpString</span><span class="p">(</span><span class="k">const</span> <span class="n">T1</span><span class="o">&amp;</span> <span class="n">v1</span><span class="p">,</span> <span class="k">const</span> <span class="n">T2</span><span class="o">&amp;</span> <span class="n">v2</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">exprtext</span><span class="p">)</span>
<a name="line-655"></a>    <span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">));</span>
<a name="line-656"></a>
<a name="line-657"></a><span class="n">namespace</span> <span class="n">base</span> <span class="p">{</span>
<a name="line-658"></a><span class="n">namespace</span> <span class="n">internal</span> <span class="p">{</span>
<a name="line-659"></a>
<a name="line-660"></a><span class="c1">// If &quot;s&quot; is less than base_logging::INFO, returns base_logging::INFO.</span>
<a name="line-661"></a><span class="c1">// If &quot;s&quot; is greater than base_logging::FATAL, returns</span>
<a name="line-662"></a><span class="c1">// base_logging::ERROR.  Otherwise, returns &quot;s&quot;.</span>
<a name="line-663"></a><span class="n">LogSeverity</span> <span class="n">NormalizeSeverity</span><span class="p">(</span><span class="n">LogSeverity</span> <span class="n">s</span><span class="p">);</span>
<a name="line-664"></a>
<a name="line-665"></a><span class="p">}</span>  <span class="c1">// namespace internal</span>
<a name="line-666"></a>
<a name="line-667"></a><span class="c1">// A helper class for formatting &quot;expr (V1 vs. V2)&quot; in a CHECK_XX</span>
<a name="line-668"></a><span class="c1">// statement.  See MakeCheckOpString for sample usage.  Other</span>
<a name="line-669"></a><span class="c1">// approaches were considered: use of a template method (e.g.,</span>
<a name="line-670"></a><span class="c1">// base::BuildCheckOpString(exprtext, base::Print&lt;T1&gt;, &amp;v1,</span>
<a name="line-671"></a><span class="c1">// base::Print&lt;T2&gt;, &amp;v2), however this approach has complications</span>
<a name="line-672"></a><span class="c1">// related to volatile arguments and function-pointer arguments).</span>
<a name="line-673"></a><span class="n">class</span> <span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="n">CheckOpMessageBuilder</span> <span class="p">{</span>
<a name="line-674"></a> <span class="nl">public</span><span class="p">:</span>
<a name="line-675"></a>  <span class="c1">// Inserts &quot;exprtext&quot; and &quot; (&quot; to the stream.</span>
<a name="line-676"></a>  <span class="n">explicit</span> <span class="n">CheckOpMessageBuilder</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">exprtext</span><span class="p">);</span>
<a name="line-677"></a>  <span class="c1">// Deletes &quot;stream_&quot;.</span>
<a name="line-678"></a>  <span class="o">~</span><span class="n">CheckOpMessageBuilder</span><span class="p">();</span>
<a name="line-679"></a>  <span class="c1">// For inserting the first variable.</span>
<a name="line-680"></a>  <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="n">ForVar1</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">stream_</span><span class="p">;</span> <span class="p">}</span>
<a name="line-681"></a>  <span class="c1">// For inserting the second variable (adds an intermediate &quot; vs. &quot;).</span>
<a name="line-682"></a>  <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="n">ForVar2</span><span class="p">();</span>
<a name="line-683"></a>  <span class="c1">// Get the result (inserts the closing &quot;)&quot;).</span>
<a name="line-684"></a>  <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">*</span> <span class="n">NewString</span><span class="p">();</span>
<a name="line-685"></a>
<a name="line-686"></a> <span class="nl">private</span><span class="p">:</span>
<a name="line-687"></a>  <span class="n">std</span><span class="o">::</span><span class="n">ostringstream</span> <span class="o">*</span><span class="n">stream_</span><span class="p">;</span>
<a name="line-688"></a><span class="p">};</span>
<a name="line-689"></a>
<a name="line-690"></a><span class="p">}</span>  <span class="c1">// namespace base</span>
<a name="line-691"></a>
<a name="line-692"></a><span class="n">template</span> <span class="o">&lt;</span><span class="kr">typename</span> <span class="n">T1</span><span class="p">,</span> <span class="kr">typename</span> <span class="n">T2</span><span class="o">&gt;</span>
<a name="line-693"></a><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">*</span> <span class="n">MakeCheckOpString</span><span class="p">(</span><span class="k">const</span> <span class="n">T1</span><span class="o">&amp;</span> <span class="n">v1</span><span class="p">,</span> <span class="k">const</span> <span class="n">T2</span><span class="o">&amp;</span> <span class="n">v2</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">exprtext</span><span class="p">)</span> <span class="p">{</span>
<a name="line-694"></a>  <span class="n">base</span><span class="o">::</span><span class="n">CheckOpMessageBuilder</span> <span class="n">comb</span><span class="p">(</span><span class="n">exprtext</span><span class="p">);</span>
<a name="line-695"></a>  <span class="n">MakeCheckOpValueString</span><span class="p">(</span><span class="n">comb</span><span class="p">.</span><span class="n">ForVar1</span><span class="p">(),</span> <span class="n">v1</span><span class="p">);</span>
<a name="line-696"></a>  <span class="n">MakeCheckOpValueString</span><span class="p">(</span><span class="n">comb</span><span class="p">.</span><span class="n">ForVar2</span><span class="p">(),</span> <span class="n">v2</span><span class="p">);</span>
<a name="line-697"></a>  <span class="k">return</span> <span class="n">comb</span><span class="p">.</span><span class="n">NewString</span><span class="p">();</span>
<a name="line-698"></a><span class="p">}</span>
<a name="line-699"></a>
<a name="line-700"></a><span class="c1">// Helper functions for CHECK_OP macro.</span>
<a name="line-701"></a><span class="c1">// The (int, int) specialization works around the issue that the compiler</span>
<a name="line-702"></a><span class="c1">// will not instantiate the template version of the function on values of</span>
<a name="line-703"></a><span class="c1">// unnamed enum type - see comment below.</span>
<a name="line-704"></a><span class="cp">#define DEFINE_CHECK_OP_IMPL(name, op) \</span>
<a name="line-705"></a><span class="cp">  template &lt;typename T1, typename T2&gt; \</span>
<a name="line-706"></a><span class="cp">  inline std::string* name##Impl(const T1&amp; v1, const T2&amp; v2,    \</span>
<a name="line-707"></a><span class="cp">                            const char* exprtext) { \</span>
<a name="line-708"></a><span class="cp">    if (GOOGLE_PREDICT_TRUE(v1 op v2)) return NULL; \</span>
<a name="line-709"></a><span class="cp">    else return MakeCheckOpString(v1, v2, exprtext); \</span>
<a name="line-710"></a><span class="cp">  } \</span>
<a name="line-711"></a><span class="cp">  inline std::string* name##Impl(int v1, int v2, const char* exprtext) { \</span>
<a name="line-712"></a><span class="cp">    return name##Impl&lt;int, int&gt;(v1, v2, exprtext); \</span>
<a name="line-713"></a><span class="cp">  }</span>
<a name="line-714"></a>
<a name="line-715"></a><span class="c1">// We use the full name Check_EQ, Check_NE, etc. in case the file including</span>
<a name="line-716"></a><span class="c1">// base/logging.h provides its own #defines for the simpler names EQ, NE, etc.</span>
<a name="line-717"></a><span class="c1">// This happens if, for example, those are used as token names in a</span>
<a name="line-718"></a><span class="c1">// yacc grammar.</span>
<a name="line-719"></a><span class="n">DEFINE_CHECK_OP_IMPL</span><span class="p">(</span><span class="n">Check_EQ</span><span class="p">,</span> <span class="o">==</span><span class="p">)</span>  <span class="c1">// Compilation error with CHECK_EQ(NULL, x)?</span>
<a name="line-720"></a><span class="n">DEFINE_CHECK_OP_IMPL</span><span class="p">(</span><span class="n">Check_NE</span><span class="p">,</span> <span class="o">!=</span><span class="p">)</span>  <span class="c1">// Use CHECK(x == NULL) instead.</span>
<a name="line-721"></a><span class="n">DEFINE_CHECK_OP_IMPL</span><span class="p">(</span><span class="n">Check_LE</span><span class="p">,</span> <span class="o">&lt;=</span><span class="p">)</span>
<a name="line-722"></a><span class="n">DEFINE_CHECK_OP_IMPL</span><span class="p">(</span><span class="n">Check_LT</span><span class="p">,</span> <span class="o">&lt;</span> <span class="p">)</span>
<a name="line-723"></a><span class="n">DEFINE_CHECK_OP_IMPL</span><span class="p">(</span><span class="n">Check_GE</span><span class="p">,</span> <span class="o">&gt;=</span><span class="p">)</span>
<a name="line-724"></a><span class="n">DEFINE_CHECK_OP_IMPL</span><span class="p">(</span><span class="n">Check_GT</span><span class="p">,</span> <span class="o">&gt;</span> <span class="p">)</span>
<a name="line-725"></a><span class="cp">#undef DEFINE_CHECK_OP_IMPL</span>
<a name="line-726"></a>
<a name="line-727"></a><span class="c1">// Helper macro for binary operators.</span>
<a name="line-728"></a><span class="c1">// Don&#39;t use this macro directly in your code, use CHECK_EQ et al below.</span>
<a name="line-729"></a>
<a name="line-730"></a><span class="cp">#if defined(STATIC_ANALYSIS)</span>
<a name="line-731"></a><span class="c1">// Only for static analysis tool to know that it is equivalent to assert</span>
<a name="line-732"></a><span class="cp">#define CHECK_OP_LOG(name, op, val1, val2, log) CHECK((val1) op (val2))</span>
<a name="line-733"></a><span class="cp">#elif DCHECK_IS_ON()</span>
<a name="line-734"></a><span class="c1">// In debug mode, avoid constructing CheckOpStrings if possible,</span>
<a name="line-735"></a><span class="c1">// to reduce the overhead of CHECK statments by 2x.</span>
<a name="line-736"></a><span class="c1">// Real DCHECK-heavy tests have seen 1.5x speedups.</span>
<a name="line-737"></a>
<a name="line-738"></a><span class="c1">// The meaning of &quot;string&quot; might be different between now and</span>
<a name="line-739"></a><span class="c1">// when this macro gets invoked (e.g., if someone is experimenting</span>
<a name="line-740"></a><span class="c1">// with other string implementations that get defined after this</span>
<a name="line-741"></a><span class="c1">// file is included).  Save the current meaning now and use it</span>
<a name="line-742"></a><span class="c1">// in the macro.</span>
<a name="line-743"></a><span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">_Check_string</span><span class="p">;</span>
<a name="line-744"></a><span class="cp">#define CHECK_OP_LOG(name, op, val1, val2, log)                         \</span>
<a name="line-745"></a><span class="cp">  while (google::_Check_string* _result =                \</span>
<a name="line-746"></a><span class="cp">         google::Check##name##Impl(                      \</span>
<a name="line-747"></a><span class="cp">             google::GetReferenceableValue(val1),        \</span>
<a name="line-748"></a><span class="cp">             google::GetReferenceableValue(val2),        \</span>
<a name="line-749"></a><span class="cp">             #val1 &quot; &quot; #op &quot; &quot; #val2))                                  \</span>
<a name="line-750"></a><span class="cp">    log(__FILE__, __LINE__,                                             \</span>
<a name="line-751"></a><span class="cp">        google::CheckOpString(_result)).stream()</span>
<a name="line-752"></a><span class="cp">#else</span>
<a name="line-753"></a><span class="c1">// In optimized mode, use CheckOpString to hint to compiler that</span>
<a name="line-754"></a><span class="c1">// the while condition is unlikely.</span>
<a name="line-755"></a><span class="cp">#define CHECK_OP_LOG(name, op, val1, val2, log)                         \</span>
<a name="line-756"></a><span class="cp">  while (google::CheckOpString _result =                 \</span>
<a name="line-757"></a><span class="cp">         google::Check##name##Impl(                      \</span>
<a name="line-758"></a><span class="cp">             google::GetReferenceableValue(val1),        \</span>
<a name="line-759"></a><span class="cp">             google::GetReferenceableValue(val2),        \</span>
<a name="line-760"></a><span class="cp">             #val1 &quot; &quot; #op &quot; &quot; #val2))                                  \</span>
<a name="line-761"></a><span class="cp">    log(__FILE__, __LINE__, _result).stream()</span>
<a name="line-762"></a><span class="cp">#endif  </span><span class="c1">// STATIC_ANALYSIS, DCHECK_IS_ON()</span>
<a name="line-763"></a>
<a name="line-764"></a><span class="cp">#if GOOGLE_STRIP_LOG &lt;= 3</span>
<a name="line-765"></a><span class="cp">#define CHECK_OP(name, op, val1, val2) \</span>
<a name="line-766"></a><span class="cp">  CHECK_OP_LOG(name, op, val1, val2, google::LogMessageFatal)</span>
<a name="line-767"></a><span class="cp">#else</span>
<a name="line-768"></a><span class="cp">#define CHECK_OP(name, op, val1, val2) \</span>
<a name="line-769"></a><span class="cp">  CHECK_OP_LOG(name, op, val1, val2, google::NullStreamFatal)</span>
<a name="line-770"></a><span class="cp">#endif </span><span class="c1">// STRIP_LOG &lt;= 3</span>
<a name="line-771"></a>
<a name="line-772"></a><span class="c1">// Equality/Inequality checks - compare two values, and log a FATAL message</span>
<a name="line-773"></a><span class="c1">// including the two values when the result is not as expected.  The values</span>
<a name="line-774"></a><span class="c1">// must have operator&lt;&lt;(ostream, ...) defined.</span>
<a name="line-775"></a><span class="c1">//</span>
<a name="line-776"></a><span class="c1">// You may append to the error message like so:</span>
<a name="line-777"></a><span class="c1">//   CHECK_NE(1, 2) &lt;&lt; &quot;: The world must be ending!&quot;;</span>
<a name="line-778"></a><span class="c1">//</span>
<a name="line-779"></a><span class="c1">// We are very careful to ensure that each argument is evaluated exactly</span>
<a name="line-780"></a><span class="c1">// once, and that anything which is legal to pass as a function argument is</span>
<a name="line-781"></a><span class="c1">// legal here.  In particular, the arguments may be temporary expressions</span>
<a name="line-782"></a><span class="c1">// which will end up being destroyed at the end of the apparent statement,</span>
<a name="line-783"></a><span class="c1">// for example:</span>
<a name="line-784"></a><span class="c1">//   CHECK_EQ(string(&quot;abc&quot;)[1], &#39;b&#39;);</span>
<a name="line-785"></a><span class="c1">//</span>
<a name="line-786"></a><span class="c1">// WARNING: These don&#39;t compile correctly if one of the arguments is a pointer</span>
<a name="line-787"></a><span class="c1">// and the other is NULL. To work around this, simply static_cast NULL to the</span>
<a name="line-788"></a><span class="c1">// type of the desired pointer.</span>
<a name="line-789"></a>
<a name="line-790"></a><span class="cp">#define CHECK_EQ(val1, val2) CHECK_OP(_EQ, ==, val1, val2)</span>
<a name="line-791"></a><span class="cp">#define CHECK_NE(val1, val2) CHECK_OP(_NE, !=, val1, val2)</span>
<a name="line-792"></a><span class="cp">#define CHECK_LE(val1, val2) CHECK_OP(_LE, &lt;=, val1, val2)</span>
<a name="line-793"></a><span class="cp">#define CHECK_LT(val1, val2) CHECK_OP(_LT, &lt; , val1, val2)</span>
<a name="line-794"></a><span class="cp">#define CHECK_GE(val1, val2) CHECK_OP(_GE, &gt;=, val1, val2)</span>
<a name="line-795"></a><span class="cp">#define CHECK_GT(val1, val2) CHECK_OP(_GT, &gt; , val1, val2)</span>
<a name="line-796"></a>
<a name="line-797"></a><span class="c1">// Check that the input is non NULL.  This very useful in constructor</span>
<a name="line-798"></a><span class="c1">// initializer lists.</span>
<a name="line-799"></a>
<a name="line-800"></a><span class="cp">#define CHECK_NOTNULL(val) \</span>
<a name="line-801"></a><span class="cp">  google::CheckNotNull(__FILE__, __LINE__, &quot;&#39;&quot; #val &quot;&#39; Must be non NULL&quot;, (val))</span>
<a name="line-802"></a>
<a name="line-803"></a><span class="c1">// Helper functions for string comparisons.</span>
<a name="line-804"></a><span class="c1">// To avoid bloat, the definitions are in logging.cc.</span>
<a name="line-805"></a><span class="cp">#define DECLARE_CHECK_STROP_IMPL(func, expected) \</span>
<a name="line-806"></a><span class="cp">  GOOGLE_GLOG_DLL_DECL std::string* Check##func##expected##Impl( \</span>
<a name="line-807"></a><span class="cp">      const char* s1, const char* s2, const char* names);</span>
<a name="line-808"></a><span class="n">DECLARE_CHECK_STROP_IMPL</span><span class="p">(</span><span class="n">strcmp</span><span class="p">,</span> <span class="nb">true</span><span class="p">)</span>
<a name="line-809"></a><span class="n">DECLARE_CHECK_STROP_IMPL</span><span class="p">(</span><span class="n">strcmp</span><span class="p">,</span> <span class="nb">false</span><span class="p">)</span>
<a name="line-810"></a><span class="n">DECLARE_CHECK_STROP_IMPL</span><span class="p">(</span><span class="n">strcasecmp</span><span class="p">,</span> <span class="nb">true</span><span class="p">)</span>
<a name="line-811"></a><span class="n">DECLARE_CHECK_STROP_IMPL</span><span class="p">(</span><span class="n">strcasecmp</span><span class="p">,</span> <span class="nb">false</span><span class="p">)</span>
<a name="line-812"></a><span class="cp">#undef DECLARE_CHECK_STROP_IMPL</span>
<a name="line-813"></a>
<a name="line-814"></a><span class="c1">// Helper macro for string comparisons.</span>
<a name="line-815"></a><span class="c1">// Don&#39;t use this macro directly in your code, use CHECK_STREQ et al below.</span>
<a name="line-816"></a><span class="cp">#define CHECK_STROP(func, op, expected, s1, s2) \</span>
<a name="line-817"></a><span class="cp">  while (google::CheckOpString _result = \</span>
<a name="line-818"></a><span class="cp">         google::Check##func##expected##Impl((s1), (s2), \</span>
<a name="line-819"></a><span class="cp">                                     #s1 &quot; &quot; #op &quot; &quot; #s2)) \</span>
<a name="line-820"></a><span class="cp">    LOG(FATAL) &lt;&lt; *_result.str_</span>
<a name="line-821"></a>
<a name="line-822"></a>
<a name="line-823"></a><span class="c1">// String (char*) equality/inequality checks.</span>
<a name="line-824"></a><span class="c1">// CASE versions are case-insensitive.</span>
<a name="line-825"></a><span class="c1">//</span>
<a name="line-826"></a><span class="c1">// Note that &quot;s1&quot; and &quot;s2&quot; may be temporary strings which are destroyed</span>
<a name="line-827"></a><span class="c1">// by the compiler at the end of the current &quot;full expression&quot;</span>
<a name="line-828"></a><span class="c1">// (e.g. CHECK_STREQ(Foo().c_str(), Bar().c_str())).</span>
<a name="line-829"></a>
<a name="line-830"></a><span class="cp">#define CHECK_STREQ(s1, s2) CHECK_STROP(strcmp, ==, true, s1, s2)</span>
<a name="line-831"></a><span class="cp">#define CHECK_STRNE(s1, s2) CHECK_STROP(strcmp, !=, false, s1, s2)</span>
<a name="line-832"></a><span class="cp">#define CHECK_STRCASEEQ(s1, s2) CHECK_STROP(strcasecmp, ==, true, s1, s2)</span>
<a name="line-833"></a><span class="cp">#define CHECK_STRCASENE(s1, s2) CHECK_STROP(strcasecmp, !=, false, s1, s2)</span>
<a name="line-834"></a>
<a name="line-835"></a><span class="cp">#define CHECK_INDEX(I,A) CHECK(I &lt; (sizeof(A)/sizeof(A[0])))</span>
<a name="line-836"></a><span class="cp">#define CHECK_BOUND(B,A) CHECK(B &lt;= (sizeof(A)/sizeof(A[0])))</span>
<a name="line-837"></a>
<a name="line-838"></a><span class="cp">#define CHECK_DOUBLE_EQ(val1, val2)              \</span>
<a name="line-839"></a><span class="cp">  do {                                           \</span>
<a name="line-840"></a><span class="cp">    CHECK_LE((val1), (val2)+0.000000000000001L); \</span>
<a name="line-841"></a><span class="cp">    CHECK_GE((val1), (val2)-0.000000000000001L); \</span>
<a name="line-842"></a><span class="cp">  } while (0)</span>
<a name="line-843"></a>
<a name="line-844"></a><span class="cp">#define CHECK_NEAR(val1, val2, margin)           \</span>
<a name="line-845"></a><span class="cp">  do {                                           \</span>
<a name="line-846"></a><span class="cp">    CHECK_LE((val1), (val2)+(margin));           \</span>
<a name="line-847"></a><span class="cp">    CHECK_GE((val1), (val2)-(margin));           \</span>
<a name="line-848"></a><span class="cp">  } while (0)</span>
<a name="line-849"></a>
<a name="line-850"></a><span class="c1">// perror()..googly style!</span>
<a name="line-851"></a><span class="c1">//</span>
<a name="line-852"></a><span class="c1">// PLOG() and PLOG_IF() and PCHECK() behave exactly like their LOG* and</span>
<a name="line-853"></a><span class="c1">// CHECK equivalents with the addition that they postpend a description</span>
<a name="line-854"></a><span class="c1">// of the current state of errno to their output lines.</span>
<a name="line-855"></a>
<a name="line-856"></a><span class="cp">#define PLOG(severity) GOOGLE_PLOG(severity, 0).stream()</span>
<a name="line-857"></a>
<a name="line-858"></a><span class="cp">#define GOOGLE_PLOG(severity, counter)  \</span>
<a name="line-859"></a><span class="cp">  google::ErrnoLogMessage( \</span>
<a name="line-860"></a><span class="cp">      __FILE__, __LINE__, google::GLOG_ ## severity, counter, \</span>
<a name="line-861"></a><span class="cp">      &amp;google::LogMessage::SendToLog)</span>
<a name="line-862"></a>
<a name="line-863"></a><span class="cp">#define PLOG_IF(severity, condition) \</span>
<a name="line-864"></a><span class="cp">  static_cast&lt;void&gt;(0),              \</span>
<a name="line-865"></a><span class="cp">  !(condition) ? (void) 0 : google::LogMessageVoidify() &amp; PLOG(severity)</span>
<a name="line-866"></a>
<a name="line-867"></a><span class="c1">// A CHECK() macro that postpends errno if the condition is false. E.g.</span>
<a name="line-868"></a><span class="c1">//</span>
<a name="line-869"></a><span class="c1">// if (poll(fds, nfds, timeout) == -1) { PCHECK(errno == EINTR); ... }</span>
<a name="line-870"></a><span class="cp">#define PCHECK(condition)  \</span>
<a name="line-871"></a><span class="cp">      PLOG_IF(FATAL, GOOGLE_PREDICT_BRANCH_NOT_TAKEN(!(condition))) \</span>
<a name="line-872"></a><span class="cp">              &lt;&lt; &quot;Check failed: &quot; #condition &quot; &quot;</span>
<a name="line-873"></a>
<a name="line-874"></a><span class="c1">// A CHECK() macro that lets you assert the success of a function that</span>
<a name="line-875"></a><span class="c1">// returns -1 and sets errno in case of an error. E.g.</span>
<a name="line-876"></a><span class="c1">//</span>
<a name="line-877"></a><span class="c1">// CHECK_ERR(mkdir(path, 0700));</span>
<a name="line-878"></a><span class="c1">//</span>
<a name="line-879"></a><span class="c1">// or</span>
<a name="line-880"></a><span class="c1">//</span>
<a name="line-881"></a><span class="c1">// int fd = open(filename, flags); CHECK_ERR(fd) &lt;&lt; &quot;: open &quot; &lt;&lt; filename;</span>
<a name="line-882"></a><span class="cp">#define CHECK_ERR(invocation)                                          \</span>
<a name="line-883"></a><span class="cp">PLOG_IF(FATAL, GOOGLE_PREDICT_BRANCH_NOT_TAKEN((invocation) == -1))    \</span>
<a name="line-884"></a><span class="cp">        &lt;&lt; #invocation</span>
<a name="line-885"></a>
<a name="line-886"></a><span class="c1">// Use macro expansion to create, for each use of LOG_EVERY_N(), static</span>
<a name="line-887"></a><span class="c1">// variables with the __LINE__ expansion as part of the variable name.</span>
<a name="line-888"></a><span class="cp">#define LOG_EVERY_N_VARNAME(base, line) LOG_EVERY_N_VARNAME_CONCAT(base, line)</span>
<a name="line-889"></a><span class="cp">#define LOG_EVERY_N_VARNAME_CONCAT(base, line) base ## line</span>
<a name="line-890"></a>
<a name="line-891"></a><span class="cp">#define LOG_OCCURRENCES LOG_EVERY_N_VARNAME(occurrences_, __LINE__)</span>
<a name="line-892"></a><span class="cp">#define LOG_OCCURRENCES_MOD_N LOG_EVERY_N_VARNAME(occurrences_mod_n_, __LINE__)</span>
<a name="line-893"></a>
<a name="line-894"></a><span class="cp">#define SOME_KIND_OF_LOG_EVERY_N(severity, n, what_to_do) \</span>
<a name="line-895"></a><span class="cp">  static int LOG_OCCURRENCES = 0, LOG_OCCURRENCES_MOD_N = 0; \</span>
<a name="line-896"></a><span class="cp">  ++LOG_OCCURRENCES; \</span>
<a name="line-897"></a><span class="cp">  if (++LOG_OCCURRENCES_MOD_N &gt; n) LOG_OCCURRENCES_MOD_N -= n; \</span>
<a name="line-898"></a><span class="cp">  if (LOG_OCCURRENCES_MOD_N == 1) \</span>
<a name="line-899"></a><span class="cp">    google::LogMessage( \</span>
<a name="line-900"></a><span class="cp">        __FILE__, __LINE__, google::GLOG_ ## severity, LOG_OCCURRENCES, \</span>
<a name="line-901"></a><span class="cp">        &amp;what_to_do).stream()</span>
<a name="line-902"></a>
<a name="line-903"></a><span class="cp">#define SOME_KIND_OF_LOG_IF_EVERY_N(severity, condition, n, what_to_do) \</span>
<a name="line-904"></a><span class="cp">  static int LOG_OCCURRENCES = 0, LOG_OCCURRENCES_MOD_N = 0; \</span>
<a name="line-905"></a><span class="cp">  ++LOG_OCCURRENCES; \</span>
<a name="line-906"></a><span class="cp">  if (condition &amp;&amp; \</span>
<a name="line-907"></a><span class="cp">      ((LOG_OCCURRENCES_MOD_N=(LOG_OCCURRENCES_MOD_N + 1) % n) == (1 % n))) \</span>
<a name="line-908"></a><span class="cp">    google::LogMessage( \</span>
<a name="line-909"></a><span class="cp">        __FILE__, __LINE__, google::GLOG_ ## severity, LOG_OCCURRENCES, \</span>
<a name="line-910"></a><span class="cp">                 &amp;what_to_do).stream()</span>
<a name="line-911"></a>
<a name="line-912"></a><span class="cp">#define SOME_KIND_OF_PLOG_EVERY_N(severity, n, what_to_do) \</span>
<a name="line-913"></a><span class="cp">  static int LOG_OCCURRENCES = 0, LOG_OCCURRENCES_MOD_N = 0; \</span>
<a name="line-914"></a><span class="cp">  ++LOG_OCCURRENCES; \</span>
<a name="line-915"></a><span class="cp">  if (++LOG_OCCURRENCES_MOD_N &gt; n) LOG_OCCURRENCES_MOD_N -= n; \</span>
<a name="line-916"></a><span class="cp">  if (LOG_OCCURRENCES_MOD_N == 1) \</span>
<a name="line-917"></a><span class="cp">    google::ErrnoLogMessage( \</span>
<a name="line-918"></a><span class="cp">        __FILE__, __LINE__, google::GLOG_ ## severity, LOG_OCCURRENCES, \</span>
<a name="line-919"></a><span class="cp">        &amp;what_to_do).stream()</span>
<a name="line-920"></a>
<a name="line-921"></a><span class="cp">#define SOME_KIND_OF_LOG_FIRST_N(severity, n, what_to_do) \</span>
<a name="line-922"></a><span class="cp">  static int LOG_OCCURRENCES = 0; \</span>
<a name="line-923"></a><span class="cp">  if (LOG_OCCURRENCES &lt;= n) \</span>
<a name="line-924"></a><span class="cp">    ++LOG_OCCURRENCES; \</span>
<a name="line-925"></a><span class="cp">  if (LOG_OCCURRENCES &lt;= n) \</span>
<a name="line-926"></a><span class="cp">    google::LogMessage( \</span>
<a name="line-927"></a><span class="cp">        __FILE__, __LINE__, google::GLOG_ ## severity, LOG_OCCURRENCES, \</span>
<a name="line-928"></a><span class="cp">        &amp;what_to_do).stream()</span>
<a name="line-929"></a>
<a name="line-930"></a><span class="n">namespace</span> <span class="n">glog_internal_namespace_</span> <span class="p">{</span>
<a name="line-931"></a><span class="n">template</span> <span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span>
<a name="line-932"></a><span class="k">struct</span> <span class="n">CompileAssert</span> <span class="p">{</span>
<a name="line-933"></a><span class="p">};</span>
<a name="line-934"></a><span class="k">struct</span> <span class="n">CrashReason</span><span class="p">;</span>
<a name="line-935"></a>
<a name="line-936"></a><span class="c1">// Returns true if FailureSignalHandler is installed.</span>
<a name="line-937"></a><span class="c1">// Needs to be exported since it&#39;s used by the signalhandler_unittest.</span>
<a name="line-938"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="kt">bool</span> <span class="nf">IsFailureSignalHandlerInstalled</span><span class="p">();</span>
<a name="line-939"></a><span class="p">}</span>  <span class="c1">// namespace glog_internal_namespace_</span>
<a name="line-940"></a>
<a name="line-941"></a><span class="cp">#define LOG_EVERY_N(severity, n)                                        \</span>
<a name="line-942"></a><span class="cp">  SOME_KIND_OF_LOG_EVERY_N(severity, (n), google::LogMessage::SendToLog)</span>
<a name="line-943"></a>
<a name="line-944"></a><span class="cp">#define SYSLOG_EVERY_N(severity, n) \</span>
<a name="line-945"></a><span class="cp">  SOME_KIND_OF_LOG_EVERY_N(severity, (n), google::LogMessage::SendToSyslogAndLog)</span>
<a name="line-946"></a>
<a name="line-947"></a><span class="cp">#define PLOG_EVERY_N(severity, n) \</span>
<a name="line-948"></a><span class="cp">  SOME_KIND_OF_PLOG_EVERY_N(severity, (n), google::LogMessage::SendToLog)</span>
<a name="line-949"></a>
<a name="line-950"></a><span class="cp">#define LOG_FIRST_N(severity, n) \</span>
<a name="line-951"></a><span class="cp">  SOME_KIND_OF_LOG_FIRST_N(severity, (n), google::LogMessage::SendToLog)</span>
<a name="line-952"></a>
<a name="line-953"></a><span class="cp">#define LOG_IF_EVERY_N(severity, condition, n) \</span>
<a name="line-954"></a><span class="cp">  SOME_KIND_OF_LOG_IF_EVERY_N(severity, (condition), (n), google::LogMessage::SendToLog)</span>
<a name="line-955"></a>
<a name="line-956"></a><span class="c1">// We want the special COUNTER value available for LOG_EVERY_X()&#39;ed messages</span>
<a name="line-957"></a><span class="k">enum</span> <span class="n">PRIVATE_Counter</span> <span class="p">{</span><span class="n">COUNTER</span><span class="p">};</span>
<a name="line-958"></a>
<a name="line-959"></a><span class="cp">#ifdef GLOG_NO_ABBREVIATED_SEVERITIES</span>
<a name="line-960"></a><span class="c1">// wingdi.h defines ERROR to be 0. When we call LOG(ERROR), it gets</span>
<a name="line-961"></a><span class="c1">// substituted with 0, and it expands to COMPACT_GOOGLE_LOG_0. To allow us</span>
<a name="line-962"></a><span class="c1">// to keep using this syntax, we define this macro to do the same thing</span>
<a name="line-963"></a><span class="c1">// as COMPACT_GOOGLE_LOG_ERROR.</span>
<a name="line-964"></a><span class="cp">#define COMPACT_GOOGLE_LOG_0 COMPACT_GOOGLE_LOG_ERROR</span>
<a name="line-965"></a><span class="cp">#define SYSLOG_0 SYSLOG_ERROR</span>
<a name="line-966"></a><span class="cp">#define LOG_TO_STRING_0 LOG_TO_STRING_ERROR</span>
<a name="line-967"></a><span class="c1">// Needed for LOG_IS_ON(ERROR).</span>
<a name="line-968"></a><span class="k">const</span> <span class="n">LogSeverity</span> <span class="n">GLOG_0</span> <span class="o">=</span> <span class="n">GLOG_ERROR</span><span class="p">;</span>
<a name="line-969"></a><span class="cp">#else</span>
<a name="line-970"></a><span class="c1">// Users may include windows.h after logging.h without</span>
<a name="line-971"></a><span class="c1">// GLOG_NO_ABBREVIATED_SEVERITIES nor WIN32_LEAN_AND_MEAN.</span>
<a name="line-972"></a><span class="c1">// For this case, we cannot detect if ERROR is defined before users</span>
<a name="line-973"></a><span class="c1">// actually use ERROR. Let&#39;s make an undefined symbol to warn users.</span>
<a name="line-974"></a><span class="cp"># define GLOG_ERROR_MSG ERROR_macro_is_defined_Define_GLOG_NO_ABBREVIATED_SEVERITIES_before_including_logging_h_See_the_document_for_detail</span>
<a name="line-975"></a><span class="cp"># define COMPACT_GOOGLE_LOG_0 GLOG_ERROR_MSG</span>
<a name="line-976"></a><span class="cp"># define SYSLOG_0 GLOG_ERROR_MSG</span>
<a name="line-977"></a><span class="cp"># define LOG_TO_STRING_0 GLOG_ERROR_MSG</span>
<a name="line-978"></a><span class="cp"># define GLOG_0 GLOG_ERROR_MSG</span>
<a name="line-979"></a><span class="cp">#endif</span>
<a name="line-980"></a>
<a name="line-981"></a><span class="c1">// Plus some debug-logging macros that get compiled to nothing for production</span>
<a name="line-982"></a>
<a name="line-983"></a><span class="cp">#if DCHECK_IS_ON()</span>
<a name="line-984"></a>
<a name="line-985"></a><span class="cp">#define DLOG(severity) LOG(severity)</span>
<a name="line-986"></a><span class="cp">#define DVLOG(verboselevel) VLOG(verboselevel)</span>
<a name="line-987"></a><span class="cp">#define DLOG_IF(severity, condition) LOG_IF(severity, condition)</span>
<a name="line-988"></a><span class="cp">#define DLOG_EVERY_N(severity, n) LOG_EVERY_N(severity, n)</span>
<a name="line-989"></a><span class="cp">#define DLOG_IF_EVERY_N(severity, condition, n) \</span>
<a name="line-990"></a><span class="cp">  LOG_IF_EVERY_N(severity, condition, n)</span>
<a name="line-991"></a><span class="cp">#define DLOG_ASSERT(condition) LOG_ASSERT(condition)</span>
<a name="line-992"></a>
<a name="line-993"></a><span class="c1">// debug-only checking.  executed if DCHECK_IS_ON().</span>
<a name="line-994"></a><span class="cp">#define DCHECK(condition) CHECK(condition)</span>
<a name="line-995"></a><span class="cp">#define DCHECK_EQ(val1, val2) CHECK_EQ(val1, val2)</span>
<a name="line-996"></a><span class="cp">#define DCHECK_NE(val1, val2) CHECK_NE(val1, val2)</span>
<a name="line-997"></a><span class="cp">#define DCHECK_LE(val1, val2) CHECK_LE(val1, val2)</span>
<a name="line-998"></a><span class="cp">#define DCHECK_LT(val1, val2) CHECK_LT(val1, val2)</span>
<a name="line-999"></a><span class="cp">#define DCHECK_GE(val1, val2) CHECK_GE(val1, val2)</span>
<a name="line-1000"></a><span class="cp">#define DCHECK_GT(val1, val2) CHECK_GT(val1, val2)</span>
<a name="line-1001"></a><span class="cp">#define DCHECK_NOTNULL(val) CHECK_NOTNULL(val)</span>
<a name="line-1002"></a><span class="cp">#define DCHECK_STREQ(str1, str2) CHECK_STREQ(str1, str2)</span>
<a name="line-1003"></a><span class="cp">#define DCHECK_STRCASEEQ(str1, str2) CHECK_STRCASEEQ(str1, str2)</span>
<a name="line-1004"></a><span class="cp">#define DCHECK_STRNE(str1, str2) CHECK_STRNE(str1, str2)</span>
<a name="line-1005"></a><span class="cp">#define DCHECK_STRCASENE(str1, str2) CHECK_STRCASENE(str1, str2)</span>
<a name="line-1006"></a>
<a name="line-1007"></a><span class="cp">#else  </span><span class="c1">// !DCHECK_IS_ON()</span>
<a name="line-1008"></a>
<a name="line-1009"></a><span class="cp">#define DLOG(severity)  \</span>
<a name="line-1010"></a><span class="cp">  static_cast&lt;void&gt;(0), \</span>
<a name="line-1011"></a><span class="cp">  true ? (void) 0 : google::LogMessageVoidify() &amp; LOG(severity)</span>
<a name="line-1012"></a>
<a name="line-1013"></a><span class="cp">#define DVLOG(verboselevel)             \</span>
<a name="line-1014"></a><span class="cp">  static_cast&lt;void&gt;(0),                 \</span>
<a name="line-1015"></a><span class="cp">  (true || !VLOG_IS_ON(verboselevel)) ? \</span>
<a name="line-1016"></a><span class="cp">      (void) 0 : google::LogMessageVoidify() &amp; LOG(INFO)</span>
<a name="line-1017"></a>
<a name="line-1018"></a><span class="cp">#define DLOG_IF(severity, condition) \</span>
<a name="line-1019"></a><span class="cp">  static_cast&lt;void&gt;(0),              \</span>
<a name="line-1020"></a><span class="cp">  (true || !(condition)) ? (void) 0 : google::LogMessageVoidify() &amp; LOG(severity)</span>
<a name="line-1021"></a>
<a name="line-1022"></a><span class="cp">#define DLOG_EVERY_N(severity, n) \</span>
<a name="line-1023"></a><span class="cp">  static_cast&lt;void&gt;(0),           \</span>
<a name="line-1024"></a><span class="cp">  true ? (void) 0 : google::LogMessageVoidify() &amp; LOG(severity)</span>
<a name="line-1025"></a>
<a name="line-1026"></a><span class="cp">#define DLOG_IF_EVERY_N(severity, condition, n) \</span>
<a name="line-1027"></a><span class="cp">  static_cast&lt;void&gt;(0),                         \</span>
<a name="line-1028"></a><span class="cp">  (true || !(condition))? (void) 0 : google::LogMessageVoidify() &amp; LOG(severity)</span>
<a name="line-1029"></a>
<a name="line-1030"></a><span class="cp">#define DLOG_ASSERT(condition) \</span>
<a name="line-1031"></a><span class="cp">  static_cast&lt;void&gt;(0),        \</span>
<a name="line-1032"></a><span class="cp">  true ? (void) 0 : LOG_ASSERT(condition)</span>
<a name="line-1033"></a>
<a name="line-1034"></a><span class="c1">// MSVC warning C4127: conditional expression is constant</span>
<a name="line-1035"></a><span class="cp">#define DCHECK(condition) \</span>
<a name="line-1036"></a><span class="cp">  GLOG_MSVC_PUSH_DISABLE_WARNING(4127) \</span>
<a name="line-1037"></a><span class="cp">  while (false) \</span>
<a name="line-1038"></a><span class="cp">    GLOG_MSVC_POP_WARNING() CHECK(condition)</span>
<a name="line-1039"></a>
<a name="line-1040"></a><span class="cp">#define DCHECK_EQ(val1, val2) \</span>
<a name="line-1041"></a><span class="cp">  GLOG_MSVC_PUSH_DISABLE_WARNING(4127) \</span>
<a name="line-1042"></a><span class="cp">  while (false) \</span>
<a name="line-1043"></a><span class="cp">    GLOG_MSVC_POP_WARNING() CHECK_EQ(val1, val2)</span>
<a name="line-1044"></a>
<a name="line-1045"></a><span class="cp">#define DCHECK_NE(val1, val2) \</span>
<a name="line-1046"></a><span class="cp">  GLOG_MSVC_PUSH_DISABLE_WARNING(4127) \</span>
<a name="line-1047"></a><span class="cp">  while (false) \</span>
<a name="line-1048"></a><span class="cp">    GLOG_MSVC_POP_WARNING() CHECK_NE(val1, val2)</span>
<a name="line-1049"></a>
<a name="line-1050"></a><span class="cp">#define DCHECK_LE(val1, val2) \</span>
<a name="line-1051"></a><span class="cp">  GLOG_MSVC_PUSH_DISABLE_WARNING(4127) \</span>
<a name="line-1052"></a><span class="cp">  while (false) \</span>
<a name="line-1053"></a><span class="cp">    GLOG_MSVC_POP_WARNING() CHECK_LE(val1, val2)</span>
<a name="line-1054"></a>
<a name="line-1055"></a><span class="cp">#define DCHECK_LT(val1, val2) \</span>
<a name="line-1056"></a><span class="cp">  GLOG_MSVC_PUSH_DISABLE_WARNING(4127) \</span>
<a name="line-1057"></a><span class="cp">  while (false) \</span>
<a name="line-1058"></a><span class="cp">    GLOG_MSVC_POP_WARNING() CHECK_LT(val1, val2)</span>
<a name="line-1059"></a>
<a name="line-1060"></a><span class="cp">#define DCHECK_GE(val1, val2) \</span>
<a name="line-1061"></a><span class="cp">  GLOG_MSVC_PUSH_DISABLE_WARNING(4127) \</span>
<a name="line-1062"></a><span class="cp">  while (false) \</span>
<a name="line-1063"></a><span class="cp">    GLOG_MSVC_POP_WARNING() CHECK_GE(val1, val2)</span>
<a name="line-1064"></a>
<a name="line-1065"></a><span class="cp">#define DCHECK_GT(val1, val2) \</span>
<a name="line-1066"></a><span class="cp">  GLOG_MSVC_PUSH_DISABLE_WARNING(4127) \</span>
<a name="line-1067"></a><span class="cp">  while (false) \</span>
<a name="line-1068"></a><span class="cp">    GLOG_MSVC_POP_WARNING() CHECK_GT(val1, val2)</span>
<a name="line-1069"></a>
<a name="line-1070"></a><span class="c1">// You may see warnings in release mode if you don&#39;t use the return</span>
<a name="line-1071"></a><span class="c1">// value of DCHECK_NOTNULL. Please just use DCHECK for such cases.</span>
<a name="line-1072"></a><span class="cp">#define DCHECK_NOTNULL(val) (val)</span>
<a name="line-1073"></a>
<a name="line-1074"></a><span class="cp">#define DCHECK_STREQ(str1, str2) \</span>
<a name="line-1075"></a><span class="cp">  GLOG_MSVC_PUSH_DISABLE_WARNING(4127) \</span>
<a name="line-1076"></a><span class="cp">  while (false) \</span>
<a name="line-1077"></a><span class="cp">    GLOG_MSVC_POP_WARNING() CHECK_STREQ(str1, str2)</span>
<a name="line-1078"></a>
<a name="line-1079"></a><span class="cp">#define DCHECK_STRCASEEQ(str1, str2) \</span>
<a name="line-1080"></a><span class="cp">  GLOG_MSVC_PUSH_DISABLE_WARNING(4127) \</span>
<a name="line-1081"></a><span class="cp">  while (false) \</span>
<a name="line-1082"></a><span class="cp">    GLOG_MSVC_POP_WARNING() CHECK_STRCASEEQ(str1, str2)</span>
<a name="line-1083"></a>
<a name="line-1084"></a><span class="cp">#define DCHECK_STRNE(str1, str2) \</span>
<a name="line-1085"></a><span class="cp">  GLOG_MSVC_PUSH_DISABLE_WARNING(4127) \</span>
<a name="line-1086"></a><span class="cp">  while (false) \</span>
<a name="line-1087"></a><span class="cp">    GLOG_MSVC_POP_WARNING() CHECK_STRNE(str1, str2)</span>
<a name="line-1088"></a>
<a name="line-1089"></a><span class="cp">#define DCHECK_STRCASENE(str1, str2) \</span>
<a name="line-1090"></a><span class="cp">  GLOG_MSVC_PUSH_DISABLE_WARNING(4127) \</span>
<a name="line-1091"></a><span class="cp">  while (false) \</span>
<a name="line-1092"></a><span class="cp">    GLOG_MSVC_POP_WARNING() CHECK_STRCASENE(str1, str2)</span>
<a name="line-1093"></a>
<a name="line-1094"></a><span class="cp">#endif  </span><span class="c1">// DCHECK_IS_ON()</span>
<a name="line-1095"></a>
<a name="line-1096"></a><span class="c1">// Log only in verbose mode.</span>
<a name="line-1097"></a>
<a name="line-1098"></a><span class="cp">#define VLOG(verboselevel) LOG_IF(INFO, VLOG_IS_ON(verboselevel))</span>
<a name="line-1099"></a>
<a name="line-1100"></a><span class="cp">#define VLOG_IF(verboselevel, condition) \</span>
<a name="line-1101"></a><span class="cp">  LOG_IF(INFO, (condition) &amp;&amp; VLOG_IS_ON(verboselevel))</span>
<a name="line-1102"></a>
<a name="line-1103"></a><span class="cp">#define VLOG_EVERY_N(verboselevel, n) \</span>
<a name="line-1104"></a><span class="cp">  LOG_IF_EVERY_N(INFO, VLOG_IS_ON(verboselevel), n)</span>
<a name="line-1105"></a>
<a name="line-1106"></a><span class="cp">#define VLOG_IF_EVERY_N(verboselevel, condition, n) \</span>
<a name="line-1107"></a><span class="cp">  LOG_IF_EVERY_N(INFO, (condition) &amp;&amp; VLOG_IS_ON(verboselevel), n)</span>
<a name="line-1108"></a>
<a name="line-1109"></a><span class="n">namespace</span> <span class="n">base_logging</span> <span class="p">{</span>
<a name="line-1110"></a>
<a name="line-1111"></a><span class="c1">// LogMessage::LogStream is a std::ostream backed by this streambuf.</span>
<a name="line-1112"></a><span class="c1">// This class ignores overflow and leaves two bytes at the end of the</span>
<a name="line-1113"></a><span class="c1">// buffer to allow for a &#39;\n&#39; and &#39;\0&#39;.</span>
<a name="line-1114"></a><span class="n">class</span> <span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="nl">LogStreamBuf</span> <span class="p">:</span> <span class="n">public</span> <span class="n">std</span><span class="o">::</span><span class="n">streambuf</span> <span class="p">{</span>
<a name="line-1115"></a> <span class="nl">public</span><span class="p">:</span>
<a name="line-1116"></a>  <span class="c1">// REQUIREMENTS: &quot;len&quot; must be &gt;= 2 to account for the &#39;\n&#39; and &#39;\0&#39;.</span>
<a name="line-1117"></a>  <span class="n">LogStreamBuf</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span> <span class="p">{</span>
<a name="line-1118"></a>    <span class="n">setp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">buf</span> <span class="o">+</span> <span class="n">len</span> <span class="o">-</span> <span class="mi">2</span><span class="p">);</span>
<a name="line-1119"></a>  <span class="p">}</span>
<a name="line-1120"></a>
<a name="line-1121"></a>  <span class="c1">// This effectively ignores overflow.</span>
<a name="line-1122"></a>  <span class="n">virtual</span> <span class="n">int_type</span> <span class="n">overflow</span><span class="p">(</span><span class="n">int_type</span> <span class="n">ch</span><span class="p">)</span> <span class="p">{</span>
<a name="line-1123"></a>    <span class="k">return</span> <span class="n">ch</span><span class="p">;</span>
<a name="line-1124"></a>  <span class="p">}</span>
<a name="line-1125"></a>
<a name="line-1126"></a>  <span class="c1">// Legacy public ostrstream method.</span>
<a name="line-1127"></a>  <span class="kt">size_t</span> <span class="n">pcount</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">pptr</span><span class="p">()</span> <span class="o">-</span> <span class="n">pbase</span><span class="p">();</span> <span class="p">}</span>
<a name="line-1128"></a>  <span class="kt">char</span><span class="o">*</span> <span class="n">pbase</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">streambuf</span><span class="o">::</span><span class="n">pbase</span><span class="p">();</span> <span class="p">}</span>
<a name="line-1129"></a><span class="p">};</span>
<a name="line-1130"></a>
<a name="line-1131"></a><span class="p">}</span>  <span class="c1">// namespace base_logging</span>
<a name="line-1132"></a>
<a name="line-1133"></a><span class="c1">//</span>
<a name="line-1134"></a><span class="c1">// This class more or less represents a particular log message.  You</span>
<a name="line-1135"></a><span class="c1">// create an instance of LogMessage and then stream stuff to it.</span>
<a name="line-1136"></a><span class="c1">// When you finish streaming to it, ~LogMessage is called and the</span>
<a name="line-1137"></a><span class="c1">// full message gets streamed to the appropriate destination.</span>
<a name="line-1138"></a><span class="c1">//</span>
<a name="line-1139"></a><span class="c1">// You shouldn&#39;t actually use LogMessage&#39;s constructor to log things,</span>
<a name="line-1140"></a><span class="c1">// though.  You should use the LOG() macro (and variants thereof)</span>
<a name="line-1141"></a><span class="c1">// above.</span>
<a name="line-1142"></a><span class="n">class</span> <span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="n">LogMessage</span> <span class="p">{</span>
<a name="line-1143"></a><span class="nl">public</span><span class="p">:</span>
<a name="line-1144"></a>  <span class="k">enum</span> <span class="p">{</span>
<a name="line-1145"></a>    <span class="c1">// Passing kNoLogPrefix for the line number disables the</span>
<a name="line-1146"></a>    <span class="c1">// log-message prefix. Useful for using the LogMessage</span>
<a name="line-1147"></a>    <span class="c1">// infrastructure as a printing utility. See also the --log_prefix</span>
<a name="line-1148"></a>    <span class="c1">// flag for controlling the log-message prefix on an</span>
<a name="line-1149"></a>    <span class="c1">// application-wide basis.</span>
<a name="line-1150"></a>    <span class="n">kNoLogPrefix</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<a name="line-1151"></a>  <span class="p">};</span>
<a name="line-1152"></a>
<a name="line-1153"></a>  <span class="c1">// LogStream inherit from non-DLL-exported class (std::ostrstream)</span>
<a name="line-1154"></a>  <span class="c1">// and VC++ produces a warning for this situation.</span>
<a name="line-1155"></a>  <span class="c1">// However, MSDN says &quot;C4275 can be ignored in Microsoft Visual C++</span>
<a name="line-1156"></a>  <span class="c1">// 2005 if you are deriving from a type in the Standard C++ Library&quot;</span>
<a name="line-1157"></a>  <span class="c1">// http://msdn.microsoft.com/en-us/library/3tdb471s(VS.80).aspx</span>
<a name="line-1158"></a>  <span class="c1">// Let&#39;s just ignore the warning.</span>
<a name="line-1159"></a><span class="n">GLOG_MSVC_PUSH_DISABLE_WARNING</span><span class="p">(</span><span class="mi">4275</span><span class="p">)</span>
<a name="line-1160"></a>  <span class="n">class</span> <span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="nl">LogStream</span> <span class="p">:</span> <span class="n">public</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span> <span class="p">{</span>
<a name="line-1161"></a><span class="n">GLOG_MSVC_POP_WARNING</span><span class="p">()</span>
<a name="line-1162"></a>  <span class="nl">public</span><span class="p">:</span>
<a name="line-1163"></a>    <span class="n">LogStream</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ctr</span><span class="p">)</span>
<a name="line-1164"></a>        <span class="o">:</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="p">(</span><span class="nb">NULL</span><span class="p">),</span>
<a name="line-1165"></a>          <span class="n">streambuf_</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">),</span>
<a name="line-1166"></a>          <span class="n">ctr_</span><span class="p">(</span><span class="n">ctr</span><span class="p">),</span>
<a name="line-1167"></a>          <span class="n">self_</span><span class="p">(</span><span class="n">this</span><span class="p">)</span> <span class="p">{</span>
<a name="line-1168"></a>      <span class="n">rdbuf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">streambuf_</span><span class="p">);</span>
<a name="line-1169"></a>    <span class="p">}</span>
<a name="line-1170"></a>
<a name="line-1171"></a>    <span class="kt">int</span> <span class="n">ctr</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">ctr_</span><span class="p">;</span> <span class="p">}</span>
<a name="line-1172"></a>    <span class="kt">void</span> <span class="n">set_ctr</span><span class="p">(</span><span class="kt">int</span> <span class="n">ctr</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctr_</span> <span class="o">=</span> <span class="n">ctr</span><span class="p">;</span> <span class="p">}</span>
<a name="line-1173"></a>    <span class="n">LogStream</span><span class="o">*</span> <span class="n">self</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">self_</span><span class="p">;</span> <span class="p">}</span>
<a name="line-1174"></a>
<a name="line-1175"></a>    <span class="c1">// Legacy std::streambuf methods.</span>
<a name="line-1176"></a>    <span class="kt">size_t</span> <span class="n">pcount</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">streambuf_</span><span class="p">.</span><span class="n">pcount</span><span class="p">();</span> <span class="p">}</span>
<a name="line-1177"></a>    <span class="kt">char</span><span class="o">*</span> <span class="n">pbase</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">streambuf_</span><span class="p">.</span><span class="n">pbase</span><span class="p">();</span> <span class="p">}</span>
<a name="line-1178"></a>    <span class="kt">char</span><span class="o">*</span> <span class="n">str</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">pbase</span><span class="p">();</span> <span class="p">}</span>
<a name="line-1179"></a>
<a name="line-1180"></a>  <span class="nl">private</span><span class="p">:</span>
<a name="line-1181"></a>    <span class="n">LogStream</span><span class="p">(</span><span class="k">const</span> <span class="n">LogStream</span><span class="o">&amp;</span><span class="p">);</span>
<a name="line-1182"></a>    <span class="n">LogStream</span><span class="o">&amp;</span> <span class="n">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">LogStream</span><span class="o">&amp;</span><span class="p">);</span>
<a name="line-1183"></a>    <span class="n">base_logging</span><span class="o">::</span><span class="n">LogStreamBuf</span> <span class="n">streambuf_</span><span class="p">;</span>
<a name="line-1184"></a>    <span class="kt">int</span> <span class="n">ctr_</span><span class="p">;</span>  <span class="c1">// Counter hack (for the LOG_EVERY_X() macro)</span>
<a name="line-1185"></a>    <span class="n">LogStream</span> <span class="o">*</span><span class="n">self_</span><span class="p">;</span>  <span class="c1">// Consistency check hack</span>
<a name="line-1186"></a>  <span class="p">};</span>
<a name="line-1187"></a>
<a name="line-1188"></a><span class="nl">public</span><span class="p">:</span>
<a name="line-1189"></a>  <span class="c1">// icc 8 requires this typedef to avoid an internal compiler error.</span>
<a name="line-1190"></a>  <span class="k">typedef</span> <span class="kt">void</span> <span class="p">(</span><span class="n">LogMessage</span><span class="o">::*</span><span class="n">SendMethod</span><span class="p">)();</span>
<a name="line-1191"></a>
<a name="line-1192"></a>  <span class="n">LogMessage</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span> <span class="n">LogSeverity</span> <span class="n">severity</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ctr</span><span class="p">,</span>
<a name="line-1193"></a>             <span class="n">SendMethod</span> <span class="n">send_method</span><span class="p">);</span>
<a name="line-1194"></a>
<a name="line-1195"></a>  <span class="c1">// Two special constructors that generate reduced amounts of code at</span>
<a name="line-1196"></a>  <span class="c1">// LOG call sites for common cases.</span>
<a name="line-1197"></a>
<a name="line-1198"></a>  <span class="c1">// Used for LOG(INFO): Implied are:</span>
<a name="line-1199"></a>  <span class="c1">// severity = INFO, ctr = 0, send_method = &amp;LogMessage::SendToLog.</span>
<a name="line-1200"></a>  <span class="c1">//</span>
<a name="line-1201"></a>  <span class="c1">// Using this constructor instead of the more complex constructor above</span>
<a name="line-1202"></a>  <span class="c1">// saves 19 bytes per call site.</span>
<a name="line-1203"></a>  <span class="n">LogMessage</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">);</span>
<a name="line-1204"></a>
<a name="line-1205"></a>  <span class="c1">// Used for LOG(severity) where severity != INFO.  Implied</span>
<a name="line-1206"></a>  <span class="c1">// are: ctr = 0, send_method = &amp;LogMessage::SendToLog</span>
<a name="line-1207"></a>  <span class="c1">//</span>
<a name="line-1208"></a>  <span class="c1">// Using this constructor instead of the more complex constructor above</span>
<a name="line-1209"></a>  <span class="c1">// saves 17 bytes per call site.</span>
<a name="line-1210"></a>  <span class="n">LogMessage</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span> <span class="n">LogSeverity</span> <span class="n">severity</span><span class="p">);</span>
<a name="line-1211"></a>
<a name="line-1212"></a>  <span class="c1">// Constructor to log this message to a specified sink (if not NULL).</span>
<a name="line-1213"></a>  <span class="c1">// Implied are: ctr = 0, send_method = &amp;LogMessage::SendToSinkAndLog if</span>
<a name="line-1214"></a>  <span class="c1">// also_send_to_log is true, send_method = &amp;LogMessage::SendToSink otherwise.</span>
<a name="line-1215"></a>  <span class="n">LogMessage</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span> <span class="n">LogSeverity</span> <span class="n">severity</span><span class="p">,</span> <span class="n">LogSink</span><span class="o">*</span> <span class="n">sink</span><span class="p">,</span>
<a name="line-1216"></a>             <span class="kt">bool</span> <span class="n">also_send_to_log</span><span class="p">);</span>
<a name="line-1217"></a>
<a name="line-1218"></a>  <span class="c1">// Constructor where we also give a vector&lt;string&gt; pointer</span>
<a name="line-1219"></a>  <span class="c1">// for storing the messages (if the pointer is not NULL).</span>
<a name="line-1220"></a>  <span class="c1">// Implied are: ctr = 0, send_method = &amp;LogMessage::SaveOrSendToLog.</span>
<a name="line-1221"></a>  <span class="n">LogMessage</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span> <span class="n">LogSeverity</span> <span class="n">severity</span><span class="p">,</span>
<a name="line-1222"></a>             <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;*</span> <span class="n">outvec</span><span class="p">);</span>
<a name="line-1223"></a>
<a name="line-1224"></a>  <span class="c1">// Constructor where we also give a string pointer for storing the</span>
<a name="line-1225"></a>  <span class="c1">// message (if the pointer is not NULL).  Implied are: ctr = 0,</span>
<a name="line-1226"></a>  <span class="c1">// send_method = &amp;LogMessage::WriteToStringAndLog.</span>
<a name="line-1227"></a>  <span class="n">LogMessage</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span> <span class="n">LogSeverity</span> <span class="n">severity</span><span class="p">,</span>
<a name="line-1228"></a>             <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">*</span> <span class="n">message</span><span class="p">);</span>
<a name="line-1229"></a>
<a name="line-1230"></a>  <span class="c1">// A special constructor used for check failures</span>
<a name="line-1231"></a>  <span class="n">LogMessage</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span> <span class="k">const</span> <span class="n">CheckOpString</span><span class="o">&amp;</span> <span class="n">result</span><span class="p">);</span>
<a name="line-1232"></a>
<a name="line-1233"></a>  <span class="o">~</span><span class="n">LogMessage</span><span class="p">();</span>
<a name="line-1234"></a>
<a name="line-1235"></a>  <span class="c1">// Flush a buffered message to the sink set in the constructor.  Always</span>
<a name="line-1236"></a>  <span class="c1">// called by the destructor, it may also be called from elsewhere if</span>
<a name="line-1237"></a>  <span class="c1">// needed.  Only the first call is actioned; any later ones are ignored.</span>
<a name="line-1238"></a>  <span class="kt">void</span> <span class="nf">Flush</span><span class="p">();</span>
<a name="line-1239"></a>
<a name="line-1240"></a>  <span class="c1">// An arbitrary limit on the length of a single log message.  This</span>
<a name="line-1241"></a>  <span class="c1">// is so that streaming can be done more efficiently.</span>
<a name="line-1242"></a>  <span class="k">static</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">kMaxLogMessageLen</span><span class="p">;</span>
<a name="line-1243"></a>
<a name="line-1244"></a>  <span class="c1">// Theses should not be called directly outside of logging.*,</span>
<a name="line-1245"></a>  <span class="c1">// only passed as SendMethod arguments to other LogMessage methods:</span>
<a name="line-1246"></a>  <span class="kt">void</span> <span class="nf">SendToLog</span><span class="p">();</span>  <span class="c1">// Actually dispatch to the logs</span>
<a name="line-1247"></a>  <span class="kt">void</span> <span class="nf">SendToSyslogAndLog</span><span class="p">();</span>  <span class="c1">// Actually dispatch to syslog and the logs</span>
<a name="line-1248"></a>
<a name="line-1249"></a>  <span class="c1">// Call abort() or similar to perform LOG(FATAL) crash.</span>
<a name="line-1250"></a>  <span class="k">static</span> <span class="kt">void</span> <span class="nf">__attribute__</span><span class="p">((</span><span class="n">noreturn</span><span class="p">))</span> <span class="n">Fail</span><span class="p">();</span>
<a name="line-1251"></a>
<a name="line-1252"></a>  <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">stream</span><span class="p">();</span>
<a name="line-1253"></a>
<a name="line-1254"></a>  <span class="kt">int</span> <span class="nf">preserved_errno</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
<a name="line-1255"></a>
<a name="line-1256"></a>  <span class="c1">// Must be called without the log_mutex held.  (L &lt; log_mutex)</span>
<a name="line-1257"></a>  <span class="k">static</span> <span class="n">int64</span> <span class="nf">num_messages</span><span class="p">(</span><span class="kt">int</span> <span class="n">severity</span><span class="p">);</span>
<a name="line-1258"></a>
<a name="line-1259"></a>  <span class="k">struct</span> <span class="n">LogMessageData</span><span class="p">;</span>
<a name="line-1260"></a>
<a name="line-1261"></a><span class="nl">private</span><span class="p">:</span>
<a name="line-1262"></a>  <span class="c1">// Fully internal SendMethod cases:</span>
<a name="line-1263"></a>  <span class="kt">void</span> <span class="n">SendToSinkAndLog</span><span class="p">();</span>  <span class="c1">// Send to sink if provided and dispatch to the logs</span>
<a name="line-1264"></a>  <span class="kt">void</span> <span class="nf">SendToSink</span><span class="p">();</span>  <span class="c1">// Send to sink if provided, do nothing otherwise.</span>
<a name="line-1265"></a>
<a name="line-1266"></a>  <span class="c1">// Write to string if provided and dispatch to the logs.</span>
<a name="line-1267"></a>  <span class="kt">void</span> <span class="nf">WriteToStringAndLog</span><span class="p">();</span>
<a name="line-1268"></a>
<a name="line-1269"></a>  <span class="kt">void</span> <span class="nf">SaveOrSendToLog</span><span class="p">();</span>  <span class="c1">// Save to stringvec if provided, else to logs</span>
<a name="line-1270"></a>
<a name="line-1271"></a>  <span class="kt">void</span> <span class="nf">Init</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span> <span class="n">LogSeverity</span> <span class="n">severity</span><span class="p">,</span>
<a name="line-1272"></a>            <span class="kt">void</span> <span class="p">(</span><span class="n">LogMessage</span><span class="o">::*</span><span class="n">send_method</span><span class="p">)());</span>
<a name="line-1273"></a>
<a name="line-1274"></a>  <span class="c1">// Used to fill in crash information during LOG(FATAL) failures.</span>
<a name="line-1275"></a>  <span class="kt">void</span> <span class="nf">RecordCrashReason</span><span class="p">(</span><span class="n">glog_internal_namespace_</span><span class="o">::</span><span class="n">CrashReason</span><span class="o">*</span> <span class="n">reason</span><span class="p">);</span>
<a name="line-1276"></a>
<a name="line-1277"></a>  <span class="c1">// Counts of messages sent at each priority:</span>
<a name="line-1278"></a>  <span class="k">static</span> <span class="n">int64</span> <span class="n">num_messages_</span><span class="p">[</span><span class="n">NUM_SEVERITIES</span><span class="p">];</span>  <span class="c1">// under log_mutex</span>
<a name="line-1279"></a>
<a name="line-1280"></a>  <span class="c1">// We keep the data in a separate struct so that each instance of</span>
<a name="line-1281"></a>  <span class="c1">// LogMessage uses less stack space.</span>
<a name="line-1282"></a>  <span class="n">LogMessageData</span><span class="o">*</span> <span class="n">allocated_</span><span class="p">;</span>
<a name="line-1283"></a>  <span class="n">LogMessageData</span><span class="o">*</span> <span class="n">data_</span><span class="p">;</span>
<a name="line-1284"></a>
<a name="line-1285"></a>  <span class="n">friend</span> <span class="n">class</span> <span class="n">LogDestination</span><span class="p">;</span>
<a name="line-1286"></a>
<a name="line-1287"></a>  <span class="n">LogMessage</span><span class="p">(</span><span class="k">const</span> <span class="n">LogMessage</span><span class="o">&amp;</span><span class="p">);</span>
<a name="line-1288"></a>  <span class="kt">void</span> <span class="n">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">LogMessage</span><span class="o">&amp;</span><span class="p">);</span>
<a name="line-1289"></a><span class="p">};</span>
<a name="line-1290"></a>
<a name="line-1291"></a><span class="c1">// This class happens to be thread-hostile because all instances share</span>
<a name="line-1292"></a><span class="c1">// a single data buffer, but since it can only be created just before</span>
<a name="line-1293"></a><span class="c1">// the process dies, we don&#39;t worry so much.</span>
<a name="line-1294"></a><span class="n">class</span> <span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="nl">LogMessageFatal</span> <span class="p">:</span> <span class="n">public</span> <span class="n">LogMessage</span> <span class="p">{</span>
<a name="line-1295"></a> <span class="nl">public</span><span class="p">:</span>
<a name="line-1296"></a>  <span class="n">LogMessageFatal</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">);</span>
<a name="line-1297"></a>  <span class="n">LogMessageFatal</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span> <span class="k">const</span> <span class="n">CheckOpString</span><span class="o">&amp;</span> <span class="n">result</span><span class="p">);</span>
<a name="line-1298"></a>  <span class="n">__attribute__</span><span class="p">((</span><span class="n">noreturn</span><span class="p">))</span> <span class="o">~</span><span class="n">LogMessageFatal</span><span class="p">();</span>
<a name="line-1299"></a><span class="p">};</span>
<a name="line-1300"></a>
<a name="line-1301"></a><span class="c1">// A non-macro interface to the log facility; (useful</span>
<a name="line-1302"></a><span class="c1">// when the logging level is not a compile-time constant).</span>
<a name="line-1303"></a><span class="kr">inline</span> <span class="kt">void</span> <span class="nf">LogAtLevel</span><span class="p">(</span><span class="kt">int</span> <span class="k">const</span> <span class="n">severity</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="k">const</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="p">{</span>
<a name="line-1304"></a>  <span class="n">LogMessage</span><span class="p">(</span><span class="n">__FILE__</span><span class="p">,</span> <span class="n">__LINE__</span><span class="p">,</span> <span class="n">severity</span><span class="p">).</span><span class="n">stream</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">msg</span><span class="p">;</span>
<a name="line-1305"></a><span class="p">}</span>
<a name="line-1306"></a>
<a name="line-1307"></a><span class="c1">// A macro alternative of LogAtLevel. New code may want to use this</span>
<a name="line-1308"></a><span class="c1">// version since there are two advantages: 1. this version outputs the</span>
<a name="line-1309"></a><span class="c1">// file name and the line number where this macro is put like other</span>
<a name="line-1310"></a><span class="c1">// LOG macros, 2. this macro can be used as C++ stream.</span>
<a name="line-1311"></a><span class="cp">#define LOG_AT_LEVEL(severity) google::LogMessage(__FILE__, __LINE__, severity).stream()</span>
<a name="line-1312"></a>
<a name="line-1313"></a><span class="c1">// Check if it&#39;s compiled in C++11 mode.</span>
<a name="line-1314"></a><span class="c1">//</span>
<a name="line-1315"></a><span class="c1">// GXX_EXPERIMENTAL_CXX0X is defined by gcc and clang up to at least</span>
<a name="line-1316"></a><span class="c1">// gcc-4.7 and clang-3.1 (2011-12-13).  __cplusplus was defined to 1</span>
<a name="line-1317"></a><span class="c1">// in gcc before 4.7 (Crosstool 16) and clang before 3.1, but is</span>
<a name="line-1318"></a><span class="c1">// defined according to the language version in effect thereafter.</span>
<a name="line-1319"></a><span class="c1">// Microsoft Visual Studio 14 (2015) sets __cplusplus==199711 despite</span>
<a name="line-1320"></a><span class="c1">// reasonably good C++11 support, so we set LANG_CXX for it and</span>
<a name="line-1321"></a><span class="c1">// newer versions (_MSC_VER &gt;= 1900).</span>
<a name="line-1322"></a><span class="cp">#if (defined(__GXX_EXPERIMENTAL_CXX0X__) || __cplusplus &gt;= 201103L || \</span>
<a name="line-1323"></a><span class="cp">     (defined(_MSC_VER) &amp;&amp; _MSC_VER &gt;= 1900))</span>
<a name="line-1324"></a><span class="c1">// Helper for CHECK_NOTNULL().</span>
<a name="line-1325"></a><span class="c1">//</span>
<a name="line-1326"></a><span class="c1">// In C++11, all cases can be handled by a single function. Since the value</span>
<a name="line-1327"></a><span class="c1">// category of the argument is preserved (also for rvalue references),</span>
<a name="line-1328"></a><span class="c1">// member initializer lists like the one below will compile correctly:</span>
<a name="line-1329"></a><span class="c1">//</span>
<a name="line-1330"></a><span class="c1">//   Foo()</span>
<a name="line-1331"></a><span class="c1">//     : x_(CHECK_NOTNULL(MethodReturningUniquePtr())) {}</span>
<a name="line-1332"></a><span class="n">template</span> <span class="o">&lt;</span><span class="kr">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<a name="line-1333"></a><span class="n">T</span> <span class="n">CheckNotNull</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">names</span><span class="p">,</span> <span class="n">T</span><span class="o">&amp;&amp;</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
<a name="line-1334"></a> <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="n">nullptr</span><span class="p">)</span> <span class="p">{</span>
<a name="line-1335"></a>   <span class="n">LogMessageFatal</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">new</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">names</span><span class="p">));</span>
<a name="line-1336"></a> <span class="p">}</span>
<a name="line-1337"></a> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
<a name="line-1338"></a><span class="p">}</span>
<a name="line-1339"></a>
<a name="line-1340"></a><span class="cp">#else</span>
<a name="line-1341"></a>
<a name="line-1342"></a><span class="c1">// A small helper for CHECK_NOTNULL().</span>
<a name="line-1343"></a><span class="n">template</span> <span class="o">&lt;</span><span class="kr">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<a name="line-1344"></a><span class="n">T</span><span class="o">*</span> <span class="n">CheckNotNull</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">names</span><span class="p">,</span> <span class="n">T</span><span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
<a name="line-1345"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
<a name="line-1346"></a>    <span class="n">LogMessageFatal</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">new</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">names</span><span class="p">));</span>
<a name="line-1347"></a>  <span class="p">}</span>
<a name="line-1348"></a>  <span class="k">return</span> <span class="n">t</span><span class="p">;</span>
<a name="line-1349"></a><span class="p">}</span>
<a name="line-1350"></a><span class="cp">#endif</span>
<a name="line-1351"></a>
<a name="line-1352"></a><span class="c1">// Allow folks to put a counter in the LOG_EVERY_X()&#39;ed messages. This</span>
<a name="line-1353"></a><span class="c1">// only works if ostream is a LogStream. If the ostream is not a</span>
<a name="line-1354"></a><span class="c1">// LogStream you&#39;ll get an assert saying as much at runtime.</span>
<a name="line-1355"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">,</span>
<a name="line-1356"></a>                                              <span class="k">const</span> <span class="n">PRIVATE_Counter</span><span class="o">&amp;</span><span class="p">);</span>
<a name="line-1357"></a>
<a name="line-1358"></a>
<a name="line-1359"></a><span class="c1">// Derived class for PLOG*() above.</span>
<a name="line-1360"></a><span class="n">class</span> <span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="nl">ErrnoLogMessage</span> <span class="p">:</span> <span class="n">public</span> <span class="n">LogMessage</span> <span class="p">{</span>
<a name="line-1361"></a> <span class="nl">public</span><span class="p">:</span>
<a name="line-1362"></a>
<a name="line-1363"></a>  <span class="n">ErrnoLogMessage</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span> <span class="n">LogSeverity</span> <span class="n">severity</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ctr</span><span class="p">,</span>
<a name="line-1364"></a>                  <span class="kt">void</span> <span class="p">(</span><span class="n">LogMessage</span><span class="o">::*</span><span class="n">send_method</span><span class="p">)());</span>
<a name="line-1365"></a>
<a name="line-1366"></a>  <span class="c1">// Postpends &quot;: strerror(errno) [errno]&quot;.</span>
<a name="line-1367"></a>  <span class="o">~</span><span class="n">ErrnoLogMessage</span><span class="p">();</span>
<a name="line-1368"></a>
<a name="line-1369"></a> <span class="nl">private</span><span class="p">:</span>
<a name="line-1370"></a>  <span class="n">ErrnoLogMessage</span><span class="p">(</span><span class="k">const</span> <span class="n">ErrnoLogMessage</span><span class="o">&amp;</span><span class="p">);</span>
<a name="line-1371"></a>  <span class="kt">void</span> <span class="n">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">ErrnoLogMessage</span><span class="o">&amp;</span><span class="p">);</span>
<a name="line-1372"></a><span class="p">};</span>
<a name="line-1373"></a>
<a name="line-1374"></a>
<a name="line-1375"></a><span class="c1">// This class is used to explicitly ignore values in the conditional</span>
<a name="line-1376"></a><span class="c1">// logging macros.  This avoids compiler warnings like &quot;value computed</span>
<a name="line-1377"></a><span class="c1">// is not used&quot; and &quot;statement has no effect&quot;.</span>
<a name="line-1378"></a>
<a name="line-1379"></a><span class="n">class</span> <span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="n">LogMessageVoidify</span> <span class="p">{</span>
<a name="line-1380"></a> <span class="nl">public</span><span class="p">:</span>
<a name="line-1381"></a>  <span class="n">LogMessageVoidify</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
<a name="line-1382"></a>  <span class="c1">// This has to be an operator with a precedence lower than &lt;&lt; but</span>
<a name="line-1383"></a>  <span class="c1">// higher than ?:</span>
<a name="line-1384"></a>  <span class="kt">void</span> <span class="n">operator</span><span class="o">&amp;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<a name="line-1385"></a><span class="p">};</span>
<a name="line-1386"></a>
<a name="line-1387"></a>
<a name="line-1388"></a><span class="c1">// Flushes all log files that contains messages that are at least of</span>
<a name="line-1389"></a><span class="c1">// the specified severity level.  Thread-safe.</span>
<a name="line-1390"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="kt">void</span> <span class="nf">FlushLogFiles</span><span class="p">(</span><span class="n">LogSeverity</span> <span class="n">min_severity</span><span class="p">);</span>
<a name="line-1391"></a>
<a name="line-1392"></a><span class="c1">// Flushes all log files that contains messages that are at least of</span>
<a name="line-1393"></a><span class="c1">// the specified severity level. Thread-hostile because it ignores</span>
<a name="line-1394"></a><span class="c1">// locking -- used for catastrophic failures.</span>
<a name="line-1395"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="kt">void</span> <span class="nf">FlushLogFilesUnsafe</span><span class="p">(</span><span class="n">LogSeverity</span> <span class="n">min_severity</span><span class="p">);</span>
<a name="line-1396"></a>
<a name="line-1397"></a><span class="c1">//</span>
<a name="line-1398"></a><span class="c1">// Set the destination to which a particular severity level of log</span>
<a name="line-1399"></a><span class="c1">// messages is sent.  If base_filename is &quot;&quot;, it means &quot;don&#39;t log this</span>
<a name="line-1400"></a><span class="c1">// severity&quot;.  Thread-safe.</span>
<a name="line-1401"></a><span class="c1">//</span>
<a name="line-1402"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="kt">void</span> <span class="nf">SetLogDestination</span><span class="p">(</span><span class="n">LogSeverity</span> <span class="n">severity</span><span class="p">,</span>
<a name="line-1403"></a>                                            <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">base_filename</span><span class="p">);</span>
<a name="line-1404"></a>
<a name="line-1405"></a><span class="c1">//</span>
<a name="line-1406"></a><span class="c1">// Set the basename of the symlink to the latest log file at a given</span>
<a name="line-1407"></a><span class="c1">// severity.  If symlink_basename is empty, do not make a symlink.  If</span>
<a name="line-1408"></a><span class="c1">// you don&#39;t call this function, the symlink basename is the</span>
<a name="line-1409"></a><span class="c1">// invocation name of the program.  Thread-safe.</span>
<a name="line-1410"></a><span class="c1">//</span>
<a name="line-1411"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="kt">void</span> <span class="nf">SetLogSymlink</span><span class="p">(</span><span class="n">LogSeverity</span> <span class="n">severity</span><span class="p">,</span>
<a name="line-1412"></a>                                        <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">symlink_basename</span><span class="p">);</span>
<a name="line-1413"></a>
<a name="line-1414"></a><span class="c1">//</span>
<a name="line-1415"></a><span class="c1">// Used to send logs to some other kind of destination</span>
<a name="line-1416"></a><span class="c1">// Users should subclass LogSink and override send to do whatever they want.</span>
<a name="line-1417"></a><span class="c1">// Implementations must be thread-safe because a shared instance will</span>
<a name="line-1418"></a><span class="c1">// be called from whichever thread ran the LOG(XXX) line.</span>
<a name="line-1419"></a><span class="n">class</span> <span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="n">LogSink</span> <span class="p">{</span>
<a name="line-1420"></a> <span class="nl">public</span><span class="p">:</span>
<a name="line-1421"></a>  <span class="n">virtual</span> <span class="o">~</span><span class="n">LogSink</span><span class="p">();</span>
<a name="line-1422"></a>
<a name="line-1423"></a>  <span class="c1">// Sink&#39;s logging logic (message_len is such as to exclude &#39;\n&#39; at the end).</span>
<a name="line-1424"></a>  <span class="c1">// This method can&#39;t use LOG() or CHECK() as logging system mutex(s) are held</span>
<a name="line-1425"></a>  <span class="c1">// during this call.</span>
<a name="line-1426"></a>  <span class="n">virtual</span> <span class="kt">void</span> <span class="nf">send</span><span class="p">(</span><span class="n">LogSeverity</span> <span class="n">severity</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">full_filename</span><span class="p">,</span>
<a name="line-1427"></a>                    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">base_filename</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span>
<a name="line-1428"></a>                    <span class="k">const</span> <span class="k">struct</span> <span class="o">::</span><span class="n">tm</span><span class="o">*</span> <span class="n">tm_time</span><span class="p">,</span>
<a name="line-1429"></a>                    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">message</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">message_len</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="line-1430"></a>
<a name="line-1431"></a>  <span class="c1">// Redefine this to implement waiting for</span>
<a name="line-1432"></a>  <span class="c1">// the sink&#39;s logging logic to complete.</span>
<a name="line-1433"></a>  <span class="c1">// It will be called after each send() returns,</span>
<a name="line-1434"></a>  <span class="c1">// but before that LogMessage exits or crashes.</span>
<a name="line-1435"></a>  <span class="c1">// By default this function does nothing.</span>
<a name="line-1436"></a>  <span class="c1">// Using this function one can implement complex logic for send()</span>
<a name="line-1437"></a>  <span class="c1">// that itself involves logging; and do all this w/o causing deadlocks and</span>
<a name="line-1438"></a>  <span class="c1">// inconsistent rearrangement of log messages.</span>
<a name="line-1439"></a>  <span class="c1">// E.g. if a LogSink has thread-specific actions, the send() method</span>
<a name="line-1440"></a>  <span class="c1">// can simply add the message to a queue and wake up another thread that</span>
<a name="line-1441"></a>  <span class="c1">// handles real logging while itself making some LOG() calls;</span>
<a name="line-1442"></a>  <span class="c1">// WaitTillSent() can be implemented to wait for that logic to complete.</span>
<a name="line-1443"></a>  <span class="c1">// See our unittest for an example.</span>
<a name="line-1444"></a>  <span class="n">virtual</span> <span class="kt">void</span> <span class="nf">WaitTillSent</span><span class="p">();</span>
<a name="line-1445"></a>
<a name="line-1446"></a>  <span class="c1">// Returns the normal text output of the log message.</span>
<a name="line-1447"></a>  <span class="c1">// Can be useful to implement send().</span>
<a name="line-1448"></a>  <span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">ToString</span><span class="p">(</span><span class="n">LogSeverity</span> <span class="n">severity</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span>
<a name="line-1449"></a>                              <span class="k">const</span> <span class="k">struct</span> <span class="o">::</span><span class="n">tm</span><span class="o">*</span> <span class="n">tm_time</span><span class="p">,</span>
<a name="line-1450"></a>                              <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">message</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">message_len</span><span class="p">);</span>
<a name="line-1451"></a><span class="p">};</span>
<a name="line-1452"></a>
<a name="line-1453"></a><span class="c1">// Add or remove a LogSink as a consumer of logging data.  Thread-safe.</span>
<a name="line-1454"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="kt">void</span> <span class="nf">AddLogSink</span><span class="p">(</span><span class="n">LogSink</span> <span class="o">*</span><span class="n">destination</span><span class="p">);</span>
<a name="line-1455"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="kt">void</span> <span class="nf">RemoveLogSink</span><span class="p">(</span><span class="n">LogSink</span> <span class="o">*</span><span class="n">destination</span><span class="p">);</span>
<a name="line-1456"></a>
<a name="line-1457"></a><span class="c1">//</span>
<a name="line-1458"></a><span class="c1">// Specify an &quot;extension&quot; added to the filename specified via</span>
<a name="line-1459"></a><span class="c1">// SetLogDestination.  This applies to all severity levels.  It&#39;s</span>
<a name="line-1460"></a><span class="c1">// often used to append the port we&#39;re listening on to the logfile</span>
<a name="line-1461"></a><span class="c1">// name.  Thread-safe.</span>
<a name="line-1462"></a><span class="c1">//</span>
<a name="line-1463"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="kt">void</span> <span class="nf">SetLogFilenameExtension</span><span class="p">(</span>
<a name="line-1464"></a>    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">filename_extension</span><span class="p">);</span>
<a name="line-1465"></a>
<a name="line-1466"></a><span class="c1">//</span>
<a name="line-1467"></a><span class="c1">// Make it so that all log messages of at least a particular severity</span>
<a name="line-1468"></a><span class="c1">// are logged to stderr (in addition to logging to the usual log</span>
<a name="line-1469"></a><span class="c1">// file(s)).  Thread-safe.</span>
<a name="line-1470"></a><span class="c1">//</span>
<a name="line-1471"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="kt">void</span> <span class="nf">SetStderrLogging</span><span class="p">(</span><span class="n">LogSeverity</span> <span class="n">min_severity</span><span class="p">);</span>
<a name="line-1472"></a>
<a name="line-1473"></a><span class="c1">//</span>
<a name="line-1474"></a><span class="c1">// Make it so that all log messages go only to stderr.  Thread-safe.</span>
<a name="line-1475"></a><span class="c1">//</span>
<a name="line-1476"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="kt">void</span> <span class="nf">LogToStderr</span><span class="p">();</span>
<a name="line-1477"></a>
<a name="line-1478"></a><span class="c1">//</span>
<a name="line-1479"></a><span class="c1">// Make it so that all log messages of at least a particular severity are</span>
<a name="line-1480"></a><span class="c1">// logged via email to a list of addresses (in addition to logging to the</span>
<a name="line-1481"></a><span class="c1">// usual log file(s)).  The list of addresses is just a string containing</span>
<a name="line-1482"></a><span class="c1">// the email addresses to send to (separated by spaces, say).  Thread-safe.</span>
<a name="line-1483"></a><span class="c1">//</span>
<a name="line-1484"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="kt">void</span> <span class="nf">SetEmailLogging</span><span class="p">(</span><span class="n">LogSeverity</span> <span class="n">min_severity</span><span class="p">,</span>
<a name="line-1485"></a>                                          <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">addresses</span><span class="p">);</span>
<a name="line-1486"></a>
<a name="line-1487"></a><span class="c1">// A simple function that sends email. dest is a commma-separated</span>
<a name="line-1488"></a><span class="c1">// list of addressess.  Thread-safe.</span>
<a name="line-1489"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="kt">bool</span> <span class="nf">SendEmail</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span>
<a name="line-1490"></a>                                    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">subject</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">body</span><span class="p">);</span>
<a name="line-1491"></a>
<a name="line-1492"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&amp;</span> <span class="n">GetLoggingDirectories</span><span class="p">();</span>
<a name="line-1493"></a>
<a name="line-1494"></a><span class="c1">// For tests only:  Clear the internal [cached] list of logging directories to</span>
<a name="line-1495"></a><span class="c1">// force a refresh the next time GetLoggingDirectories is called.</span>
<a name="line-1496"></a><span class="c1">// Thread-hostile.</span>
<a name="line-1497"></a><span class="kt">void</span> <span class="nf">TestOnly_ClearLoggingDirectoriesList</span><span class="p">();</span>
<a name="line-1498"></a>
<a name="line-1499"></a><span class="c1">// Returns a set of existing temporary directories, which will be a</span>
<a name="line-1500"></a><span class="c1">// subset of the directories returned by GetLogginDirectories().</span>
<a name="line-1501"></a><span class="c1">// Thread-safe.</span>
<a name="line-1502"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="kt">void</span> <span class="nf">GetExistingTempDirectories</span><span class="p">(</span>
<a name="line-1503"></a>    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;*</span> <span class="n">list</span><span class="p">);</span>
<a name="line-1504"></a>
<a name="line-1505"></a><span class="c1">// Print any fatal message again -- useful to call from signal handler</span>
<a name="line-1506"></a><span class="c1">// so that the last thing in the output is the fatal message.</span>
<a name="line-1507"></a><span class="c1">// Thread-hostile, but a race is unlikely.</span>
<a name="line-1508"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="kt">void</span> <span class="nf">ReprintFatalMessage</span><span class="p">();</span>
<a name="line-1509"></a>
<a name="line-1510"></a><span class="c1">// Truncate a log file that may be the append-only output of multiple</span>
<a name="line-1511"></a><span class="c1">// processes and hence can&#39;t simply be renamed/reopened (typically a</span>
<a name="line-1512"></a><span class="c1">// stdout/stderr).  If the file &quot;path&quot; is &gt; &quot;limit&quot; bytes, copy the</span>
<a name="line-1513"></a><span class="c1">// last &quot;keep&quot; bytes to offset 0 and truncate the rest. Since we could</span>
<a name="line-1514"></a><span class="c1">// be racing with other writers, this approach has the potential to</span>
<a name="line-1515"></a><span class="c1">// lose very small amounts of data. For security, only follow symlinks</span>
<a name="line-1516"></a><span class="c1">// if the path is /proc/self/fd/*</span>
<a name="line-1517"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="kt">void</span> <span class="nf">TruncateLogFile</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span>
<a name="line-1518"></a>                                          <span class="n">int64</span> <span class="n">limit</span><span class="p">,</span> <span class="n">int64</span> <span class="n">keep</span><span class="p">);</span>
<a name="line-1519"></a>
<a name="line-1520"></a><span class="c1">// Truncate stdout and stderr if they are over the value specified by</span>
<a name="line-1521"></a><span class="c1">// --max_log_size; keep the final 1MB.  This function has the same</span>
<a name="line-1522"></a><span class="c1">// race condition as TruncateLogFile.</span>
<a name="line-1523"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="kt">void</span> <span class="nf">TruncateStdoutStderr</span><span class="p">();</span>
<a name="line-1524"></a>
<a name="line-1525"></a><span class="c1">// Return the string representation of the provided LogSeverity level.</span>
<a name="line-1526"></a><span class="c1">// Thread-safe.</span>
<a name="line-1527"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="nf">GetLogSeverityName</span><span class="p">(</span><span class="n">LogSeverity</span> <span class="n">severity</span><span class="p">);</span>
<a name="line-1528"></a>
<a name="line-1529"></a><span class="c1">// ---------------------------------------------------------------------</span>
<a name="line-1530"></a><span class="c1">// Implementation details that are not useful to most clients</span>
<a name="line-1531"></a><span class="c1">// ---------------------------------------------------------------------</span>
<a name="line-1532"></a>
<a name="line-1533"></a><span class="c1">// A Logger is the interface used by logging modules to emit entries</span>
<a name="line-1534"></a><span class="c1">// to a log.  A typical implementation will dump formatted data to a</span>
<a name="line-1535"></a><span class="c1">// sequence of files.  We also provide interfaces that will forward</span>
<a name="line-1536"></a><span class="c1">// the data to another thread so that the invoker never blocks.</span>
<a name="line-1537"></a><span class="c1">// Implementations should be thread-safe since the logging system</span>
<a name="line-1538"></a><span class="c1">// will write to them from multiple threads.</span>
<a name="line-1539"></a>
<a name="line-1540"></a><span class="n">namespace</span> <span class="n">base</span> <span class="p">{</span>
<a name="line-1541"></a>
<a name="line-1542"></a><span class="n">class</span> <span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="n">Logger</span> <span class="p">{</span>
<a name="line-1543"></a> <span class="nl">public</span><span class="p">:</span>
<a name="line-1544"></a>  <span class="n">virtual</span> <span class="o">~</span><span class="n">Logger</span><span class="p">();</span>
<a name="line-1545"></a>
<a name="line-1546"></a>  <span class="c1">// Writes &quot;message[0,message_len-1]&quot; corresponding to an event that</span>
<a name="line-1547"></a>  <span class="c1">// occurred at &quot;timestamp&quot;.  If &quot;force_flush&quot; is true, the log file</span>
<a name="line-1548"></a>  <span class="c1">// is flushed immediately.</span>
<a name="line-1549"></a>  <span class="c1">//</span>
<a name="line-1550"></a>  <span class="c1">// The input message has already been formatted as deemed</span>
<a name="line-1551"></a>  <span class="c1">// appropriate by the higher level logging facility.  For example,</span>
<a name="line-1552"></a>  <span class="c1">// textual log messages already contain timestamps, and the</span>
<a name="line-1553"></a>  <span class="c1">// file:linenumber header.</span>
<a name="line-1554"></a>  <span class="n">virtual</span> <span class="kt">void</span> <span class="nf">Write</span><span class="p">(</span><span class="kt">bool</span> <span class="n">force_flush</span><span class="p">,</span>
<a name="line-1555"></a>                     <span class="kt">time_t</span> <span class="n">timestamp</span><span class="p">,</span>
<a name="line-1556"></a>                     <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">message</span><span class="p">,</span>
<a name="line-1557"></a>                     <span class="kt">int</span> <span class="n">message_len</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="line-1558"></a>
<a name="line-1559"></a>  <span class="c1">// Flush any buffered messages</span>
<a name="line-1560"></a>  <span class="n">virtual</span> <span class="kt">void</span> <span class="nf">Flush</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="line-1561"></a>
<a name="line-1562"></a>  <span class="c1">// Get the current LOG file size.</span>
<a name="line-1563"></a>  <span class="c1">// The returned value is approximate since some</span>
<a name="line-1564"></a>  <span class="c1">// logged data may not have been flushed to disk yet.</span>
<a name="line-1565"></a>  <span class="n">virtual</span> <span class="n">uint32</span> <span class="nf">LogSize</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="line-1566"></a><span class="p">};</span>
<a name="line-1567"></a>
<a name="line-1568"></a><span class="c1">// Get the logger for the specified severity level.  The logger</span>
<a name="line-1569"></a><span class="c1">// remains the property of the logging module and should not be</span>
<a name="line-1570"></a><span class="c1">// deleted by the caller.  Thread-safe.</span>
<a name="line-1571"></a><span class="k">extern</span> <span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="n">Logger</span><span class="o">*</span> <span class="nf">GetLogger</span><span class="p">(</span><span class="n">LogSeverity</span> <span class="n">level</span><span class="p">);</span>
<a name="line-1572"></a>
<a name="line-1573"></a><span class="c1">// Set the logger for the specified severity level.  The logger</span>
<a name="line-1574"></a><span class="c1">// becomes the property of the logging module and should not</span>
<a name="line-1575"></a><span class="c1">// be deleted by the caller.  Thread-safe.</span>
<a name="line-1576"></a><span class="k">extern</span> <span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="kt">void</span> <span class="nf">SetLogger</span><span class="p">(</span><span class="n">LogSeverity</span> <span class="n">level</span><span class="p">,</span> <span class="n">Logger</span><span class="o">*</span> <span class="n">logger</span><span class="p">);</span>
<a name="line-1577"></a>
<a name="line-1578"></a><span class="p">}</span>
<a name="line-1579"></a>
<a name="line-1580"></a><span class="c1">// glibc has traditionally implemented two incompatible versions of</span>
<a name="line-1581"></a><span class="c1">// strerror_r(). There is a poorly defined convention for picking the</span>
<a name="line-1582"></a><span class="c1">// version that we want, but it is not clear whether it even works with</span>
<a name="line-1583"></a><span class="c1">// all versions of glibc.</span>
<a name="line-1584"></a><span class="c1">// So, instead, we provide this wrapper that automatically detects the</span>
<a name="line-1585"></a><span class="c1">// version that is in use, and then implements POSIX semantics.</span>
<a name="line-1586"></a><span class="c1">// N.B. In addition to what POSIX says, we also guarantee that &quot;buf&quot; will</span>
<a name="line-1587"></a><span class="c1">// be set to an empty string, if this function failed. This means, in most</span>
<a name="line-1588"></a><span class="c1">// cases, you do not need to check the error code and you can directly</span>
<a name="line-1589"></a><span class="c1">// use the value of &quot;buf&quot;. It will never have an undefined value.</span>
<a name="line-1590"></a><span class="c1">// DEPRECATED: Use StrError(int) instead.</span>
<a name="line-1591"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="kt">int</span> <span class="n">posix_strerror_r</span><span class="p">(</span><span class="kt">int</span> <span class="n">err</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">);</span>
<a name="line-1592"></a>
<a name="line-1593"></a><span class="c1">// A thread-safe replacement for strerror(). Returns a string describing the</span>
<a name="line-1594"></a><span class="c1">// given POSIX error code.</span>
<a name="line-1595"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">StrError</span><span class="p">(</span><span class="kt">int</span> <span class="n">err</span><span class="p">);</span>
<a name="line-1596"></a>
<a name="line-1597"></a><span class="c1">// A class for which we define operator&lt;&lt;, which does nothing.</span>
<a name="line-1598"></a><span class="n">class</span> <span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="nl">NullStream</span> <span class="p">:</span> <span class="n">public</span> <span class="n">LogMessage</span><span class="o">::</span><span class="n">LogStream</span> <span class="p">{</span>
<a name="line-1599"></a> <span class="nl">public</span><span class="p">:</span>
<a name="line-1600"></a>  <span class="c1">// Initialize the LogStream so the messages can be written somewhere</span>
<a name="line-1601"></a>  <span class="c1">// (they&#39;ll never be actually displayed). This will be needed if a</span>
<a name="line-1602"></a>  <span class="c1">// NullStream&amp; is implicitly converted to LogStream&amp;, in which case</span>
<a name="line-1603"></a>  <span class="c1">// the overloaded NullStream::operator&lt;&lt; will not be invoked.</span>
<a name="line-1604"></a>  <span class="n">NullStream</span><span class="p">()</span> <span class="o">:</span> <span class="n">LogMessage</span><span class="o">::</span><span class="n">LogStream</span><span class="p">(</span><span class="n">message_buffer_</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<a name="line-1605"></a>  <span class="n">NullStream</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="cm">/*file*/</span><span class="p">,</span> <span class="kt">int</span> <span class="cm">/*line*/</span><span class="p">,</span>
<a name="line-1606"></a>             <span class="k">const</span> <span class="n">CheckOpString</span><span class="o">&amp;</span> <span class="cm">/*result*/</span><span class="p">)</span> <span class="o">:</span>
<a name="line-1607"></a>      <span class="n">LogMessage</span><span class="o">::</span><span class="n">LogStream</span><span class="p">(</span><span class="n">message_buffer_</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<a name="line-1608"></a>  <span class="n">NullStream</span> <span class="o">&amp;</span><span class="n">stream</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="o">*</span><span class="n">this</span><span class="p">;</span> <span class="p">}</span>
<a name="line-1609"></a> <span class="nl">private</span><span class="p">:</span>
<a name="line-1610"></a>  <span class="c1">// A very short buffer for messages (which we discard anyway). This</span>
<a name="line-1611"></a>  <span class="c1">// will be needed if NullStream&amp; converted to LogStream&amp; (e.g. as a</span>
<a name="line-1612"></a>  <span class="c1">// result of a conditional expression).</span>
<a name="line-1613"></a>  <span class="kt">char</span> <span class="n">message_buffer_</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a name="line-1614"></a><span class="p">};</span>
<a name="line-1615"></a>
<a name="line-1616"></a><span class="c1">// Do nothing. This operator is inline, allowing the message to be</span>
<a name="line-1617"></a><span class="c1">// compiled away. The message will not be compiled away if we do</span>
<a name="line-1618"></a><span class="c1">// something like (flag ? LOG(INFO) : LOG(ERROR)) &lt;&lt; message; when</span>
<a name="line-1619"></a><span class="c1">// SKIP_LOG=WARNING. In those cases, NullStream will be implicitly</span>
<a name="line-1620"></a><span class="c1">// converted to LogStream and the message will be computed and then</span>
<a name="line-1621"></a><span class="c1">// quietly discarded.</span>
<a name="line-1622"></a><span class="n">template</span><span class="o">&lt;</span><span class="n">class</span> <span class="n">T</span><span class="o">&gt;</span>
<a name="line-1623"></a><span class="kr">inline</span> <span class="n">NullStream</span><span class="o">&amp;</span> <span class="n">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">NullStream</span> <span class="o">&amp;</span><span class="n">str</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">str</span><span class="p">;</span> <span class="p">}</span>
<a name="line-1624"></a>
<a name="line-1625"></a><span class="c1">// Similar to NullStream, but aborts the program (without stack</span>
<a name="line-1626"></a><span class="c1">// trace), like LogMessageFatal.</span>
<a name="line-1627"></a><span class="n">class</span> <span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="nl">NullStreamFatal</span> <span class="p">:</span> <span class="n">public</span> <span class="n">NullStream</span> <span class="p">{</span>
<a name="line-1628"></a> <span class="nl">public</span><span class="p">:</span>
<a name="line-1629"></a>  <span class="n">NullStreamFatal</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
<a name="line-1630"></a>  <span class="n">NullStreamFatal</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span> <span class="k">const</span> <span class="n">CheckOpString</span><span class="o">&amp;</span> <span class="n">result</span><span class="p">)</span> <span class="o">:</span>
<a name="line-1631"></a>      <span class="n">NullStream</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<a name="line-1632"></a>  <span class="n">__attribute__</span><span class="p">((</span><span class="n">noreturn</span><span class="p">))</span> <span class="o">~</span><span class="n">NullStreamFatal</span><span class="p">()</span> <span class="n">throw</span> <span class="p">()</span> <span class="p">{</span> <span class="n">_exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="p">}</span>
<a name="line-1633"></a><span class="p">};</span>
<a name="line-1634"></a>
<a name="line-1635"></a><span class="c1">// Install a signal handler that will dump signal information and a stack</span>
<a name="line-1636"></a><span class="c1">// trace when the program crashes on certain signals.  We&#39;ll install the</span>
<a name="line-1637"></a><span class="c1">// signal handler for the following signals.</span>
<a name="line-1638"></a><span class="c1">//</span>
<a name="line-1639"></a><span class="c1">// SIGSEGV, SIGILL, SIGFPE, SIGABRT, SIGBUS, and SIGTERM.</span>
<a name="line-1640"></a><span class="c1">//</span>
<a name="line-1641"></a><span class="c1">// By default, the signal handler will write the failure dump to the</span>
<a name="line-1642"></a><span class="c1">// standard error.  You can customize the destination by installing your</span>
<a name="line-1643"></a><span class="c1">// own writer function by InstallFailureWriter() below.</span>
<a name="line-1644"></a><span class="c1">//</span>
<a name="line-1645"></a><span class="c1">// Note on threading:</span>
<a name="line-1646"></a><span class="c1">//</span>
<a name="line-1647"></a><span class="c1">// The function should be called before threads are created, if you want</span>
<a name="line-1648"></a><span class="c1">// to use the failure signal handler for all threads.  The stack trace</span>
<a name="line-1649"></a><span class="c1">// will be shown only for the thread that receives the signal.  In other</span>
<a name="line-1650"></a><span class="c1">// words, stack traces of other threads won&#39;t be shown.</span>
<a name="line-1651"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="kt">void</span> <span class="nf">InstallFailureSignalHandler</span><span class="p">();</span>
<a name="line-1652"></a>
<a name="line-1653"></a><span class="c1">// Installs a function that is used for writing the failure dump.  &quot;data&quot;</span>
<a name="line-1654"></a><span class="c1">// is the pointer to the beginning of a message to be written, and &quot;size&quot;</span>
<a name="line-1655"></a><span class="c1">// is the size of the message.  You should not expect the data is</span>
<a name="line-1656"></a><span class="c1">// terminated with &#39;\0&#39;.</span>
<a name="line-1657"></a><span class="n">GOOGLE_GLOG_DLL_DECL</span> <span class="kt">void</span> <span class="nf">InstallFailureWriter</span><span class="p">(</span>
<a name="line-1658"></a>    <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">writer</span><span class="p">)(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">));</span>
<a name="line-1659"></a>
<a name="line-1660"></a><span class="p">}</span>
<a name="line-1661"></a>
<a name="line-1662"></a><span class="cp">#endif </span><span class="c1">// _LOGGING_H_</span>
</pre></div>
</td></tr></table>
      </div>
      <div id="footer">
        <p>
         Cppcheck 1.90 - a tool for static C/C++ code analysis</br>
         </br>
         Internet: <a href="http://cppcheck.net">http://cppcheck.net</a></br>
         IRC: <a href="irc://irc.freenode.net/cppcheck">irc://irc.freenode.net/cppcheck</a></br>
        </p>
      </div>
  </body>
</html>
