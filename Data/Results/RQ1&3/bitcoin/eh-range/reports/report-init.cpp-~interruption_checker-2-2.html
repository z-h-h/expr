<!doctype html>
<html>
<head>
<title>/usr/local/include/boost/thread/pthread/thread_data.hpp</title>

<style type="text/css">
body { color:#000000; background-color:#ffffff }
body { font-family:Helvetica, sans-serif; font-size:10pt }
h1 { font-size:14pt }
.FileName { margin-top: 5px; margin-bottom: 5px; display: inline; }
.FileNav { margin-left: 5px; margin-right: 5px; display: inline; }
.FileNav a { text-decoration:none; font-size: larger; }
.divider { margin-top: 30px; margin-bottom: 30px; height: 15px; }
.divider { background-color: gray; }
.code { border-collapse:collapse; width:100%; }
.code { font-family: "Monospace", monospace; font-size:10pt }
.code { line-height: 1.2em }
.comment { color: green; font-style: oblique }
.keyword { color: blue }
.string_literal { color: red }
.directive { color: darkmagenta }

/* Macros and variables could have pop-up notes hidden by default.
  - Macro pop-up:    expansion of the macro
  - Variable pop-up: value (table) of the variable */
.macro_popup, .variable_popup { display: none; }

/* Pop-up appears on mouse-hover event. */
.macro:hover .macro_popup, .variable:hover .variable_popup {
  display: block;
  padding: 2px;
  -webkit-border-radius:5px;
  -webkit-box-shadow:1px 1px 7px #000;
  border-radius:5px;
  box-shadow:1px 1px 7px #000;
  position: absolute;
  top: -1em;
  left:10em;
  z-index: 1
}

.macro_popup {
  border: 2px solid red;
  background-color:#FFF0F0;
  font-weight: normal;
}

.variable_popup {
  border: 2px solid blue;
  background-color:#F0F0FF;
  font-weight: bold;
  font-family: Helvetica, sans-serif;
  font-size: 9pt;
}

/* Pop-up notes needs a relative position as a base where they pops up. */
.macro, .variable {
  background-color: PaleGoldenRod;
  position: relative;
}
.macro { color: DarkMagenta; }

#tooltiphint {
  position: fixed;
  width: 50em;
  margin-left: -25em;
  left: 50%;
  padding: 10px;
  border: 1px solid #b0b0b0;
  border-radius: 2px;
  box-shadow: 1px 1px 7px black;
  background-color: #c0c0c0;
  z-index: 2;
}

.num { width:2.5em; padding-right:2ex; background-color:#eeeeee }
.num { text-align:right; font-size:8pt }
.num { color:#444444 }
.line { padding-left: 1ex; border-left: 3px solid #ccc }
.line { white-space: pre }
.msg { -webkit-box-shadow:1px 1px 7px #000 }
.msg { box-shadow:1px 1px 7px #000 }
.msg { -webkit-border-radius:5px }
.msg { border-radius:5px }
.msg { font-family:Helvetica, sans-serif; font-size:8pt }
.msg { float:left }
.msg { padding:0.25em 1ex 0.25em 1ex }
.msg { margin-top:10px; margin-bottom:10px }
.msg { font-weight:bold }
.msg { max-width:60em; word-wrap: break-word; white-space: pre-wrap }
.msgT { padding:0x; spacing:0x }
.msgEvent { background-color:#fff8b4; color:#000000 }
.msgControl { background-color:#bbbbbb; color:#000000 }
.msgNote { background-color:#ddeeff; color:#000000 }
.mrange { background-color:#dfddf3 }
.mrange { border-bottom:1px solid #6F9DBE }
.PathIndex { font-weight: bold; padding:0px 5px; margin-right:5px; }
.PathIndex { -webkit-border-radius:8px }
.PathIndex { border-radius:8px }
.PathIndexEvent { background-color:#bfba87 }
.PathIndexControl { background-color:#8c8c8c }
.PathIndexPopUp { background-color: #879abc; }
.PathNav a { text-decoration:none; font-size: larger }
.CodeInsertionHint { font-weight: bold; background-color: #10dd10 }
.CodeRemovalHint { background-color:#de1010 }
.CodeRemovalHint { border-bottom:1px solid #6F9DBE }
.selected{ background-color:orange !important; }

table.simpletable {
  padding: 5px;
  font-size:12pt;
  margin:20px;
  border-collapse: collapse; border-spacing: 0px;
}
td.rowname {
  text-align: right;
  vertical-align: top;
  font-weight: bold;
  color:#444444;
  padding-right:2ex;
}

/* Hidden text. */
input.spoilerhider + label {
  cursor: pointer;
  text-decoration: underline;
  display: block;
}
input.spoilerhider {
 display: none;
}
input.spoilerhider ~ .spoiler {
  overflow: hidden;
  margin: 10px auto 0;
  height: 0;
  opacity: 0;
}
input.spoilerhider:checked + label + .spoiler{
  height: auto;
  opacity: 1;
}
</style>
</head>
<body>
<!-- BUGDESC Exception being thrown out of destructor -->

<!-- BUGTYPE Throw out of destructor -->

<!-- BUGCATEGORY Exception -->

<!-- BUGFILE /usr/local/include/boost/thread/pthread/thread_data.hpp -->

<!-- FILENAME thread_data.hpp -->

<!-- FUNCTIONNAME ~interruption_checker -->

<!-- ISSUEHASHCONTENTOFLINEINCONTEXT cbed68cc4879d20744c636e7c5797c0d -->

<!-- BUGLINE 244 -->

<!-- BUGCOLUMN 13 -->

<!-- EXCEPTIONAL -->

<!-- BUGPATHLENGTH 58 -->

<!-- BUGMETAEND -->
<!-- REPORTHEADER -->
<h3>Bug Summary [throw at throw_exception.hpp:161:5]</h3>
<table class="simpletable">
<tr><td class="rowname">File:</td><td>/usr/local/include/boost/thread/pthread/thread_data.hpp</td></tr>
<tr><td class="rowname">Warning:</td><td><a href="#EndPath">line 244, column 13</a><br />Exception being thrown out of destructor</td></tr>

</table>
<!-- REPORTSUMMARYEXTRA -->
<h3>Annotated Source Code</h3>
<p>Press <a href="#" onclick="toggleHelp(); return false;">'?'</a>
   to see keyboard shortcuts</p>
<input type="checkbox" class="spoilerhider" id="showinvocation" />
<label for="showinvocation" >Show analyzer invocation</label>
<div class="spoiler">clang -cc1 -cc1 -triple x86_64-unknown-linux-gnu -analyze -disable-free -disable-llvm-verifier -discard-value-names -main-file-name init.cpp -analyzer-store=region -analyzer-opt-analyze-nested-blocks -analyzer-checker=core -analyzer-checker=apiModeling -analyzer-checker=unix -analyzer-checker=deadcode -analyzer-checker=cplusplus -analyzer-checker=security.insecureAPI.UncheckedReturn -analyzer-checker=security.insecureAPI.getpw -analyzer-checker=security.insecureAPI.gets -analyzer-checker=security.insecureAPI.mktemp -analyzer-checker=security.insecureAPI.mkstemp -analyzer-checker=security.insecureAPI.vfork -analyzer-checker=nullability.NullPassedToNonnull -analyzer-checker=nullability.NullReturnedFromNonnull -analyzer-output plist -w -setup-static-analyzer -analyzer-config-compatibility-mode=true -mrelocation-model pic -pic-level 2 -pic-is-pie -mframe-pointer=none -fmath-errno -fno-rounding-math -mconstructor-aliases -munwind-tables -target-cpu x86-64 -tune-cpu generic -fno-split-dwarf-inlining -debug-info-kind=limited -dwarf-version=4 -debugger-tuning=gdb -resource-dir /home/zhh/llvm/build/lib/clang/13.0.0 -D HAVE_CONFIG_H -I . -I ../src/config -U _FORTIFY_SOURCE -D _FORTIFY_SOURCE=2 -I . -I ./secp256k1/include -D BOOST_SP_USE_STD_ATOMIC -D BOOST_AC_USE_STD_ATOMIC -I /usr/local/include -I ./leveldb/include -I ./leveldb/helpers/memenv -I ./univalue/include -D HAVE_BUILD_INFO -D __STDC_FORMAT_MACROS -internal-isystem /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9 -internal-isystem /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/x86_64-linux-gnu/c++/9 -internal-isystem /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/x86_64-linux-gnu/c++/9 -internal-isystem /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9/backward -internal-isystem /usr/local/include -internal-isystem /home/zhh/llvm/build/lib/clang/13.0.0/include -internal-externc-isystem /usr/include/x86_64-linux-gnu -internal-externc-isystem /include -internal-externc-isystem /usr/include -O2 -Wstack-protector -Wall -Wextra -Wgnu -Wformat -Wformat-security -Wvla -Wshadow-field -Wswitch -Wthread-safety -Wrange-loop-analysis -Wredundant-decls -Wunused-variable -Wdate-time -Wconditional-uninitialized -Wsign-compare -Woverloaded-virtual -Wsuggest-override -Wunreachable-code-loop-increment -Wno-unused-parameter -Wno-self-assign -Wno-unused-local-typedef -Wno-deprecated-register -Wno-implicit-fallthrough -Wno-deprecated-copy -std=c++11 -fdeprecated-macro -fdebug-compilation-dir=/home/zhh/projects/bitcoin-0.21.1/src -ferror-limit 19 -pthread -stack-protector 3 -fstack-clash-protection -fcf-protection=full -fgnuc-version=4.2.1 -fcxx-exceptions -fexceptions -vectorize-loops -vectorize-slp -analyzer-checker=alpha.unix.Stream -analyzer-config cplusplus.Move:WarnOn=All -analyzer-config suppress-null-return-paths=false -analyzer-config suppress-inlined-defensive-checks=false -analyzer-config stable-report-filename=true -analyzer-config max-nodes=1000000 -stats-file=/home/zhh/projects/bitcoin-0.21.1/csa/eh-range/cache/csa/home/zhh/projects/bitcoin-0.21.1/src/init.cpp.json -analyzer-output=html -analyzer-purge=none -analyzer-config experimental-enable-naive-ctu-analysis=true -analyzer-config ctu-dir=/home/zhh/projects/bitcoin-0.21.1/csa/eh-range/cache -faddrsig -o /home/zhh/projects/bitcoin-0.21.1/csa/eh-range/reports/20220823-080346 -x c++ init.cpp
</div>
<div id='tooltiphint' hidden="true">
  <p>Keyboard shortcuts: </p>
  <ul>
    <li>Use 'j/k' keys for keyboard navigation</li>
    <li>Use 'Shift+S' to show/hide relevant lines</li>
    <li>Use '?' to toggle this window</li>
  </ul>
  <a href="#" onclick="toggleHelp(); return false;">Close</a>
</div>
<script type='text/javascript'>
var relevant_lines = {"1": {"111": 1, "112": 1, "113": 1, "116": 1, "117": 1, "118": 1, "119": 1, "123": 1, "125": 1, "1263": 1, "1264": 1, "1265": 1, "1266": 1, "1268": 1, "1272": 1, "1279": 1, "1284": 1, "1286": 1, "1287": 1, "1290": 1, "1291": 1, "1293": 1, "1298": 1, "1302": 1, "1304": 1, "1307": 1, "1315": 1, "1316": 1, "1318": 1, "1319": 1, "1326": 1, "1329": 1, "1331": 1, "1332": 1, "1333": 1, "1334": 1, "1335": 1}, "6": {"197": 1, "198": 1, "199": 1, "203": 1, "205": 1, "221": 1, "222": 1, "223": 1, "227": 1, "229": 1}, "337": {"46": 1, "47": 1, "48": 1, "73": 1, "74": 1, "75": 1, "98": 1, "99": 1, "100": 1}, "2000": {"247": 1, "248": 1, "249": 1, "250": 1, "251": 1, "252": 1, "745": 1, "746": 1, "747": 1, "748": 1, "751": 1, "775": 1, "776": 1, "777": 1, "778": 1, "781": 1, "808": 1, "809": 1, "810": 1, "811": 1, "829": 1, "830": 1, "831": 1, "832": 1}, "3105": {"328": 1, "329": 1, "330": 1, "335": 1}, "3418": {"525": 1, "6120": 1, "6121": 1, "6122": 1, "6123": 1, "6147": 1, "6148": 1, "6149": 1, "6150": 1, "6151": 1, "6174": 1, "6175": 1, "6176": 1, "6177": 1}, "5084": {"1157": 1, "1158": 1, "1159": 1, "1160": 1, "1164": 1, "1165": 1, "1166": 1, "1167": 1, "1168": 1, "1169": 1}, "9535": {"82": 1, "83": 1, "84": 1, "86": 1, "87": 1, "88": 1, "94": 1, "95": 1, "96": 1, "98": 1, "99": 1, "100": 1, "102": 1, "103": 1, "104": 1, "128": 1, "129": 1, "130": 1, "164": 1, "165": 1, "166": 1, "168": 1, "169": 1, "170": 1, "625": 1, "626": 1, "627": 1, "636": 1, "637": 1, "638": 1, "639": 1, "640": 1, "641": 1, "669": 1, "670": 1, "671": 1, "672": 1, "673": 1, "674": 1, "675": 1, "684": 1, "685": 1, "686": 1, "695": 1, "696": 1, "697": 1, "704": 1, "705": 1, "706": 1, "707": 1, "708": 1, "709": 1, "718": 1, "719": 1, "720": 1, "727": 1, "728": 1, "729": 1, "730": 1, "731": 1, "732": 1}, "9710": {"203": 1, "204": 1, "205": 1}, "9726": {"117": 1, "118": 1, "136": 1, "137": 1, "138": 1, "200": 1, "201": 1, "202": 1, "281": 1, "282": 1, "369": 1, "370": 1, "371": 1, "372": 1, "377": 1, "389": 1, "390": 1, "391": 1, "392": 1, "393": 1, "394": 1, "460": 1, "461": 1, "462": 1, "463": 1}, "10385": {"517": 1, "518": 1, "519": 1, "520": 1, "521": 1, "523": 1, "524": 1, "525": 1, "526": 1, "527": 1, "528": 1, "574": 1, "575": 1, "576": 1, "577": 1, "578": 1, "581": 1, "602": 1, "612": 1, "613": 1, "614": 1, "615": 1, "616": 1, "617": 1, "618": 1, "620": 1, "621": 1, "622": 1, "623": 1, "664": 1, "665": 1, "666": 1, "667": 1, "668": 1, "669": 1, "670": 1, "672": 1, "673": 1, "674": 1, "676": 1, "677": 1, "678": 1, "679": 1, "680": 1, "681": 1, "682": 1, "686": 1, "715": 1, "719": 1, "721": 1, "722": 1, "749": 1, "750": 1, "752": 1, "755": 1, "756": 1, "757": 1, "758": 1, "769": 1, "781": 1, "782": 1, "788": 1, "789": 1, "790": 1, "791": 1, "792": 1, "793": 1, "858": 1, "867": 1, "872": 1, "873": 1, "874": 1, "875": 1, "877": 1, "878": 1, "879": 1, "880": 1, "884": 1, "885": 1, "886": 1, "887": 1, "888": 1, "889": 1, "892": 1, "894": 1, "895": 1, "896": 1, "897": 1, "900": 1, "904": 1, "906": 1, "907": 1, "925": 1, "926": 1, "927": 1, "931": 1, "932": 1, "933": 1, "934": 1, "949": 1, "950": 1, "973": 1, "974": 1, "975": 1, "976": 1, "1026": 1, "1027": 1, "1028": 1, "1052": 1, "1053": 1, "1054": 1, "1062": 1, "1063": 1, "1064": 1}, "10387": {"92": 1, "93": 1, "390": 1, "391": 1}, "11273": {"69": 1, "70": 1, "136": 1, "137": 1, "138": 1, "143": 1, "159": 1, "160": 1, "161": 1, "164": 1, "178": 1, "179": 1, "180": 1, "181": 1}, "11274": {"73": 1, "74": 1}, "11275": {"103": 1, "104": 1, "105": 1, "106": 1, "109": 1, "120": 1, "121": 1, "122": 1, "124": 1}, "11277": {"65": 1, "89": 1, "90": 1, "91": 1, "97": 1, "98": 1, "99": 1, "100": 1, "103": 1, "114": 1, "115": 1, "116": 1, "118": 1, "158": 1, "159": 1, "164": 1, "165": 1}, "11285": {"75": 1, "76": 1, "77": 1, "103": 1, "104": 1, "105": 1, "106": 1, "132": 1, "133": 1, "134": 1, "135": 1, "137": 1, "141": 1, "142": 1, "190": 1, "191": 1, "192": 1, "193": 1, "195": 1, "197": 1, "198": 1, "218": 1, "219": 1, "220": 1, "225": 1, "226": 1, "227": 1}, "11543": {"804": 1, "805": 1, "806": 1, "807": 1, "808": 1}, "11826": {"55": 1, "56": 1, "57": 1}, "12420": {"22": 1, "33": 1, "34": 1}, "63382": {"37": 1, "38": 1, "39": 1, "40": 1}, "112026": {"174": 1, "207": 1, "208": 1, "209": 1}, "112381": {"189": 1, "190": 1, "257": 1, "258": 1, "372": 1, "373": 1, "408": 1, "409": 1}, "112470": {"120": 1, "121": 1, "132": 1}, "112471": {"245": 1, "246": 1, "247": 1, "249": 1, "789": 1, "790": 1, "791": 1, "792": 1, "793": 1, "794": 1, "795": 1, "862": 1, "863": 1, "920": 1, "921": 1, "922": 1, "923": 1, "928": 1}, "112565": {"101": 1, "102": 1, "103": 1, "104": 1, "166": 1, "167": 1, "168": 1}, "112609": {"83": 1, "84": 1, "94": 1, "95": 1, "96": 1, "136": 1, "158": 1, "159": 1, "160": 1, "161": 1}, "112610": {"44": 1, "45": 1, "46": 1, "232": 1, "233": 1, "234": 1, "235": 1, "236": 1, "399": 1}, "281631": {"37": 1, "38": 1, "39": 1, "41": 1, "42": 1, "43": 1, "44": 1, "64": 1, "65": 1, "72": 1, "75": 1, "76": 1, "77": 1, "78": 1, "79": 1, "80": 1, "86": 1, "90": 1}, "368779": {"73": 1, "74": 1, "75": 1, "76": 1, "77": 1, "79": 1, "80": 1, "81": 1, "95": 1, "96": 1, "97": 1, "98": 1, "99": 1, "101": 1, "102": 1, "103": 1, "106": 1, "107": 1, "108": 1, "109": 1, "110": 1, "112": 1, "113": 1, "114": 1}, "368885": {"193": 1, "194": 1, "196": 1, "206": 1, "207": 1, "208": 1, "209": 1, "210": 1, "212": 1, "213": 1, "214": 1, "215": 1, "216": 1, "223": 1, "224": 1, "225": 1, "226": 1, "228": 1, "229": 1, "241": 1, "242": 1, "243": 1, "244": 1}, "368886": {"36": 1, "50": 1, "51": 1, "52": 1, "94": 1, "107": 1, "108": 1, "109": 1}, "368900": {"35": 1, "36": 1, "37": 1, "38": 1, "65": 1, "66": 1, "67": 1}, "368931": {"121": 1, "122": 1, "123": 1, "124": 1, "334": 1, "335": 1, "336": 1, "341": 1, "346": 1, "347": 1, "439": 1, "440": 1, "441": 1, "446": 1, "451": 1, "452": 1, "471": 1, "472": 1, "473": 1}, "369278": {"59": 1, "60": 1, "61": 1, "62": 1, "64": 1, "68": 1, "69": 1, "70": 1}, "369430": {"89": 1, "90": 1, "91": 1, "93": 1}, "370778": {"28": 1}, "679954": {"95": 1, "136": 1, "168": 1, "169": 1, "176": 1}, "735741": {"131": 1, "132": 1, "133": 1, "153": 1, "159": 1, "210": 1, "226": 1, "227": 1, "228": 1, "1266": 1, "1270": 1, "1271": 1, "1272": 1, "1273": 1}, "735748": {"110": 1, "118": 1, "119": 1, "120": 1}, "736122": {"42": 1}, "736257": {"29": 1, "30": 1, "31": 1, "34": 1}, "786397": {"19": 1, "77": 1, "78": 1, "79": 1, "82": 1}, "1511692": {"76": 1, "77": 1, "78": 1}, "1512106": {"77": 1, "78": 1, "79": 1, "266": 1, "267": 1, "269": 1, "271": 1, "272": 1, "273": 1}, "1512767": {"14": 1, "15": 1, "31": 1, "32": 1, "42": 1, "43": 1, "44": 1, "46": 1, "47": 1, "49": 1, "64": 1, "65": 1, "76": 1, "78": 1}, "1512768": {"62": 1}, "1512769": {"175": 1, "176": 1, "177": 1, "371": 1, "372": 1, "373": 1, "467": 1, "468": 1, "469": 1, "470": 1, "473": 1, "474": 1, "475": 1, "476": 1, "651": 1, "652": 1, "660": 1, "661": 1, "662": 1, "665": 1, "671": 1, "677": 1, "678": 1, "679": 1, "680": 1, "684": 1, "685": 1, "720": 1, "721": 1, "722": 1, "723": 1, "727": 1, "729": 1, "730": 1, "737": 1, "739": 1, "740": 1, "742": 1, "747": 1, "748": 1, "766": 1, "767": 1, "768": 1, "961": 1, "962": 1, "963": 1, "966": 1, "967": 1, "968": 1, "969": 1, "970": 1, "979": 1, "980": 1, "981": 1, "982": 1, "983": 1, "984": 1, "985": 1, "996": 1, "997": 1, "998": 1, "999": 1, "1002": 1, "1005": 1, "1300": 1, "1301": 1, "1302": 1, "1305": 1}, "1512771": {"34": 1, "35": 1, "36": 1, "37": 1}, "1513437": {"525": 1}, "1513831": {"57": 1}};

var filterCounterexample = function (hide) {
  var tables = document.getElementsByClassName("code");
  for (var t=0; t<tables.length; t++) {
    var table = tables[t];
    var file_id = table.getAttribute("data-fileid");
    var lines_in_fid = relevant_lines[file_id];
    if (!lines_in_fid) {
      lines_in_fid = {};
    }
    var lines = table.getElementsByClassName("codeline");
    for (var i=0; i<lines.length; i++) {
        var el = lines[i];
        var lineNo = el.getAttribute("data-linenumber");
        if (!lines_in_fid[lineNo]) {
          if (hide) {
            el.setAttribute("hidden", "");
          } else {
            el.removeAttribute("hidden");
          }
        }
    }
  }
}

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "S") {
    var checked = document.getElementsByName("showCounterexample")[0].checked;
    filterCounterexample(!checked);
    document.getElementsByName("showCounterexample")[0].checked = !checked;
  } else {
    return;
  }
  event.preventDefault();
}, true);

document.addEventListener("DOMContentLoaded", function() {
    document.querySelector('input[name="showCounterexample"]').onchange=
        function (event) {
      filterCounterexample(this.checked);
    };
});
</script>

<form>
    <input type="checkbox" name="showCounterexample" id="showCounterexample" />
    <label for="showCounterexample">
       Show only relevant lines
    </label>
</form>

<script type='text/javascript'>
var digitMatcher = new RegExp("[0-9]+");

var querySelectorAllArray = function(selector) {
  return Array.prototype.slice.call(
    document.querySelectorAll(selector));
}

document.addEventListener("DOMContentLoaded", function() {
    querySelectorAllArray(".PathNav > a").forEach(
        function(currentValue, currentIndex) {
            var hrefValue = currentValue.getAttribute("href");
            currentValue.onclick = function() {
                scrollTo(document.querySelector(hrefValue));
                return false;
            };
        });
});

var findNum = function() {
    var s = document.querySelector(".selected");
    if (!s || s.id == "EndPath") {
        return 0;
    }
    var out = parseInt(digitMatcher.exec(s.id)[0]);
    return out;
};

var scrollTo = function(el) {
    querySelectorAllArray(".selected").forEach(function(s) {
        s.classList.remove("selected");
    });
    el.classList.add("selected");
    window.scrollBy(0, el.getBoundingClientRect().top -
        (window.innerHeight / 2));
}

var move = function(num, up, numItems) {
  if (num == 1 && up || num == numItems - 1 && !up) {
    return 0;
  } else if (num == 0 && up) {
    return numItems - 1;
  } else if (num == 0 && !up) {
    return 1 % numItems;
  }
  return up ? num - 1 : num + 1;
}

var numToId = function(num) {
  if (num == 0) {
    return document.getElementById("EndPath")
  }
  return document.getElementById("Path" + num);
};

var navigateTo = function(up) {
  var numItems = document.querySelectorAll(
      ".line > .msgEvent, .line > .msgControl").length;
  var currentSelected = findNum();
  var newSelected = move(currentSelected, up, numItems);
  var newEl = numToId(newSelected, numItems);

  // Scroll element into center.
  scrollTo(newEl);
};

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "j") {
    navigateTo(/*up=*/false);
  } else if (event.key == "k") {
    navigateTo(/*up=*/true);
  } else {
    return;
  }
  event.preventDefault();
}, true);
</script>
  
<script type='text/javascript'>

var toggleHelp = function() {
    var hint = document.querySelector("#tooltiphint");
    var attributeName = "hidden";
    if (hint.hasAttribute(attributeName)) {
      hint.removeAttribute(attributeName);
    } else {
      hint.setAttribute("hidden", "true");
    }
};
window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "?") {
    toggleHelp();
  } else {
    return;
  }
  event.preventDefault();
});
</script>
<div id=File1>
<h4 class=FileName>init.cpp</h4>
<div class=FileNav><a href="#File1511692">&#x2192;</a></div></div>
<table class="code" data-fileid="1">
<tr class="codeline" data-linenumber="1"><td class="num" id="LN1">1</td><td class="line"><span class='comment'>// Copyright (c) 2009-2010 Satoshi Nakamoto</span></td></tr>
<tr class="codeline" data-linenumber="2"><td class="num" id="LN2">2</td><td class="line"><span class='comment'>// Copyright (c) 2009-2020 The Bitcoin Core developers</span></td></tr>
<tr class="codeline" data-linenumber="3"><td class="num" id="LN3">3</td><td class="line"><span class='comment'>// Distributed under the MIT software license, see the accompanying</span></td></tr>
<tr class="codeline" data-linenumber="4"><td class="num" id="LN4">4</td><td class="line"><span class='comment'>// file COPYING or http://www.opensource.org/licenses/mit-license.php.</span></td></tr>
<tr class="codeline" data-linenumber="5"><td class="num" id="LN5">5</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6"><td class="num" id="LN6">6</td><td class="line"><span class='directive'>#if defined(<span class='macro'>HAVE_CONFIG_H<span class='macro_popup'>1</span></span>)</span></td></tr>
<tr class="codeline" data-linenumber="7"><td class="num" id="LN7">7</td><td class="line"><span class='directive'>#include &lt;config/bitcoin-config.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="8"><td class="num" id="LN8">8</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="9"><td class="num" id="LN9">9</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="10"><td class="num" id="LN10">10</td><td class="line"><span class='directive'>#include &lt;init.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="11"><td class="num" id="LN11">11</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="12"><td class="num" id="LN12">12</td><td class="line"><span class='directive'>#include &lt;addrman.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="13"><td class="num" id="LN13">13</td><td class="line"><span class='directive'>#include &lt;amount.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="14"><td class="num" id="LN14">14</td><td class="line"><span class='directive'>#include &lt;banman.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="15"><td class="num" id="LN15">15</td><td class="line"><span class='directive'>#include &lt;blockfilter.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="16"><td class="num" id="LN16">16</td><td class="line"><span class='directive'>#include &lt;chain.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="17"><td class="num" id="LN17">17</td><td class="line"><span class='directive'>#include &lt;chainparams.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="18"><td class="num" id="LN18">18</td><td class="line"><span class='directive'>#include &lt;compat/sanity.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="19"><td class="num" id="LN19">19</td><td class="line"><span class='directive'>#include &lt;consensus/validation.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="20"><td class="num" id="LN20">20</td><td class="line"><span class='directive'>#include &lt;fs.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="21"><td class="num" id="LN21">21</td><td class="line"><span class='directive'>#include &lt;hash.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="22"><td class="num" id="LN22">22</td><td class="line"><span class='directive'>#include &lt;httprpc.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="23"><td class="num" id="LN23">23</td><td class="line"><span class='directive'>#include &lt;httpserver.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="24"><td class="num" id="LN24">24</td><td class="line"><span class='directive'>#include &lt;index/blockfilterindex.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="25"><td class="num" id="LN25">25</td><td class="line"><span class='directive'>#include &lt;index/txindex.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="26"><td class="num" id="LN26">26</td><td class="line"><span class='directive'>#include &lt;interfaces/chain.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="27"><td class="num" id="LN27">27</td><td class="line"><span class='directive'>#include &lt;interfaces/node.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="28"><td class="num" id="LN28">28</td><td class="line"><span class='directive'>#include &lt;key.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="29"><td class="num" id="LN29">29</td><td class="line"><span class='directive'>#include &lt;miner.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="30"><td class="num" id="LN30">30</td><td class="line"><span class='directive'>#include &lt;net.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="31"><td class="num" id="LN31">31</td><td class="line"><span class='directive'>#include &lt;net_permissions.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="32"><td class="num" id="LN32">32</td><td class="line"><span class='directive'>#include &lt;net_processing.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="33"><td class="num" id="LN33">33</td><td class="line"><span class='directive'>#include &lt;netbase.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="34"><td class="num" id="LN34">34</td><td class="line"><span class='directive'>#include &lt;node/context.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="35"><td class="num" id="LN35">35</td><td class="line"><span class='directive'>#include &lt;node/ui_interface.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="36"><td class="num" id="LN36">36</td><td class="line"><span class='directive'>#include &lt;policy/feerate.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="37"><td class="num" id="LN37">37</td><td class="line"><span class='directive'>#include &lt;policy/fees.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="38"><td class="num" id="LN38">38</td><td class="line"><span class='directive'>#include &lt;policy/policy.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="39"><td class="num" id="LN39">39</td><td class="line"><span class='directive'>#include &lt;policy/settings.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="40"><td class="num" id="LN40">40</td><td class="line"><span class='directive'>#include &lt;protocol.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="41"><td class="num" id="LN41">41</td><td class="line"><span class='directive'>#include &lt;rpc/blockchain.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="42"><td class="num" id="LN42">42</td><td class="line"><span class='directive'>#include &lt;rpc/register.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="43"><td class="num" id="LN43">43</td><td class="line"><span class='directive'>#include &lt;rpc/server.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="44"><td class="num" id="LN44">44</td><td class="line"><span class='directive'>#include &lt;rpc/util.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="45"><td class="num" id="LN45">45</td><td class="line"><span class='directive'>#include &lt;scheduler.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="46"><td class="num" id="LN46">46</td><td class="line"><span class='directive'>#include &lt;script/sigcache.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="47"><td class="num" id="LN47">47</td><td class="line"><span class='directive'>#include &lt;script/standard.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="48"><td class="num" id="LN48">48</td><td class="line"><span class='directive'>#include &lt;shutdown.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="49"><td class="num" id="LN49">49</td><td class="line"><span class='directive'>#include &lt;sync.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="50"><td class="num" id="LN50">50</td><td class="line"><span class='directive'>#include &lt;timedata.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="51"><td class="num" id="LN51">51</td><td class="line"><span class='directive'>#include &lt;torcontrol.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="52"><td class="num" id="LN52">52</td><td class="line"><span class='directive'>#include &lt;txdb.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="53"><td class="num" id="LN53">53</td><td class="line"><span class='directive'>#include &lt;txmempool.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="54"><td class="num" id="LN54">54</td><td class="line"><span class='directive'>#include &lt;util/asmap.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="55"><td class="num" id="LN55">55</td><td class="line"><span class='directive'>#include &lt;util/check.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="56"><td class="num" id="LN56">56</td><td class="line"><span class='directive'>#include &lt;util/moneystr.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="57"><td class="num" id="LN57">57</td><td class="line"><span class='directive'>#include &lt;util/string.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="58"><td class="num" id="LN58">58</td><td class="line"><span class='directive'>#include &lt;util/system.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="59"><td class="num" id="LN59">59</td><td class="line"><span class='directive'>#include &lt;util/threadnames.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="60"><td class="num" id="LN60">60</td><td class="line"><span class='directive'>#include &lt;util/translation.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="61"><td class="num" id="LN61">61</td><td class="line"><span class='directive'>#include &lt;validation.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="62"><td class="num" id="LN62">62</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="63"><td class="num" id="LN63">63</td><td class="line"><span class='directive'>#include &lt;validationinterface.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="64"><td class="num" id="LN64">64</td><td class="line"><span class='directive'>#include &lt;walletinitinterface.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="65"><td class="num" id="LN65">65</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="66"><td class="num" id="LN66">66</td><td class="line"><span class='directive'>#include &lt;functional&gt;</span></td></tr>
<tr class="codeline" data-linenumber="67"><td class="num" id="LN67">67</td><td class="line"><span class='directive'>#include &lt;set&gt;</span></td></tr>
<tr class="codeline" data-linenumber="68"><td class="num" id="LN68">68</td><td class="line"><span class='directive'>#include &lt;stdint.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="69"><td class="num" id="LN69">69</td><td class="line"><span class='directive'>#include &lt;stdio.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="70"><td class="num" id="LN70">70</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="71"><td class="num" id="LN71">71</td><td class="line"><span class='directive'>#ifndef WIN32</span></td></tr>
<tr class="codeline" data-linenumber="72"><td class="num" id="LN72">72</td><td class="line"><span class='directive'>#include &lt;attributes.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="73"><td class="num" id="LN73">73</td><td class="line"><span class='directive'>#include &lt;cerrno&gt;</span></td></tr>
<tr class="codeline" data-linenumber="74"><td class="num" id="LN74">74</td><td class="line"><span class='directive'>#include &lt;signal.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="75"><td class="num" id="LN75">75</td><td class="line"><span class='directive'>#include &lt;sys/stat.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="76"><td class="num" id="LN76">76</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="77"><td class="num" id="LN77">77</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="78"><td class="num" id="LN78">78</td><td class="line"><span class='directive'>#include &lt;boost/algorithm/string/replace.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="79"><td class="num" id="LN79">79</td><td class="line"><span class='directive'>#include &lt;boost/signals2/signal.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="80"><td class="num" id="LN80">80</td><td class="line"><span class='directive'>#include &lt;boost/thread/thread.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="81"><td class="num" id="LN81">81</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="82"><td class="num" id="LN82">82</td><td class="line"><span class='directive'>#if <span class='macro'>ENABLE_ZMQ<span class='macro_popup'>0</span></span></span></td></tr>
<tr class="codeline" data-linenumber="83"><td class="num" id="LN83">83</td><td class="line"><span class='directive'>#include &lt;zmq/zmqabstractnotifier.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="84"><td class="num" id="LN84">84</td><td class="line"><span class='directive'>#include &lt;zmq/zmqnotificationinterface.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="85"><td class="num" id="LN85">85</td><td class="line"><span class='directive'>#include &lt;zmq/zmqrpc.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="86"><td class="num" id="LN86">86</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="87"><td class="num" id="LN87">87</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="88"><td class="num" id="LN88">88</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>bool</span> fFeeEstimatesInitialized = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="89"><td class="num" id="LN89">89</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>bool</span> DEFAULT_PROXYRANDOMIZE = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="90"><td class="num" id="LN90">90</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>bool</span> DEFAULT_REST_ENABLE = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="91"><td class="num" id="LN91">91</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>bool</span> DEFAULT_STOPAFTERBLOCKIMPORT = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="92"><td class="num" id="LN92">92</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="93"><td class="num" id="LN93">93</td><td class="line"><span class='directive'>#ifdef WIN32</span></td></tr>
<tr class="codeline" data-linenumber="94"><td class="num" id="LN94">94</td><td class="line"><span class='comment'>// Win32 LevelDB doesn't use filedescriptors, and the ones used for</span></td></tr>
<tr class="codeline" data-linenumber="95"><td class="num" id="LN95">95</td><td class="line"><span class='comment'>// accessing block files don't count towards the fd_set size limit</span></td></tr>
<tr class="codeline" data-linenumber="96"><td class="num" id="LN96">96</td><td class="line"><span class='comment'>// anyway.</span></td></tr>
<tr class="codeline" data-linenumber="97"><td class="num" id="LN97">97</td><td class="line"><span class='directive'>#define <span class='macro'>MIN_CORE_FILEDESCRIPTORS<span class='macro_popup'>150</span></span> 0</span></td></tr>
<tr class="codeline" data-linenumber="98"><td class="num" id="LN98">98</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="99"><td class="num" id="LN99">99</td><td class="line"><span class='directive'>#define <span class='macro'>MIN_CORE_FILEDESCRIPTORS<span class='macro_popup'>150</span></span> 150</span></td></tr>
<tr class="codeline" data-linenumber="100"><td class="num" id="LN100">100</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="101"><td class="num" id="LN101">101</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="102"><td class="num" id="LN102">102</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span>* FEE_ESTIMATES_FILENAME=<span class='string_literal'>"fee_estimates.dat"</span>;</td></tr>
<tr class="codeline" data-linenumber="103"><td class="num" id="LN103">103</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="104"><td class="num" id="LN104">104</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span>* DEFAULT_ASMAP_FILENAME=<span class='string_literal'>"ip_asn.map"</span>;</td></tr>
<tr class="codeline" data-linenumber="105"><td class="num" id="LN105">105</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="106"><td class="num" id="LN106">106</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr class="codeline" data-linenumber="107"><td class="num" id="LN107">107</td><td class="line"> <span class='comment'>* The PID file facilities.</span></td></tr>
<tr class="codeline" data-linenumber="108"><td class="num" id="LN108">108</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="109"><td class="num" id="LN109">109</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span>* BITCOIN_PID_FILENAME = <span class='string_literal'>"bitcoind.pid"</span>;</td></tr>
<tr class="codeline" data-linenumber="110"><td class="num" id="LN110">110</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="111"><td class="num" id="LN111">111</td><td class="line"><span class='keyword'>static</span> fs::path GetPidFile(<span class='keyword'>const</span> ArgsManager&amp; args)</td></tr>
<tr class="codeline" data-linenumber="112"><td class="num" id="LN112">112</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="113"><td class="num" id="LN113">113</td><td class="line">    <span class='keyword'>return</span> AbsPathForConfigVal(fs::path(args.GetArg(<span class='string_literal'>"-pid"</span>, BITCOIN_PID_FILENAME)));</td></tr>
<tr class="codeline" data-linenumber="114"><td class="num" id="LN114">114</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="115"><td class="num" id="LN115">115</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="116"><td class="num" id="LN116">116</td><td class="line"><span class='macro'>NODISCARD<span class='macro_popup'>[[nodiscard]]</span></span> <span class='keyword'>static</span> <span class='keyword'>bool</span> CreatePidFile(<span class='keyword'>const</span> ArgsManager&amp; args)</td></tr>
<tr class="codeline" data-linenumber="117"><td class="num" id="LN117">117</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="118"><td class="num" id="LN118">118</td><td class="line">    fsbridge::ofstream file{GetPidFile(args)};</td></tr>
<tr class="codeline" data-linenumber="119"><td class="num" id="LN119">119</td><td class="line">    <span class='keyword'>if</span> (file) {</td></tr>
<tr class="codeline" data-linenumber="120"><td class="num" id="LN120">120</td><td class="line"><span class='directive'>#ifdef WIN32</span></td></tr>
<tr class="codeline" data-linenumber="121"><td class="num" id="LN121">121</td><td class="line">        tfm::format(file, <span class='string_literal'>"%d\n"</span>, GetCurrentProcessId());</td></tr>
<tr class="codeline" data-linenumber="122"><td class="num" id="LN122">122</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="123"><td class="num" id="LN123">123</td><td class="line">        tfm::format(file, <span class='string_literal'>"%d\n"</span>, getpid());</td></tr>
<tr class="codeline" data-linenumber="124"><td class="num" id="LN124">124</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="125"><td class="num" id="LN125">125</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="126"><td class="num" id="LN126">126</td><td class="line">    } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="127"><td class="num" id="LN127">127</td><td class="line">        <span class='keyword'>return</span> InitError(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"Unable to create the PID file '%s': %s"</span>), GetPidFile(args).string(), std::strerror(<span class='macro'>errno<span class='macro_popup'>(*__errno_location ())</span></span>)));</td></tr>
<tr class="codeline" data-linenumber="128"><td class="num" id="LN128">128</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="129"><td class="num" id="LN129">129</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="130"><td class="num" id="LN130">130</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="131"><td class="num" id="LN131">131</td><td class="line"><span class='comment'>//////////////////////////////////////////////////////////////////////////////</span></td></tr>
<tr class="codeline" data-linenumber="132"><td class="num" id="LN132">132</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="133"><td class="num" id="LN133">133</td><td class="line"><span class='comment'>// Shutdown</span></td></tr>
<tr class="codeline" data-linenumber="134"><td class="num" id="LN134">134</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="135"><td class="num" id="LN135">135</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="136"><td class="num" id="LN136">136</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="137"><td class="num" id="LN137">137</td><td class="line"><span class='comment'>// Thread management and startup/shutdown:</span></td></tr>
<tr class="codeline" data-linenumber="138"><td class="num" id="LN138">138</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="139"><td class="num" id="LN139">139</td><td class="line"><span class='comment'>// The network-processing threads are all part of a thread group</span></td></tr>
<tr class="codeline" data-linenumber="140"><td class="num" id="LN140">140</td><td class="line"><span class='comment'>// created by AppInit() or the Qt main() function.</span></td></tr>
<tr class="codeline" data-linenumber="141"><td class="num" id="LN141">141</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="142"><td class="num" id="LN142">142</td><td class="line"><span class='comment'>// A clean exit happens when StartShutdown() or the SIGTERM</span></td></tr>
<tr class="codeline" data-linenumber="143"><td class="num" id="LN143">143</td><td class="line"><span class='comment'>// signal handler sets ShutdownRequested(), which makes main thread's</span></td></tr>
<tr class="codeline" data-linenumber="144"><td class="num" id="LN144">144</td><td class="line"><span class='comment'>// WaitForShutdown() interrupts the thread group.</span></td></tr>
<tr class="codeline" data-linenumber="145"><td class="num" id="LN145">145</td><td class="line"><span class='comment'>// And then, WaitForShutdown() makes all other on-going threads</span></td></tr>
<tr class="codeline" data-linenumber="146"><td class="num" id="LN146">146</td><td class="line"><span class='comment'>// in the thread group join the main thread.</span></td></tr>
<tr class="codeline" data-linenumber="147"><td class="num" id="LN147">147</td><td class="line"><span class='comment'>// Shutdown() is then called to clean up database connections, and stop other</span></td></tr>
<tr class="codeline" data-linenumber="148"><td class="num" id="LN148">148</td><td class="line"><span class='comment'>// threads that should only be stopped after the main network-processing</span></td></tr>
<tr class="codeline" data-linenumber="149"><td class="num" id="LN149">149</td><td class="line"><span class='comment'>// threads have exited.</span></td></tr>
<tr class="codeline" data-linenumber="150"><td class="num" id="LN150">150</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="151"><td class="num" id="LN151">151</td><td class="line"><span class='comment'>// Shutdown for Qt is very similar, only it uses a QTimer to detect</span></td></tr>
<tr class="codeline" data-linenumber="152"><td class="num" id="LN152">152</td><td class="line"><span class='comment'>// ShutdownRequested() getting set, and then does the normal Qt</span></td></tr>
<tr class="codeline" data-linenumber="153"><td class="num" id="LN153">153</td><td class="line"><span class='comment'>// shutdown thing.</span></td></tr>
<tr class="codeline" data-linenumber="154"><td class="num" id="LN154">154</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="155"><td class="num" id="LN155">155</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="156"><td class="num" id="LN156">156</td><td class="line"><span class='keyword'>static</span> std::unique_ptr&lt;ECCVerifyHandle&gt; globalVerifyHandle;</td></tr>
<tr class="codeline" data-linenumber="157"><td class="num" id="LN157">157</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="158"><td class="num" id="LN158">158</td><td class="line"><span class='keyword'>static</span> std::thread g_load_block;</td></tr>
<tr class="codeline" data-linenumber="159"><td class="num" id="LN159">159</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="160"><td class="num" id="LN160">160</td><td class="line"><span class='keyword'>static</span> boost::thread_group threadGroup;</td></tr>
<tr class="codeline" data-linenumber="161"><td class="num" id="LN161">161</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="162"><td class="num" id="LN162">162</td><td class="line"><span class='keyword'>void</span> Interrupt(NodeContext&amp; node)</td></tr>
<tr class="codeline" data-linenumber="163"><td class="num" id="LN163">163</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="164"><td class="num" id="LN164">164</td><td class="line">    InterruptHTTPServer();</td></tr>
<tr class="codeline" data-linenumber="165"><td class="num" id="LN165">165</td><td class="line">    InterruptHTTPRPC();</td></tr>
<tr class="codeline" data-linenumber="166"><td class="num" id="LN166">166</td><td class="line">    InterruptRPC();</td></tr>
<tr class="codeline" data-linenumber="167"><td class="num" id="LN167">167</td><td class="line">    InterruptREST();</td></tr>
<tr class="codeline" data-linenumber="168"><td class="num" id="LN168">168</td><td class="line">    InterruptTorControl();</td></tr>
<tr class="codeline" data-linenumber="169"><td class="num" id="LN169">169</td><td class="line">    InterruptMapPort();</td></tr>
<tr class="codeline" data-linenumber="170"><td class="num" id="LN170">170</td><td class="line">    <span class='keyword'>if</span> (node.connman)</td></tr>
<tr class="codeline" data-linenumber="171"><td class="num" id="LN171">171</td><td class="line">        node.connman-&gt;Interrupt();</td></tr>
<tr class="codeline" data-linenumber="172"><td class="num" id="LN172">172</td><td class="line">    <span class='keyword'>if</span> (g_txindex) {</td></tr>
<tr class="codeline" data-linenumber="173"><td class="num" id="LN173">173</td><td class="line">        g_txindex-&gt;Interrupt();</td></tr>
<tr class="codeline" data-linenumber="174"><td class="num" id="LN174">174</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="175"><td class="num" id="LN175">175</td><td class="line">    ForEachBlockFilterIndex([](BlockFilterIndex&amp; index) { index.Interrupt(); });</td></tr>
<tr class="codeline" data-linenumber="176"><td class="num" id="LN176">176</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="177"><td class="num" id="LN177">177</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="178"><td class="num" id="LN178">178</td><td class="line"><span class='keyword'>void</span> Shutdown(NodeContext&amp; node)</td></tr>
<tr class="codeline" data-linenumber="179"><td class="num" id="LN179">179</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="180"><td class="num" id="LN180">180</td><td class="line">    <span class='keyword'>static</span> Mutex g_shutdown_mutex;</td></tr>
<tr class="codeline" data-linenumber="181"><td class="num" id="LN181">181</td><td class="line">    <span class='macro'>TRY_LOCK(g_shutdown_mutex, lock_shutdown)<span class='macro_popup'>DebugLock&lt;decltype(g_shutdown_mutex)&gt; lock_shutdown(g_shutdown_mutex<br>, "g_shutdown_mutex", "init.cpp", 181, true)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="182"><td class="num" id="LN182">182</td><td class="line">    <span class='keyword'>if</span> (!lock_shutdown) <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="183"><td class="num" id="LN183">183</td><td class="line">    LogPrintf(<span class='string_literal'>"%s: In progress...\n"</span>, <span class='keyword'>__func__</span>);</td></tr>
<tr class="codeline" data-linenumber="184"><td class="num" id="LN184">184</td><td class="line">    <span class='macro'>Assert(node.args)<span class='macro_popup'>[&amp;]() -&gt; decltype(get_pure_r_value(node.args)) { auto&amp;&amp;<br> check = (node.args); (static_cast &lt;bool&gt; ("node.args" &amp;&amp;<br> check) ? void (0) : __assert_fail ("\"node.args\" &amp;&amp; check"<br>, "init.cpp", 184, __extension__ __PRETTY_FUNCTION__)); return<br> std::forward&lt;decltype(get_pure_r_value(node.args))&gt;(check<br>); }()</span></span>;</td></tr>
<tr class="codeline" data-linenumber="185"><td class="num" id="LN185">185</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="186"><td class="num" id="LN186">186</td><td class="line">    <span class='comment'>/// Note: Shutdown() must be able to handle cases in which initialization failed part of the way,</span></td></tr>
<tr class="codeline" data-linenumber="187"><td class="num" id="LN187">187</td><td class="line">    <span class='comment'>/// for example if the data directory was found to be locked.</span></td></tr>
<tr class="codeline" data-linenumber="188"><td class="num" id="LN188">188</td><td class="line">    <span class='comment'>/// Be sure that anything that writes files or flushes caches only does this if the respective</span></td></tr>
<tr class="codeline" data-linenumber="189"><td class="num" id="LN189">189</td><td class="line">    <span class='comment'>/// module was initialized.</span></td></tr>
<tr class="codeline" data-linenumber="190"><td class="num" id="LN190">190</td><td class="line">    util::ThreadRename(<span class='string_literal'>"shutoff"</span>);</td></tr>
<tr class="codeline" data-linenumber="191"><td class="num" id="LN191">191</td><td class="line">    <span class='keyword'>if</span> (node.mempool) node.mempool-&gt;AddTransactionsUpdated(1);</td></tr>
<tr class="codeline" data-linenumber="192"><td class="num" id="LN192">192</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="193"><td class="num" id="LN193">193</td><td class="line">    StopHTTPRPC();</td></tr>
<tr class="codeline" data-linenumber="194"><td class="num" id="LN194">194</td><td class="line">    StopREST();</td></tr>
<tr class="codeline" data-linenumber="195"><td class="num" id="LN195">195</td><td class="line">    StopRPC();</td></tr>
<tr class="codeline" data-linenumber="196"><td class="num" id="LN196">196</td><td class="line">    StopHTTPServer();</td></tr>
<tr class="codeline" data-linenumber="197"><td class="num" id="LN197">197</td><td class="line">    <span class='keyword'>for</span> (<span class='keyword'>const</span> <span class='keyword'>auto</span>&amp; client : node.chain_clients) {</td></tr>
<tr class="codeline" data-linenumber="198"><td class="num" id="LN198">198</td><td class="line">        client-&gt;flush();</td></tr>
<tr class="codeline" data-linenumber="199"><td class="num" id="LN199">199</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="200"><td class="num" id="LN200">200</td><td class="line">    StopMapPort();</td></tr>
<tr class="codeline" data-linenumber="201"><td class="num" id="LN201">201</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="202"><td class="num" id="LN202">202</td><td class="line">    <span class='comment'>// Because these depend on each-other, we make sure that neither can be</span></td></tr>
<tr class="codeline" data-linenumber="203"><td class="num" id="LN203">203</td><td class="line">    <span class='comment'>// using the other before destroying them.</span></td></tr>
<tr class="codeline" data-linenumber="204"><td class="num" id="LN204">204</td><td class="line">    <span class='keyword'>if</span> (node.peerman) UnregisterValidationInterface(node.peerman.get());</td></tr>
<tr class="codeline" data-linenumber="205"><td class="num" id="LN205">205</td><td class="line">    <span class='comment'>// Follow the lock order requirements:</span></td></tr>
<tr class="codeline" data-linenumber="206"><td class="num" id="LN206">206</td><td class="line">    <span class='comment'>// * CheckForStaleTipAndEvictPeers locks cs_main before indirectly calling GetExtraOutboundCount</span></td></tr>
<tr class="codeline" data-linenumber="207"><td class="num" id="LN207">207</td><td class="line">    <span class='comment'>//   which locks cs_vNodes.</span></td></tr>
<tr class="codeline" data-linenumber="208"><td class="num" id="LN208">208</td><td class="line">    <span class='comment'>// * ProcessMessage locks cs_main and g_cs_orphans before indirectly calling ForEachNode which</span></td></tr>
<tr class="codeline" data-linenumber="209"><td class="num" id="LN209">209</td><td class="line">    <span class='comment'>//   locks cs_vNodes.</span></td></tr>
<tr class="codeline" data-linenumber="210"><td class="num" id="LN210">210</td><td class="line">    <span class='comment'>// * CConnman::Stop calls DeleteNode, which calls FinalizeNode, which locks cs_main and calls</span></td></tr>
<tr class="codeline" data-linenumber="211"><td class="num" id="LN211">211</td><td class="line">    <span class='comment'>//   EraseOrphansFor, which locks g_cs_orphans.</span></td></tr>
<tr class="codeline" data-linenumber="212"><td class="num" id="LN212">212</td><td class="line">    <span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="213"><td class="num" id="LN213">213</td><td class="line">    <span class='comment'>// Thus the implicit locking order requirement is: (1) cs_main, (2) g_cs_orphans, (3) cs_vNodes.</span></td></tr>
<tr class="codeline" data-linenumber="214"><td class="num" id="LN214">214</td><td class="line">    <span class='keyword'>if</span> (node.connman) {</td></tr>
<tr class="codeline" data-linenumber="215"><td class="num" id="LN215">215</td><td class="line">        node.connman-&gt;StopThreads();</td></tr>
<tr class="codeline" data-linenumber="216"><td class="num" id="LN216">216</td><td class="line">        <span class='macro'>LOCK2(::cs_main, ::g_cs_orphans)<span class='macro_popup'>DebugLock&lt;decltype(::cs_main)&gt; criticalblock1(::cs_main<br>, "::cs_main", "init.cpp", 216); DebugLock&lt;decltype(::g_cs_orphans<br>)&gt; criticalblock2(::g_cs_orphans, "::g_cs_orphans", "init.cpp"<br>, 216);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="217"><td class="num" id="LN217">217</td><td class="line">        node.connman-&gt;StopNodes();</td></tr>
<tr class="codeline" data-linenumber="218"><td class="num" id="LN218">218</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="219"><td class="num" id="LN219">219</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="220"><td class="num" id="LN220">220</td><td class="line">    StopTorControl();</td></tr>
<tr class="codeline" data-linenumber="221"><td class="num" id="LN221">221</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="222"><td class="num" id="LN222">222</td><td class="line">    <span class='comment'>// After everything has been shut down, but before things get flushed, stop the</span></td></tr>
<tr class="codeline" data-linenumber="223"><td class="num" id="LN223">223</td><td class="line">    <span class='comment'>// CScheduler/checkqueue, threadGroup and load block thread.</span></td></tr>
<tr class="codeline" data-linenumber="224"><td class="num" id="LN224">224</td><td class="line">    <span class='keyword'>if</span> (node.scheduler) node.scheduler-&gt;stop();</td></tr>
<tr class="codeline" data-linenumber="225"><td class="num" id="LN225">225</td><td class="line">    <span class='keyword'>if</span> (g_load_block.joinable()) g_load_block.join();</td></tr>
<tr class="codeline" data-linenumber="226"><td class="num" id="LN226">226</td><td class="line">    threadGroup.interrupt_all();</td></tr>
<tr class="codeline" data-linenumber="227"><td class="num" id="LN227">227</td><td class="line">    threadGroup.join_all();</td></tr>
<tr class="codeline" data-linenumber="228"><td class="num" id="LN228">228</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="229"><td class="num" id="LN229">229</td><td class="line">    <span class='comment'>// After the threads that potentially access these pointers have been stopped,</span></td></tr>
<tr class="codeline" data-linenumber="230"><td class="num" id="LN230">230</td><td class="line">    <span class='comment'>// destruct and reset all to nullptr.</span></td></tr>
<tr class="codeline" data-linenumber="231"><td class="num" id="LN231">231</td><td class="line">    node.peerman.reset();</td></tr>
<tr class="codeline" data-linenumber="232"><td class="num" id="LN232">232</td><td class="line">    node.connman.reset();</td></tr>
<tr class="codeline" data-linenumber="233"><td class="num" id="LN233">233</td><td class="line">    node.banman.reset();</td></tr>
<tr class="codeline" data-linenumber="234"><td class="num" id="LN234">234</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="235"><td class="num" id="LN235">235</td><td class="line">    <span class='keyword'>if</span> (node.mempool &amp;&amp; node.mempool-&gt;IsLoaded() &amp;&amp; node.args-&gt;GetArg(<span class='string_literal'>"-persistmempool"</span>, DEFAULT_PERSIST_MEMPOOL)) {</td></tr>
<tr class="codeline" data-linenumber="236"><td class="num" id="LN236">236</td><td class="line">        DumpMempool(*node.mempool);</td></tr>
<tr class="codeline" data-linenumber="237"><td class="num" id="LN237">237</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="238"><td class="num" id="LN238">238</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="239"><td class="num" id="LN239">239</td><td class="line">    <span class='keyword'>if</span> (fFeeEstimatesInitialized)</td></tr>
<tr class="codeline" data-linenumber="240"><td class="num" id="LN240">240</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="241"><td class="num" id="LN241">241</td><td class="line">        ::feeEstimator.FlushUnconfirmed();</td></tr>
<tr class="codeline" data-linenumber="242"><td class="num" id="LN242">242</td><td class="line">        fs::path est_path = GetDataDir() / FEE_ESTIMATES_FILENAME;</td></tr>
<tr class="codeline" data-linenumber="243"><td class="num" id="LN243">243</td><td class="line">        CAutoFile est_fileout(fsbridge::fopen(est_path, <span class='string_literal'>"wb"</span>), SER_DISK, CLIENT_VERSION);</td></tr>
<tr class="codeline" data-linenumber="244"><td class="num" id="LN244">244</td><td class="line">        <span class='keyword'>if</span> (!est_fileout.IsNull())</td></tr>
<tr class="codeline" data-linenumber="245"><td class="num" id="LN245">245</td><td class="line">            ::feeEstimator.Write(est_fileout);</td></tr>
<tr class="codeline" data-linenumber="246"><td class="num" id="LN246">246</td><td class="line">        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="247"><td class="num" id="LN247">247</td><td class="line">            LogPrintf(<span class='string_literal'>"%s: Failed to write fee estimates to %s\n"</span>, <span class='keyword'>__func__</span>, est_path.string());</td></tr>
<tr class="codeline" data-linenumber="248"><td class="num" id="LN248">248</td><td class="line">        fFeeEstimatesInitialized = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="249"><td class="num" id="LN249">249</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="250"><td class="num" id="LN250">250</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="251"><td class="num" id="LN251">251</td><td class="line">    <span class='comment'>// FlushStateToDisk generates a ChainStateFlushed callback, which we should avoid missing</span></td></tr>
<tr class="codeline" data-linenumber="252"><td class="num" id="LN252">252</td><td class="line">    <span class='keyword'>if</span> (node.chainman) {</td></tr>
<tr class="codeline" data-linenumber="253"><td class="num" id="LN253">253</td><td class="line">        <span class='macro'>LOCK(cs_main)<span class='macro_popup'>DebugLock&lt;decltype(cs_main)&gt; criticalblock49(cs_main, "cs_main"<br>, "init.cpp", 253)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="254"><td class="num" id="LN254">254</td><td class="line">        <span class='keyword'>for</span> (CChainState* chainstate : node.chainman-&gt;GetAll()) {</td></tr>
<tr class="codeline" data-linenumber="255"><td class="num" id="LN255">255</td><td class="line">            <span class='keyword'>if</span> (chainstate-&gt;CanFlushToDisk()) {</td></tr>
<tr class="codeline" data-linenumber="256"><td class="num" id="LN256">256</td><td class="line">                chainstate-&gt;ForceFlushStateToDisk();</td></tr>
<tr class="codeline" data-linenumber="257"><td class="num" id="LN257">257</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="258"><td class="num" id="LN258">258</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="259"><td class="num" id="LN259">259</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="260"><td class="num" id="LN260">260</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="261"><td class="num" id="LN261">261</td><td class="line">    <span class='comment'>// After there are no more peers/RPC left to give us new data which may generate</span></td></tr>
<tr class="codeline" data-linenumber="262"><td class="num" id="LN262">262</td><td class="line">    <span class='comment'>// CValidationInterface callbacks, flush them...</span></td></tr>
<tr class="codeline" data-linenumber="263"><td class="num" id="LN263">263</td><td class="line">    GetMainSignals().FlushBackgroundCallbacks();</td></tr>
<tr class="codeline" data-linenumber="264"><td class="num" id="LN264">264</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="265"><td class="num" id="LN265">265</td><td class="line">    <span class='comment'>// Stop and delete all indexes only after flushing background callbacks.</span></td></tr>
<tr class="codeline" data-linenumber="266"><td class="num" id="LN266">266</td><td class="line">    <span class='keyword'>if</span> (g_txindex) {</td></tr>
<tr class="codeline" data-linenumber="267"><td class="num" id="LN267">267</td><td class="line">        g_txindex-&gt;Stop();</td></tr>
<tr class="codeline" data-linenumber="268"><td class="num" id="LN268">268</td><td class="line">        g_txindex.reset();</td></tr>
<tr class="codeline" data-linenumber="269"><td class="num" id="LN269">269</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="270"><td class="num" id="LN270">270</td><td class="line">    ForEachBlockFilterIndex([](BlockFilterIndex&amp; index) { index.Stop(); });</td></tr>
<tr class="codeline" data-linenumber="271"><td class="num" id="LN271">271</td><td class="line">    DestroyAllBlockFilterIndexes();</td></tr>
<tr class="codeline" data-linenumber="272"><td class="num" id="LN272">272</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="273"><td class="num" id="LN273">273</td><td class="line">    <span class='comment'>// Any future callbacks will be dropped. This should absolutely be safe - if</span></td></tr>
<tr class="codeline" data-linenumber="274"><td class="num" id="LN274">274</td><td class="line">    <span class='comment'>// missing a callback results in an unrecoverable situation, unclean shutdown</span></td></tr>
<tr class="codeline" data-linenumber="275"><td class="num" id="LN275">275</td><td class="line">    <span class='comment'>// would too. The only reason to do the above flushes is to let the wallet catch</span></td></tr>
<tr class="codeline" data-linenumber="276"><td class="num" id="LN276">276</td><td class="line">    <span class='comment'>// up with our current chain to avoid any strange pruning edge cases and make</span></td></tr>
<tr class="codeline" data-linenumber="277"><td class="num" id="LN277">277</td><td class="line">    <span class='comment'>// next startup faster by avoiding rescan.</span></td></tr>
<tr class="codeline" data-linenumber="278"><td class="num" id="LN278">278</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="279"><td class="num" id="LN279">279</td><td class="line">    <span class='keyword'>if</span> (node.chainman) {</td></tr>
<tr class="codeline" data-linenumber="280"><td class="num" id="LN280">280</td><td class="line">        <span class='macro'>LOCK(cs_main)<span class='macro_popup'>DebugLock&lt;decltype(cs_main)&gt; criticalblock50(cs_main, "cs_main"<br>, "init.cpp", 280)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="281"><td class="num" id="LN281">281</td><td class="line">        <span class='keyword'>for</span> (CChainState* chainstate : node.chainman-&gt;GetAll()) {</td></tr>
<tr class="codeline" data-linenumber="282"><td class="num" id="LN282">282</td><td class="line">            <span class='keyword'>if</span> (chainstate-&gt;CanFlushToDisk()) {</td></tr>
<tr class="codeline" data-linenumber="283"><td class="num" id="LN283">283</td><td class="line">                chainstate-&gt;ForceFlushStateToDisk();</td></tr>
<tr class="codeline" data-linenumber="284"><td class="num" id="LN284">284</td><td class="line">                chainstate-&gt;ResetCoinsViews();</td></tr>
<tr class="codeline" data-linenumber="285"><td class="num" id="LN285">285</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="286"><td class="num" id="LN286">286</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="287"><td class="num" id="LN287">287</td><td class="line">        pblocktree.reset();</td></tr>
<tr class="codeline" data-linenumber="288"><td class="num" id="LN288">288</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="289"><td class="num" id="LN289">289</td><td class="line">    <span class='keyword'>for</span> (<span class='keyword'>const</span> <span class='keyword'>auto</span>&amp; client : node.chain_clients) {</td></tr>
<tr class="codeline" data-linenumber="290"><td class="num" id="LN290">290</td><td class="line">        client-&gt;stop();</td></tr>
<tr class="codeline" data-linenumber="291"><td class="num" id="LN291">291</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="292"><td class="num" id="LN292">292</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="293"><td class="num" id="LN293">293</td><td class="line"><span class='directive'>#if <span class='macro'>ENABLE_ZMQ<span class='macro_popup'>0</span></span></span></td></tr>
<tr class="codeline" data-linenumber="294"><td class="num" id="LN294">294</td><td class="line">    <span class='keyword'>if</span> (g_zmq_notification_interface) {</td></tr>
<tr class="codeline" data-linenumber="295"><td class="num" id="LN295">295</td><td class="line">        UnregisterValidationInterface(g_zmq_notification_interface);</td></tr>
<tr class="codeline" data-linenumber="296"><td class="num" id="LN296">296</td><td class="line">        <span class='keyword'>delete</span> g_zmq_notification_interface;</td></tr>
<tr class="codeline" data-linenumber="297"><td class="num" id="LN297">297</td><td class="line">        g_zmq_notification_interface = <span class='keyword'>nullptr</span>;</td></tr>
<tr class="codeline" data-linenumber="298"><td class="num" id="LN298">298</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="299"><td class="num" id="LN299">299</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="300"><td class="num" id="LN300">300</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="301"><td class="num" id="LN301">301</td><td class="line">    node.chain_clients.clear();</td></tr>
<tr class="codeline" data-linenumber="302"><td class="num" id="LN302">302</td><td class="line">    UnregisterAllValidationInterfaces();</td></tr>
<tr class="codeline" data-linenumber="303"><td class="num" id="LN303">303</td><td class="line">    GetMainSignals().UnregisterBackgroundSignalScheduler();</td></tr>
<tr class="codeline" data-linenumber="304"><td class="num" id="LN304">304</td><td class="line">    globalVerifyHandle.reset();</td></tr>
<tr class="codeline" data-linenumber="305"><td class="num" id="LN305">305</td><td class="line">    ECC_Stop();</td></tr>
<tr class="codeline" data-linenumber="306"><td class="num" id="LN306">306</td><td class="line">    node.mempool.reset();</td></tr>
<tr class="codeline" data-linenumber="307"><td class="num" id="LN307">307</td><td class="line">    node.chainman = <span class='keyword'>nullptr</span>;</td></tr>
<tr class="codeline" data-linenumber="308"><td class="num" id="LN308">308</td><td class="line">    node.scheduler.reset();</td></tr>
<tr class="codeline" data-linenumber="309"><td class="num" id="LN309">309</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="310"><td class="num" id="LN310">310</td><td class="line">    <span class='keyword'>try</span> {</td></tr>
<tr class="codeline" data-linenumber="311"><td class="num" id="LN311">311</td><td class="line">        <span class='keyword'>if</span> (!fs::remove(GetPidFile(*node.args))) {</td></tr>
<tr class="codeline" data-linenumber="312"><td class="num" id="LN312">312</td><td class="line">            LogPrintf(<span class='string_literal'>"%s: Unable to remove PID file: File does not exist\n"</span>, <span class='keyword'>__func__</span>);</td></tr>
<tr class="codeline" data-linenumber="313"><td class="num" id="LN313">313</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="314"><td class="num" id="LN314">314</td><td class="line">    } <span class='keyword'>catch</span> (<span class='keyword'>const</span> fs::filesystem_error&amp; e) {</td></tr>
<tr class="codeline" data-linenumber="315"><td class="num" id="LN315">315</td><td class="line">        LogPrintf(<span class='string_literal'>"%s: Unable to remove PID file: %s\n"</span>, <span class='keyword'>__func__</span>, fsbridge::get_filesystem_error_message(e));</td></tr>
<tr class="codeline" data-linenumber="316"><td class="num" id="LN316">316</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="317"><td class="num" id="LN317">317</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="318"><td class="num" id="LN318">318</td><td class="line">    node.args = <span class='keyword'>nullptr</span>;</td></tr>
<tr class="codeline" data-linenumber="319"><td class="num" id="LN319">319</td><td class="line">    LogPrintf(<span class='string_literal'>"%s: done\n"</span>, <span class='keyword'>__func__</span>);</td></tr>
<tr class="codeline" data-linenumber="320"><td class="num" id="LN320">320</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="321"><td class="num" id="LN321">321</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="322"><td class="num" id="LN322">322</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr class="codeline" data-linenumber="323"><td class="num" id="LN323">323</td><td class="line"> <span class='comment'>* Signal handlers are very limited in what they are allowed to do.</span></td></tr>
<tr class="codeline" data-linenumber="324"><td class="num" id="LN324">324</td><td class="line"> <span class='comment'>* The execution context the handler is invoked in is not guaranteed,</span></td></tr>
<tr class="codeline" data-linenumber="325"><td class="num" id="LN325">325</td><td class="line"> <span class='comment'>* so we restrict handler operations to just touching variables:</span></td></tr>
<tr class="codeline" data-linenumber="326"><td class="num" id="LN326">326</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="327"><td class="num" id="LN327">327</td><td class="line"><span class='directive'>#ifndef WIN32</span></td></tr>
<tr class="codeline" data-linenumber="328"><td class="num" id="LN328">328</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> HandleSIGTERM(<span class='keyword'>int</span>)</td></tr>
<tr class="codeline" data-linenumber="329"><td class="num" id="LN329">329</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="330"><td class="num" id="LN330">330</td><td class="line">    StartShutdown();</td></tr>
<tr class="codeline" data-linenumber="331"><td class="num" id="LN331">331</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="332"><td class="num" id="LN332">332</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="333"><td class="num" id="LN333">333</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> HandleSIGHUP(<span class='keyword'>int</span>)</td></tr>
<tr class="codeline" data-linenumber="334"><td class="num" id="LN334">334</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="335"><td class="num" id="LN335">335</td><td class="line">    LogInstance().m_reopen_file = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="336"><td class="num" id="LN336">336</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="337"><td class="num" id="LN337">337</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="338"><td class="num" id="LN338">338</td><td class="line"><span class='keyword'>static</span> BOOL WINAPI consoleCtrlHandler(DWORD dwCtrlType)</td></tr>
<tr class="codeline" data-linenumber="339"><td class="num" id="LN339">339</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="340"><td class="num" id="LN340">340</td><td class="line">    StartShutdown();</td></tr>
<tr class="codeline" data-linenumber="341"><td class="num" id="LN341">341</td><td class="line">    Sleep(INFINITE);</td></tr>
<tr class="codeline" data-linenumber="342"><td class="num" id="LN342">342</td><td class="line">    <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="343"><td class="num" id="LN343">343</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="344"><td class="num" id="LN344">344</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="345"><td class="num" id="LN345">345</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="346"><td class="num" id="LN346">346</td><td class="line"><span class='directive'>#ifndef WIN32</span></td></tr>
<tr class="codeline" data-linenumber="347"><td class="num" id="LN347">347</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> registerSignalHandler(<span class='keyword'>int</span> signal, <span class='keyword'>void</span>(*handler)(<span class='keyword'>int</span>))</td></tr>
<tr class="codeline" data-linenumber="348"><td class="num" id="LN348">348</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="349"><td class="num" id="LN349">349</td><td class="line">    <span class='keyword'>struct</span> sigaction sa;</td></tr>
<tr class="codeline" data-linenumber="350"><td class="num" id="LN350">350</td><td class="line">    sa.<span class='macro'>sa_handler<span class='macro_popup'>__sigaction_handler.sa_handler</span></span> = handler;</td></tr>
<tr class="codeline" data-linenumber="351"><td class="num" id="LN351">351</td><td class="line">    sigemptyset(&amp;sa.sa_mask);</td></tr>
<tr class="codeline" data-linenumber="352"><td class="num" id="LN352">352</td><td class="line">    sa.sa_flags = 0;</td></tr>
<tr class="codeline" data-linenumber="353"><td class="num" id="LN353">353</td><td class="line">    sigaction(signal, &amp;sa, <span class='keyword'>nullptr</span>);</td></tr>
<tr class="codeline" data-linenumber="354"><td class="num" id="LN354">354</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="355"><td class="num" id="LN355">355</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="356"><td class="num" id="LN356">356</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="357"><td class="num" id="LN357">357</td><td class="line"><span class='keyword'>static</span> boost::signals2::connection rpc_notify_block_change_connection;</td></tr>
<tr class="codeline" data-linenumber="358"><td class="num" id="LN358">358</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> OnRPCStarted()</td></tr>
<tr class="codeline" data-linenumber="359"><td class="num" id="LN359">359</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="360"><td class="num" id="LN360">360</td><td class="line">    rpc_notify_block_change_connection = uiInterface.NotifyBlockTip_connect(std::bind(RPCNotifyBlockChange, std::placeholders::_2));</td></tr>
<tr class="codeline" data-linenumber="361"><td class="num" id="LN361">361</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="362"><td class="num" id="LN362">362</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="363"><td class="num" id="LN363">363</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> OnRPCStopped()</td></tr>
<tr class="codeline" data-linenumber="364"><td class="num" id="LN364">364</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="365"><td class="num" id="LN365">365</td><td class="line">    rpc_notify_block_change_connection.disconnect();</td></tr>
<tr class="codeline" data-linenumber="366"><td class="num" id="LN366">366</td><td class="line">    RPCNotifyBlockChange(<span class='keyword'>nullptr</span>);</td></tr>
<tr class="codeline" data-linenumber="367"><td class="num" id="LN367">367</td><td class="line">    g_best_block_cv.notify_all();</td></tr>
<tr class="codeline" data-linenumber="368"><td class="num" id="LN368">368</td><td class="line">    <span class='macro'>LogPrint(BCLog::RPC, <span class='string_literal'>"RPC stopped.\n"</span>)<span class='macro_popup'>do { if (LogAcceptCategory((BCLog::RPC))) { LogPrintf("RPC stopped.\n"<br>); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="369"><td class="num" id="LN369">369</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="370"><td class="num" id="LN370">370</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="371"><td class="num" id="LN371">371</td><td class="line"><span class='keyword'>void</span> SetupServerArgs(NodeContext&amp; node)</td></tr>
<tr class="codeline" data-linenumber="372"><td class="num" id="LN372">372</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="373"><td class="num" id="LN373">373</td><td class="line">    <span class='macro'>assert(!node.args)<span class='macro_popup'>(static_cast &lt;bool&gt; (!node.args) ? void (0) : __assert_fail<br> ("!node.args", "init.cpp", 373, __extension__ __PRETTY_FUNCTION__<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="374"><td class="num" id="LN374">374</td><td class="line">    node.args = &amp;gArgs;</td></tr>
<tr class="codeline" data-linenumber="375"><td class="num" id="LN375">375</td><td class="line">    ArgsManager&amp; argsman = *node.args;</td></tr>
<tr class="codeline" data-linenumber="376"><td class="num" id="LN376">376</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="377"><td class="num" id="LN377">377</td><td class="line">    SetupHelpOptions(argsman);</td></tr>
<tr class="codeline" data-linenumber="378"><td class="num" id="LN378">378</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-help-debug"</span>, <span class='string_literal'>"Print help message with debugging options and exit"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST); <span class='comment'>// server-only for now</span></td></tr>
<tr class="codeline" data-linenumber="379"><td class="num" id="LN379">379</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="380"><td class="num" id="LN380">380</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>auto</span> defaultBaseParams = CreateBaseChainParams(CBaseChainParams::MAIN);</td></tr>
<tr class="codeline" data-linenumber="381"><td class="num" id="LN381">381</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>auto</span> testnetBaseParams = CreateBaseChainParams(CBaseChainParams::TESTNET);</td></tr>
<tr class="codeline" data-linenumber="382"><td class="num" id="LN382">382</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>auto</span> signetBaseParams = CreateBaseChainParams(CBaseChainParams::SIGNET);</td></tr>
<tr class="codeline" data-linenumber="383"><td class="num" id="LN383">383</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>auto</span> regtestBaseParams = CreateBaseChainParams(CBaseChainParams::REGTEST);</td></tr>
<tr class="codeline" data-linenumber="384"><td class="num" id="LN384">384</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>auto</span> defaultChainParams = CreateChainParams(argsman, CBaseChainParams::MAIN);</td></tr>
<tr class="codeline" data-linenumber="385"><td class="num" id="LN385">385</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>auto</span> testnetChainParams = CreateChainParams(argsman, CBaseChainParams::TESTNET);</td></tr>
<tr class="codeline" data-linenumber="386"><td class="num" id="LN386">386</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>auto</span> signetChainParams = CreateChainParams(argsman, CBaseChainParams::SIGNET);</td></tr>
<tr class="codeline" data-linenumber="387"><td class="num" id="LN387">387</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>auto</span> regtestChainParams = CreateChainParams(argsman, CBaseChainParams::REGTEST);</td></tr>
<tr class="codeline" data-linenumber="388"><td class="num" id="LN388">388</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="389"><td class="num" id="LN389">389</td><td class="line">    <span class='comment'>// Hidden Options</span></td></tr>
<tr class="codeline" data-linenumber="390"><td class="num" id="LN390">390</td><td class="line">    std::vector&lt;std::string&gt; hidden_args = {</td></tr>
<tr class="codeline" data-linenumber="391"><td class="num" id="LN391">391</td><td class="line">        <span class='string_literal'>"-dbcrashratio"</span>, <span class='string_literal'>"-forcecompactdb"</span>,</td></tr>
<tr class="codeline" data-linenumber="392"><td class="num" id="LN392">392</td><td class="line">        <span class='comment'>// GUI args. These will be overwritten by SetupUIArgs for the GUI</span></td></tr>
<tr class="codeline" data-linenumber="393"><td class="num" id="LN393">393</td><td class="line">        <span class='string_literal'>"-choosedatadir"</span>, <span class='string_literal'>"-lang=&lt;lang&gt;"</span>, <span class='string_literal'>"-min"</span>, <span class='string_literal'>"-resetguisettings"</span>, <span class='string_literal'>"-splash"</span>, <span class='string_literal'>"-uiplatform"</span>};</td></tr>
<tr class="codeline" data-linenumber="394"><td class="num" id="LN394">394</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="395"><td class="num" id="LN395">395</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-version"</span>, <span class='string_literal'>"Print version and exit"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="396"><td class="num" id="LN396">396</td><td class="line"><span class='directive'>#if <span class='macro'>HAVE_SYSTEM<span class='macro_popup'>1 || HAVE_WSYSTEM</span></span></span></td></tr>
<tr class="codeline" data-linenumber="397"><td class="num" id="LN397">397</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-alertnotify=&lt;cmd&gt;"</span>, <span class='string_literal'>"Execute command when a relevant alert is received or we see a really long fork (%s in cmd is replaced by message)"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="398"><td class="num" id="LN398">398</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="399"><td class="num" id="LN399">399</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-assumevalid=&lt;hex&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"If this block is in the chain assume that it and its ancestors are valid and potentially skip their script verification (0 to verify all, default: %s, testnet: %s, signet: %s)"</span>, defaultChainParams-&gt;GetConsensus().defaultAssumeValid.GetHex(), testnetChainParams-&gt;GetConsensus().defaultAssumeValid.GetHex(), signetChainParams-&gt;GetConsensus().defaultAssumeValid.GetHex()), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="400"><td class="num" id="LN400">400</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-blocksdir=&lt;dir&gt;"</span>, <span class='string_literal'>"Specify directory to hold blocks subdirectory for *.dat files (default: &lt;datadir&gt;)"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="401"><td class="num" id="LN401">401</td><td class="line"><span class='directive'>#if <span class='macro'>HAVE_SYSTEM<span class='macro_popup'>1 || HAVE_WSYSTEM</span></span></span></td></tr>
<tr class="codeline" data-linenumber="402"><td class="num" id="LN402">402</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-blocknotify=&lt;cmd&gt;"</span>, <span class='string_literal'>"Execute command when the best block changes (%s in cmd is replaced by block hash)"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="403"><td class="num" id="LN403">403</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="404"><td class="num" id="LN404">404</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-blockreconstructionextratxn=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Extra transactions to keep in memory for compact block reconstructions (default: %u)"</span>, DEFAULT_BLOCK_RECONSTRUCTION_EXTRA_TXN), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="405"><td class="num" id="LN405">405</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-blocksonly"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Whether to reject transactions from network peers. Automatic broadcast and rebroadcast of any transactions from inbound peers is disabled, unless the peer has the 'forcerelay' permission. RPC transactions are not affected. (default: %u)"</span>, DEFAULT_BLOCKSONLY), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="406"><td class="num" id="LN406">406</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-conf=&lt;file&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Specify path to read-only configuration file. Relative paths will be prefixed by datadir location. (default: %s)"</span>, BITCOIN_CONF_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="407"><td class="num" id="LN407">407</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-datadir=&lt;dir&gt;"</span>, <span class='string_literal'>"Specify data directory"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="408"><td class="num" id="LN408">408</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-dbbatchsize"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Maximum database write batch size in bytes (default: %u)"</span>, nDefaultDbBatchSize), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="409"><td class="num" id="LN409">409</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-dbcache=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Maximum database cache size &lt;n&gt; MiB (%d to %d, default: %d). In addition, unused mempool memory is shared for this cache (see -maxmempool)."</span>, nMinDbCache, nMaxDbCache, nDefaultDbCache), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="410"><td class="num" id="LN410">410</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-debuglogfile=&lt;file&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Specify location of debug log file. Relative paths will be prefixed by a net-specific datadir location. (-nodebuglogfile to disable; default: %s)"</span>, DEFAULT_DEBUGLOGFILE), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="411"><td class="num" id="LN411">411</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-feefilter"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Tell other nodes to filter invs to us by our mempool min fee (default: %u)"</span>, DEFAULT_FEEFILTER), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="412"><td class="num" id="LN412">412</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-includeconf=&lt;file&gt;"</span>, <span class='string_literal'>"Specify additional configuration file, relative to the -datadir path (only useable from configuration file, not command line)"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="413"><td class="num" id="LN413">413</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-loadblock=&lt;file&gt;"</span>, <span class='string_literal'>"Imports blocks from external file on startup"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="414"><td class="num" id="LN414">414</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-maxmempool=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Keep the transaction memory pool below &lt;n&gt; megabytes (default: %u)"</span>, DEFAULT_MAX_MEMPOOL_SIZE), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="415"><td class="num" id="LN415">415</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-maxorphantx=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Keep at most &lt;n&gt; unconnectable transactions in memory (default: %u)"</span>, DEFAULT_MAX_ORPHAN_TRANSACTIONS), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="416"><td class="num" id="LN416">416</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-mempoolexpiry=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Do not keep transactions in the mempool longer than &lt;n&gt; hours (default: %u)"</span>, DEFAULT_MEMPOOL_EXPIRY), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="417"><td class="num" id="LN417">417</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-minimumchainwork=&lt;hex&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Minimum work assumed to exist on a valid chain in hex (default: %s, testnet: %s, signet: %s)"</span>, defaultChainParams-&gt;GetConsensus().nMinimumChainWork.GetHex(), testnetChainParams-&gt;GetConsensus().nMinimumChainWork.GetHex(), signetChainParams-&gt;GetConsensus().nMinimumChainWork.GetHex()), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="418"><td class="num" id="LN418">418</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-par=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Set the number of script verification threads (%u to %d, 0 = auto, &lt;0 = leave that many cores free, default: %d)"</span>,</td></tr>
<tr class="codeline" data-linenumber="419"><td class="num" id="LN419">419</td><td class="line">        -GetNumCores(), MAX_SCRIPTCHECK_THREADS, DEFAULT_SCRIPTCHECK_THREADS), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="420"><td class="num" id="LN420">420</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-persistmempool"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Whether to save the mempool on shutdown and load on restart (default: %u)"</span>, DEFAULT_PERSIST_MEMPOOL), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="421"><td class="num" id="LN421">421</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-pid=&lt;file&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Specify pid file. Relative paths will be prefixed by a net-specific datadir location. (default: %s)"</span>, BITCOIN_PID_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="422"><td class="num" id="LN422">422</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-prune=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Reduce storage requirements by enabling pruning (deleting) of old blocks. This allows the pruneblockchain RPC to be called to delete specific blocks, and enables automatic pruning of old blocks if a target size in MiB is provided. This mode is incompatible with -txindex and -rescan. "</span></td></tr>
<tr class="codeline" data-linenumber="423"><td class="num" id="LN423">423</td><td class="line">            <span class='string_literal'>"Warning: Reverting this setting requires re-downloading the entire blockchain. "</span></td></tr>
<tr class="codeline" data-linenumber="424"><td class="num" id="LN424">424</td><td class="line">            <span class='string_literal'>"(default: 0 = disable pruning blocks, 1 = allow manual pruning via RPC, &gt;=%u = automatically prune block files to stay under the specified target size in MiB)"</span>, MIN_DISK_SPACE_FOR_BLOCK_FILES / 1024 / 1024), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="425"><td class="num" id="LN425">425</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-reindex"</span>, <span class='string_literal'>"Rebuild chain state and block index from the blk*.dat files on disk"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="426"><td class="num" id="LN426">426</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-reindex-chainstate"</span>, <span class='string_literal'>"Rebuild chain state from the currently indexed blocks. When in pruning mode or if blocks on disk might be corrupted, use full -reindex instead."</span>, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="427"><td class="num" id="LN427">427</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-settings=&lt;file&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Specify path to dynamic settings data file. Can be disabled with -nosettings. File is written at runtime and not meant to be edited by users (use %s instead for custom settings). Relative paths will be prefixed by datadir location. (default: %s)"</span>, BITCOIN_CONF_FILENAME, BITCOIN_SETTINGS_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="428"><td class="num" id="LN428">428</td><td class="line"><span class='directive'>#if <span class='macro'>HAVE_SYSTEM<span class='macro_popup'>1 || HAVE_WSYSTEM</span></span></span></td></tr>
<tr class="codeline" data-linenumber="429"><td class="num" id="LN429">429</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-startupnotify=&lt;cmd&gt;"</span>, <span class='string_literal'>"Execute command on startup."</span>, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="430"><td class="num" id="LN430">430</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="431"><td class="num" id="LN431">431</td><td class="line"><span class='directive'>#ifndef WIN32</span></td></tr>
<tr class="codeline" data-linenumber="432"><td class="num" id="LN432">432</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-sysperms"</span>, <span class='string_literal'>"Create new files with system default permissions, instead of umask 077 (only effective with disabled wallet functionality)"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="433"><td class="num" id="LN433">433</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="434"><td class="num" id="LN434">434</td><td class="line">    hidden_args.emplace_back(<span class='string_literal'>"-sysperms"</span>);</td></tr>
<tr class="codeline" data-linenumber="435"><td class="num" id="LN435">435</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="436"><td class="num" id="LN436">436</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-txindex"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Maintain a full transaction index, used by the getrawtransaction rpc call (default: %u)"</span>, DEFAULT_TXINDEX), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="437"><td class="num" id="LN437">437</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-blockfilterindex=&lt;type&gt;"</span>,</td></tr>
<tr class="codeline" data-linenumber="438"><td class="num" id="LN438">438</td><td class="line">                 <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Maintain an index of compact filters by block (default: %s, values: %s)."</span>, DEFAULT_BLOCKFILTERINDEX, ListBlockFilterTypes()) +</td></tr>
<tr class="codeline" data-linenumber="439"><td class="num" id="LN439">439</td><td class="line">                 <span class='string_literal'>" If &lt;type&gt; is not supplied or if &lt;type&gt; = 1, indexes for all known types are enabled."</span>,</td></tr>
<tr class="codeline" data-linenumber="440"><td class="num" id="LN440">440</td><td class="line">                 ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="441"><td class="num" id="LN441">441</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="442"><td class="num" id="LN442">442</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-addnode=&lt;ip&gt;"</span>, <span class='string_literal'>"Add a node to connect to and attempt to keep the connection open (see the `addnode` RPC command help for more info). This option can be specified multiple times to add multiple nodes."</span>, ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="443"><td class="num" id="LN443">443</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-asmap=&lt;file&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Specify asn mapping used for bucketing of the peers (default: %s). Relative paths will be prefixed by the net-specific datadir location."</span>, DEFAULT_ASMAP_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="444"><td class="num" id="LN444">444</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-bantime=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Default duration (in seconds) of manually configured bans (default: %u)"</span>, DEFAULT_MISBEHAVING_BANTIME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="445"><td class="num" id="LN445">445</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-bind=&lt;addr&gt;[:&lt;port&gt;][=onion]"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Bind to given address and always listen on it (default: 0.0.0.0). Use [host]:port notation for IPv6. Append =onion to tag any incoming connections to that address and port as incoming Tor connections (default: 127.0.0.1:%u=onion, testnet: 127.0.0.1:%u=onion, signet: 127.0.0.1:%u=onion, regtest: 127.0.0.1:%u=onion)"</span>, defaultBaseParams-&gt;OnionServiceTargetPort(), testnetBaseParams-&gt;OnionServiceTargetPort(), signetBaseParams-&gt;OnionServiceTargetPort(), regtestBaseParams-&gt;OnionServiceTargetPort()), ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="446"><td class="num" id="LN446">446</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-connect=&lt;ip&gt;"</span>, <span class='string_literal'>"Connect only to the specified node; -noconnect disables automatic connections (the rules for this peer are the same as for -addnode). This option can be specified multiple times to connect to multiple nodes."</span>, ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="447"><td class="num" id="LN447">447</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-discover"</span>, <span class='string_literal'>"Discover own IP addresses (default: 1 when listening and no -externalip or -proxy)"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="448"><td class="num" id="LN448">448</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-dns"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Allow DNS lookups for -addnode, -seednode and -connect (default: %u)"</span>, DEFAULT_NAME_LOOKUP), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="449"><td class="num" id="LN449">449</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-dnsseed"</span>, <span class='string_literal'>"Query for peer addresses via DNS lookup, if low on addresses (default: 1 unless -connect used)"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="450"><td class="num" id="LN450">450</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-externalip=&lt;ip&gt;"</span>, <span class='string_literal'>"Specify your own public address"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="451"><td class="num" id="LN451">451</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-forcednsseed"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Always query for peer addresses via DNS lookup (default: %u)"</span>, DEFAULT_FORCEDNSSEED), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="452"><td class="num" id="LN452">452</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-listen"</span>, <span class='string_literal'>"Accept connections from outside (default: 1 if no -proxy or -connect)"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="453"><td class="num" id="LN453">453</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-listenonion"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Automatically create Tor onion service (default: %d)"</span>, DEFAULT_LISTEN_ONION), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="454"><td class="num" id="LN454">454</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-maxconnections=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Maintain at most &lt;n&gt; connections to peers (default: %u)"</span>, DEFAULT_MAX_PEER_CONNECTIONS), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="455"><td class="num" id="LN455">455</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-maxreceivebuffer=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Maximum per-connection receive buffer, &lt;n&gt;*1000 bytes (default: %u)"</span>, DEFAULT_MAXRECEIVEBUFFER), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="456"><td class="num" id="LN456">456</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-maxsendbuffer=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Maximum per-connection send buffer, &lt;n&gt;*1000 bytes (default: %u)"</span>, DEFAULT_MAXSENDBUFFER), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="457"><td class="num" id="LN457">457</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-maxtimeadjustment"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Maximum allowed median peer time offset adjustment. Local perspective of time may be influenced by peers forward or backward by this amount. (default: %u seconds)"</span>, DEFAULT_MAX_TIME_ADJUSTMENT), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="458"><td class="num" id="LN458">458</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-maxuploadtarget=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Tries to keep outbound traffic under the given target (in MiB per 24h). Limit does not apply to peers with 'download' permission. 0 = no limit (default: %d)"</span>, DEFAULT_MAX_UPLOAD_TARGET), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="459"><td class="num" id="LN459">459</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-onion=&lt;ip:port&gt;"</span>, <span class='string_literal'>"Use separate SOCKS5 proxy to reach peers via Tor onion services, set -noonion to disable (default: -proxy)"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="460"><td class="num" id="LN460">460</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-onlynet=&lt;net&gt;"</span>, <span class='string_literal'>"Make outgoing connections only through network &lt;net&gt; (ipv4, ipv6 or onion). Incoming connections are not affected by this option. This option can be specified multiple times to allow multiple networks."</span>, ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="461"><td class="num" id="LN461">461</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-peerbloomfilters"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Support filtering of blocks and transaction with bloom filters (default: %u)"</span>, DEFAULT_PEERBLOOMFILTERS), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="462"><td class="num" id="LN462">462</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-peerblockfilters"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Serve compact block filters to peers per BIP 157 (default: %u)"</span>, DEFAULT_PEERBLOCKFILTERS), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="463"><td class="num" id="LN463">463</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-permitbaremultisig"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Relay non-P2SH multisig (default: %u)"</span>, DEFAULT_PERMIT_BAREMULTISIG), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="464"><td class="num" id="LN464">464</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-port=&lt;port&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Listen for connections on &lt;port&gt;. Nodes not using the default ports (default: %u, testnet: %u, signet: %u, regtest: %u) are unlikely to get incoming connections."</span>, defaultChainParams-&gt;GetDefaultPort(), testnetChainParams-&gt;GetDefaultPort(), signetChainParams-&gt;GetDefaultPort(), regtestChainParams-&gt;GetDefaultPort()), ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="465"><td class="num" id="LN465">465</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-proxy=&lt;ip:port&gt;"</span>, <span class='string_literal'>"Connect through SOCKS5 proxy, set -noproxy to disable (default: disabled)"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="466"><td class="num" id="LN466">466</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-proxyrandomize"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Randomize credentials for every proxy connection. This enables Tor stream isolation (default: %u)"</span>, DEFAULT_PROXYRANDOMIZE), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="467"><td class="num" id="LN467">467</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-seednode=&lt;ip&gt;"</span>, <span class='string_literal'>"Connect to a node to retrieve peer addresses, and disconnect. This option can be specified multiple times to connect to multiple nodes."</span>, ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="468"><td class="num" id="LN468">468</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-networkactive"</span>, <span class='string_literal'>"Enable all P2P network activity (default: 1). Can be changed by the setnetworkactive RPC command"</span>, ArgsManager::ALLOW_BOOL, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="469"><td class="num" id="LN469">469</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-timeout=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Specify connection timeout in milliseconds (minimum: 1, default: %d)"</span>, DEFAULT_CONNECT_TIMEOUT), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="470"><td class="num" id="LN470">470</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-peertimeout=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Specify p2p connection timeout in seconds. This option determines the amount of time a peer may be inactive before the connection to it is dropped. (minimum: 1, default: %d)"</span>, DEFAULT_PEER_CONNECT_TIMEOUT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="471"><td class="num" id="LN471">471</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-torcontrol=&lt;ip&gt;:&lt;port&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Tor control port to use if onion listening enabled (default: %s)"</span>, DEFAULT_TOR_CONTROL), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="472"><td class="num" id="LN472">472</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-torpassword=&lt;pass&gt;"</span>, <span class='string_literal'>"Tor control port password (default: empty)"</span>, ArgsManager::ALLOW_ANY | ArgsManager::SENSITIVE, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="473"><td class="num" id="LN473">473</td><td class="line"><span class='directive'>#ifdef USE_UPNP</span></td></tr>
<tr class="codeline" data-linenumber="474"><td class="num" id="LN474">474</td><td class="line"><span class='directive'>#if USE_UPNP</span></td></tr>
<tr class="codeline" data-linenumber="475"><td class="num" id="LN475">475</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-upnp"</span>, <span class='string_literal'>"Use UPnP to map the listening port (default: 1 when listening and no -proxy)"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="476"><td class="num" id="LN476">476</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="477"><td class="num" id="LN477">477</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-upnp"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Use UPnP to map the listening port (default: %u)"</span>, 0), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="478"><td class="num" id="LN478">478</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="479"><td class="num" id="LN479">479</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="480"><td class="num" id="LN480">480</td><td class="line">    hidden_args.emplace_back(<span class='string_literal'>"-upnp"</span>);</td></tr>
<tr class="codeline" data-linenumber="481"><td class="num" id="LN481">481</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="482"><td class="num" id="LN482">482</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-whitebind=&lt;[permissions@]addr&gt;"</span>, <span class='string_literal'>"Bind to the given address and add permission flags to the peers connecting to it. "</span></td></tr>
<tr class="codeline" data-linenumber="483"><td class="num" id="LN483">483</td><td class="line">        <span class='string_literal'>"Use [host]:port notation for IPv6. Allowed permissions: "</span> + Join(NET_PERMISSIONS_DOC, <span class='string_literal'>", "</span>) + <span class='string_literal'>". "</span></td></tr>
<tr class="codeline" data-linenumber="484"><td class="num" id="LN484">484</td><td class="line">        <span class='string_literal'>"Specify multiple permissions separated by commas (default: download,noban,mempool,relay). Can be specified multiple times."</span>, ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="485"><td class="num" id="LN485">485</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="486"><td class="num" id="LN486">486</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-whitelist=&lt;[permissions@]IP address or network&gt;"</span>, <span class='string_literal'>"Add permission flags to the peers connecting from the given IP address (e.g. 1.2.3.4) or "</span></td></tr>
<tr class="codeline" data-linenumber="487"><td class="num" id="LN487">487</td><td class="line">        <span class='string_literal'>"CIDR-notated network (e.g. 1.2.3.0/24). Uses the same permissions as "</span></td></tr>
<tr class="codeline" data-linenumber="488"><td class="num" id="LN488">488</td><td class="line">        <span class='string_literal'>"-whitebind. Can be specified multiple times."</span> , ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</td></tr>
<tr class="codeline" data-linenumber="489"><td class="num" id="LN489">489</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="490"><td class="num" id="LN490">490</td><td class="line">    g_wallet_init_interface.AddWalletOptions(argsman);</td></tr>
<tr class="codeline" data-linenumber="491"><td class="num" id="LN491">491</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="492"><td class="num" id="LN492">492</td><td class="line"><span class='directive'>#if <span class='macro'>ENABLE_ZMQ<span class='macro_popup'>0</span></span></span></td></tr>
<tr class="codeline" data-linenumber="493"><td class="num" id="LN493">493</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-zmqpubhashblock=&lt;address&gt;"</span>, <span class='string_literal'>"Enable publish hash block in &lt;address&gt;"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);</td></tr>
<tr class="codeline" data-linenumber="494"><td class="num" id="LN494">494</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-zmqpubhashtx=&lt;address&gt;"</span>, <span class='string_literal'>"Enable publish hash transaction in &lt;address&gt;"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);</td></tr>
<tr class="codeline" data-linenumber="495"><td class="num" id="LN495">495</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-zmqpubrawblock=&lt;address&gt;"</span>, <span class='string_literal'>"Enable publish raw block in &lt;address&gt;"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);</td></tr>
<tr class="codeline" data-linenumber="496"><td class="num" id="LN496">496</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-zmqpubrawtx=&lt;address&gt;"</span>, <span class='string_literal'>"Enable publish raw transaction in &lt;address&gt;"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);</td></tr>
<tr class="codeline" data-linenumber="497"><td class="num" id="LN497">497</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-zmqpubsequence=&lt;address&gt;"</span>, <span class='string_literal'>"Enable publish hash block and tx sequence in &lt;address&gt;"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);</td></tr>
<tr class="codeline" data-linenumber="498"><td class="num" id="LN498">498</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-zmqpubhashblockhwm=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Set publish hash block outbound message high water mark (default: %d)"</span>, CZMQAbstractNotifier::DEFAULT_ZMQ_SNDHWM), ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);</td></tr>
<tr class="codeline" data-linenumber="499"><td class="num" id="LN499">499</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-zmqpubhashtxhwm=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Set publish hash transaction outbound message high water mark (default: %d)"</span>, CZMQAbstractNotifier::DEFAULT_ZMQ_SNDHWM), ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);</td></tr>
<tr class="codeline" data-linenumber="500"><td class="num" id="LN500">500</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-zmqpubrawblockhwm=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Set publish raw block outbound message high water mark (default: %d)"</span>, CZMQAbstractNotifier::DEFAULT_ZMQ_SNDHWM), ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);</td></tr>
<tr class="codeline" data-linenumber="501"><td class="num" id="LN501">501</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-zmqpubrawtxhwm=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Set publish raw transaction outbound message high water mark (default: %d)"</span>, CZMQAbstractNotifier::DEFAULT_ZMQ_SNDHWM), ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);</td></tr>
<tr class="codeline" data-linenumber="502"><td class="num" id="LN502">502</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-zmqpubsequencehwm=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Set publish hash sequence message high water mark (default: %d)"</span>, CZMQAbstractNotifier::DEFAULT_ZMQ_SNDHWM), ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);</td></tr>
<tr class="codeline" data-linenumber="503"><td class="num" id="LN503">503</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="504"><td class="num" id="LN504">504</td><td class="line">    hidden_args.emplace_back(<span class='string_literal'>"-zmqpubhashblock=&lt;address&gt;"</span>);</td></tr>
<tr class="codeline" data-linenumber="505"><td class="num" id="LN505">505</td><td class="line">    hidden_args.emplace_back(<span class='string_literal'>"-zmqpubhashtx=&lt;address&gt;"</span>);</td></tr>
<tr class="codeline" data-linenumber="506"><td class="num" id="LN506">506</td><td class="line">    hidden_args.emplace_back(<span class='string_literal'>"-zmqpubrawblock=&lt;address&gt;"</span>);</td></tr>
<tr class="codeline" data-linenumber="507"><td class="num" id="LN507">507</td><td class="line">    hidden_args.emplace_back(<span class='string_literal'>"-zmqpubrawtx=&lt;address&gt;"</span>);</td></tr>
<tr class="codeline" data-linenumber="508"><td class="num" id="LN508">508</td><td class="line">    hidden_args.emplace_back(<span class='string_literal'>"-zmqpubsequence=&lt;n&gt;"</span>);</td></tr>
<tr class="codeline" data-linenumber="509"><td class="num" id="LN509">509</td><td class="line">    hidden_args.emplace_back(<span class='string_literal'>"-zmqpubhashblockhwm=&lt;n&gt;"</span>);</td></tr>
<tr class="codeline" data-linenumber="510"><td class="num" id="LN510">510</td><td class="line">    hidden_args.emplace_back(<span class='string_literal'>"-zmqpubhashtxhwm=&lt;n&gt;"</span>);</td></tr>
<tr class="codeline" data-linenumber="511"><td class="num" id="LN511">511</td><td class="line">    hidden_args.emplace_back(<span class='string_literal'>"-zmqpubrawblockhwm=&lt;n&gt;"</span>);</td></tr>
<tr class="codeline" data-linenumber="512"><td class="num" id="LN512">512</td><td class="line">    hidden_args.emplace_back(<span class='string_literal'>"-zmqpubrawtxhwm=&lt;n&gt;"</span>);</td></tr>
<tr class="codeline" data-linenumber="513"><td class="num" id="LN513">513</td><td class="line">    hidden_args.emplace_back(<span class='string_literal'>"-zmqpubsequencehwm=&lt;n&gt;"</span>);</td></tr>
<tr class="codeline" data-linenumber="514"><td class="num" id="LN514">514</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="515"><td class="num" id="LN515">515</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="516"><td class="num" id="LN516">516</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-checkblocks=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"How many blocks to check at startup (default: %u, 0 = all)"</span>, DEFAULT_CHECKBLOCKS), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="517"><td class="num" id="LN517">517</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-checklevel=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"How thorough the block verification of -checkblocks is: %s (0-4, default: %u)"</span>, Join(CHECKLEVEL_DOC, <span class='string_literal'>", "</span>), DEFAULT_CHECKLEVEL), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="518"><td class="num" id="LN518">518</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-checkblockindex"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Do a consistency check for the block tree, chainstate, and other validation data structures occasionally. (default: %u, regtest: %u)"</span>, defaultChainParams-&gt;DefaultConsistencyChecks(), regtestChainParams-&gt;DefaultConsistencyChecks()), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="519"><td class="num" id="LN519">519</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-checkmempool=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Run checks every &lt;n&gt; transactions (default: %u, regtest: %u)"</span>, defaultChainParams-&gt;DefaultConsistencyChecks(), regtestChainParams-&gt;DefaultConsistencyChecks()), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="520"><td class="num" id="LN520">520</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-checkpoints"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Enable rejection of any forks from the known historical chain until block %s (default: %u)"</span>, defaultChainParams-&gt;Checkpoints().GetHeight(), DEFAULT_CHECKPOINTS_ENABLED), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="521"><td class="num" id="LN521">521</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-deprecatedrpc=&lt;method&gt;"</span>, <span class='string_literal'>"Allows deprecated RPC method(s) to be used"</span>, ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="522"><td class="num" id="LN522">522</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-dropmessagestest=&lt;n&gt;"</span>, <span class='string_literal'>"Randomly drop 1 of every &lt;n&gt; network messages"</span>, ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="523"><td class="num" id="LN523">523</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-stopafterblockimport"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Stop running after importing blocks from disk (default: %u)"</span>, DEFAULT_STOPAFTERBLOCKIMPORT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="524"><td class="num" id="LN524">524</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-stopatheight"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Stop running after reaching the given height in the main chain (default: %u)"</span>, DEFAULT_STOPATHEIGHT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="525"><td class="num" id="LN525">525</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-limitancestorcount=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Do not accept transactions if number of in-mempool ancestors is &lt;n&gt; or more (default: %u)"</span>, DEFAULT_ANCESTOR_LIMIT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="526"><td class="num" id="LN526">526</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-limitancestorsize=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Do not accept transactions whose size with all in-mempool ancestors exceeds &lt;n&gt; kilobytes (default: %u)"</span>, DEFAULT_ANCESTOR_SIZE_LIMIT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="527"><td class="num" id="LN527">527</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-limitdescendantcount=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Do not accept transactions if any ancestor would have &lt;n&gt; or more in-mempool descendants (default: %u)"</span>, DEFAULT_DESCENDANT_LIMIT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="528"><td class="num" id="LN528">528</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-limitdescendantsize=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Do not accept transactions if any ancestor would have more than &lt;n&gt; kilobytes of in-mempool descendants (default: %u)."</span>, DEFAULT_DESCENDANT_SIZE_LIMIT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="529"><td class="num" id="LN529">529</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-addrmantest"</span>, <span class='string_literal'>"Allows to test address relay on localhost"</span>, ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="530"><td class="num" id="LN530">530</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-debug=&lt;category&gt;"</span>, <span class='string_literal'>"Output debugging information (default: -nodebug, supplying &lt;category&gt; is optional). "</span></td></tr>
<tr class="codeline" data-linenumber="531"><td class="num" id="LN531">531</td><td class="line">        <span class='string_literal'>"If &lt;category&gt; is not supplied or if &lt;category&gt; = 1, output all debugging information. &lt;category&gt; can be: "</span> + LogInstance().LogCategoriesString() + <span class='string_literal'>"."</span>,</td></tr>
<tr class="codeline" data-linenumber="532"><td class="num" id="LN532">532</td><td class="line">        ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="533"><td class="num" id="LN533">533</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-debugexclude=&lt;category&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Exclude debugging information for a category. Can be used in conjunction with -debug=1 to output debug logs for all categories except one or more specified categories."</span>), ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="534"><td class="num" id="LN534">534</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-logips"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Include IP addresses in debug output (default: %u)"</span>, DEFAULT_LOGIPS), ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="535"><td class="num" id="LN535">535</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-logtimestamps"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Prepend debug output with timestamp (default: %u)"</span>, DEFAULT_LOGTIMESTAMPS), ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="536"><td class="num" id="LN536">536</td><td class="line"><span class='directive'>#ifdef <span class='macro'>HAVE_THREAD_LOCAL<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="537"><td class="num" id="LN537">537</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-logthreadnames"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Prepend debug output with name of the originating thread (only available on platforms supporting thread_local) (default: %u)"</span>, DEFAULT_LOGTHREADNAMES), ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="538"><td class="num" id="LN538">538</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="539"><td class="num" id="LN539">539</td><td class="line">    hidden_args.emplace_back(<span class='string_literal'>"-logthreadnames"</span>);</td></tr>
<tr class="codeline" data-linenumber="540"><td class="num" id="LN540">540</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="541"><td class="num" id="LN541">541</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-logtimemicros"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Add microsecond precision to debug timestamps (default: %u)"</span>, DEFAULT_LOGTIMEMICROS), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="542"><td class="num" id="LN542">542</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-mocktime=&lt;n&gt;"</span>, <span class='string_literal'>"Replace actual time with "</span> + UNIX_EPOCH_TIME + <span class='string_literal'>" (default: 0)"</span>, ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="543"><td class="num" id="LN543">543</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-maxsigcachesize=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Limit sum of signature cache and script execution cache sizes to &lt;n&gt; MiB (default: %u)"</span>, DEFAULT_MAX_SIG_CACHE_SIZE), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="544"><td class="num" id="LN544">544</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-maxtipage=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Maximum tip age in seconds to consider node in initial block download (default: %u)"</span>, DEFAULT_MAX_TIP_AGE), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="545"><td class="num" id="LN545">545</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-printpriority"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Log transaction fee per kB when mining blocks (default: %u)"</span>, DEFAULT_PRINTPRIORITY), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="546"><td class="num" id="LN546">546</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-printtoconsole"</span>, <span class='string_literal'>"Send trace/debug info to console (default: 1 when no -daemon. To disable logging to file, set -nodebuglogfile)"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="547"><td class="num" id="LN547">547</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-shrinkdebugfile"</span>, <span class='string_literal'>"Shrink debug.log file on client startup (default: 1 when no -debug)"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="548"><td class="num" id="LN548">548</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-uacomment=&lt;cmt&gt;"</span>, <span class='string_literal'>"Append comment to the user agent string"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);</td></tr>
<tr class="codeline" data-linenumber="549"><td class="num" id="LN549">549</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="550"><td class="num" id="LN550">550</td><td class="line">    SetupChainParamsBaseOptions(argsman);</td></tr>
<tr class="codeline" data-linenumber="551"><td class="num" id="LN551">551</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="552"><td class="num" id="LN552">552</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-acceptnonstdtxn"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Relay and mine \"non-standard\" transactions (%sdefault: %u)"</span>, <span class='string_literal'>"testnet/regtest only; "</span>, !testnetChainParams-&gt;RequireStandard()), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::NODE_RELAY);</td></tr>
<tr class="codeline" data-linenumber="553"><td class="num" id="LN553">553</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-incrementalrelayfee=&lt;amt&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Fee rate (in %s/kB) used to define cost of relay, used for mempool limiting and BIP 125 replacement. (default: %s)"</span>, CURRENCY_UNIT, FormatMoney(DEFAULT_INCREMENTAL_RELAY_FEE)), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::NODE_RELAY);</td></tr>
<tr class="codeline" data-linenumber="554"><td class="num" id="LN554">554</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-dustrelayfee=&lt;amt&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Fee rate (in %s/kB) used to define dust, the value of an output such that it will cost more than its value in fees at this fee rate to spend it. (default: %s)"</span>, CURRENCY_UNIT, FormatMoney(DUST_RELAY_TX_FEE)), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::NODE_RELAY);</td></tr>
<tr class="codeline" data-linenumber="555"><td class="num" id="LN555">555</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-bytespersigop"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Equivalent bytes per sigop in transactions for relay and mining (default: %u)"</span>, DEFAULT_BYTES_PER_SIGOP), ArgsManager::ALLOW_ANY, OptionsCategory::NODE_RELAY);</td></tr>
<tr class="codeline" data-linenumber="556"><td class="num" id="LN556">556</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-datacarrier"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Relay and mine data carrier transactions (default: %u)"</span>, DEFAULT_ACCEPT_DATACARRIER), ArgsManager::ALLOW_ANY, OptionsCategory::NODE_RELAY);</td></tr>
<tr class="codeline" data-linenumber="557"><td class="num" id="LN557">557</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-datacarriersize"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Maximum size of data in data carrier transactions we relay and mine (default: %u)"</span>, MAX_OP_RETURN_RELAY), ArgsManager::ALLOW_ANY, OptionsCategory::NODE_RELAY);</td></tr>
<tr class="codeline" data-linenumber="558"><td class="num" id="LN558">558</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-minrelaytxfee=&lt;amt&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Fees (in %s/kB) smaller than this are considered zero fee for relaying, mining and transaction creation (default: %s)"</span>,</td></tr>
<tr class="codeline" data-linenumber="559"><td class="num" id="LN559">559</td><td class="line">        CURRENCY_UNIT, FormatMoney(DEFAULT_MIN_RELAY_TX_FEE)), ArgsManager::ALLOW_ANY, OptionsCategory::NODE_RELAY);</td></tr>
<tr class="codeline" data-linenumber="560"><td class="num" id="LN560">560</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-whitelistforcerelay"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Add 'forcerelay' permission to whitelisted inbound peers with default permissions. This will relay transactions even if the transactions were already in the mempool. (default: %d)"</span>, DEFAULT_WHITELISTFORCERELAY), ArgsManager::ALLOW_ANY, OptionsCategory::NODE_RELAY);</td></tr>
<tr class="codeline" data-linenumber="561"><td class="num" id="LN561">561</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-whitelistrelay"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Add 'relay' permission to whitelisted inbound peers with default permissions. This will accept relayed transactions even when not relaying transactions (default: %d)"</span>, DEFAULT_WHITELISTRELAY), ArgsManager::ALLOW_ANY, OptionsCategory::NODE_RELAY);</td></tr>
<tr class="codeline" data-linenumber="562"><td class="num" id="LN562">562</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="563"><td class="num" id="LN563">563</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="564"><td class="num" id="LN564">564</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-blockmaxweight=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Set maximum BIP141 block weight (default: %d)"</span>, DEFAULT_BLOCK_MAX_WEIGHT), ArgsManager::ALLOW_ANY, OptionsCategory::BLOCK_CREATION);</td></tr>
<tr class="codeline" data-linenumber="565"><td class="num" id="LN565">565</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-blockmintxfee=&lt;amt&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Set lowest fee rate (in %s/kB) for transactions to be included in block creation. (default: %s)"</span>, CURRENCY_UNIT, FormatMoney(DEFAULT_BLOCK_MIN_TX_FEE)), ArgsManager::ALLOW_ANY, OptionsCategory::BLOCK_CREATION);</td></tr>
<tr class="codeline" data-linenumber="566"><td class="num" id="LN566">566</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-blockversion=&lt;n&gt;"</span>, <span class='string_literal'>"Override block version to test forking scenarios"</span>, ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::BLOCK_CREATION);</td></tr>
<tr class="codeline" data-linenumber="567"><td class="num" id="LN567">567</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="568"><td class="num" id="LN568">568</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-rest"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Accept public REST requests (default: %u)"</span>, DEFAULT_REST_ENABLE), ArgsManager::ALLOW_ANY, OptionsCategory::RPC);</td></tr>
<tr class="codeline" data-linenumber="569"><td class="num" id="LN569">569</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-rpcallowip=&lt;ip&gt;"</span>, <span class='string_literal'>"Allow JSON-RPC connections from specified source. Valid for &lt;ip&gt; are a single IP (e.g. 1.2.3.4), a network/netmask (e.g. 1.2.3.4/255.255.255.0) or a network/CIDR (e.g. 1.2.3.4/24). This option can be specified multiple times"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::RPC);</td></tr>
<tr class="codeline" data-linenumber="570"><td class="num" id="LN570">570</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-rpcauth=&lt;userpw&gt;"</span>, <span class='string_literal'>"Username and HMAC-SHA-256 hashed password for JSON-RPC connections. The field &lt;userpw&gt; comes in the format: &lt;USERNAME&gt;:&lt;SALT&gt;$&lt;HASH&gt;. A canonical python script is included in share/rpcauth. The client then connects normally using the rpcuser=&lt;USERNAME&gt;/rpcpassword=&lt;PASSWORD&gt; pair of arguments. This option can be specified multiple times"</span>, ArgsManager::ALLOW_ANY | ArgsManager::SENSITIVE, OptionsCategory::RPC);</td></tr>
<tr class="codeline" data-linenumber="571"><td class="num" id="LN571">571</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-rpcbind=&lt;addr&gt;[:port]"</span>, <span class='string_literal'>"Bind to given address to listen for JSON-RPC connections. Do not expose the RPC server to untrusted networks such as the public internet! This option is ignored unless -rpcallowip is also passed. Port is optional and overrides -rpcport. Use [host]:port notation for IPv6. This option can be specified multiple times (default: 127.0.0.1 and ::1 i.e., localhost)"</span>, ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY | ArgsManager::SENSITIVE, OptionsCategory::RPC);</td></tr>
<tr class="codeline" data-linenumber="572"><td class="num" id="LN572">572</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-rpccookiefile=&lt;loc&gt;"</span>, <span class='string_literal'>"Location of the auth cookie. Relative paths will be prefixed by a net-specific datadir location. (default: data dir)"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::RPC);</td></tr>
<tr class="codeline" data-linenumber="573"><td class="num" id="LN573">573</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-rpcpassword=&lt;pw&gt;"</span>, <span class='string_literal'>"Password for JSON-RPC connections"</span>, ArgsManager::ALLOW_ANY | ArgsManager::SENSITIVE, OptionsCategory::RPC);</td></tr>
<tr class="codeline" data-linenumber="574"><td class="num" id="LN574">574</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-rpcport=&lt;port&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Listen for JSON-RPC connections on &lt;port&gt; (default: %u, testnet: %u, signet: %u, regtest: %u)"</span>, defaultBaseParams-&gt;RPCPort(), testnetBaseParams-&gt;RPCPort(), signetBaseParams-&gt;RPCPort(), regtestBaseParams-&gt;RPCPort()), ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::RPC);</td></tr>
<tr class="codeline" data-linenumber="575"><td class="num" id="LN575">575</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-rpcserialversion"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Sets the serialization of raw transaction or block hex returned in non-verbose mode, non-segwit(0) or segwit(1) (default: %d)"</span>, DEFAULT_RPC_SERIALIZE_VERSION), ArgsManager::ALLOW_ANY, OptionsCategory::RPC);</td></tr>
<tr class="codeline" data-linenumber="576"><td class="num" id="LN576">576</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-rpcservertimeout=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Timeout during HTTP requests (default: %d)"</span>, DEFAULT_HTTP_SERVER_TIMEOUT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::RPC);</td></tr>
<tr class="codeline" data-linenumber="577"><td class="num" id="LN577">577</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-rpcthreads=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Set the number of threads to service RPC calls (default: %d)"</span>, DEFAULT_HTTP_THREADS), ArgsManager::ALLOW_ANY, OptionsCategory::RPC);</td></tr>
<tr class="codeline" data-linenumber="578"><td class="num" id="LN578">578</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-rpcuser=&lt;user&gt;"</span>, <span class='string_literal'>"Username for JSON-RPC connections"</span>, ArgsManager::ALLOW_ANY | ArgsManager::SENSITIVE, OptionsCategory::RPC);</td></tr>
<tr class="codeline" data-linenumber="579"><td class="num" id="LN579">579</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-rpcwhitelist=&lt;whitelist&gt;"</span>, <span class='string_literal'>"Set a whitelist to filter incoming RPC calls for a specific user. The field &lt;whitelist&gt; comes in the format: &lt;USERNAME&gt;:&lt;rpc 1&gt;,&lt;rpc 2&gt;,...,&lt;rpc n&gt;. If multiple whitelists are set for a given user, they are set-intersected. See -rpcwhitelistdefault documentation for information on default whitelist behavior."</span>, ArgsManager::ALLOW_ANY, OptionsCategory::RPC);</td></tr>
<tr class="codeline" data-linenumber="580"><td class="num" id="LN580">580</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-rpcwhitelistdefault"</span>, <span class='string_literal'>"Sets default behavior for rpc whitelisting. Unless rpcwhitelistdefault is set to 0, if any -rpcwhitelist is set, the rpc server acts as if all rpc users are subject to empty-unless-otherwise-specified whitelists. If rpcwhitelistdefault is set to 1 and no -rpcwhitelist is set, rpc server acts as if all rpc users are subject to empty whitelists."</span>, ArgsManager::ALLOW_BOOL, OptionsCategory::RPC);</td></tr>
<tr class="codeline" data-linenumber="581"><td class="num" id="LN581">581</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-rpcworkqueue=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Set the depth of the work queue to service RPC calls (default: %d)"</span>, DEFAULT_HTTP_WORKQUEUE), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::RPC);</td></tr>
<tr class="codeline" data-linenumber="582"><td class="num" id="LN582">582</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-server"</span>, <span class='string_literal'>"Accept command line and JSON-RPC commands"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::RPC);</td></tr>
<tr class="codeline" data-linenumber="583"><td class="num" id="LN583">583</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="584"><td class="num" id="LN584">584</td><td class="line"><span class='directive'>#if <span class='macro'>HAVE_DECL_DAEMON<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="585"><td class="num" id="LN585">585</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-daemon"</span>, <span class='string_literal'>"Run in the background as a daemon and accept commands"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="586"><td class="num" id="LN586">586</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="587"><td class="num" id="LN587">587</td><td class="line">    hidden_args.emplace_back(<span class='string_literal'>"-daemon"</span>);</td></tr>
<tr class="codeline" data-linenumber="588"><td class="num" id="LN588">588</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="589"><td class="num" id="LN589">589</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="590"><td class="num" id="LN590">590</td><td class="line">    <span class='comment'>// Add the hidden options</span></td></tr>
<tr class="codeline" data-linenumber="591"><td class="num" id="LN591">591</td><td class="line">    argsman.AddHiddenArgs(hidden_args);</td></tr>
<tr class="codeline" data-linenumber="592"><td class="num" id="LN592">592</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="593"><td class="num" id="LN593">593</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="594"><td class="num" id="LN594">594</td><td class="line">std::string LicenseInfo()</td></tr>
<tr class="codeline" data-linenumber="595"><td class="num" id="LN595">595</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="596"><td class="num" id="LN596">596</td><td class="line">    <span class='keyword'>const</span> std::string URL_SOURCE_CODE = <span class='string_literal'>"&lt;https://github.com/bitcoin/bitcoin&gt;"</span>;</td></tr>
<tr class="codeline" data-linenumber="597"><td class="num" id="LN597">597</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="598"><td class="num" id="LN598">598</td><td class="line">    <span class='keyword'>return</span> CopyrightHolders(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"Copyright (C) %i-%i"</span>).translated, 2009, <span class='macro'>COPYRIGHT_YEAR<span class='macro_popup'>2020</span></span>) + <span class='string_literal'>" "</span>) + <span class='string_literal'>"\n"</span> +</td></tr>
<tr class="codeline" data-linenumber="599"><td class="num" id="LN599">599</td><td class="line">           <span class='string_literal'>"\n"</span> +</td></tr>
<tr class="codeline" data-linenumber="600"><td class="num" id="LN600">600</td><td class="line">           <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"Please contribute if you find %s useful. "</span></td></tr>
<tr class="codeline" data-linenumber="601"><td class="num" id="LN601">601</td><td class="line">                       <span class='string_literal'>"Visit %s for further information about the software."</span>).translated,</td></tr>
<tr class="codeline" data-linenumber="602"><td class="num" id="LN602">602</td><td class="line">               <span class='macro'>PACKAGE_NAME<span class='macro_popup'>"Bitcoin Core"</span></span>, <span class='string_literal'>"&lt;"</span> <span class='macro'>PACKAGE_URL<span class='macro_popup'>"https://bitcoincore.org/"</span></span> <span class='string_literal'>"&gt;"</span>) +</td></tr>
<tr class="codeline" data-linenumber="603"><td class="num" id="LN603">603</td><td class="line">           <span class='string_literal'>"\n"</span> +</td></tr>
<tr class="codeline" data-linenumber="604"><td class="num" id="LN604">604</td><td class="line">           <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"The source code is available from %s."</span>).translated,</td></tr>
<tr class="codeline" data-linenumber="605"><td class="num" id="LN605">605</td><td class="line">               URL_SOURCE_CODE) +</td></tr>
<tr class="codeline" data-linenumber="606"><td class="num" id="LN606">606</td><td class="line">           <span class='string_literal'>"\n"</span> +</td></tr>
<tr class="codeline" data-linenumber="607"><td class="num" id="LN607">607</td><td class="line">           <span class='string_literal'>"\n"</span> +</td></tr>
<tr class="codeline" data-linenumber="608"><td class="num" id="LN608">608</td><td class="line">           _(<span class='string_literal'>"This is experimental software."</span>).translated + <span class='string_literal'>"\n"</span> +</td></tr>
<tr class="codeline" data-linenumber="609"><td class="num" id="LN609">609</td><td class="line">           <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"Distributed under the MIT software license, see the accompanying file %s or %s"</span>).translated, <span class='string_literal'>"COPYING"</span>, <span class='string_literal'>"&lt;https://opensource.org/licenses/MIT&gt;"</span>) +</td></tr>
<tr class="codeline" data-linenumber="610"><td class="num" id="LN610">610</td><td class="line">           <span class='string_literal'>"\n"</span>;</td></tr>
<tr class="codeline" data-linenumber="611"><td class="num" id="LN611">611</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="612"><td class="num" id="LN612">612</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="613"><td class="num" id="LN613">613</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>bool</span> fHaveGenesis = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="614"><td class="num" id="LN614">614</td><td class="line"><span class='keyword'>static</span> Mutex g_genesis_wait_mutex;</td></tr>
<tr class="codeline" data-linenumber="615"><td class="num" id="LN615">615</td><td class="line"><span class='keyword'>static</span> std::condition_variable g_genesis_wait_cv;</td></tr>
<tr class="codeline" data-linenumber="616"><td class="num" id="LN616">616</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="617"><td class="num" id="LN617">617</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> BlockNotifyGenesisWait(<span class='keyword'>const</span> CBlockIndex* pBlockIndex)</td></tr>
<tr class="codeline" data-linenumber="618"><td class="num" id="LN618">618</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="619"><td class="num" id="LN619">619</td><td class="line">    <span class='keyword'>if</span> (pBlockIndex != <span class='keyword'>nullptr</span>) {</td></tr>
<tr class="codeline" data-linenumber="620"><td class="num" id="LN620">620</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="621"><td class="num" id="LN621">621</td><td class="line">            <span class='macro'>LOCK(g_genesis_wait_mutex)<span class='macro_popup'>DebugLock&lt;decltype(g_genesis_wait_mutex)&gt; criticalblock51<br>(g_genesis_wait_mutex, "g_genesis_wait_mutex", "init.cpp", 621<br>)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="622"><td class="num" id="LN622">622</td><td class="line">            fHaveGenesis = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="623"><td class="num" id="LN623">623</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="624"><td class="num" id="LN624">624</td><td class="line">        g_genesis_wait_cv.notify_all();</td></tr>
<tr class="codeline" data-linenumber="625"><td class="num" id="LN625">625</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="626"><td class="num" id="LN626">626</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="627"><td class="num" id="LN627">627</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="628"><td class="num" id="LN628">628</td><td class="line"><span class='keyword'>struct</span> CImportingNow</td></tr>
<tr class="codeline" data-linenumber="629"><td class="num" id="LN629">629</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="630"><td class="num" id="LN630">630</td><td class="line">    CImportingNow() {</td></tr>
<tr class="codeline" data-linenumber="631"><td class="num" id="LN631">631</td><td class="line">        <span class='macro'>assert(fImporting == <span class='keyword'>false</span>)<span class='macro_popup'>(static_cast &lt;bool&gt; (fImporting == false) ? void (0) : __assert_fail<br> ("fImporting == false", "init.cpp", 631, __extension__ __PRETTY_FUNCTION__<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="632"><td class="num" id="LN632">632</td><td class="line">        fImporting = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="633"><td class="num" id="LN633">633</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="634"><td class="num" id="LN634">634</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="635"><td class="num" id="LN635">635</td><td class="line">    ~CImportingNow() {</td></tr>
<tr class="codeline" data-linenumber="636"><td class="num" id="LN636">636</td><td class="line">        <span class='macro'>assert(fImporting == <span class='keyword'>true</span>)<span class='macro_popup'>(static_cast &lt;bool&gt; (fImporting == true) ? void (0) : __assert_fail<br> ("fImporting == true", "init.cpp", 636, __extension__ __PRETTY_FUNCTION__<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="637"><td class="num" id="LN637">637</td><td class="line">        fImporting = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="638"><td class="num" id="LN638">638</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="639"><td class="num" id="LN639">639</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="640"><td class="num" id="LN640">640</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="641"><td class="num" id="LN641">641</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="642"><td class="num" id="LN642">642</td><td class="line"><span class='comment'>// If we're using -prune with -reindex, then delete block files that will be ignored by the</span></td></tr>
<tr class="codeline" data-linenumber="643"><td class="num" id="LN643">643</td><td class="line"><span class='comment'>// reindex.  Since reindexing works by starting at block file 0 and looping until a blockfile</span></td></tr>
<tr class="codeline" data-linenumber="644"><td class="num" id="LN644">644</td><td class="line"><span class='comment'>// is missing, do the same here to delete any later block files after a gap.  Also delete all</span></td></tr>
<tr class="codeline" data-linenumber="645"><td class="num" id="LN645">645</td><td class="line"><span class='comment'>// rev files since they'll be rewritten by the reindex anyway.  This ensures that vinfoBlockFile</span></td></tr>
<tr class="codeline" data-linenumber="646"><td class="num" id="LN646">646</td><td class="line"><span class='comment'>// is in sync with what's actually on disk by the time we start downloading, so that pruning</span></td></tr>
<tr class="codeline" data-linenumber="647"><td class="num" id="LN647">647</td><td class="line"><span class='comment'>// works correctly.</span></td></tr>
<tr class="codeline" data-linenumber="648"><td class="num" id="LN648">648</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> CleanupBlockRevFiles()</td></tr>
<tr class="codeline" data-linenumber="649"><td class="num" id="LN649">649</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="650"><td class="num" id="LN650">650</td><td class="line">    std::map&lt;std::string, fs::path&gt; mapBlockFiles;</td></tr>
<tr class="codeline" data-linenumber="651"><td class="num" id="LN651">651</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="652"><td class="num" id="LN652">652</td><td class="line">    <span class='comment'>// Glob all blk?????.dat and rev?????.dat files from the blocks directory.</span></td></tr>
<tr class="codeline" data-linenumber="653"><td class="num" id="LN653">653</td><td class="line">    <span class='comment'>// Remove the rev files immediately and insert the blk file paths into an</span></td></tr>
<tr class="codeline" data-linenumber="654"><td class="num" id="LN654">654</td><td class="line">    <span class='comment'>// ordered map keyed by block file index.</span></td></tr>
<tr class="codeline" data-linenumber="655"><td class="num" id="LN655">655</td><td class="line">    LogPrintf(<span class='string_literal'>"Removing unusable blk?????.dat and rev?????.dat files for -reindex with -prune\n"</span>);</td></tr>
<tr class="codeline" data-linenumber="656"><td class="num" id="LN656">656</td><td class="line">    fs::path blocksdir = GetBlocksDir();</td></tr>
<tr class="codeline" data-linenumber="657"><td class="num" id="LN657">657</td><td class="line">    <span class='keyword'>for</span> (fs::directory_iterator it(blocksdir); it != fs::directory_iterator(); it++) {</td></tr>
<tr class="codeline" data-linenumber="658"><td class="num" id="LN658">658</td><td class="line">        <span class='keyword'>if</span> (fs::is_regular_file(*it) &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="659"><td class="num" id="LN659">659</td><td class="line">            it-&gt;path().filename().string().length() == 12 &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="660"><td class="num" id="LN660">660</td><td class="line">            it-&gt;path().filename().string().substr(8,4) == <span class='string_literal'>".dat"</span>)</td></tr>
<tr class="codeline" data-linenumber="661"><td class="num" id="LN661">661</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="662"><td class="num" id="LN662">662</td><td class="line">            <span class='keyword'>if</span> (it-&gt;path().filename().string().substr(0,3) == <span class='string_literal'>"blk"</span>)</td></tr>
<tr class="codeline" data-linenumber="663"><td class="num" id="LN663">663</td><td class="line">                mapBlockFiles[it-&gt;path().filename().string().substr(3,5)] = it-&gt;path();</td></tr>
<tr class="codeline" data-linenumber="664"><td class="num" id="LN664">664</td><td class="line">            <span class='keyword'>else</span> <span class='keyword'>if</span> (it-&gt;path().filename().string().substr(0,3) == <span class='string_literal'>"rev"</span>)</td></tr>
<tr class="codeline" data-linenumber="665"><td class="num" id="LN665">665</td><td class="line">                remove(it-&gt;path());</td></tr>
<tr class="codeline" data-linenumber="666"><td class="num" id="LN666">666</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="667"><td class="num" id="LN667">667</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="668"><td class="num" id="LN668">668</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="669"><td class="num" id="LN669">669</td><td class="line">    <span class='comment'>// Remove all block files that aren't part of a contiguous set starting at</span></td></tr>
<tr class="codeline" data-linenumber="670"><td class="num" id="LN670">670</td><td class="line">    <span class='comment'>// zero by walking the ordered map (keys are block file indices) by</span></td></tr>
<tr class="codeline" data-linenumber="671"><td class="num" id="LN671">671</td><td class="line">    <span class='comment'>// keeping a separate counter.  Once we hit a gap (or if 0 doesn't exist)</span></td></tr>
<tr class="codeline" data-linenumber="672"><td class="num" id="LN672">672</td><td class="line">    <span class='comment'>// start removing block files.</span></td></tr>
<tr class="codeline" data-linenumber="673"><td class="num" id="LN673">673</td><td class="line">    <span class='keyword'>int</span> nContigCounter = 0;</td></tr>
<tr class="codeline" data-linenumber="674"><td class="num" id="LN674">674</td><td class="line">    <span class='keyword'>for</span> (<span class='keyword'>const</span> std::pair&lt;<span class='keyword'>const</span> std::string, fs::path&gt;&amp; item : mapBlockFiles) {</td></tr>
<tr class="codeline" data-linenumber="675"><td class="num" id="LN675">675</td><td class="line">        <span class='keyword'>if</span> (atoi(item.first) == nContigCounter) {</td></tr>
<tr class="codeline" data-linenumber="676"><td class="num" id="LN676">676</td><td class="line">            nContigCounter++;</td></tr>
<tr class="codeline" data-linenumber="677"><td class="num" id="LN677">677</td><td class="line">            <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="678"><td class="num" id="LN678">678</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="679"><td class="num" id="LN679">679</td><td class="line">        remove(item.second);</td></tr>
<tr class="codeline" data-linenumber="680"><td class="num" id="LN680">680</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="681"><td class="num" id="LN681">681</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="682"><td class="num" id="LN682">682</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="683"><td class="num" id="LN683">683</td><td class="line"><span class='directive'>#if <span class='macro'>HAVE_SYSTEM<span class='macro_popup'>1 || HAVE_WSYSTEM</span></span></span></td></tr>
<tr class="codeline" data-linenumber="684"><td class="num" id="LN684">684</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> StartupNotify(<span class='keyword'>const</span> ArgsManager&amp; args)</td></tr>
<tr class="codeline" data-linenumber="685"><td class="num" id="LN685">685</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="686"><td class="num" id="LN686">686</td><td class="line">    std::string cmd = args.GetArg(<span class='string_literal'>"-startupnotify"</span>, <span class='string_literal'>""</span>);</td></tr>
<tr class="codeline" data-linenumber="687"><td class="num" id="LN687">687</td><td class="line">    <span class='keyword'>if</span> (!cmd.empty()) {</td></tr>
<tr class="codeline" data-linenumber="688"><td class="num" id="LN688">688</td><td class="line">        std::thread t(runCommand, cmd);</td></tr>
<tr class="codeline" data-linenumber="689"><td class="num" id="LN689">689</td><td class="line">        t.detach(); <span class='comment'>// thread runs free</span></td></tr>
<tr class="codeline" data-linenumber="690"><td class="num" id="LN690">690</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="691"><td class="num" id="LN691">691</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="692"><td class="num" id="LN692">692</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="693"><td class="num" id="LN693">693</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="694"><td class="num" id="LN694">694</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> ThreadImport(ChainstateManager&amp; chainman, std::vector&lt;fs::path&gt; vImportFiles, <span class='keyword'>const</span> ArgsManager&amp; args)</td></tr>
<tr class="codeline" data-linenumber="695"><td class="num" id="LN695">695</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="696"><td class="num" id="LN696">696</td><td class="line">    <span class='keyword'>const</span> CChainParams&amp; chainparams = Params();</td></tr>
<tr class="codeline" data-linenumber="697"><td class="num" id="LN697">697</td><td class="line">    ScheduleBatchPriority();</td></tr>
<tr class="codeline" data-linenumber="698"><td class="num" id="LN698">698</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="699"><td class="num" id="LN699">699</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="700"><td class="num" id="LN700">700</td><td class="line">    CImportingNow imp;</td></tr>
<tr class="codeline" data-linenumber="701"><td class="num" id="LN701">701</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="702"><td class="num" id="LN702">702</td><td class="line">    <span class='comment'>// -reindex</span></td></tr>
<tr class="codeline" data-linenumber="703"><td class="num" id="LN703">703</td><td class="line">    <span class='keyword'>if</span> (fReindex) {</td></tr>
<tr class="codeline" data-linenumber="704"><td class="num" id="LN704">704</td><td class="line">        <span class='keyword'>int</span> nFile = 0;</td></tr>
<tr class="codeline" data-linenumber="705"><td class="num" id="LN705">705</td><td class="line">        <span class='keyword'>while</span> (<span class='keyword'>true</span>) {</td></tr>
<tr class="codeline" data-linenumber="706"><td class="num" id="LN706">706</td><td class="line">            FlatFilePos pos(nFile, 0);</td></tr>
<tr class="codeline" data-linenumber="707"><td class="num" id="LN707">707</td><td class="line">            <span class='keyword'>if</span> (!fs::exists(GetBlockPosFilename(pos)))</td></tr>
<tr class="codeline" data-linenumber="708"><td class="num" id="LN708">708</td><td class="line">                <span class='keyword'>break</span>; <span class='comment'>// No block files left to reindex</span></td></tr>
<tr class="codeline" data-linenumber="709"><td class="num" id="LN709">709</td><td class="line">            FILE *file = OpenBlockFile(pos, <span class='keyword'>true</span>);</td></tr>
<tr class="codeline" data-linenumber="710"><td class="num" id="LN710">710</td><td class="line">            <span class='keyword'>if</span> (!file)</td></tr>
<tr class="codeline" data-linenumber="711"><td class="num" id="LN711">711</td><td class="line">                <span class='keyword'>break</span>; <span class='comment'>// This error is logged in OpenBlockFile</span></td></tr>
<tr class="codeline" data-linenumber="712"><td class="num" id="LN712">712</td><td class="line">            LogPrintf(<span class='string_literal'>"Reindexing block file blk%05u.dat...\n"</span>, (<span class='keyword'>unsigned</span> <span class='keyword'>int</span>)nFile);</td></tr>
<tr class="codeline" data-linenumber="713"><td class="num" id="LN713">713</td><td class="line">            LoadExternalBlockFile(chainparams, file, &amp;pos);</td></tr>
<tr class="codeline" data-linenumber="714"><td class="num" id="LN714">714</td><td class="line">            <span class='keyword'>if</span> (ShutdownRequested()) {</td></tr>
<tr class="codeline" data-linenumber="715"><td class="num" id="LN715">715</td><td class="line">                LogPrintf(<span class='string_literal'>"Shutdown requested. Exit %s\n"</span>, <span class='keyword'>__func__</span>);</td></tr>
<tr class="codeline" data-linenumber="716"><td class="num" id="LN716">716</td><td class="line">                <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="717"><td class="num" id="LN717">717</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="718"><td class="num" id="LN718">718</td><td class="line">            nFile++;</td></tr>
<tr class="codeline" data-linenumber="719"><td class="num" id="LN719">719</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="720"><td class="num" id="LN720">720</td><td class="line">        pblocktree-&gt;WriteReindexing(<span class='keyword'>false</span>);</td></tr>
<tr class="codeline" data-linenumber="721"><td class="num" id="LN721">721</td><td class="line">        fReindex = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="722"><td class="num" id="LN722">722</td><td class="line">        LogPrintf(<span class='string_literal'>"Reindexing finished\n"</span>);</td></tr>
<tr class="codeline" data-linenumber="723"><td class="num" id="LN723">723</td><td class="line">        <span class='comment'>// To avoid ending up in a situation without genesis block, re-try initializing (no-op if reindexing worked):</span></td></tr>
<tr class="codeline" data-linenumber="724"><td class="num" id="LN724">724</td><td class="line">        LoadGenesisBlock(chainparams);</td></tr>
<tr class="codeline" data-linenumber="725"><td class="num" id="LN725">725</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="726"><td class="num" id="LN726">726</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="727"><td class="num" id="LN727">727</td><td class="line">    <span class='comment'>// -loadblock=</span></td></tr>
<tr class="codeline" data-linenumber="728"><td class="num" id="LN728">728</td><td class="line">    <span class='keyword'>for</span> (<span class='keyword'>const</span> fs::path&amp; path : vImportFiles) {</td></tr>
<tr class="codeline" data-linenumber="729"><td class="num" id="LN729">729</td><td class="line">        FILE *file = fsbridge::fopen(path, <span class='string_literal'>"rb"</span>);</td></tr>
<tr class="codeline" data-linenumber="730"><td class="num" id="LN730">730</td><td class="line">        <span class='keyword'>if</span> (file) {</td></tr>
<tr class="codeline" data-linenumber="731"><td class="num" id="LN731">731</td><td class="line">            LogPrintf(<span class='string_literal'>"Importing blocks file %s...\n"</span>, path.string());</td></tr>
<tr class="codeline" data-linenumber="732"><td class="num" id="LN732">732</td><td class="line">            LoadExternalBlockFile(chainparams, file);</td></tr>
<tr class="codeline" data-linenumber="733"><td class="num" id="LN733">733</td><td class="line">            <span class='keyword'>if</span> (ShutdownRequested()) {</td></tr>
<tr class="codeline" data-linenumber="734"><td class="num" id="LN734">734</td><td class="line">                LogPrintf(<span class='string_literal'>"Shutdown requested. Exit %s\n"</span>, <span class='keyword'>__func__</span>);</td></tr>
<tr class="codeline" data-linenumber="735"><td class="num" id="LN735">735</td><td class="line">                <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="736"><td class="num" id="LN736">736</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="737"><td class="num" id="LN737">737</td><td class="line">        } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="738"><td class="num" id="LN738">738</td><td class="line">            LogPrintf(<span class='string_literal'>"Warning: Could not open blocks file %s\n"</span>, path.string());</td></tr>
<tr class="codeline" data-linenumber="739"><td class="num" id="LN739">739</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="740"><td class="num" id="LN740">740</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="741"><td class="num" id="LN741">741</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="742"><td class="num" id="LN742">742</td><td class="line">    <span class='comment'>// scan for better chains in the block chain database, that are not yet connected in the active best chain</span></td></tr>
<tr class="codeline" data-linenumber="743"><td class="num" id="LN743">743</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="744"><td class="num" id="LN744">744</td><td class="line">    <span class='comment'>// We can't hold cs_main during ActivateBestChain even though we're accessing</span></td></tr>
<tr class="codeline" data-linenumber="745"><td class="num" id="LN745">745</td><td class="line">    <span class='comment'>// the chainman unique_ptrs since ABC requires us not to be holding cs_main, so retrieve</span></td></tr>
<tr class="codeline" data-linenumber="746"><td class="num" id="LN746">746</td><td class="line">    <span class='comment'>// the relevant pointers before the ABC call.</span></td></tr>
<tr class="codeline" data-linenumber="747"><td class="num" id="LN747">747</td><td class="line">    <span class='keyword'>for</span> (CChainState* chainstate : <span class='macro'>WITH_LOCK(::cs_main, <span class='keyword'>return</span> chainman.GetAll())<span class='macro_popup'>[&amp;] { DebugLock&lt;decltype(::cs_main)&gt; criticalblock52<br>(::cs_main, "::cs_main", "init.cpp", 747); return chainman.GetAll<br>(); }()</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="748"><td class="num" id="LN748">748</td><td class="line">        BlockValidationState state;</td></tr>
<tr class="codeline" data-linenumber="749"><td class="num" id="LN749">749</td><td class="line">        <span class='keyword'>if</span> (!chainstate-&gt;ActivateBestChain(state, chainparams, <span class='keyword'>nullptr</span>)) {</td></tr>
<tr class="codeline" data-linenumber="750"><td class="num" id="LN750">750</td><td class="line">            LogPrintf(<span class='string_literal'>"Failed to connect best block (%s)\n"</span>, state.ToString());</td></tr>
<tr class="codeline" data-linenumber="751"><td class="num" id="LN751">751</td><td class="line">            StartShutdown();</td></tr>
<tr class="codeline" data-linenumber="752"><td class="num" id="LN752">752</td><td class="line">            <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="753"><td class="num" id="LN753">753</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="754"><td class="num" id="LN754">754</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="755"><td class="num" id="LN755">755</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="756"><td class="num" id="LN756">756</td><td class="line">    <span class='keyword'>if</span> (args.GetBoolArg(<span class='string_literal'>"-stopafterblockimport"</span>, DEFAULT_STOPAFTERBLOCKIMPORT)) {</td></tr>
<tr class="codeline" data-linenumber="757"><td class="num" id="LN757">757</td><td class="line">        LogPrintf(<span class='string_literal'>"Stopping after block import\n"</span>);</td></tr>
<tr class="codeline" data-linenumber="758"><td class="num" id="LN758">758</td><td class="line">        StartShutdown();</td></tr>
<tr class="codeline" data-linenumber="759"><td class="num" id="LN759">759</td><td class="line">        <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="760"><td class="num" id="LN760">760</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="761"><td class="num" id="LN761">761</td><td class="line">    } <span class='comment'>// End scope of CImportingNow</span></td></tr>
<tr class="codeline" data-linenumber="762"><td class="num" id="LN762">762</td><td class="line">    chainman.ActiveChainstate().LoadMempool(args);</td></tr>
<tr class="codeline" data-linenumber="763"><td class="num" id="LN763">763</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="764"><td class="num" id="LN764">764</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="765"><td class="num" id="LN765">765</td><td class="line"><span class='comment'>/** Sanity checks</span></td></tr>
<tr class="codeline" data-linenumber="766"><td class="num" id="LN766">766</td><td class="line"> <span class='comment'>*  Ensure that Bitcoin is running in a usable environment with all</span></td></tr>
<tr class="codeline" data-linenumber="767"><td class="num" id="LN767">767</td><td class="line"> <span class='comment'>*  necessary library support.</span></td></tr>
<tr class="codeline" data-linenumber="768"><td class="num" id="LN768">768</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="769"><td class="num" id="LN769">769</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>bool</span> InitSanityCheck()</td></tr>
<tr class="codeline" data-linenumber="770"><td class="num" id="LN770">770</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="771"><td class="num" id="LN771">771</td><td class="line">    <span class='keyword'>if</span> (!ECC_InitSanityCheck()) {</td></tr>
<tr class="codeline" data-linenumber="772"><td class="num" id="LN772">772</td><td class="line">        <span class='keyword'>return</span> InitError(Untranslated(<span class='string_literal'>"Elliptic curve cryptography sanity check failure. Aborting."</span>));</td></tr>
<tr class="codeline" data-linenumber="773"><td class="num" id="LN773">773</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="774"><td class="num" id="LN774">774</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="775"><td class="num" id="LN775">775</td><td class="line">    <span class='keyword'>if</span> (!glibc_sanity_test() || !glibcxx_sanity_test())</td></tr>
<tr class="codeline" data-linenumber="776"><td class="num" id="LN776">776</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="777"><td class="num" id="LN777">777</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="778"><td class="num" id="LN778">778</td><td class="line">    <span class='keyword'>if</span> (!Random_SanityCheck()) {</td></tr>
<tr class="codeline" data-linenumber="779"><td class="num" id="LN779">779</td><td class="line">        <span class='keyword'>return</span> InitError(Untranslated(<span class='string_literal'>"OS cryptographic RNG sanity check failure. Aborting."</span>));</td></tr>
<tr class="codeline" data-linenumber="780"><td class="num" id="LN780">780</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="781"><td class="num" id="LN781">781</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="782"><td class="num" id="LN782">782</td><td class="line">    <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="783"><td class="num" id="LN783">783</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="784"><td class="num" id="LN784">784</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="785"><td class="num" id="LN785">785</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>bool</span> AppInitServers(<span class='keyword'>const</span> util::Ref&amp; context, NodeContext&amp; node)</td></tr>
<tr class="codeline" data-linenumber="786"><td class="num" id="LN786">786</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="787"><td class="num" id="LN787">787</td><td class="line">    <span class='keyword'>const</span> ArgsManager&amp; args = *<span class='macro'>Assert(node.args)<span class='macro_popup'>[&amp;]() -&gt; decltype(get_pure_r_value(node.args)) { auto&amp;&amp;<br> check = (node.args); (static_cast &lt;bool&gt; ("node.args" &amp;&amp;<br> check) ? void (0) : __assert_fail ("\"node.args\" &amp;&amp; check"<br>, "init.cpp", 787, __extension__ __PRETTY_FUNCTION__)); return<br> std::forward&lt;decltype(get_pure_r_value(node.args))&gt;(check<br>); }()</span></span>;</td></tr>
<tr class="codeline" data-linenumber="788"><td class="num" id="LN788">788</td><td class="line">    RPCServer::OnStarted(&amp;OnRPCStarted);</td></tr>
<tr class="codeline" data-linenumber="789"><td class="num" id="LN789">789</td><td class="line">    RPCServer::OnStopped(&amp;OnRPCStopped);</td></tr>
<tr class="codeline" data-linenumber="790"><td class="num" id="LN790">790</td><td class="line">    <span class='keyword'>if</span> (!InitHTTPServer())</td></tr>
<tr class="codeline" data-linenumber="791"><td class="num" id="LN791">791</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="792"><td class="num" id="LN792">792</td><td class="line">    StartRPC();</td></tr>
<tr class="codeline" data-linenumber="793"><td class="num" id="LN793">793</td><td class="line">    node.rpc_interruption_point = RpcInterruptionPoint;</td></tr>
<tr class="codeline" data-linenumber="794"><td class="num" id="LN794">794</td><td class="line">    <span class='keyword'>if</span> (!StartHTTPRPC(context))</td></tr>
<tr class="codeline" data-linenumber="795"><td class="num" id="LN795">795</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="796"><td class="num" id="LN796">796</td><td class="line">    <span class='keyword'>if</span> (args.GetBoolArg(<span class='string_literal'>"-rest"</span>, DEFAULT_REST_ENABLE)) StartREST(context);</td></tr>
<tr class="codeline" data-linenumber="797"><td class="num" id="LN797">797</td><td class="line">    StartHTTPServer();</td></tr>
<tr class="codeline" data-linenumber="798"><td class="num" id="LN798">798</td><td class="line">    <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="799"><td class="num" id="LN799">799</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="800"><td class="num" id="LN800">800</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="801"><td class="num" id="LN801">801</td><td class="line"><span class='comment'>// Parameter interaction based on rules</span></td></tr>
<tr class="codeline" data-linenumber="802"><td class="num" id="LN802">802</td><td class="line"><span class='keyword'>void</span> InitParameterInteraction(ArgsManager&amp; args)</td></tr>
<tr class="codeline" data-linenumber="803"><td class="num" id="LN803">803</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="804"><td class="num" id="LN804">804</td><td class="line">    <span class='comment'>// when specifying an explicit binding address, you want to listen on it</span></td></tr>
<tr class="codeline" data-linenumber="805"><td class="num" id="LN805">805</td><td class="line">    <span class='comment'>// even when -connect or -proxy is specified</span></td></tr>
<tr class="codeline" data-linenumber="806"><td class="num" id="LN806">806</td><td class="line">    <span class='keyword'>if</span> (args.IsArgSet(<span class='string_literal'>"-bind"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="807"><td class="num" id="LN807">807</td><td class="line">        <span class='keyword'>if</span> (args.SoftSetBoolArg(<span class='string_literal'>"-listen"</span>, <span class='keyword'>true</span>))</td></tr>
<tr class="codeline" data-linenumber="808"><td class="num" id="LN808">808</td><td class="line">            LogPrintf(<span class='string_literal'>"%s: parameter interaction: -bind set -&gt; setting -listen=1\n"</span>, <span class='keyword'>__func__</span>);</td></tr>
<tr class="codeline" data-linenumber="809"><td class="num" id="LN809">809</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="810"><td class="num" id="LN810">810</td><td class="line">    <span class='keyword'>if</span> (args.IsArgSet(<span class='string_literal'>"-whitebind"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="811"><td class="num" id="LN811">811</td><td class="line">        <span class='keyword'>if</span> (args.SoftSetBoolArg(<span class='string_literal'>"-listen"</span>, <span class='keyword'>true</span>))</td></tr>
<tr class="codeline" data-linenumber="812"><td class="num" id="LN812">812</td><td class="line">            LogPrintf(<span class='string_literal'>"%s: parameter interaction: -whitebind set -&gt; setting -listen=1\n"</span>, <span class='keyword'>__func__</span>);</td></tr>
<tr class="codeline" data-linenumber="813"><td class="num" id="LN813">813</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="814"><td class="num" id="LN814">814</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="815"><td class="num" id="LN815">815</td><td class="line">    <span class='keyword'>if</span> (args.IsArgSet(<span class='string_literal'>"-connect"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="816"><td class="num" id="LN816">816</td><td class="line">        <span class='comment'>// when only connecting to trusted nodes, do not seed via DNS, or listen by default</span></td></tr>
<tr class="codeline" data-linenumber="817"><td class="num" id="LN817">817</td><td class="line">        <span class='keyword'>if</span> (args.SoftSetBoolArg(<span class='string_literal'>"-dnsseed"</span>, <span class='keyword'>false</span>))</td></tr>
<tr class="codeline" data-linenumber="818"><td class="num" id="LN818">818</td><td class="line">            LogPrintf(<span class='string_literal'>"%s: parameter interaction: -connect set -&gt; setting -dnsseed=0\n"</span>, <span class='keyword'>__func__</span>);</td></tr>
<tr class="codeline" data-linenumber="819"><td class="num" id="LN819">819</td><td class="line">        <span class='keyword'>if</span> (args.SoftSetBoolArg(<span class='string_literal'>"-listen"</span>, <span class='keyword'>false</span>))</td></tr>
<tr class="codeline" data-linenumber="820"><td class="num" id="LN820">820</td><td class="line">            LogPrintf(<span class='string_literal'>"%s: parameter interaction: -connect set -&gt; setting -listen=0\n"</span>, <span class='keyword'>__func__</span>);</td></tr>
<tr class="codeline" data-linenumber="821"><td class="num" id="LN821">821</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="822"><td class="num" id="LN822">822</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="823"><td class="num" id="LN823">823</td><td class="line">    <span class='keyword'>if</span> (args.IsArgSet(<span class='string_literal'>"-proxy"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="824"><td class="num" id="LN824">824</td><td class="line">        <span class='comment'>// to protect privacy, do not listen by default if a default proxy server is specified</span></td></tr>
<tr class="codeline" data-linenumber="825"><td class="num" id="LN825">825</td><td class="line">        <span class='keyword'>if</span> (args.SoftSetBoolArg(<span class='string_literal'>"-listen"</span>, <span class='keyword'>false</span>))</td></tr>
<tr class="codeline" data-linenumber="826"><td class="num" id="LN826">826</td><td class="line">            LogPrintf(<span class='string_literal'>"%s: parameter interaction: -proxy set -&gt; setting -listen=0\n"</span>, <span class='keyword'>__func__</span>);</td></tr>
<tr class="codeline" data-linenumber="827"><td class="num" id="LN827">827</td><td class="line">        <span class='comment'>// to protect privacy, do not use UPNP when a proxy is set. The user may still specify -listen=1</span></td></tr>
<tr class="codeline" data-linenumber="828"><td class="num" id="LN828">828</td><td class="line">        <span class='comment'>// to listen locally, so don't rely on this happening through -listen below.</span></td></tr>
<tr class="codeline" data-linenumber="829"><td class="num" id="LN829">829</td><td class="line">        <span class='keyword'>if</span> (args.SoftSetBoolArg(<span class='string_literal'>"-upnp"</span>, <span class='keyword'>false</span>))</td></tr>
<tr class="codeline" data-linenumber="830"><td class="num" id="LN830">830</td><td class="line">            LogPrintf(<span class='string_literal'>"%s: parameter interaction: -proxy set -&gt; setting -upnp=0\n"</span>, <span class='keyword'>__func__</span>);</td></tr>
<tr class="codeline" data-linenumber="831"><td class="num" id="LN831">831</td><td class="line">        <span class='comment'>// to protect privacy, do not discover addresses by default</span></td></tr>
<tr class="codeline" data-linenumber="832"><td class="num" id="LN832">832</td><td class="line">        <span class='keyword'>if</span> (args.SoftSetBoolArg(<span class='string_literal'>"-discover"</span>, <span class='keyword'>false</span>))</td></tr>
<tr class="codeline" data-linenumber="833"><td class="num" id="LN833">833</td><td class="line">            LogPrintf(<span class='string_literal'>"%s: parameter interaction: -proxy set -&gt; setting -discover=0\n"</span>, <span class='keyword'>__func__</span>);</td></tr>
<tr class="codeline" data-linenumber="834"><td class="num" id="LN834">834</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="835"><td class="num" id="LN835">835</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="836"><td class="num" id="LN836">836</td><td class="line">    <span class='keyword'>if</span> (!args.GetBoolArg(<span class='string_literal'>"-listen"</span>, DEFAULT_LISTEN)) {</td></tr>
<tr class="codeline" data-linenumber="837"><td class="num" id="LN837">837</td><td class="line">        <span class='comment'>// do not map ports or try to retrieve public IP when not listening (pointless)</span></td></tr>
<tr class="codeline" data-linenumber="838"><td class="num" id="LN838">838</td><td class="line">        <span class='keyword'>if</span> (args.SoftSetBoolArg(<span class='string_literal'>"-upnp"</span>, <span class='keyword'>false</span>))</td></tr>
<tr class="codeline" data-linenumber="839"><td class="num" id="LN839">839</td><td class="line">            LogPrintf(<span class='string_literal'>"%s: parameter interaction: -listen=0 -&gt; setting -upnp=0\n"</span>, <span class='keyword'>__func__</span>);</td></tr>
<tr class="codeline" data-linenumber="840"><td class="num" id="LN840">840</td><td class="line">        <span class='keyword'>if</span> (args.SoftSetBoolArg(<span class='string_literal'>"-discover"</span>, <span class='keyword'>false</span>))</td></tr>
<tr class="codeline" data-linenumber="841"><td class="num" id="LN841">841</td><td class="line">            LogPrintf(<span class='string_literal'>"%s: parameter interaction: -listen=0 -&gt; setting -discover=0\n"</span>, <span class='keyword'>__func__</span>);</td></tr>
<tr class="codeline" data-linenumber="842"><td class="num" id="LN842">842</td><td class="line">        <span class='keyword'>if</span> (args.SoftSetBoolArg(<span class='string_literal'>"-listenonion"</span>, <span class='keyword'>false</span>))</td></tr>
<tr class="codeline" data-linenumber="843"><td class="num" id="LN843">843</td><td class="line">            LogPrintf(<span class='string_literal'>"%s: parameter interaction: -listen=0 -&gt; setting -listenonion=0\n"</span>, <span class='keyword'>__func__</span>);</td></tr>
<tr class="codeline" data-linenumber="844"><td class="num" id="LN844">844</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="845"><td class="num" id="LN845">845</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="846"><td class="num" id="LN846">846</td><td class="line">    <span class='keyword'>if</span> (args.IsArgSet(<span class='string_literal'>"-externalip"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="847"><td class="num" id="LN847">847</td><td class="line">        <span class='comment'>// if an explicit public IP is specified, do not try to find others</span></td></tr>
<tr class="codeline" data-linenumber="848"><td class="num" id="LN848">848</td><td class="line">        <span class='keyword'>if</span> (args.SoftSetBoolArg(<span class='string_literal'>"-discover"</span>, <span class='keyword'>false</span>))</td></tr>
<tr class="codeline" data-linenumber="849"><td class="num" id="LN849">849</td><td class="line">            LogPrintf(<span class='string_literal'>"%s: parameter interaction: -externalip set -&gt; setting -discover=0\n"</span>, <span class='keyword'>__func__</span>);</td></tr>
<tr class="codeline" data-linenumber="850"><td class="num" id="LN850">850</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="851"><td class="num" id="LN851">851</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="852"><td class="num" id="LN852">852</td><td class="line">    <span class='comment'>// disable whitelistrelay in blocksonly mode</span></td></tr>
<tr class="codeline" data-linenumber="853"><td class="num" id="LN853">853</td><td class="line">    <span class='keyword'>if</span> (args.GetBoolArg(<span class='string_literal'>"-blocksonly"</span>, DEFAULT_BLOCKSONLY)) {</td></tr>
<tr class="codeline" data-linenumber="854"><td class="num" id="LN854">854</td><td class="line">        <span class='keyword'>if</span> (args.SoftSetBoolArg(<span class='string_literal'>"-whitelistrelay"</span>, <span class='keyword'>false</span>))</td></tr>
<tr class="codeline" data-linenumber="855"><td class="num" id="LN855">855</td><td class="line">            LogPrintf(<span class='string_literal'>"%s: parameter interaction: -blocksonly=1 -&gt; setting -whitelistrelay=0\n"</span>, <span class='keyword'>__func__</span>);</td></tr>
<tr class="codeline" data-linenumber="856"><td class="num" id="LN856">856</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="857"><td class="num" id="LN857">857</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="858"><td class="num" id="LN858">858</td><td class="line">    <span class='comment'>// Forcing relay from whitelisted hosts implies we will accept relays from them in the first place.</span></td></tr>
<tr class="codeline" data-linenumber="859"><td class="num" id="LN859">859</td><td class="line">    <span class='keyword'>if</span> (args.GetBoolArg(<span class='string_literal'>"-whitelistforcerelay"</span>, DEFAULT_WHITELISTFORCERELAY)) {</td></tr>
<tr class="codeline" data-linenumber="860"><td class="num" id="LN860">860</td><td class="line">        <span class='keyword'>if</span> (args.SoftSetBoolArg(<span class='string_literal'>"-whitelistrelay"</span>, <span class='keyword'>true</span>))</td></tr>
<tr class="codeline" data-linenumber="861"><td class="num" id="LN861">861</td><td class="line">            LogPrintf(<span class='string_literal'>"%s: parameter interaction: -whitelistforcerelay=1 -&gt; setting -whitelistrelay=1\n"</span>, <span class='keyword'>__func__</span>);</td></tr>
<tr class="codeline" data-linenumber="862"><td class="num" id="LN862">862</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="863"><td class="num" id="LN863">863</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="864"><td class="num" id="LN864">864</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="865"><td class="num" id="LN865">865</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr class="codeline" data-linenumber="866"><td class="num" id="LN866">866</td><td class="line"> <span class='comment'>* Initialize global loggers.</span></td></tr>
<tr class="codeline" data-linenumber="867"><td class="num" id="LN867">867</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="868"><td class="num" id="LN868">868</td><td class="line"> <span class='comment'>* Note that this is called very early in the process lifetime, so you should be</span></td></tr>
<tr class="codeline" data-linenumber="869"><td class="num" id="LN869">869</td><td class="line"> <span class='comment'>* careful about what global state you rely on here.</span></td></tr>
<tr class="codeline" data-linenumber="870"><td class="num" id="LN870">870</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="871"><td class="num" id="LN871">871</td><td class="line"><span class='keyword'>void</span> InitLogging(<span class='keyword'>const</span> ArgsManager&amp; args)</td></tr>
<tr class="codeline" data-linenumber="872"><td class="num" id="LN872">872</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="873"><td class="num" id="LN873">873</td><td class="line">    LogInstance().m_print_to_file = !args.IsArgNegated(<span class='string_literal'>"-debuglogfile"</span>);</td></tr>
<tr class="codeline" data-linenumber="874"><td class="num" id="LN874">874</td><td class="line">    LogInstance().m_file_path = AbsPathForConfigVal(args.GetArg(<span class='string_literal'>"-debuglogfile"</span>, DEFAULT_DEBUGLOGFILE));</td></tr>
<tr class="codeline" data-linenumber="875"><td class="num" id="LN875">875</td><td class="line">    LogInstance().m_print_to_console = args.GetBoolArg(<span class='string_literal'>"-printtoconsole"</span>, !args.GetBoolArg(<span class='string_literal'>"-daemon"</span>, <span class='keyword'>false</span>));</td></tr>
<tr class="codeline" data-linenumber="876"><td class="num" id="LN876">876</td><td class="line">    LogInstance().m_log_timestamps = args.GetBoolArg(<span class='string_literal'>"-logtimestamps"</span>, DEFAULT_LOGTIMESTAMPS);</td></tr>
<tr class="codeline" data-linenumber="877"><td class="num" id="LN877">877</td><td class="line">    LogInstance().m_log_time_micros = args.GetBoolArg(<span class='string_literal'>"-logtimemicros"</span>, DEFAULT_LOGTIMEMICROS);</td></tr>
<tr class="codeline" data-linenumber="878"><td class="num" id="LN878">878</td><td class="line"><span class='directive'>#ifdef <span class='macro'>HAVE_THREAD_LOCAL<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="879"><td class="num" id="LN879">879</td><td class="line">    LogInstance().m_log_threadnames = args.GetBoolArg(<span class='string_literal'>"-logthreadnames"</span>, DEFAULT_LOGTHREADNAMES);</td></tr>
<tr class="codeline" data-linenumber="880"><td class="num" id="LN880">880</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="881"><td class="num" id="LN881">881</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="882"><td class="num" id="LN882">882</td><td class="line">    fLogIPs = args.GetBoolArg(<span class='string_literal'>"-logips"</span>, DEFAULT_LOGIPS);</td></tr>
<tr class="codeline" data-linenumber="883"><td class="num" id="LN883">883</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="884"><td class="num" id="LN884">884</td><td class="line">    std::string version_string = FormatFullVersion();</td></tr>
<tr class="codeline" data-linenumber="885"><td class="num" id="LN885">885</td><td class="line"><span class='directive'>#ifdef DEBUG</span></td></tr>
<tr class="codeline" data-linenumber="886"><td class="num" id="LN886">886</td><td class="line">    version_string += <span class='string_literal'>" (debug build)"</span>;</td></tr>
<tr class="codeline" data-linenumber="887"><td class="num" id="LN887">887</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="888"><td class="num" id="LN888">888</td><td class="line">    version_string += <span class='string_literal'>" (release build)"</span>;</td></tr>
<tr class="codeline" data-linenumber="889"><td class="num" id="LN889">889</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="890"><td class="num" id="LN890">890</td><td class="line">    LogPrintf(<span class='macro'>PACKAGE_NAME<span class='macro_popup'>"Bitcoin Core"</span></span> <span class='string_literal'>" version %s\n"</span>, version_string);</td></tr>
<tr class="codeline" data-linenumber="891"><td class="num" id="LN891">891</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="892"><td class="num" id="LN892">892</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="893"><td class="num" id="LN893">893</td><td class="line"><span class='keyword'>namespace</span> { <span class='comment'>// Variables internal to initialization process only</span></td></tr>
<tr class="codeline" data-linenumber="894"><td class="num" id="LN894">894</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="895"><td class="num" id="LN895">895</td><td class="line"><span class='keyword'>int</span> nMaxConnections;</td></tr>
<tr class="codeline" data-linenumber="896"><td class="num" id="LN896">896</td><td class="line"><span class='keyword'>int</span> nUserMaxConnections;</td></tr>
<tr class="codeline" data-linenumber="897"><td class="num" id="LN897">897</td><td class="line"><span class='keyword'>int</span> nFD;</td></tr>
<tr class="codeline" data-linenumber="898"><td class="num" id="LN898">898</td><td class="line">ServiceFlags nLocalServices = ServiceFlags(NODE_NETWORK | NODE_NETWORK_LIMITED);</td></tr>
<tr class="codeline" data-linenumber="899"><td class="num" id="LN899">899</td><td class="line">int64_t peer_connect_timeout;</td></tr>
<tr class="codeline" data-linenumber="900"><td class="num" id="LN900">900</td><td class="line">std::set&lt;BlockFilterType&gt; g_enabled_filter_types;</td></tr>
<tr class="codeline" data-linenumber="901"><td class="num" id="LN901">901</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="902"><td class="num" id="LN902">902</td><td class="line">} <span class='comment'>// namespace</span></td></tr>
<tr class="codeline" data-linenumber="903"><td class="num" id="LN903">903</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="904"><td class="num" id="LN904">904</td><td class="line">[[noreturn]] <span class='keyword'>static</span> <span class='keyword'>void</span> new_handler_terminate()</td></tr>
<tr class="codeline" data-linenumber="905"><td class="num" id="LN905">905</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="906"><td class="num" id="LN906">906</td><td class="line">    <span class='comment'>// Rather than throwing std::bad-alloc if allocation fails, terminate</span></td></tr>
<tr class="codeline" data-linenumber="907"><td class="num" id="LN907">907</td><td class="line">    <span class='comment'>// immediately to (try to) avoid chain corruption.</span></td></tr>
<tr class="codeline" data-linenumber="908"><td class="num" id="LN908">908</td><td class="line">    <span class='comment'>// Since LogPrintf may itself allocate memory, set the handler directly</span></td></tr>
<tr class="codeline" data-linenumber="909"><td class="num" id="LN909">909</td><td class="line">    <span class='comment'>// to terminate first.</span></td></tr>
<tr class="codeline" data-linenumber="910"><td class="num" id="LN910">910</td><td class="line">    std::set_new_handler(std::terminate);</td></tr>
<tr class="codeline" data-linenumber="911"><td class="num" id="LN911">911</td><td class="line">    LogPrintf(<span class='string_literal'>"Error: Out of memory. Terminating.\n"</span>);</td></tr>
<tr class="codeline" data-linenumber="912"><td class="num" id="LN912">912</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="913"><td class="num" id="LN913">913</td><td class="line">    <span class='comment'>// The log was successful, terminate now.</span></td></tr>
<tr class="codeline" data-linenumber="914"><td class="num" id="LN914">914</td><td class="line">    std::terminate();</td></tr>
<tr class="codeline" data-linenumber="915"><td class="num" id="LN915">915</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="916"><td class="num" id="LN916">916</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="917"><td class="num" id="LN917">917</td><td class="line"><span class='keyword'>bool</span> AppInitBasicSetup(ArgsManager&amp; args)</td></tr>
<tr class="codeline" data-linenumber="918"><td class="num" id="LN918">918</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="919"><td class="num" id="LN919">919</td><td class="line">    <span class='comment'>// ********************************************************* Step 1: setup</span></td></tr>
<tr class="codeline" data-linenumber="920"><td class="num" id="LN920">920</td><td class="line"><span class='directive'>#ifdef _MSC_VER</span></td></tr>
<tr class="codeline" data-linenumber="921"><td class="num" id="LN921">921</td><td class="line">    <span class='comment'>// Turn off Microsoft heap dump noise</span></td></tr>
<tr class="codeline" data-linenumber="922"><td class="num" id="LN922">922</td><td class="line">    _CrtSetReportMode(_CRT_WARN, _CRTDBG_MODE_FILE);</td></tr>
<tr class="codeline" data-linenumber="923"><td class="num" id="LN923">923</td><td class="line">    _CrtSetReportFile(_CRT_WARN, CreateFileA(<span class='string_literal'>"NUL"</span>, GENERIC_WRITE, 0, <span class='keyword'>nullptr</span>, OPEN_EXISTING, 0, 0));</td></tr>
<tr class="codeline" data-linenumber="924"><td class="num" id="LN924">924</td><td class="line">    <span class='comment'>// Disable confusing "helpful" text message on abort, Ctrl-C</span></td></tr>
<tr class="codeline" data-linenumber="925"><td class="num" id="LN925">925</td><td class="line">    _set_abort_behavior(0, _WRITE_ABORT_MSG | _CALL_REPORTFAULT);</td></tr>
<tr class="codeline" data-linenumber="926"><td class="num" id="LN926">926</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="927"><td class="num" id="LN927">927</td><td class="line"><span class='directive'>#ifdef WIN32</span></td></tr>
<tr class="codeline" data-linenumber="928"><td class="num" id="LN928">928</td><td class="line">    <span class='comment'>// Enable heap terminate-on-corruption</span></td></tr>
<tr class="codeline" data-linenumber="929"><td class="num" id="LN929">929</td><td class="line">    HeapSetInformation(<span class='keyword'>nullptr</span>, HeapEnableTerminationOnCorruption, <span class='keyword'>nullptr</span>, 0);</td></tr>
<tr class="codeline" data-linenumber="930"><td class="num" id="LN930">930</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="931"><td class="num" id="LN931">931</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="932"><td class="num" id="LN932">932</td><td class="line">    <span class='keyword'>if</span> (!SetupNetworking()) {</td></tr>
<tr class="codeline" data-linenumber="933"><td class="num" id="LN933">933</td><td class="line">        <span class='keyword'>return</span> InitError(Untranslated(<span class='string_literal'>"Initializing networking failed."</span>));</td></tr>
<tr class="codeline" data-linenumber="934"><td class="num" id="LN934">934</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="935"><td class="num" id="LN935">935</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="936"><td class="num" id="LN936">936</td><td class="line"><span class='directive'>#ifndef WIN32</span></td></tr>
<tr class="codeline" data-linenumber="937"><td class="num" id="LN937">937</td><td class="line">    <span class='keyword'>if</span> (!args.GetBoolArg(<span class='string_literal'>"-sysperms"</span>, <span class='keyword'>false</span>)) {</td></tr>
<tr class="codeline" data-linenumber="938"><td class="num" id="LN938">938</td><td class="line">        umask(077);</td></tr>
<tr class="codeline" data-linenumber="939"><td class="num" id="LN939">939</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="940"><td class="num" id="LN940">940</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="941"><td class="num" id="LN941">941</td><td class="line">    <span class='comment'>// Clean shutdown on SIGTERM</span></td></tr>
<tr class="codeline" data-linenumber="942"><td class="num" id="LN942">942</td><td class="line">    registerSignalHandler(<span class='macro'>SIGTERM<span class='macro_popup'>15</span></span>, HandleSIGTERM);</td></tr>
<tr class="codeline" data-linenumber="943"><td class="num" id="LN943">943</td><td class="line">    registerSignalHandler(<span class='macro'>SIGINT<span class='macro_popup'>2</span></span>, HandleSIGTERM);</td></tr>
<tr class="codeline" data-linenumber="944"><td class="num" id="LN944">944</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="945"><td class="num" id="LN945">945</td><td class="line">    <span class='comment'>// Reopen debug.log on SIGHUP</span></td></tr>
<tr class="codeline" data-linenumber="946"><td class="num" id="LN946">946</td><td class="line">    registerSignalHandler(<span class='macro'>SIGHUP<span class='macro_popup'>1</span></span>, HandleSIGHUP);</td></tr>
<tr class="codeline" data-linenumber="947"><td class="num" id="LN947">947</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="948"><td class="num" id="LN948">948</td><td class="line">    <span class='comment'>// Ignore SIGPIPE, otherwise it will bring the daemon down if the client closes unexpectedly</span></td></tr>
<tr class="codeline" data-linenumber="949"><td class="num" id="LN949">949</td><td class="line">    signal(<span class='macro'>SIGPIPE<span class='macro_popup'>13</span></span>, <span class='macro'>SIG_IGN<span class='macro_popup'>((__sighandler_t) 1)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="950"><td class="num" id="LN950">950</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="951"><td class="num" id="LN951">951</td><td class="line">    SetConsoleCtrlHandler(consoleCtrlHandler, <span class='keyword'>true</span>);</td></tr>
<tr class="codeline" data-linenumber="952"><td class="num" id="LN952">952</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="953"><td class="num" id="LN953">953</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="954"><td class="num" id="LN954">954</td><td class="line">    std::set_new_handler(new_handler_terminate);</td></tr>
<tr class="codeline" data-linenumber="955"><td class="num" id="LN955">955</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="956"><td class="num" id="LN956">956</td><td class="line">    <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="957"><td class="num" id="LN957">957</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="958"><td class="num" id="LN958">958</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="959"><td class="num" id="LN959">959</td><td class="line"><span class='keyword'>bool</span> AppInitParameterInteraction(<span class='keyword'>const</span> ArgsManager&amp; args)</td></tr>
<tr class="codeline" data-linenumber="960"><td class="num" id="LN960">960</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="961"><td class="num" id="LN961">961</td><td class="line">    <span class='keyword'>const</span> CChainParams&amp; chainparams = Params();</td></tr>
<tr class="codeline" data-linenumber="962"><td class="num" id="LN962">962</td><td class="line">    <span class='comment'>// ********************************************************* Step 2: parameter interactions</span></td></tr>
<tr class="codeline" data-linenumber="963"><td class="num" id="LN963">963</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="964"><td class="num" id="LN964">964</td><td class="line">    <span class='comment'>// also see: InitParameterInteraction()</span></td></tr>
<tr class="codeline" data-linenumber="965"><td class="num" id="LN965">965</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="966"><td class="num" id="LN966">966</td><td class="line">    <span class='comment'>// Error if network-specific options (-addnode, -connect, etc) are</span></td></tr>
<tr class="codeline" data-linenumber="967"><td class="num" id="LN967">967</td><td class="line">    <span class='comment'>// specified in default section of config file, but not overridden</span></td></tr>
<tr class="codeline" data-linenumber="968"><td class="num" id="LN968">968</td><td class="line">    <span class='comment'>// on the command line or in this network's section of the config file.</span></td></tr>
<tr class="codeline" data-linenumber="969"><td class="num" id="LN969">969</td><td class="line">    std::string network = args.GetChainName();</td></tr>
<tr class="codeline" data-linenumber="970"><td class="num" id="LN970">970</td><td class="line">    <span class='keyword'>if</span> (network == CBaseChainParams::SIGNET) {</td></tr>
<tr class="codeline" data-linenumber="971"><td class="num" id="LN971">971</td><td class="line">        LogPrintf(<span class='string_literal'>"Signet derived magic (message start): %s\n"</span>, HexStr(chainparams.MessageStart()));</td></tr>
<tr class="codeline" data-linenumber="972"><td class="num" id="LN972">972</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="973"><td class="num" id="LN973">973</td><td class="line">    bilingual_str errors;</td></tr>
<tr class="codeline" data-linenumber="974"><td class="num" id="LN974">974</td><td class="line">    <span class='keyword'>for</span> (<span class='keyword'>const</span> <span class='keyword'>auto</span>&amp; arg : args.GetUnsuitableSectionOnlyArgs()) {</td></tr>
<tr class="codeline" data-linenumber="975"><td class="num" id="LN975">975</td><td class="line">        errors += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"Config setting for %s only applied on %s network when in [%s] section."</span>) + Untranslated(<span class='string_literal'>"\n"</span>), arg, network, network);</td></tr>
<tr class="codeline" data-linenumber="976"><td class="num" id="LN976">976</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="977"><td class="num" id="LN977">977</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="978"><td class="num" id="LN978">978</td><td class="line">    <span class='keyword'>if</span> (!errors.empty()) {</td></tr>
<tr class="codeline" data-linenumber="979"><td class="num" id="LN979">979</td><td class="line">        <span class='keyword'>return</span> InitError(errors);</td></tr>
<tr class="codeline" data-linenumber="980"><td class="num" id="LN980">980</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="981"><td class="num" id="LN981">981</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="982"><td class="num" id="LN982">982</td><td class="line">    <span class='comment'>// Warn if unrecognized section name are present in the config file.</span></td></tr>
<tr class="codeline" data-linenumber="983"><td class="num" id="LN983">983</td><td class="line">    bilingual_str warnings;</td></tr>
<tr class="codeline" data-linenumber="984"><td class="num" id="LN984">984</td><td class="line">    <span class='keyword'>for</span> (<span class='keyword'>const</span> <span class='keyword'>auto</span>&amp; section : args.GetUnrecognizedSections()) {</td></tr>
<tr class="codeline" data-linenumber="985"><td class="num" id="LN985">985</td><td class="line">        warnings += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(Untranslated(<span class='string_literal'>"%s:%i "</span>) + _(<span class='string_literal'>"Section [%s] is not recognized."</span>) + Untranslated(<span class='string_literal'>"\n"</span>), section.m_file, section.m_line, section.m_name);</td></tr>
<tr class="codeline" data-linenumber="986"><td class="num" id="LN986">986</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="987"><td class="num" id="LN987">987</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="988"><td class="num" id="LN988">988</td><td class="line">    <span class='keyword'>if</span> (!warnings.empty()) {</td></tr>
<tr class="codeline" data-linenumber="989"><td class="num" id="LN989">989</td><td class="line">        InitWarning(warnings);</td></tr>
<tr class="codeline" data-linenumber="990"><td class="num" id="LN990">990</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="991"><td class="num" id="LN991">991</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="992"><td class="num" id="LN992">992</td><td class="line">    <span class='keyword'>if</span> (!fs::is_directory(GetBlocksDir())) {</td></tr>
<tr class="codeline" data-linenumber="993"><td class="num" id="LN993">993</td><td class="line">        <span class='keyword'>return</span> InitError(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"Specified blocks directory \"%s\" does not exist."</span>), args.GetArg(<span class='string_literal'>"-blocksdir"</span>, <span class='string_literal'>""</span>)));</td></tr>
<tr class="codeline" data-linenumber="994"><td class="num" id="LN994">994</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="995"><td class="num" id="LN995">995</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="996"><td class="num" id="LN996">996</td><td class="line">    <span class='comment'>// parse and validate enabled filter types</span></td></tr>
<tr class="codeline" data-linenumber="997"><td class="num" id="LN997">997</td><td class="line">    std::string blockfilterindex_value = args.GetArg(<span class='string_literal'>"-blockfilterindex"</span>, DEFAULT_BLOCKFILTERINDEX);</td></tr>
<tr class="codeline" data-linenumber="998"><td class="num" id="LN998">998</td><td class="line">    <span class='keyword'>if</span> (blockfilterindex_value == <span class='string_literal'>""</span> || blockfilterindex_value == <span class='string_literal'>"1"</span>) {</td></tr>
<tr class="codeline" data-linenumber="999"><td class="num" id="LN999">999</td><td class="line">        g_enabled_filter_types = AllBlockFilterTypes();</td></tr>
<tr class="codeline" data-linenumber="1000"><td class="num" id="LN1000">1000</td><td class="line">    } <span class='keyword'>else</span> <span class='keyword'>if</span> (blockfilterindex_value != <span class='string_literal'>"0"</span>) {</td></tr>
<tr class="codeline" data-linenumber="1001"><td class="num" id="LN1001">1001</td><td class="line">        <span class='keyword'>const</span> std::vector&lt;std::string&gt; names = args.GetArgs(<span class='string_literal'>"-blockfilterindex"</span>);</td></tr>
<tr class="codeline" data-linenumber="1002"><td class="num" id="LN1002">1002</td><td class="line">        <span class='keyword'>for</span> (<span class='keyword'>const</span> <span class='keyword'>auto</span>&amp; name : names) {</td></tr>
<tr class="codeline" data-linenumber="1003"><td class="num" id="LN1003">1003</td><td class="line">            BlockFilterType filter_type;</td></tr>
<tr class="codeline" data-linenumber="1004"><td class="num" id="LN1004">1004</td><td class="line">            <span class='keyword'>if</span> (!BlockFilterTypeByName(name, filter_type)) {</td></tr>
<tr class="codeline" data-linenumber="1005"><td class="num" id="LN1005">1005</td><td class="line">                <span class='keyword'>return</span> InitError(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"Unknown -blockfilterindex value %s."</span>), name));</td></tr>
<tr class="codeline" data-linenumber="1006"><td class="num" id="LN1006">1006</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1007"><td class="num" id="LN1007">1007</td><td class="line">            g_enabled_filter_types.insert(filter_type);</td></tr>
<tr class="codeline" data-linenumber="1008"><td class="num" id="LN1008">1008</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1009"><td class="num" id="LN1009">1009</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1010"><td class="num" id="LN1010">1010</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1011"><td class="num" id="LN1011">1011</td><td class="line">    <span class='comment'>// Signal NODE_COMPACT_FILTERS if peerblockfilters and basic filters index are both enabled.</span></td></tr>
<tr class="codeline" data-linenumber="1012"><td class="num" id="LN1012">1012</td><td class="line">    <span class='keyword'>if</span> (args.GetBoolArg(<span class='string_literal'>"-peerblockfilters"</span>, DEFAULT_PEERBLOCKFILTERS)) {</td></tr>
<tr class="codeline" data-linenumber="1013"><td class="num" id="LN1013">1013</td><td class="line">        <span class='keyword'>if</span> (g_enabled_filter_types.count(BlockFilterType::BASIC) != 1) {</td></tr>
<tr class="codeline" data-linenumber="1014"><td class="num" id="LN1014">1014</td><td class="line">            <span class='keyword'>return</span> InitError(_(<span class='string_literal'>"Cannot set -peerblockfilters without -blockfilterindex."</span>));</td></tr>
<tr class="codeline" data-linenumber="1015"><td class="num" id="LN1015">1015</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1016"><td class="num" id="LN1016">1016</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1017"><td class="num" id="LN1017">1017</td><td class="line">        nLocalServices = ServiceFlags(nLocalServices | NODE_COMPACT_FILTERS);</td></tr>
<tr class="codeline" data-linenumber="1018"><td class="num" id="LN1018">1018</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1019"><td class="num" id="LN1019">1019</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1020"><td class="num" id="LN1020">1020</td><td class="line">    <span class='comment'>// if using block pruning, then disallow txindex</span></td></tr>
<tr class="codeline" data-linenumber="1021"><td class="num" id="LN1021">1021</td><td class="line">    <span class='keyword'>if</span> (args.GetArg(<span class='string_literal'>"-prune"</span>, 0)) {</td></tr>
<tr class="codeline" data-linenumber="1022"><td class="num" id="LN1022">1022</td><td class="line">        <span class='keyword'>if</span> (args.GetBoolArg(<span class='string_literal'>"-txindex"</span>, DEFAULT_TXINDEX))</td></tr>
<tr class="codeline" data-linenumber="1023"><td class="num" id="LN1023">1023</td><td class="line">            <span class='keyword'>return</span> InitError(_(<span class='string_literal'>"Prune mode is incompatible with -txindex."</span>));</td></tr>
<tr class="codeline" data-linenumber="1024"><td class="num" id="LN1024">1024</td><td class="line">        <span class='keyword'>if</span> (!g_enabled_filter_types.empty()) {</td></tr>
<tr class="codeline" data-linenumber="1025"><td class="num" id="LN1025">1025</td><td class="line">            <span class='keyword'>return</span> InitError(_(<span class='string_literal'>"Prune mode is incompatible with -blockfilterindex."</span>));</td></tr>
<tr class="codeline" data-linenumber="1026"><td class="num" id="LN1026">1026</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1027"><td class="num" id="LN1027">1027</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1028"><td class="num" id="LN1028">1028</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1029"><td class="num" id="LN1029">1029</td><td class="line">    <span class='comment'>// -bind and -whitebind can't be set when not listening</span></td></tr>
<tr class="codeline" data-linenumber="1030"><td class="num" id="LN1030">1030</td><td class="line">    size_t nUserBind = args.GetArgs(<span class='string_literal'>"-bind"</span>).size() + args.GetArgs(<span class='string_literal'>"-whitebind"</span>).size();</td></tr>
<tr class="codeline" data-linenumber="1031"><td class="num" id="LN1031">1031</td><td class="line">    <span class='keyword'>if</span> (nUserBind != 0 &amp;&amp; !args.GetBoolArg(<span class='string_literal'>"-listen"</span>, DEFAULT_LISTEN)) {</td></tr>
<tr class="codeline" data-linenumber="1032"><td class="num" id="LN1032">1032</td><td class="line">        <span class='keyword'>return</span> InitError(Untranslated(<span class='string_literal'>"Cannot set -bind or -whitebind together with -listen=0"</span>));</td></tr>
<tr class="codeline" data-linenumber="1033"><td class="num" id="LN1033">1033</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1034"><td class="num" id="LN1034">1034</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1035"><td class="num" id="LN1035">1035</td><td class="line">    <span class='comment'>// Make sure enough file descriptors are available</span></td></tr>
<tr class="codeline" data-linenumber="1036"><td class="num" id="LN1036">1036</td><td class="line">    <span class='keyword'>int</span> nBind = std::max(nUserBind, size_t(1));</td></tr>
<tr class="codeline" data-linenumber="1037"><td class="num" id="LN1037">1037</td><td class="line">    nUserMaxConnections = args.GetArg(<span class='string_literal'>"-maxconnections"</span>, DEFAULT_MAX_PEER_CONNECTIONS);</td></tr>
<tr class="codeline" data-linenumber="1038"><td class="num" id="LN1038">1038</td><td class="line">    nMaxConnections = std::max(nUserMaxConnections, 0);</td></tr>
<tr class="codeline" data-linenumber="1039"><td class="num" id="LN1039">1039</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1040"><td class="num" id="LN1040">1040</td><td class="line">    <span class='comment'>// Trim requested connection counts, to fit into system limitations</span></td></tr>
<tr class="codeline" data-linenumber="1041"><td class="num" id="LN1041">1041</td><td class="line">    <span class='comment'>// &lt;int&gt; in std::min&lt;int&gt;(...) to work around FreeBSD compilation issue described in #2695</span></td></tr>
<tr class="codeline" data-linenumber="1042"><td class="num" id="LN1042">1042</td><td class="line">    nFD = RaiseFileDescriptorLimit(nMaxConnections + <span class='macro'>MIN_CORE_FILEDESCRIPTORS<span class='macro_popup'>150</span></span> + MAX_ADDNODE_CONNECTIONS);</td></tr>
<tr class="codeline" data-linenumber="1043"><td class="num" id="LN1043">1043</td><td class="line"><span class='directive'>#ifdef USE_POLL</span></td></tr>
<tr class="codeline" data-linenumber="1044"><td class="num" id="LN1044">1044</td><td class="line">    <span class='keyword'>int</span> fd_max = nFD;</td></tr>
<tr class="codeline" data-linenumber="1045"><td class="num" id="LN1045">1045</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="1046"><td class="num" id="LN1046">1046</td><td class="line">    <span class='keyword'>int</span> fd_max = <span class='macro'>FD_SETSIZE<span class='macro_popup'>1024</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1047"><td class="num" id="LN1047">1047</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1048"><td class="num" id="LN1048">1048</td><td class="line">    nMaxConnections = std::max(std::min&lt;<span class='keyword'>int</span>&gt;(nMaxConnections, fd_max - nBind - <span class='macro'>MIN_CORE_FILEDESCRIPTORS<span class='macro_popup'>150</span></span> - MAX_ADDNODE_CONNECTIONS), 0);</td></tr>
<tr class="codeline" data-linenumber="1049"><td class="num" id="LN1049">1049</td><td class="line">    <span class='keyword'>if</span> (nFD &lt; <span class='macro'>MIN_CORE_FILEDESCRIPTORS<span class='macro_popup'>150</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1050"><td class="num" id="LN1050">1050</td><td class="line">        <span class='keyword'>return</span> InitError(_(<span class='string_literal'>"Not enough file descriptors available."</span>));</td></tr>
<tr class="codeline" data-linenumber="1051"><td class="num" id="LN1051">1051</td><td class="line">    nMaxConnections = std::min(nFD - <span class='macro'>MIN_CORE_FILEDESCRIPTORS<span class='macro_popup'>150</span></span> - MAX_ADDNODE_CONNECTIONS, nMaxConnections);</td></tr>
<tr class="codeline" data-linenumber="1052"><td class="num" id="LN1052">1052</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1053"><td class="num" id="LN1053">1053</td><td class="line">    <span class='keyword'>if</span> (nMaxConnections &lt; nUserMaxConnections)</td></tr>
<tr class="codeline" data-linenumber="1054"><td class="num" id="LN1054">1054</td><td class="line">        InitWarning(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"Reducing -maxconnections from %d to %d, because of system limitations."</span>), nUserMaxConnections, nMaxConnections));</td></tr>
<tr class="codeline" data-linenumber="1055"><td class="num" id="LN1055">1055</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1056"><td class="num" id="LN1056">1056</td><td class="line">    <span class='comment'>// ********************************************************* Step 3: parameter-to-internal-flags</span></td></tr>
<tr class="codeline" data-linenumber="1057"><td class="num" id="LN1057">1057</td><td class="line">    <span class='keyword'>if</span> (args.IsArgSet(<span class='string_literal'>"-debug"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1058"><td class="num" id="LN1058">1058</td><td class="line">        <span class='comment'>// Special-case: if -debug=0/-nodebug is set, turn off debugging messages</span></td></tr>
<tr class="codeline" data-linenumber="1059"><td class="num" id="LN1059">1059</td><td class="line">        <span class='keyword'>const</span> std::vector&lt;std::string&gt; categories = args.GetArgs(<span class='string_literal'>"-debug"</span>);</td></tr>
<tr class="codeline" data-linenumber="1060"><td class="num" id="LN1060">1060</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1061"><td class="num" id="LN1061">1061</td><td class="line">        <span class='keyword'>if</span> (std::none_of(categories.begin(), categories.end(),</td></tr>
<tr class="codeline" data-linenumber="1062"><td class="num" id="LN1062">1062</td><td class="line">            [](std::string cat){<span class='keyword'>return</span> cat == <span class='string_literal'>"0"</span> || cat == <span class='string_literal'>"none"</span>;})) {</td></tr>
<tr class="codeline" data-linenumber="1063"><td class="num" id="LN1063">1063</td><td class="line">            <span class='keyword'>for</span> (<span class='keyword'>const</span> <span class='keyword'>auto</span>&amp; cat : categories) {</td></tr>
<tr class="codeline" data-linenumber="1064"><td class="num" id="LN1064">1064</td><td class="line">                <span class='keyword'>if</span> (!LogInstance().EnableCategory(cat)) {</td></tr>
<tr class="codeline" data-linenumber="1065"><td class="num" id="LN1065">1065</td><td class="line">                    InitWarning(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"Unsupported logging category %s=%s."</span>), <span class='string_literal'>"-debug"</span>, cat));</td></tr>
<tr class="codeline" data-linenumber="1066"><td class="num" id="LN1066">1066</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1067"><td class="num" id="LN1067">1067</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1068"><td class="num" id="LN1068">1068</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1069"><td class="num" id="LN1069">1069</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1070"><td class="num" id="LN1070">1070</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1071"><td class="num" id="LN1071">1071</td><td class="line">    <span class='comment'>// Now remove the logging categories which were explicitly excluded</span></td></tr>
<tr class="codeline" data-linenumber="1072"><td class="num" id="LN1072">1072</td><td class="line">    <span class='keyword'>for</span> (<span class='keyword'>const</span> std::string&amp; cat : args.GetArgs(<span class='string_literal'>"-debugexclude"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1073"><td class="num" id="LN1073">1073</td><td class="line">        <span class='keyword'>if</span> (!LogInstance().DisableCategory(cat)) {</td></tr>
<tr class="codeline" data-linenumber="1074"><td class="num" id="LN1074">1074</td><td class="line">            InitWarning(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"Unsupported logging category %s=%s."</span>), <span class='string_literal'>"-debugexclude"</span>, cat));</td></tr>
<tr class="codeline" data-linenumber="1075"><td class="num" id="LN1075">1075</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1076"><td class="num" id="LN1076">1076</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1077"><td class="num" id="LN1077">1077</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1078"><td class="num" id="LN1078">1078</td><td class="line">    fCheckBlockIndex = args.GetBoolArg(<span class='string_literal'>"-checkblockindex"</span>, chainparams.DefaultConsistencyChecks());</td></tr>
<tr class="codeline" data-linenumber="1079"><td class="num" id="LN1079">1079</td><td class="line">    fCheckpointsEnabled = args.GetBoolArg(<span class='string_literal'>"-checkpoints"</span>, DEFAULT_CHECKPOINTS_ENABLED);</td></tr>
<tr class="codeline" data-linenumber="1080"><td class="num" id="LN1080">1080</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1081"><td class="num" id="LN1081">1081</td><td class="line">    hashAssumeValid = uint256S(args.GetArg(<span class='string_literal'>"-assumevalid"</span>, chainparams.GetConsensus().defaultAssumeValid.GetHex()));</td></tr>
<tr class="codeline" data-linenumber="1082"><td class="num" id="LN1082">1082</td><td class="line">    <span class='keyword'>if</span> (!hashAssumeValid.IsNull())</td></tr>
<tr class="codeline" data-linenumber="1083"><td class="num" id="LN1083">1083</td><td class="line">        LogPrintf(<span class='string_literal'>"Assuming ancestors of block %s have valid signatures.\n"</span>, hashAssumeValid.GetHex());</td></tr>
<tr class="codeline" data-linenumber="1084"><td class="num" id="LN1084">1084</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1085"><td class="num" id="LN1085">1085</td><td class="line">        LogPrintf(<span class='string_literal'>"Validating signatures for all blocks.\n"</span>);</td></tr>
<tr class="codeline" data-linenumber="1086"><td class="num" id="LN1086">1086</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1087"><td class="num" id="LN1087">1087</td><td class="line">    <span class='keyword'>if</span> (args.IsArgSet(<span class='string_literal'>"-minimumchainwork"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1088"><td class="num" id="LN1088">1088</td><td class="line">        <span class='keyword'>const</span> std::string minChainWorkStr = args.GetArg(<span class='string_literal'>"-minimumchainwork"</span>, <span class='string_literal'>""</span>);</td></tr>
<tr class="codeline" data-linenumber="1089"><td class="num" id="LN1089">1089</td><td class="line">        <span class='keyword'>if</span> (!IsHexNumber(minChainWorkStr)) {</td></tr>
<tr class="codeline" data-linenumber="1090"><td class="num" id="LN1090">1090</td><td class="line">            <span class='keyword'>return</span> InitError(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(Untranslated(<span class='string_literal'>"Invalid non-hex (%s) minimum chain work value specified"</span>), minChainWorkStr));</td></tr>
<tr class="codeline" data-linenumber="1091"><td class="num" id="LN1091">1091</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1092"><td class="num" id="LN1092">1092</td><td class="line">        nMinimumChainWork = UintToArith256(uint256S(minChainWorkStr));</td></tr>
<tr class="codeline" data-linenumber="1093"><td class="num" id="LN1093">1093</td><td class="line">    } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="1094"><td class="num" id="LN1094">1094</td><td class="line">        nMinimumChainWork = UintToArith256(chainparams.GetConsensus().nMinimumChainWork);</td></tr>
<tr class="codeline" data-linenumber="1095"><td class="num" id="LN1095">1095</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1096"><td class="num" id="LN1096">1096</td><td class="line">    LogPrintf(<span class='string_literal'>"Setting nMinimumChainWork=%s\n"</span>, nMinimumChainWork.GetHex());</td></tr>
<tr class="codeline" data-linenumber="1097"><td class="num" id="LN1097">1097</td><td class="line">    <span class='keyword'>if</span> (nMinimumChainWork &lt; UintToArith256(chainparams.GetConsensus().nMinimumChainWork)) {</td></tr>
<tr class="codeline" data-linenumber="1098"><td class="num" id="LN1098">1098</td><td class="line">        LogPrintf(<span class='string_literal'>"Warning: nMinimumChainWork set below default value of %s\n"</span>, chainparams.GetConsensus().nMinimumChainWork.GetHex());</td></tr>
<tr class="codeline" data-linenumber="1099"><td class="num" id="LN1099">1099</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1100"><td class="num" id="LN1100">1100</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1101"><td class="num" id="LN1101">1101</td><td class="line">    <span class='comment'>// mempool limits</span></td></tr>
<tr class="codeline" data-linenumber="1102"><td class="num" id="LN1102">1102</td><td class="line">    int64_t nMempoolSizeMax = args.GetArg(<span class='string_literal'>"-maxmempool"</span>, DEFAULT_MAX_MEMPOOL_SIZE) * 1000000;</td></tr>
<tr class="codeline" data-linenumber="1103"><td class="num" id="LN1103">1103</td><td class="line">    int64_t nMempoolSizeMin = args.GetArg(<span class='string_literal'>"-limitdescendantsize"</span>, DEFAULT_DESCENDANT_SIZE_LIMIT) * 1000 * 40;</td></tr>
<tr class="codeline" data-linenumber="1104"><td class="num" id="LN1104">1104</td><td class="line">    <span class='keyword'>if</span> (nMempoolSizeMax &lt; 0 || nMempoolSizeMax &lt; nMempoolSizeMin)</td></tr>
<tr class="codeline" data-linenumber="1105"><td class="num" id="LN1105">1105</td><td class="line">        <span class='keyword'>return</span> InitError(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"-maxmempool must be at least %d MB"</span>), std::ceil(nMempoolSizeMin / 1000000.0)));</td></tr>
<tr class="codeline" data-linenumber="1106"><td class="num" id="LN1106">1106</td><td class="line">    <span class='comment'>// incremental relay fee sets the minimum feerate increase necessary for BIP 125 replacement in the mempool</span></td></tr>
<tr class="codeline" data-linenumber="1107"><td class="num" id="LN1107">1107</td><td class="line">    <span class='comment'>// and the amount the mempool min fee increases above the feerate of txs evicted due to mempool limiting.</span></td></tr>
<tr class="codeline" data-linenumber="1108"><td class="num" id="LN1108">1108</td><td class="line">    <span class='keyword'>if</span> (args.IsArgSet(<span class='string_literal'>"-incrementalrelayfee"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1109"><td class="num" id="LN1109">1109</td><td class="line">        CAmount n = 0;</td></tr>
<tr class="codeline" data-linenumber="1110"><td class="num" id="LN1110">1110</td><td class="line">        <span class='keyword'>if</span> (!ParseMoney(args.GetArg(<span class='string_literal'>"-incrementalrelayfee"</span>, <span class='string_literal'>""</span>), n))</td></tr>
<tr class="codeline" data-linenumber="1111"><td class="num" id="LN1111">1111</td><td class="line">            <span class='keyword'>return</span> InitError(AmountErrMsg(<span class='string_literal'>"incrementalrelayfee"</span>, args.GetArg(<span class='string_literal'>"-incrementalrelayfee"</span>, <span class='string_literal'>""</span>)));</td></tr>
<tr class="codeline" data-linenumber="1112"><td class="num" id="LN1112">1112</td><td class="line">        incrementalRelayFee = CFeeRate(n);</td></tr>
<tr class="codeline" data-linenumber="1113"><td class="num" id="LN1113">1113</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1114"><td class="num" id="LN1114">1114</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1115"><td class="num" id="LN1115">1115</td><td class="line">    <span class='comment'>// block pruning; get the amount of disk space (in MiB) to allot for block &amp; undo files</span></td></tr>
<tr class="codeline" data-linenumber="1116"><td class="num" id="LN1116">1116</td><td class="line">    int64_t nPruneArg = args.GetArg(<span class='string_literal'>"-prune"</span>, 0);</td></tr>
<tr class="codeline" data-linenumber="1117"><td class="num" id="LN1117">1117</td><td class="line">    <span class='keyword'>if</span> (nPruneArg &lt; 0) {</td></tr>
<tr class="codeline" data-linenumber="1118"><td class="num" id="LN1118">1118</td><td class="line">        <span class='keyword'>return</span> InitError(_(<span class='string_literal'>"Prune cannot be configured with a negative value."</span>));</td></tr>
<tr class="codeline" data-linenumber="1119"><td class="num" id="LN1119">1119</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1120"><td class="num" id="LN1120">1120</td><td class="line">    nPruneTarget = (uint64_t) nPruneArg * 1024 * 1024;</td></tr>
<tr class="codeline" data-linenumber="1121"><td class="num" id="LN1121">1121</td><td class="line">    <span class='keyword'>if</span> (nPruneArg == 1) {  <span class='comment'>// manual pruning: -prune=1</span></td></tr>
<tr class="codeline" data-linenumber="1122"><td class="num" id="LN1122">1122</td><td class="line">        LogPrintf(<span class='string_literal'>"Block pruning enabled.  Use RPC call pruneblockchain(height) to manually prune block and undo files.\n"</span>);</td></tr>
<tr class="codeline" data-linenumber="1123"><td class="num" id="LN1123">1123</td><td class="line">        nPruneTarget = std::numeric_limits&lt;uint64_t&gt;::max();</td></tr>
<tr class="codeline" data-linenumber="1124"><td class="num" id="LN1124">1124</td><td class="line">        fPruneMode = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="1125"><td class="num" id="LN1125">1125</td><td class="line">    } <span class='keyword'>else</span> <span class='keyword'>if</span> (nPruneTarget) {</td></tr>
<tr class="codeline" data-linenumber="1126"><td class="num" id="LN1126">1126</td><td class="line">        <span class='keyword'>if</span> (nPruneTarget &lt; MIN_DISK_SPACE_FOR_BLOCK_FILES) {</td></tr>
<tr class="codeline" data-linenumber="1127"><td class="num" id="LN1127">1127</td><td class="line">            <span class='keyword'>return</span> InitError(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"Prune configured below the minimum of %d MiB.  Please use a higher number."</span>), MIN_DISK_SPACE_FOR_BLOCK_FILES / 1024 / 1024));</td></tr>
<tr class="codeline" data-linenumber="1128"><td class="num" id="LN1128">1128</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1129"><td class="num" id="LN1129">1129</td><td class="line">        LogPrintf(<span class='string_literal'>"Prune configured to target %u MiB on disk for block and undo files.\n"</span>, nPruneTarget / 1024 / 1024);</td></tr>
<tr class="codeline" data-linenumber="1130"><td class="num" id="LN1130">1130</td><td class="line">        fPruneMode = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="1131"><td class="num" id="LN1131">1131</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1132"><td class="num" id="LN1132">1132</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1133"><td class="num" id="LN1133">1133</td><td class="line">    nConnectTimeout = args.GetArg(<span class='string_literal'>"-timeout"</span>, DEFAULT_CONNECT_TIMEOUT);</td></tr>
<tr class="codeline" data-linenumber="1134"><td class="num" id="LN1134">1134</td><td class="line">    <span class='keyword'>if</span> (nConnectTimeout &lt;= 0) {</td></tr>
<tr class="codeline" data-linenumber="1135"><td class="num" id="LN1135">1135</td><td class="line">        nConnectTimeout = DEFAULT_CONNECT_TIMEOUT;</td></tr>
<tr class="codeline" data-linenumber="1136"><td class="num" id="LN1136">1136</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1137"><td class="num" id="LN1137">1137</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1138"><td class="num" id="LN1138">1138</td><td class="line">    peer_connect_timeout = args.GetArg(<span class='string_literal'>"-peertimeout"</span>, DEFAULT_PEER_CONNECT_TIMEOUT);</td></tr>
<tr class="codeline" data-linenumber="1139"><td class="num" id="LN1139">1139</td><td class="line">    <span class='keyword'>if</span> (peer_connect_timeout &lt;= 0) {</td></tr>
<tr class="codeline" data-linenumber="1140"><td class="num" id="LN1140">1140</td><td class="line">        <span class='keyword'>return</span> InitError(Untranslated(<span class='string_literal'>"peertimeout cannot be configured with a negative value."</span>));</td></tr>
<tr class="codeline" data-linenumber="1141"><td class="num" id="LN1141">1141</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1142"><td class="num" id="LN1142">1142</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1143"><td class="num" id="LN1143">1143</td><td class="line">    <span class='keyword'>if</span> (args.IsArgSet(<span class='string_literal'>"-minrelaytxfee"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1144"><td class="num" id="LN1144">1144</td><td class="line">        CAmount n = 0;</td></tr>
<tr class="codeline" data-linenumber="1145"><td class="num" id="LN1145">1145</td><td class="line">        <span class='keyword'>if</span> (!ParseMoney(args.GetArg(<span class='string_literal'>"-minrelaytxfee"</span>, <span class='string_literal'>""</span>), n)) {</td></tr>
<tr class="codeline" data-linenumber="1146"><td class="num" id="LN1146">1146</td><td class="line">            <span class='keyword'>return</span> InitError(AmountErrMsg(<span class='string_literal'>"minrelaytxfee"</span>, args.GetArg(<span class='string_literal'>"-minrelaytxfee"</span>, <span class='string_literal'>""</span>)));</td></tr>
<tr class="codeline" data-linenumber="1147"><td class="num" id="LN1147">1147</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1148"><td class="num" id="LN1148">1148</td><td class="line">        <span class='comment'>// High fee check is done afterward in CWallet::Create()</span></td></tr>
<tr class="codeline" data-linenumber="1149"><td class="num" id="LN1149">1149</td><td class="line">        ::minRelayTxFee = CFeeRate(n);</td></tr>
<tr class="codeline" data-linenumber="1150"><td class="num" id="LN1150">1150</td><td class="line">    } <span class='keyword'>else</span> <span class='keyword'>if</span> (incrementalRelayFee &gt; ::minRelayTxFee) {</td></tr>
<tr class="codeline" data-linenumber="1151"><td class="num" id="LN1151">1151</td><td class="line">        <span class='comment'>// Allow only setting incrementalRelayFee to control both</span></td></tr>
<tr class="codeline" data-linenumber="1152"><td class="num" id="LN1152">1152</td><td class="line">        ::minRelayTxFee = incrementalRelayFee;</td></tr>
<tr class="codeline" data-linenumber="1153"><td class="num" id="LN1153">1153</td><td class="line">        LogPrintf(<span class='string_literal'>"Increasing minrelaytxfee to %s to match incrementalrelayfee\n"</span>,::minRelayTxFee.ToString());</td></tr>
<tr class="codeline" data-linenumber="1154"><td class="num" id="LN1154">1154</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1155"><td class="num" id="LN1155">1155</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1156"><td class="num" id="LN1156">1156</td><td class="line">    <span class='comment'>// Sanity check argument for min fee for including tx in block</span></td></tr>
<tr class="codeline" data-linenumber="1157"><td class="num" id="LN1157">1157</td><td class="line">    <span class='comment'>// TODO: Harmonize which arguments need sanity checking and where that happens</span></td></tr>
<tr class="codeline" data-linenumber="1158"><td class="num" id="LN1158">1158</td><td class="line">    <span class='keyword'>if</span> (args.IsArgSet(<span class='string_literal'>"-blockmintxfee"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1159"><td class="num" id="LN1159">1159</td><td class="line">        CAmount n = 0;</td></tr>
<tr class="codeline" data-linenumber="1160"><td class="num" id="LN1160">1160</td><td class="line">        <span class='keyword'>if</span> (!ParseMoney(args.GetArg(<span class='string_literal'>"-blockmintxfee"</span>, <span class='string_literal'>""</span>), n))</td></tr>
<tr class="codeline" data-linenumber="1161"><td class="num" id="LN1161">1161</td><td class="line">            <span class='keyword'>return</span> InitError(AmountErrMsg(<span class='string_literal'>"blockmintxfee"</span>, args.GetArg(<span class='string_literal'>"-blockmintxfee"</span>, <span class='string_literal'>""</span>)));</td></tr>
<tr class="codeline" data-linenumber="1162"><td class="num" id="LN1162">1162</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1163"><td class="num" id="LN1163">1163</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1164"><td class="num" id="LN1164">1164</td><td class="line">    <span class='comment'>// Feerate used to define dust.  Shouldn't be changed lightly as old</span></td></tr>
<tr class="codeline" data-linenumber="1165"><td class="num" id="LN1165">1165</td><td class="line">    <span class='comment'>// implementations may inadvertently create non-standard transactions</span></td></tr>
<tr class="codeline" data-linenumber="1166"><td class="num" id="LN1166">1166</td><td class="line">    <span class='keyword'>if</span> (args.IsArgSet(<span class='string_literal'>"-dustrelayfee"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1167"><td class="num" id="LN1167">1167</td><td class="line">        CAmount n = 0;</td></tr>
<tr class="codeline" data-linenumber="1168"><td class="num" id="LN1168">1168</td><td class="line">        <span class='keyword'>if</span> (!ParseMoney(args.GetArg(<span class='string_literal'>"-dustrelayfee"</span>, <span class='string_literal'>""</span>), n))</td></tr>
<tr class="codeline" data-linenumber="1169"><td class="num" id="LN1169">1169</td><td class="line">            <span class='keyword'>return</span> InitError(AmountErrMsg(<span class='string_literal'>"dustrelayfee"</span>, args.GetArg(<span class='string_literal'>"-dustrelayfee"</span>, <span class='string_literal'>""</span>)));</td></tr>
<tr class="codeline" data-linenumber="1170"><td class="num" id="LN1170">1170</td><td class="line">        dustRelayFee = CFeeRate(n);</td></tr>
<tr class="codeline" data-linenumber="1171"><td class="num" id="LN1171">1171</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1172"><td class="num" id="LN1172">1172</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1173"><td class="num" id="LN1173">1173</td><td class="line">    fRequireStandard = !args.GetBoolArg(<span class='string_literal'>"-acceptnonstdtxn"</span>, !chainparams.RequireStandard());</td></tr>
<tr class="codeline" data-linenumber="1174"><td class="num" id="LN1174">1174</td><td class="line">    <span class='keyword'>if</span> (!chainparams.IsTestChain() &amp;&amp; !fRequireStandard) {</td></tr>
<tr class="codeline" data-linenumber="1175"><td class="num" id="LN1175">1175</td><td class="line">        <span class='keyword'>return</span> InitError(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(Untranslated(<span class='string_literal'>"acceptnonstdtxn is not currently supported for %s chain"</span>), chainparams.NetworkIDString()));</td></tr>
<tr class="codeline" data-linenumber="1176"><td class="num" id="LN1176">1176</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1177"><td class="num" id="LN1177">1177</td><td class="line">    nBytesPerSigOp = args.GetArg(<span class='string_literal'>"-bytespersigop"</span>, nBytesPerSigOp);</td></tr>
<tr class="codeline" data-linenumber="1178"><td class="num" id="LN1178">1178</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1179"><td class="num" id="LN1179">1179</td><td class="line">    <span class='keyword'>if</span> (!g_wallet_init_interface.ParameterInteraction()) <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1180"><td class="num" id="LN1180">1180</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1181"><td class="num" id="LN1181">1181</td><td class="line">    fIsBareMultisigStd = args.GetBoolArg(<span class='string_literal'>"-permitbaremultisig"</span>, DEFAULT_PERMIT_BAREMULTISIG);</td></tr>
<tr class="codeline" data-linenumber="1182"><td class="num" id="LN1182">1182</td><td class="line">    fAcceptDatacarrier = args.GetBoolArg(<span class='string_literal'>"-datacarrier"</span>, DEFAULT_ACCEPT_DATACARRIER);</td></tr>
<tr class="codeline" data-linenumber="1183"><td class="num" id="LN1183">1183</td><td class="line">    nMaxDatacarrierBytes = args.GetArg(<span class='string_literal'>"-datacarriersize"</span>, nMaxDatacarrierBytes);</td></tr>
<tr class="codeline" data-linenumber="1184"><td class="num" id="LN1184">1184</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1185"><td class="num" id="LN1185">1185</td><td class="line">    <span class='comment'>// Option to startup with mocktime set (used for regression testing):</span></td></tr>
<tr class="codeline" data-linenumber="1186"><td class="num" id="LN1186">1186</td><td class="line">    SetMockTime(args.GetArg(<span class='string_literal'>"-mocktime"</span>, 0)); <span class='comment'>// SetMockTime(0) is a no-op</span></td></tr>
<tr class="codeline" data-linenumber="1187"><td class="num" id="LN1187">1187</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1188"><td class="num" id="LN1188">1188</td><td class="line">    <span class='keyword'>if</span> (args.GetBoolArg(<span class='string_literal'>"-peerbloomfilters"</span>, DEFAULT_PEERBLOOMFILTERS))</td></tr>
<tr class="codeline" data-linenumber="1189"><td class="num" id="LN1189">1189</td><td class="line">        nLocalServices = ServiceFlags(nLocalServices | NODE_BLOOM);</td></tr>
<tr class="codeline" data-linenumber="1190"><td class="num" id="LN1190">1190</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1191"><td class="num" id="LN1191">1191</td><td class="line">    <span class='keyword'>if</span> (args.GetArg(<span class='string_literal'>"-rpcserialversion"</span>, DEFAULT_RPC_SERIALIZE_VERSION) &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="1192"><td class="num" id="LN1192">1192</td><td class="line">        <span class='keyword'>return</span> InitError(Untranslated(<span class='string_literal'>"rpcserialversion must be non-negative."</span>));</td></tr>
<tr class="codeline" data-linenumber="1193"><td class="num" id="LN1193">1193</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1194"><td class="num" id="LN1194">1194</td><td class="line">    <span class='keyword'>if</span> (args.GetArg(<span class='string_literal'>"-rpcserialversion"</span>, DEFAULT_RPC_SERIALIZE_VERSION) &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="1195"><td class="num" id="LN1195">1195</td><td class="line">        <span class='keyword'>return</span> InitError(Untranslated(<span class='string_literal'>"Unknown rpcserialversion requested."</span>));</td></tr>
<tr class="codeline" data-linenumber="1196"><td class="num" id="LN1196">1196</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1197"><td class="num" id="LN1197">1197</td><td class="line">    nMaxTipAge = args.GetArg(<span class='string_literal'>"-maxtipage"</span>, DEFAULT_MAX_TIP_AGE);</td></tr>
<tr class="codeline" data-linenumber="1198"><td class="num" id="LN1198">1198</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1199"><td class="num" id="LN1199">1199</td><td class="line">    <span class='keyword'>if</span> (args.IsArgSet(<span class='string_literal'>"-proxy"</span>) &amp;&amp; args.GetArg(<span class='string_literal'>"-proxy"</span>, <span class='string_literal'>""</span>).empty()) {</td></tr>
<tr class="codeline" data-linenumber="1200"><td class="num" id="LN1200">1200</td><td class="line">        <span class='keyword'>return</span> InitError(_(<span class='string_literal'>"No proxy server specified. Use -proxy=&lt;ip&gt; or -proxy=&lt;ip:port&gt;."</span>));</td></tr>
<tr class="codeline" data-linenumber="1201"><td class="num" id="LN1201">1201</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1202"><td class="num" id="LN1202">1202</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1203"><td class="num" id="LN1203">1203</td><td class="line">    <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="1204"><td class="num" id="LN1204">1204</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1205"><td class="num" id="LN1205">1205</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1206"><td class="num" id="LN1206">1206</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>bool</span> LockDataDirectory(<span class='keyword'>bool</span> probeOnly)</td></tr>
<tr class="codeline" data-linenumber="1207"><td class="num" id="LN1207">1207</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1208"><td class="num" id="LN1208">1208</td><td class="line">    <span class='comment'>// Make sure only a single Bitcoin process is using the data directory.</span></td></tr>
<tr class="codeline" data-linenumber="1209"><td class="num" id="LN1209">1209</td><td class="line">    fs::path datadir = GetDataDir();</td></tr>
<tr class="codeline" data-linenumber="1210"><td class="num" id="LN1210">1210</td><td class="line">    <span class='keyword'>if</span> (!DirIsWritable(datadir)) {</td></tr>
<tr class="codeline" data-linenumber="1211"><td class="num" id="LN1211">1211</td><td class="line">        <span class='keyword'>return</span> InitError(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"Cannot write to data directory '%s'; check permissions."</span>), datadir.string()));</td></tr>
<tr class="codeline" data-linenumber="1212"><td class="num" id="LN1212">1212</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1213"><td class="num" id="LN1213">1213</td><td class="line">    <span class='keyword'>if</span> (!LockDirectory(datadir, <span class='string_literal'>".lock"</span>, probeOnly)) {</td></tr>
<tr class="codeline" data-linenumber="1214"><td class="num" id="LN1214">1214</td><td class="line">        <span class='keyword'>return</span> InitError(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"Cannot obtain a lock on data directory %s. %s is probably already running."</span>), datadir.string(), <span class='macro'>PACKAGE_NAME<span class='macro_popup'>"Bitcoin Core"</span></span>));</td></tr>
<tr class="codeline" data-linenumber="1215"><td class="num" id="LN1215">1215</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1216"><td class="num" id="LN1216">1216</td><td class="line">    <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="1217"><td class="num" id="LN1217">1217</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1218"><td class="num" id="LN1218">1218</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1219"><td class="num" id="LN1219">1219</td><td class="line"><span class='keyword'>bool</span> AppInitSanityChecks()</td></tr>
<tr class="codeline" data-linenumber="1220"><td class="num" id="LN1220">1220</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1221"><td class="num" id="LN1221">1221</td><td class="line">    <span class='comment'>// ********************************************************* Step 4: sanity checks</span></td></tr>
<tr class="codeline" data-linenumber="1222"><td class="num" id="LN1222">1222</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1223"><td class="num" id="LN1223">1223</td><td class="line">    <span class='comment'>// Initialize elliptic curve code</span></td></tr>
<tr class="codeline" data-linenumber="1224"><td class="num" id="LN1224">1224</td><td class="line">    std::string sha256_algo = SHA256AutoDetect();</td></tr>
<tr class="codeline" data-linenumber="1225"><td class="num" id="LN1225">1225</td><td class="line">    LogPrintf(<span class='string_literal'>"Using the '%s' SHA256 implementation\n"</span>, sha256_algo);</td></tr>
<tr class="codeline" data-linenumber="1226"><td class="num" id="LN1226">1226</td><td class="line">    RandomInit();</td></tr>
<tr class="codeline" data-linenumber="1227"><td class="num" id="LN1227">1227</td><td class="line">    ECC_Start();</td></tr>
<tr class="codeline" data-linenumber="1228"><td class="num" id="LN1228">1228</td><td class="line">    globalVerifyHandle.reset(<span class='keyword'>new</span> ECCVerifyHandle());</td></tr>
<tr class="codeline" data-linenumber="1229"><td class="num" id="LN1229">1229</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1230"><td class="num" id="LN1230">1230</td><td class="line">    <span class='comment'>// Sanity check</span></td></tr>
<tr class="codeline" data-linenumber="1231"><td class="num" id="LN1231">1231</td><td class="line">    <span class='keyword'>if</span> (!InitSanityCheck())</td></tr>
<tr class="codeline" data-linenumber="1232"><td class="num" id="LN1232">1232</td><td class="line">        <span class='keyword'>return</span> InitError(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"Initialization sanity check failed. %s is shutting down."</span>), <span class='macro'>PACKAGE_NAME<span class='macro_popup'>"Bitcoin Core"</span></span>));</td></tr>
<tr class="codeline" data-linenumber="1233"><td class="num" id="LN1233">1233</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1234"><td class="num" id="LN1234">1234</td><td class="line">    <span class='comment'>// Probe the data directory lock to give an early error message, if possible</span></td></tr>
<tr class="codeline" data-linenumber="1235"><td class="num" id="LN1235">1235</td><td class="line">    <span class='comment'>// We cannot hold the data directory lock here, as the forking for daemon() hasn't yet happened,</span></td></tr>
<tr class="codeline" data-linenumber="1236"><td class="num" id="LN1236">1236</td><td class="line">    <span class='comment'>// and a fork will cause weird behavior to it.</span></td></tr>
<tr class="codeline" data-linenumber="1237"><td class="num" id="LN1237">1237</td><td class="line">    <span class='keyword'>return</span> LockDataDirectory(<span class='keyword'>true</span>);</td></tr>
<tr class="codeline" data-linenumber="1238"><td class="num" id="LN1238">1238</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1239"><td class="num" id="LN1239">1239</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1240"><td class="num" id="LN1240">1240</td><td class="line"><span class='keyword'>bool</span> AppInitLockDataDirectory()</td></tr>
<tr class="codeline" data-linenumber="1241"><td class="num" id="LN1241">1241</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1242"><td class="num" id="LN1242">1242</td><td class="line">    <span class='comment'>// After daemonization get the data directory lock again and hold on to it until exit</span></td></tr>
<tr class="codeline" data-linenumber="1243"><td class="num" id="LN1243">1243</td><td class="line">    <span class='comment'>// This creates a slight window for a race condition to happen, however this condition is harmless: it</span></td></tr>
<tr class="codeline" data-linenumber="1244"><td class="num" id="LN1244">1244</td><td class="line">    <span class='comment'>// will at most make us exit without printing a message to console.</span></td></tr>
<tr class="codeline" data-linenumber="1245"><td class="num" id="LN1245">1245</td><td class="line">    <span class='keyword'>if</span> (!LockDataDirectory(<span class='keyword'>false</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1246"><td class="num" id="LN1246">1246</td><td class="line">        <span class='comment'>// Detailed error printed inside LockDataDirectory</span></td></tr>
<tr class="codeline" data-linenumber="1247"><td class="num" id="LN1247">1247</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1248"><td class="num" id="LN1248">1248</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1249"><td class="num" id="LN1249">1249</td><td class="line">    <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="1250"><td class="num" id="LN1250">1250</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1251"><td class="num" id="LN1251">1251</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1252"><td class="num" id="LN1252">1252</td><td class="line"><span class='keyword'>bool</span> AppInitInterfaces(NodeContext&amp; node)</td></tr>
<tr class="codeline" data-linenumber="1253"><td class="num" id="LN1253">1253</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1254"><td class="num" id="LN1254">1254</td><td class="line">    node.chain = interfaces::MakeChain(node);</td></tr>
<tr class="codeline" data-linenumber="1255"><td class="num" id="LN1255">1255</td><td class="line">    <span class='comment'>// Create client interfaces for wallets that are supposed to be loaded</span></td></tr>
<tr class="codeline" data-linenumber="1256"><td class="num" id="LN1256">1256</td><td class="line">    <span class='comment'>// according to -wallet and -disablewallet options. This only constructs</span></td></tr>
<tr class="codeline" data-linenumber="1257"><td class="num" id="LN1257">1257</td><td class="line">    <span class='comment'>// the interfaces, it doesn't load wallet data. Wallets actually get loaded</span></td></tr>
<tr class="codeline" data-linenumber="1258"><td class="num" id="LN1258">1258</td><td class="line">    <span class='comment'>// when load() and start() interface methods are called below.</span></td></tr>
<tr class="codeline" data-linenumber="1259"><td class="num" id="LN1259">1259</td><td class="line">    g_wallet_init_interface.Construct(node);</td></tr>
<tr class="codeline" data-linenumber="1260"><td class="num" id="LN1260">1260</td><td class="line">    <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="1261"><td class="num" id="LN1261">1261</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1262"><td class="num" id="LN1262">1262</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1263"><td class="num" id="LN1263">1263</td><td class="line"><span class='keyword'>bool</span> AppInitMain(<span class='keyword'>const</span> util::Ref&amp; context, NodeContext&amp; node, interfaces::BlockAndHeaderTipInfo* tip_info)</td></tr>
<tr class="codeline" data-linenumber="1264"><td class="num" id="LN1264">1264</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1265"><td class="num" id="LN1265">1265</td><td class="line">    <span class='keyword'>const</span> ArgsManager&amp; args = *<span class='macro'>Assert(node.args)<span class='macro_popup'>[&amp;]() -&gt; decltype(get_pure_r_value(node.args)) { auto&amp;&amp;<br> check = (node.args); (static_cast &lt;bool&gt; ("node.args" &amp;&amp;<br> check) ? void (0) : __assert_fail ("\"node.args\" &amp;&amp; check"<br>, "init.cpp", 1265, __extension__ __PRETTY_FUNCTION__)); return<br> std::forward&lt;decltype(get_pure_r_value(node.args))&gt;(check<br>); }()</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1266"><td class="num" id="LN1266">1266</td><td class="line">    <span class='keyword'>const</span> CChainParams&amp; chainparams = Params();</td></tr>
<tr class="codeline" data-linenumber="1267"><td class="num" id="LN1267">1267</td><td class="line">    <span class='comment'>// ********************************************************* Step 4a: application initialization</span></td></tr>
<tr class="codeline" data-linenumber="1268"><td class="num" id="LN1268">1268</td><td class="line">    <span class='keyword'>if</span> (!CreatePidFile(args)) {</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path1" class="msg msgControl" style="margin-left:5ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">1</div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path2" title="Next event (2)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="1269"><td class="num" id="LN1269">1269</td><td class="line">        <span class='comment'>// Detailed error printed inside CreatePidFile().</span></td></tr>
<tr class="codeline" data-linenumber="1270"><td class="num" id="LN1270">1270</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1271"><td class="num" id="LN1271">1271</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1272"><td class="num" id="LN1272">1272</td><td class="line">    <span class='keyword'>if</span> (<span class="mrange">LogInstance().m_print_to_file</span>) {</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path2" class="msg msgEvent" style="margin-left:9ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">2</div></td><td><div class="PathNav"><a href="#Path1" title="Previous event (1)">&#x2190;</a></div></td><td>Assuming field 'm_print_to_file' is false</td><td><div class="PathNav"><a href="#Path3" title="Next event (3)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path3" class="msg msgControl" style="margin-left:5ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">3</div></td><td><div class="PathNav"><a href="#Path2" title="Previous event (2)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path4" title="Next event (4)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="1273"><td class="num" id="LN1273">1273</td><td class="line">        <span class='keyword'>if</span> (args.GetBoolArg(<span class='string_literal'>"-shrinkdebugfile"</span>, LogInstance().DefaultShrinkDebugFile())) {</td></tr>
<tr class="codeline" data-linenumber="1274"><td class="num" id="LN1274">1274</td><td class="line">            <span class='comment'>// Do this first since it both loads a bunch of debug.log into memory,</span></td></tr>
<tr class="codeline" data-linenumber="1275"><td class="num" id="LN1275">1275</td><td class="line">            <span class='comment'>// and because this needs to happen before any other debug.log printing</span></td></tr>
<tr class="codeline" data-linenumber="1276"><td class="num" id="LN1276">1276</td><td class="line">            LogInstance().ShrinkDebugFile();</td></tr>
<tr class="codeline" data-linenumber="1277"><td class="num" id="LN1277">1277</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1278"><td class="num" id="LN1278">1278</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1279"><td class="num" id="LN1279">1279</td><td class="line">    <span class='keyword'>if</span> (!LogInstance().StartLogging()) {</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path4" class="msg msgControl" style="margin-left:5ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">4</div></td><td><div class="PathNav"><a href="#Path3" title="Previous event (3)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path5" title="Next event (5)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="1280"><td class="num" id="LN1280">1280</td><td class="line">            <span class='keyword'>return</span> InitError(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(Untranslated(<span class='string_literal'>"Could not open debug log file %s"</span>),</td></tr>
<tr class="codeline" data-linenumber="1281"><td class="num" id="LN1281">1281</td><td class="line">                LogInstance().m_file_path.string()));</td></tr>
<tr class="codeline" data-linenumber="1282"><td class="num" id="LN1282">1282</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1283"><td class="num" id="LN1283">1283</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1284"><td class="num" id="LN1284">1284</td><td class="line">    <span class='keyword'>if</span> (<span class="mrange">!LogInstance().m_log_timestamps</span>)</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path5" class="msg msgEvent" style="margin-left:9ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">5</div></td><td><div class="PathNav"><a href="#Path4" title="Previous event (4)">&#x2190;</a></div></td><td>Assuming field 'm_log_timestamps' is true</td><td><div class="PathNav"><a href="#Path6" title="Next event (6)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path6" class="msg msgControl" style="margin-left:5ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">6</div></td><td><div class="PathNav"><a href="#Path5" title="Previous event (5)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path7" title="Next event (7)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="1285"><td class="num" id="LN1285">1285</td><td class="line">        LogPrintf(<span class='string_literal'>"Startup time: %s\n"</span>, FormatISO8601DateTime(GetTime()));</td></tr>
<tr class="codeline" data-linenumber="1286"><td class="num" id="LN1286">1286</td><td class="line">    LogPrintf(<span class='string_literal'>"Default data directory %s\n"</span>, GetDefaultDataDir().string());</td></tr>
<tr class="codeline" data-linenumber="1287"><td class="num" id="LN1287">1287</td><td class="line">    LogPrintf(<span class='string_literal'>"Using data directory %s\n"</span>, GetDataDir().string());</td></tr>
<tr class="codeline" data-linenumber="1288"><td class="num" id="LN1288">1288</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1289"><td class="num" id="LN1289">1289</td><td class="line">    <span class='comment'>// Only log conf file usage message if conf file actually exists.</span></td></tr>
<tr class="codeline" data-linenumber="1290"><td class="num" id="LN1290">1290</td><td class="line">    fs::path config_file_path = GetConfigFile(args.GetArg(<span class='string_literal'>"-conf"</span>, BITCOIN_CONF_FILENAME));</td></tr>
<tr class="codeline" data-linenumber="1291"><td class="num" id="LN1291">1291</td><td class="line">    <span class='keyword'>if</span> (fs::exists(config_file_path)) {</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path7" class="msg msgControl" style="margin-left:5ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">7</div></td><td><div class="PathNav"><a href="#Path6" title="Previous event (6)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path8" title="Next event (8)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="1292"><td class="num" id="LN1292">1292</td><td class="line">        LogPrintf(<span class='string_literal'>"Config file: %s\n"</span>, config_file_path.string());</td></tr>
<tr class="codeline" data-linenumber="1293"><td class="num" id="LN1293">1293</td><td class="line">    } <span class='keyword'>else</span> <span class='keyword'>if</span> (args.IsArgSet(<span class='string_literal'>"-conf"</span>)) {</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path8" class="msg msgControl" style="margin-left:12ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">8</div></td><td><div class="PathNav"><a href="#Path7" title="Previous event (7)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path9" title="Next event (9)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="1294"><td class="num" id="LN1294">1294</td><td class="line">        <span class='comment'>// Warn if no conf file exists at path provided by user</span></td></tr>
<tr class="codeline" data-linenumber="1295"><td class="num" id="LN1295">1295</td><td class="line">        InitWarning(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"The specified config file %s does not exist\n"</span>), config_file_path.string()));</td></tr>
<tr class="codeline" data-linenumber="1296"><td class="num" id="LN1296">1296</td><td class="line">    } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="1297"><td class="num" id="LN1297">1297</td><td class="line">        <span class='comment'>// Not categorizing as "Warning" because it's the default behavior</span></td></tr>
<tr class="codeline" data-linenumber="1298"><td class="num" id="LN1298">1298</td><td class="line">        LogPrintf(<span class='string_literal'>"Config file: %s (not found, skipping)\n"</span>, config_file_path.string());</td></tr>
<tr class="codeline" data-linenumber="1299"><td class="num" id="LN1299">1299</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1300"><td class="num" id="LN1300">1300</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1301"><td class="num" id="LN1301">1301</td><td class="line">    <span class='comment'>// Log the config arguments to debug.log</span></td></tr>
<tr class="codeline" data-linenumber="1302"><td class="num" id="LN1302">1302</td><td class="line">    args.LogArgs();</td></tr>
<tr class="codeline" data-linenumber="1303"><td class="num" id="LN1303">1303</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1304"><td class="num" id="LN1304">1304</td><td class="line">    LogPrintf(<span class='string_literal'>"Using at most %i automatic connections (%i file descriptors available)\n"</span>, nMaxConnections, nFD);</td></tr>
<tr class="codeline" data-linenumber="1305"><td class="num" id="LN1305">1305</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1306"><td class="num" id="LN1306">1306</td><td class="line">    <span class='comment'>// Warn about relative -datadir path.</span></td></tr>
<tr class="codeline" data-linenumber="1307"><td class="num" id="LN1307">1307</td><td class="line">    <span class='keyword'>if</span> (args.IsArgSet(<span class='string_literal'>"-datadir"</span>) &amp;&amp; <span class="mrange">!fs::path(args.GetArg(<span class='string_literal'>"-datadir"</span>, <span class='string_literal'>""</span>)).is_absolute()</span>) {</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path9" class="msg msgEvent" style="margin-left:38ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">9</div></td><td><div class="PathNav"><a href="#Path8" title="Previous event (8)">&#x2190;</a></div></td><td>Assuming the condition is false</td><td><div class="PathNav"><a href="#Path10" title="Next event (10)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path10" class="msg msgControl" style="margin-left:5ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">10</div></td><td><div class="PathNav"><a href="#Path9" title="Previous event (9)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path11" title="Next event (11)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="1308"><td class="num" id="LN1308">1308</td><td class="line">        LogPrintf(<span class='string_literal'>"Warning: relative datadir option '%s' specified, which will be interpreted relative to the "</span> <span class='comment'>/* Continued */</span></td></tr>
<tr class="codeline" data-linenumber="1309"><td class="num" id="LN1309">1309</td><td class="line">                  <span class='string_literal'>"current working directory '%s'. This is fragile, because if bitcoin is started in the future "</span></td></tr>
<tr class="codeline" data-linenumber="1310"><td class="num" id="LN1310">1310</td><td class="line">                  <span class='string_literal'>"from a different location, it will be unable to locate the current data files. There could "</span></td></tr>
<tr class="codeline" data-linenumber="1311"><td class="num" id="LN1311">1311</td><td class="line">                  <span class='string_literal'>"also be data loss if bitcoin is started while in a temporary directory.\n"</span>,</td></tr>
<tr class="codeline" data-linenumber="1312"><td class="num" id="LN1312">1312</td><td class="line">                  args.GetArg(<span class='string_literal'>"-datadir"</span>, <span class='string_literal'>""</span>), fs::current_path().string());</td></tr>
<tr class="codeline" data-linenumber="1313"><td class="num" id="LN1313">1313</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1314"><td class="num" id="LN1314">1314</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1315"><td class="num" id="LN1315">1315</td><td class="line">    InitSignatureCache();</td></tr>
<tr class="codeline" data-linenumber="1316"><td class="num" id="LN1316">1316</td><td class="line">    InitScriptExecutionCache();</td></tr>
<tr class="codeline" data-linenumber="1317"><td class="num" id="LN1317">1317</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1318"><td class="num" id="LN1318">1318</td><td class="line">    <span class='keyword'>int</span> script_threads = args.GetArg(<span class='string_literal'>"-par"</span>, DEFAULT_SCRIPTCHECK_THREADS);</td></tr>
<tr class="codeline" data-linenumber="1319"><td class="num" id="LN1319">1319</td><td class="line">    <span class='keyword'>if</span> (<span class="mrange">script_threads &lt;= 0</span>) {</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path11" class="msg msgEvent" style="margin-left:9ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">11</div></td><td><div class="PathNav"><a href="#Path10" title="Previous event (10)">&#x2190;</a></div></td><td>Assuming 'script_threads' is &gt; 0</td><td><div class="PathNav"><a href="#Path12" title="Next event (12)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path12" class="msg msgControl" style="margin-left:5ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">12</div></td><td><div class="PathNav"><a href="#Path11" title="Previous event (11)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path13" title="Next event (13)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="1320"><td class="num" id="LN1320">1320</td><td class="line">        <span class='comment'>// -par=0 means autodetect (number of cores - 1 script threads)</span></td></tr>
<tr class="codeline" data-linenumber="1321"><td class="num" id="LN1321">1321</td><td class="line">        <span class='comment'>// -par=-n means "leave n cores free" (number of cores - n - 1 script threads)</span></td></tr>
<tr class="codeline" data-linenumber="1322"><td class="num" id="LN1322">1322</td><td class="line">        script_threads += GetNumCores();</td></tr>
<tr class="codeline" data-linenumber="1323"><td class="num" id="LN1323">1323</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1324"><td class="num" id="LN1324">1324</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1325"><td class="num" id="LN1325">1325</td><td class="line">    <span class='comment'>// Subtract 1 because the main thread counts towards the par threads</span></td></tr>
<tr class="codeline" data-linenumber="1326"><td class="num" id="LN1326">1326</td><td class="line">    script_threads = std::max(script_threads - 1, 0);</td></tr>
<tr class="codeline" data-linenumber="1327"><td class="num" id="LN1327">1327</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1328"><td class="num" id="LN1328">1328</td><td class="line">    <span class='comment'>// Number of script-checking threads &lt;= MAX_SCRIPTCHECK_THREADS</span></td></tr>
<tr class="codeline" data-linenumber="1329"><td class="num" id="LN1329">1329</td><td class="line">    script_threads = std::min(script_threads, MAX_SCRIPTCHECK_THREADS);</td></tr>
<tr class="codeline" data-linenumber="1330"><td class="num" id="LN1330">1330</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1331"><td class="num" id="LN1331">1331</td><td class="line">    LogPrintf(<span class='string_literal'>"Script verification uses %d additional threads\n"</span>, script_threads);</td></tr>
<tr class="codeline" data-linenumber="1332"><td class="num" id="LN1332">1332</td><td class="line">    <span class='keyword'>if</span> (<span class="mrange">script_threads &gt;= 1</span>) {</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path13" class="msg msgEvent" style="margin-left:9ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">13</div></td><td><div class="PathNav"><a href="#Path12" title="Previous event (12)">&#x2190;</a></div></td><td>Assuming 'script_threads' is &gt;= 1</td><td><div class="PathNav"><a href="#Path14" title="Next event (14)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path14" class="msg msgControl" style="margin-left:5ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">14</div></td><td><div class="PathNav"><a href="#Path13" title="Previous event (13)">&#x2190;</a></div></td><td>Taking true branch</td><td><div class="PathNav"><a href="#Path15" title="Next event (15)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="1333"><td class="num" id="LN1333">1333</td><td class="line">        g_parallel_script_checks = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="1334"><td class="num" id="LN1334">1334</td><td class="line">        <span class='keyword'>for</span> (<span class='keyword'>int</span> i = 0; <span class='variable'><span class='variable'><span class='variable'><span class='variable'><span class='variable'><span class='variable'><span class='variable'><span class='variable'><span class='variable'>i<table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>14.1</div></td><td>'i' is < 'script_threads'</td></tr></tbody></table></span><table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>14.1</div></td><td>'i' is < 'script_threads'</td></tr></tbody></table></span><table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>14.1</div></td><td>'i' is < 'script_threads'</td></tr></tbody></table></span><table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>14.1</div></td><td>'i' is < 'script_threads'</td></tr></tbody></table></span><table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>14.1</div></td><td>'i' is < 'script_threads'</td></tr></tbody></table></span><table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>14.1</div></td><td>'i' is < 'script_threads'</td></tr></tbody></table></span><table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>14.1</div></td><td>'i' is < 'script_threads'</td></tr></tbody></table></span><table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>14.1</div></td><td>'i' is < 'script_threads'</td></tr></tbody></table></span><table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>14.1</div></td><td>'i' is < 'script_threads'</td></tr></tbody></table></span> &lt; script_threads; ++i) {</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path15" class="msg msgControl" style="margin-left:9ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">15</div></td><td><div class="PathNav"><a href="#Path14" title="Previous event (14)">&#x2190;</a></div></td><td>Loop condition is true.  Entering loop body</td><td><div class="PathNav"><a href="#Path16" title="Next event (16)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="1335"><td class="num" id="LN1335">1335</td><td class="line">            <span class="mrange">threadGroup.create_thread([i]() { <span class='keyword'>return</span> ThreadScriptCheck(i); })</span>;</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path16" class="msg msgEvent" style="margin-left:13ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">16</div></td><td><div class="PathNav"><a href="#Path15" title="Previous event (15)">&#x2190;</a></div></td><td>Calling 'thread_group::create_thread'</td><td><div class="PathNav"><a href="#Path17" title="Next event (17)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="1336"><td class="num" id="LN1336">1336</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1337"><td class="num" id="LN1337">1337</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1338"><td class="num" id="LN1338">1338</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1339"><td class="num" id="LN1339">1339</td><td class="line">    <span class='macro'>assert(!node.scheduler)<span class='macro_popup'>(static_cast &lt;bool&gt; (!node.scheduler) ? void (0) : __assert_fail<br> ("!node.scheduler", "init.cpp", 1339, __extension__ __PRETTY_FUNCTION__<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1340"><td class="num" id="LN1340">1340</td><td class="line">    node.scheduler = MakeUnique&lt;CScheduler&gt;();</td></tr>
<tr class="codeline" data-linenumber="1341"><td class="num" id="LN1341">1341</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1342"><td class="num" id="LN1342">1342</td><td class="line">    <span class='comment'>// Start the lightweight task scheduler thread</span></td></tr>
<tr class="codeline" data-linenumber="1343"><td class="num" id="LN1343">1343</td><td class="line">    threadGroup.create_thread([&amp;] { TraceThread(<span class='string_literal'>"scheduler"</span>, [&amp;] { node.scheduler-&gt;serviceQueue(); }); });</td></tr>
<tr class="codeline" data-linenumber="1344"><td class="num" id="LN1344">1344</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1345"><td class="num" id="LN1345">1345</td><td class="line">    <span class='comment'>// Gather some entropy once per minute.</span></td></tr>
<tr class="codeline" data-linenumber="1346"><td class="num" id="LN1346">1346</td><td class="line">    node.scheduler-&gt;scheduleEvery([]{</td></tr>
<tr class="codeline" data-linenumber="1347"><td class="num" id="LN1347">1347</td><td class="line">        RandAddPeriodic();</td></tr>
<tr class="codeline" data-linenumber="1348"><td class="num" id="LN1348">1348</td><td class="line">    }, std::chrono::minutes{1});</td></tr>
<tr class="codeline" data-linenumber="1349"><td class="num" id="LN1349">1349</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1350"><td class="num" id="LN1350">1350</td><td class="line">    GetMainSignals().RegisterBackgroundSignalScheduler(*node.scheduler);</td></tr>
<tr class="codeline" data-linenumber="1351"><td class="num" id="LN1351">1351</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1352"><td class="num" id="LN1352">1352</td><td class="line">    <span class='comment'>/* Register RPC commands regardless of -server setting so they will be</span></td></tr>
<tr class="codeline" data-linenumber="1353"><td class="num" id="LN1353">1353</td><td class="line">     <span class='comment'>* available in the GUI RPC console even if external calls are disabled.</span></td></tr>
<tr class="codeline" data-linenumber="1354"><td class="num" id="LN1354">1354</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1355"><td class="num" id="LN1355">1355</td><td class="line">    RegisterAllCoreRPCCommands(tableRPC);</td></tr>
<tr class="codeline" data-linenumber="1356"><td class="num" id="LN1356">1356</td><td class="line">    <span class='keyword'>for</span> (<span class='keyword'>const</span> <span class='keyword'>auto</span>&amp; client : node.chain_clients) {</td></tr>
<tr class="codeline" data-linenumber="1357"><td class="num" id="LN1357">1357</td><td class="line">        client-&gt;registerRpcs();</td></tr>
<tr class="codeline" data-linenumber="1358"><td class="num" id="LN1358">1358</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1359"><td class="num" id="LN1359">1359</td><td class="line"><span class='directive'>#if <span class='macro'>ENABLE_ZMQ<span class='macro_popup'>0</span></span></span></td></tr>
<tr class="codeline" data-linenumber="1360"><td class="num" id="LN1360">1360</td><td class="line">    RegisterZMQRPCCommands(tableRPC);</td></tr>
<tr class="codeline" data-linenumber="1361"><td class="num" id="LN1361">1361</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1362"><td class="num" id="LN1362">1362</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1363"><td class="num" id="LN1363">1363</td><td class="line">    <span class='comment'>/* Start the RPC server already.  It will be started in "warmup" mode</span></td></tr>
<tr class="codeline" data-linenumber="1364"><td class="num" id="LN1364">1364</td><td class="line">     <span class='comment'>* and not really process calls already (but it will signify connections</span></td></tr>
<tr class="codeline" data-linenumber="1365"><td class="num" id="LN1365">1365</td><td class="line">     <span class='comment'>* that the server is there and will be ready later).  Warmup mode will</span></td></tr>
<tr class="codeline" data-linenumber="1366"><td class="num" id="LN1366">1366</td><td class="line">     <span class='comment'>* be disabled when initialisation is finished.</span></td></tr>
<tr class="codeline" data-linenumber="1367"><td class="num" id="LN1367">1367</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1368"><td class="num" id="LN1368">1368</td><td class="line">    <span class='keyword'>if</span> (args.GetBoolArg(<span class='string_literal'>"-server"</span>, <span class='keyword'>false</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1369"><td class="num" id="LN1369">1369</td><td class="line">        uiInterface.InitMessage_connect(SetRPCWarmupStatus);</td></tr>
<tr class="codeline" data-linenumber="1370"><td class="num" id="LN1370">1370</td><td class="line">        <span class='keyword'>if</span> (!AppInitServers(context, node))</td></tr>
<tr class="codeline" data-linenumber="1371"><td class="num" id="LN1371">1371</td><td class="line">            <span class='keyword'>return</span> InitError(_(<span class='string_literal'>"Unable to start HTTP server. See debug log for details."</span>));</td></tr>
<tr class="codeline" data-linenumber="1372"><td class="num" id="LN1372">1372</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1373"><td class="num" id="LN1373">1373</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1374"><td class="num" id="LN1374">1374</td><td class="line">    <span class='comment'>// ********************************************************* Step 5: verify wallet database integrity</span></td></tr>
<tr class="codeline" data-linenumber="1375"><td class="num" id="LN1375">1375</td><td class="line">    <span class='keyword'>for</span> (<span class='keyword'>const</span> <span class='keyword'>auto</span>&amp; client : node.chain_clients) {</td></tr>
<tr class="codeline" data-linenumber="1376"><td class="num" id="LN1376">1376</td><td class="line">        <span class='keyword'>if</span> (!client-&gt;verify()) {</td></tr>
<tr class="codeline" data-linenumber="1377"><td class="num" id="LN1377">1377</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1378"><td class="num" id="LN1378">1378</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1379"><td class="num" id="LN1379">1379</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1380"><td class="num" id="LN1380">1380</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1381"><td class="num" id="LN1381">1381</td><td class="line">    <span class='comment'>// ********************************************************* Step 6: network initialization</span></td></tr>
<tr class="codeline" data-linenumber="1382"><td class="num" id="LN1382">1382</td><td class="line">    <span class='comment'>// Note that we absolutely cannot open any actual connections</span></td></tr>
<tr class="codeline" data-linenumber="1383"><td class="num" id="LN1383">1383</td><td class="line">    <span class='comment'>// until the very end ("start node") as the UTXO/block state</span></td></tr>
<tr class="codeline" data-linenumber="1384"><td class="num" id="LN1384">1384</td><td class="line">    <span class='comment'>// is not yet setup and may end up being set up twice if we</span></td></tr>
<tr class="codeline" data-linenumber="1385"><td class="num" id="LN1385">1385</td><td class="line">    <span class='comment'>// need to reindex later.</span></td></tr>
<tr class="codeline" data-linenumber="1386"><td class="num" id="LN1386">1386</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1387"><td class="num" id="LN1387">1387</td><td class="line">    <span class='macro'>assert(!node.banman)<span class='macro_popup'>(static_cast &lt;bool&gt; (!node.banman) ? void (0) : __assert_fail<br> ("!node.banman", "init.cpp", 1387, __extension__ __PRETTY_FUNCTION__<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1388"><td class="num" id="LN1388">1388</td><td class="line">    node.banman = MakeUnique&lt;BanMan&gt;(GetDataDir() / <span class='string_literal'>"banlist.dat"</span>, &amp;uiInterface, args.GetArg(<span class='string_literal'>"-bantime"</span>, DEFAULT_MISBEHAVING_BANTIME));</td></tr>
<tr class="codeline" data-linenumber="1389"><td class="num" id="LN1389">1389</td><td class="line">    <span class='macro'>assert(!node.connman)<span class='macro_popup'>(static_cast &lt;bool&gt; (!node.connman) ? void (0) : __assert_fail<br> ("!node.connman", "init.cpp", 1389, __extension__ __PRETTY_FUNCTION__<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1390"><td class="num" id="LN1390">1390</td><td class="line">    node.connman = MakeUnique&lt;CConnman&gt;(GetRand(std::numeric_limits&lt;uint64_t&gt;::max()), GetRand(std::numeric_limits&lt;uint64_t&gt;::max()), args.GetBoolArg(<span class='string_literal'>"-networkactive"</span>, <span class='keyword'>true</span>));</td></tr>
<tr class="codeline" data-linenumber="1391"><td class="num" id="LN1391">1391</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1392"><td class="num" id="LN1392">1392</td><td class="line">    <span class='comment'>// Make mempool generally available in the node context. For example the connection manager, wallet, or RPC threads,</span></td></tr>
<tr class="codeline" data-linenumber="1393"><td class="num" id="LN1393">1393</td><td class="line">    <span class='comment'>// which are all started after this, may use it from the node context.</span></td></tr>
<tr class="codeline" data-linenumber="1394"><td class="num" id="LN1394">1394</td><td class="line">    <span class='macro'>assert(!node.mempool)<span class='macro_popup'>(static_cast &lt;bool&gt; (!node.mempool) ? void (0) : __assert_fail<br> ("!node.mempool", "init.cpp", 1394, __extension__ __PRETTY_FUNCTION__<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1395"><td class="num" id="LN1395">1395</td><td class="line">    node.mempool = MakeUnique&lt;CTxMemPool&gt;(&amp;::feeEstimator);</td></tr>
<tr class="codeline" data-linenumber="1396"><td class="num" id="LN1396">1396</td><td class="line">    <span class='keyword'>if</span> (node.mempool) {</td></tr>
<tr class="codeline" data-linenumber="1397"><td class="num" id="LN1397">1397</td><td class="line">        <span class='keyword'>int</span> ratio = std::min&lt;<span class='keyword'>int</span>&gt;(std::max&lt;<span class='keyword'>int</span>&gt;(args.GetArg(<span class='string_literal'>"-checkmempool"</span>, chainparams.DefaultConsistencyChecks() ? 1 : 0), 0), 1000000);</td></tr>
<tr class="codeline" data-linenumber="1398"><td class="num" id="LN1398">1398</td><td class="line">        <span class='keyword'>if</span> (ratio != 0) {</td></tr>
<tr class="codeline" data-linenumber="1399"><td class="num" id="LN1399">1399</td><td class="line">            node.mempool-&gt;setSanityCheck(1.0 / ratio);</td></tr>
<tr class="codeline" data-linenumber="1400"><td class="num" id="LN1400">1400</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1401"><td class="num" id="LN1401">1401</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1402"><td class="num" id="LN1402">1402</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1403"><td class="num" id="LN1403">1403</td><td class="line">    <span class='macro'>assert(!node.chainman)<span class='macro_popup'>(static_cast &lt;bool&gt; (!node.chainman) ? void (0) : __assert_fail<br> ("!node.chainman", "init.cpp", 1403, __extension__ __PRETTY_FUNCTION__<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1404"><td class="num" id="LN1404">1404</td><td class="line">    node.chainman = &amp;g_chainman;</td></tr>
<tr class="codeline" data-linenumber="1405"><td class="num" id="LN1405">1405</td><td class="line">    ChainstateManager&amp; chainman = *<span class='macro'>Assert(node.chainman)<span class='macro_popup'>[&amp;]() -&gt; decltype(get_pure_r_value(node.chainman)) { auto<br>&amp;&amp; check = (node.chainman); (static_cast &lt;bool&gt;<br> ("node.chainman" &amp;&amp; check) ? void (0) : __assert_fail<br> ("\"node.chainman\" &amp;&amp; check", "init.cpp", 1405, __extension__<br> __PRETTY_FUNCTION__)); return std::forward&lt;decltype(get_pure_r_value<br>(node.chainman))&gt;(check); }()</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1406"><td class="num" id="LN1406">1406</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1407"><td class="num" id="LN1407">1407</td><td class="line">    node.peerman.reset(<span class='keyword'>new</span> PeerManager(chainparams, *node.connman, node.banman.get(), *node.scheduler, chainman, *node.mempool));</td></tr>
<tr class="codeline" data-linenumber="1408"><td class="num" id="LN1408">1408</td><td class="line">    RegisterValidationInterface(node.peerman.get());</td></tr>
<tr class="codeline" data-linenumber="1409"><td class="num" id="LN1409">1409</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1410"><td class="num" id="LN1410">1410</td><td class="line">    <span class='comment'>// sanitize comments per BIP-0014, format user agent and check total size</span></td></tr>
<tr class="codeline" data-linenumber="1411"><td class="num" id="LN1411">1411</td><td class="line">    std::vector&lt;std::string&gt; uacomments;</td></tr>
<tr class="codeline" data-linenumber="1412"><td class="num" id="LN1412">1412</td><td class="line">    <span class='keyword'>for</span> (<span class='keyword'>const</span> std::string&amp; cmt : args.GetArgs(<span class='string_literal'>"-uacomment"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1413"><td class="num" id="LN1413">1413</td><td class="line">        <span class='keyword'>if</span> (cmt != SanitizeString(cmt, SAFE_CHARS_UA_COMMENT))</td></tr>
<tr class="codeline" data-linenumber="1414"><td class="num" id="LN1414">1414</td><td class="line">            <span class='keyword'>return</span> InitError(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"User Agent comment (%s) contains unsafe characters."</span>), cmt));</td></tr>
<tr class="codeline" data-linenumber="1415"><td class="num" id="LN1415">1415</td><td class="line">        uacomments.push_back(cmt);</td></tr>
<tr class="codeline" data-linenumber="1416"><td class="num" id="LN1416">1416</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1417"><td class="num" id="LN1417">1417</td><td class="line">    strSubVersion = FormatSubVersion(CLIENT_NAME, CLIENT_VERSION, uacomments);</td></tr>
<tr class="codeline" data-linenumber="1418"><td class="num" id="LN1418">1418</td><td class="line">    <span class='keyword'>if</span> (strSubVersion.size() &gt; MAX_SUBVERSION_LENGTH) {</td></tr>
<tr class="codeline" data-linenumber="1419"><td class="num" id="LN1419">1419</td><td class="line">        <span class='keyword'>return</span> InitError(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"Total length of network version string (%i) exceeds maximum length (%i). Reduce the number or size of uacomments."</span>),</td></tr>
<tr class="codeline" data-linenumber="1420"><td class="num" id="LN1420">1420</td><td class="line">            strSubVersion.size(), MAX_SUBVERSION_LENGTH));</td></tr>
<tr class="codeline" data-linenumber="1421"><td class="num" id="LN1421">1421</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1422"><td class="num" id="LN1422">1422</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1423"><td class="num" id="LN1423">1423</td><td class="line">    <span class='keyword'>if</span> (args.IsArgSet(<span class='string_literal'>"-onlynet"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1424"><td class="num" id="LN1424">1424</td><td class="line">        std::set&lt;<span class='keyword'>enum</span> Network&gt; nets;</td></tr>
<tr class="codeline" data-linenumber="1425"><td class="num" id="LN1425">1425</td><td class="line">        <span class='keyword'>for</span> (<span class='keyword'>const</span> std::string&amp; snet : args.GetArgs(<span class='string_literal'>"-onlynet"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1426"><td class="num" id="LN1426">1426</td><td class="line">            <span class='keyword'>enum</span> Network net = ParseNetwork(snet);</td></tr>
<tr class="codeline" data-linenumber="1427"><td class="num" id="LN1427">1427</td><td class="line">            <span class='keyword'>if</span> (net == NET_UNROUTABLE)</td></tr>
<tr class="codeline" data-linenumber="1428"><td class="num" id="LN1428">1428</td><td class="line">                <span class='keyword'>return</span> InitError(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"Unknown network specified in -onlynet: '%s'"</span>), snet));</td></tr>
<tr class="codeline" data-linenumber="1429"><td class="num" id="LN1429">1429</td><td class="line">            nets.insert(net);</td></tr>
<tr class="codeline" data-linenumber="1430"><td class="num" id="LN1430">1430</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1431"><td class="num" id="LN1431">1431</td><td class="line">        <span class='keyword'>for</span> (<span class='keyword'>int</span> n = 0; n &lt; NET_MAX; n++) {</td></tr>
<tr class="codeline" data-linenumber="1432"><td class="num" id="LN1432">1432</td><td class="line">            <span class='keyword'>enum</span> Network net = (<span class='keyword'>enum</span> Network)n;</td></tr>
<tr class="codeline" data-linenumber="1433"><td class="num" id="LN1433">1433</td><td class="line">            <span class='keyword'>if</span> (!nets.count(net))</td></tr>
<tr class="codeline" data-linenumber="1434"><td class="num" id="LN1434">1434</td><td class="line">                SetReachable(net, <span class='keyword'>false</span>);</td></tr>
<tr class="codeline" data-linenumber="1435"><td class="num" id="LN1435">1435</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1436"><td class="num" id="LN1436">1436</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1437"><td class="num" id="LN1437">1437</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1438"><td class="num" id="LN1438">1438</td><td class="line">    <span class='comment'>// Check for host lookup allowed before parsing any network related parameters</span></td></tr>
<tr class="codeline" data-linenumber="1439"><td class="num" id="LN1439">1439</td><td class="line">    fNameLookup = args.GetBoolArg(<span class='string_literal'>"-dns"</span>, DEFAULT_NAME_LOOKUP);</td></tr>
<tr class="codeline" data-linenumber="1440"><td class="num" id="LN1440">1440</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1441"><td class="num" id="LN1441">1441</td><td class="line">    <span class='keyword'>bool</span> proxyRandomize = args.GetBoolArg(<span class='string_literal'>"-proxyrandomize"</span>, DEFAULT_PROXYRANDOMIZE);</td></tr>
<tr class="codeline" data-linenumber="1442"><td class="num" id="LN1442">1442</td><td class="line">    <span class='comment'>// -proxy sets a proxy for all outgoing network traffic</span></td></tr>
<tr class="codeline" data-linenumber="1443"><td class="num" id="LN1443">1443</td><td class="line">    <span class='comment'>// -noproxy (or -proxy=0) as well as the empty string can be used to not set a proxy, this is the default</span></td></tr>
<tr class="codeline" data-linenumber="1444"><td class="num" id="LN1444">1444</td><td class="line">    std::string proxyArg = args.GetArg(<span class='string_literal'>"-proxy"</span>, <span class='string_literal'>""</span>);</td></tr>
<tr class="codeline" data-linenumber="1445"><td class="num" id="LN1445">1445</td><td class="line">    SetReachable(NET_ONION, <span class='keyword'>false</span>);</td></tr>
<tr class="codeline" data-linenumber="1446"><td class="num" id="LN1446">1446</td><td class="line">    <span class='keyword'>if</span> (proxyArg != <span class='string_literal'>""</span> &amp;&amp; proxyArg != <span class='string_literal'>"0"</span>) {</td></tr>
<tr class="codeline" data-linenumber="1447"><td class="num" id="LN1447">1447</td><td class="line">        CService proxyAddr;</td></tr>
<tr class="codeline" data-linenumber="1448"><td class="num" id="LN1448">1448</td><td class="line">        <span class='keyword'>if</span> (!Lookup(proxyArg, proxyAddr, 9050, fNameLookup)) {</td></tr>
<tr class="codeline" data-linenumber="1449"><td class="num" id="LN1449">1449</td><td class="line">            <span class='keyword'>return</span> InitError(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"Invalid -proxy address or hostname: '%s'"</span>), proxyArg));</td></tr>
<tr class="codeline" data-linenumber="1450"><td class="num" id="LN1450">1450</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1451"><td class="num" id="LN1451">1451</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1452"><td class="num" id="LN1452">1452</td><td class="line">        proxyType addrProxy = proxyType(proxyAddr, proxyRandomize);</td></tr>
<tr class="codeline" data-linenumber="1453"><td class="num" id="LN1453">1453</td><td class="line">        <span class='keyword'>if</span> (!addrProxy.IsValid())</td></tr>
<tr class="codeline" data-linenumber="1454"><td class="num" id="LN1454">1454</td><td class="line">            <span class='keyword'>return</span> InitError(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"Invalid -proxy address or hostname: '%s'"</span>), proxyArg));</td></tr>
<tr class="codeline" data-linenumber="1455"><td class="num" id="LN1455">1455</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1456"><td class="num" id="LN1456">1456</td><td class="line">        SetProxy(NET_IPV4, addrProxy);</td></tr>
<tr class="codeline" data-linenumber="1457"><td class="num" id="LN1457">1457</td><td class="line">        SetProxy(NET_IPV6, addrProxy);</td></tr>
<tr class="codeline" data-linenumber="1458"><td class="num" id="LN1458">1458</td><td class="line">        SetProxy(NET_ONION, addrProxy);</td></tr>
<tr class="codeline" data-linenumber="1459"><td class="num" id="LN1459">1459</td><td class="line">        SetNameProxy(addrProxy);</td></tr>
<tr class="codeline" data-linenumber="1460"><td class="num" id="LN1460">1460</td><td class="line">        SetReachable(NET_ONION, <span class='keyword'>true</span>); <span class='comment'>// by default, -proxy sets onion as reachable, unless -noonion later</span></td></tr>
<tr class="codeline" data-linenumber="1461"><td class="num" id="LN1461">1461</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1462"><td class="num" id="LN1462">1462</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1463"><td class="num" id="LN1463">1463</td><td class="line">    <span class='comment'>// -onion can be used to set only a proxy for .onion, or override normal proxy for .onion addresses</span></td></tr>
<tr class="codeline" data-linenumber="1464"><td class="num" id="LN1464">1464</td><td class="line">    <span class='comment'>// -noonion (or -onion=0) disables connecting to .onion entirely</span></td></tr>
<tr class="codeline" data-linenumber="1465"><td class="num" id="LN1465">1465</td><td class="line">    <span class='comment'>// An empty string is used to not override the onion proxy (in which case it defaults to -proxy set above, or none)</span></td></tr>
<tr class="codeline" data-linenumber="1466"><td class="num" id="LN1466">1466</td><td class="line">    std::string onionArg = args.GetArg(<span class='string_literal'>"-onion"</span>, <span class='string_literal'>""</span>);</td></tr>
<tr class="codeline" data-linenumber="1467"><td class="num" id="LN1467">1467</td><td class="line">    <span class='keyword'>if</span> (onionArg != <span class='string_literal'>""</span>) {</td></tr>
<tr class="codeline" data-linenumber="1468"><td class="num" id="LN1468">1468</td><td class="line">        <span class='keyword'>if</span> (onionArg == <span class='string_literal'>"0"</span>) { <span class='comment'>// Handle -noonion/-onion=0</span></td></tr>
<tr class="codeline" data-linenumber="1469"><td class="num" id="LN1469">1469</td><td class="line">            SetReachable(NET_ONION, <span class='keyword'>false</span>);</td></tr>
<tr class="codeline" data-linenumber="1470"><td class="num" id="LN1470">1470</td><td class="line">        } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="1471"><td class="num" id="LN1471">1471</td><td class="line">            CService onionProxy;</td></tr>
<tr class="codeline" data-linenumber="1472"><td class="num" id="LN1472">1472</td><td class="line">            <span class='keyword'>if</span> (!Lookup(onionArg, onionProxy, 9050, fNameLookup)) {</td></tr>
<tr class="codeline" data-linenumber="1473"><td class="num" id="LN1473">1473</td><td class="line">                <span class='keyword'>return</span> InitError(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"Invalid -onion address or hostname: '%s'"</span>), onionArg));</td></tr>
<tr class="codeline" data-linenumber="1474"><td class="num" id="LN1474">1474</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1475"><td class="num" id="LN1475">1475</td><td class="line">            proxyType addrOnion = proxyType(onionProxy, proxyRandomize);</td></tr>
<tr class="codeline" data-linenumber="1476"><td class="num" id="LN1476">1476</td><td class="line">            <span class='keyword'>if</span> (!addrOnion.IsValid())</td></tr>
<tr class="codeline" data-linenumber="1477"><td class="num" id="LN1477">1477</td><td class="line">                <span class='keyword'>return</span> InitError(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"Invalid -onion address or hostname: '%s'"</span>), onionArg));</td></tr>
<tr class="codeline" data-linenumber="1478"><td class="num" id="LN1478">1478</td><td class="line">            SetProxy(NET_ONION, addrOnion);</td></tr>
<tr class="codeline" data-linenumber="1479"><td class="num" id="LN1479">1479</td><td class="line">            SetReachable(NET_ONION, <span class='keyword'>true</span>);</td></tr>
<tr class="codeline" data-linenumber="1480"><td class="num" id="LN1480">1480</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1481"><td class="num" id="LN1481">1481</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1482"><td class="num" id="LN1482">1482</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1483"><td class="num" id="LN1483">1483</td><td class="line">    <span class='comment'>// see Step 2: parameter interactions for more information about these</span></td></tr>
<tr class="codeline" data-linenumber="1484"><td class="num" id="LN1484">1484</td><td class="line">    fListen = args.GetBoolArg(<span class='string_literal'>"-listen"</span>, DEFAULT_LISTEN);</td></tr>
<tr class="codeline" data-linenumber="1485"><td class="num" id="LN1485">1485</td><td class="line">    fDiscover = args.GetBoolArg(<span class='string_literal'>"-discover"</span>, <span class='keyword'>true</span>);</td></tr>
<tr class="codeline" data-linenumber="1486"><td class="num" id="LN1486">1486</td><td class="line">    g_relay_txes = !args.GetBoolArg(<span class='string_literal'>"-blocksonly"</span>, DEFAULT_BLOCKSONLY);</td></tr>
<tr class="codeline" data-linenumber="1487"><td class="num" id="LN1487">1487</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1488"><td class="num" id="LN1488">1488</td><td class="line">    <span class='keyword'>for</span> (<span class='keyword'>const</span> std::string&amp; strAddr : args.GetArgs(<span class='string_literal'>"-externalip"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1489"><td class="num" id="LN1489">1489</td><td class="line">        CService addrLocal;</td></tr>
<tr class="codeline" data-linenumber="1490"><td class="num" id="LN1490">1490</td><td class="line">        <span class='keyword'>if</span> (Lookup(strAddr, addrLocal, GetListenPort(), fNameLookup) &amp;&amp; addrLocal.IsValid())</td></tr>
<tr class="codeline" data-linenumber="1491"><td class="num" id="LN1491">1491</td><td class="line">            AddLocal(addrLocal, LOCAL_MANUAL);</td></tr>
<tr class="codeline" data-linenumber="1492"><td class="num" id="LN1492">1492</td><td class="line">        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1493"><td class="num" id="LN1493">1493</td><td class="line">            <span class='keyword'>return</span> InitError(ResolveErrMsg(<span class='string_literal'>"externalip"</span>, strAddr));</td></tr>
<tr class="codeline" data-linenumber="1494"><td class="num" id="LN1494">1494</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1495"><td class="num" id="LN1495">1495</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1496"><td class="num" id="LN1496">1496</td><td class="line">    <span class='comment'>// Read asmap file if configured</span></td></tr>
<tr class="codeline" data-linenumber="1497"><td class="num" id="LN1497">1497</td><td class="line">    <span class='keyword'>if</span> (args.IsArgSet(<span class='string_literal'>"-asmap"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1498"><td class="num" id="LN1498">1498</td><td class="line">        fs::path asmap_path = fs::path(args.GetArg(<span class='string_literal'>"-asmap"</span>, <span class='string_literal'>""</span>));</td></tr>
<tr class="codeline" data-linenumber="1499"><td class="num" id="LN1499">1499</td><td class="line">        <span class='keyword'>if</span> (asmap_path.empty()) {</td></tr>
<tr class="codeline" data-linenumber="1500"><td class="num" id="LN1500">1500</td><td class="line">            asmap_path = DEFAULT_ASMAP_FILENAME;</td></tr>
<tr class="codeline" data-linenumber="1501"><td class="num" id="LN1501">1501</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1502"><td class="num" id="LN1502">1502</td><td class="line">        <span class='keyword'>if</span> (!asmap_path.is_absolute()) {</td></tr>
<tr class="codeline" data-linenumber="1503"><td class="num" id="LN1503">1503</td><td class="line">            asmap_path = GetDataDir() / asmap_path;</td></tr>
<tr class="codeline" data-linenumber="1504"><td class="num" id="LN1504">1504</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1505"><td class="num" id="LN1505">1505</td><td class="line">        <span class='keyword'>if</span> (!fs::exists(asmap_path)) {</td></tr>
<tr class="codeline" data-linenumber="1506"><td class="num" id="LN1506">1506</td><td class="line">            InitError(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"Could not find asmap file %s"</span>), asmap_path));</td></tr>
<tr class="codeline" data-linenumber="1507"><td class="num" id="LN1507">1507</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1508"><td class="num" id="LN1508">1508</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1509"><td class="num" id="LN1509">1509</td><td class="line">        std::vector&lt;<span class='keyword'>bool</span>&gt; asmap = CAddrMan::DecodeAsmap(asmap_path);</td></tr>
<tr class="codeline" data-linenumber="1510"><td class="num" id="LN1510">1510</td><td class="line">        <span class='keyword'>if</span> (asmap.size() == 0) {</td></tr>
<tr class="codeline" data-linenumber="1511"><td class="num" id="LN1511">1511</td><td class="line">            InitError(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"Could not parse asmap file %s"</span>), asmap_path));</td></tr>
<tr class="codeline" data-linenumber="1512"><td class="num" id="LN1512">1512</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1513"><td class="num" id="LN1513">1513</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1514"><td class="num" id="LN1514">1514</td><td class="line">        <span class='keyword'>const</span> uint256 asmap_version = SerializeHash(asmap);</td></tr>
<tr class="codeline" data-linenumber="1515"><td class="num" id="LN1515">1515</td><td class="line">        node.connman-&gt;SetAsmap(std::move(asmap));</td></tr>
<tr class="codeline" data-linenumber="1516"><td class="num" id="LN1516">1516</td><td class="line">        LogPrintf(<span class='string_literal'>"Using asmap version %s for IP bucketing\n"</span>, asmap_version.ToString());</td></tr>
<tr class="codeline" data-linenumber="1517"><td class="num" id="LN1517">1517</td><td class="line">    } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="1518"><td class="num" id="LN1518">1518</td><td class="line">        LogPrintf(<span class='string_literal'>"Using /16 prefix for IP bucketing\n"</span>);</td></tr>
<tr class="codeline" data-linenumber="1519"><td class="num" id="LN1519">1519</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1520"><td class="num" id="LN1520">1520</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1521"><td class="num" id="LN1521">1521</td><td class="line"><span class='directive'>#if <span class='macro'>ENABLE_ZMQ<span class='macro_popup'>0</span></span></span></td></tr>
<tr class="codeline" data-linenumber="1522"><td class="num" id="LN1522">1522</td><td class="line">    g_zmq_notification_interface = CZMQNotificationInterface::Create();</td></tr>
<tr class="codeline" data-linenumber="1523"><td class="num" id="LN1523">1523</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1524"><td class="num" id="LN1524">1524</td><td class="line">    <span class='keyword'>if</span> (g_zmq_notification_interface) {</td></tr>
<tr class="codeline" data-linenumber="1525"><td class="num" id="LN1525">1525</td><td class="line">        RegisterValidationInterface(g_zmq_notification_interface);</td></tr>
<tr class="codeline" data-linenumber="1526"><td class="num" id="LN1526">1526</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1527"><td class="num" id="LN1527">1527</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1528"><td class="num" id="LN1528">1528</td><td class="line">    uint64_t nMaxOutboundLimit = 0; <span class='comment'>//unlimited unless -maxuploadtarget is set</span></td></tr>
<tr class="codeline" data-linenumber="1529"><td class="num" id="LN1529">1529</td><td class="line">    uint64_t nMaxOutboundTimeframe = MAX_UPLOAD_TIMEFRAME;</td></tr>
<tr class="codeline" data-linenumber="1530"><td class="num" id="LN1530">1530</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1531"><td class="num" id="LN1531">1531</td><td class="line">    <span class='keyword'>if</span> (args.IsArgSet(<span class='string_literal'>"-maxuploadtarget"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1532"><td class="num" id="LN1532">1532</td><td class="line">        nMaxOutboundLimit = args.GetArg(<span class='string_literal'>"-maxuploadtarget"</span>, DEFAULT_MAX_UPLOAD_TARGET) * 1024 * 1024;</td></tr>
<tr class="codeline" data-linenumber="1533"><td class="num" id="LN1533">1533</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1534"><td class="num" id="LN1534">1534</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1535"><td class="num" id="LN1535">1535</td><td class="line">    <span class='comment'>// ********************************************************* Step 7: load block chain</span></td></tr>
<tr class="codeline" data-linenumber="1536"><td class="num" id="LN1536">1536</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1537"><td class="num" id="LN1537">1537</td><td class="line">    fReindex = args.GetBoolArg(<span class='string_literal'>"-reindex"</span>, <span class='keyword'>false</span>);</td></tr>
<tr class="codeline" data-linenumber="1538"><td class="num" id="LN1538">1538</td><td class="line">    <span class='keyword'>bool</span> fReindexChainState = args.GetBoolArg(<span class='string_literal'>"-reindex-chainstate"</span>, <span class='keyword'>false</span>);</td></tr>
<tr class="codeline" data-linenumber="1539"><td class="num" id="LN1539">1539</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1540"><td class="num" id="LN1540">1540</td><td class="line">    <span class='comment'>// cache size calculations</span></td></tr>
<tr class="codeline" data-linenumber="1541"><td class="num" id="LN1541">1541</td><td class="line">    int64_t nTotalCache = (args.GetArg(<span class='string_literal'>"-dbcache"</span>, nDefaultDbCache) &lt;&lt; 20);</td></tr>
<tr class="codeline" data-linenumber="1542"><td class="num" id="LN1542">1542</td><td class="line">    nTotalCache = std::max(nTotalCache, nMinDbCache &lt;&lt; 20); <span class='comment'>// total cache cannot be less than nMinDbCache</span></td></tr>
<tr class="codeline" data-linenumber="1543"><td class="num" id="LN1543">1543</td><td class="line">    nTotalCache = std::min(nTotalCache, nMaxDbCache &lt;&lt; 20); <span class='comment'>// total cache cannot be greater than nMaxDbcache</span></td></tr>
<tr class="codeline" data-linenumber="1544"><td class="num" id="LN1544">1544</td><td class="line">    int64_t nBlockTreeDBCache = std::min(nTotalCache / 8, nMaxBlockDBCache &lt;&lt; 20);</td></tr>
<tr class="codeline" data-linenumber="1545"><td class="num" id="LN1545">1545</td><td class="line">    nTotalCache -= nBlockTreeDBCache;</td></tr>
<tr class="codeline" data-linenumber="1546"><td class="num" id="LN1546">1546</td><td class="line">    int64_t nTxIndexCache = std::min(nTotalCache / 8, args.GetBoolArg(<span class='string_literal'>"-txindex"</span>, DEFAULT_TXINDEX) ? nMaxTxIndexCache &lt;&lt; 20 : 0);</td></tr>
<tr class="codeline" data-linenumber="1547"><td class="num" id="LN1547">1547</td><td class="line">    nTotalCache -= nTxIndexCache;</td></tr>
<tr class="codeline" data-linenumber="1548"><td class="num" id="LN1548">1548</td><td class="line">    int64_t filter_index_cache = 0;</td></tr>
<tr class="codeline" data-linenumber="1549"><td class="num" id="LN1549">1549</td><td class="line">    <span class='keyword'>if</span> (!g_enabled_filter_types.empty()) {</td></tr>
<tr class="codeline" data-linenumber="1550"><td class="num" id="LN1550">1550</td><td class="line">        size_t n_indexes = g_enabled_filter_types.size();</td></tr>
<tr class="codeline" data-linenumber="1551"><td class="num" id="LN1551">1551</td><td class="line">        int64_t max_cache = std::min(nTotalCache / 8, max_filter_index_cache &lt;&lt; 20);</td></tr>
<tr class="codeline" data-linenumber="1552"><td class="num" id="LN1552">1552</td><td class="line">        filter_index_cache = max_cache / n_indexes;</td></tr>
<tr class="codeline" data-linenumber="1553"><td class="num" id="LN1553">1553</td><td class="line">        nTotalCache -= filter_index_cache * n_indexes;</td></tr>
<tr class="codeline" data-linenumber="1554"><td class="num" id="LN1554">1554</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1555"><td class="num" id="LN1555">1555</td><td class="line">    int64_t nCoinDBCache = std::min(nTotalCache / 2, (nTotalCache / 4) + (1 &lt;&lt; 23)); <span class='comment'>// use 25%-50% of the remainder for disk cache</span></td></tr>
<tr class="codeline" data-linenumber="1556"><td class="num" id="LN1556">1556</td><td class="line">    nCoinDBCache = std::min(nCoinDBCache, nMaxCoinsDBCache &lt;&lt; 20); <span class='comment'>// cap total coins db cache</span></td></tr>
<tr class="codeline" data-linenumber="1557"><td class="num" id="LN1557">1557</td><td class="line">    nTotalCache -= nCoinDBCache;</td></tr>
<tr class="codeline" data-linenumber="1558"><td class="num" id="LN1558">1558</td><td class="line">    int64_t nCoinCacheUsage = nTotalCache; <span class='comment'>// the rest goes to in-memory cache</span></td></tr>
<tr class="codeline" data-linenumber="1559"><td class="num" id="LN1559">1559</td><td class="line">    int64_t nMempoolSizeMax = args.GetArg(<span class='string_literal'>"-maxmempool"</span>, DEFAULT_MAX_MEMPOOL_SIZE) * 1000000;</td></tr>
<tr class="codeline" data-linenumber="1560"><td class="num" id="LN1560">1560</td><td class="line">    LogPrintf(<span class='string_literal'>"Cache configuration:\n"</span>);</td></tr>
<tr class="codeline" data-linenumber="1561"><td class="num" id="LN1561">1561</td><td class="line">    LogPrintf(<span class='string_literal'>"* Using %.1f MiB for block index database\n"</span>, nBlockTreeDBCache * (1.0 / 1024 / 1024));</td></tr>
<tr class="codeline" data-linenumber="1562"><td class="num" id="LN1562">1562</td><td class="line">    <span class='keyword'>if</span> (args.GetBoolArg(<span class='string_literal'>"-txindex"</span>, DEFAULT_TXINDEX)) {</td></tr>
<tr class="codeline" data-linenumber="1563"><td class="num" id="LN1563">1563</td><td class="line">        LogPrintf(<span class='string_literal'>"* Using %.1f MiB for transaction index database\n"</span>, nTxIndexCache * (1.0 / 1024 / 1024));</td></tr>
<tr class="codeline" data-linenumber="1564"><td class="num" id="LN1564">1564</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1565"><td class="num" id="LN1565">1565</td><td class="line">    <span class='keyword'>for</span> (BlockFilterType filter_type : g_enabled_filter_types) {</td></tr>
<tr class="codeline" data-linenumber="1566"><td class="num" id="LN1566">1566</td><td class="line">        LogPrintf(<span class='string_literal'>"* Using %.1f MiB for %s block filter index database\n"</span>,</td></tr>
<tr class="codeline" data-linenumber="1567"><td class="num" id="LN1567">1567</td><td class="line">                  filter_index_cache * (1.0 / 1024 / 1024), BlockFilterTypeName(filter_type));</td></tr>
<tr class="codeline" data-linenumber="1568"><td class="num" id="LN1568">1568</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1569"><td class="num" id="LN1569">1569</td><td class="line">    LogPrintf(<span class='string_literal'>"* Using %.1f MiB for chain state database\n"</span>, nCoinDBCache * (1.0 / 1024 / 1024));</td></tr>
<tr class="codeline" data-linenumber="1570"><td class="num" id="LN1570">1570</td><td class="line">    LogPrintf(<span class='string_literal'>"* Using %.1f MiB for in-memory UTXO set (plus up to %.1f MiB of unused mempool space)\n"</span>, nCoinCacheUsage * (1.0 / 1024 / 1024), nMempoolSizeMax * (1.0 / 1024 / 1024));</td></tr>
<tr class="codeline" data-linenumber="1571"><td class="num" id="LN1571">1571</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1572"><td class="num" id="LN1572">1572</td><td class="line">    <span class='keyword'>bool</span> fLoaded = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1573"><td class="num" id="LN1573">1573</td><td class="line">    <span class='keyword'>while</span> (!fLoaded &amp;&amp; !ShutdownRequested()) {</td></tr>
<tr class="codeline" data-linenumber="1574"><td class="num" id="LN1574">1574</td><td class="line">        <span class='keyword'>bool</span> fReset = fReindex;</td></tr>
<tr class="codeline" data-linenumber="1575"><td class="num" id="LN1575">1575</td><td class="line">        <span class='keyword'>auto</span> is_coinsview_empty = [&amp;](CChainState* chainstate) <span class='macro'>EXCLUSIVE_LOCKS_REQUIRED(::cs_main)<span class='macro_popup'>__attribute__((exclusive_locks_required(::cs_main)))</span></span> {</td></tr>
<tr class="codeline" data-linenumber="1576"><td class="num" id="LN1576">1576</td><td class="line">            <span class='keyword'>return</span> fReset || fReindexChainState || chainstate-&gt;CoinsTip().GetBestBlock().IsNull();</td></tr>
<tr class="codeline" data-linenumber="1577"><td class="num" id="LN1577">1577</td><td class="line">        };</td></tr>
<tr class="codeline" data-linenumber="1578"><td class="num" id="LN1578">1578</td><td class="line">        bilingual_str strLoadError;</td></tr>
<tr class="codeline" data-linenumber="1579"><td class="num" id="LN1579">1579</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1580"><td class="num" id="LN1580">1580</td><td class="line">        uiInterface.InitMessage(_(<span class='string_literal'>"Loading block index..."</span>).translated);</td></tr>
<tr class="codeline" data-linenumber="1581"><td class="num" id="LN1581">1581</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1582"><td class="num" id="LN1582">1582</td><td class="line">        <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="1583"><td class="num" id="LN1583">1583</td><td class="line">            <span class='keyword'>const</span> int64_t load_block_index_start_time = GetTimeMillis();</td></tr>
<tr class="codeline" data-linenumber="1584"><td class="num" id="LN1584">1584</td><td class="line">            <span class='keyword'>try</span> {</td></tr>
<tr class="codeline" data-linenumber="1585"><td class="num" id="LN1585">1585</td><td class="line">                <span class='macro'>LOCK(cs_main)<span class='macro_popup'>DebugLock&lt;decltype(cs_main)&gt; criticalblock53(cs_main, "cs_main"<br>, "init.cpp", 1585)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1586"><td class="num" id="LN1586">1586</td><td class="line">                chainman.InitializeChainstate(*<span class='macro'>Assert(node.mempool)<span class='macro_popup'>[&amp;]() -&gt; decltype(get_pure_r_value(node.mempool)) { auto<br>&amp;&amp; check = (node.mempool); (static_cast &lt;bool&gt; (<br>"node.mempool" &amp;&amp; check) ? void (0) : __assert_fail (<br>"\"node.mempool\" &amp;&amp; check", "init.cpp", 1586, __extension__<br> __PRETTY_FUNCTION__)); return std::forward&lt;decltype(get_pure_r_value<br>(node.mempool))&gt;(check); }()</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1587"><td class="num" id="LN1587">1587</td><td class="line">                chainman.m_total_coinstip_cache = nCoinCacheUsage;</td></tr>
<tr class="codeline" data-linenumber="1588"><td class="num" id="LN1588">1588</td><td class="line">                chainman.m_total_coinsdb_cache = nCoinDBCache;</td></tr>
<tr class="codeline" data-linenumber="1589"><td class="num" id="LN1589">1589</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1590"><td class="num" id="LN1590">1590</td><td class="line">                UnloadBlockIndex(node.mempool.get(), chainman);</td></tr>
<tr class="codeline" data-linenumber="1591"><td class="num" id="LN1591">1591</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1592"><td class="num" id="LN1592">1592</td><td class="line">                <span class='comment'>// new CBlockTreeDB tries to delete the existing file, which</span></td></tr>
<tr class="codeline" data-linenumber="1593"><td class="num" id="LN1593">1593</td><td class="line">                <span class='comment'>// fails if it's still open from the previous loop. Close it first:</span></td></tr>
<tr class="codeline" data-linenumber="1594"><td class="num" id="LN1594">1594</td><td class="line">                pblocktree.reset();</td></tr>
<tr class="codeline" data-linenumber="1595"><td class="num" id="LN1595">1595</td><td class="line">                pblocktree.reset(<span class='keyword'>new</span> CBlockTreeDB(nBlockTreeDBCache, <span class='keyword'>false</span>, fReset));</td></tr>
<tr class="codeline" data-linenumber="1596"><td class="num" id="LN1596">1596</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1597"><td class="num" id="LN1597">1597</td><td class="line">                <span class='keyword'>if</span> (fReset) {</td></tr>
<tr class="codeline" data-linenumber="1598"><td class="num" id="LN1598">1598</td><td class="line">                    pblocktree-&gt;WriteReindexing(<span class='keyword'>true</span>);</td></tr>
<tr class="codeline" data-linenumber="1599"><td class="num" id="LN1599">1599</td><td class="line">                    <span class='comment'>//If we're reindexing in prune mode, wipe away unusable block files and all undo data files</span></td></tr>
<tr class="codeline" data-linenumber="1600"><td class="num" id="LN1600">1600</td><td class="line">                    <span class='keyword'>if</span> (fPruneMode)</td></tr>
<tr class="codeline" data-linenumber="1601"><td class="num" id="LN1601">1601</td><td class="line">                        CleanupBlockRevFiles();</td></tr>
<tr class="codeline" data-linenumber="1602"><td class="num" id="LN1602">1602</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1603"><td class="num" id="LN1603">1603</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1604"><td class="num" id="LN1604">1604</td><td class="line">                <span class='keyword'>if</span> (ShutdownRequested()) <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1605"><td class="num" id="LN1605">1605</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1606"><td class="num" id="LN1606">1606</td><td class="line">                <span class='comment'>// LoadBlockIndex will load fHavePruned if we've ever removed a</span></td></tr>
<tr class="codeline" data-linenumber="1607"><td class="num" id="LN1607">1607</td><td class="line">                <span class='comment'>// block file from disk.</span></td></tr>
<tr class="codeline" data-linenumber="1608"><td class="num" id="LN1608">1608</td><td class="line">                <span class='comment'>// Note that it also sets fReindex based on the disk flag!</span></td></tr>
<tr class="codeline" data-linenumber="1609"><td class="num" id="LN1609">1609</td><td class="line">                <span class='comment'>// From here on out fReindex and fReset mean something different!</span></td></tr>
<tr class="codeline" data-linenumber="1610"><td class="num" id="LN1610">1610</td><td class="line">                <span class='keyword'>if</span> (!chainman.LoadBlockIndex(chainparams)) {</td></tr>
<tr class="codeline" data-linenumber="1611"><td class="num" id="LN1611">1611</td><td class="line">                    <span class='keyword'>if</span> (ShutdownRequested()) <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1612"><td class="num" id="LN1612">1612</td><td class="line">                    strLoadError = _(<span class='string_literal'>"Error loading block database"</span>);</td></tr>
<tr class="codeline" data-linenumber="1613"><td class="num" id="LN1613">1613</td><td class="line">                    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1614"><td class="num" id="LN1614">1614</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1615"><td class="num" id="LN1615">1615</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1616"><td class="num" id="LN1616">1616</td><td class="line">                <span class='comment'>// If the loaded chain has a wrong genesis, bail out immediately</span></td></tr>
<tr class="codeline" data-linenumber="1617"><td class="num" id="LN1617">1617</td><td class="line">                <span class='comment'>// (we're likely using a testnet datadir, or the other way around).</span></td></tr>
<tr class="codeline" data-linenumber="1618"><td class="num" id="LN1618">1618</td><td class="line">                <span class='keyword'>if</span> (!chainman.BlockIndex().empty() &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1619"><td class="num" id="LN1619">1619</td><td class="line">                        !LookupBlockIndex(chainparams.GetConsensus().hashGenesisBlock)) {</td></tr>
<tr class="codeline" data-linenumber="1620"><td class="num" id="LN1620">1620</td><td class="line">                    <span class='keyword'>return</span> InitError(_(<span class='string_literal'>"Incorrect or no genesis block found. Wrong datadir for network?"</span>));</td></tr>
<tr class="codeline" data-linenumber="1621"><td class="num" id="LN1621">1621</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1622"><td class="num" id="LN1622">1622</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1623"><td class="num" id="LN1623">1623</td><td class="line">                <span class='comment'>// Check for changed -prune state.  What we are concerned about is a user who has pruned blocks</span></td></tr>
<tr class="codeline" data-linenumber="1624"><td class="num" id="LN1624">1624</td><td class="line">                <span class='comment'>// in the past, but is now trying to run unpruned.</span></td></tr>
<tr class="codeline" data-linenumber="1625"><td class="num" id="LN1625">1625</td><td class="line">                <span class='keyword'>if</span> (fHavePruned &amp;&amp; !fPruneMode) {</td></tr>
<tr class="codeline" data-linenumber="1626"><td class="num" id="LN1626">1626</td><td class="line">                    strLoadError = _(<span class='string_literal'>"You need to rebuild the database using -reindex to go back to unpruned mode.  This will redownload the entire blockchain"</span>);</td></tr>
<tr class="codeline" data-linenumber="1627"><td class="num" id="LN1627">1627</td><td class="line">                    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1628"><td class="num" id="LN1628">1628</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1629"><td class="num" id="LN1629">1629</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1630"><td class="num" id="LN1630">1630</td><td class="line">                <span class='comment'>// At this point blocktree args are consistent with what's on disk.</span></td></tr>
<tr class="codeline" data-linenumber="1631"><td class="num" id="LN1631">1631</td><td class="line">                <span class='comment'>// If we're not mid-reindex (based on disk + args), add a genesis block on disk</span></td></tr>
<tr class="codeline" data-linenumber="1632"><td class="num" id="LN1632">1632</td><td class="line">                <span class='comment'>// (otherwise we use the one already on disk).</span></td></tr>
<tr class="codeline" data-linenumber="1633"><td class="num" id="LN1633">1633</td><td class="line">                <span class='comment'>// This is called again in ThreadImport after the reindex completes.</span></td></tr>
<tr class="codeline" data-linenumber="1634"><td class="num" id="LN1634">1634</td><td class="line">                <span class='keyword'>if</span> (!fReindex &amp;&amp; !LoadGenesisBlock(chainparams)) {</td></tr>
<tr class="codeline" data-linenumber="1635"><td class="num" id="LN1635">1635</td><td class="line">                    strLoadError = _(<span class='string_literal'>"Error initializing block database"</span>);</td></tr>
<tr class="codeline" data-linenumber="1636"><td class="num" id="LN1636">1636</td><td class="line">                    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1637"><td class="num" id="LN1637">1637</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1638"><td class="num" id="LN1638">1638</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1639"><td class="num" id="LN1639">1639</td><td class="line">                <span class='comment'>// At this point we're either in reindex or we've loaded a useful</span></td></tr>
<tr class="codeline" data-linenumber="1640"><td class="num" id="LN1640">1640</td><td class="line">                <span class='comment'>// block tree into BlockIndex()!</span></td></tr>
<tr class="codeline" data-linenumber="1641"><td class="num" id="LN1641">1641</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1642"><td class="num" id="LN1642">1642</td><td class="line">                <span class='keyword'>bool</span> failed_chainstate_init = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1643"><td class="num" id="LN1643">1643</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1644"><td class="num" id="LN1644">1644</td><td class="line">                <span class='keyword'>for</span> (CChainState* chainstate : chainman.GetAll()) {</td></tr>
<tr class="codeline" data-linenumber="1645"><td class="num" id="LN1645">1645</td><td class="line">                    chainstate-&gt;InitCoinsDB(</td></tr>
<tr class="codeline" data-linenumber="1646"><td class="num" id="LN1646">1646</td><td class="line">                        <span class='comment'>/* cache_size_bytes */</span> nCoinDBCache,</td></tr>
<tr class="codeline" data-linenumber="1647"><td class="num" id="LN1647">1647</td><td class="line">                        <span class='comment'>/* in_memory */</span> <span class='keyword'>false</span>,</td></tr>
<tr class="codeline" data-linenumber="1648"><td class="num" id="LN1648">1648</td><td class="line">                        <span class='comment'>/* should_wipe */</span> fReset || fReindexChainState);</td></tr>
<tr class="codeline" data-linenumber="1649"><td class="num" id="LN1649">1649</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1650"><td class="num" id="LN1650">1650</td><td class="line">                    chainstate-&gt;CoinsErrorCatcher().AddReadErrCallback([]() {</td></tr>
<tr class="codeline" data-linenumber="1651"><td class="num" id="LN1651">1651</td><td class="line">                        uiInterface.ThreadSafeMessageBox(</td></tr>
<tr class="codeline" data-linenumber="1652"><td class="num" id="LN1652">1652</td><td class="line">                            _(<span class='string_literal'>"Error reading from database, shutting down."</span>),</td></tr>
<tr class="codeline" data-linenumber="1653"><td class="num" id="LN1653">1653</td><td class="line">                            <span class='string_literal'>""</span>, CClientUIInterface::MSG_ERROR);</td></tr>
<tr class="codeline" data-linenumber="1654"><td class="num" id="LN1654">1654</td><td class="line">                    });</td></tr>
<tr class="codeline" data-linenumber="1655"><td class="num" id="LN1655">1655</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1656"><td class="num" id="LN1656">1656</td><td class="line">                    <span class='comment'>// If necessary, upgrade from older database format.</span></td></tr>
<tr class="codeline" data-linenumber="1657"><td class="num" id="LN1657">1657</td><td class="line">                    <span class='comment'>// This is a no-op if we cleared the coinsviewdb with -reindex or -reindex-chainstate</span></td></tr>
<tr class="codeline" data-linenumber="1658"><td class="num" id="LN1658">1658</td><td class="line">                    <span class='keyword'>if</span> (!chainstate-&gt;CoinsDB().Upgrade()) {</td></tr>
<tr class="codeline" data-linenumber="1659"><td class="num" id="LN1659">1659</td><td class="line">                        strLoadError = _(<span class='string_literal'>"Error upgrading chainstate database"</span>);</td></tr>
<tr class="codeline" data-linenumber="1660"><td class="num" id="LN1660">1660</td><td class="line">                        failed_chainstate_init = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="1661"><td class="num" id="LN1661">1661</td><td class="line">                        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1662"><td class="num" id="LN1662">1662</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="1663"><td class="num" id="LN1663">1663</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1664"><td class="num" id="LN1664">1664</td><td class="line">                    <span class='comment'>// ReplayBlocks is a no-op if we cleared the coinsviewdb with -reindex or -reindex-chainstate</span></td></tr>
<tr class="codeline" data-linenumber="1665"><td class="num" id="LN1665">1665</td><td class="line">                    <span class='keyword'>if</span> (!chainstate-&gt;ReplayBlocks(chainparams)) {</td></tr>
<tr class="codeline" data-linenumber="1666"><td class="num" id="LN1666">1666</td><td class="line">                        strLoadError = _(<span class='string_literal'>"Unable to replay blocks. You will need to rebuild the database using -reindex-chainstate."</span>);</td></tr>
<tr class="codeline" data-linenumber="1667"><td class="num" id="LN1667">1667</td><td class="line">                        failed_chainstate_init = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="1668"><td class="num" id="LN1668">1668</td><td class="line">                        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1669"><td class="num" id="LN1669">1669</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="1670"><td class="num" id="LN1670">1670</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1671"><td class="num" id="LN1671">1671</td><td class="line">                    <span class='comment'>// The on-disk coinsdb is now in a good state, create the cache</span></td></tr>
<tr class="codeline" data-linenumber="1672"><td class="num" id="LN1672">1672</td><td class="line">                    chainstate-&gt;InitCoinsCache(nCoinCacheUsage);</td></tr>
<tr class="codeline" data-linenumber="1673"><td class="num" id="LN1673">1673</td><td class="line">                    <span class='macro'>assert(chainstate-&gt;CanFlushToDisk())<span class='macro_popup'>(static_cast &lt;bool&gt; (chainstate-&gt;CanFlushToDisk()) ?<br> void (0) : __assert_fail ("chainstate-&gt;CanFlushToDisk()",<br> "init.cpp", 1673, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1674"><td class="num" id="LN1674">1674</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1675"><td class="num" id="LN1675">1675</td><td class="line">                    <span class='keyword'>if</span> (!is_coinsview_empty(chainstate)) {</td></tr>
<tr class="codeline" data-linenumber="1676"><td class="num" id="LN1676">1676</td><td class="line">                        <span class='comment'>// LoadChainTip initializes the chain based on CoinsTip()'s best block</span></td></tr>
<tr class="codeline" data-linenumber="1677"><td class="num" id="LN1677">1677</td><td class="line">                        <span class='keyword'>if</span> (!chainstate-&gt;LoadChainTip(chainparams)) {</td></tr>
<tr class="codeline" data-linenumber="1678"><td class="num" id="LN1678">1678</td><td class="line">                            strLoadError = _(<span class='string_literal'>"Error initializing block database"</span>);</td></tr>
<tr class="codeline" data-linenumber="1679"><td class="num" id="LN1679">1679</td><td class="line">                            failed_chainstate_init = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="1680"><td class="num" id="LN1680">1680</td><td class="line">                            <span class='keyword'>break</span>; <span class='comment'>// out of the per-chainstate loop</span></td></tr>
<tr class="codeline" data-linenumber="1681"><td class="num" id="LN1681">1681</td><td class="line">                        }</td></tr>
<tr class="codeline" data-linenumber="1682"><td class="num" id="LN1682">1682</td><td class="line">                        <span class='macro'>assert(chainstate-&gt;m_chain.Tip() != <span class='keyword'>nullptr</span>)<span class='macro_popup'>(static_cast &lt;bool&gt; (chainstate-&gt;m_chain.Tip() != nullptr<br>) ? void (0) : __assert_fail ("chainstate-&gt;m_chain.Tip() != nullptr"<br>, "init.cpp", 1682, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1683"><td class="num" id="LN1683">1683</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="1684"><td class="num" id="LN1684">1684</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1685"><td class="num" id="LN1685">1685</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1686"><td class="num" id="LN1686">1686</td><td class="line">                <span class='keyword'>if</span> (failed_chainstate_init) {</td></tr>
<tr class="codeline" data-linenumber="1687"><td class="num" id="LN1687">1687</td><td class="line">                    <span class='keyword'>break</span>; <span class='comment'>// out of the chainstate activation do-while</span></td></tr>
<tr class="codeline" data-linenumber="1688"><td class="num" id="LN1688">1688</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1689"><td class="num" id="LN1689">1689</td><td class="line">            } <span class='keyword'>catch</span> (<span class='keyword'>const</span> std::exception&amp; e) {</td></tr>
<tr class="codeline" data-linenumber="1690"><td class="num" id="LN1690">1690</td><td class="line">                LogPrintf(<span class='string_literal'>"%s\n"</span>, e.what());</td></tr>
<tr class="codeline" data-linenumber="1691"><td class="num" id="LN1691">1691</td><td class="line">                strLoadError = _(<span class='string_literal'>"Error opening block database"</span>);</td></tr>
<tr class="codeline" data-linenumber="1692"><td class="num" id="LN1692">1692</td><td class="line">                <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1693"><td class="num" id="LN1693">1693</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1694"><td class="num" id="LN1694">1694</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1695"><td class="num" id="LN1695">1695</td><td class="line">            <span class='keyword'>bool</span> failed_rewind{<span class='keyword'>false</span>};</td></tr>
<tr class="codeline" data-linenumber="1696"><td class="num" id="LN1696">1696</td><td class="line">            <span class='comment'>// Can't hold cs_main while calling RewindBlockIndex, so retrieve the relevant</span></td></tr>
<tr class="codeline" data-linenumber="1697"><td class="num" id="LN1697">1697</td><td class="line">            <span class='comment'>// chainstates beforehand.</span></td></tr>
<tr class="codeline" data-linenumber="1698"><td class="num" id="LN1698">1698</td><td class="line">            <span class='keyword'>for</span> (CChainState* chainstate : <span class='macro'>WITH_LOCK(::cs_main, <span class='keyword'>return</span> chainman.GetAll())<span class='macro_popup'>[&amp;] { DebugLock&lt;decltype(::cs_main)&gt; criticalblock54<br>(::cs_main, "::cs_main", "init.cpp", 1698); return chainman.GetAll<br>(); }()</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="1699"><td class="num" id="LN1699">1699</td><td class="line">                <span class='keyword'>if</span> (!fReset) {</td></tr>
<tr class="codeline" data-linenumber="1700"><td class="num" id="LN1700">1700</td><td class="line">                    <span class='comment'>// Note that RewindBlockIndex MUST run even if we're about to -reindex-chainstate.</span></td></tr>
<tr class="codeline" data-linenumber="1701"><td class="num" id="LN1701">1701</td><td class="line">                    <span class='comment'>// It both disconnects blocks based on the chainstate, and drops block data in</span></td></tr>
<tr class="codeline" data-linenumber="1702"><td class="num" id="LN1702">1702</td><td class="line">                    <span class='comment'>// BlockIndex() based on lack of available witness data.</span></td></tr>
<tr class="codeline" data-linenumber="1703"><td class="num" id="LN1703">1703</td><td class="line">                    uiInterface.InitMessage(_(<span class='string_literal'>"Rewinding blocks..."</span>).translated);</td></tr>
<tr class="codeline" data-linenumber="1704"><td class="num" id="LN1704">1704</td><td class="line">                    <span class='keyword'>if</span> (!chainstate-&gt;RewindBlockIndex(chainparams)) {</td></tr>
<tr class="codeline" data-linenumber="1705"><td class="num" id="LN1705">1705</td><td class="line">                        strLoadError = _(</td></tr>
<tr class="codeline" data-linenumber="1706"><td class="num" id="LN1706">1706</td><td class="line">                            <span class='string_literal'>"Unable to rewind the database to a pre-fork state. "</span></td></tr>
<tr class="codeline" data-linenumber="1707"><td class="num" id="LN1707">1707</td><td class="line">                            <span class='string_literal'>"You will need to redownload the blockchain"</span>);</td></tr>
<tr class="codeline" data-linenumber="1708"><td class="num" id="LN1708">1708</td><td class="line">                        failed_rewind = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="1709"><td class="num" id="LN1709">1709</td><td class="line">                        <span class='keyword'>break</span>; <span class='comment'>// out of the per-chainstate loop</span></td></tr>
<tr class="codeline" data-linenumber="1710"><td class="num" id="LN1710">1710</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="1711"><td class="num" id="LN1711">1711</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1712"><td class="num" id="LN1712">1712</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1713"><td class="num" id="LN1713">1713</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1714"><td class="num" id="LN1714">1714</td><td class="line">            <span class='keyword'>if</span> (failed_rewind) {</td></tr>
<tr class="codeline" data-linenumber="1715"><td class="num" id="LN1715">1715</td><td class="line">                <span class='keyword'>break</span>; <span class='comment'>// out of the chainstate activation do-while</span></td></tr>
<tr class="codeline" data-linenumber="1716"><td class="num" id="LN1716">1716</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1717"><td class="num" id="LN1717">1717</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1718"><td class="num" id="LN1718">1718</td><td class="line">            <span class='keyword'>bool</span> failed_verification = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1719"><td class="num" id="LN1719">1719</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1720"><td class="num" id="LN1720">1720</td><td class="line">            <span class='keyword'>try</span> {</td></tr>
<tr class="codeline" data-linenumber="1721"><td class="num" id="LN1721">1721</td><td class="line">                <span class='macro'>LOCK(cs_main)<span class='macro_popup'>DebugLock&lt;decltype(cs_main)&gt; criticalblock55(cs_main, "cs_main"<br>, "init.cpp", 1721)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1722"><td class="num" id="LN1722">1722</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1723"><td class="num" id="LN1723">1723</td><td class="line">                <span class='keyword'>for</span> (CChainState* chainstate : chainman.GetAll()) {</td></tr>
<tr class="codeline" data-linenumber="1724"><td class="num" id="LN1724">1724</td><td class="line">                    <span class='keyword'>if</span> (!is_coinsview_empty(chainstate)) {</td></tr>
<tr class="codeline" data-linenumber="1725"><td class="num" id="LN1725">1725</td><td class="line">                        uiInterface.InitMessage(_(<span class='string_literal'>"Verifying blocks..."</span>).translated);</td></tr>
<tr class="codeline" data-linenumber="1726"><td class="num" id="LN1726">1726</td><td class="line">                        <span class='keyword'>if</span> (fHavePruned &amp;&amp; args.GetArg(<span class='string_literal'>"-checkblocks"</span>, DEFAULT_CHECKBLOCKS) &gt; MIN_BLOCKS_TO_KEEP) {</td></tr>
<tr class="codeline" data-linenumber="1727"><td class="num" id="LN1727">1727</td><td class="line">                            LogPrintf(<span class='string_literal'>"Prune: pruned datadir may not have more than %d blocks; only checking available blocks\n"</span>,</td></tr>
<tr class="codeline" data-linenumber="1728"><td class="num" id="LN1728">1728</td><td class="line">                                MIN_BLOCKS_TO_KEEP);</td></tr>
<tr class="codeline" data-linenumber="1729"><td class="num" id="LN1729">1729</td><td class="line">                        }</td></tr>
<tr class="codeline" data-linenumber="1730"><td class="num" id="LN1730">1730</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1731"><td class="num" id="LN1731">1731</td><td class="line">                        <span class='keyword'>const</span> CBlockIndex* tip = chainstate-&gt;m_chain.Tip();</td></tr>
<tr class="codeline" data-linenumber="1732"><td class="num" id="LN1732">1732</td><td class="line">                        RPCNotifyBlockChange(tip);</td></tr>
<tr class="codeline" data-linenumber="1733"><td class="num" id="LN1733">1733</td><td class="line">                        <span class='keyword'>if</span> (tip &amp;&amp; tip-&gt;nTime &gt; GetAdjustedTime() + 2 * 60 * 60) {</td></tr>
<tr class="codeline" data-linenumber="1734"><td class="num" id="LN1734">1734</td><td class="line">                            strLoadError = _(<span class='string_literal'>"The block database contains a block which appears to be from the future. "</span></td></tr>
<tr class="codeline" data-linenumber="1735"><td class="num" id="LN1735">1735</td><td class="line">                                    <span class='string_literal'>"This may be due to your computer's date and time being set incorrectly. "</span></td></tr>
<tr class="codeline" data-linenumber="1736"><td class="num" id="LN1736">1736</td><td class="line">                                    <span class='string_literal'>"Only rebuild the block database if you are sure that your computer's date and time are correct"</span>);</td></tr>
<tr class="codeline" data-linenumber="1737"><td class="num" id="LN1737">1737</td><td class="line">                            failed_verification = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="1738"><td class="num" id="LN1738">1738</td><td class="line">                            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1739"><td class="num" id="LN1739">1739</td><td class="line">                        }</td></tr>
<tr class="codeline" data-linenumber="1740"><td class="num" id="LN1740">1740</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1741"><td class="num" id="LN1741">1741</td><td class="line">                        <span class='comment'>// Only verify the DB of the active chainstate. This is fixed in later</span></td></tr>
<tr class="codeline" data-linenumber="1742"><td class="num" id="LN1742">1742</td><td class="line">                        <span class='comment'>// work when we allow VerifyDB to be parameterized by chainstate.</span></td></tr>
<tr class="codeline" data-linenumber="1743"><td class="num" id="LN1743">1743</td><td class="line">                        <span class='keyword'>if</span> (&amp;::ChainstateActive() == chainstate &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1744"><td class="num" id="LN1744">1744</td><td class="line">                            !CVerifyDB().VerifyDB(</td></tr>
<tr class="codeline" data-linenumber="1745"><td class="num" id="LN1745">1745</td><td class="line">                                chainparams, &amp;chainstate-&gt;CoinsDB(),</td></tr>
<tr class="codeline" data-linenumber="1746"><td class="num" id="LN1746">1746</td><td class="line">                                args.GetArg(<span class='string_literal'>"-checklevel"</span>, DEFAULT_CHECKLEVEL),</td></tr>
<tr class="codeline" data-linenumber="1747"><td class="num" id="LN1747">1747</td><td class="line">                                args.GetArg(<span class='string_literal'>"-checkblocks"</span>, DEFAULT_CHECKBLOCKS))) {</td></tr>
<tr class="codeline" data-linenumber="1748"><td class="num" id="LN1748">1748</td><td class="line">                            strLoadError = _(<span class='string_literal'>"Corrupted block database detected"</span>);</td></tr>
<tr class="codeline" data-linenumber="1749"><td class="num" id="LN1749">1749</td><td class="line">                            failed_verification = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="1750"><td class="num" id="LN1750">1750</td><td class="line">                            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1751"><td class="num" id="LN1751">1751</td><td class="line">                        }</td></tr>
<tr class="codeline" data-linenumber="1752"><td class="num" id="LN1752">1752</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="1753"><td class="num" id="LN1753">1753</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1754"><td class="num" id="LN1754">1754</td><td class="line">            } <span class='keyword'>catch</span> (<span class='keyword'>const</span> std::exception&amp; e) {</td></tr>
<tr class="codeline" data-linenumber="1755"><td class="num" id="LN1755">1755</td><td class="line">                LogPrintf(<span class='string_literal'>"%s\n"</span>, e.what());</td></tr>
<tr class="codeline" data-linenumber="1756"><td class="num" id="LN1756">1756</td><td class="line">                strLoadError = _(<span class='string_literal'>"Error opening block database"</span>);</td></tr>
<tr class="codeline" data-linenumber="1757"><td class="num" id="LN1757">1757</td><td class="line">                failed_verification = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="1758"><td class="num" id="LN1758">1758</td><td class="line">                <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1759"><td class="num" id="LN1759">1759</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1760"><td class="num" id="LN1760">1760</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1761"><td class="num" id="LN1761">1761</td><td class="line">            <span class='keyword'>if</span> (!failed_verification) {</td></tr>
<tr class="codeline" data-linenumber="1762"><td class="num" id="LN1762">1762</td><td class="line">                fLoaded = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="1763"><td class="num" id="LN1763">1763</td><td class="line">                LogPrintf(<span class='string_literal'>" block index %15dms\n"</span>, GetTimeMillis() - load_block_index_start_time);</td></tr>
<tr class="codeline" data-linenumber="1764"><td class="num" id="LN1764">1764</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1765"><td class="num" id="LN1765">1765</td><td class="line">        } <span class='keyword'>while</span>(<span class='keyword'>false</span>);</td></tr>
<tr class="codeline" data-linenumber="1766"><td class="num" id="LN1766">1766</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1767"><td class="num" id="LN1767">1767</td><td class="line">        <span class='keyword'>if</span> (!fLoaded &amp;&amp; !ShutdownRequested()) {</td></tr>
<tr class="codeline" data-linenumber="1768"><td class="num" id="LN1768">1768</td><td class="line">            <span class='comment'>// first suggest a reindex</span></td></tr>
<tr class="codeline" data-linenumber="1769"><td class="num" id="LN1769">1769</td><td class="line">            <span class='keyword'>if</span> (!fReset) {</td></tr>
<tr class="codeline" data-linenumber="1770"><td class="num" id="LN1770">1770</td><td class="line">                <span class='keyword'>bool</span> fRet = uiInterface.ThreadSafeQuestion(</td></tr>
<tr class="codeline" data-linenumber="1771"><td class="num" id="LN1771">1771</td><td class="line">                    strLoadError + Untranslated(<span class='string_literal'>".\n\n"</span>) + _(<span class='string_literal'>"Do you want to rebuild the block database now?"</span>),</td></tr>
<tr class="codeline" data-linenumber="1772"><td class="num" id="LN1772">1772</td><td class="line">                    strLoadError.original + <span class='string_literal'>".\nPlease restart with -reindex or -reindex-chainstate to recover."</span>,</td></tr>
<tr class="codeline" data-linenumber="1773"><td class="num" id="LN1773">1773</td><td class="line">                    <span class='string_literal'>""</span>, CClientUIInterface::MSG_ERROR | CClientUIInterface::BTN_ABORT);</td></tr>
<tr class="codeline" data-linenumber="1774"><td class="num" id="LN1774">1774</td><td class="line">                <span class='keyword'>if</span> (fRet) {</td></tr>
<tr class="codeline" data-linenumber="1775"><td class="num" id="LN1775">1775</td><td class="line">                    fReindex = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="1776"><td class="num" id="LN1776">1776</td><td class="line">                    AbortShutdown();</td></tr>
<tr class="codeline" data-linenumber="1777"><td class="num" id="LN1777">1777</td><td class="line">                } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="1778"><td class="num" id="LN1778">1778</td><td class="line">                    LogPrintf(<span class='string_literal'>"Aborted block database rebuild. Exiting.\n"</span>);</td></tr>
<tr class="codeline" data-linenumber="1779"><td class="num" id="LN1779">1779</td><td class="line">                    <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1780"><td class="num" id="LN1780">1780</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1781"><td class="num" id="LN1781">1781</td><td class="line">            } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="1782"><td class="num" id="LN1782">1782</td><td class="line">                <span class='keyword'>return</span> InitError(strLoadError);</td></tr>
<tr class="codeline" data-linenumber="1783"><td class="num" id="LN1783">1783</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1784"><td class="num" id="LN1784">1784</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1785"><td class="num" id="LN1785">1785</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1786"><td class="num" id="LN1786">1786</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1787"><td class="num" id="LN1787">1787</td><td class="line">    <span class='comment'>// As LoadBlockIndex can take several minutes, it's possible the user</span></td></tr>
<tr class="codeline" data-linenumber="1788"><td class="num" id="LN1788">1788</td><td class="line">    <span class='comment'>// requested to kill the GUI during the last operation. If so, exit.</span></td></tr>
<tr class="codeline" data-linenumber="1789"><td class="num" id="LN1789">1789</td><td class="line">    <span class='comment'>// As the program has not fully started yet, Shutdown() is possibly overkill.</span></td></tr>
<tr class="codeline" data-linenumber="1790"><td class="num" id="LN1790">1790</td><td class="line">    <span class='keyword'>if</span> (ShutdownRequested()) {</td></tr>
<tr class="codeline" data-linenumber="1791"><td class="num" id="LN1791">1791</td><td class="line">        LogPrintf(<span class='string_literal'>"Shutdown requested. Exiting.\n"</span>);</td></tr>
<tr class="codeline" data-linenumber="1792"><td class="num" id="LN1792">1792</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1793"><td class="num" id="LN1793">1793</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1794"><td class="num" id="LN1794">1794</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1795"><td class="num" id="LN1795">1795</td><td class="line">    fs::path est_path = GetDataDir() / FEE_ESTIMATES_FILENAME;</td></tr>
<tr class="codeline" data-linenumber="1796"><td class="num" id="LN1796">1796</td><td class="line">    CAutoFile est_filein(fsbridge::fopen(est_path, <span class='string_literal'>"rb"</span>), SER_DISK, CLIENT_VERSION);</td></tr>
<tr class="codeline" data-linenumber="1797"><td class="num" id="LN1797">1797</td><td class="line">    <span class='comment'>// Allowed to fail as this file IS missing on first startup.</span></td></tr>
<tr class="codeline" data-linenumber="1798"><td class="num" id="LN1798">1798</td><td class="line">    <span class='keyword'>if</span> (!est_filein.IsNull())</td></tr>
<tr class="codeline" data-linenumber="1799"><td class="num" id="LN1799">1799</td><td class="line">        ::feeEstimator.Read(est_filein);</td></tr>
<tr class="codeline" data-linenumber="1800"><td class="num" id="LN1800">1800</td><td class="line">    fFeeEstimatesInitialized = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="1801"><td class="num" id="LN1801">1801</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1802"><td class="num" id="LN1802">1802</td><td class="line">    <span class='comment'>// ********************************************************* Step 8: start indexers</span></td></tr>
<tr class="codeline" data-linenumber="1803"><td class="num" id="LN1803">1803</td><td class="line">    <span class='keyword'>if</span> (args.GetBoolArg(<span class='string_literal'>"-txindex"</span>, DEFAULT_TXINDEX)) {</td></tr>
<tr class="codeline" data-linenumber="1804"><td class="num" id="LN1804">1804</td><td class="line">        g_txindex = MakeUnique&lt;TxIndex&gt;(nTxIndexCache, <span class='keyword'>false</span>, fReindex);</td></tr>
<tr class="codeline" data-linenumber="1805"><td class="num" id="LN1805">1805</td><td class="line">        g_txindex-&gt;Start();</td></tr>
<tr class="codeline" data-linenumber="1806"><td class="num" id="LN1806">1806</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1807"><td class="num" id="LN1807">1807</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1808"><td class="num" id="LN1808">1808</td><td class="line">    <span class='keyword'>for</span> (<span class='keyword'>const</span> <span class='keyword'>auto</span>&amp; filter_type : g_enabled_filter_types) {</td></tr>
<tr class="codeline" data-linenumber="1809"><td class="num" id="LN1809">1809</td><td class="line">        InitBlockFilterIndex(filter_type, filter_index_cache, <span class='keyword'>false</span>, fReindex);</td></tr>
<tr class="codeline" data-linenumber="1810"><td class="num" id="LN1810">1810</td><td class="line">        GetBlockFilterIndex(filter_type)-&gt;Start();</td></tr>
<tr class="codeline" data-linenumber="1811"><td class="num" id="LN1811">1811</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1812"><td class="num" id="LN1812">1812</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1813"><td class="num" id="LN1813">1813</td><td class="line">    <span class='comment'>// ********************************************************* Step 9: load wallet</span></td></tr>
<tr class="codeline" data-linenumber="1814"><td class="num" id="LN1814">1814</td><td class="line">    <span class='keyword'>for</span> (<span class='keyword'>const</span> <span class='keyword'>auto</span>&amp; client : node.chain_clients) {</td></tr>
<tr class="codeline" data-linenumber="1815"><td class="num" id="LN1815">1815</td><td class="line">        <span class='keyword'>if</span> (!client-&gt;load()) {</td></tr>
<tr class="codeline" data-linenumber="1816"><td class="num" id="LN1816">1816</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1817"><td class="num" id="LN1817">1817</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1818"><td class="num" id="LN1818">1818</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1819"><td class="num" id="LN1819">1819</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1820"><td class="num" id="LN1820">1820</td><td class="line">    <span class='comment'>// ********************************************************* Step 10: data directory maintenance</span></td></tr>
<tr class="codeline" data-linenumber="1821"><td class="num" id="LN1821">1821</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1822"><td class="num" id="LN1822">1822</td><td class="line">    <span class='comment'>// if pruning, unset the service bit and perform the initial blockstore prune</span></td></tr>
<tr class="codeline" data-linenumber="1823"><td class="num" id="LN1823">1823</td><td class="line">    <span class='comment'>// after any wallet rescanning has taken place.</span></td></tr>
<tr class="codeline" data-linenumber="1824"><td class="num" id="LN1824">1824</td><td class="line">    <span class='keyword'>if</span> (fPruneMode) {</td></tr>
<tr class="codeline" data-linenumber="1825"><td class="num" id="LN1825">1825</td><td class="line">        LogPrintf(<span class='string_literal'>"Unsetting NODE_NETWORK on prune mode\n"</span>);</td></tr>
<tr class="codeline" data-linenumber="1826"><td class="num" id="LN1826">1826</td><td class="line">        nLocalServices = ServiceFlags(nLocalServices &amp; ~NODE_NETWORK);</td></tr>
<tr class="codeline" data-linenumber="1827"><td class="num" id="LN1827">1827</td><td class="line">        <span class='keyword'>if</span> (!fReindex) {</td></tr>
<tr class="codeline" data-linenumber="1828"><td class="num" id="LN1828">1828</td><td class="line">            <span class='macro'>LOCK(cs_main)<span class='macro_popup'>DebugLock&lt;decltype(cs_main)&gt; criticalblock56(cs_main, "cs_main"<br>, "init.cpp", 1828)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1829"><td class="num" id="LN1829">1829</td><td class="line">            <span class='keyword'>for</span> (CChainState* chainstate : chainman.GetAll()) {</td></tr>
<tr class="codeline" data-linenumber="1830"><td class="num" id="LN1830">1830</td><td class="line">                uiInterface.InitMessage(_(<span class='string_literal'>"Pruning blockstore..."</span>).translated);</td></tr>
<tr class="codeline" data-linenumber="1831"><td class="num" id="LN1831">1831</td><td class="line">                chainstate-&gt;PruneAndFlush();</td></tr>
<tr class="codeline" data-linenumber="1832"><td class="num" id="LN1832">1832</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1833"><td class="num" id="LN1833">1833</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1834"><td class="num" id="LN1834">1834</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1835"><td class="num" id="LN1835">1835</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1836"><td class="num" id="LN1836">1836</td><td class="line">    <span class='keyword'>if</span> (chainparams.GetConsensus().SegwitHeight != std::numeric_limits&lt;<span class='keyword'>int</span>&gt;::max()) {</td></tr>
<tr class="codeline" data-linenumber="1837"><td class="num" id="LN1837">1837</td><td class="line">        <span class='comment'>// Advertise witness capabilities.</span></td></tr>
<tr class="codeline" data-linenumber="1838"><td class="num" id="LN1838">1838</td><td class="line">        <span class='comment'>// The option to not set NODE_WITNESS is only used in the tests and should be removed.</span></td></tr>
<tr class="codeline" data-linenumber="1839"><td class="num" id="LN1839">1839</td><td class="line">        nLocalServices = ServiceFlags(nLocalServices | NODE_WITNESS);</td></tr>
<tr class="codeline" data-linenumber="1840"><td class="num" id="LN1840">1840</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1841"><td class="num" id="LN1841">1841</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1842"><td class="num" id="LN1842">1842</td><td class="line">    <span class='comment'>// ********************************************************* Step 11: import blocks</span></td></tr>
<tr class="codeline" data-linenumber="1843"><td class="num" id="LN1843">1843</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1844"><td class="num" id="LN1844">1844</td><td class="line">    <span class='keyword'>if</span> (!CheckDiskSpace(GetDataDir())) {</td></tr>
<tr class="codeline" data-linenumber="1845"><td class="num" id="LN1845">1845</td><td class="line">        InitError(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"Error: Disk space is low for %s"</span>), GetDataDir()));</td></tr>
<tr class="codeline" data-linenumber="1846"><td class="num" id="LN1846">1846</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1847"><td class="num" id="LN1847">1847</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1848"><td class="num" id="LN1848">1848</td><td class="line">    <span class='keyword'>if</span> (!CheckDiskSpace(GetBlocksDir())) {</td></tr>
<tr class="codeline" data-linenumber="1849"><td class="num" id="LN1849">1849</td><td class="line">        InitError(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"Error: Disk space is low for %s"</span>), GetBlocksDir()));</td></tr>
<tr class="codeline" data-linenumber="1850"><td class="num" id="LN1850">1850</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1851"><td class="num" id="LN1851">1851</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1852"><td class="num" id="LN1852">1852</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1853"><td class="num" id="LN1853">1853</td><td class="line">    <span class='comment'>// Either install a handler to notify us when genesis activates, or set fHaveGenesis directly.</span></td></tr>
<tr class="codeline" data-linenumber="1854"><td class="num" id="LN1854">1854</td><td class="line">    <span class='comment'>// No locking, as this happens before any background thread is started.</span></td></tr>
<tr class="codeline" data-linenumber="1855"><td class="num" id="LN1855">1855</td><td class="line">    boost::signals2::connection block_notify_genesis_wait_connection;</td></tr>
<tr class="codeline" data-linenumber="1856"><td class="num" id="LN1856">1856</td><td class="line">    <span class='keyword'>if</span> (::ChainActive().Tip() == <span class='keyword'>nullptr</span>) {</td></tr>
<tr class="codeline" data-linenumber="1857"><td class="num" id="LN1857">1857</td><td class="line">        block_notify_genesis_wait_connection = uiInterface.NotifyBlockTip_connect(std::bind(BlockNotifyGenesisWait, std::placeholders::_2));</td></tr>
<tr class="codeline" data-linenumber="1858"><td class="num" id="LN1858">1858</td><td class="line">    } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="1859"><td class="num" id="LN1859">1859</td><td class="line">        fHaveGenesis = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="1860"><td class="num" id="LN1860">1860</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1861"><td class="num" id="LN1861">1861</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1862"><td class="num" id="LN1862">1862</td><td class="line"><span class='directive'>#if <span class='macro'>HAVE_SYSTEM<span class='macro_popup'>1 || HAVE_WSYSTEM</span></span></span></td></tr>
<tr class="codeline" data-linenumber="1863"><td class="num" id="LN1863">1863</td><td class="line">    <span class='keyword'>const</span> std::string block_notify = args.GetArg(<span class='string_literal'>"-blocknotify"</span>, <span class='string_literal'>""</span>);</td></tr>
<tr class="codeline" data-linenumber="1864"><td class="num" id="LN1864">1864</td><td class="line">    <span class='keyword'>if</span> (!block_notify.empty()) {</td></tr>
<tr class="codeline" data-linenumber="1865"><td class="num" id="LN1865">1865</td><td class="line">        uiInterface.NotifyBlockTip_connect([block_notify](SynchronizationState sync_state, <span class='keyword'>const</span> CBlockIndex* pBlockIndex) {</td></tr>
<tr class="codeline" data-linenumber="1866"><td class="num" id="LN1866">1866</td><td class="line">            <span class='keyword'>if</span> (sync_state != SynchronizationState::POST_INIT || !pBlockIndex) <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="1867"><td class="num" id="LN1867">1867</td><td class="line">            std::string command = block_notify;</td></tr>
<tr class="codeline" data-linenumber="1868"><td class="num" id="LN1868">1868</td><td class="line">            boost::replace_all(command, <span class='string_literal'>"%s"</span>, pBlockIndex-&gt;GetBlockHash().GetHex());</td></tr>
<tr class="codeline" data-linenumber="1869"><td class="num" id="LN1869">1869</td><td class="line">            std::thread t(runCommand, command);</td></tr>
<tr class="codeline" data-linenumber="1870"><td class="num" id="LN1870">1870</td><td class="line">            t.detach(); <span class='comment'>// thread runs free</span></td></tr>
<tr class="codeline" data-linenumber="1871"><td class="num" id="LN1871">1871</td><td class="line">        });</td></tr>
<tr class="codeline" data-linenumber="1872"><td class="num" id="LN1872">1872</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1873"><td class="num" id="LN1873">1873</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1874"><td class="num" id="LN1874">1874</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1875"><td class="num" id="LN1875">1875</td><td class="line">    std::vector&lt;fs::path&gt; vImportFiles;</td></tr>
<tr class="codeline" data-linenumber="1876"><td class="num" id="LN1876">1876</td><td class="line">    <span class='keyword'>for</span> (<span class='keyword'>const</span> std::string&amp; strFile : args.GetArgs(<span class='string_literal'>"-loadblock"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1877"><td class="num" id="LN1877">1877</td><td class="line">        vImportFiles.push_back(strFile);</td></tr>
<tr class="codeline" data-linenumber="1878"><td class="num" id="LN1878">1878</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1879"><td class="num" id="LN1879">1879</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1880"><td class="num" id="LN1880">1880</td><td class="line">    g_load_block = std::thread(&amp;TraceThread&lt;std::function&lt;<span class='keyword'>void</span>()&gt;&gt;, <span class='string_literal'>"loadblk"</span>, [=, &amp;chainman, &amp;args] {</td></tr>
<tr class="codeline" data-linenumber="1881"><td class="num" id="LN1881">1881</td><td class="line">        ThreadImport(chainman, vImportFiles, args);</td></tr>
<tr class="codeline" data-linenumber="1882"><td class="num" id="LN1882">1882</td><td class="line">    });</td></tr>
<tr class="codeline" data-linenumber="1883"><td class="num" id="LN1883">1883</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1884"><td class="num" id="LN1884">1884</td><td class="line">    <span class='comment'>// Wait for genesis block to be processed</span></td></tr>
<tr class="codeline" data-linenumber="1885"><td class="num" id="LN1885">1885</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1886"><td class="num" id="LN1886">1886</td><td class="line">        <span class='macro'>WAIT_LOCK(g_genesis_wait_mutex, lock)<span class='macro_popup'>DebugLock&lt;decltype(g_genesis_wait_mutex)&gt; lock(g_genesis_wait_mutex<br>, "g_genesis_wait_mutex", "init.cpp", 1886)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1887"><td class="num" id="LN1887">1887</td><td class="line">        <span class='comment'>// We previously could hang here if StartShutdown() is called prior to</span></td></tr>
<tr class="codeline" data-linenumber="1888"><td class="num" id="LN1888">1888</td><td class="line">        <span class='comment'>// ThreadImport getting started, so instead we just wait on a timer to</span></td></tr>
<tr class="codeline" data-linenumber="1889"><td class="num" id="LN1889">1889</td><td class="line">        <span class='comment'>// check ShutdownRequested() regularly.</span></td></tr>
<tr class="codeline" data-linenumber="1890"><td class="num" id="LN1890">1890</td><td class="line">        <span class='keyword'>while</span> (!fHaveGenesis &amp;&amp; !ShutdownRequested()) {</td></tr>
<tr class="codeline" data-linenumber="1891"><td class="num" id="LN1891">1891</td><td class="line">            g_genesis_wait_cv.wait_for(lock, std::chrono::milliseconds(500));</td></tr>
<tr class="codeline" data-linenumber="1892"><td class="num" id="LN1892">1892</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1893"><td class="num" id="LN1893">1893</td><td class="line">        block_notify_genesis_wait_connection.disconnect();</td></tr>
<tr class="codeline" data-linenumber="1894"><td class="num" id="LN1894">1894</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1895"><td class="num" id="LN1895">1895</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1896"><td class="num" id="LN1896">1896</td><td class="line">    <span class='keyword'>if</span> (ShutdownRequested()) {</td></tr>
<tr class="codeline" data-linenumber="1897"><td class="num" id="LN1897">1897</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1898"><td class="num" id="LN1898">1898</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1899"><td class="num" id="LN1899">1899</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1900"><td class="num" id="LN1900">1900</td><td class="line">    <span class='comment'>// ********************************************************* Step 12: start node</span></td></tr>
<tr class="codeline" data-linenumber="1901"><td class="num" id="LN1901">1901</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1902"><td class="num" id="LN1902">1902</td><td class="line">    <span class='keyword'>int</span> chain_active_height;</td></tr>
<tr class="codeline" data-linenumber="1903"><td class="num" id="LN1903">1903</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1904"><td class="num" id="LN1904">1904</td><td class="line">    <span class='comment'>//// debug print</span></td></tr>
<tr class="codeline" data-linenumber="1905"><td class="num" id="LN1905">1905</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1906"><td class="num" id="LN1906">1906</td><td class="line">        <span class='macro'>LOCK(cs_main)<span class='macro_popup'>DebugLock&lt;decltype(cs_main)&gt; criticalblock57(cs_main, "cs_main"<br>, "init.cpp", 1906)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1907"><td class="num" id="LN1907">1907</td><td class="line">        LogPrintf(<span class='string_literal'>"block tree size = %u\n"</span>, chainman.BlockIndex().size());</td></tr>
<tr class="codeline" data-linenumber="1908"><td class="num" id="LN1908">1908</td><td class="line">        chain_active_height = chainman.ActiveChain().Height();</td></tr>
<tr class="codeline" data-linenumber="1909"><td class="num" id="LN1909">1909</td><td class="line">        <span class='keyword'>if</span> (tip_info) {</td></tr>
<tr class="codeline" data-linenumber="1910"><td class="num" id="LN1910">1910</td><td class="line">            tip_info-&gt;block_height = chain_active_height;</td></tr>
<tr class="codeline" data-linenumber="1911"><td class="num" id="LN1911">1911</td><td class="line">            tip_info-&gt;block_time = chainman.ActiveChain().Tip() ? chainman.ActiveChain().Tip()-&gt;GetBlockTime() : Params().GenesisBlock().GetBlockTime();</td></tr>
<tr class="codeline" data-linenumber="1912"><td class="num" id="LN1912">1912</td><td class="line">            tip_info-&gt;verification_progress = GuessVerificationProgress(Params().TxData(), chainman.ActiveChain().Tip());</td></tr>
<tr class="codeline" data-linenumber="1913"><td class="num" id="LN1913">1913</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1914"><td class="num" id="LN1914">1914</td><td class="line">        <span class='keyword'>if</span> (tip_info &amp;&amp; ::pindexBestHeader) {</td></tr>
<tr class="codeline" data-linenumber="1915"><td class="num" id="LN1915">1915</td><td class="line">            tip_info-&gt;header_height = ::pindexBestHeader-&gt;nHeight;</td></tr>
<tr class="codeline" data-linenumber="1916"><td class="num" id="LN1916">1916</td><td class="line">            tip_info-&gt;header_time = ::pindexBestHeader-&gt;GetBlockTime();</td></tr>
<tr class="codeline" data-linenumber="1917"><td class="num" id="LN1917">1917</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1918"><td class="num" id="LN1918">1918</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1919"><td class="num" id="LN1919">1919</td><td class="line">    LogPrintf(<span class='string_literal'>"nBestHeight = %d\n"</span>, chain_active_height);</td></tr>
<tr class="codeline" data-linenumber="1920"><td class="num" id="LN1920">1920</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1921"><td class="num" id="LN1921">1921</td><td class="line">    Discover();</td></tr>
<tr class="codeline" data-linenumber="1922"><td class="num" id="LN1922">1922</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1923"><td class="num" id="LN1923">1923</td><td class="line">    <span class='comment'>// Map ports with UPnP</span></td></tr>
<tr class="codeline" data-linenumber="1924"><td class="num" id="LN1924">1924</td><td class="line">    <span class='keyword'>if</span> (args.GetBoolArg(<span class='string_literal'>"-upnp"</span>, DEFAULT_UPNP)) {</td></tr>
<tr class="codeline" data-linenumber="1925"><td class="num" id="LN1925">1925</td><td class="line">        StartMapPort();</td></tr>
<tr class="codeline" data-linenumber="1926"><td class="num" id="LN1926">1926</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1927"><td class="num" id="LN1927">1927</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1928"><td class="num" id="LN1928">1928</td><td class="line">    CConnman::Options connOptions;</td></tr>
<tr class="codeline" data-linenumber="1929"><td class="num" id="LN1929">1929</td><td class="line">    connOptions.nLocalServices = nLocalServices;</td></tr>
<tr class="codeline" data-linenumber="1930"><td class="num" id="LN1930">1930</td><td class="line">    connOptions.nMaxConnections = nMaxConnections;</td></tr>
<tr class="codeline" data-linenumber="1931"><td class="num" id="LN1931">1931</td><td class="line">    connOptions.m_max_outbound_full_relay = std::min(MAX_OUTBOUND_FULL_RELAY_CONNECTIONS, connOptions.nMaxConnections);</td></tr>
<tr class="codeline" data-linenumber="1932"><td class="num" id="LN1932">1932</td><td class="line">    connOptions.m_max_outbound_block_relay = std::min(MAX_BLOCK_RELAY_ONLY_CONNECTIONS, connOptions.nMaxConnections-connOptions.m_max_outbound_full_relay);</td></tr>
<tr class="codeline" data-linenumber="1933"><td class="num" id="LN1933">1933</td><td class="line">    connOptions.nMaxAddnode = MAX_ADDNODE_CONNECTIONS;</td></tr>
<tr class="codeline" data-linenumber="1934"><td class="num" id="LN1934">1934</td><td class="line">    connOptions.nMaxFeeler = MAX_FEELER_CONNECTIONS;</td></tr>
<tr class="codeline" data-linenumber="1935"><td class="num" id="LN1935">1935</td><td class="line">    connOptions.nBestHeight = chain_active_height;</td></tr>
<tr class="codeline" data-linenumber="1936"><td class="num" id="LN1936">1936</td><td class="line">    connOptions.uiInterface = &amp;uiInterface;</td></tr>
<tr class="codeline" data-linenumber="1937"><td class="num" id="LN1937">1937</td><td class="line">    connOptions.m_banman = node.banman.get();</td></tr>
<tr class="codeline" data-linenumber="1938"><td class="num" id="LN1938">1938</td><td class="line">    connOptions.m_msgproc = node.peerman.get();</td></tr>
<tr class="codeline" data-linenumber="1939"><td class="num" id="LN1939">1939</td><td class="line">    connOptions.nSendBufferMaxSize = 1000 * args.GetArg(<span class='string_literal'>"-maxsendbuffer"</span>, DEFAULT_MAXSENDBUFFER);</td></tr>
<tr class="codeline" data-linenumber="1940"><td class="num" id="LN1940">1940</td><td class="line">    connOptions.nReceiveFloodSize = 1000 * args.GetArg(<span class='string_literal'>"-maxreceivebuffer"</span>, DEFAULT_MAXRECEIVEBUFFER);</td></tr>
<tr class="codeline" data-linenumber="1941"><td class="num" id="LN1941">1941</td><td class="line">    connOptions.m_added_nodes = args.GetArgs(<span class='string_literal'>"-addnode"</span>);</td></tr>
<tr class="codeline" data-linenumber="1942"><td class="num" id="LN1942">1942</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1943"><td class="num" id="LN1943">1943</td><td class="line">    connOptions.nMaxOutboundTimeframe = nMaxOutboundTimeframe;</td></tr>
<tr class="codeline" data-linenumber="1944"><td class="num" id="LN1944">1944</td><td class="line">    connOptions.nMaxOutboundLimit = nMaxOutboundLimit;</td></tr>
<tr class="codeline" data-linenumber="1945"><td class="num" id="LN1945">1945</td><td class="line">    connOptions.m_peer_connect_timeout = peer_connect_timeout;</td></tr>
<tr class="codeline" data-linenumber="1946"><td class="num" id="LN1946">1946</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1947"><td class="num" id="LN1947">1947</td><td class="line">    <span class='keyword'>for</span> (<span class='keyword'>const</span> std::string&amp; bind_arg : args.GetArgs(<span class='string_literal'>"-bind"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1948"><td class="num" id="LN1948">1948</td><td class="line">        CService bind_addr;</td></tr>
<tr class="codeline" data-linenumber="1949"><td class="num" id="LN1949">1949</td><td class="line">        <span class='keyword'>const</span> size_t index = bind_arg.rfind('=');</td></tr>
<tr class="codeline" data-linenumber="1950"><td class="num" id="LN1950">1950</td><td class="line">        <span class='keyword'>if</span> (index == std::string::npos) {</td></tr>
<tr class="codeline" data-linenumber="1951"><td class="num" id="LN1951">1951</td><td class="line">            <span class='keyword'>if</span> (Lookup(bind_arg, bind_addr, GetListenPort(), <span class='keyword'>false</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1952"><td class="num" id="LN1952">1952</td><td class="line">                connOptions.vBinds.push_back(bind_addr);</td></tr>
<tr class="codeline" data-linenumber="1953"><td class="num" id="LN1953">1953</td><td class="line">                <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="1954"><td class="num" id="LN1954">1954</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1955"><td class="num" id="LN1955">1955</td><td class="line">        } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="1956"><td class="num" id="LN1956">1956</td><td class="line">            <span class='keyword'>const</span> std::string network_type = bind_arg.substr(index + 1);</td></tr>
<tr class="codeline" data-linenumber="1957"><td class="num" id="LN1957">1957</td><td class="line">            <span class='keyword'>if</span> (network_type == <span class='string_literal'>"onion"</span>) {</td></tr>
<tr class="codeline" data-linenumber="1958"><td class="num" id="LN1958">1958</td><td class="line">                <span class='keyword'>const</span> std::string truncated_bind_arg = bind_arg.substr(0, index);</td></tr>
<tr class="codeline" data-linenumber="1959"><td class="num" id="LN1959">1959</td><td class="line">                <span class='keyword'>if</span> (Lookup(truncated_bind_arg, bind_addr, BaseParams().OnionServiceTargetPort(), <span class='keyword'>false</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1960"><td class="num" id="LN1960">1960</td><td class="line">                    connOptions.onion_binds.push_back(bind_addr);</td></tr>
<tr class="codeline" data-linenumber="1961"><td class="num" id="LN1961">1961</td><td class="line">                    <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="1962"><td class="num" id="LN1962">1962</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1963"><td class="num" id="LN1963">1963</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1964"><td class="num" id="LN1964">1964</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1965"><td class="num" id="LN1965">1965</td><td class="line">        <span class='keyword'>return</span> InitError(ResolveErrMsg(<span class='string_literal'>"bind"</span>, bind_arg));</td></tr>
<tr class="codeline" data-linenumber="1966"><td class="num" id="LN1966">1966</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1967"><td class="num" id="LN1967">1967</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1968"><td class="num" id="LN1968">1968</td><td class="line">    <span class='keyword'>if</span> (connOptions.onion_binds.empty()) {</td></tr>
<tr class="codeline" data-linenumber="1969"><td class="num" id="LN1969">1969</td><td class="line">        connOptions.onion_binds.push_back(DefaultOnionServiceTarget());</td></tr>
<tr class="codeline" data-linenumber="1970"><td class="num" id="LN1970">1970</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1971"><td class="num" id="LN1971">1971</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1972"><td class="num" id="LN1972">1972</td><td class="line">    <span class='keyword'>if</span> (args.GetBoolArg(<span class='string_literal'>"-listenonion"</span>, DEFAULT_LISTEN_ONION)) {</td></tr>
<tr class="codeline" data-linenumber="1973"><td class="num" id="LN1973">1973</td><td class="line">        <span class='keyword'>const</span> <span class='keyword'>auto</span> bind_addr = connOptions.onion_binds.front();</td></tr>
<tr class="codeline" data-linenumber="1974"><td class="num" id="LN1974">1974</td><td class="line">        <span class='keyword'>if</span> (connOptions.onion_binds.size() &gt; 1) {</td></tr>
<tr class="codeline" data-linenumber="1975"><td class="num" id="LN1975">1975</td><td class="line">            InitWarning(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(_(<span class='string_literal'>"More than one onion bind address is provided. Using %s for the automatically created Tor onion service."</span>), bind_addr.ToStringIPPort()));</td></tr>
<tr class="codeline" data-linenumber="1976"><td class="num" id="LN1976">1976</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1977"><td class="num" id="LN1977">1977</td><td class="line">        StartTorControl(bind_addr);</td></tr>
<tr class="codeline" data-linenumber="1978"><td class="num" id="LN1978">1978</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1979"><td class="num" id="LN1979">1979</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1980"><td class="num" id="LN1980">1980</td><td class="line">    <span class='keyword'>for</span> (<span class='keyword'>const</span> std::string&amp; strBind : args.GetArgs(<span class='string_literal'>"-whitebind"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1981"><td class="num" id="LN1981">1981</td><td class="line">        NetWhitebindPermissions whitebind;</td></tr>
<tr class="codeline" data-linenumber="1982"><td class="num" id="LN1982">1982</td><td class="line">        bilingual_str error;</td></tr>
<tr class="codeline" data-linenumber="1983"><td class="num" id="LN1983">1983</td><td class="line">        <span class='keyword'>if</span> (!NetWhitebindPermissions::TryParse(strBind, whitebind, error)) <span class='keyword'>return</span> InitError(error);</td></tr>
<tr class="codeline" data-linenumber="1984"><td class="num" id="LN1984">1984</td><td class="line">        connOptions.vWhiteBinds.push_back(whitebind);</td></tr>
<tr class="codeline" data-linenumber="1985"><td class="num" id="LN1985">1985</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1986"><td class="num" id="LN1986">1986</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1987"><td class="num" id="LN1987">1987</td><td class="line">    <span class='keyword'>for</span> (<span class='keyword'>const</span> <span class='keyword'>auto</span>&amp; net : args.GetArgs(<span class='string_literal'>"-whitelist"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1988"><td class="num" id="LN1988">1988</td><td class="line">        NetWhitelistPermissions subnet;</td></tr>
<tr class="codeline" data-linenumber="1989"><td class="num" id="LN1989">1989</td><td class="line">        bilingual_str error;</td></tr>
<tr class="codeline" data-linenumber="1990"><td class="num" id="LN1990">1990</td><td class="line">        <span class='keyword'>if</span> (!NetWhitelistPermissions::TryParse(net, subnet, error)) <span class='keyword'>return</span> InitError(error);</td></tr>
<tr class="codeline" data-linenumber="1991"><td class="num" id="LN1991">1991</td><td class="line">        connOptions.vWhitelistedRange.push_back(subnet);</td></tr>
<tr class="codeline" data-linenumber="1992"><td class="num" id="LN1992">1992</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1993"><td class="num" id="LN1993">1993</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1994"><td class="num" id="LN1994">1994</td><td class="line">    connOptions.vSeedNodes = args.GetArgs(<span class='string_literal'>"-seednode"</span>);</td></tr>
<tr class="codeline" data-linenumber="1995"><td class="num" id="LN1995">1995</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1996"><td class="num" id="LN1996">1996</td><td class="line">    <span class='comment'>// Initiate outbound connections unless connect=0</span></td></tr>
<tr class="codeline" data-linenumber="1997"><td class="num" id="LN1997">1997</td><td class="line">    connOptions.m_use_addrman_outgoing = !args.IsArgSet(<span class='string_literal'>"-connect"</span>);</td></tr>
<tr class="codeline" data-linenumber="1998"><td class="num" id="LN1998">1998</td><td class="line">    <span class='keyword'>if</span> (!connOptions.m_use_addrman_outgoing) {</td></tr>
<tr class="codeline" data-linenumber="1999"><td class="num" id="LN1999">1999</td><td class="line">        <span class='keyword'>const</span> <span class='keyword'>auto</span> connect = args.GetArgs(<span class='string_literal'>"-connect"</span>);</td></tr>
<tr class="codeline" data-linenumber="2000"><td class="num" id="LN2000">2000</td><td class="line">        <span class='keyword'>if</span> (connect.size() != 1 || connect[0] != <span class='string_literal'>"0"</span>) {</td></tr>
<tr class="codeline" data-linenumber="2001"><td class="num" id="LN2001">2001</td><td class="line">            connOptions.m_specified_outgoing = connect;</td></tr>
<tr class="codeline" data-linenumber="2002"><td class="num" id="LN2002">2002</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2003"><td class="num" id="LN2003">2003</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2004"><td class="num" id="LN2004">2004</td><td class="line">    <span class='keyword'>if</span> (!node.connman-&gt;Start(*node.scheduler, connOptions)) {</td></tr>
<tr class="codeline" data-linenumber="2005"><td class="num" id="LN2005">2005</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="2006"><td class="num" id="LN2006">2006</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2007"><td class="num" id="LN2007">2007</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2008"><td class="num" id="LN2008">2008</td><td class="line">    <span class='comment'>// ********************************************************* Step 13: finished</span></td></tr>
<tr class="codeline" data-linenumber="2009"><td class="num" id="LN2009">2009</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2010"><td class="num" id="LN2010">2010</td><td class="line">    SetRPCWarmupFinished();</td></tr>
<tr class="codeline" data-linenumber="2011"><td class="num" id="LN2011">2011</td><td class="line">    uiInterface.InitMessage(_(<span class='string_literal'>"Done loading"</span>).translated);</td></tr>
<tr class="codeline" data-linenumber="2012"><td class="num" id="LN2012">2012</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2013"><td class="num" id="LN2013">2013</td><td class="line">    <span class='keyword'>for</span> (<span class='keyword'>const</span> <span class='keyword'>auto</span>&amp; client : node.chain_clients) {</td></tr>
<tr class="codeline" data-linenumber="2014"><td class="num" id="LN2014">2014</td><td class="line">        client-&gt;start(*node.scheduler);</td></tr>
<tr class="codeline" data-linenumber="2015"><td class="num" id="LN2015">2015</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2016"><td class="num" id="LN2016">2016</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2017"><td class="num" id="LN2017">2017</td><td class="line">    BanMan* banman = node.banman.get();</td></tr>
<tr class="codeline" data-linenumber="2018"><td class="num" id="LN2018">2018</td><td class="line">    node.scheduler-&gt;scheduleEvery([banman]{</td></tr>
<tr class="codeline" data-linenumber="2019"><td class="num" id="LN2019">2019</td><td class="line">        banman-&gt;DumpBanlist();</td></tr>
<tr class="codeline" data-linenumber="2020"><td class="num" id="LN2020">2020</td><td class="line">    }, DUMP_BANS_INTERVAL);</td></tr>
<tr class="codeline" data-linenumber="2021"><td class="num" id="LN2021">2021</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2022"><td class="num" id="LN2022">2022</td><td class="line"><span class='directive'>#if <span class='macro'>HAVE_SYSTEM<span class='macro_popup'>1 || HAVE_WSYSTEM</span></span></span></td></tr>
<tr class="codeline" data-linenumber="2023"><td class="num" id="LN2023">2023</td><td class="line">    StartupNotify(args);</td></tr>
<tr class="codeline" data-linenumber="2024"><td class="num" id="LN2024">2024</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2025"><td class="num" id="LN2025">2025</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2026"><td class="num" id="LN2026">2026</td><td class="line">    <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="2027"><td class="num" id="LN2027">2027</td><td class="line">}</td></tr>
</table><hr class=divider>
<div id=File1511692>
<div class=FileNav><a href="#File1">&#x2190;</a></div><h4 class=FileName>/usr/local/include/boost/thread/detail/thread_group.hpp</h4>
<div class=FileNav><a href="#File368900">&#x2192;</a></div></div>
<table class="code" data-fileid="1511692">
<tr class="codeline" data-linenumber="1"><td class="num" id="LN1">1</td><td class="line"><span class='directive'>#ifndef BOOST_THREAD_DETAIL_THREAD_GROUP_HPP</span></td></tr>
<tr class="codeline" data-linenumber="2"><td class="num" id="LN2">2</td><td class="line"><span class='directive'>#define BOOST_THREAD_DETAIL_THREAD_GROUP_HPP</span></td></tr>
<tr class="codeline" data-linenumber="3"><td class="num" id="LN3">3</td><td class="line"><span class='comment'>// Distributed under the Boost Software License, Version 1.0. (See</span></td></tr>
<tr class="codeline" data-linenumber="4"><td class="num" id="LN4">4</td><td class="line"><span class='comment'>// accompanying file LICENSE_1_0.txt or copy at</span></td></tr>
<tr class="codeline" data-linenumber="5"><td class="num" id="LN5">5</td><td class="line"><span class='comment'>// http://www.boost.org/LICENSE_1_0.txt)</span></td></tr>
<tr class="codeline" data-linenumber="6"><td class="num" id="LN6">6</td><td class="line"><span class='comment'>// (C) Copyright 2007-9 Anthony Williams</span></td></tr>
<tr class="codeline" data-linenumber="7"><td class="num" id="LN7">7</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="8"><td class="num" id="LN8">8</td><td class="line"><span class='directive'>#include &lt;list&gt;</span></td></tr>
<tr class="codeline" data-linenumber="9"><td class="num" id="LN9">9</td><td class="line"><span class='directive'>#include &lt;boost/thread/csbl/memory/unique_ptr.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="10"><td class="num" id="LN10">10</td><td class="line"><span class='directive'>#include &lt;boost/thread/shared_mutex.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="11"><td class="num" id="LN11">11</td><td class="line"><span class='directive'>#include &lt;boost/thread/mutex.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="12"><td class="num" id="LN12">12</td><td class="line"><span class='directive'>#include &lt;boost/thread/lock_guard.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="13"><td class="num" id="LN13">13</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="14"><td class="num" id="LN14">14</td><td class="line"><span class='directive'>#include &lt;boost/config/abi_prefix.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="15"><td class="num" id="LN15">15</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="16"><td class="num" id="LN16">16</td><td class="line"><span class='directive'>#ifdef BOOST_MSVC</span></td></tr>
<tr class="codeline" data-linenumber="17"><td class="num" id="LN17">17</td><td class="line"><span class='directive'>#pragma warning(push)</span></td></tr>
<tr class="codeline" data-linenumber="18"><td class="num" id="LN18">18</td><td class="line"><span class='directive'>#pragma warning(disable:4251)</span></td></tr>
<tr class="codeline" data-linenumber="19"><td class="num" id="LN19">19</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="20"><td class="num" id="LN20">20</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="21"><td class="num" id="LN21">21</td><td class="line"><span class='keyword'>namespace</span> boost</td></tr>
<tr class="codeline" data-linenumber="22"><td class="num" id="LN22">22</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="23"><td class="num" id="LN23">23</td><td class="line">    <span class='keyword'>class</span> thread_group</td></tr>
<tr class="codeline" data-linenumber="24"><td class="num" id="LN24">24</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="25"><td class="num" id="LN25">25</td><td class="line">    <span class='keyword'>private</span>:</td></tr>
<tr class="codeline" data-linenumber="26"><td class="num" id="LN26">26</td><td class="line">        thread_group(thread_group <span class='keyword'>const</span>&amp;);</td></tr>
<tr class="codeline" data-linenumber="27"><td class="num" id="LN27">27</td><td class="line">        thread_group&amp; <span class='keyword'>operator</span>=(thread_group <span class='keyword'>const</span>&amp;);</td></tr>
<tr class="codeline" data-linenumber="28"><td class="num" id="LN28">28</td><td class="line">    <span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="29"><td class="num" id="LN29">29</td><td class="line">        thread_group() {}</td></tr>
<tr class="codeline" data-linenumber="30"><td class="num" id="LN30">30</td><td class="line">        ~thread_group()</td></tr>
<tr class="codeline" data-linenumber="31"><td class="num" id="LN31">31</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="32"><td class="num" id="LN32">32</td><td class="line">            <span class='keyword'>for</span>(std::list&lt;thread*&gt;::iterator it=threads.begin(),end=threads.end();</td></tr>
<tr class="codeline" data-linenumber="33"><td class="num" id="LN33">33</td><td class="line">                it!=end;</td></tr>
<tr class="codeline" data-linenumber="34"><td class="num" id="LN34">34</td><td class="line">                ++it)</td></tr>
<tr class="codeline" data-linenumber="35"><td class="num" id="LN35">35</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="36"><td class="num" id="LN36">36</td><td class="line">                <span class='keyword'>delete</span> *it;</td></tr>
<tr class="codeline" data-linenumber="37"><td class="num" id="LN37">37</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="38"><td class="num" id="LN38">38</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="39"><td class="num" id="LN39">39</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="40"><td class="num" id="LN40">40</td><td class="line">        <span class='keyword'>bool</span> is_this_thread_in()</td></tr>
<tr class="codeline" data-linenumber="41"><td class="num" id="LN41">41</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="42"><td class="num" id="LN42">42</td><td class="line">            thread::id id = this_thread::get_id();</td></tr>
<tr class="codeline" data-linenumber="43"><td class="num" id="LN43">43</td><td class="line">            boost::shared_lock&lt;shared_mutex&gt; guard(m);</td></tr>
<tr class="codeline" data-linenumber="44"><td class="num" id="LN44">44</td><td class="line">            <span class='keyword'>for</span>(std::list&lt;thread*&gt;::iterator it=threads.begin(),end=threads.end();</td></tr>
<tr class="codeline" data-linenumber="45"><td class="num" id="LN45">45</td><td class="line">                it!=end;</td></tr>
<tr class="codeline" data-linenumber="46"><td class="num" id="LN46">46</td><td class="line">                ++it)</td></tr>
<tr class="codeline" data-linenumber="47"><td class="num" id="LN47">47</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="48"><td class="num" id="LN48">48</td><td class="line">              <span class='keyword'>if</span> ((*it)-&gt;get_id() == id)</td></tr>
<tr class="codeline" data-linenumber="49"><td class="num" id="LN49">49</td><td class="line">                <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="50"><td class="num" id="LN50">50</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="51"><td class="num" id="LN51">51</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="52"><td class="num" id="LN52">52</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="53"><td class="num" id="LN53">53</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="54"><td class="num" id="LN54">54</td><td class="line">        <span class='keyword'>bool</span> is_thread_in(thread* thrd)</td></tr>
<tr class="codeline" data-linenumber="55"><td class="num" id="LN55">55</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="56"><td class="num" id="LN56">56</td><td class="line">          <span class='keyword'>if</span>(thrd)</td></tr>
<tr class="codeline" data-linenumber="57"><td class="num" id="LN57">57</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="58"><td class="num" id="LN58">58</td><td class="line">            thread::id id = thrd-&gt;get_id();</td></tr>
<tr class="codeline" data-linenumber="59"><td class="num" id="LN59">59</td><td class="line">            boost::shared_lock&lt;shared_mutex&gt; guard(m);</td></tr>
<tr class="codeline" data-linenumber="60"><td class="num" id="LN60">60</td><td class="line">            <span class='keyword'>for</span>(std::list&lt;thread*&gt;::iterator it=threads.begin(),end=threads.end();</td></tr>
<tr class="codeline" data-linenumber="61"><td class="num" id="LN61">61</td><td class="line">                it!=end;</td></tr>
<tr class="codeline" data-linenumber="62"><td class="num" id="LN62">62</td><td class="line">                ++it)</td></tr>
<tr class="codeline" data-linenumber="63"><td class="num" id="LN63">63</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="64"><td class="num" id="LN64">64</td><td class="line">              <span class='keyword'>if</span> ((*it)-&gt;get_id() == id)</td></tr>
<tr class="codeline" data-linenumber="65"><td class="num" id="LN65">65</td><td class="line">                <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="66"><td class="num" id="LN66">66</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="67"><td class="num" id="LN67">67</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="68"><td class="num" id="LN68">68</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="69"><td class="num" id="LN69">69</td><td class="line">          <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="70"><td class="num" id="LN70">70</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="71"><td class="num" id="LN71">71</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="72"><td class="num" id="LN72">72</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="73"><td class="num" id="LN73">73</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="74"><td class="num" id="LN74">74</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="75"><td class="num" id="LN75">75</td><td class="line">        <span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> F&gt;</td></tr>
<tr class="codeline" data-linenumber="76"><td class="num" id="LN76">76</td><td class="line">        thread* create_thread(F threadfunc)</td></tr>
<tr class="codeline" data-linenumber="77"><td class="num" id="LN77">77</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="78"><td class="num" id="LN78">78</td><td class="line">            boost::lock_guard&lt;shared_mutex&gt; <span class="mrange">guard(m)</span>;</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path17" class="msg msgEvent" style="margin-left:45ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">17</div></td><td><div class="PathNav"><a href="#Path16" title="Previous event (16)">&#x2190;</a></div></td><td>Calling constructor for 'lock_guard&lt;boost::shared_mutex&gt;'</td><td><div class="PathNav"><a href="#Path18" title="Next event (18)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="79"><td class="num" id="LN79">79</td><td class="line">            boost::csbl::unique_ptr&lt;thread&gt; new_thread(<span class='keyword'>new</span> thread(threadfunc));</td></tr>
<tr class="codeline" data-linenumber="80"><td class="num" id="LN80">80</td><td class="line">            threads.push_back(new_thread.get());</td></tr>
<tr class="codeline" data-linenumber="81"><td class="num" id="LN81">81</td><td class="line">            <span class='keyword'>return</span> new_thread.release();</td></tr>
<tr class="codeline" data-linenumber="82"><td class="num" id="LN82">82</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="83"><td class="num" id="LN83">83</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="84"><td class="num" id="LN84">84</td><td class="line">        <span class='keyword'>void</span> add_thread(thread* thrd)</td></tr>
<tr class="codeline" data-linenumber="85"><td class="num" id="LN85">85</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="86"><td class="num" id="LN86">86</td><td class="line">            <span class='keyword'>if</span>(thrd)</td></tr>
<tr class="codeline" data-linenumber="87"><td class="num" id="LN87">87</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="88"><td class="num" id="LN88">88</td><td class="line">                BOOST_THREAD_ASSERT_PRECONDITION( ! is_thread_in(thrd) ,</td></tr>
<tr class="codeline" data-linenumber="89"><td class="num" id="LN89">89</td><td class="line">                    thread_resource_error(<span class='keyword'>static_cast</span>&lt;<span class='keyword'>int</span>&gt;(system::errc::resource_deadlock_would_occur), <span class='string_literal'>"boost::thread_group: trying to add a duplicated thread"</span>)</td></tr>
<tr class="codeline" data-linenumber="90"><td class="num" id="LN90">90</td><td class="line">                );</td></tr>
<tr class="codeline" data-linenumber="91"><td class="num" id="LN91">91</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="92"><td class="num" id="LN92">92</td><td class="line">                boost::lock_guard&lt;shared_mutex&gt; guard(m);</td></tr>
<tr class="codeline" data-linenumber="93"><td class="num" id="LN93">93</td><td class="line">                threads.push_back(thrd);</td></tr>
<tr class="codeline" data-linenumber="94"><td class="num" id="LN94">94</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="95"><td class="num" id="LN95">95</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="96"><td class="num" id="LN96">96</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="97"><td class="num" id="LN97">97</td><td class="line">        <span class='keyword'>void</span> remove_thread(thread* thrd)</td></tr>
<tr class="codeline" data-linenumber="98"><td class="num" id="LN98">98</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="99"><td class="num" id="LN99">99</td><td class="line">            boost::lock_guard&lt;shared_mutex&gt; guard(m);</td></tr>
<tr class="codeline" data-linenumber="100"><td class="num" id="LN100">100</td><td class="line">            std::list&lt;thread*&gt;::iterator <span class='keyword'>const</span> it=std::find(threads.begin(),threads.end(),thrd);</td></tr>
<tr class="codeline" data-linenumber="101"><td class="num" id="LN101">101</td><td class="line">            <span class='keyword'>if</span>(it!=threads.end())</td></tr>
<tr class="codeline" data-linenumber="102"><td class="num" id="LN102">102</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="103"><td class="num" id="LN103">103</td><td class="line">                threads.erase(it);</td></tr>
<tr class="codeline" data-linenumber="104"><td class="num" id="LN104">104</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="105"><td class="num" id="LN105">105</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="106"><td class="num" id="LN106">106</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="107"><td class="num" id="LN107">107</td><td class="line">        <span class='keyword'>void</span> join_all()</td></tr>
<tr class="codeline" data-linenumber="108"><td class="num" id="LN108">108</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="109"><td class="num" id="LN109">109</td><td class="line">            BOOST_THREAD_ASSERT_PRECONDITION( ! is_this_thread_in() ,</td></tr>
<tr class="codeline" data-linenumber="110"><td class="num" id="LN110">110</td><td class="line">                thread_resource_error(<span class='keyword'>static_cast</span>&lt;<span class='keyword'>int</span>&gt;(system::errc::resource_deadlock_would_occur), <span class='string_literal'>"boost::thread_group: trying joining itself"</span>)</td></tr>
<tr class="codeline" data-linenumber="111"><td class="num" id="LN111">111</td><td class="line">            );</td></tr>
<tr class="codeline" data-linenumber="112"><td class="num" id="LN112">112</td><td class="line">            boost::shared_lock&lt;shared_mutex&gt; guard(m);</td></tr>
<tr class="codeline" data-linenumber="113"><td class="num" id="LN113">113</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="114"><td class="num" id="LN114">114</td><td class="line">            <span class='keyword'>for</span>(std::list&lt;thread*&gt;::iterator it=threads.begin(),end=threads.end();</td></tr>
<tr class="codeline" data-linenumber="115"><td class="num" id="LN115">115</td><td class="line">                it!=end;</td></tr>
<tr class="codeline" data-linenumber="116"><td class="num" id="LN116">116</td><td class="line">                ++it)</td></tr>
<tr class="codeline" data-linenumber="117"><td class="num" id="LN117">117</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="118"><td class="num" id="LN118">118</td><td class="line">              <span class='keyword'>if</span> ((*it)-&gt;joinable())</td></tr>
<tr class="codeline" data-linenumber="119"><td class="num" id="LN119">119</td><td class="line">                (*it)-&gt;join();</td></tr>
<tr class="codeline" data-linenumber="120"><td class="num" id="LN120">120</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="121"><td class="num" id="LN121">121</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="122"><td class="num" id="LN122">122</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="123"><td class="num" id="LN123">123</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="124"><td class="num" id="LN124">124</td><td class="line">        <span class='keyword'>void</span> interrupt_all()</td></tr>
<tr class="codeline" data-linenumber="125"><td class="num" id="LN125">125</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="126"><td class="num" id="LN126">126</td><td class="line">            boost::shared_lock&lt;shared_mutex&gt; guard(m);</td></tr>
<tr class="codeline" data-linenumber="127"><td class="num" id="LN127">127</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="128"><td class="num" id="LN128">128</td><td class="line">            <span class='keyword'>for</span>(std::list&lt;thread*&gt;::iterator it=threads.begin(),end=threads.end();</td></tr>
<tr class="codeline" data-linenumber="129"><td class="num" id="LN129">129</td><td class="line">                it!=end;</td></tr>
<tr class="codeline" data-linenumber="130"><td class="num" id="LN130">130</td><td class="line">                ++it)</td></tr>
<tr class="codeline" data-linenumber="131"><td class="num" id="LN131">131</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="132"><td class="num" id="LN132">132</td><td class="line">                (*it)-&gt;interrupt();</td></tr>
<tr class="codeline" data-linenumber="133"><td class="num" id="LN133">133</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="134"><td class="num" id="LN134">134</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="135"><td class="num" id="LN135">135</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="136"><td class="num" id="LN136">136</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="137"><td class="num" id="LN137">137</td><td class="line">        size_t size() <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="138"><td class="num" id="LN138">138</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="139"><td class="num" id="LN139">139</td><td class="line">            boost::shared_lock&lt;shared_mutex&gt; guard(m);</td></tr>
<tr class="codeline" data-linenumber="140"><td class="num" id="LN140">140</td><td class="line">            <span class='keyword'>return</span> threads.size();</td></tr>
<tr class="codeline" data-linenumber="141"><td class="num" id="LN141">141</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="142"><td class="num" id="LN142">142</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="143"><td class="num" id="LN143">143</td><td class="line">    <span class='keyword'>private</span>:</td></tr>
<tr class="codeline" data-linenumber="144"><td class="num" id="LN144">144</td><td class="line">        std::list&lt;thread*&gt; threads;</td></tr>
<tr class="codeline" data-linenumber="145"><td class="num" id="LN145">145</td><td class="line">        <span class='keyword'>mutable</span> shared_mutex m;</td></tr>
<tr class="codeline" data-linenumber="146"><td class="num" id="LN146">146</td><td class="line">    };</td></tr>
<tr class="codeline" data-linenumber="147"><td class="num" id="LN147">147</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="148"><td class="num" id="LN148">148</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="149"><td class="num" id="LN149">149</td><td class="line"><span class='directive'>#ifdef BOOST_MSVC</span></td></tr>
<tr class="codeline" data-linenumber="150"><td class="num" id="LN150">150</td><td class="line"><span class='directive'>#pragma warning(pop)</span></td></tr>
<tr class="codeline" data-linenumber="151"><td class="num" id="LN151">151</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="152"><td class="num" id="LN152">152</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="153"><td class="num" id="LN153">153</td><td class="line"><span class='directive'>#include &lt;boost/config/abi_suffix.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="154"><td class="num" id="LN154">154</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="155"><td class="num" id="LN155">155</td><td class="line"><span class='directive'>#endif</span></td></tr>
</table><hr class=divider>
<div id=File368900>
<div class=FileNav><a href="#File1511692">&#x2190;</a></div><h4 class=FileName>/usr/local/include/boost/thread/lock_guard.hpp</h4>
<div class=FileNav><a href="#File1512106">&#x2192;</a></div></div>
<table class="code" data-fileid="368900">
<tr class="codeline" data-linenumber="1"><td class="num" id="LN1">1</td><td class="line"><span class='comment'>// Distributed under the Boost Software License, Version 1.0. (See</span></td></tr>
<tr class="codeline" data-linenumber="2"><td class="num" id="LN2">2</td><td class="line"><span class='comment'>// accompanying file LICENSE_1_0.txt or copy at</span></td></tr>
<tr class="codeline" data-linenumber="3"><td class="num" id="LN3">3</td><td class="line"><span class='comment'>// http://www.boost.org/LICENSE_1_0.txt)</span></td></tr>
<tr class="codeline" data-linenumber="4"><td class="num" id="LN4">4</td><td class="line"><span class='comment'>// (C) Copyright 2007 Anthony Williams</span></td></tr>
<tr class="codeline" data-linenumber="5"><td class="num" id="LN5">5</td><td class="line"><span class='comment'>// (C) Copyright 2011-2012 Vicente J. Botet Escriba</span></td></tr>
<tr class="codeline" data-linenumber="6"><td class="num" id="LN6">6</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="7"><td class="num" id="LN7">7</td><td class="line"><span class='directive'>#ifndef BOOST_THREAD_LOCK_GUARD_HPP</span></td></tr>
<tr class="codeline" data-linenumber="8"><td class="num" id="LN8">8</td><td class="line"><span class='directive'>#define BOOST_THREAD_LOCK_GUARD_HPP</span></td></tr>
<tr class="codeline" data-linenumber="9"><td class="num" id="LN9">9</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="10"><td class="num" id="LN10">10</td><td class="line"><span class='directive'>#include &lt;boost/thread/detail/config.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="11"><td class="num" id="LN11">11</td><td class="line"><span class='directive'>#include &lt;boost/thread/detail/delete.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="12"><td class="num" id="LN12">12</td><td class="line"><span class='directive'>#include &lt;boost/thread/detail/move.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="13"><td class="num" id="LN13">13</td><td class="line"><span class='directive'>#include &lt;boost/thread/detail/lockable_wrapper.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="14"><td class="num" id="LN14">14</td><td class="line"><span class='directive'>#include &lt;boost/thread/lock_options.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="15"><td class="num" id="LN15">15</td><td class="line"><span class='directive'>#if ! defined BOOST_THREAD_PROVIDES_NESTED_LOCKS</span></td></tr>
<tr class="codeline" data-linenumber="16"><td class="num" id="LN16">16</td><td class="line"><span class='directive'>#include &lt;boost/thread/is_locked_by_this_thread.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="17"><td class="num" id="LN17">17</td><td class="line"><span class='directive'>#include &lt;boost/assert.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="18"><td class="num" id="LN18">18</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="19"><td class="num" id="LN19">19</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="20"><td class="num" id="LN20">20</td><td class="line"><span class='directive'>#include &lt;boost/config/abi_prefix.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="21"><td class="num" id="LN21">21</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="22"><td class="num" id="LN22">22</td><td class="line"><span class='keyword'>namespace</span> boost</td></tr>
<tr class="codeline" data-linenumber="23"><td class="num" id="LN23">23</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="24"><td class="num" id="LN24">24</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="25"><td class="num" id="LN25">25</td><td class="line">  <span class='keyword'>template</span> &lt;<span class='keyword'>typename</span> Mutex&gt;</td></tr>
<tr class="codeline" data-linenumber="26"><td class="num" id="LN26">26</td><td class="line">  <span class='keyword'>class</span> BOOST_THREAD_SCOPED_CAPABILITY lock_guard</td></tr>
<tr class="codeline" data-linenumber="27"><td class="num" id="LN27">27</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="28"><td class="num" id="LN28">28</td><td class="line">  <span class='keyword'>private</span>:</td></tr>
<tr class="codeline" data-linenumber="29"><td class="num" id="LN29">29</td><td class="line">    Mutex&amp; m;</td></tr>
<tr class="codeline" data-linenumber="30"><td class="num" id="LN30">30</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="31"><td class="num" id="LN31">31</td><td class="line">  <span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="32"><td class="num" id="LN32">32</td><td class="line">    <span class='keyword'>typedef</span> Mutex mutex_type;</td></tr>
<tr class="codeline" data-linenumber="33"><td class="num" id="LN33">33</td><td class="line">    <span class='macro'>BOOST_THREAD_NO_COPYABLE( lock_guard )<span class='macro_popup'>lock_guard(lock_guard const&amp;) = delete; lock_guard&amp; operator<br>=(lock_guard const&amp;) = delete;</span></span></td></tr>
<tr class="codeline" data-linenumber="34"><td class="num" id="LN34">34</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="35"><td class="num" id="LN35">35</td><td class="line">    <span class='keyword'>explicit</span> lock_guard(Mutex&amp; m_) BOOST_THREAD_ACQUIRE(m_) :</td></tr>
<tr class="codeline" data-linenumber="36"><td class="num" id="LN36">36</td><td class="line">      m(m_)</td></tr>
<tr class="codeline" data-linenumber="37"><td class="num" id="LN37">37</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="38"><td class="num" id="LN38">38</td><td class="line">      <span class="mrange"><span class="mrange"><span class="mrange"><span class="mrange"><span class="mrange">m.lock()</span></span></span></span></span>;</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path18" class="msg msgEvent" style="margin-left:7ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">18</div></td><td><div class="PathNav"><a href="#Path17" title="Previous event (17)">&#x2190;</a></div></td><td>Calling 'shared_mutex::lock'</td><td><div class="PathNav"><a href="#Path19" title="Next event (19)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path28" class="msg msgEvent" style="margin-left:7ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">28</div></td><td><div class="PathNav"><a href="#Path27" title="Previous event (27)">&#x2190;</a></div></td><td>Calling 'mutex::lock'</td><td><div class="PathNav"><a href="#Path29" title="Next event (29)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path34" class="msg msgEvent" style="margin-left:7ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">34</div></td><td><div class="PathNav"><a href="#Path33" title="Previous event (33)">&#x2190;</a></div></td><td>Returning from 'mutex::lock'</td><td><div class="PathNav"><a href="#Path35" title="Next event (35)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path44" class="msg msgEvent" style="margin-left:7ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">44</div></td><td><div class="PathNav"><a href="#Path43" title="Previous event (43)">&#x2190;</a></div></td><td>Calling 'mutex::lock'</td><td><div class="PathNav"><a href="#Path45" title="Next event (45)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path50" class="msg msgEvent" style="margin-left:7ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">50</div></td><td><div class="PathNav"><a href="#Path49" title="Previous event (49)">&#x2190;</a></div></td><td>Returning from 'mutex::lock'</td><td><div class="PathNav"><a href="#Path51" title="Next event (51)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="39"><td class="num" id="LN39">39</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="40"><td class="num" id="LN40">40</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="41"><td class="num" id="LN41">41</td><td class="line">    lock_guard(Mutex&amp; m_, adopt_lock_t) BOOST_THREAD_REQUIRES(m_) :</td></tr>
<tr class="codeline" data-linenumber="42"><td class="num" id="LN42">42</td><td class="line">      m(m_)</td></tr>
<tr class="codeline" data-linenumber="43"><td class="num" id="LN43">43</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="44"><td class="num" id="LN44">44</td><td class="line"><span class='directive'>#if ! defined BOOST_THREAD_PROVIDES_NESTED_LOCKS</span></td></tr>
<tr class="codeline" data-linenumber="45"><td class="num" id="LN45">45</td><td class="line">      <span class='macro'>BOOST_ASSERT(is_locked_by_this_thread(m))<span class='macro_popup'>(static_cast &lt;bool&gt; (is_locked_by_this_thread(m)) ? void<br> (0) : __assert_fail ("is_locked_by_this_thread(m)", "/usr/local/include/boost/thread/lock_guard.hpp"<br>, 45, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="46"><td class="num" id="LN46">46</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="47"><td class="num" id="LN47">47</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="48"><td class="num" id="LN48">48</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="49"><td class="num" id="LN49">49</td><td class="line"><span class='directive'>#if ! defined BOOST_THREAD_NO_CXX11_HDR_INITIALIZER_LIST</span></td></tr>
<tr class="codeline" data-linenumber="50"><td class="num" id="LN50">50</td><td class="line">    lock_guard(std::initializer_list&lt;thread_detail::lockable_wrapper&lt;Mutex&gt; &gt; l_) :</td></tr>
<tr class="codeline" data-linenumber="51"><td class="num" id="LN51">51</td><td class="line">      m(*(<span class='keyword'>const_cast</span>&lt;thread_detail::lockable_wrapper&lt;Mutex&gt;*&gt;(l_.begin())-&gt;m))</td></tr>
<tr class="codeline" data-linenumber="52"><td class="num" id="LN52">52</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="53"><td class="num" id="LN53">53</td><td class="line">      m.lock();</td></tr>
<tr class="codeline" data-linenumber="54"><td class="num" id="LN54">54</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="55"><td class="num" id="LN55">55</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="56"><td class="num" id="LN56">56</td><td class="line">    lock_guard(std::initializer_list&lt;thread_detail::lockable_adopt_wrapper&lt;Mutex&gt; &gt; l_) :</td></tr>
<tr class="codeline" data-linenumber="57"><td class="num" id="LN57">57</td><td class="line">      m(*(<span class='keyword'>const_cast</span>&lt;thread_detail::lockable_adopt_wrapper&lt;Mutex&gt;*&gt;(l_.begin())-&gt;m))</td></tr>
<tr class="codeline" data-linenumber="58"><td class="num" id="LN58">58</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="59"><td class="num" id="LN59">59</td><td class="line"><span class='directive'>#if ! defined BOOST_THREAD_PROVIDES_NESTED_LOCKS</span></td></tr>
<tr class="codeline" data-linenumber="60"><td class="num" id="LN60">60</td><td class="line">      <span class='macro'>BOOST_ASSERT(is_locked_by_this_thread(m))<span class='macro_popup'>(static_cast &lt;bool&gt; (is_locked_by_this_thread(m)) ? void<br> (0) : __assert_fail ("is_locked_by_this_thread(m)", "/usr/local/include/boost/thread/lock_guard.hpp"<br>, 60, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="61"><td class="num" id="LN61">61</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="62"><td class="num" id="LN62">62</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="63"><td class="num" id="LN63">63</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="64"><td class="num" id="LN64">64</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="65"><td class="num" id="LN65">65</td><td class="line">    ~lock_guard() BOOST_THREAD_RELEASE()</td></tr>
<tr class="codeline" data-linenumber="66"><td class="num" id="LN66">66</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="67"><td class="num" id="LN67">67</td><td class="line">      m.unlock();</td></tr>
<tr class="codeline" data-linenumber="68"><td class="num" id="LN68">68</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="69"><td class="num" id="LN69">69</td><td class="line">  };</td></tr>
<tr class="codeline" data-linenumber="70"><td class="num" id="LN70">70</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="71"><td class="num" id="LN71">71</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="72"><td class="num" id="LN72">72</td><td class="line"><span class='directive'>#if ! defined BOOST_THREAD_NO_MAKE_LOCK_GUARD</span></td></tr>
<tr class="codeline" data-linenumber="73"><td class="num" id="LN73">73</td><td class="line">  <span class='keyword'>template</span> &lt;<span class='keyword'>typename</span> Lockable&gt;</td></tr>
<tr class="codeline" data-linenumber="74"><td class="num" id="LN74">74</td><td class="line">  lock_guard&lt;Lockable&gt; make_lock_guard(Lockable&amp; mtx)</td></tr>
<tr class="codeline" data-linenumber="75"><td class="num" id="LN75">75</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="76"><td class="num" id="LN76">76</td><td class="line">    <span class='keyword'>return</span> { thread_detail::lockable_wrapper&lt;Lockable&gt;(mtx) };</td></tr>
<tr class="codeline" data-linenumber="77"><td class="num" id="LN77">77</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="78"><td class="num" id="LN78">78</td><td class="line">  <span class='keyword'>template</span> &lt;<span class='keyword'>typename</span> Lockable&gt;</td></tr>
<tr class="codeline" data-linenumber="79"><td class="num" id="LN79">79</td><td class="line">  lock_guard&lt;Lockable&gt; make_lock_guard(Lockable&amp; mtx, adopt_lock_t)</td></tr>
<tr class="codeline" data-linenumber="80"><td class="num" id="LN80">80</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="81"><td class="num" id="LN81">81</td><td class="line">    <span class='keyword'>return</span> { thread_detail::lockable_adopt_wrapper&lt;Lockable&gt;(mtx) };</td></tr>
<tr class="codeline" data-linenumber="82"><td class="num" id="LN82">82</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="83"><td class="num" id="LN83">83</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="84"><td class="num" id="LN84">84</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="85"><td class="num" id="LN85">85</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="86"><td class="num" id="LN86">86</td><td class="line"><span class='directive'>#include &lt;boost/config/abi_suffix.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="87"><td class="num" id="LN87">87</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="88"><td class="num" id="LN88">88</td><td class="line"><span class='directive'>#endif</span></td></tr>
</table><hr class=divider>
<div id=File1512106>
<div class=FileNav><a href="#File368900">&#x2190;</a></div><h4 class=FileName>/usr/local/include/boost/thread/pthread/shared_mutex.hpp</h4>
<div class=FileNav><a href="#File369430">&#x2192;</a></div></div>
<table class="code" data-fileid="1512106">
<tr class="codeline" data-linenumber="1"><td class="num" id="LN1">1</td><td class="line"><span class='directive'>#ifndef BOOST_THREAD_PTHREAD_SHARED_MUTEX_HPP</span></td></tr>
<tr class="codeline" data-linenumber="2"><td class="num" id="LN2">2</td><td class="line"><span class='directive'>#define BOOST_THREAD_PTHREAD_SHARED_MUTEX_HPP</span></td></tr>
<tr class="codeline" data-linenumber="3"><td class="num" id="LN3">3</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4"><td class="num" id="LN4">4</td><td class="line"><span class='comment'>//  (C) Copyright 2006-8 Anthony Williams</span></td></tr>
<tr class="codeline" data-linenumber="5"><td class="num" id="LN5">5</td><td class="line"><span class='comment'>//  (C) Copyright 2012 Vicente J. Botet Escriba</span></td></tr>
<tr class="codeline" data-linenumber="6"><td class="num" id="LN6">6</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="7"><td class="num" id="LN7">7</td><td class="line"><span class='comment'>//  Distributed under the Boost Software License, Version 1.0. (See</span></td></tr>
<tr class="codeline" data-linenumber="8"><td class="num" id="LN8">8</td><td class="line"><span class='comment'>//  accompanying file LICENSE_1_0.txt or copy at</span></td></tr>
<tr class="codeline" data-linenumber="9"><td class="num" id="LN9">9</td><td class="line"><span class='comment'>//  http://www.boost.org/LICENSE_1_0.txt)</span></td></tr>
<tr class="codeline" data-linenumber="10"><td class="num" id="LN10">10</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="11"><td class="num" id="LN11">11</td><td class="line"><span class='directive'>#include &lt;boost/assert.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="12"><td class="num" id="LN12">12</td><td class="line"><span class='directive'>#include &lt;boost/bind/bind.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="13"><td class="num" id="LN13">13</td><td class="line"><span class='directive'>#include &lt;boost/static_assert.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="14"><td class="num" id="LN14">14</td><td class="line"><span class='directive'>#include &lt;boost/thread/mutex.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="15"><td class="num" id="LN15">15</td><td class="line"><span class='directive'>#include &lt;boost/thread/condition_variable.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="16"><td class="num" id="LN16">16</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="17"><td class="num" id="LN17">17</td><td class="line"><span class='directive'>#include &lt;boost/thread/detail/thread_interruption.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="18"><td class="num" id="LN18">18</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="19"><td class="num" id="LN19">19</td><td class="line"><span class='directive'>#ifdef BOOST_THREAD_USES_CHRONO</span></td></tr>
<tr class="codeline" data-linenumber="20"><td class="num" id="LN20">20</td><td class="line"><span class='directive'>#include &lt;boost/chrono/system_clocks.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="21"><td class="num" id="LN21">21</td><td class="line"><span class='directive'>#include &lt;boost/chrono/ceil.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="22"><td class="num" id="LN22">22</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="23"><td class="num" id="LN23">23</td><td class="line"><span class='directive'>#include &lt;boost/thread/detail/delete.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="24"><td class="num" id="LN24">24</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="25"><td class="num" id="LN25">25</td><td class="line"><span class='directive'>#include &lt;boost/config/abi_prefix.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="26"><td class="num" id="LN26">26</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="27"><td class="num" id="LN27">27</td><td class="line"><span class='keyword'>namespace</span> boost</td></tr>
<tr class="codeline" data-linenumber="28"><td class="num" id="LN28">28</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="29"><td class="num" id="LN29">29</td><td class="line">    <span class='keyword'>class</span> shared_mutex</td></tr>
<tr class="codeline" data-linenumber="30"><td class="num" id="LN30">30</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="31"><td class="num" id="LN31">31</td><td class="line">    <span class='keyword'>private</span>:</td></tr>
<tr class="codeline" data-linenumber="32"><td class="num" id="LN32">32</td><td class="line">        <span class='keyword'>class</span> state_data</td></tr>
<tr class="codeline" data-linenumber="33"><td class="num" id="LN33">33</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="34"><td class="num" id="LN34">34</td><td class="line">        <span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="35"><td class="num" id="LN35">35</td><td class="line">            state_data () :</td></tr>
<tr class="codeline" data-linenumber="36"><td class="num" id="LN36">36</td><td class="line">              shared_count(0),</td></tr>
<tr class="codeline" data-linenumber="37"><td class="num" id="LN37">37</td><td class="line">              exclusive(<span class='keyword'>false</span>),</td></tr>
<tr class="codeline" data-linenumber="38"><td class="num" id="LN38">38</td><td class="line">              upgrade(<span class='keyword'>false</span>),</td></tr>
<tr class="codeline" data-linenumber="39"><td class="num" id="LN39">39</td><td class="line">              exclusive_waiting_blocked(<span class='keyword'>false</span>)</td></tr>
<tr class="codeline" data-linenumber="40"><td class="num" id="LN40">40</td><td class="line">            {}</td></tr>
<tr class="codeline" data-linenumber="41"><td class="num" id="LN41">41</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="42"><td class="num" id="LN42">42</td><td class="line">            <span class='keyword'>void</span> assert_free() <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="43"><td class="num" id="LN43">43</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="44"><td class="num" id="LN44">44</td><td class="line">                <span class='macro'>BOOST_ASSERT( ! exclusive )<span class='macro_popup'>(static_cast &lt;bool&gt; (! exclusive) ? void (0) : __assert_fail<br> ("! exclusive", "/usr/local/include/boost/thread/pthread/shared_mutex.hpp"<br>, 44, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="45"><td class="num" id="LN45">45</td><td class="line">                <span class='macro'>BOOST_ASSERT( ! upgrade )<span class='macro_popup'>(static_cast &lt;bool&gt; (! upgrade) ? void (0) : __assert_fail<br> ("! upgrade", "/usr/local/include/boost/thread/pthread/shared_mutex.hpp"<br>, 45, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="46"><td class="num" id="LN46">46</td><td class="line">                <span class='macro'>BOOST_ASSERT( shared_count==0 )<span class='macro_popup'>(static_cast &lt;bool&gt; (shared_count==0) ? void (0) : __assert_fail<br> ("shared_count==0", "/usr/local/include/boost/thread/pthread/shared_mutex.hpp"<br>, 46, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="47"><td class="num" id="LN47">47</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="48"><td class="num" id="LN48">48</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="49"><td class="num" id="LN49">49</td><td class="line">            <span class='keyword'>void</span> assert_locked() <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="50"><td class="num" id="LN50">50</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="51"><td class="num" id="LN51">51</td><td class="line">                <span class='macro'>BOOST_ASSERT( exclusive )<span class='macro_popup'>(static_cast &lt;bool&gt; (exclusive) ? void (0) : __assert_fail<br> ("exclusive", "/usr/local/include/boost/thread/pthread/shared_mutex.hpp"<br>, 51, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="52"><td class="num" id="LN52">52</td><td class="line">                <span class='macro'>BOOST_ASSERT( shared_count==0 )<span class='macro_popup'>(static_cast &lt;bool&gt; (shared_count==0) ? void (0) : __assert_fail<br> ("shared_count==0", "/usr/local/include/boost/thread/pthread/shared_mutex.hpp"<br>, 52, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="53"><td class="num" id="LN53">53</td><td class="line">                <span class='macro'>BOOST_ASSERT( ! upgrade )<span class='macro_popup'>(static_cast &lt;bool&gt; (! upgrade) ? void (0) : __assert_fail<br> ("! upgrade", "/usr/local/include/boost/thread/pthread/shared_mutex.hpp"<br>, 53, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="54"><td class="num" id="LN54">54</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="55"><td class="num" id="LN55">55</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="56"><td class="num" id="LN56">56</td><td class="line">            <span class='keyword'>void</span> assert_lock_shared () <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="57"><td class="num" id="LN57">57</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="58"><td class="num" id="LN58">58</td><td class="line">                <span class='macro'>BOOST_ASSERT( ! exclusive )<span class='macro_popup'>(static_cast &lt;bool&gt; (! exclusive) ? void (0) : __assert_fail<br> ("! exclusive", "/usr/local/include/boost/thread/pthread/shared_mutex.hpp"<br>, 58, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="59"><td class="num" id="LN59">59</td><td class="line">                <span class='macro'>BOOST_ASSERT( shared_count&gt;0 )<span class='macro_popup'>(static_cast &lt;bool&gt; (shared_count&gt;0) ? void (0) : __assert_fail<br> ("shared_count&gt;0", "/usr/local/include/boost/thread/pthread/shared_mutex.hpp"<br>, 59, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="60"><td class="num" id="LN60">60</td><td class="line">                <span class='comment'>//BOOST_ASSERT( (! upgrade) || (shared_count&gt;1));</span></td></tr>
<tr class="codeline" data-linenumber="61"><td class="num" id="LN61">61</td><td class="line">                <span class='comment'>// if upgraded there are at least 2 threads sharing the mutex,</span></td></tr>
<tr class="codeline" data-linenumber="62"><td class="num" id="LN62">62</td><td class="line">                <span class='comment'>// except when unlock_upgrade_and_lock has decreased the number of readers but has not taken yet exclusive ownership.</span></td></tr>
<tr class="codeline" data-linenumber="63"><td class="num" id="LN63">63</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="64"><td class="num" id="LN64">64</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="65"><td class="num" id="LN65">65</td><td class="line">            <span class='keyword'>void</span> assert_lock_upgraded () <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="66"><td class="num" id="LN66">66</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="67"><td class="num" id="LN67">67</td><td class="line">                <span class='macro'>BOOST_ASSERT( ! exclusive )<span class='macro_popup'>(static_cast &lt;bool&gt; (! exclusive) ? void (0) : __assert_fail<br> ("! exclusive", "/usr/local/include/boost/thread/pthread/shared_mutex.hpp"<br>, 67, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="68"><td class="num" id="LN68">68</td><td class="line">                <span class='macro'>BOOST_ASSERT(  upgrade )<span class='macro_popup'>(static_cast &lt;bool&gt; (upgrade) ? void (0) : __assert_fail<br> ("upgrade", "/usr/local/include/boost/thread/pthread/shared_mutex.hpp"<br>, 68, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="69"><td class="num" id="LN69">69</td><td class="line">                <span class='macro'>BOOST_ASSERT(  shared_count&gt;0 )<span class='macro_popup'>(static_cast &lt;bool&gt; (shared_count&gt;0) ? void (0) : __assert_fail<br> ("shared_count&gt;0", "/usr/local/include/boost/thread/pthread/shared_mutex.hpp"<br>, 69, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="70"><td class="num" id="LN70">70</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="71"><td class="num" id="LN71">71</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="72"><td class="num" id="LN72">72</td><td class="line">            <span class='keyword'>void</span> assert_lock_not_upgraded () <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="73"><td class="num" id="LN73">73</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="74"><td class="num" id="LN74">74</td><td class="line">                <span class='macro'>BOOST_ASSERT(  ! upgrade )<span class='macro_popup'>(static_cast &lt;bool&gt; (! upgrade) ? void (0) : __assert_fail<br> ("! upgrade", "/usr/local/include/boost/thread/pthread/shared_mutex.hpp"<br>, 74, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="75"><td class="num" id="LN75">75</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="76"><td class="num" id="LN76">76</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="77"><td class="num" id="LN77">77</td><td class="line">            <span class='keyword'>bool</span> can_lock () <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="78"><td class="num" id="LN78">78</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="79"><td class="num" id="LN79">79</td><td class="line">                <span class='keyword'>return</span> ! (shared_count || exclusive);</td></tr>
<tr class="codeline" data-linenumber="80"><td class="num" id="LN80">80</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="81"><td class="num" id="LN81">81</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="82"><td class="num" id="LN82">82</td><td class="line">            <span class='keyword'>void</span> lock ()</td></tr>
<tr class="codeline" data-linenumber="83"><td class="num" id="LN83">83</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="84"><td class="num" id="LN84">84</td><td class="line">                exclusive = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="85"><td class="num" id="LN85">85</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="86"><td class="num" id="LN86">86</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="87"><td class="num" id="LN87">87</td><td class="line">            <span class='keyword'>void</span> unlock ()</td></tr>
<tr class="codeline" data-linenumber="88"><td class="num" id="LN88">88</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="89"><td class="num" id="LN89">89</td><td class="line">                exclusive = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="90"><td class="num" id="LN90">90</td><td class="line">                exclusive_waiting_blocked = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="91"><td class="num" id="LN91">91</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="92"><td class="num" id="LN92">92</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="93"><td class="num" id="LN93">93</td><td class="line">            <span class='keyword'>bool</span> can_lock_shared () <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="94"><td class="num" id="LN94">94</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="95"><td class="num" id="LN95">95</td><td class="line">                <span class='keyword'>return</span> ! (exclusive || exclusive_waiting_blocked);</td></tr>
<tr class="codeline" data-linenumber="96"><td class="num" id="LN96">96</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="97"><td class="num" id="LN97">97</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="98"><td class="num" id="LN98">98</td><td class="line">            <span class='keyword'>bool</span> no_shared () <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="99"><td class="num" id="LN99">99</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="100"><td class="num" id="LN100">100</td><td class="line">                <span class='keyword'>return</span> shared_count==0;</td></tr>
<tr class="codeline" data-linenumber="101"><td class="num" id="LN101">101</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="102"><td class="num" id="LN102">102</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="103"><td class="num" id="LN103">103</td><td class="line">            <span class='keyword'>bool</span> one_shared () <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="104"><td class="num" id="LN104">104</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="105"><td class="num" id="LN105">105</td><td class="line">                <span class='keyword'>return</span> shared_count==1;</td></tr>
<tr class="codeline" data-linenumber="106"><td class="num" id="LN106">106</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="107"><td class="num" id="LN107">107</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="108"><td class="num" id="LN108">108</td><td class="line">            <span class='keyword'>void</span> lock_shared ()</td></tr>
<tr class="codeline" data-linenumber="109"><td class="num" id="LN109">109</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="110"><td class="num" id="LN110">110</td><td class="line">                ++shared_count;</td></tr>
<tr class="codeline" data-linenumber="111"><td class="num" id="LN111">111</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="112"><td class="num" id="LN112">112</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="113"><td class="num" id="LN113">113</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="114"><td class="num" id="LN114">114</td><td class="line">            <span class='keyword'>void</span> unlock_shared ()</td></tr>
<tr class="codeline" data-linenumber="115"><td class="num" id="LN115">115</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="116"><td class="num" id="LN116">116</td><td class="line">                --shared_count;</td></tr>
<tr class="codeline" data-linenumber="117"><td class="num" id="LN117">117</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="118"><td class="num" id="LN118">118</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="119"><td class="num" id="LN119">119</td><td class="line">            <span class='keyword'>void</span> lock_upgrade ()</td></tr>
<tr class="codeline" data-linenumber="120"><td class="num" id="LN120">120</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="121"><td class="num" id="LN121">121</td><td class="line">                ++shared_count;</td></tr>
<tr class="codeline" data-linenumber="122"><td class="num" id="LN122">122</td><td class="line">                upgrade=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="123"><td class="num" id="LN123">123</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="124"><td class="num" id="LN124">124</td><td class="line">            <span class='keyword'>bool</span> can_lock_upgrade () <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="125"><td class="num" id="LN125">125</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="126"><td class="num" id="LN126">126</td><td class="line">                <span class='keyword'>return</span> ! (exclusive || exclusive_waiting_blocked || upgrade);</td></tr>
<tr class="codeline" data-linenumber="127"><td class="num" id="LN127">127</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="128"><td class="num" id="LN128">128</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="129"><td class="num" id="LN129">129</td><td class="line">            <span class='keyword'>void</span> unlock_upgrade ()</td></tr>
<tr class="codeline" data-linenumber="130"><td class="num" id="LN130">130</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="131"><td class="num" id="LN131">131</td><td class="line">                upgrade=<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="132"><td class="num" id="LN132">132</td><td class="line">                --shared_count;</td></tr>
<tr class="codeline" data-linenumber="133"><td class="num" id="LN133">133</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="134"><td class="num" id="LN134">134</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="135"><td class="num" id="LN135">135</td><td class="line">        <span class='comment'>//private:</span></td></tr>
<tr class="codeline" data-linenumber="136"><td class="num" id="LN136">136</td><td class="line">            <span class='keyword'>unsigned</span> shared_count;</td></tr>
<tr class="codeline" data-linenumber="137"><td class="num" id="LN137">137</td><td class="line">            <span class='keyword'>bool</span> exclusive;</td></tr>
<tr class="codeline" data-linenumber="138"><td class="num" id="LN138">138</td><td class="line">            <span class='keyword'>bool</span> upgrade;</td></tr>
<tr class="codeline" data-linenumber="139"><td class="num" id="LN139">139</td><td class="line">            <span class='keyword'>bool</span> exclusive_waiting_blocked;</td></tr>
<tr class="codeline" data-linenumber="140"><td class="num" id="LN140">140</td><td class="line">        };</td></tr>
<tr class="codeline" data-linenumber="141"><td class="num" id="LN141">141</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="142"><td class="num" id="LN142">142</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="143"><td class="num" id="LN143">143</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="144"><td class="num" id="LN144">144</td><td class="line">        state_data state;</td></tr>
<tr class="codeline" data-linenumber="145"><td class="num" id="LN145">145</td><td class="line">        boost::mutex state_change;</td></tr>
<tr class="codeline" data-linenumber="146"><td class="num" id="LN146">146</td><td class="line">        boost::condition_variable shared_cond;</td></tr>
<tr class="codeline" data-linenumber="147"><td class="num" id="LN147">147</td><td class="line">        boost::condition_variable exclusive_cond;</td></tr>
<tr class="codeline" data-linenumber="148"><td class="num" id="LN148">148</td><td class="line">        boost::condition_variable upgrade_cond;</td></tr>
<tr class="codeline" data-linenumber="149"><td class="num" id="LN149">149</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="150"><td class="num" id="LN150">150</td><td class="line">        <span class='keyword'>void</span> release_waiters()</td></tr>
<tr class="codeline" data-linenumber="151"><td class="num" id="LN151">151</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="152"><td class="num" id="LN152">152</td><td class="line">            exclusive_cond.notify_one();</td></tr>
<tr class="codeline" data-linenumber="153"><td class="num" id="LN153">153</td><td class="line">            shared_cond.notify_all();</td></tr>
<tr class="codeline" data-linenumber="154"><td class="num" id="LN154">154</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="155"><td class="num" id="LN155">155</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="156"><td class="num" id="LN156">156</td><td class="line">    <span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="157"><td class="num" id="LN157">157</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="158"><td class="num" id="LN158">158</td><td class="line">        <span class='macro'>BOOST_THREAD_NO_COPYABLE(shared_mutex)<span class='macro_popup'>shared_mutex(shared_mutex const&amp;) = delete; shared_mutex&amp;<br> operator=(shared_mutex const&amp;) = delete;</span></span></td></tr>
<tr class="codeline" data-linenumber="159"><td class="num" id="LN159">159</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="160"><td class="num" id="LN160">160</td><td class="line">        shared_mutex()</td></tr>
<tr class="codeline" data-linenumber="161"><td class="num" id="LN161">161</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="162"><td class="num" id="LN162">162</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="163"><td class="num" id="LN163">163</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="164"><td class="num" id="LN164">164</td><td class="line">        ~shared_mutex()</td></tr>
<tr class="codeline" data-linenumber="165"><td class="num" id="LN165">165</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="166"><td class="num" id="LN166">166</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="167"><td class="num" id="LN167">167</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="168"><td class="num" id="LN168">168</td><td class="line">        <span class='keyword'>void</span> lock_shared()</td></tr>
<tr class="codeline" data-linenumber="169"><td class="num" id="LN169">169</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="170"><td class="num" id="LN170">170</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="171"><td class="num" id="LN171">171</td><td class="line">            boost::this_thread::disable_interruption do_not_disturb;</td></tr>
<tr class="codeline" data-linenumber="172"><td class="num" id="LN172">172</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="173"><td class="num" id="LN173">173</td><td class="line">            boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="174"><td class="num" id="LN174">174</td><td class="line">            shared_cond.wait(lk, boost::bind(&amp;state_data::can_lock_shared, boost::ref(state)));</td></tr>
<tr class="codeline" data-linenumber="175"><td class="num" id="LN175">175</td><td class="line">            state.lock_shared();</td></tr>
<tr class="codeline" data-linenumber="176"><td class="num" id="LN176">176</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="177"><td class="num" id="LN177">177</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="178"><td class="num" id="LN178">178</td><td class="line">        <span class='keyword'>bool</span> try_lock_shared()</td></tr>
<tr class="codeline" data-linenumber="179"><td class="num" id="LN179">179</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="180"><td class="num" id="LN180">180</td><td class="line">            boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="181"><td class="num" id="LN181">181</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="182"><td class="num" id="LN182">182</td><td class="line">            <span class='keyword'>if</span>(!state.can_lock_shared())</td></tr>
<tr class="codeline" data-linenumber="183"><td class="num" id="LN183">183</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="184"><td class="num" id="LN184">184</td><td class="line">                <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="185"><td class="num" id="LN185">185</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="186"><td class="num" id="LN186">186</td><td class="line">            state.lock_shared();</td></tr>
<tr class="codeline" data-linenumber="187"><td class="num" id="LN187">187</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="188"><td class="num" id="LN188">188</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="189"><td class="num" id="LN189">189</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="190"><td class="num" id="LN190">190</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_USES_DATETIME</span></td></tr>
<tr class="codeline" data-linenumber="191"><td class="num" id="LN191">191</td><td class="line">        <span class='keyword'>bool</span> timed_lock_shared(system_time <span class='keyword'>const</span>&amp; timeout)</td></tr>
<tr class="codeline" data-linenumber="192"><td class="num" id="LN192">192</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="193"><td class="num" id="LN193">193</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="194"><td class="num" id="LN194">194</td><td class="line">            boost::this_thread::disable_interruption do_not_disturb;</td></tr>
<tr class="codeline" data-linenumber="195"><td class="num" id="LN195">195</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="196"><td class="num" id="LN196">196</td><td class="line">            boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="197"><td class="num" id="LN197">197</td><td class="line">            <span class='keyword'>if</span>(!shared_cond.timed_wait(lk, timeout, boost::bind(&amp;state_data::can_lock_shared, boost::ref(state))))</td></tr>
<tr class="codeline" data-linenumber="198"><td class="num" id="LN198">198</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="199"><td class="num" id="LN199">199</td><td class="line">                <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="200"><td class="num" id="LN200">200</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="201"><td class="num" id="LN201">201</td><td class="line">            state.lock_shared();</td></tr>
<tr class="codeline" data-linenumber="202"><td class="num" id="LN202">202</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="203"><td class="num" id="LN203">203</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="204"><td class="num" id="LN204">204</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="205"><td class="num" id="LN205">205</td><td class="line">        <span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> TimeDuration&gt;</td></tr>
<tr class="codeline" data-linenumber="206"><td class="num" id="LN206">206</td><td class="line">        <span class='keyword'>bool</span> timed_lock_shared(TimeDuration <span class='keyword'>const</span> &amp; relative_time)</td></tr>
<tr class="codeline" data-linenumber="207"><td class="num" id="LN207">207</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="208"><td class="num" id="LN208">208</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="209"><td class="num" id="LN209">209</td><td class="line">            boost::this_thread::disable_interruption do_not_disturb;</td></tr>
<tr class="codeline" data-linenumber="210"><td class="num" id="LN210">210</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="211"><td class="num" id="LN211">211</td><td class="line">            boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="212"><td class="num" id="LN212">212</td><td class="line">            <span class='keyword'>if</span>(!shared_cond.timed_wait(lk, relative_time, boost::bind(&amp;state_data::can_lock_shared, boost::ref(state))))</td></tr>
<tr class="codeline" data-linenumber="213"><td class="num" id="LN213">213</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="214"><td class="num" id="LN214">214</td><td class="line">                <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="215"><td class="num" id="LN215">215</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="216"><td class="num" id="LN216">216</td><td class="line">            state.lock_shared();</td></tr>
<tr class="codeline" data-linenumber="217"><td class="num" id="LN217">217</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="218"><td class="num" id="LN218">218</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="219"><td class="num" id="LN219">219</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="220"><td class="num" id="LN220">220</td><td class="line"><span class='directive'>#ifdef BOOST_THREAD_USES_CHRONO</span></td></tr>
<tr class="codeline" data-linenumber="221"><td class="num" id="LN221">221</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Rep, <span class='keyword'>class</span> Period&gt;</td></tr>
<tr class="codeline" data-linenumber="222"><td class="num" id="LN222">222</td><td class="line">        <span class='keyword'>bool</span> try_lock_shared_for(<span class='keyword'>const</span> chrono::duration&lt;Rep, Period&gt;&amp; rel_time)</td></tr>
<tr class="codeline" data-linenumber="223"><td class="num" id="LN223">223</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="224"><td class="num" id="LN224">224</td><td class="line">          <span class='keyword'>return</span> try_lock_shared_until(chrono::steady_clock::now() + rel_time);</td></tr>
<tr class="codeline" data-linenumber="225"><td class="num" id="LN225">225</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="226"><td class="num" id="LN226">226</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Clock, <span class='keyword'>class</span> Duration&gt;</td></tr>
<tr class="codeline" data-linenumber="227"><td class="num" id="LN227">227</td><td class="line">        <span class='keyword'>bool</span> try_lock_shared_until(<span class='keyword'>const</span> chrono::time_point&lt;Clock, Duration&gt;&amp; abs_time)</td></tr>
<tr class="codeline" data-linenumber="228"><td class="num" id="LN228">228</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="229"><td class="num" id="LN229">229</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="230"><td class="num" id="LN230">230</td><td class="line">          boost::this_thread::disable_interruption do_not_disturb;</td></tr>
<tr class="codeline" data-linenumber="231"><td class="num" id="LN231">231</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="232"><td class="num" id="LN232">232</td><td class="line">          boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="233"><td class="num" id="LN233">233</td><td class="line">          <span class='keyword'>if</span>(!shared_cond.wait_until(lk, abs_time, boost::bind(&amp;state_data::can_lock_shared, boost::ref(state))))</td></tr>
<tr class="codeline" data-linenumber="234"><td class="num" id="LN234">234</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="235"><td class="num" id="LN235">235</td><td class="line">              <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="236"><td class="num" id="LN236">236</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="237"><td class="num" id="LN237">237</td><td class="line">          state.lock_shared();</td></tr>
<tr class="codeline" data-linenumber="238"><td class="num" id="LN238">238</td><td class="line">          <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="239"><td class="num" id="LN239">239</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="240"><td class="num" id="LN240">240</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="241"><td class="num" id="LN241">241</td><td class="line">        <span class='keyword'>void</span> unlock_shared()</td></tr>
<tr class="codeline" data-linenumber="242"><td class="num" id="LN242">242</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="243"><td class="num" id="LN243">243</td><td class="line">            boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="244"><td class="num" id="LN244">244</td><td class="line">            state.assert_lock_shared();</td></tr>
<tr class="codeline" data-linenumber="245"><td class="num" id="LN245">245</td><td class="line">            state.unlock_shared();</td></tr>
<tr class="codeline" data-linenumber="246"><td class="num" id="LN246">246</td><td class="line">            <span class='keyword'>if</span> (state.no_shared())</td></tr>
<tr class="codeline" data-linenumber="247"><td class="num" id="LN247">247</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="248"><td class="num" id="LN248">248</td><td class="line">                <span class='keyword'>if</span> (state.upgrade)</td></tr>
<tr class="codeline" data-linenumber="249"><td class="num" id="LN249">249</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="250"><td class="num" id="LN250">250</td><td class="line">                    <span class='comment'>// As there is a thread doing a unlock_upgrade_and_lock that is waiting for state.no_shared()</span></td></tr>
<tr class="codeline" data-linenumber="251"><td class="num" id="LN251">251</td><td class="line">                    <span class='comment'>// avoid other threads to lock, lock_upgrade or lock_shared, so only this thread is notified.</span></td></tr>
<tr class="codeline" data-linenumber="252"><td class="num" id="LN252">252</td><td class="line">                    state.upgrade=<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="253"><td class="num" id="LN253">253</td><td class="line">                    state.exclusive=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="254"><td class="num" id="LN254">254</td><td class="line">                    <span class='comment'>//lk.unlock();</span></td></tr>
<tr class="codeline" data-linenumber="255"><td class="num" id="LN255">255</td><td class="line">                    upgrade_cond.notify_one();</td></tr>
<tr class="codeline" data-linenumber="256"><td class="num" id="LN256">256</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="257"><td class="num" id="LN257">257</td><td class="line">                <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="258"><td class="num" id="LN258">258</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="259"><td class="num" id="LN259">259</td><td class="line">                    state.exclusive_waiting_blocked=<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="260"><td class="num" id="LN260">260</td><td class="line">                    <span class='comment'>//lk.unlock();</span></td></tr>
<tr class="codeline" data-linenumber="261"><td class="num" id="LN261">261</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="262"><td class="num" id="LN262">262</td><td class="line">                release_waiters();</td></tr>
<tr class="codeline" data-linenumber="263"><td class="num" id="LN263">263</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="264"><td class="num" id="LN264">264</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="265"><td class="num" id="LN265">265</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="266"><td class="num" id="LN266">266</td><td class="line">        <span class='keyword'>void</span> lock()</td></tr>
<tr class="codeline" data-linenumber="267"><td class="num" id="LN267">267</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="268"><td class="num" id="LN268">268</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="269"><td class="num" id="LN269">269</td><td class="line">            boost::this_thread::disable_interruption do_not_disturb;</td></tr>
<tr class="codeline" data-linenumber="270"><td class="num" id="LN270">270</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="271"><td class="num" id="LN271">271</td><td class="line">            boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="272"><td class="num" id="LN272">272</td><td class="line">            state.exclusive_waiting_blocked=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="273"><td class="num" id="LN273">273</td><td class="line">            <span class="mrange">exclusive_cond.wait(lk, boost::bind(&amp;state_data::can_lock, boost::ref(state)))</span>;</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path19" class="msg msgEvent" style="margin-left:13ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">19</div></td><td><div class="PathNav"><a href="#Path18" title="Previous event (18)">&#x2190;</a></div></td><td>Calling 'condition_variable::wait'</td><td><div class="PathNav"><a href="#Path20" title="Next event (20)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="274"><td class="num" id="LN274">274</td><td class="line">            state.exclusive=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="275"><td class="num" id="LN275">275</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="276"><td class="num" id="LN276">276</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="277"><td class="num" id="LN277">277</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_USES_DATETIME</span></td></tr>
<tr class="codeline" data-linenumber="278"><td class="num" id="LN278">278</td><td class="line">        <span class='keyword'>bool</span> timed_lock(system_time <span class='keyword'>const</span>&amp; timeout)</td></tr>
<tr class="codeline" data-linenumber="279"><td class="num" id="LN279">279</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="280"><td class="num" id="LN280">280</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="281"><td class="num" id="LN281">281</td><td class="line">            boost::this_thread::disable_interruption do_not_disturb;</td></tr>
<tr class="codeline" data-linenumber="282"><td class="num" id="LN282">282</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="283"><td class="num" id="LN283">283</td><td class="line">            boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="284"><td class="num" id="LN284">284</td><td class="line">            state.exclusive_waiting_blocked=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="285"><td class="num" id="LN285">285</td><td class="line">            <span class='keyword'>if</span>(!exclusive_cond.timed_wait(lk, timeout, boost::bind(&amp;state_data::can_lock, boost::ref(state))))</td></tr>
<tr class="codeline" data-linenumber="286"><td class="num" id="LN286">286</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="287"><td class="num" id="LN287">287</td><td class="line">                state.exclusive_waiting_blocked=<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="288"><td class="num" id="LN288">288</td><td class="line">                release_waiters();</td></tr>
<tr class="codeline" data-linenumber="289"><td class="num" id="LN289">289</td><td class="line">                <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="290"><td class="num" id="LN290">290</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="291"><td class="num" id="LN291">291</td><td class="line">            state.exclusive=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="292"><td class="num" id="LN292">292</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="293"><td class="num" id="LN293">293</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="294"><td class="num" id="LN294">294</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="295"><td class="num" id="LN295">295</td><td class="line">        <span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> TimeDuration&gt;</td></tr>
<tr class="codeline" data-linenumber="296"><td class="num" id="LN296">296</td><td class="line">        <span class='keyword'>bool</span> timed_lock(TimeDuration <span class='keyword'>const</span> &amp; relative_time)</td></tr>
<tr class="codeline" data-linenumber="297"><td class="num" id="LN297">297</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="298"><td class="num" id="LN298">298</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="299"><td class="num" id="LN299">299</td><td class="line">            boost::this_thread::disable_interruption do_not_disturb;</td></tr>
<tr class="codeline" data-linenumber="300"><td class="num" id="LN300">300</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="301"><td class="num" id="LN301">301</td><td class="line">            boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="302"><td class="num" id="LN302">302</td><td class="line">            state.exclusive_waiting_blocked=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="303"><td class="num" id="LN303">303</td><td class="line">            <span class='keyword'>if</span>(!exclusive_cond.timed_wait(lk, relative_time, boost::bind(&amp;state_data::can_lock, boost::ref(state))))</td></tr>
<tr class="codeline" data-linenumber="304"><td class="num" id="LN304">304</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="305"><td class="num" id="LN305">305</td><td class="line">                state.exclusive_waiting_blocked=<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="306"><td class="num" id="LN306">306</td><td class="line">                release_waiters();</td></tr>
<tr class="codeline" data-linenumber="307"><td class="num" id="LN307">307</td><td class="line">                <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="308"><td class="num" id="LN308">308</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="309"><td class="num" id="LN309">309</td><td class="line">            state.exclusive=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="310"><td class="num" id="LN310">310</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="311"><td class="num" id="LN311">311</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="312"><td class="num" id="LN312">312</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="313"><td class="num" id="LN313">313</td><td class="line"><span class='directive'>#ifdef BOOST_THREAD_USES_CHRONO</span></td></tr>
<tr class="codeline" data-linenumber="314"><td class="num" id="LN314">314</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Rep, <span class='keyword'>class</span> Period&gt;</td></tr>
<tr class="codeline" data-linenumber="315"><td class="num" id="LN315">315</td><td class="line">        <span class='keyword'>bool</span> try_lock_for(<span class='keyword'>const</span> chrono::duration&lt;Rep, Period&gt;&amp; rel_time)</td></tr>
<tr class="codeline" data-linenumber="316"><td class="num" id="LN316">316</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="317"><td class="num" id="LN317">317</td><td class="line">          <span class='keyword'>return</span> try_lock_until(chrono::steady_clock::now() + rel_time);</td></tr>
<tr class="codeline" data-linenumber="318"><td class="num" id="LN318">318</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="319"><td class="num" id="LN319">319</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Clock, <span class='keyword'>class</span> Duration&gt;</td></tr>
<tr class="codeline" data-linenumber="320"><td class="num" id="LN320">320</td><td class="line">        <span class='keyword'>bool</span> try_lock_until(<span class='keyword'>const</span> chrono::time_point&lt;Clock, Duration&gt;&amp; abs_time)</td></tr>
<tr class="codeline" data-linenumber="321"><td class="num" id="LN321">321</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="322"><td class="num" id="LN322">322</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="323"><td class="num" id="LN323">323</td><td class="line">          boost::this_thread::disable_interruption do_not_disturb;</td></tr>
<tr class="codeline" data-linenumber="324"><td class="num" id="LN324">324</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="325"><td class="num" id="LN325">325</td><td class="line">          boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="326"><td class="num" id="LN326">326</td><td class="line">          state.exclusive_waiting_blocked=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="327"><td class="num" id="LN327">327</td><td class="line">          <span class='keyword'>if</span>(!exclusive_cond.wait_until(lk, abs_time, boost::bind(&amp;state_data::can_lock, boost::ref(state))))</td></tr>
<tr class="codeline" data-linenumber="328"><td class="num" id="LN328">328</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="329"><td class="num" id="LN329">329</td><td class="line">              state.exclusive_waiting_blocked=<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="330"><td class="num" id="LN330">330</td><td class="line">              release_waiters();</td></tr>
<tr class="codeline" data-linenumber="331"><td class="num" id="LN331">331</td><td class="line">              <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="332"><td class="num" id="LN332">332</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="333"><td class="num" id="LN333">333</td><td class="line">          state.exclusive=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="334"><td class="num" id="LN334">334</td><td class="line">          <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="335"><td class="num" id="LN335">335</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="336"><td class="num" id="LN336">336</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="337"><td class="num" id="LN337">337</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="338"><td class="num" id="LN338">338</td><td class="line">        <span class='keyword'>bool</span> try_lock()</td></tr>
<tr class="codeline" data-linenumber="339"><td class="num" id="LN339">339</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="340"><td class="num" id="LN340">340</td><td class="line">            boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="341"><td class="num" id="LN341">341</td><td class="line">            <span class='keyword'>if</span>(!state.can_lock())</td></tr>
<tr class="codeline" data-linenumber="342"><td class="num" id="LN342">342</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="343"><td class="num" id="LN343">343</td><td class="line">                <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="344"><td class="num" id="LN344">344</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="345"><td class="num" id="LN345">345</td><td class="line">            state.exclusive=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="346"><td class="num" id="LN346">346</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="347"><td class="num" id="LN347">347</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="348"><td class="num" id="LN348">348</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="349"><td class="num" id="LN349">349</td><td class="line">        <span class='keyword'>void</span> unlock()</td></tr>
<tr class="codeline" data-linenumber="350"><td class="num" id="LN350">350</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="351"><td class="num" id="LN351">351</td><td class="line">            boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="352"><td class="num" id="LN352">352</td><td class="line">            state.assert_locked();</td></tr>
<tr class="codeline" data-linenumber="353"><td class="num" id="LN353">353</td><td class="line">            state.exclusive=<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="354"><td class="num" id="LN354">354</td><td class="line">            state.exclusive_waiting_blocked=<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="355"><td class="num" id="LN355">355</td><td class="line">            state.assert_free();</td></tr>
<tr class="codeline" data-linenumber="356"><td class="num" id="LN356">356</td><td class="line">            release_waiters();</td></tr>
<tr class="codeline" data-linenumber="357"><td class="num" id="LN357">357</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="358"><td class="num" id="LN358">358</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="359"><td class="num" id="LN359">359</td><td class="line">        <span class='keyword'>void</span> lock_upgrade()</td></tr>
<tr class="codeline" data-linenumber="360"><td class="num" id="LN360">360</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="361"><td class="num" id="LN361">361</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="362"><td class="num" id="LN362">362</td><td class="line">            boost::this_thread::disable_interruption do_not_disturb;</td></tr>
<tr class="codeline" data-linenumber="363"><td class="num" id="LN363">363</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="364"><td class="num" id="LN364">364</td><td class="line">            boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="365"><td class="num" id="LN365">365</td><td class="line">            shared_cond.wait(lk, boost::bind(&amp;state_data::can_lock_upgrade, boost::ref(state)));</td></tr>
<tr class="codeline" data-linenumber="366"><td class="num" id="LN366">366</td><td class="line">            state.lock_shared();</td></tr>
<tr class="codeline" data-linenumber="367"><td class="num" id="LN367">367</td><td class="line">            state.upgrade=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="368"><td class="num" id="LN368">368</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="369"><td class="num" id="LN369">369</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="370"><td class="num" id="LN370">370</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_USES_DATETIME</span></td></tr>
<tr class="codeline" data-linenumber="371"><td class="num" id="LN371">371</td><td class="line">        <span class='keyword'>bool</span> timed_lock_upgrade(system_time <span class='keyword'>const</span>&amp; timeout)</td></tr>
<tr class="codeline" data-linenumber="372"><td class="num" id="LN372">372</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="373"><td class="num" id="LN373">373</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="374"><td class="num" id="LN374">374</td><td class="line">            boost::this_thread::disable_interruption do_not_disturb;</td></tr>
<tr class="codeline" data-linenumber="375"><td class="num" id="LN375">375</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="376"><td class="num" id="LN376">376</td><td class="line">            boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="377"><td class="num" id="LN377">377</td><td class="line">            <span class='keyword'>if</span>(!shared_cond.timed_wait(lk, timeout, boost::bind(&amp;state_data::can_lock_upgrade, boost::ref(state))))</td></tr>
<tr class="codeline" data-linenumber="378"><td class="num" id="LN378">378</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="379"><td class="num" id="LN379">379</td><td class="line">                <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="380"><td class="num" id="LN380">380</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="381"><td class="num" id="LN381">381</td><td class="line">            state.lock_shared();</td></tr>
<tr class="codeline" data-linenumber="382"><td class="num" id="LN382">382</td><td class="line">            state.upgrade=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="383"><td class="num" id="LN383">383</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="384"><td class="num" id="LN384">384</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="385"><td class="num" id="LN385">385</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="386"><td class="num" id="LN386">386</td><td class="line">        <span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> TimeDuration&gt;</td></tr>
<tr class="codeline" data-linenumber="387"><td class="num" id="LN387">387</td><td class="line">        <span class='keyword'>bool</span> timed_lock_upgrade(TimeDuration <span class='keyword'>const</span> &amp; relative_time)</td></tr>
<tr class="codeline" data-linenumber="388"><td class="num" id="LN388">388</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="389"><td class="num" id="LN389">389</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="390"><td class="num" id="LN390">390</td><td class="line">            boost::this_thread::disable_interruption do_not_disturb;</td></tr>
<tr class="codeline" data-linenumber="391"><td class="num" id="LN391">391</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="392"><td class="num" id="LN392">392</td><td class="line">            boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="393"><td class="num" id="LN393">393</td><td class="line">            <span class='keyword'>if</span>(!shared_cond.timed_wait(lk, relative_time, boost::bind(&amp;state_data::can_lock_upgrade, boost::ref(state))))</td></tr>
<tr class="codeline" data-linenumber="394"><td class="num" id="LN394">394</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="395"><td class="num" id="LN395">395</td><td class="line">                <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="396"><td class="num" id="LN396">396</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="397"><td class="num" id="LN397">397</td><td class="line">            state.lock_shared();</td></tr>
<tr class="codeline" data-linenumber="398"><td class="num" id="LN398">398</td><td class="line">            state.upgrade=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="399"><td class="num" id="LN399">399</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="400"><td class="num" id="LN400">400</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="401"><td class="num" id="LN401">401</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="402"><td class="num" id="LN402">402</td><td class="line"><span class='directive'>#ifdef BOOST_THREAD_USES_CHRONO</span></td></tr>
<tr class="codeline" data-linenumber="403"><td class="num" id="LN403">403</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Rep, <span class='keyword'>class</span> Period&gt;</td></tr>
<tr class="codeline" data-linenumber="404"><td class="num" id="LN404">404</td><td class="line">        <span class='keyword'>bool</span> try_lock_upgrade_for(<span class='keyword'>const</span> chrono::duration&lt;Rep, Period&gt;&amp; rel_time)</td></tr>
<tr class="codeline" data-linenumber="405"><td class="num" id="LN405">405</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="406"><td class="num" id="LN406">406</td><td class="line">          <span class='keyword'>return</span> try_lock_upgrade_until(chrono::steady_clock::now() + rel_time);</td></tr>
<tr class="codeline" data-linenumber="407"><td class="num" id="LN407">407</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="408"><td class="num" id="LN408">408</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Clock, <span class='keyword'>class</span> Duration&gt;</td></tr>
<tr class="codeline" data-linenumber="409"><td class="num" id="LN409">409</td><td class="line">        <span class='keyword'>bool</span> try_lock_upgrade_until(<span class='keyword'>const</span> chrono::time_point&lt;Clock, Duration&gt;&amp; abs_time)</td></tr>
<tr class="codeline" data-linenumber="410"><td class="num" id="LN410">410</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="411"><td class="num" id="LN411">411</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="412"><td class="num" id="LN412">412</td><td class="line">          boost::this_thread::disable_interruption do_not_disturb;</td></tr>
<tr class="codeline" data-linenumber="413"><td class="num" id="LN413">413</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="414"><td class="num" id="LN414">414</td><td class="line">          boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="415"><td class="num" id="LN415">415</td><td class="line">          <span class='keyword'>if</span>(!shared_cond.wait_until(lk, abs_time, boost::bind(&amp;state_data::can_lock_upgrade, boost::ref(state))))</td></tr>
<tr class="codeline" data-linenumber="416"><td class="num" id="LN416">416</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="417"><td class="num" id="LN417">417</td><td class="line">              <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="418"><td class="num" id="LN418">418</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="419"><td class="num" id="LN419">419</td><td class="line">          state.lock_shared();</td></tr>
<tr class="codeline" data-linenumber="420"><td class="num" id="LN420">420</td><td class="line">          state.upgrade=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="421"><td class="num" id="LN421">421</td><td class="line">          <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="422"><td class="num" id="LN422">422</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="423"><td class="num" id="LN423">423</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="424"><td class="num" id="LN424">424</td><td class="line">        <span class='keyword'>bool</span> try_lock_upgrade()</td></tr>
<tr class="codeline" data-linenumber="425"><td class="num" id="LN425">425</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="426"><td class="num" id="LN426">426</td><td class="line">            boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="427"><td class="num" id="LN427">427</td><td class="line">            <span class='keyword'>if</span>(!state.can_lock_upgrade())</td></tr>
<tr class="codeline" data-linenumber="428"><td class="num" id="LN428">428</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="429"><td class="num" id="LN429">429</td><td class="line">                <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="430"><td class="num" id="LN430">430</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="431"><td class="num" id="LN431">431</td><td class="line">            state.lock_shared();</td></tr>
<tr class="codeline" data-linenumber="432"><td class="num" id="LN432">432</td><td class="line">            state.upgrade=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="433"><td class="num" id="LN433">433</td><td class="line">            state.assert_lock_upgraded();</td></tr>
<tr class="codeline" data-linenumber="434"><td class="num" id="LN434">434</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="435"><td class="num" id="LN435">435</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="436"><td class="num" id="LN436">436</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="437"><td class="num" id="LN437">437</td><td class="line">        <span class='keyword'>void</span> unlock_upgrade()</td></tr>
<tr class="codeline" data-linenumber="438"><td class="num" id="LN438">438</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="439"><td class="num" id="LN439">439</td><td class="line">            boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="440"><td class="num" id="LN440">440</td><td class="line">            <span class='comment'>//state.upgrade=false;</span></td></tr>
<tr class="codeline" data-linenumber="441"><td class="num" id="LN441">441</td><td class="line">            state.unlock_upgrade();</td></tr>
<tr class="codeline" data-linenumber="442"><td class="num" id="LN442">442</td><td class="line">            <span class='keyword'>if</span>(state.no_shared())</td></tr>
<tr class="codeline" data-linenumber="443"><td class="num" id="LN443">443</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="444"><td class="num" id="LN444">444</td><td class="line">                state.exclusive_waiting_blocked=<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="445"><td class="num" id="LN445">445</td><td class="line">                release_waiters();</td></tr>
<tr class="codeline" data-linenumber="446"><td class="num" id="LN446">446</td><td class="line">            } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="447"><td class="num" id="LN447">447</td><td class="line">                shared_cond.notify_all();</td></tr>
<tr class="codeline" data-linenumber="448"><td class="num" id="LN448">448</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="449"><td class="num" id="LN449">449</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="450"><td class="num" id="LN450">450</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="451"><td class="num" id="LN451">451</td><td class="line">        <span class='comment'>// Upgrade &lt;-&gt; Exclusive</span></td></tr>
<tr class="codeline" data-linenumber="452"><td class="num" id="LN452">452</td><td class="line">        <span class='keyword'>void</span> unlock_upgrade_and_lock()</td></tr>
<tr class="codeline" data-linenumber="453"><td class="num" id="LN453">453</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="454"><td class="num" id="LN454">454</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="455"><td class="num" id="LN455">455</td><td class="line">            boost::this_thread::disable_interruption do_not_disturb;</td></tr>
<tr class="codeline" data-linenumber="456"><td class="num" id="LN456">456</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="457"><td class="num" id="LN457">457</td><td class="line">            boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="458"><td class="num" id="LN458">458</td><td class="line">            state.assert_lock_upgraded();</td></tr>
<tr class="codeline" data-linenumber="459"><td class="num" id="LN459">459</td><td class="line">            state.unlock_shared();</td></tr>
<tr class="codeline" data-linenumber="460"><td class="num" id="LN460">460</td><td class="line">            upgrade_cond.wait(lk, boost::bind(&amp;state_data::no_shared, boost::ref(state)));</td></tr>
<tr class="codeline" data-linenumber="461"><td class="num" id="LN461">461</td><td class="line">            state.upgrade=<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="462"><td class="num" id="LN462">462</td><td class="line">            state.exclusive=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="463"><td class="num" id="LN463">463</td><td class="line">            state.assert_locked();</td></tr>
<tr class="codeline" data-linenumber="464"><td class="num" id="LN464">464</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="465"><td class="num" id="LN465">465</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="466"><td class="num" id="LN466">466</td><td class="line">        <span class='keyword'>void</span> unlock_and_lock_upgrade()</td></tr>
<tr class="codeline" data-linenumber="467"><td class="num" id="LN467">467</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="468"><td class="num" id="LN468">468</td><td class="line">            boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="469"><td class="num" id="LN469">469</td><td class="line">            state.assert_locked();</td></tr>
<tr class="codeline" data-linenumber="470"><td class="num" id="LN470">470</td><td class="line">            state.exclusive=<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="471"><td class="num" id="LN471">471</td><td class="line">            state.upgrade=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="472"><td class="num" id="LN472">472</td><td class="line">            state.lock_shared();</td></tr>
<tr class="codeline" data-linenumber="473"><td class="num" id="LN473">473</td><td class="line">            state.exclusive_waiting_blocked=<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="474"><td class="num" id="LN474">474</td><td class="line">            state.assert_lock_upgraded();</td></tr>
<tr class="codeline" data-linenumber="475"><td class="num" id="LN475">475</td><td class="line">            release_waiters();</td></tr>
<tr class="codeline" data-linenumber="476"><td class="num" id="LN476">476</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="477"><td class="num" id="LN477">477</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="478"><td class="num" id="LN478">478</td><td class="line">        <span class='keyword'>bool</span> try_unlock_upgrade_and_lock()</td></tr>
<tr class="codeline" data-linenumber="479"><td class="num" id="LN479">479</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="480"><td class="num" id="LN480">480</td><td class="line">          boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="481"><td class="num" id="LN481">481</td><td class="line">          state.assert_lock_upgraded();</td></tr>
<tr class="codeline" data-linenumber="482"><td class="num" id="LN482">482</td><td class="line">          <span class='keyword'>if</span>(    !state.exclusive</td></tr>
<tr class="codeline" data-linenumber="483"><td class="num" id="LN483">483</td><td class="line">              &amp;&amp; !state.exclusive_waiting_blocked</td></tr>
<tr class="codeline" data-linenumber="484"><td class="num" id="LN484">484</td><td class="line">              &amp;&amp; state.upgrade</td></tr>
<tr class="codeline" data-linenumber="485"><td class="num" id="LN485">485</td><td class="line">              &amp;&amp; state.shared_count==1)</td></tr>
<tr class="codeline" data-linenumber="486"><td class="num" id="LN486">486</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="487"><td class="num" id="LN487">487</td><td class="line">            state.shared_count=0;</td></tr>
<tr class="codeline" data-linenumber="488"><td class="num" id="LN488">488</td><td class="line">            state.exclusive=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="489"><td class="num" id="LN489">489</td><td class="line">            state.upgrade=<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="490"><td class="num" id="LN490">490</td><td class="line">            state.assert_locked();</td></tr>
<tr class="codeline" data-linenumber="491"><td class="num" id="LN491">491</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="492"><td class="num" id="LN492">492</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="493"><td class="num" id="LN493">493</td><td class="line">          <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="494"><td class="num" id="LN494">494</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="495"><td class="num" id="LN495">495</td><td class="line"><span class='directive'>#ifdef BOOST_THREAD_USES_CHRONO</span></td></tr>
<tr class="codeline" data-linenumber="496"><td class="num" id="LN496">496</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Rep, <span class='keyword'>class</span> Period&gt;</td></tr>
<tr class="codeline" data-linenumber="497"><td class="num" id="LN497">497</td><td class="line">        <span class='keyword'>bool</span></td></tr>
<tr class="codeline" data-linenumber="498"><td class="num" id="LN498">498</td><td class="line">        try_unlock_upgrade_and_lock_for(</td></tr>
<tr class="codeline" data-linenumber="499"><td class="num" id="LN499">499</td><td class="line">                                <span class='keyword'>const</span> chrono::duration&lt;Rep, Period&gt;&amp; rel_time)</td></tr>
<tr class="codeline" data-linenumber="500"><td class="num" id="LN500">500</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="501"><td class="num" id="LN501">501</td><td class="line">          <span class='keyword'>return</span> try_unlock_upgrade_and_lock_until(</td></tr>
<tr class="codeline" data-linenumber="502"><td class="num" id="LN502">502</td><td class="line">                                 chrono::steady_clock::now() + rel_time);</td></tr>
<tr class="codeline" data-linenumber="503"><td class="num" id="LN503">503</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="504"><td class="num" id="LN504">504</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Clock, <span class='keyword'>class</span> Duration&gt;</td></tr>
<tr class="codeline" data-linenumber="505"><td class="num" id="LN505">505</td><td class="line">        <span class='keyword'>bool</span></td></tr>
<tr class="codeline" data-linenumber="506"><td class="num" id="LN506">506</td><td class="line">        try_unlock_upgrade_and_lock_until(</td></tr>
<tr class="codeline" data-linenumber="507"><td class="num" id="LN507">507</td><td class="line">                          <span class='keyword'>const</span> chrono::time_point&lt;Clock, Duration&gt;&amp; abs_time)</td></tr>
<tr class="codeline" data-linenumber="508"><td class="num" id="LN508">508</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="509"><td class="num" id="LN509">509</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="510"><td class="num" id="LN510">510</td><td class="line">          boost::this_thread::disable_interruption do_not_disturb;</td></tr>
<tr class="codeline" data-linenumber="511"><td class="num" id="LN511">511</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="512"><td class="num" id="LN512">512</td><td class="line">          boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="513"><td class="num" id="LN513">513</td><td class="line">          state.assert_lock_upgraded();</td></tr>
<tr class="codeline" data-linenumber="514"><td class="num" id="LN514">514</td><td class="line">          <span class='keyword'>if</span>(!shared_cond.wait_until(lk, abs_time, boost::bind(&amp;state_data::one_shared, boost::ref(state))))</td></tr>
<tr class="codeline" data-linenumber="515"><td class="num" id="LN515">515</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="516"><td class="num" id="LN516">516</td><td class="line">              <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="517"><td class="num" id="LN517">517</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="518"><td class="num" id="LN518">518</td><td class="line">          state.upgrade=<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="519"><td class="num" id="LN519">519</td><td class="line">          state.exclusive=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="520"><td class="num" id="LN520">520</td><td class="line">          state.exclusive_waiting_blocked=<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="521"><td class="num" id="LN521">521</td><td class="line">          state.shared_count=0;</td></tr>
<tr class="codeline" data-linenumber="522"><td class="num" id="LN522">522</td><td class="line">          <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="523"><td class="num" id="LN523">523</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="524"><td class="num" id="LN524">524</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="525"><td class="num" id="LN525">525</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="526"><td class="num" id="LN526">526</td><td class="line">        <span class='comment'>// Shared &lt;-&gt; Exclusive</span></td></tr>
<tr class="codeline" data-linenumber="527"><td class="num" id="LN527">527</td><td class="line">        <span class='keyword'>void</span> unlock_and_lock_shared()</td></tr>
<tr class="codeline" data-linenumber="528"><td class="num" id="LN528">528</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="529"><td class="num" id="LN529">529</td><td class="line">            boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="530"><td class="num" id="LN530">530</td><td class="line">            state.assert_locked();</td></tr>
<tr class="codeline" data-linenumber="531"><td class="num" id="LN531">531</td><td class="line">            state.exclusive=<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="532"><td class="num" id="LN532">532</td><td class="line">            state.lock_shared();</td></tr>
<tr class="codeline" data-linenumber="533"><td class="num" id="LN533">533</td><td class="line">            state.exclusive_waiting_blocked=<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="534"><td class="num" id="LN534">534</td><td class="line">            release_waiters();</td></tr>
<tr class="codeline" data-linenumber="535"><td class="num" id="LN535">535</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="536"><td class="num" id="LN536">536</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="537"><td class="num" id="LN537">537</td><td class="line"><span class='directive'>#ifdef BOOST_THREAD_PROVIDES_SHARED_MUTEX_UPWARDS_CONVERSIONS</span></td></tr>
<tr class="codeline" data-linenumber="538"><td class="num" id="LN538">538</td><td class="line">        <span class='keyword'>bool</span> try_unlock_shared_and_lock()</td></tr>
<tr class="codeline" data-linenumber="539"><td class="num" id="LN539">539</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="540"><td class="num" id="LN540">540</td><td class="line">          boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="541"><td class="num" id="LN541">541</td><td class="line">          state.assert_lock_shared();</td></tr>
<tr class="codeline" data-linenumber="542"><td class="num" id="LN542">542</td><td class="line">          <span class='keyword'>if</span>(    !state.exclusive</td></tr>
<tr class="codeline" data-linenumber="543"><td class="num" id="LN543">543</td><td class="line">              &amp;&amp; !state.exclusive_waiting_blocked</td></tr>
<tr class="codeline" data-linenumber="544"><td class="num" id="LN544">544</td><td class="line">              &amp;&amp; !state.upgrade</td></tr>
<tr class="codeline" data-linenumber="545"><td class="num" id="LN545">545</td><td class="line">              &amp;&amp; state.shared_count==1)</td></tr>
<tr class="codeline" data-linenumber="546"><td class="num" id="LN546">546</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="547"><td class="num" id="LN547">547</td><td class="line">            state.shared_count=0;</td></tr>
<tr class="codeline" data-linenumber="548"><td class="num" id="LN548">548</td><td class="line">            state.exclusive=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="549"><td class="num" id="LN549">549</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="550"><td class="num" id="LN550">550</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="551"><td class="num" id="LN551">551</td><td class="line">          <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="552"><td class="num" id="LN552">552</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="553"><td class="num" id="LN553">553</td><td class="line"><span class='directive'>#ifdef BOOST_THREAD_USES_CHRONO</span></td></tr>
<tr class="codeline" data-linenumber="554"><td class="num" id="LN554">554</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Rep, <span class='keyword'>class</span> Period&gt;</td></tr>
<tr class="codeline" data-linenumber="555"><td class="num" id="LN555">555</td><td class="line">            <span class='keyword'>bool</span></td></tr>
<tr class="codeline" data-linenumber="556"><td class="num" id="LN556">556</td><td class="line">            try_unlock_shared_and_lock_for(</td></tr>
<tr class="codeline" data-linenumber="557"><td class="num" id="LN557">557</td><td class="line">                                <span class='keyword'>const</span> chrono::duration&lt;Rep, Period&gt;&amp; rel_time)</td></tr>
<tr class="codeline" data-linenumber="558"><td class="num" id="LN558">558</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="559"><td class="num" id="LN559">559</td><td class="line">          <span class='keyword'>return</span> try_unlock_shared_and_lock_until(</td></tr>
<tr class="codeline" data-linenumber="560"><td class="num" id="LN560">560</td><td class="line">                                 chrono::steady_clock::now() + rel_time);</td></tr>
<tr class="codeline" data-linenumber="561"><td class="num" id="LN561">561</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="562"><td class="num" id="LN562">562</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Clock, <span class='keyword'>class</span> Duration&gt;</td></tr>
<tr class="codeline" data-linenumber="563"><td class="num" id="LN563">563</td><td class="line">            <span class='keyword'>bool</span></td></tr>
<tr class="codeline" data-linenumber="564"><td class="num" id="LN564">564</td><td class="line">            try_unlock_shared_and_lock_until(</td></tr>
<tr class="codeline" data-linenumber="565"><td class="num" id="LN565">565</td><td class="line">                          <span class='keyword'>const</span> chrono::time_point&lt;Clock, Duration&gt;&amp; abs_time)</td></tr>
<tr class="codeline" data-linenumber="566"><td class="num" id="LN566">566</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="567"><td class="num" id="LN567">567</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="568"><td class="num" id="LN568">568</td><td class="line">          boost::this_thread::disable_interruption do_not_disturb;</td></tr>
<tr class="codeline" data-linenumber="569"><td class="num" id="LN569">569</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="570"><td class="num" id="LN570">570</td><td class="line">          boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="571"><td class="num" id="LN571">571</td><td class="line">          state.assert_lock_shared();</td></tr>
<tr class="codeline" data-linenumber="572"><td class="num" id="LN572">572</td><td class="line">          <span class='keyword'>if</span>(!shared_cond.wait_until(lk, abs_time, boost::bind(&amp;state_data::one_shared, boost::ref(state))))</td></tr>
<tr class="codeline" data-linenumber="573"><td class="num" id="LN573">573</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="574"><td class="num" id="LN574">574</td><td class="line">              <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="575"><td class="num" id="LN575">575</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="576"><td class="num" id="LN576">576</td><td class="line">          state.upgrade=<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="577"><td class="num" id="LN577">577</td><td class="line">          state.exclusive=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="578"><td class="num" id="LN578">578</td><td class="line">          state.exclusive_waiting_blocked=<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="579"><td class="num" id="LN579">579</td><td class="line">          state.shared_count=0;</td></tr>
<tr class="codeline" data-linenumber="580"><td class="num" id="LN580">580</td><td class="line">          <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="581"><td class="num" id="LN581">581</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="582"><td class="num" id="LN582">582</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="583"><td class="num" id="LN583">583</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="584"><td class="num" id="LN584">584</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="585"><td class="num" id="LN585">585</td><td class="line">        <span class='comment'>// Shared &lt;-&gt; Upgrade</span></td></tr>
<tr class="codeline" data-linenumber="586"><td class="num" id="LN586">586</td><td class="line">        <span class='keyword'>void</span> unlock_upgrade_and_lock_shared()</td></tr>
<tr class="codeline" data-linenumber="587"><td class="num" id="LN587">587</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="588"><td class="num" id="LN588">588</td><td class="line">            boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="589"><td class="num" id="LN589">589</td><td class="line">            state.assert_lock_upgraded();</td></tr>
<tr class="codeline" data-linenumber="590"><td class="num" id="LN590">590</td><td class="line">            state.upgrade=<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="591"><td class="num" id="LN591">591</td><td class="line">            state.exclusive_waiting_blocked=<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="592"><td class="num" id="LN592">592</td><td class="line">            release_waiters();</td></tr>
<tr class="codeline" data-linenumber="593"><td class="num" id="LN593">593</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="594"><td class="num" id="LN594">594</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="595"><td class="num" id="LN595">595</td><td class="line"><span class='directive'>#ifdef BOOST_THREAD_PROVIDES_SHARED_MUTEX_UPWARDS_CONVERSIONS</span></td></tr>
<tr class="codeline" data-linenumber="596"><td class="num" id="LN596">596</td><td class="line">        <span class='keyword'>bool</span> try_unlock_shared_and_lock_upgrade()</td></tr>
<tr class="codeline" data-linenumber="597"><td class="num" id="LN597">597</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="598"><td class="num" id="LN598">598</td><td class="line">          boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="599"><td class="num" id="LN599">599</td><td class="line">          state.assert_lock_shared();</td></tr>
<tr class="codeline" data-linenumber="600"><td class="num" id="LN600">600</td><td class="line">          <span class='keyword'>if</span>(state.can_lock_upgrade())</td></tr>
<tr class="codeline" data-linenumber="601"><td class="num" id="LN601">601</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="602"><td class="num" id="LN602">602</td><td class="line">            state.upgrade=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="603"><td class="num" id="LN603">603</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="604"><td class="num" id="LN604">604</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="605"><td class="num" id="LN605">605</td><td class="line">          <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="606"><td class="num" id="LN606">606</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="607"><td class="num" id="LN607">607</td><td class="line"><span class='directive'>#ifdef BOOST_THREAD_USES_CHRONO</span></td></tr>
<tr class="codeline" data-linenumber="608"><td class="num" id="LN608">608</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Rep, <span class='keyword'>class</span> Period&gt;</td></tr>
<tr class="codeline" data-linenumber="609"><td class="num" id="LN609">609</td><td class="line">            <span class='keyword'>bool</span></td></tr>
<tr class="codeline" data-linenumber="610"><td class="num" id="LN610">610</td><td class="line">            try_unlock_shared_and_lock_upgrade_for(</td></tr>
<tr class="codeline" data-linenumber="611"><td class="num" id="LN611">611</td><td class="line">                                <span class='keyword'>const</span> chrono::duration&lt;Rep, Period&gt;&amp; rel_time)</td></tr>
<tr class="codeline" data-linenumber="612"><td class="num" id="LN612">612</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="613"><td class="num" id="LN613">613</td><td class="line">          <span class='keyword'>return</span> try_unlock_shared_and_lock_upgrade_until(</td></tr>
<tr class="codeline" data-linenumber="614"><td class="num" id="LN614">614</td><td class="line">                                 chrono::steady_clock::now() + rel_time);</td></tr>
<tr class="codeline" data-linenumber="615"><td class="num" id="LN615">615</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="616"><td class="num" id="LN616">616</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Clock, <span class='keyword'>class</span> Duration&gt;</td></tr>
<tr class="codeline" data-linenumber="617"><td class="num" id="LN617">617</td><td class="line">            <span class='keyword'>bool</span></td></tr>
<tr class="codeline" data-linenumber="618"><td class="num" id="LN618">618</td><td class="line">            try_unlock_shared_and_lock_upgrade_until(</td></tr>
<tr class="codeline" data-linenumber="619"><td class="num" id="LN619">619</td><td class="line">                          <span class='keyword'>const</span> chrono::time_point&lt;Clock, Duration&gt;&amp; abs_time)</td></tr>
<tr class="codeline" data-linenumber="620"><td class="num" id="LN620">620</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="621"><td class="num" id="LN621">621</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="622"><td class="num" id="LN622">622</td><td class="line">          boost::this_thread::disable_interruption do_not_disturb;</td></tr>
<tr class="codeline" data-linenumber="623"><td class="num" id="LN623">623</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="624"><td class="num" id="LN624">624</td><td class="line">          boost::unique_lock&lt;boost::mutex&gt; lk(state_change);</td></tr>
<tr class="codeline" data-linenumber="625"><td class="num" id="LN625">625</td><td class="line">          state.assert_lock_shared();</td></tr>
<tr class="codeline" data-linenumber="626"><td class="num" id="LN626">626</td><td class="line">          <span class='keyword'>if</span>(!exclusive_cond.wait_until(lk, abs_time, boost::bind(&amp;state_data::can_lock_upgrade, boost::ref(state))))</td></tr>
<tr class="codeline" data-linenumber="627"><td class="num" id="LN627">627</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="628"><td class="num" id="LN628">628</td><td class="line">              <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="629"><td class="num" id="LN629">629</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="630"><td class="num" id="LN630">630</td><td class="line">          state.upgrade=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="631"><td class="num" id="LN631">631</td><td class="line">          <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="632"><td class="num" id="LN632">632</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="633"><td class="num" id="LN633">633</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="634"><td class="num" id="LN634">634</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="635"><td class="num" id="LN635">635</td><td class="line">    };</td></tr>
<tr class="codeline" data-linenumber="636"><td class="num" id="LN636">636</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="637"><td class="num" id="LN637">637</td><td class="line">    <span class='keyword'>typedef</span> shared_mutex upgrade_mutex;</td></tr>
<tr class="codeline" data-linenumber="638"><td class="num" id="LN638">638</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="639"><td class="num" id="LN639">639</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="640"><td class="num" id="LN640">640</td><td class="line"><span class='directive'>#include &lt;boost/config/abi_suffix.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="641"><td class="num" id="LN641">641</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="642"><td class="num" id="LN642">642</td><td class="line"><span class='directive'>#endif</span></td></tr>
</table><hr class=divider>
<div id=File369430>
<div class=FileNav><a href="#File1512106">&#x2190;</a></div><h4 class=FileName>/usr/local/include/boost/thread/pthread/condition_variable_fwd.hpp</h4>
<div class=FileNav><a href="#File281631">&#x2192;</a></div></div>
<table class="code" data-fileid="369430">
<tr class="codeline" data-linenumber="1"><td class="num" id="LN1">1</td><td class="line"><span class='directive'>#ifndef BOOST_THREAD_PTHREAD_CONDITION_VARIABLE_FWD_HPP</span></td></tr>
<tr class="codeline" data-linenumber="2"><td class="num" id="LN2">2</td><td class="line"><span class='directive'>#define BOOST_THREAD_PTHREAD_CONDITION_VARIABLE_FWD_HPP</span></td></tr>
<tr class="codeline" data-linenumber="3"><td class="num" id="LN3">3</td><td class="line"><span class='comment'>// Distributed under the Boost Software License, Version 1.0. (See</span></td></tr>
<tr class="codeline" data-linenumber="4"><td class="num" id="LN4">4</td><td class="line"><span class='comment'>// accompanying file LICENSE_1_0.txt or copy at</span></td></tr>
<tr class="codeline" data-linenumber="5"><td class="num" id="LN5">5</td><td class="line"><span class='comment'>// http://www.boost.org/LICENSE_1_0.txt)</span></td></tr>
<tr class="codeline" data-linenumber="6"><td class="num" id="LN6">6</td><td class="line"><span class='comment'>// (C) Copyright 2007-8 Anthony Williams</span></td></tr>
<tr class="codeline" data-linenumber="7"><td class="num" id="LN7">7</td><td class="line"><span class='comment'>// (C) Copyright 2011-2012 Vicente J. Botet Escriba</span></td></tr>
<tr class="codeline" data-linenumber="8"><td class="num" id="LN8">8</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="9"><td class="num" id="LN9">9</td><td class="line"><span class='directive'>#include &lt;boost/assert.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="10"><td class="num" id="LN10">10</td><td class="line"><span class='directive'>#include &lt;boost/throw_exception.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="11"><td class="num" id="LN11">11</td><td class="line"><span class='directive'>#include &lt;pthread.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="12"><td class="num" id="LN12">12</td><td class="line"><span class='directive'>#include &lt;boost/thread/cv_status.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="13"><td class="num" id="LN13">13</td><td class="line"><span class='directive'>#include &lt;boost/thread/mutex.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="14"><td class="num" id="LN14">14</td><td class="line"><span class='directive'>#include &lt;boost/thread/lock_types.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="15"><td class="num" id="LN15">15</td><td class="line"><span class='directive'>#include &lt;boost/thread/thread_time.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="16"><td class="num" id="LN16">16</td><td class="line"><span class='directive'>#include &lt;boost/thread/detail/platform_time.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="17"><td class="num" id="LN17">17</td><td class="line"><span class='directive'>#include &lt;boost/thread/pthread/pthread_helpers.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="18"><td class="num" id="LN18">18</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="19"><td class="num" id="LN19">19</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_USES_DATETIME</span></td></tr>
<tr class="codeline" data-linenumber="20"><td class="num" id="LN20">20</td><td class="line"><span class='directive'>#include &lt;boost/thread/xtime.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="21"><td class="num" id="LN21">21</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="22"><td class="num" id="LN22">22</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="23"><td class="num" id="LN23">23</td><td class="line"><span class='directive'>#ifdef BOOST_THREAD_USES_CHRONO</span></td></tr>
<tr class="codeline" data-linenumber="24"><td class="num" id="LN24">24</td><td class="line"><span class='directive'>#include &lt;boost/chrono/system_clocks.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="25"><td class="num" id="LN25">25</td><td class="line"><span class='directive'>#include &lt;boost/chrono/ceil.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="26"><td class="num" id="LN26">26</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="27"><td class="num" id="LN27">27</td><td class="line"><span class='directive'>#include &lt;boost/thread/detail/delete.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="28"><td class="num" id="LN28">28</td><td class="line"><span class='directive'>#include &lt;boost/date_time/posix_time/posix_time_duration.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="29"><td class="num" id="LN29">29</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="30"><td class="num" id="LN30">30</td><td class="line"><span class='directive'>#include &lt;algorithm&gt;</span></td></tr>
<tr class="codeline" data-linenumber="31"><td class="num" id="LN31">31</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="32"><td class="num" id="LN32">32</td><td class="line"><span class='directive'>#include &lt;boost/config/abi_prefix.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="33"><td class="num" id="LN33">33</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="34"><td class="num" id="LN34">34</td><td class="line"><span class='keyword'>namespace</span> boost</td></tr>
<tr class="codeline" data-linenumber="35"><td class="num" id="LN35">35</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="36"><td class="num" id="LN36">36</td><td class="line">    <span class='keyword'>class</span> condition_variable</td></tr>
<tr class="codeline" data-linenumber="37"><td class="num" id="LN37">37</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="38"><td class="num" id="LN38">38</td><td class="line">    <span class='keyword'>private</span>:</td></tr>
<tr class="codeline" data-linenumber="39"><td class="num" id="LN39">39</td><td class="line"><span class='comment'>//#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="40"><td class="num" id="LN40">40</td><td class="line">        pthread_mutex_t internal_mutex;</td></tr>
<tr class="codeline" data-linenumber="41"><td class="num" id="LN41">41</td><td class="line"><span class='comment'>//#endif</span></td></tr>
<tr class="codeline" data-linenumber="42"><td class="num" id="LN42">42</td><td class="line">        pthread_cond_t cond;</td></tr>
<tr class="codeline" data-linenumber="43"><td class="num" id="LN43">43</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="44"><td class="num" id="LN44">44</td><td class="line">    <span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="45"><td class="num" id="LN45">45</td><td class="line">    <span class='comment'>//private: // used by boost::thread::try_join_until</span></td></tr>
<tr class="codeline" data-linenumber="46"><td class="num" id="LN46">46</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="47"><td class="num" id="LN47">47</td><td class="line">        <span class='keyword'>bool</span> do_wait_until(</td></tr>
<tr class="codeline" data-linenumber="48"><td class="num" id="LN48">48</td><td class="line">            unique_lock&lt;mutex&gt;&amp; lock,</td></tr>
<tr class="codeline" data-linenumber="49"><td class="num" id="LN49">49</td><td class="line">            detail::internal_platform_timepoint <span class='keyword'>const</span> &amp;timeout);</td></tr>
<tr class="codeline" data-linenumber="50"><td class="num" id="LN50">50</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="51"><td class="num" id="LN51">51</td><td class="line">    <span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="52"><td class="num" id="LN52">52</td><td class="line">      <span class='macro'>BOOST_THREAD_NO_COPYABLE(condition_variable)<span class='macro_popup'>condition_variable(condition_variable const&amp;) = delete; condition_variable<br>&amp; operator=(condition_variable const&amp;) = delete;</span></span></td></tr>
<tr class="codeline" data-linenumber="53"><td class="num" id="LN53">53</td><td class="line">        condition_variable()</td></tr>
<tr class="codeline" data-linenumber="54"><td class="num" id="LN54">54</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="55"><td class="num" id="LN55">55</td><td class="line">            <span class='keyword'>int</span> res;</td></tr>
<tr class="codeline" data-linenumber="56"><td class="num" id="LN56">56</td><td class="line"><span class='comment'>//#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="57"><td class="num" id="LN57">57</td><td class="line">            <span class='comment'>// Even if it is not used, the internal_mutex exists (see</span></td></tr>
<tr class="codeline" data-linenumber="58"><td class="num" id="LN58">58</td><td class="line">            <span class='comment'>// above) and must be initialized (etc) in case some</span></td></tr>
<tr class="codeline" data-linenumber="59"><td class="num" id="LN59">59</td><td class="line">            <span class='comment'>// compilation units provide interruptions and others</span></td></tr>
<tr class="codeline" data-linenumber="60"><td class="num" id="LN60">60</td><td class="line">            <span class='comment'>// don't.</span></td></tr>
<tr class="codeline" data-linenumber="61"><td class="num" id="LN61">61</td><td class="line">            res=posix::pthread_mutex_init(&amp;internal_mutex);</td></tr>
<tr class="codeline" data-linenumber="62"><td class="num" id="LN62">62</td><td class="line">            <span class='keyword'>if</span>(res)</td></tr>
<tr class="codeline" data-linenumber="63"><td class="num" id="LN63">63</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="64"><td class="num" id="LN64">64</td><td class="line">                boost::throw_exception(thread_resource_error(res, <span class='string_literal'>"boost::condition_variable::condition_variable() constructor failed in pthread_mutex_init"</span>));</td></tr>
<tr class="codeline" data-linenumber="65"><td class="num" id="LN65">65</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="66"><td class="num" id="LN66">66</td><td class="line"><span class='comment'>//#endif</span></td></tr>
<tr class="codeline" data-linenumber="67"><td class="num" id="LN67">67</td><td class="line">            res = posix::pthread_cond_init(&amp;cond);</td></tr>
<tr class="codeline" data-linenumber="68"><td class="num" id="LN68">68</td><td class="line">            <span class='keyword'>if</span> (res)</td></tr>
<tr class="codeline" data-linenumber="69"><td class="num" id="LN69">69</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="70"><td class="num" id="LN70">70</td><td class="line"><span class='comment'>//#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="71"><td class="num" id="LN71">71</td><td class="line">                <span class='comment'>// ditto</span></td></tr>
<tr class="codeline" data-linenumber="72"><td class="num" id="LN72">72</td><td class="line">                <span class='macro'>BOOST_VERIFY(!posix::pthread_mutex_destroy(&amp;internal_mutex))<span class='macro_popup'>(static_cast &lt;bool&gt; (!posix::pthread_mutex_destroy(&amp;<br>internal_mutex)) ? void (0) : __assert_fail ("!posix::pthread_mutex_destroy(&amp;internal_mutex)"<br>, "/usr/local/include/boost/thread/pthread/condition_variable_fwd.hpp"<br>, 72, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="73"><td class="num" id="LN73">73</td><td class="line"><span class='comment'>//#endif</span></td></tr>
<tr class="codeline" data-linenumber="74"><td class="num" id="LN74">74</td><td class="line">                boost::throw_exception(thread_resource_error(res, <span class='string_literal'>"boost::condition_variable::condition_variable() constructor failed in pthread_cond_init"</span>));</td></tr>
<tr class="codeline" data-linenumber="75"><td class="num" id="LN75">75</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="76"><td class="num" id="LN76">76</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="77"><td class="num" id="LN77">77</td><td class="line">        ~condition_variable()</td></tr>
<tr class="codeline" data-linenumber="78"><td class="num" id="LN78">78</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="79"><td class="num" id="LN79">79</td><td class="line"><span class='comment'>//#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="80"><td class="num" id="LN80">80</td><td class="line">            <span class='comment'>// ditto</span></td></tr>
<tr class="codeline" data-linenumber="81"><td class="num" id="LN81">81</td><td class="line">            <span class='macro'>BOOST_VERIFY(!posix::pthread_mutex_destroy(&amp;internal_mutex))<span class='macro_popup'>(static_cast &lt;bool&gt; (!posix::pthread_mutex_destroy(&amp;<br>internal_mutex)) ? void (0) : __assert_fail ("!posix::pthread_mutex_destroy(&amp;internal_mutex)"<br>, "/usr/local/include/boost/thread/pthread/condition_variable_fwd.hpp"<br>, 81, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="82"><td class="num" id="LN82">82</td><td class="line"><span class='comment'>//#endif</span></td></tr>
<tr class="codeline" data-linenumber="83"><td class="num" id="LN83">83</td><td class="line">            <span class='macro'>BOOST_VERIFY(!posix::pthread_cond_destroy(&amp;cond))<span class='macro_popup'>(static_cast &lt;bool&gt; (!posix::pthread_cond_destroy(&amp;<br>cond)) ? void (0) : __assert_fail ("!posix::pthread_cond_destroy(&amp;cond)"<br>, "/usr/local/include/boost/thread/pthread/condition_variable_fwd.hpp"<br>, 83, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="84"><td class="num" id="LN84">84</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="85"><td class="num" id="LN85">85</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="86"><td class="num" id="LN86">86</td><td class="line">        <span class='keyword'>void</span> wait(unique_lock&lt;mutex&gt;&amp; m);</td></tr>
<tr class="codeline" data-linenumber="87"><td class="num" id="LN87">87</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="88"><td class="num" id="LN88">88</td><td class="line">        <span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> predicate_type&gt;</td></tr>
<tr class="codeline" data-linenumber="89"><td class="num" id="LN89">89</td><td class="line">        <span class='keyword'>void</span> wait(unique_lock&lt;mutex&gt;&amp; m,predicate_type pred)</td></tr>
<tr class="codeline" data-linenumber="90"><td class="num" id="LN90">90</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="91"><td class="num" id="LN91">91</td><td class="line">            <span class='keyword'>while</span> (!pred())</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path20" class="msg msgControl" style="margin-left:13ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">20</div></td><td><div class="PathNav"><a href="#Path19" title="Previous event (19)">&#x2190;</a></div></td><td>Loop condition is true.  Entering loop body</td><td><div class="PathNav"><a href="#Path21" title="Next event (21)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="92"><td class="num" id="LN92">92</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="93"><td class="num" id="LN93">93</td><td class="line">                <span class="mrange">wait(m)</span>;</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path21" class="msg msgEvent" style="margin-left:17ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">21</div></td><td><div class="PathNav"><a href="#Path20" title="Previous event (20)">&#x2190;</a></div></td><td>Calling 'condition_variable::wait'</td><td><div class="PathNav"><a href="#Path22" title="Next event (22)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="94"><td class="num" id="LN94">94</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="95"><td class="num" id="LN95">95</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="96"><td class="num" id="LN96">96</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="97"><td class="num" id="LN97">97</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_USES_DATETIME</span></td></tr>
<tr class="codeline" data-linenumber="98"><td class="num" id="LN98">98</td><td class="line">        <span class='keyword'>bool</span> timed_wait(</td></tr>
<tr class="codeline" data-linenumber="99"><td class="num" id="LN99">99</td><td class="line">            unique_lock&lt;mutex&gt;&amp; m,</td></tr>
<tr class="codeline" data-linenumber="100"><td class="num" id="LN100">100</td><td class="line">            boost::system_time <span class='keyword'>const</span>&amp; abs_time)</td></tr>
<tr class="codeline" data-linenumber="101"><td class="num" id="LN101">101</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="102"><td class="num" id="LN102">102</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_WAIT_BUG</span></td></tr>
<tr class="codeline" data-linenumber="103"><td class="num" id="LN103">103</td><td class="line">            <span class='keyword'>const</span> detail::real_platform_timepoint ts(abs_time + BOOST_THREAD_WAIT_BUG);</td></tr>
<tr class="codeline" data-linenumber="104"><td class="num" id="LN104">104</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="105"><td class="num" id="LN105">105</td><td class="line">            <span class='keyword'>const</span> detail::real_platform_timepoint ts(abs_time);</td></tr>
<tr class="codeline" data-linenumber="106"><td class="num" id="LN106">106</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="107"><td class="num" id="LN107">107</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_INTERNAL_CLOCK_IS_MONO</span></td></tr>
<tr class="codeline" data-linenumber="108"><td class="num" id="LN108">108</td><td class="line">            <span class='comment'>// The system time may jump while this function is waiting. To compensate for this and time</span></td></tr>
<tr class="codeline" data-linenumber="109"><td class="num" id="LN109">109</td><td class="line">            <span class='comment'>// out near the correct time, we could call do_wait_until() in a loop with a short timeout</span></td></tr>
<tr class="codeline" data-linenumber="110"><td class="num" id="LN110">110</td><td class="line">            <span class='comment'>// and recheck the time remaining each time through the loop. However, because we can't</span></td></tr>
<tr class="codeline" data-linenumber="111"><td class="num" id="LN111">111</td><td class="line">            <span class='comment'>// check the predicate each time do_wait_until() completes, this introduces the possibility</span></td></tr>
<tr class="codeline" data-linenumber="112"><td class="num" id="LN112">112</td><td class="line">            <span class='comment'>// of not exiting the function when a notification occurs, since do_wait_until() may report</span></td></tr>
<tr class="codeline" data-linenumber="113"><td class="num" id="LN113">113</td><td class="line">            <span class='comment'>// that it timed out even though a notification was received. The best this function can do</span></td></tr>
<tr class="codeline" data-linenumber="114"><td class="num" id="LN114">114</td><td class="line">            <span class='comment'>// is report correctly whether or not it reached the timeout time.</span></td></tr>
<tr class="codeline" data-linenumber="115"><td class="num" id="LN115">115</td><td class="line">            <span class='keyword'>const</span> detail::platform_duration d(ts - detail::real_platform_clock::now());</td></tr>
<tr class="codeline" data-linenumber="116"><td class="num" id="LN116">116</td><td class="line">            do_wait_until(m, detail::internal_platform_clock::now() + d);</td></tr>
<tr class="codeline" data-linenumber="117"><td class="num" id="LN117">117</td><td class="line">            <span class='keyword'>return</span> ts &gt; detail::real_platform_clock::now();</td></tr>
<tr class="codeline" data-linenumber="118"><td class="num" id="LN118">118</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="119"><td class="num" id="LN119">119</td><td class="line">            <span class='keyword'>return</span> do_wait_until(m, ts);</td></tr>
<tr class="codeline" data-linenumber="120"><td class="num" id="LN120">120</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="121"><td class="num" id="LN121">121</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="122"><td class="num" id="LN122">122</td><td class="line">        <span class='keyword'>bool</span> timed_wait(</td></tr>
<tr class="codeline" data-linenumber="123"><td class="num" id="LN123">123</td><td class="line">            unique_lock&lt;mutex&gt;&amp; m,</td></tr>
<tr class="codeline" data-linenumber="124"><td class="num" id="LN124">124</td><td class="line">            ::boost::xtime <span class='keyword'>const</span>&amp; abs_time)</td></tr>
<tr class="codeline" data-linenumber="125"><td class="num" id="LN125">125</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="126"><td class="num" id="LN126">126</td><td class="line">            <span class='keyword'>return</span> timed_wait(m,system_time(abs_time));</td></tr>
<tr class="codeline" data-linenumber="127"><td class="num" id="LN127">127</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="128"><td class="num" id="LN128">128</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="129"><td class="num" id="LN129">129</td><td class="line">        <span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> duration_type&gt;</td></tr>
<tr class="codeline" data-linenumber="130"><td class="num" id="LN130">130</td><td class="line">        <span class='keyword'>bool</span> timed_wait(</td></tr>
<tr class="codeline" data-linenumber="131"><td class="num" id="LN131">131</td><td class="line">            unique_lock&lt;mutex&gt;&amp; m,</td></tr>
<tr class="codeline" data-linenumber="132"><td class="num" id="LN132">132</td><td class="line">            duration_type <span class='keyword'>const</span>&amp; wait_duration)</td></tr>
<tr class="codeline" data-linenumber="133"><td class="num" id="LN133">133</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="134"><td class="num" id="LN134">134</td><td class="line">            <span class='keyword'>if</span> (wait_duration.is_pos_infinity())</td></tr>
<tr class="codeline" data-linenumber="135"><td class="num" id="LN135">135</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="136"><td class="num" id="LN136">136</td><td class="line">                wait(m);</td></tr>
<tr class="codeline" data-linenumber="137"><td class="num" id="LN137">137</td><td class="line">                <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="138"><td class="num" id="LN138">138</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="139"><td class="num" id="LN139">139</td><td class="line">            <span class='keyword'>if</span> (wait_duration.is_special())</td></tr>
<tr class="codeline" data-linenumber="140"><td class="num" id="LN140">140</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="141"><td class="num" id="LN141">141</td><td class="line">                <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="142"><td class="num" id="LN142">142</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="143"><td class="num" id="LN143">143</td><td class="line">            detail::platform_duration d(wait_duration);</td></tr>
<tr class="codeline" data-linenumber="144"><td class="num" id="LN144">144</td><td class="line"><span class='directive'>#if defined(BOOST_THREAD_HAS_MONO_CLOCK) &amp;&amp; !defined(BOOST_THREAD_INTERNAL_CLOCK_IS_MONO)</span></td></tr>
<tr class="codeline" data-linenumber="145"><td class="num" id="LN145">145</td><td class="line">            <span class='comment'>// The system time may jump while this function is waiting. To compensate for this and time</span></td></tr>
<tr class="codeline" data-linenumber="146"><td class="num" id="LN146">146</td><td class="line">            <span class='comment'>// out near the correct time, we could call do_wait_until() in a loop with a short timeout</span></td></tr>
<tr class="codeline" data-linenumber="147"><td class="num" id="LN147">147</td><td class="line">            <span class='comment'>// and recheck the time remaining each time through the loop. However, because we can't</span></td></tr>
<tr class="codeline" data-linenumber="148"><td class="num" id="LN148">148</td><td class="line">            <span class='comment'>// check the predicate each time do_wait_until() completes, this introduces the possibility</span></td></tr>
<tr class="codeline" data-linenumber="149"><td class="num" id="LN149">149</td><td class="line">            <span class='comment'>// of not exiting the function when a notification occurs, since do_wait_until() may report</span></td></tr>
<tr class="codeline" data-linenumber="150"><td class="num" id="LN150">150</td><td class="line">            <span class='comment'>// that it timed out even though a notification was received. The best this function can do</span></td></tr>
<tr class="codeline" data-linenumber="151"><td class="num" id="LN151">151</td><td class="line">            <span class='comment'>// is report correctly whether or not it reached the timeout time.</span></td></tr>
<tr class="codeline" data-linenumber="152"><td class="num" id="LN152">152</td><td class="line">            <span class='keyword'>const</span> detail::mono_platform_timepoint ts(detail::mono_platform_clock::now() + d);</td></tr>
<tr class="codeline" data-linenumber="153"><td class="num" id="LN153">153</td><td class="line">            do_wait_until(m, detail::internal_platform_clock::now() + d);</td></tr>
<tr class="codeline" data-linenumber="154"><td class="num" id="LN154">154</td><td class="line">            <span class='keyword'>return</span> ts &gt; detail::mono_platform_clock::now();</td></tr>
<tr class="codeline" data-linenumber="155"><td class="num" id="LN155">155</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="156"><td class="num" id="LN156">156</td><td class="line">            <span class='keyword'>return</span> do_wait_until(m, detail::internal_platform_clock::now() + d);</td></tr>
<tr class="codeline" data-linenumber="157"><td class="num" id="LN157">157</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="158"><td class="num" id="LN158">158</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="159"><td class="num" id="LN159">159</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="160"><td class="num" id="LN160">160</td><td class="line">        <span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> predicate_type&gt;</td></tr>
<tr class="codeline" data-linenumber="161"><td class="num" id="LN161">161</td><td class="line">        <span class='keyword'>bool</span> timed_wait(</td></tr>
<tr class="codeline" data-linenumber="162"><td class="num" id="LN162">162</td><td class="line">            unique_lock&lt;mutex&gt;&amp; m,</td></tr>
<tr class="codeline" data-linenumber="163"><td class="num" id="LN163">163</td><td class="line">            boost::system_time <span class='keyword'>const</span>&amp; abs_time,predicate_type pred)</td></tr>
<tr class="codeline" data-linenumber="164"><td class="num" id="LN164">164</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="165"><td class="num" id="LN165">165</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_WAIT_BUG</span></td></tr>
<tr class="codeline" data-linenumber="166"><td class="num" id="LN166">166</td><td class="line">            <span class='keyword'>const</span> detail::real_platform_timepoint ts(abs_time + BOOST_THREAD_WAIT_BUG);</td></tr>
<tr class="codeline" data-linenumber="167"><td class="num" id="LN167">167</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="168"><td class="num" id="LN168">168</td><td class="line">            <span class='keyword'>const</span> detail::real_platform_timepoint ts(abs_time);</td></tr>
<tr class="codeline" data-linenumber="169"><td class="num" id="LN169">169</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="170"><td class="num" id="LN170">170</td><td class="line">            <span class='keyword'>while</span> (!pred())</td></tr>
<tr class="codeline" data-linenumber="171"><td class="num" id="LN171">171</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="172"><td class="num" id="LN172">172</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_INTERNAL_CLOCK_IS_MONO</span></td></tr>
<tr class="codeline" data-linenumber="173"><td class="num" id="LN173">173</td><td class="line">                <span class='comment'>// The system time may jump while this function is waiting. To compensate for this</span></td></tr>
<tr class="codeline" data-linenumber="174"><td class="num" id="LN174">174</td><td class="line">                <span class='comment'>// and time out near the correct time, we call do_wait_until() in a loop with a</span></td></tr>
<tr class="codeline" data-linenumber="175"><td class="num" id="LN175">175</td><td class="line">                <span class='comment'>// short timeout and recheck the time remaining each time through the loop.</span></td></tr>
<tr class="codeline" data-linenumber="176"><td class="num" id="LN176">176</td><td class="line">                detail::platform_duration d(ts - detail::real_platform_clock::now());</td></tr>
<tr class="codeline" data-linenumber="177"><td class="num" id="LN177">177</td><td class="line">                <span class='keyword'>if</span> (d &lt;= detail::platform_duration::zero()) <span class='keyword'>break</span>; <span class='comment'>// timeout occurred</span></td></tr>
<tr class="codeline" data-linenumber="178"><td class="num" id="LN178">178</td><td class="line">                d = (std::min)(d, detail::platform_milliseconds(<span class='macro'>BOOST_THREAD_POLL_INTERVAL_MILLISECONDS<span class='macro_popup'>100</span></span>));</td></tr>
<tr class="codeline" data-linenumber="179"><td class="num" id="LN179">179</td><td class="line">                do_wait_until(m, detail::internal_platform_clock::now() + d);</td></tr>
<tr class="codeline" data-linenumber="180"><td class="num" id="LN180">180</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="181"><td class="num" id="LN181">181</td><td class="line">                <span class='keyword'>if</span> (!do_wait_until(m, ts)) <span class='keyword'>break</span>; <span class='comment'>// timeout occurred</span></td></tr>
<tr class="codeline" data-linenumber="182"><td class="num" id="LN182">182</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="183"><td class="num" id="LN183">183</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="184"><td class="num" id="LN184">184</td><td class="line">            <span class='keyword'>return</span> pred();</td></tr>
<tr class="codeline" data-linenumber="185"><td class="num" id="LN185">185</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="186"><td class="num" id="LN186">186</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="187"><td class="num" id="LN187">187</td><td class="line">        <span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> predicate_type&gt;</td></tr>
<tr class="codeline" data-linenumber="188"><td class="num" id="LN188">188</td><td class="line">        <span class='keyword'>bool</span> timed_wait(</td></tr>
<tr class="codeline" data-linenumber="189"><td class="num" id="LN189">189</td><td class="line">            unique_lock&lt;mutex&gt;&amp; m,</td></tr>
<tr class="codeline" data-linenumber="190"><td class="num" id="LN190">190</td><td class="line">            ::boost::xtime <span class='keyword'>const</span>&amp; abs_time,predicate_type pred)</td></tr>
<tr class="codeline" data-linenumber="191"><td class="num" id="LN191">191</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="192"><td class="num" id="LN192">192</td><td class="line">            <span class='keyword'>return</span> timed_wait(m,system_time(abs_time),pred);</td></tr>
<tr class="codeline" data-linenumber="193"><td class="num" id="LN193">193</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="194"><td class="num" id="LN194">194</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="195"><td class="num" id="LN195">195</td><td class="line">        <span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> duration_type,<span class='keyword'>typename</span> predicate_type&gt;</td></tr>
<tr class="codeline" data-linenumber="196"><td class="num" id="LN196">196</td><td class="line">        <span class='keyword'>bool</span> timed_wait(</td></tr>
<tr class="codeline" data-linenumber="197"><td class="num" id="LN197">197</td><td class="line">            unique_lock&lt;mutex&gt;&amp; m,</td></tr>
<tr class="codeline" data-linenumber="198"><td class="num" id="LN198">198</td><td class="line">            duration_type <span class='keyword'>const</span>&amp; wait_duration,predicate_type pred)</td></tr>
<tr class="codeline" data-linenumber="199"><td class="num" id="LN199">199</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="200"><td class="num" id="LN200">200</td><td class="line">            <span class='keyword'>if</span> (wait_duration.is_pos_infinity())</td></tr>
<tr class="codeline" data-linenumber="201"><td class="num" id="LN201">201</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="202"><td class="num" id="LN202">202</td><td class="line">                <span class='keyword'>while</span> (!pred())</td></tr>
<tr class="codeline" data-linenumber="203"><td class="num" id="LN203">203</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="204"><td class="num" id="LN204">204</td><td class="line">                    wait(m);</td></tr>
<tr class="codeline" data-linenumber="205"><td class="num" id="LN205">205</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="206"><td class="num" id="LN206">206</td><td class="line">                <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="207"><td class="num" id="LN207">207</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="208"><td class="num" id="LN208">208</td><td class="line">            <span class='keyword'>if</span> (wait_duration.is_special())</td></tr>
<tr class="codeline" data-linenumber="209"><td class="num" id="LN209">209</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="210"><td class="num" id="LN210">210</td><td class="line">                <span class='keyword'>return</span> pred();</td></tr>
<tr class="codeline" data-linenumber="211"><td class="num" id="LN211">211</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="212"><td class="num" id="LN212">212</td><td class="line">            detail::platform_duration d(wait_duration);</td></tr>
<tr class="codeline" data-linenumber="213"><td class="num" id="LN213">213</td><td class="line"><span class='directive'>#if defined(BOOST_THREAD_HAS_MONO_CLOCK) &amp;&amp; !defined(BOOST_THREAD_INTERNAL_CLOCK_IS_MONO)</span></td></tr>
<tr class="codeline" data-linenumber="214"><td class="num" id="LN214">214</td><td class="line">            <span class='comment'>// The system time may jump while this function is waiting. To compensate for this</span></td></tr>
<tr class="codeline" data-linenumber="215"><td class="num" id="LN215">215</td><td class="line">            <span class='comment'>// and time out near the correct time, we call do_wait_until() in a loop with a</span></td></tr>
<tr class="codeline" data-linenumber="216"><td class="num" id="LN216">216</td><td class="line">            <span class='comment'>// short timeout and recheck the time remaining each time through the loop.</span></td></tr>
<tr class="codeline" data-linenumber="217"><td class="num" id="LN217">217</td><td class="line">            <span class='keyword'>const</span> detail::mono_platform_timepoint ts(detail::mono_platform_clock::now() + d);</td></tr>
<tr class="codeline" data-linenumber="218"><td class="num" id="LN218">218</td><td class="line">            <span class='keyword'>while</span> (!pred())</td></tr>
<tr class="codeline" data-linenumber="219"><td class="num" id="LN219">219</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="220"><td class="num" id="LN220">220</td><td class="line">                <span class='keyword'>if</span> (d &lt;= detail::platform_duration::zero()) <span class='keyword'>break</span>; <span class='comment'>// timeout occurred</span></td></tr>
<tr class="codeline" data-linenumber="221"><td class="num" id="LN221">221</td><td class="line">                d = (std::min)(d, detail::platform_milliseconds(<span class='macro'>BOOST_THREAD_POLL_INTERVAL_MILLISECONDS<span class='macro_popup'>100</span></span>));</td></tr>
<tr class="codeline" data-linenumber="222"><td class="num" id="LN222">222</td><td class="line">                do_wait_until(m, detail::internal_platform_clock::now() + d);</td></tr>
<tr class="codeline" data-linenumber="223"><td class="num" id="LN223">223</td><td class="line">                d = ts - detail::mono_platform_clock::now();</td></tr>
<tr class="codeline" data-linenumber="224"><td class="num" id="LN224">224</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="225"><td class="num" id="LN225">225</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="226"><td class="num" id="LN226">226</td><td class="line">            <span class='keyword'>const</span> detail::internal_platform_timepoint ts(detail::internal_platform_clock::now() + d);</td></tr>
<tr class="codeline" data-linenumber="227"><td class="num" id="LN227">227</td><td class="line">            <span class='keyword'>while</span> (!pred())</td></tr>
<tr class="codeline" data-linenumber="228"><td class="num" id="LN228">228</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="229"><td class="num" id="LN229">229</td><td class="line">                <span class='keyword'>if</span> (!do_wait_until(m, ts)) <span class='keyword'>break</span>; <span class='comment'>// timeout occurred</span></td></tr>
<tr class="codeline" data-linenumber="230"><td class="num" id="LN230">230</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="231"><td class="num" id="LN231">231</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="232"><td class="num" id="LN232">232</td><td class="line">            <span class='keyword'>return</span> pred();</td></tr>
<tr class="codeline" data-linenumber="233"><td class="num" id="LN233">233</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="234"><td class="num" id="LN234">234</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="235"><td class="num" id="LN235">235</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="236"><td class="num" id="LN236">236</td><td class="line"><span class='directive'>#ifdef BOOST_THREAD_USES_CHRONO</span></td></tr>
<tr class="codeline" data-linenumber="237"><td class="num" id="LN237">237</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="238"><td class="num" id="LN238">238</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Duration&gt;</td></tr>
<tr class="codeline" data-linenumber="239"><td class="num" id="LN239">239</td><td class="line">        cv_status</td></tr>
<tr class="codeline" data-linenumber="240"><td class="num" id="LN240">240</td><td class="line">        wait_until(</td></tr>
<tr class="codeline" data-linenumber="241"><td class="num" id="LN241">241</td><td class="line">                unique_lock&lt;mutex&gt;&amp; lock,</td></tr>
<tr class="codeline" data-linenumber="242"><td class="num" id="LN242">242</td><td class="line">                <span class='keyword'>const</span> chrono::time_point&lt;detail::internal_chrono_clock, Duration&gt;&amp; t)</td></tr>
<tr class="codeline" data-linenumber="243"><td class="num" id="LN243">243</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="244"><td class="num" id="LN244">244</td><td class="line">            <span class='keyword'>const</span> detail::internal_platform_timepoint ts(t);</td></tr>
<tr class="codeline" data-linenumber="245"><td class="num" id="LN245">245</td><td class="line">            <span class='keyword'>if</span> (do_wait_until(lock, ts)) <span class='keyword'>return</span> cv_status::no_timeout;</td></tr>
<tr class="codeline" data-linenumber="246"><td class="num" id="LN246">246</td><td class="line">            <span class='keyword'>else</span> <span class='keyword'>return</span> cv_status::timeout;</td></tr>
<tr class="codeline" data-linenumber="247"><td class="num" id="LN247">247</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="248"><td class="num" id="LN248">248</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="249"><td class="num" id="LN249">249</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Clock, <span class='keyword'>class</span> Duration&gt;</td></tr>
<tr class="codeline" data-linenumber="250"><td class="num" id="LN250">250</td><td class="line">        cv_status</td></tr>
<tr class="codeline" data-linenumber="251"><td class="num" id="LN251">251</td><td class="line">        wait_until(</td></tr>
<tr class="codeline" data-linenumber="252"><td class="num" id="LN252">252</td><td class="line">                unique_lock&lt;mutex&gt;&amp; lock,</td></tr>
<tr class="codeline" data-linenumber="253"><td class="num" id="LN253">253</td><td class="line">                <span class='keyword'>const</span> chrono::time_point&lt;Clock, Duration&gt;&amp; t)</td></tr>
<tr class="codeline" data-linenumber="254"><td class="num" id="LN254">254</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="255"><td class="num" id="LN255">255</td><td class="line">            <span class='comment'>// The system time may jump while this function is waiting. To compensate for this and time</span></td></tr>
<tr class="codeline" data-linenumber="256"><td class="num" id="LN256">256</td><td class="line">            <span class='comment'>// out near the correct time, we could call do_wait_until() in a loop with a short timeout</span></td></tr>
<tr class="codeline" data-linenumber="257"><td class="num" id="LN257">257</td><td class="line">            <span class='comment'>// and recheck the time remaining each time through the loop. However, because we can't</span></td></tr>
<tr class="codeline" data-linenumber="258"><td class="num" id="LN258">258</td><td class="line">            <span class='comment'>// check the predicate each time do_wait_until() completes, this introduces the possibility</span></td></tr>
<tr class="codeline" data-linenumber="259"><td class="num" id="LN259">259</td><td class="line">            <span class='comment'>// of not exiting the function when a notification occurs, since do_wait_until() may report</span></td></tr>
<tr class="codeline" data-linenumber="260"><td class="num" id="LN260">260</td><td class="line">            <span class='comment'>// that it timed out even though a notification was received. The best this function can do</span></td></tr>
<tr class="codeline" data-linenumber="261"><td class="num" id="LN261">261</td><td class="line">            <span class='comment'>// is report correctly whether or not it reached the timeout time.</span></td></tr>
<tr class="codeline" data-linenumber="262"><td class="num" id="LN262">262</td><td class="line">            <span class='keyword'>typedef</span> <span class='keyword'>typename</span> common_type&lt;Duration, <span class='keyword'>typename</span> Clock::duration&gt;::type common_duration;</td></tr>
<tr class="codeline" data-linenumber="263"><td class="num" id="LN263">263</td><td class="line">            common_duration d(t - Clock::now());</td></tr>
<tr class="codeline" data-linenumber="264"><td class="num" id="LN264">264</td><td class="line">            do_wait_until(lock, detail::internal_chrono_clock::now() + d);</td></tr>
<tr class="codeline" data-linenumber="265"><td class="num" id="LN265">265</td><td class="line">            <span class='keyword'>if</span> (t &gt; Clock::now()) <span class='keyword'>return</span> cv_status::no_timeout;</td></tr>
<tr class="codeline" data-linenumber="266"><td class="num" id="LN266">266</td><td class="line">            <span class='keyword'>else</span> <span class='keyword'>return</span> cv_status::timeout;</td></tr>
<tr class="codeline" data-linenumber="267"><td class="num" id="LN267">267</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="268"><td class="num" id="LN268">268</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="269"><td class="num" id="LN269">269</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Rep, <span class='keyword'>class</span> Period&gt;</td></tr>
<tr class="codeline" data-linenumber="270"><td class="num" id="LN270">270</td><td class="line">        cv_status</td></tr>
<tr class="codeline" data-linenumber="271"><td class="num" id="LN271">271</td><td class="line">        wait_for(</td></tr>
<tr class="codeline" data-linenumber="272"><td class="num" id="LN272">272</td><td class="line">                unique_lock&lt;mutex&gt;&amp; lock,</td></tr>
<tr class="codeline" data-linenumber="273"><td class="num" id="LN273">273</td><td class="line">                <span class='keyword'>const</span> chrono::duration&lt;Rep, Period&gt;&amp; d)</td></tr>
<tr class="codeline" data-linenumber="274"><td class="num" id="LN274">274</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="275"><td class="num" id="LN275">275</td><td class="line">            <span class='keyword'>return</span> wait_until(lock, chrono::steady_clock::now() + d);</td></tr>
<tr class="codeline" data-linenumber="276"><td class="num" id="LN276">276</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="277"><td class="num" id="LN277">277</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="278"><td class="num" id="LN278">278</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Duration, <span class='keyword'>class</span> Predicate&gt;</td></tr>
<tr class="codeline" data-linenumber="279"><td class="num" id="LN279">279</td><td class="line">        <span class='keyword'>bool</span></td></tr>
<tr class="codeline" data-linenumber="280"><td class="num" id="LN280">280</td><td class="line">        wait_until(</td></tr>
<tr class="codeline" data-linenumber="281"><td class="num" id="LN281">281</td><td class="line">                unique_lock&lt;mutex&gt;&amp; lock,</td></tr>
<tr class="codeline" data-linenumber="282"><td class="num" id="LN282">282</td><td class="line">                <span class='keyword'>const</span> chrono::time_point&lt;detail::internal_chrono_clock, Duration&gt;&amp; t,</td></tr>
<tr class="codeline" data-linenumber="283"><td class="num" id="LN283">283</td><td class="line">                Predicate pred)</td></tr>
<tr class="codeline" data-linenumber="284"><td class="num" id="LN284">284</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="285"><td class="num" id="LN285">285</td><td class="line">            <span class='keyword'>const</span> detail::internal_platform_timepoint ts(t);</td></tr>
<tr class="codeline" data-linenumber="286"><td class="num" id="LN286">286</td><td class="line">            <span class='keyword'>while</span> (!pred())</td></tr>
<tr class="codeline" data-linenumber="287"><td class="num" id="LN287">287</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="288"><td class="num" id="LN288">288</td><td class="line">                <span class='keyword'>if</span> (!do_wait_until(lock, ts)) <span class='keyword'>break</span>; <span class='comment'>// timeout occurred</span></td></tr>
<tr class="codeline" data-linenumber="289"><td class="num" id="LN289">289</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="290"><td class="num" id="LN290">290</td><td class="line">            <span class='keyword'>return</span> pred();</td></tr>
<tr class="codeline" data-linenumber="291"><td class="num" id="LN291">291</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="292"><td class="num" id="LN292">292</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="293"><td class="num" id="LN293">293</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Clock, <span class='keyword'>class</span> Duration, <span class='keyword'>class</span> Predicate&gt;</td></tr>
<tr class="codeline" data-linenumber="294"><td class="num" id="LN294">294</td><td class="line">        <span class='keyword'>bool</span></td></tr>
<tr class="codeline" data-linenumber="295"><td class="num" id="LN295">295</td><td class="line">        wait_until(</td></tr>
<tr class="codeline" data-linenumber="296"><td class="num" id="LN296">296</td><td class="line">                unique_lock&lt;mutex&gt;&amp; lock,</td></tr>
<tr class="codeline" data-linenumber="297"><td class="num" id="LN297">297</td><td class="line">                <span class='keyword'>const</span> chrono::time_point&lt;Clock, Duration&gt;&amp; t,</td></tr>
<tr class="codeline" data-linenumber="298"><td class="num" id="LN298">298</td><td class="line">                Predicate pred)</td></tr>
<tr class="codeline" data-linenumber="299"><td class="num" id="LN299">299</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="300"><td class="num" id="LN300">300</td><td class="line">            <span class='comment'>// The system time may jump while this function is waiting. To compensate for this</span></td></tr>
<tr class="codeline" data-linenumber="301"><td class="num" id="LN301">301</td><td class="line">            <span class='comment'>// and time out near the correct time, we call do_wait_until() in a loop with a</span></td></tr>
<tr class="codeline" data-linenumber="302"><td class="num" id="LN302">302</td><td class="line">            <span class='comment'>// short timeout and recheck the time remaining each time through the loop.</span></td></tr>
<tr class="codeline" data-linenumber="303"><td class="num" id="LN303">303</td><td class="line">            <span class='keyword'>typedef</span> <span class='keyword'>typename</span> common_type&lt;Duration, <span class='keyword'>typename</span> Clock::duration&gt;::type common_duration;</td></tr>
<tr class="codeline" data-linenumber="304"><td class="num" id="LN304">304</td><td class="line">            <span class='keyword'>while</span> (!pred())</td></tr>
<tr class="codeline" data-linenumber="305"><td class="num" id="LN305">305</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="306"><td class="num" id="LN306">306</td><td class="line">                common_duration d(t - Clock::now());</td></tr>
<tr class="codeline" data-linenumber="307"><td class="num" id="LN307">307</td><td class="line">                <span class='keyword'>if</span> (d &lt;= common_duration::zero()) <span class='keyword'>break</span>; <span class='comment'>// timeout occurred</span></td></tr>
<tr class="codeline" data-linenumber="308"><td class="num" id="LN308">308</td><td class="line">                d = (std::min)(d, common_duration(chrono::milliseconds(<span class='macro'>BOOST_THREAD_POLL_INTERVAL_MILLISECONDS<span class='macro_popup'>100</span></span>)));</td></tr>
<tr class="codeline" data-linenumber="309"><td class="num" id="LN309">309</td><td class="line">                do_wait_until(lock, detail::internal_platform_clock::now() + detail::platform_duration(d));</td></tr>
<tr class="codeline" data-linenumber="310"><td class="num" id="LN310">310</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="311"><td class="num" id="LN311">311</td><td class="line">            <span class='keyword'>return</span> pred();</td></tr>
<tr class="codeline" data-linenumber="312"><td class="num" id="LN312">312</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="313"><td class="num" id="LN313">313</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="314"><td class="num" id="LN314">314</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Rep, <span class='keyword'>class</span> Period, <span class='keyword'>class</span> Predicate&gt;</td></tr>
<tr class="codeline" data-linenumber="315"><td class="num" id="LN315">315</td><td class="line">        <span class='keyword'>bool</span></td></tr>
<tr class="codeline" data-linenumber="316"><td class="num" id="LN316">316</td><td class="line">        wait_for(</td></tr>
<tr class="codeline" data-linenumber="317"><td class="num" id="LN317">317</td><td class="line">                unique_lock&lt;mutex&gt;&amp; lock,</td></tr>
<tr class="codeline" data-linenumber="318"><td class="num" id="LN318">318</td><td class="line">                <span class='keyword'>const</span> chrono::duration&lt;Rep, Period&gt;&amp; d,</td></tr>
<tr class="codeline" data-linenumber="319"><td class="num" id="LN319">319</td><td class="line">                Predicate pred)</td></tr>
<tr class="codeline" data-linenumber="320"><td class="num" id="LN320">320</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="321"><td class="num" id="LN321">321</td><td class="line">            <span class='keyword'>return</span> wait_until(lock, chrono::steady_clock::now() + d, boost::move(pred));</td></tr>
<tr class="codeline" data-linenumber="322"><td class="num" id="LN322">322</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="323"><td class="num" id="LN323">323</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="324"><td class="num" id="LN324">324</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="325"><td class="num" id="LN325">325</td><td class="line"><span class='directive'>#define BOOST_THREAD_DEFINES_CONDITION_VARIABLE_NATIVE_HANDLE</span></td></tr>
<tr class="codeline" data-linenumber="326"><td class="num" id="LN326">326</td><td class="line">        <span class='keyword'>typedef</span> pthread_cond_t* native_handle_type;</td></tr>
<tr class="codeline" data-linenumber="327"><td class="num" id="LN327">327</td><td class="line">        native_handle_type native_handle()</td></tr>
<tr class="codeline" data-linenumber="328"><td class="num" id="LN328">328</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="329"><td class="num" id="LN329">329</td><td class="line">            <span class='keyword'>return</span> &amp;cond;</td></tr>
<tr class="codeline" data-linenumber="330"><td class="num" id="LN330">330</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="331"><td class="num" id="LN331">331</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="332"><td class="num" id="LN332">332</td><td class="line">        <span class='keyword'>void</span> notify_one() <span class='macro'>BOOST_NOEXCEPT<span class='macro_popup'>noexcept</span></span>;</td></tr>
<tr class="codeline" data-linenumber="333"><td class="num" id="LN333">333</td><td class="line">        <span class='keyword'>void</span> notify_all() <span class='macro'>BOOST_NOEXCEPT<span class='macro_popup'>noexcept</span></span>;</td></tr>
<tr class="codeline" data-linenumber="334"><td class="num" id="LN334">334</td><td class="line">    };</td></tr>
<tr class="codeline" data-linenumber="335"><td class="num" id="LN335">335</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="336"><td class="num" id="LN336">336</td><td class="line">    <span class='macro'>BOOST_THREAD_DECL<span class='macro_popup'>__attribute__((__visibility__("default")))</span></span> <span class='keyword'>void</span> notify_all_at_thread_exit(condition_variable&amp; cond, unique_lock&lt;mutex&gt; lk);</td></tr>
<tr class="codeline" data-linenumber="337"><td class="num" id="LN337">337</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="338"><td class="num" id="LN338">338</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="339"><td class="num" id="LN339">339</td><td class="line"><span class='directive'>#include &lt;boost/config/abi_suffix.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="340"><td class="num" id="LN340">340</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="341"><td class="num" id="LN341">341</td><td class="line"><span class='directive'>#endif</span></td></tr>
</table><hr class=divider>
<div id=File281631>
<div class=FileNav><a href="#File369430">&#x2190;</a></div><h4 class=FileName>/usr/local/include/boost/thread/pthread/condition_variable.hpp</h4>
<div class=FileNav><a href="#File368885">&#x2192;</a></div></div>
<table class="code" data-fileid="281631">
<tr class="codeline" data-linenumber="1"><td class="num" id="LN1">1</td><td class="line"><span class='directive'>#ifndef BOOST_THREAD_CONDITION_VARIABLE_PTHREAD_HPP</span></td></tr>
<tr class="codeline" data-linenumber="2"><td class="num" id="LN2">2</td><td class="line"><span class='directive'>#define BOOST_THREAD_CONDITION_VARIABLE_PTHREAD_HPP</span></td></tr>
<tr class="codeline" data-linenumber="3"><td class="num" id="LN3">3</td><td class="line"><span class='comment'>// Distributed under the Boost Software License, Version 1.0. (See</span></td></tr>
<tr class="codeline" data-linenumber="4"><td class="num" id="LN4">4</td><td class="line"><span class='comment'>// accompanying file LICENSE_1_0.txt or copy at</span></td></tr>
<tr class="codeline" data-linenumber="5"><td class="num" id="LN5">5</td><td class="line"><span class='comment'>// http://www.boost.org/LICENSE_1_0.txt)</span></td></tr>
<tr class="codeline" data-linenumber="6"><td class="num" id="LN6">6</td><td class="line"><span class='comment'>// (C) Copyright 2007-10 Anthony Williams</span></td></tr>
<tr class="codeline" data-linenumber="7"><td class="num" id="LN7">7</td><td class="line"><span class='comment'>// (C) Copyright 2011-2012 Vicente J. Botet Escriba</span></td></tr>
<tr class="codeline" data-linenumber="8"><td class="num" id="LN8">8</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="9"><td class="num" id="LN9">9</td><td class="line"><span class='directive'>#include &lt;boost/thread/detail/platform_time.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="10"><td class="num" id="LN10">10</td><td class="line"><span class='directive'>#include &lt;boost/thread/pthread/pthread_mutex_scoped_lock.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="11"><td class="num" id="LN11">11</td><td class="line"><span class='directive'>#include &lt;boost/thread/pthread/pthread_helpers.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="12"><td class="num" id="LN12">12</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="13"><td class="num" id="LN13">13</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="14"><td class="num" id="LN14">14</td><td class="line"><span class='directive'>#include &lt;boost/thread/interruption.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="15"><td class="num" id="LN15">15</td><td class="line"><span class='directive'>#include &lt;boost/thread/pthread/thread_data.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="16"><td class="num" id="LN16">16</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="17"><td class="num" id="LN17">17</td><td class="line"><span class='directive'>#include &lt;boost/thread/pthread/condition_variable_fwd.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="18"><td class="num" id="LN18">18</td><td class="line"><span class='directive'>#ifdef BOOST_THREAD_USES_CHRONO</span></td></tr>
<tr class="codeline" data-linenumber="19"><td class="num" id="LN19">19</td><td class="line"><span class='directive'>#include &lt;boost/chrono/system_clocks.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="20"><td class="num" id="LN20">20</td><td class="line"><span class='directive'>#include &lt;boost/chrono/ceil.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="21"><td class="num" id="LN21">21</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="22"><td class="num" id="LN22">22</td><td class="line"><span class='directive'>#include &lt;boost/thread/detail/delete.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="23"><td class="num" id="LN23">23</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="24"><td class="num" id="LN24">24</td><td class="line"><span class='directive'>#include &lt;algorithm&gt;</span></td></tr>
<tr class="codeline" data-linenumber="25"><td class="num" id="LN25">25</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="26"><td class="num" id="LN26">26</td><td class="line"><span class='directive'>#include &lt;boost/config/abi_prefix.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="27"><td class="num" id="LN27">27</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="28"><td class="num" id="LN28">28</td><td class="line"><span class='keyword'>namespace</span> boost</td></tr>
<tr class="codeline" data-linenumber="29"><td class="num" id="LN29">29</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="30"><td class="num" id="LN30">30</td><td class="line">    <span class='keyword'>namespace</span> thread_cv_detail</td></tr>
<tr class="codeline" data-linenumber="31"><td class="num" id="LN31">31</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="32"><td class="num" id="LN32">32</td><td class="line">        <span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> MutexType&gt;</td></tr>
<tr class="codeline" data-linenumber="33"><td class="num" id="LN33">33</td><td class="line">        <span class='keyword'>struct</span> lock_on_exit</td></tr>
<tr class="codeline" data-linenumber="34"><td class="num" id="LN34">34</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="35"><td class="num" id="LN35">35</td><td class="line">            MutexType* m;</td></tr>
<tr class="codeline" data-linenumber="36"><td class="num" id="LN36">36</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="37"><td class="num" id="LN37">37</td><td class="line">            lock_on_exit():</td></tr>
<tr class="codeline" data-linenumber="38"><td class="num" id="LN38">38</td><td class="line">                m(0)</td></tr>
<tr class="codeline" data-linenumber="39"><td class="num" id="LN39">39</td><td class="line">            {}</td></tr>
<tr class="codeline" data-linenumber="40"><td class="num" id="LN40">40</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="41"><td class="num" id="LN41">41</td><td class="line">            <span class='keyword'>void</span> activate(MutexType&amp; m_)</td></tr>
<tr class="codeline" data-linenumber="42"><td class="num" id="LN42">42</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="43"><td class="num" id="LN43">43</td><td class="line">                m_.unlock();</td></tr>
<tr class="codeline" data-linenumber="44"><td class="num" id="LN44">44</td><td class="line">                m=&amp;m_;</td></tr>
<tr class="codeline" data-linenumber="45"><td class="num" id="LN45">45</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="46"><td class="num" id="LN46">46</td><td class="line">            <span class='keyword'>void</span> deactivate()</td></tr>
<tr class="codeline" data-linenumber="47"><td class="num" id="LN47">47</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="48"><td class="num" id="LN48">48</td><td class="line">                <span class='keyword'>if</span> (m)</td></tr>
<tr class="codeline" data-linenumber="49"><td class="num" id="LN49">49</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="50"><td class="num" id="LN50">50</td><td class="line">                    m-&gt;lock();</td></tr>
<tr class="codeline" data-linenumber="51"><td class="num" id="LN51">51</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="52"><td class="num" id="LN52">52</td><td class="line">                m = 0;</td></tr>
<tr class="codeline" data-linenumber="53"><td class="num" id="LN53">53</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="54"><td class="num" id="LN54">54</td><td class="line">            ~lock_on_exit() <span class='macro'>BOOST_NOEXCEPT_IF(<span class='keyword'>false</span>)<span class='macro_popup'>noexcept((false))</span></span></td></tr>
<tr class="codeline" data-linenumber="55"><td class="num" id="LN55">55</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="56"><td class="num" id="LN56">56</td><td class="line">                <span class='keyword'>if</span> (m)</td></tr>
<tr class="codeline" data-linenumber="57"><td class="num" id="LN57">57</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="58"><td class="num" id="LN58">58</td><td class="line">                    m-&gt;lock();</td></tr>
<tr class="codeline" data-linenumber="59"><td class="num" id="LN59">59</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="60"><td class="num" id="LN60">60</td><td class="line">           }</td></tr>
<tr class="codeline" data-linenumber="61"><td class="num" id="LN61">61</td><td class="line">        };</td></tr>
<tr class="codeline" data-linenumber="62"><td class="num" id="LN62">62</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="63"><td class="num" id="LN63">63</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="64"><td class="num" id="LN64">64</td><td class="line">    <span class='keyword'>inline</span> <span class='keyword'>void</span> condition_variable::wait(unique_lock&lt;mutex&gt;&amp; m)</td></tr>
<tr class="codeline" data-linenumber="65"><td class="num" id="LN65">65</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="66"><td class="num" id="LN66">66</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_THROW_IF_PRECONDITION_NOT_SATISFIED</span></td></tr>
<tr class="codeline" data-linenumber="67"><td class="num" id="LN67">67</td><td class="line">        <span class='keyword'>if</span>(! m.owns_lock())</td></tr>
<tr class="codeline" data-linenumber="68"><td class="num" id="LN68">68</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="69"><td class="num" id="LN69">69</td><td class="line">            boost::throw_exception(condition_error(-1, <span class='string_literal'>"boost::condition_variable::wait() failed precondition mutex not owned"</span>));</td></tr>
<tr class="codeline" data-linenumber="70"><td class="num" id="LN70">70</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="71"><td class="num" id="LN71">71</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="72"><td class="num" id="LN72">72</td><td class="line">        <span class='keyword'>int</span> res=0;</td></tr>
<tr class="codeline" data-linenumber="73"><td class="num" id="LN73">73</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="74"><td class="num" id="LN74">74</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="75"><td class="num" id="LN75">75</td><td class="line">            thread_cv_detail::lock_on_exit&lt;unique_lock&lt;mutex&gt; &gt; guard;</td></tr>
<tr class="codeline" data-linenumber="76"><td class="num" id="LN76">76</td><td class="line">            detail::interruption_checker check_for_interruption(&amp;internal_mutex,&amp;cond);</td></tr>
<tr class="codeline" data-linenumber="77"><td class="num" id="LN77">77</td><td class="line">            pthread_mutex_t* the_mutex = &amp;internal_mutex;</td></tr>
<tr class="codeline" data-linenumber="78"><td class="num" id="LN78">78</td><td class="line">            guard.activate(m);</td></tr>
<tr class="codeline" data-linenumber="79"><td class="num" id="LN79">79</td><td class="line">            res = posix::pthread_cond_wait(&amp;cond,the_mutex);</td></tr>
<tr class="codeline" data-linenumber="80"><td class="num" id="LN80">80</td><td class="line">            <span class="mrange"><span class="mrange">check_for_interruption.unlock_if_locked()</span></span>;</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path22" class="msg msgEvent" style="margin-left:13ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">22</div></td><td><div class="PathNav"><a href="#Path21" title="Previous event (21)">&#x2190;</a></div></td><td>Calling 'interruption_checker::unlock_if_locked'</td><td><div class="PathNav"><a href="#Path23" title="Next event (23)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path36" class="msg msgEvent" style="margin-left:13ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">36</div></td><td><div class="PathNav"><a href="#Path35" title="Previous event (35)">&#x2190;</a></div></td><td>Returning from 'interruption_checker::unlock_if_locked'</td><td><div class="PathNav"><a href="#Path37" title="Next event (37)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="81"><td class="num" id="LN81">81</td><td class="line">            guard.deactivate();</td></tr>
<tr class="codeline" data-linenumber="82"><td class="num" id="LN82">82</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="83"><td class="num" id="LN83">83</td><td class="line">            pthread_mutex_t* the_mutex = m.mutex()-&gt;native_handle();</td></tr>
<tr class="codeline" data-linenumber="84"><td class="num" id="LN84">84</td><td class="line">            res = posix::pthread_cond_wait(&amp;cond,the_mutex);</td></tr>
<tr class="codeline" data-linenumber="85"><td class="num" id="LN85">85</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="86"><td class="num" id="LN86">86</td><td class="line">        }</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path37" class="msg msgEvent" style="margin-left:9ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">37</div></td><td><div class="PathNav"><a href="#Path36" title="Previous event (36)">&#x2190;</a></div></td><td>Calling '~interruption_checker'</td><td><div class="PathNav"><a href="#Path38" title="Next event (38)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="87"><td class="num" id="LN87">87</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="88"><td class="num" id="LN88">88</td><td class="line">        this_thread::interruption_point();</td></tr>
<tr class="codeline" data-linenumber="89"><td class="num" id="LN89">89</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="90"><td class="num" id="LN90">90</td><td class="line">        <span class='keyword'>if</span>(res)</td></tr>
<tr class="codeline" data-linenumber="91"><td class="num" id="LN91">91</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="92"><td class="num" id="LN92">92</td><td class="line">            boost::throw_exception(condition_error(res, <span class='string_literal'>"boost::condition_variable::wait failed in pthread_cond_wait"</span>));</td></tr>
<tr class="codeline" data-linenumber="93"><td class="num" id="LN93">93</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="94"><td class="num" id="LN94">94</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="95"><td class="num" id="LN95">95</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="96"><td class="num" id="LN96">96</td><td class="line">    <span class='comment'>// When this function returns true:</span></td></tr>
<tr class="codeline" data-linenumber="97"><td class="num" id="LN97">97</td><td class="line">    <span class='comment'>// * A notification (or sometimes a spurious OS signal) has been received</span></td></tr>
<tr class="codeline" data-linenumber="98"><td class="num" id="LN98">98</td><td class="line">    <span class='comment'>// * Do not assume that the timeout has not been reached</span></td></tr>
<tr class="codeline" data-linenumber="99"><td class="num" id="LN99">99</td><td class="line">    <span class='comment'>// * Do not assume that the predicate has been changed</span></td></tr>
<tr class="codeline" data-linenumber="100"><td class="num" id="LN100">100</td><td class="line">    <span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="101"><td class="num" id="LN101">101</td><td class="line">    <span class='comment'>// When this function returns false:</span></td></tr>
<tr class="codeline" data-linenumber="102"><td class="num" id="LN102">102</td><td class="line">    <span class='comment'>// * The timeout has been reached</span></td></tr>
<tr class="codeline" data-linenumber="103"><td class="num" id="LN103">103</td><td class="line">    <span class='comment'>// * Do not assume that a notification has not been received</span></td></tr>
<tr class="codeline" data-linenumber="104"><td class="num" id="LN104">104</td><td class="line">    <span class='comment'>// * Do not assume that the predicate has not been changed</span></td></tr>
<tr class="codeline" data-linenumber="105"><td class="num" id="LN105">105</td><td class="line">    <span class='keyword'>inline</span> <span class='keyword'>bool</span> condition_variable::do_wait_until(</td></tr>
<tr class="codeline" data-linenumber="106"><td class="num" id="LN106">106</td><td class="line">                unique_lock&lt;mutex&gt;&amp; m,</td></tr>
<tr class="codeline" data-linenumber="107"><td class="num" id="LN107">107</td><td class="line">                detail::internal_platform_timepoint <span class='keyword'>const</span> &amp;timeout)</td></tr>
<tr class="codeline" data-linenumber="108"><td class="num" id="LN108">108</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="109"><td class="num" id="LN109">109</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_THROW_IF_PRECONDITION_NOT_SATISFIED</span></td></tr>
<tr class="codeline" data-linenumber="110"><td class="num" id="LN110">110</td><td class="line">        <span class='keyword'>if</span> (!m.owns_lock())</td></tr>
<tr class="codeline" data-linenumber="111"><td class="num" id="LN111">111</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="112"><td class="num" id="LN112">112</td><td class="line">            boost::throw_exception(condition_error(<span class='macro'>EPERM<span class='macro_popup'>1</span></span>, <span class='string_literal'>"boost::condition_variable::do_wait_until() failed precondition mutex not owned"</span>));</td></tr>
<tr class="codeline" data-linenumber="113"><td class="num" id="LN113">113</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="114"><td class="num" id="LN114">114</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="115"><td class="num" id="LN115">115</td><td class="line">        <span class='keyword'>int</span> cond_res;</td></tr>
<tr class="codeline" data-linenumber="116"><td class="num" id="LN116">116</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="117"><td class="num" id="LN117">117</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="118"><td class="num" id="LN118">118</td><td class="line">            thread_cv_detail::lock_on_exit&lt;unique_lock&lt;mutex&gt; &gt; guard;</td></tr>
<tr class="codeline" data-linenumber="119"><td class="num" id="LN119">119</td><td class="line">            detail::interruption_checker check_for_interruption(&amp;internal_mutex,&amp;cond);</td></tr>
<tr class="codeline" data-linenumber="120"><td class="num" id="LN120">120</td><td class="line">            pthread_mutex_t* the_mutex = &amp;internal_mutex;</td></tr>
<tr class="codeline" data-linenumber="121"><td class="num" id="LN121">121</td><td class="line">            guard.activate(m);</td></tr>
<tr class="codeline" data-linenumber="122"><td class="num" id="LN122">122</td><td class="line">            cond_res=posix::pthread_cond_timedwait(&amp;cond,the_mutex,&amp;timeout.getTs());</td></tr>
<tr class="codeline" data-linenumber="123"><td class="num" id="LN123">123</td><td class="line">            check_for_interruption.unlock_if_locked();</td></tr>
<tr class="codeline" data-linenumber="124"><td class="num" id="LN124">124</td><td class="line">            guard.deactivate();</td></tr>
<tr class="codeline" data-linenumber="125"><td class="num" id="LN125">125</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="126"><td class="num" id="LN126">126</td><td class="line">            pthread_mutex_t* the_mutex = m.mutex()-&gt;native_handle();</td></tr>
<tr class="codeline" data-linenumber="127"><td class="num" id="LN127">127</td><td class="line">            cond_res=posix::pthread_cond_timedwait(&amp;cond,the_mutex,&amp;timeout.getTs());</td></tr>
<tr class="codeline" data-linenumber="128"><td class="num" id="LN128">128</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="129"><td class="num" id="LN129">129</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="130"><td class="num" id="LN130">130</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="131"><td class="num" id="LN131">131</td><td class="line">        this_thread::interruption_point();</td></tr>
<tr class="codeline" data-linenumber="132"><td class="num" id="LN132">132</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="133"><td class="num" id="LN133">133</td><td class="line">        <span class='keyword'>if</span>(cond_res==<span class='macro'>ETIMEDOUT<span class='macro_popup'>110</span></span>)</td></tr>
<tr class="codeline" data-linenumber="134"><td class="num" id="LN134">134</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="135"><td class="num" id="LN135">135</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="136"><td class="num" id="LN136">136</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="137"><td class="num" id="LN137">137</td><td class="line">        <span class='keyword'>if</span>(cond_res)</td></tr>
<tr class="codeline" data-linenumber="138"><td class="num" id="LN138">138</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="139"><td class="num" id="LN139">139</td><td class="line">            boost::throw_exception(condition_error(cond_res, <span class='string_literal'>"boost::condition_variable::do_wait_until failed in pthread_cond_timedwait"</span>));</td></tr>
<tr class="codeline" data-linenumber="140"><td class="num" id="LN140">140</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="141"><td class="num" id="LN141">141</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="142"><td class="num" id="LN142">142</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="143"><td class="num" id="LN143">143</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="144"><td class="num" id="LN144">144</td><td class="line">    <span class='keyword'>inline</span> <span class='keyword'>void</span> condition_variable::notify_one() <span class='macro'>BOOST_NOEXCEPT<span class='macro_popup'>noexcept</span></span></td></tr>
<tr class="codeline" data-linenumber="145"><td class="num" id="LN145">145</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="146"><td class="num" id="LN146">146</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="147"><td class="num" id="LN147">147</td><td class="line">        boost::pthread::pthread_mutex_scoped_lock internal_lock(&amp;internal_mutex);</td></tr>
<tr class="codeline" data-linenumber="148"><td class="num" id="LN148">148</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="149"><td class="num" id="LN149">149</td><td class="line">        <span class='macro'>BOOST_VERIFY(!posix::pthread_cond_signal(&amp;cond))<span class='macro_popup'>(static_cast &lt;bool&gt; (!posix::pthread_cond_signal(&amp;cond<br>)) ? void (0) : __assert_fail ("!posix::pthread_cond_signal(&amp;cond)"<br>, "/usr/local/include/boost/thread/pthread/condition_variable.hpp"<br>, 149, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="150"><td class="num" id="LN150">150</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="151"><td class="num" id="LN151">151</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="152"><td class="num" id="LN152">152</td><td class="line">    <span class='keyword'>inline</span> <span class='keyword'>void</span> condition_variable::notify_all() <span class='macro'>BOOST_NOEXCEPT<span class='macro_popup'>noexcept</span></span></td></tr>
<tr class="codeline" data-linenumber="153"><td class="num" id="LN153">153</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="154"><td class="num" id="LN154">154</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="155"><td class="num" id="LN155">155</td><td class="line">        boost::pthread::pthread_mutex_scoped_lock internal_lock(&amp;internal_mutex);</td></tr>
<tr class="codeline" data-linenumber="156"><td class="num" id="LN156">156</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="157"><td class="num" id="LN157">157</td><td class="line">        <span class='macro'>BOOST_VERIFY(!posix::pthread_cond_broadcast(&amp;cond))<span class='macro_popup'>(static_cast &lt;bool&gt; (!posix::pthread_cond_broadcast(&amp;<br>cond)) ? void (0) : __assert_fail ("!posix::pthread_cond_broadcast(&amp;cond)"<br>, "/usr/local/include/boost/thread/pthread/condition_variable.hpp"<br>, 157, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="158"><td class="num" id="LN158">158</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="159"><td class="num" id="LN159">159</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="160"><td class="num" id="LN160">160</td><td class="line">    <span class='keyword'>class</span> condition_variable_any</td></tr>
<tr class="codeline" data-linenumber="161"><td class="num" id="LN161">161</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="162"><td class="num" id="LN162">162</td><td class="line">        pthread_mutex_t internal_mutex;</td></tr>
<tr class="codeline" data-linenumber="163"><td class="num" id="LN163">163</td><td class="line">        pthread_cond_t cond;</td></tr>
<tr class="codeline" data-linenumber="164"><td class="num" id="LN164">164</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="165"><td class="num" id="LN165">165</td><td class="line">    <span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="166"><td class="num" id="LN166">166</td><td class="line">        <span class='macro'>BOOST_THREAD_NO_COPYABLE(condition_variable_any)<span class='macro_popup'>condition_variable_any(condition_variable_any const&amp;) = delete<br>; condition_variable_any&amp; operator=(condition_variable_any<br> const&amp;) = delete;</span></span></td></tr>
<tr class="codeline" data-linenumber="167"><td class="num" id="LN167">167</td><td class="line">        condition_variable_any()</td></tr>
<tr class="codeline" data-linenumber="168"><td class="num" id="LN168">168</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="169"><td class="num" id="LN169">169</td><td class="line">            <span class='keyword'>int</span> <span class='keyword'>const</span> res=posix::pthread_mutex_init(&amp;internal_mutex);</td></tr>
<tr class="codeline" data-linenumber="170"><td class="num" id="LN170">170</td><td class="line">            <span class='keyword'>if</span>(res)</td></tr>
<tr class="codeline" data-linenumber="171"><td class="num" id="LN171">171</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="172"><td class="num" id="LN172">172</td><td class="line">                boost::throw_exception(thread_resource_error(res, <span class='string_literal'>"boost::condition_variable_any::condition_variable_any() failed in pthread_mutex_init"</span>));</td></tr>
<tr class="codeline" data-linenumber="173"><td class="num" id="LN173">173</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="174"><td class="num" id="LN174">174</td><td class="line">            <span class='keyword'>int</span> <span class='keyword'>const</span> res2 = posix::pthread_cond_init(&amp;cond);</td></tr>
<tr class="codeline" data-linenumber="175"><td class="num" id="LN175">175</td><td class="line">            <span class='keyword'>if</span>(res2)</td></tr>
<tr class="codeline" data-linenumber="176"><td class="num" id="LN176">176</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="177"><td class="num" id="LN177">177</td><td class="line">                <span class='macro'>BOOST_VERIFY(!posix::pthread_mutex_destroy(&amp;internal_mutex))<span class='macro_popup'>(static_cast &lt;bool&gt; (!posix::pthread_mutex_destroy(&amp;<br>internal_mutex)) ? void (0) : __assert_fail ("!posix::pthread_mutex_destroy(&amp;internal_mutex)"<br>, "/usr/local/include/boost/thread/pthread/condition_variable.hpp"<br>, 177, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="178"><td class="num" id="LN178">178</td><td class="line">                boost::throw_exception(thread_resource_error(res2, <span class='string_literal'>"boost::condition_variable_any::condition_variable_any() failed in pthread_cond_init"</span>));</td></tr>
<tr class="codeline" data-linenumber="179"><td class="num" id="LN179">179</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="180"><td class="num" id="LN180">180</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="181"><td class="num" id="LN181">181</td><td class="line">        ~condition_variable_any()</td></tr>
<tr class="codeline" data-linenumber="182"><td class="num" id="LN182">182</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="183"><td class="num" id="LN183">183</td><td class="line">            <span class='macro'>BOOST_VERIFY(!posix::pthread_mutex_destroy(&amp;internal_mutex))<span class='macro_popup'>(static_cast &lt;bool&gt; (!posix::pthread_mutex_destroy(&amp;<br>internal_mutex)) ? void (0) : __assert_fail ("!posix::pthread_mutex_destroy(&amp;internal_mutex)"<br>, "/usr/local/include/boost/thread/pthread/condition_variable.hpp"<br>, 183, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="184"><td class="num" id="LN184">184</td><td class="line">            <span class='macro'>BOOST_VERIFY(!posix::pthread_cond_destroy(&amp;cond))<span class='macro_popup'>(static_cast &lt;bool&gt; (!posix::pthread_cond_destroy(&amp;<br>cond)) ? void (0) : __assert_fail ("!posix::pthread_cond_destroy(&amp;cond)"<br>, "/usr/local/include/boost/thread/pthread/condition_variable.hpp"<br>, 184, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="185"><td class="num" id="LN185">185</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="186"><td class="num" id="LN186">186</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="187"><td class="num" id="LN187">187</td><td class="line">        <span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> lock_type&gt;</td></tr>
<tr class="codeline" data-linenumber="188"><td class="num" id="LN188">188</td><td class="line">        <span class='keyword'>void</span> wait(lock_type&amp; m)</td></tr>
<tr class="codeline" data-linenumber="189"><td class="num" id="LN189">189</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="190"><td class="num" id="LN190">190</td><td class="line">            <span class='keyword'>int</span> res=0;</td></tr>
<tr class="codeline" data-linenumber="191"><td class="num" id="LN191">191</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="192"><td class="num" id="LN192">192</td><td class="line">                thread_cv_detail::lock_on_exit&lt;lock_type&gt; guard;</td></tr>
<tr class="codeline" data-linenumber="193"><td class="num" id="LN193">193</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="194"><td class="num" id="LN194">194</td><td class="line">                detail::interruption_checker check_for_interruption(&amp;internal_mutex,&amp;cond);</td></tr>
<tr class="codeline" data-linenumber="195"><td class="num" id="LN195">195</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="196"><td class="num" id="LN196">196</td><td class="line">                boost::pthread::pthread_mutex_scoped_lock check_for_interruption(&amp;internal_mutex);</td></tr>
<tr class="codeline" data-linenumber="197"><td class="num" id="LN197">197</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="198"><td class="num" id="LN198">198</td><td class="line">                guard.activate(m);</td></tr>
<tr class="codeline" data-linenumber="199"><td class="num" id="LN199">199</td><td class="line">                res=posix::pthread_cond_wait(&amp;cond,&amp;internal_mutex);</td></tr>
<tr class="codeline" data-linenumber="200"><td class="num" id="LN200">200</td><td class="line">                check_for_interruption.unlock_if_locked();</td></tr>
<tr class="codeline" data-linenumber="201"><td class="num" id="LN201">201</td><td class="line">                guard.deactivate();</td></tr>
<tr class="codeline" data-linenumber="202"><td class="num" id="LN202">202</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="203"><td class="num" id="LN203">203</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="204"><td class="num" id="LN204">204</td><td class="line">            this_thread::interruption_point();</td></tr>
<tr class="codeline" data-linenumber="205"><td class="num" id="LN205">205</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="206"><td class="num" id="LN206">206</td><td class="line">            <span class='keyword'>if</span>(res)</td></tr>
<tr class="codeline" data-linenumber="207"><td class="num" id="LN207">207</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="208"><td class="num" id="LN208">208</td><td class="line">                boost::throw_exception(condition_error(res, <span class='string_literal'>"boost::condition_variable_any::wait() failed in pthread_cond_wait"</span>));</td></tr>
<tr class="codeline" data-linenumber="209"><td class="num" id="LN209">209</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="210"><td class="num" id="LN210">210</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="211"><td class="num" id="LN211">211</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="212"><td class="num" id="LN212">212</td><td class="line">        <span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> lock_type,<span class='keyword'>typename</span> predicate_type&gt;</td></tr>
<tr class="codeline" data-linenumber="213"><td class="num" id="LN213">213</td><td class="line">        <span class='keyword'>void</span> wait(lock_type&amp; m,predicate_type pred)</td></tr>
<tr class="codeline" data-linenumber="214"><td class="num" id="LN214">214</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="215"><td class="num" id="LN215">215</td><td class="line">            <span class='keyword'>while</span> (!pred())</td></tr>
<tr class="codeline" data-linenumber="216"><td class="num" id="LN216">216</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="217"><td class="num" id="LN217">217</td><td class="line">                wait(m);</td></tr>
<tr class="codeline" data-linenumber="218"><td class="num" id="LN218">218</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="219"><td class="num" id="LN219">219</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="220"><td class="num" id="LN220">220</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="221"><td class="num" id="LN221">221</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_USES_DATETIME</span></td></tr>
<tr class="codeline" data-linenumber="222"><td class="num" id="LN222">222</td><td class="line">        <span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> lock_type&gt;</td></tr>
<tr class="codeline" data-linenumber="223"><td class="num" id="LN223">223</td><td class="line">        <span class='keyword'>bool</span> timed_wait(lock_type&amp; m,boost::system_time <span class='keyword'>const</span>&amp; abs_time)</td></tr>
<tr class="codeline" data-linenumber="224"><td class="num" id="LN224">224</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="225"><td class="num" id="LN225">225</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_WAIT_BUG</span></td></tr>
<tr class="codeline" data-linenumber="226"><td class="num" id="LN226">226</td><td class="line">            <span class='keyword'>const</span> detail::real_platform_timepoint ts(abs_time + BOOST_THREAD_WAIT_BUG);</td></tr>
<tr class="codeline" data-linenumber="227"><td class="num" id="LN227">227</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="228"><td class="num" id="LN228">228</td><td class="line">            <span class='keyword'>const</span> detail::real_platform_timepoint ts(abs_time);</td></tr>
<tr class="codeline" data-linenumber="229"><td class="num" id="LN229">229</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="230"><td class="num" id="LN230">230</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_INTERNAL_CLOCK_IS_MONO</span></td></tr>
<tr class="codeline" data-linenumber="231"><td class="num" id="LN231">231</td><td class="line">            <span class='comment'>// The system time may jump while this function is waiting. To compensate for this and time</span></td></tr>
<tr class="codeline" data-linenumber="232"><td class="num" id="LN232">232</td><td class="line">            <span class='comment'>// out near the correct time, we could call do_wait_until() in a loop with a short timeout</span></td></tr>
<tr class="codeline" data-linenumber="233"><td class="num" id="LN233">233</td><td class="line">            <span class='comment'>// and recheck the time remaining each time through the loop. However, because we can't</span></td></tr>
<tr class="codeline" data-linenumber="234"><td class="num" id="LN234">234</td><td class="line">            <span class='comment'>// check the predicate each time do_wait_until() completes, this introduces the possibility</span></td></tr>
<tr class="codeline" data-linenumber="235"><td class="num" id="LN235">235</td><td class="line">            <span class='comment'>// of not exiting the function when a notification occurs, since do_wait_until() may report</span></td></tr>
<tr class="codeline" data-linenumber="236"><td class="num" id="LN236">236</td><td class="line">            <span class='comment'>// that it timed out even though a notification was received. The best this function can do</span></td></tr>
<tr class="codeline" data-linenumber="237"><td class="num" id="LN237">237</td><td class="line">            <span class='comment'>// is report correctly whether or not it reached the timeout time.</span></td></tr>
<tr class="codeline" data-linenumber="238"><td class="num" id="LN238">238</td><td class="line">            <span class='keyword'>const</span> detail::platform_duration d(ts - detail::real_platform_clock::now());</td></tr>
<tr class="codeline" data-linenumber="239"><td class="num" id="LN239">239</td><td class="line">            do_wait_until(m, detail::internal_platform_clock::now() + d);</td></tr>
<tr class="codeline" data-linenumber="240"><td class="num" id="LN240">240</td><td class="line">            <span class='keyword'>return</span> ts &gt; detail::real_platform_clock::now();</td></tr>
<tr class="codeline" data-linenumber="241"><td class="num" id="LN241">241</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="242"><td class="num" id="LN242">242</td><td class="line">            <span class='keyword'>return</span> do_wait_until(m, ts);</td></tr>
<tr class="codeline" data-linenumber="243"><td class="num" id="LN243">243</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="244"><td class="num" id="LN244">244</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="245"><td class="num" id="LN245">245</td><td class="line">        <span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> lock_type&gt;</td></tr>
<tr class="codeline" data-linenumber="246"><td class="num" id="LN246">246</td><td class="line">        <span class='keyword'>bool</span> timed_wait(lock_type&amp; m,::boost::xtime <span class='keyword'>const</span>&amp; abs_time)</td></tr>
<tr class="codeline" data-linenumber="247"><td class="num" id="LN247">247</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="248"><td class="num" id="LN248">248</td><td class="line">            <span class='keyword'>return</span> timed_wait(m,system_time(abs_time));</td></tr>
<tr class="codeline" data-linenumber="249"><td class="num" id="LN249">249</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="250"><td class="num" id="LN250">250</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="251"><td class="num" id="LN251">251</td><td class="line">        <span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> lock_type,<span class='keyword'>typename</span> duration_type&gt;</td></tr>
<tr class="codeline" data-linenumber="252"><td class="num" id="LN252">252</td><td class="line">        <span class='keyword'>bool</span> timed_wait(lock_type&amp; m,duration_type <span class='keyword'>const</span>&amp; wait_duration)</td></tr>
<tr class="codeline" data-linenumber="253"><td class="num" id="LN253">253</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="254"><td class="num" id="LN254">254</td><td class="line">            <span class='keyword'>if</span> (wait_duration.is_pos_infinity())</td></tr>
<tr class="codeline" data-linenumber="255"><td class="num" id="LN255">255</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="256"><td class="num" id="LN256">256</td><td class="line">                wait(m);</td></tr>
<tr class="codeline" data-linenumber="257"><td class="num" id="LN257">257</td><td class="line">                <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="258"><td class="num" id="LN258">258</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="259"><td class="num" id="LN259">259</td><td class="line">            <span class='keyword'>if</span> (wait_duration.is_special())</td></tr>
<tr class="codeline" data-linenumber="260"><td class="num" id="LN260">260</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="261"><td class="num" id="LN261">261</td><td class="line">                <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="262"><td class="num" id="LN262">262</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="263"><td class="num" id="LN263">263</td><td class="line">            detail::platform_duration d(wait_duration);</td></tr>
<tr class="codeline" data-linenumber="264"><td class="num" id="LN264">264</td><td class="line"><span class='directive'>#if defined(BOOST_THREAD_HAS_MONO_CLOCK) &amp;&amp; !defined(BOOST_THREAD_INTERNAL_CLOCK_IS_MONO)</span></td></tr>
<tr class="codeline" data-linenumber="265"><td class="num" id="LN265">265</td><td class="line">            <span class='comment'>// The system time may jump while this function is waiting. To compensate for this and time</span></td></tr>
<tr class="codeline" data-linenumber="266"><td class="num" id="LN266">266</td><td class="line">            <span class='comment'>// out near the correct time, we could call do_wait_until() in a loop with a short timeout</span></td></tr>
<tr class="codeline" data-linenumber="267"><td class="num" id="LN267">267</td><td class="line">            <span class='comment'>// and recheck the time remaining each time through the loop. However, because we can't</span></td></tr>
<tr class="codeline" data-linenumber="268"><td class="num" id="LN268">268</td><td class="line">            <span class='comment'>// check the predicate each time do_wait_until() completes, this introduces the possibility</span></td></tr>
<tr class="codeline" data-linenumber="269"><td class="num" id="LN269">269</td><td class="line">            <span class='comment'>// of not exiting the function when a notification occurs, since do_wait_until() may report</span></td></tr>
<tr class="codeline" data-linenumber="270"><td class="num" id="LN270">270</td><td class="line">            <span class='comment'>// that it timed out even though a notification was received. The best this function can do</span></td></tr>
<tr class="codeline" data-linenumber="271"><td class="num" id="LN271">271</td><td class="line">            <span class='comment'>// is report correctly whether or not it reached the timeout time.</span></td></tr>
<tr class="codeline" data-linenumber="272"><td class="num" id="LN272">272</td><td class="line">            <span class='keyword'>const</span> detail::mono_platform_timepoint ts(detail::mono_platform_clock::now() + d);</td></tr>
<tr class="codeline" data-linenumber="273"><td class="num" id="LN273">273</td><td class="line">            do_wait_until(m, detail::internal_platform_clock::now() + d);</td></tr>
<tr class="codeline" data-linenumber="274"><td class="num" id="LN274">274</td><td class="line">            <span class='keyword'>return</span> ts &gt; detail::mono_platform_clock::now();</td></tr>
<tr class="codeline" data-linenumber="275"><td class="num" id="LN275">275</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="276"><td class="num" id="LN276">276</td><td class="line">            <span class='keyword'>return</span> do_wait_until(m, detail::internal_platform_clock::now() + d);</td></tr>
<tr class="codeline" data-linenumber="277"><td class="num" id="LN277">277</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="278"><td class="num" id="LN278">278</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="279"><td class="num" id="LN279">279</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="280"><td class="num" id="LN280">280</td><td class="line">        <span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> lock_type,<span class='keyword'>typename</span> predicate_type&gt;</td></tr>
<tr class="codeline" data-linenumber="281"><td class="num" id="LN281">281</td><td class="line">        <span class='keyword'>bool</span> timed_wait(lock_type&amp; m,boost::system_time <span class='keyword'>const</span>&amp; abs_time, predicate_type pred)</td></tr>
<tr class="codeline" data-linenumber="282"><td class="num" id="LN282">282</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="283"><td class="num" id="LN283">283</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_WAIT_BUG</span></td></tr>
<tr class="codeline" data-linenumber="284"><td class="num" id="LN284">284</td><td class="line">            <span class='keyword'>const</span> detail::real_platform_timepoint ts(abs_time + BOOST_THREAD_WAIT_BUG);</td></tr>
<tr class="codeline" data-linenumber="285"><td class="num" id="LN285">285</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="286"><td class="num" id="LN286">286</td><td class="line">            <span class='keyword'>const</span> detail::real_platform_timepoint ts(abs_time);</td></tr>
<tr class="codeline" data-linenumber="287"><td class="num" id="LN287">287</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="288"><td class="num" id="LN288">288</td><td class="line">            <span class='keyword'>while</span> (!pred())</td></tr>
<tr class="codeline" data-linenumber="289"><td class="num" id="LN289">289</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="290"><td class="num" id="LN290">290</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_INTERNAL_CLOCK_IS_MONO</span></td></tr>
<tr class="codeline" data-linenumber="291"><td class="num" id="LN291">291</td><td class="line">                <span class='comment'>// The system time may jump while this function is waiting. To compensate for this</span></td></tr>
<tr class="codeline" data-linenumber="292"><td class="num" id="LN292">292</td><td class="line">                <span class='comment'>// and time out near the correct time, we call do_wait_until() in a loop with a</span></td></tr>
<tr class="codeline" data-linenumber="293"><td class="num" id="LN293">293</td><td class="line">                <span class='comment'>// short timeout and recheck the time remaining each time through the loop.</span></td></tr>
<tr class="codeline" data-linenumber="294"><td class="num" id="LN294">294</td><td class="line">                detail::platform_duration d(ts - detail::real_platform_clock::now());</td></tr>
<tr class="codeline" data-linenumber="295"><td class="num" id="LN295">295</td><td class="line">                <span class='keyword'>if</span> (d &lt;= detail::platform_duration::zero()) <span class='keyword'>break</span>; <span class='comment'>// timeout occurred</span></td></tr>
<tr class="codeline" data-linenumber="296"><td class="num" id="LN296">296</td><td class="line">                d = (std::min)(d, detail::platform_milliseconds(<span class='macro'>BOOST_THREAD_POLL_INTERVAL_MILLISECONDS<span class='macro_popup'>100</span></span>));</td></tr>
<tr class="codeline" data-linenumber="297"><td class="num" id="LN297">297</td><td class="line">                do_wait_until(m, detail::internal_platform_clock::now() + d);</td></tr>
<tr class="codeline" data-linenumber="298"><td class="num" id="LN298">298</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="299"><td class="num" id="LN299">299</td><td class="line">                <span class='keyword'>if</span> (!do_wait_until(m, ts)) <span class='keyword'>break</span>; <span class='comment'>// timeout occurred</span></td></tr>
<tr class="codeline" data-linenumber="300"><td class="num" id="LN300">300</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="301"><td class="num" id="LN301">301</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="302"><td class="num" id="LN302">302</td><td class="line">            <span class='keyword'>return</span> pred();</td></tr>
<tr class="codeline" data-linenumber="303"><td class="num" id="LN303">303</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="304"><td class="num" id="LN304">304</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="305"><td class="num" id="LN305">305</td><td class="line">        <span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> lock_type,<span class='keyword'>typename</span> predicate_type&gt;</td></tr>
<tr class="codeline" data-linenumber="306"><td class="num" id="LN306">306</td><td class="line">        <span class='keyword'>bool</span> timed_wait(lock_type&amp; m,::boost::xtime <span class='keyword'>const</span>&amp; abs_time, predicate_type pred)</td></tr>
<tr class="codeline" data-linenumber="307"><td class="num" id="LN307">307</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="308"><td class="num" id="LN308">308</td><td class="line">            <span class='keyword'>return</span> timed_wait(m,system_time(abs_time),pred);</td></tr>
<tr class="codeline" data-linenumber="309"><td class="num" id="LN309">309</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="310"><td class="num" id="LN310">310</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="311"><td class="num" id="LN311">311</td><td class="line">        <span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> lock_type,<span class='keyword'>typename</span> duration_type,<span class='keyword'>typename</span> predicate_type&gt;</td></tr>
<tr class="codeline" data-linenumber="312"><td class="num" id="LN312">312</td><td class="line">        <span class='keyword'>bool</span> timed_wait(lock_type&amp; m,duration_type <span class='keyword'>const</span>&amp; wait_duration,predicate_type pred)</td></tr>
<tr class="codeline" data-linenumber="313"><td class="num" id="LN313">313</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="314"><td class="num" id="LN314">314</td><td class="line">            <span class='keyword'>if</span> (wait_duration.is_pos_infinity())</td></tr>
<tr class="codeline" data-linenumber="315"><td class="num" id="LN315">315</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="316"><td class="num" id="LN316">316</td><td class="line">                <span class='keyword'>while</span> (!pred())</td></tr>
<tr class="codeline" data-linenumber="317"><td class="num" id="LN317">317</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="318"><td class="num" id="LN318">318</td><td class="line">                    wait(m);</td></tr>
<tr class="codeline" data-linenumber="319"><td class="num" id="LN319">319</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="320"><td class="num" id="LN320">320</td><td class="line">                <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="321"><td class="num" id="LN321">321</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="322"><td class="num" id="LN322">322</td><td class="line">            <span class='keyword'>if</span> (wait_duration.is_special())</td></tr>
<tr class="codeline" data-linenumber="323"><td class="num" id="LN323">323</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="324"><td class="num" id="LN324">324</td><td class="line">                <span class='keyword'>return</span> pred();</td></tr>
<tr class="codeline" data-linenumber="325"><td class="num" id="LN325">325</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="326"><td class="num" id="LN326">326</td><td class="line">            detail::platform_duration d(wait_duration);</td></tr>
<tr class="codeline" data-linenumber="327"><td class="num" id="LN327">327</td><td class="line"><span class='directive'>#if defined(BOOST_THREAD_HAS_MONO_CLOCK) &amp;&amp; !defined(BOOST_THREAD_INTERNAL_CLOCK_IS_MONO)</span></td></tr>
<tr class="codeline" data-linenumber="328"><td class="num" id="LN328">328</td><td class="line">            <span class='comment'>// The system time may jump while this function is waiting. To compensate for this</span></td></tr>
<tr class="codeline" data-linenumber="329"><td class="num" id="LN329">329</td><td class="line">            <span class='comment'>// and time out near the correct time, we call do_wait_until() in a loop with a</span></td></tr>
<tr class="codeline" data-linenumber="330"><td class="num" id="LN330">330</td><td class="line">            <span class='comment'>// short timeout and recheck the time remaining each time through the loop.</span></td></tr>
<tr class="codeline" data-linenumber="331"><td class="num" id="LN331">331</td><td class="line">            <span class='keyword'>const</span> detail::mono_platform_timepoint ts(detail::mono_platform_clock::now() + d);</td></tr>
<tr class="codeline" data-linenumber="332"><td class="num" id="LN332">332</td><td class="line">            <span class='keyword'>while</span> (!pred())</td></tr>
<tr class="codeline" data-linenumber="333"><td class="num" id="LN333">333</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="334"><td class="num" id="LN334">334</td><td class="line">                <span class='keyword'>if</span> (d &lt;= detail::platform_duration::zero()) <span class='keyword'>break</span>; <span class='comment'>// timeout occurred</span></td></tr>
<tr class="codeline" data-linenumber="335"><td class="num" id="LN335">335</td><td class="line">                d = (std::min)(d, detail::platform_milliseconds(<span class='macro'>BOOST_THREAD_POLL_INTERVAL_MILLISECONDS<span class='macro_popup'>100</span></span>));</td></tr>
<tr class="codeline" data-linenumber="336"><td class="num" id="LN336">336</td><td class="line">                do_wait_until(m, detail::internal_platform_clock::now() + d);</td></tr>
<tr class="codeline" data-linenumber="337"><td class="num" id="LN337">337</td><td class="line">                d = ts - detail::mono_platform_clock::now();</td></tr>
<tr class="codeline" data-linenumber="338"><td class="num" id="LN338">338</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="339"><td class="num" id="LN339">339</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="340"><td class="num" id="LN340">340</td><td class="line">            <span class='keyword'>const</span> detail::internal_platform_timepoint ts(detail::internal_platform_clock::now() + d);</td></tr>
<tr class="codeline" data-linenumber="341"><td class="num" id="LN341">341</td><td class="line">            <span class='keyword'>while</span> (!pred())</td></tr>
<tr class="codeline" data-linenumber="342"><td class="num" id="LN342">342</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="343"><td class="num" id="LN343">343</td><td class="line">                <span class='keyword'>if</span> (!do_wait_until(m, ts)) <span class='keyword'>break</span>; <span class='comment'>// timeout occurred</span></td></tr>
<tr class="codeline" data-linenumber="344"><td class="num" id="LN344">344</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="345"><td class="num" id="LN345">345</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="346"><td class="num" id="LN346">346</td><td class="line">            <span class='keyword'>return</span> pred();</td></tr>
<tr class="codeline" data-linenumber="347"><td class="num" id="LN347">347</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="348"><td class="num" id="LN348">348</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="349"><td class="num" id="LN349">349</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="350"><td class="num" id="LN350">350</td><td class="line"><span class='directive'>#ifdef BOOST_THREAD_USES_CHRONO</span></td></tr>
<tr class="codeline" data-linenumber="351"><td class="num" id="LN351">351</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> lock_type,<span class='keyword'>class</span> Duration&gt;</td></tr>
<tr class="codeline" data-linenumber="352"><td class="num" id="LN352">352</td><td class="line">        cv_status</td></tr>
<tr class="codeline" data-linenumber="353"><td class="num" id="LN353">353</td><td class="line">        wait_until(</td></tr>
<tr class="codeline" data-linenumber="354"><td class="num" id="LN354">354</td><td class="line">                lock_type&amp; lock,</td></tr>
<tr class="codeline" data-linenumber="355"><td class="num" id="LN355">355</td><td class="line">                <span class='keyword'>const</span> chrono::time_point&lt;detail::internal_chrono_clock, Duration&gt;&amp; t)</td></tr>
<tr class="codeline" data-linenumber="356"><td class="num" id="LN356">356</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="357"><td class="num" id="LN357">357</td><td class="line">            <span class='keyword'>const</span> boost::detail::internal_platform_timepoint ts(t);</td></tr>
<tr class="codeline" data-linenumber="358"><td class="num" id="LN358">358</td><td class="line">            <span class='keyword'>if</span> (do_wait_until(lock, ts)) <span class='keyword'>return</span> cv_status::no_timeout;</td></tr>
<tr class="codeline" data-linenumber="359"><td class="num" id="LN359">359</td><td class="line">            <span class='keyword'>else</span> <span class='keyword'>return</span> cv_status::timeout;</td></tr>
<tr class="codeline" data-linenumber="360"><td class="num" id="LN360">360</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="361"><td class="num" id="LN361">361</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="362"><td class="num" id="LN362">362</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> lock_type, <span class='keyword'>class</span> Clock, <span class='keyword'>class</span> Duration&gt;</td></tr>
<tr class="codeline" data-linenumber="363"><td class="num" id="LN363">363</td><td class="line">        cv_status</td></tr>
<tr class="codeline" data-linenumber="364"><td class="num" id="LN364">364</td><td class="line">        wait_until(</td></tr>
<tr class="codeline" data-linenumber="365"><td class="num" id="LN365">365</td><td class="line">                lock_type&amp; lock,</td></tr>
<tr class="codeline" data-linenumber="366"><td class="num" id="LN366">366</td><td class="line">                <span class='keyword'>const</span> chrono::time_point&lt;Clock, Duration&gt;&amp; t)</td></tr>
<tr class="codeline" data-linenumber="367"><td class="num" id="LN367">367</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="368"><td class="num" id="LN368">368</td><td class="line">            <span class='comment'>// The system time may jump while this function is waiting. To compensate for this and time</span></td></tr>
<tr class="codeline" data-linenumber="369"><td class="num" id="LN369">369</td><td class="line">            <span class='comment'>// out near the correct time, we could call do_wait_until() in a loop with a short timeout</span></td></tr>
<tr class="codeline" data-linenumber="370"><td class="num" id="LN370">370</td><td class="line">            <span class='comment'>// and recheck the time remaining each time through the loop. However, because we can't</span></td></tr>
<tr class="codeline" data-linenumber="371"><td class="num" id="LN371">371</td><td class="line">            <span class='comment'>// check the predicate each time do_wait_until() completes, this introduces the possibility</span></td></tr>
<tr class="codeline" data-linenumber="372"><td class="num" id="LN372">372</td><td class="line">            <span class='comment'>// of not exiting the function when a notification occurs, since do_wait_until() may report</span></td></tr>
<tr class="codeline" data-linenumber="373"><td class="num" id="LN373">373</td><td class="line">            <span class='comment'>// that it timed out even though a notification was received. The best this function can do</span></td></tr>
<tr class="codeline" data-linenumber="374"><td class="num" id="LN374">374</td><td class="line">            <span class='comment'>// is report correctly whether or not it reached the timeout time.</span></td></tr>
<tr class="codeline" data-linenumber="375"><td class="num" id="LN375">375</td><td class="line">            <span class='keyword'>typedef</span> <span class='keyword'>typename</span> common_type&lt;Duration, <span class='keyword'>typename</span> Clock::duration&gt;::type common_duration;</td></tr>
<tr class="codeline" data-linenumber="376"><td class="num" id="LN376">376</td><td class="line">            common_duration d(t - Clock::now());</td></tr>
<tr class="codeline" data-linenumber="377"><td class="num" id="LN377">377</td><td class="line">            do_wait_until(lock, detail::internal_chrono_clock::now() + d);</td></tr>
<tr class="codeline" data-linenumber="378"><td class="num" id="LN378">378</td><td class="line">            <span class='keyword'>if</span> (t &gt; Clock::now()) <span class='keyword'>return</span> cv_status::no_timeout;</td></tr>
<tr class="codeline" data-linenumber="379"><td class="num" id="LN379">379</td><td class="line">            <span class='keyword'>else</span> <span class='keyword'>return</span> cv_status::timeout;</td></tr>
<tr class="codeline" data-linenumber="380"><td class="num" id="LN380">380</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="381"><td class="num" id="LN381">381</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="382"><td class="num" id="LN382">382</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> lock_type, <span class='keyword'>class</span> Rep, <span class='keyword'>class</span> Period&gt;</td></tr>
<tr class="codeline" data-linenumber="383"><td class="num" id="LN383">383</td><td class="line">        cv_status</td></tr>
<tr class="codeline" data-linenumber="384"><td class="num" id="LN384">384</td><td class="line">        wait_for(</td></tr>
<tr class="codeline" data-linenumber="385"><td class="num" id="LN385">385</td><td class="line">                lock_type&amp; lock,</td></tr>
<tr class="codeline" data-linenumber="386"><td class="num" id="LN386">386</td><td class="line">                <span class='keyword'>const</span> chrono::duration&lt;Rep, Period&gt;&amp; d)</td></tr>
<tr class="codeline" data-linenumber="387"><td class="num" id="LN387">387</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="388"><td class="num" id="LN388">388</td><td class="line">            <span class='keyword'>return</span> wait_until(lock, chrono::steady_clock::now() + d);</td></tr>
<tr class="codeline" data-linenumber="389"><td class="num" id="LN389">389</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="390"><td class="num" id="LN390">390</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="391"><td class="num" id="LN391">391</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> lock_type, <span class='keyword'>class</span> Duration, <span class='keyword'>class</span> Predicate&gt;</td></tr>
<tr class="codeline" data-linenumber="392"><td class="num" id="LN392">392</td><td class="line">        <span class='keyword'>bool</span></td></tr>
<tr class="codeline" data-linenumber="393"><td class="num" id="LN393">393</td><td class="line">        wait_until(</td></tr>
<tr class="codeline" data-linenumber="394"><td class="num" id="LN394">394</td><td class="line">                lock_type&amp; lock,</td></tr>
<tr class="codeline" data-linenumber="395"><td class="num" id="LN395">395</td><td class="line">                <span class='keyword'>const</span> chrono::time_point&lt;detail::internal_chrono_clock, Duration&gt;&amp; t,</td></tr>
<tr class="codeline" data-linenumber="396"><td class="num" id="LN396">396</td><td class="line">                Predicate pred)</td></tr>
<tr class="codeline" data-linenumber="397"><td class="num" id="LN397">397</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="398"><td class="num" id="LN398">398</td><td class="line">            <span class='keyword'>const</span> detail::internal_platform_timepoint ts(t);</td></tr>
<tr class="codeline" data-linenumber="399"><td class="num" id="LN399">399</td><td class="line">            <span class='keyword'>while</span> (!pred())</td></tr>
<tr class="codeline" data-linenumber="400"><td class="num" id="LN400">400</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="401"><td class="num" id="LN401">401</td><td class="line">                <span class='keyword'>if</span> (!do_wait_until(lock, ts)) <span class='keyword'>break</span>; <span class='comment'>// timeout occurred</span></td></tr>
<tr class="codeline" data-linenumber="402"><td class="num" id="LN402">402</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="403"><td class="num" id="LN403">403</td><td class="line">            <span class='keyword'>return</span> pred();</td></tr>
<tr class="codeline" data-linenumber="404"><td class="num" id="LN404">404</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="405"><td class="num" id="LN405">405</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="406"><td class="num" id="LN406">406</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> lock_type, <span class='keyword'>class</span> Clock, <span class='keyword'>class</span> Duration, <span class='keyword'>class</span> Predicate&gt;</td></tr>
<tr class="codeline" data-linenumber="407"><td class="num" id="LN407">407</td><td class="line">        <span class='keyword'>bool</span></td></tr>
<tr class="codeline" data-linenumber="408"><td class="num" id="LN408">408</td><td class="line">        wait_until(</td></tr>
<tr class="codeline" data-linenumber="409"><td class="num" id="LN409">409</td><td class="line">                lock_type&amp; lock,</td></tr>
<tr class="codeline" data-linenumber="410"><td class="num" id="LN410">410</td><td class="line">                <span class='keyword'>const</span> chrono::time_point&lt;Clock, Duration&gt;&amp; t,</td></tr>
<tr class="codeline" data-linenumber="411"><td class="num" id="LN411">411</td><td class="line">                Predicate pred)</td></tr>
<tr class="codeline" data-linenumber="412"><td class="num" id="LN412">412</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="413"><td class="num" id="LN413">413</td><td class="line">            <span class='comment'>// The system time may jump while this function is waiting. To compensate for this</span></td></tr>
<tr class="codeline" data-linenumber="414"><td class="num" id="LN414">414</td><td class="line">            <span class='comment'>// and time out near the correct time, we call do_wait_until() in a loop with a</span></td></tr>
<tr class="codeline" data-linenumber="415"><td class="num" id="LN415">415</td><td class="line">            <span class='comment'>// short timeout and recheck the time remaining each time through the loop.</span></td></tr>
<tr class="codeline" data-linenumber="416"><td class="num" id="LN416">416</td><td class="line">            <span class='keyword'>typedef</span> <span class='keyword'>typename</span> common_type&lt;Duration, <span class='keyword'>typename</span> Clock::duration&gt;::type common_duration;</td></tr>
<tr class="codeline" data-linenumber="417"><td class="num" id="LN417">417</td><td class="line">            <span class='keyword'>while</span> (!pred())</td></tr>
<tr class="codeline" data-linenumber="418"><td class="num" id="LN418">418</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="419"><td class="num" id="LN419">419</td><td class="line">                common_duration d(t - Clock::now());</td></tr>
<tr class="codeline" data-linenumber="420"><td class="num" id="LN420">420</td><td class="line">                <span class='keyword'>if</span> (d &lt;= common_duration::zero()) <span class='keyword'>break</span>; <span class='comment'>// timeout occurred</span></td></tr>
<tr class="codeline" data-linenumber="421"><td class="num" id="LN421">421</td><td class="line">                d = (std::min)(d, common_duration(chrono::milliseconds(<span class='macro'>BOOST_THREAD_POLL_INTERVAL_MILLISECONDS<span class='macro_popup'>100</span></span>)));</td></tr>
<tr class="codeline" data-linenumber="422"><td class="num" id="LN422">422</td><td class="line">                do_wait_until(lock, detail::internal_platform_clock::now() + detail::platform_duration(d));</td></tr>
<tr class="codeline" data-linenumber="423"><td class="num" id="LN423">423</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="424"><td class="num" id="LN424">424</td><td class="line">            <span class='keyword'>return</span> pred();</td></tr>
<tr class="codeline" data-linenumber="425"><td class="num" id="LN425">425</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="426"><td class="num" id="LN426">426</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="427"><td class="num" id="LN427">427</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> lock_type, <span class='keyword'>class</span> Rep, <span class='keyword'>class</span> Period, <span class='keyword'>class</span> Predicate&gt;</td></tr>
<tr class="codeline" data-linenumber="428"><td class="num" id="LN428">428</td><td class="line">        <span class='keyword'>bool</span></td></tr>
<tr class="codeline" data-linenumber="429"><td class="num" id="LN429">429</td><td class="line">        wait_for(</td></tr>
<tr class="codeline" data-linenumber="430"><td class="num" id="LN430">430</td><td class="line">                lock_type&amp; lock,</td></tr>
<tr class="codeline" data-linenumber="431"><td class="num" id="LN431">431</td><td class="line">                <span class='keyword'>const</span> chrono::duration&lt;Rep, Period&gt;&amp; d,</td></tr>
<tr class="codeline" data-linenumber="432"><td class="num" id="LN432">432</td><td class="line">                Predicate pred)</td></tr>
<tr class="codeline" data-linenumber="433"><td class="num" id="LN433">433</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="434"><td class="num" id="LN434">434</td><td class="line">            <span class='keyword'>return</span> wait_until(lock, chrono::steady_clock::now() + d, boost::move(pred));</td></tr>
<tr class="codeline" data-linenumber="435"><td class="num" id="LN435">435</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="436"><td class="num" id="LN436">436</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="437"><td class="num" id="LN437">437</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="438"><td class="num" id="LN438">438</td><td class="line">        <span class='keyword'>void</span> notify_one() <span class='macro'>BOOST_NOEXCEPT<span class='macro_popup'>noexcept</span></span></td></tr>
<tr class="codeline" data-linenumber="439"><td class="num" id="LN439">439</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="440"><td class="num" id="LN440">440</td><td class="line">            boost::pthread::pthread_mutex_scoped_lock internal_lock(&amp;internal_mutex);</td></tr>
<tr class="codeline" data-linenumber="441"><td class="num" id="LN441">441</td><td class="line">            <span class='macro'>BOOST_VERIFY(!posix::pthread_cond_signal(&amp;cond))<span class='macro_popup'>(static_cast &lt;bool&gt; (!posix::pthread_cond_signal(&amp;cond<br>)) ? void (0) : __assert_fail ("!posix::pthread_cond_signal(&amp;cond)"<br>, "/usr/local/include/boost/thread/pthread/condition_variable.hpp"<br>, 441, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="442"><td class="num" id="LN442">442</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="443"><td class="num" id="LN443">443</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="444"><td class="num" id="LN444">444</td><td class="line">        <span class='keyword'>void</span> notify_all() <span class='macro'>BOOST_NOEXCEPT<span class='macro_popup'>noexcept</span></span></td></tr>
<tr class="codeline" data-linenumber="445"><td class="num" id="LN445">445</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="446"><td class="num" id="LN446">446</td><td class="line">            boost::pthread::pthread_mutex_scoped_lock internal_lock(&amp;internal_mutex);</td></tr>
<tr class="codeline" data-linenumber="447"><td class="num" id="LN447">447</td><td class="line">            <span class='macro'>BOOST_VERIFY(!posix::pthread_cond_broadcast(&amp;cond))<span class='macro_popup'>(static_cast &lt;bool&gt; (!posix::pthread_cond_broadcast(&amp;<br>cond)) ? void (0) : __assert_fail ("!posix::pthread_cond_broadcast(&amp;cond)"<br>, "/usr/local/include/boost/thread/pthread/condition_variable.hpp"<br>, 447, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="448"><td class="num" id="LN448">448</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="449"><td class="num" id="LN449">449</td><td class="line">    <span class='keyword'>private</span>:</td></tr>
<tr class="codeline" data-linenumber="450"><td class="num" id="LN450">450</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="451"><td class="num" id="LN451">451</td><td class="line">        <span class='comment'>// When this function returns true:</span></td></tr>
<tr class="codeline" data-linenumber="452"><td class="num" id="LN452">452</td><td class="line">        <span class='comment'>// * A notification (or sometimes a spurious OS signal) has been received</span></td></tr>
<tr class="codeline" data-linenumber="453"><td class="num" id="LN453">453</td><td class="line">        <span class='comment'>// * Do not assume that the timeout has not been reached</span></td></tr>
<tr class="codeline" data-linenumber="454"><td class="num" id="LN454">454</td><td class="line">        <span class='comment'>// * Do not assume that the predicate has been changed</span></td></tr>
<tr class="codeline" data-linenumber="455"><td class="num" id="LN455">455</td><td class="line">        <span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="456"><td class="num" id="LN456">456</td><td class="line">        <span class='comment'>// When this function returns false:</span></td></tr>
<tr class="codeline" data-linenumber="457"><td class="num" id="LN457">457</td><td class="line">        <span class='comment'>// * The timeout has been reached</span></td></tr>
<tr class="codeline" data-linenumber="458"><td class="num" id="LN458">458</td><td class="line">        <span class='comment'>// * Do not assume that a notification has not been received</span></td></tr>
<tr class="codeline" data-linenumber="459"><td class="num" id="LN459">459</td><td class="line">        <span class='comment'>// * Do not assume that the predicate has not been changed</span></td></tr>
<tr class="codeline" data-linenumber="460"><td class="num" id="LN460">460</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> lock_type&gt;</td></tr>
<tr class="codeline" data-linenumber="461"><td class="num" id="LN461">461</td><td class="line">        <span class='keyword'>bool</span> do_wait_until(</td></tr>
<tr class="codeline" data-linenumber="462"><td class="num" id="LN462">462</td><td class="line">          lock_type&amp; m,</td></tr>
<tr class="codeline" data-linenumber="463"><td class="num" id="LN463">463</td><td class="line">          detail::internal_platform_timepoint <span class='keyword'>const</span> &amp;timeout)</td></tr>
<tr class="codeline" data-linenumber="464"><td class="num" id="LN464">464</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="465"><td class="num" id="LN465">465</td><td class="line">          <span class='keyword'>int</span> res=0;</td></tr>
<tr class="codeline" data-linenumber="466"><td class="num" id="LN466">466</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="467"><td class="num" id="LN467">467</td><td class="line">              thread_cv_detail::lock_on_exit&lt;lock_type&gt; guard;</td></tr>
<tr class="codeline" data-linenumber="468"><td class="num" id="LN468">468</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="469"><td class="num" id="LN469">469</td><td class="line">              detail::interruption_checker check_for_interruption(&amp;internal_mutex,&amp;cond);</td></tr>
<tr class="codeline" data-linenumber="470"><td class="num" id="LN470">470</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="471"><td class="num" id="LN471">471</td><td class="line">              boost::pthread::pthread_mutex_scoped_lock check_for_interruption(&amp;internal_mutex);</td></tr>
<tr class="codeline" data-linenumber="472"><td class="num" id="LN472">472</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="473"><td class="num" id="LN473">473</td><td class="line">              guard.activate(m);</td></tr>
<tr class="codeline" data-linenumber="474"><td class="num" id="LN474">474</td><td class="line">              res=posix::pthread_cond_timedwait(&amp;cond,&amp;internal_mutex,&amp;timeout.getTs());</td></tr>
<tr class="codeline" data-linenumber="475"><td class="num" id="LN475">475</td><td class="line">              check_for_interruption.unlock_if_locked();</td></tr>
<tr class="codeline" data-linenumber="476"><td class="num" id="LN476">476</td><td class="line">              guard.deactivate();</td></tr>
<tr class="codeline" data-linenumber="477"><td class="num" id="LN477">477</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="478"><td class="num" id="LN478">478</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="479"><td class="num" id="LN479">479</td><td class="line">          this_thread::interruption_point();</td></tr>
<tr class="codeline" data-linenumber="480"><td class="num" id="LN480">480</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="481"><td class="num" id="LN481">481</td><td class="line">          <span class='keyword'>if</span>(res==<span class='macro'>ETIMEDOUT<span class='macro_popup'>110</span></span>)</td></tr>
<tr class="codeline" data-linenumber="482"><td class="num" id="LN482">482</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="483"><td class="num" id="LN483">483</td><td class="line">              <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="484"><td class="num" id="LN484">484</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="485"><td class="num" id="LN485">485</td><td class="line">          <span class='keyword'>if</span>(res)</td></tr>
<tr class="codeline" data-linenumber="486"><td class="num" id="LN486">486</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="487"><td class="num" id="LN487">487</td><td class="line">              boost::throw_exception(condition_error(res, <span class='string_literal'>"boost::condition_variable_any::do_wait_until() failed in pthread_cond_timedwait"</span>));</td></tr>
<tr class="codeline" data-linenumber="488"><td class="num" id="LN488">488</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="489"><td class="num" id="LN489">489</td><td class="line">          <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="490"><td class="num" id="LN490">490</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="491"><td class="num" id="LN491">491</td><td class="line">    };</td></tr>
<tr class="codeline" data-linenumber="492"><td class="num" id="LN492">492</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="493"><td class="num" id="LN493">493</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="494"><td class="num" id="LN494">494</td><td class="line"><span class='directive'>#include &lt;boost/config/abi_suffix.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="495"><td class="num" id="LN495">495</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="496"><td class="num" id="LN496">496</td><td class="line"><span class='directive'>#endif</span></td></tr>
</table><hr class=divider>
<div id=File368885>
<div class=FileNav><a href="#File281631">&#x2190;</a></div><h4 class=FileName>/usr/local/include/boost/thread/pthread/thread_data.hpp</h4>
<div class=FileNav><a href="#File369278">&#x2192;</a></div></div>
<table class="code" data-fileid="368885">
<tr class="codeline" data-linenumber="1"><td class="num" id="LN1">1</td><td class="line"><span class='directive'>#ifndef BOOST_THREAD_PTHREAD_THREAD_DATA_HPP</span></td></tr>
<tr class="codeline" data-linenumber="2"><td class="num" id="LN2">2</td><td class="line"><span class='directive'>#define BOOST_THREAD_PTHREAD_THREAD_DATA_HPP</span></td></tr>
<tr class="codeline" data-linenumber="3"><td class="num" id="LN3">3</td><td class="line"><span class='comment'>// Distributed under the Boost Software License, Version 1.0. (See</span></td></tr>
<tr class="codeline" data-linenumber="4"><td class="num" id="LN4">4</td><td class="line"><span class='comment'>// accompanying file LICENSE_1_0.txt or copy at</span></td></tr>
<tr class="codeline" data-linenumber="5"><td class="num" id="LN5">5</td><td class="line"><span class='comment'>// http://www.boost.org/LICENSE_1_0.txt)</span></td></tr>
<tr class="codeline" data-linenumber="6"><td class="num" id="LN6">6</td><td class="line"><span class='comment'>// (C) Copyright 2007 Anthony Williams</span></td></tr>
<tr class="codeline" data-linenumber="7"><td class="num" id="LN7">7</td><td class="line"><span class='comment'>// (C) Copyright 2011-2012 Vicente J. Botet Escriba</span></td></tr>
<tr class="codeline" data-linenumber="8"><td class="num" id="LN8">8</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="9"><td class="num" id="LN9">9</td><td class="line"><span class='directive'>#include &lt;boost/thread/detail/config.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="10"><td class="num" id="LN10">10</td><td class="line"><span class='directive'>#include &lt;boost/thread/exceptions.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="11"><td class="num" id="LN11">11</td><td class="line"><span class='directive'>#include &lt;boost/thread/lock_guard.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="12"><td class="num" id="LN12">12</td><td class="line"><span class='directive'>#include &lt;boost/thread/lock_types.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="13"><td class="num" id="LN13">13</td><td class="line"><span class='directive'>#include &lt;boost/thread/mutex.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="14"><td class="num" id="LN14">14</td><td class="line"><span class='directive'>#include &lt;boost/thread/pthread/condition_variable_fwd.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="15"><td class="num" id="LN15">15</td><td class="line"><span class='directive'>#include &lt;boost/thread/pthread/pthread_helpers.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="16"><td class="num" id="LN16">16</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="17"><td class="num" id="LN17">17</td><td class="line"><span class='directive'>#include &lt;boost/shared_ptr.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="18"><td class="num" id="LN18">18</td><td class="line"><span class='directive'>#include &lt;boost/enable_shared_from_this.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="19"><td class="num" id="LN19">19</td><td class="line"><span class='directive'>#include &lt;boost/assert.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="20"><td class="num" id="LN20">20</td><td class="line"><span class='directive'>#include &lt;boost/thread/detail/platform_time.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="21"><td class="num" id="LN21">21</td><td class="line"><span class='directive'>#ifdef BOOST_THREAD_USES_CHRONO</span></td></tr>
<tr class="codeline" data-linenumber="22"><td class="num" id="LN22">22</td><td class="line"><span class='directive'>#include &lt;boost/chrono/system_clocks.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="23"><td class="num" id="LN23">23</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="24"><td class="num" id="LN24">24</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="25"><td class="num" id="LN25">25</td><td class="line"><span class='directive'>#include &lt;map&gt;</span></td></tr>
<tr class="codeline" data-linenumber="26"><td class="num" id="LN26">26</td><td class="line"><span class='directive'>#include &lt;vector&gt;</span></td></tr>
<tr class="codeline" data-linenumber="27"><td class="num" id="LN27">27</td><td class="line"><span class='directive'>#include &lt;utility&gt;</span></td></tr>
<tr class="codeline" data-linenumber="28"><td class="num" id="LN28">28</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="29"><td class="num" id="LN29">29</td><td class="line"><span class='directive'>#if defined(__ANDROID__)</span></td></tr>
<tr class="codeline" data-linenumber="30"><td class="num" id="LN30">30</td><td class="line"><span class='directive'># ifndef PAGE_SIZE</span></td></tr>
<tr class="codeline" data-linenumber="31"><td class="num" id="LN31">31</td><td class="line"><span class='directive'>#  define PAGE_SIZE 4096</span></td></tr>
<tr class="codeline" data-linenumber="32"><td class="num" id="LN32">32</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="33"><td class="num" id="LN33">33</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="34"><td class="num" id="LN34">34</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="35"><td class="num" id="LN35">35</td><td class="line"><span class='directive'>#include &lt;pthread.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="36"><td class="num" id="LN36">36</td><td class="line"><span class='directive'>#include &lt;unistd.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="37"><td class="num" id="LN37">37</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="38"><td class="num" id="LN38">38</td><td class="line"><span class='directive'>#include &lt;boost/config/abi_prefix.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="39"><td class="num" id="LN39">39</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="40"><td class="num" id="LN40">40</td><td class="line"><span class='keyword'>namespace</span> boost</td></tr>
<tr class="codeline" data-linenumber="41"><td class="num" id="LN41">41</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="42"><td class="num" id="LN42">42</td><td class="line">    <span class='keyword'>class</span> thread_attributes {</td></tr>
<tr class="codeline" data-linenumber="43"><td class="num" id="LN43">43</td><td class="line">    <span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="44"><td class="num" id="LN44">44</td><td class="line">        thread_attributes() <span class='macro'>BOOST_NOEXCEPT<span class='macro_popup'>noexcept</span></span> {</td></tr>
<tr class="codeline" data-linenumber="45"><td class="num" id="LN45">45</td><td class="line">            <span class='keyword'>int</span> res = pthread_attr_init(&amp;val_);</td></tr>
<tr class="codeline" data-linenumber="46"><td class="num" id="LN46">46</td><td class="line">            <span class='macro'>BOOST_VERIFY(!res &amp;&amp; <span class='string_literal'>"pthread_attr_init failed"</span>)<span class='macro_popup'>(static_cast &lt;bool&gt; (!res &amp;&amp; "pthread_attr_init failed"<br>) ? void (0) : __assert_fail ("!res &amp;&amp; \"pthread_attr_init failed\""<br>, "/usr/local/include/boost/thread/pthread/thread_data.hpp", 46<br>, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="47"><td class="num" id="LN47">47</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="48"><td class="num" id="LN48">48</td><td class="line">        ~thread_attributes() {</td></tr>
<tr class="codeline" data-linenumber="49"><td class="num" id="LN49">49</td><td class="line">          <span class='keyword'>int</span> res = pthread_attr_destroy(&amp;val_);</td></tr>
<tr class="codeline" data-linenumber="50"><td class="num" id="LN50">50</td><td class="line">          <span class='macro'>BOOST_VERIFY(!res &amp;&amp; <span class='string_literal'>"pthread_attr_destroy failed"</span>)<span class='macro_popup'>(static_cast &lt;bool&gt; (!res &amp;&amp; "pthread_attr_destroy failed"<br>) ? void (0) : __assert_fail ("!res &amp;&amp; \"pthread_attr_destroy failed\""<br>, "/usr/local/include/boost/thread/pthread/thread_data.hpp", 50<br>, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="51"><td class="num" id="LN51">51</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="52"><td class="num" id="LN52">52</td><td class="line">        <span class='comment'>// stack</span></td></tr>
<tr class="codeline" data-linenumber="53"><td class="num" id="LN53">53</td><td class="line">        <span class='keyword'>void</span> set_stack_size(std::size_t size) <span class='macro'>BOOST_NOEXCEPT<span class='macro_popup'>noexcept</span></span> {</td></tr>
<tr class="codeline" data-linenumber="54"><td class="num" id="LN54">54</td><td class="line">          <span class='keyword'>if</span> (size==0) <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="55"><td class="num" id="LN55">55</td><td class="line"><span class='directive'>#ifdef BOOST_THREAD_USES_GETPAGESIZE</span></td></tr>
<tr class="codeline" data-linenumber="56"><td class="num" id="LN56">56</td><td class="line">          std::size_t page_size = getpagesize();</td></tr>
<tr class="codeline" data-linenumber="57"><td class="num" id="LN57">57</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="58"><td class="num" id="LN58">58</td><td class="line">          std::size_t page_size = ::sysconf( <span class='macro'>_SC_PAGESIZE<span class='macro_popup'>_SC_PAGESIZE</span></span>);</td></tr>
<tr class="codeline" data-linenumber="59"><td class="num" id="LN59">59</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="60"><td class="num" id="LN60">60</td><td class="line"><span class='directive'>#ifdef <span class='macro'>PTHREAD_STACK_MIN<span class='macro_popup'>16384</span></span></span></td></tr>
<tr class="codeline" data-linenumber="61"><td class="num" id="LN61">61</td><td class="line">          <span class='keyword'>if</span> (size&lt;<span class='macro'>PTHREAD_STACK_MIN<span class='macro_popup'>16384</span></span>) size=<span class='macro'>PTHREAD_STACK_MIN<span class='macro_popup'>16384</span></span>;</td></tr>
<tr class="codeline" data-linenumber="62"><td class="num" id="LN62">62</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="63"><td class="num" id="LN63">63</td><td class="line">          size = ((size+page_size-1)/page_size)*page_size;</td></tr>
<tr class="codeline" data-linenumber="64"><td class="num" id="LN64">64</td><td class="line">          <span class='keyword'>int</span> res = pthread_attr_setstacksize(&amp;val_, size);</td></tr>
<tr class="codeline" data-linenumber="65"><td class="num" id="LN65">65</td><td class="line">          <span class='macro'>BOOST_VERIFY(!res &amp;&amp; <span class='string_literal'>"pthread_attr_setstacksize failed"</span>)<span class='macro_popup'>(static_cast &lt;bool&gt; (!res &amp;&amp; "pthread_attr_setstacksize failed"<br>) ? void (0) : __assert_fail ("!res &amp;&amp; \"pthread_attr_setstacksize failed\""<br>, "/usr/local/include/boost/thread/pthread/thread_data.hpp", 65<br>, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="66"><td class="num" id="LN66">66</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="67"><td class="num" id="LN67">67</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="68"><td class="num" id="LN68">68</td><td class="line">        std::size_t get_stack_size() <span class='keyword'>const</span> <span class='macro'>BOOST_NOEXCEPT<span class='macro_popup'>noexcept</span></span> {</td></tr>
<tr class="codeline" data-linenumber="69"><td class="num" id="LN69">69</td><td class="line">            std::size_t size;</td></tr>
<tr class="codeline" data-linenumber="70"><td class="num" id="LN70">70</td><td class="line">            <span class='keyword'>int</span> res = pthread_attr_getstacksize(&amp;val_, &amp;size);</td></tr>
<tr class="codeline" data-linenumber="71"><td class="num" id="LN71">71</td><td class="line">            <span class='macro'>BOOST_VERIFY(!res &amp;&amp; <span class='string_literal'>"pthread_attr_getstacksize failed"</span>)<span class='macro_popup'>(static_cast &lt;bool&gt; (!res &amp;&amp; "pthread_attr_getstacksize failed"<br>) ? void (0) : __assert_fail ("!res &amp;&amp; \"pthread_attr_getstacksize failed\""<br>, "/usr/local/include/boost/thread/pthread/thread_data.hpp", 71<br>, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="72"><td class="num" id="LN72">72</td><td class="line">            <span class='keyword'>return</span> size;</td></tr>
<tr class="codeline" data-linenumber="73"><td class="num" id="LN73">73</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="74"><td class="num" id="LN74">74</td><td class="line"><span class='directive'>#define BOOST_THREAD_DEFINES_THREAD_ATTRIBUTES_NATIVE_HANDLE</span></td></tr>
<tr class="codeline" data-linenumber="75"><td class="num" id="LN75">75</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="76"><td class="num" id="LN76">76</td><td class="line">        <span class='keyword'>typedef</span> pthread_attr_t native_handle_type;</td></tr>
<tr class="codeline" data-linenumber="77"><td class="num" id="LN77">77</td><td class="line">        native_handle_type* native_handle() <span class='macro'>BOOST_NOEXCEPT<span class='macro_popup'>noexcept</span></span> {</td></tr>
<tr class="codeline" data-linenumber="78"><td class="num" id="LN78">78</td><td class="line">          <span class='keyword'>return</span> &amp;val_;</td></tr>
<tr class="codeline" data-linenumber="79"><td class="num" id="LN79">79</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="80"><td class="num" id="LN80">80</td><td class="line">        <span class='keyword'>const</span> native_handle_type* native_handle() <span class='keyword'>const</span> <span class='macro'>BOOST_NOEXCEPT<span class='macro_popup'>noexcept</span></span> {</td></tr>
<tr class="codeline" data-linenumber="81"><td class="num" id="LN81">81</td><td class="line">          <span class='keyword'>return</span> &amp;val_;</td></tr>
<tr class="codeline" data-linenumber="82"><td class="num" id="LN82">82</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="83"><td class="num" id="LN83">83</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="84"><td class="num" id="LN84">84</td><td class="line">    <span class='keyword'>private</span>:</td></tr>
<tr class="codeline" data-linenumber="85"><td class="num" id="LN85">85</td><td class="line">        pthread_attr_t val_;</td></tr>
<tr class="codeline" data-linenumber="86"><td class="num" id="LN86">86</td><td class="line">    };</td></tr>
<tr class="codeline" data-linenumber="87"><td class="num" id="LN87">87</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="88"><td class="num" id="LN88">88</td><td class="line">    <span class='keyword'>class</span> thread;</td></tr>
<tr class="codeline" data-linenumber="89"><td class="num" id="LN89">89</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="90"><td class="num" id="LN90">90</td><td class="line">    <span class='keyword'>namespace</span> detail</td></tr>
<tr class="codeline" data-linenumber="91"><td class="num" id="LN91">91</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="92"><td class="num" id="LN92">92</td><td class="line">        <span class='keyword'>struct</span> shared_state_base;</td></tr>
<tr class="codeline" data-linenumber="93"><td class="num" id="LN93">93</td><td class="line">        <span class='keyword'>struct</span> tss_cleanup_function;</td></tr>
<tr class="codeline" data-linenumber="94"><td class="num" id="LN94">94</td><td class="line">        <span class='keyword'>struct</span> thread_exit_callback_node;</td></tr>
<tr class="codeline" data-linenumber="95"><td class="num" id="LN95">95</td><td class="line">        <span class='keyword'>struct</span> tss_data_node</td></tr>
<tr class="codeline" data-linenumber="96"><td class="num" id="LN96">96</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="97"><td class="num" id="LN97">97</td><td class="line">            <span class='keyword'>typedef</span> <span class='keyword'>void</span>(*cleanup_func_t)(<span class='keyword'>void</span>*);</td></tr>
<tr class="codeline" data-linenumber="98"><td class="num" id="LN98">98</td><td class="line">            <span class='keyword'>typedef</span> <span class='keyword'>void</span>(*cleanup_caller_t)(cleanup_func_t, <span class='keyword'>void</span>*);</td></tr>
<tr class="codeline" data-linenumber="99"><td class="num" id="LN99">99</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="100"><td class="num" id="LN100">100</td><td class="line">            cleanup_caller_t caller;</td></tr>
<tr class="codeline" data-linenumber="101"><td class="num" id="LN101">101</td><td class="line">            cleanup_func_t func;</td></tr>
<tr class="codeline" data-linenumber="102"><td class="num" id="LN102">102</td><td class="line">            <span class='keyword'>void</span>* value;</td></tr>
<tr class="codeline" data-linenumber="103"><td class="num" id="LN103">103</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="104"><td class="num" id="LN104">104</td><td class="line">            tss_data_node(cleanup_caller_t caller_,cleanup_func_t func_,<span class='keyword'>void</span>* value_):</td></tr>
<tr class="codeline" data-linenumber="105"><td class="num" id="LN105">105</td><td class="line">                caller(caller_),func(func_),value(value_)</td></tr>
<tr class="codeline" data-linenumber="106"><td class="num" id="LN106">106</td><td class="line">            {}</td></tr>
<tr class="codeline" data-linenumber="107"><td class="num" id="LN107">107</td><td class="line">        };</td></tr>
<tr class="codeline" data-linenumber="108"><td class="num" id="LN108">108</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="109"><td class="num" id="LN109">109</td><td class="line">        <span class='keyword'>struct</span> thread_data_base;</td></tr>
<tr class="codeline" data-linenumber="110"><td class="num" id="LN110">110</td><td class="line">        <span class='keyword'>typedef</span> boost::shared_ptr&lt;thread_data_base&gt; thread_data_ptr;</td></tr>
<tr class="codeline" data-linenumber="111"><td class="num" id="LN111">111</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="112"><td class="num" id="LN112">112</td><td class="line">        <span class='keyword'>struct</span> <span class='macro'>BOOST_THREAD_DECL<span class='macro_popup'>__attribute__((__visibility__("default")))</span></span> thread_data_base:</td></tr>
<tr class="codeline" data-linenumber="113"><td class="num" id="LN113">113</td><td class="line">            enable_shared_from_this&lt;thread_data_base&gt;</td></tr>
<tr class="codeline" data-linenumber="114"><td class="num" id="LN114">114</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="115"><td class="num" id="LN115">115</td><td class="line">            thread_data_ptr self;</td></tr>
<tr class="codeline" data-linenumber="116"><td class="num" id="LN116">116</td><td class="line">            pthread_t thread_handle;</td></tr>
<tr class="codeline" data-linenumber="117"><td class="num" id="LN117">117</td><td class="line">            boost::mutex data_mutex;</td></tr>
<tr class="codeline" data-linenumber="118"><td class="num" id="LN118">118</td><td class="line">            boost::condition_variable done_condition;</td></tr>
<tr class="codeline" data-linenumber="119"><td class="num" id="LN119">119</td><td class="line">            <span class='keyword'>bool</span> done;</td></tr>
<tr class="codeline" data-linenumber="120"><td class="num" id="LN120">120</td><td class="line">            <span class='keyword'>bool</span> join_started;</td></tr>
<tr class="codeline" data-linenumber="121"><td class="num" id="LN121">121</td><td class="line">            <span class='keyword'>bool</span> joined;</td></tr>
<tr class="codeline" data-linenumber="122"><td class="num" id="LN122">122</td><td class="line">            boost::detail::thread_exit_callback_node* thread_exit_callbacks;</td></tr>
<tr class="codeline" data-linenumber="123"><td class="num" id="LN123">123</td><td class="line">            std::map&lt;<span class='keyword'>void</span> <span class='keyword'>const</span>*,boost::detail::tss_data_node&gt; tss_data;</td></tr>
<tr class="codeline" data-linenumber="124"><td class="num" id="LN124">124</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="125"><td class="num" id="LN125">125</td><td class="line"><span class='comment'>//#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="126"><td class="num" id="LN126">126</td><td class="line">            <span class='comment'>// These data must be at the end so that the access to the other fields doesn't change</span></td></tr>
<tr class="codeline" data-linenumber="127"><td class="num" id="LN127">127</td><td class="line">            <span class='comment'>// when BOOST_THREAD_PROVIDES_INTERRUPTIONS is defined.</span></td></tr>
<tr class="codeline" data-linenumber="128"><td class="num" id="LN128">128</td><td class="line">            <span class='comment'>// Another option is to have them always</span></td></tr>
<tr class="codeline" data-linenumber="129"><td class="num" id="LN129">129</td><td class="line">            pthread_mutex_t* cond_mutex;</td></tr>
<tr class="codeline" data-linenumber="130"><td class="num" id="LN130">130</td><td class="line">            pthread_cond_t* current_cond;</td></tr>
<tr class="codeline" data-linenumber="131"><td class="num" id="LN131">131</td><td class="line"><span class='comment'>//#endif</span></td></tr>
<tr class="codeline" data-linenumber="132"><td class="num" id="LN132">132</td><td class="line">            <span class='keyword'>typedef</span> std::vector&lt;std::pair&lt;condition_variable*, mutex*&gt;</td></tr>
<tr class="codeline" data-linenumber="133"><td class="num" id="LN133">133</td><td class="line">            <span class='comment'>//, hidden_allocator&lt;std::pair&lt;condition_variable*, mutex*&gt; &gt;</span></td></tr>
<tr class="codeline" data-linenumber="134"><td class="num" id="LN134">134</td><td class="line">            &gt; notify_list_t;</td></tr>
<tr class="codeline" data-linenumber="135"><td class="num" id="LN135">135</td><td class="line">            notify_list_t notify;</td></tr>
<tr class="codeline" data-linenumber="136"><td class="num" id="LN136">136</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="137"><td class="num" id="LN137">137</td><td class="line"><span class='comment'>//#ifndef BOOST_NO_EXCEPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="138"><td class="num" id="LN138">138</td><td class="line">            <span class='keyword'>typedef</span> std::vector&lt;shared_ptr&lt;shared_state_base&gt; &gt; async_states_t;</td></tr>
<tr class="codeline" data-linenumber="139"><td class="num" id="LN139">139</td><td class="line">            async_states_t async_states_;</td></tr>
<tr class="codeline" data-linenumber="140"><td class="num" id="LN140">140</td><td class="line"><span class='comment'>//#endif</span></td></tr>
<tr class="codeline" data-linenumber="141"><td class="num" id="LN141">141</td><td class="line"><span class='comment'>//#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="142"><td class="num" id="LN142">142</td><td class="line">            <span class='comment'>// These data must be at the end so that the access to the other fields doesn't change</span></td></tr>
<tr class="codeline" data-linenumber="143"><td class="num" id="LN143">143</td><td class="line">            <span class='comment'>// when BOOST_THREAD_PROVIDES_INTERRUPTIONS is defined.</span></td></tr>
<tr class="codeline" data-linenumber="144"><td class="num" id="LN144">144</td><td class="line">            <span class='comment'>// Another option is to have them always</span></td></tr>
<tr class="codeline" data-linenumber="145"><td class="num" id="LN145">145</td><td class="line">            <span class='keyword'>bool</span> interrupt_enabled;</td></tr>
<tr class="codeline" data-linenumber="146"><td class="num" id="LN146">146</td><td class="line">            <span class='keyword'>bool</span> interrupt_requested;</td></tr>
<tr class="codeline" data-linenumber="147"><td class="num" id="LN147">147</td><td class="line"><span class='comment'>//#endif</span></td></tr>
<tr class="codeline" data-linenumber="148"><td class="num" id="LN148">148</td><td class="line">            thread_data_base():</td></tr>
<tr class="codeline" data-linenumber="149"><td class="num" id="LN149">149</td><td class="line">                thread_handle(0),</td></tr>
<tr class="codeline" data-linenumber="150"><td class="num" id="LN150">150</td><td class="line">                done(<span class='keyword'>false</span>),join_started(<span class='keyword'>false</span>),joined(<span class='keyword'>false</span>),</td></tr>
<tr class="codeline" data-linenumber="151"><td class="num" id="LN151">151</td><td class="line">                thread_exit_callbacks(0),</td></tr>
<tr class="codeline" data-linenumber="152"><td class="num" id="LN152">152</td><td class="line"><span class='comment'>//#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="153"><td class="num" id="LN153">153</td><td class="line">                cond_mutex(0),</td></tr>
<tr class="codeline" data-linenumber="154"><td class="num" id="LN154">154</td><td class="line">                current_cond(0),</td></tr>
<tr class="codeline" data-linenumber="155"><td class="num" id="LN155">155</td><td class="line"><span class='comment'>//#endif</span></td></tr>
<tr class="codeline" data-linenumber="156"><td class="num" id="LN156">156</td><td class="line">                notify()</td></tr>
<tr class="codeline" data-linenumber="157"><td class="num" id="LN157">157</td><td class="line"><span class='comment'>//#ifndef BOOST_NO_EXCEPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="158"><td class="num" id="LN158">158</td><td class="line">                , async_states_()</td></tr>
<tr class="codeline" data-linenumber="159"><td class="num" id="LN159">159</td><td class="line"><span class='comment'>//#endif</span></td></tr>
<tr class="codeline" data-linenumber="160"><td class="num" id="LN160">160</td><td class="line"><span class='comment'>//#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="161"><td class="num" id="LN161">161</td><td class="line">                , interrupt_enabled(<span class='keyword'>true</span>)</td></tr>
<tr class="codeline" data-linenumber="162"><td class="num" id="LN162">162</td><td class="line">                , interrupt_requested(<span class='keyword'>false</span>)</td></tr>
<tr class="codeline" data-linenumber="163"><td class="num" id="LN163">163</td><td class="line"><span class='comment'>//#endif</span></td></tr>
<tr class="codeline" data-linenumber="164"><td class="num" id="LN164">164</td><td class="line">            {}</td></tr>
<tr class="codeline" data-linenumber="165"><td class="num" id="LN165">165</td><td class="line">            <span class='keyword'>virtual</span> ~thread_data_base();</td></tr>
<tr class="codeline" data-linenumber="166"><td class="num" id="LN166">166</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="167"><td class="num" id="LN167">167</td><td class="line">            <span class='keyword'>typedef</span> pthread_t native_handle_type;</td></tr>
<tr class="codeline" data-linenumber="168"><td class="num" id="LN168">168</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="169"><td class="num" id="LN169">169</td><td class="line">            <span class='keyword'>virtual</span> <span class='keyword'>void</span> run()=0;</td></tr>
<tr class="codeline" data-linenumber="170"><td class="num" id="LN170">170</td><td class="line">            <span class='keyword'>virtual</span> <span class='keyword'>void</span> notify_all_at_thread_exit(condition_variable* cv, mutex* m)</td></tr>
<tr class="codeline" data-linenumber="171"><td class="num" id="LN171">171</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="172"><td class="num" id="LN172">172</td><td class="line">              notify.push_back(std::pair&lt;condition_variable*, mutex*&gt;(cv, m));</td></tr>
<tr class="codeline" data-linenumber="173"><td class="num" id="LN173">173</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="174"><td class="num" id="LN174">174</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="175"><td class="num" id="LN175">175</td><td class="line"><span class='comment'>//#ifndef BOOST_NO_EXCEPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="176"><td class="num" id="LN176">176</td><td class="line">            <span class='keyword'>void</span> make_ready_at_thread_exit(shared_ptr&lt;shared_state_base&gt; as)</td></tr>
<tr class="codeline" data-linenumber="177"><td class="num" id="LN177">177</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="178"><td class="num" id="LN178">178</td><td class="line">              async_states_.push_back(as);</td></tr>
<tr class="codeline" data-linenumber="179"><td class="num" id="LN179">179</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="180"><td class="num" id="LN180">180</td><td class="line"><span class='comment'>//#endif</span></td></tr>
<tr class="codeline" data-linenumber="181"><td class="num" id="LN181">181</td><td class="line">        };</td></tr>
<tr class="codeline" data-linenumber="182"><td class="num" id="LN182">182</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="183"><td class="num" id="LN183">183</td><td class="line">        <span class='macro'>BOOST_THREAD_DECL<span class='macro_popup'>__attribute__((__visibility__("default")))</span></span> thread_data_base* get_current_thread_data();</td></tr>
<tr class="codeline" data-linenumber="184"><td class="num" id="LN184">184</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="185"><td class="num" id="LN185">185</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_INTERRUPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="186"><td class="num" id="LN186">186</td><td class="line">        <span class='keyword'>class</span> interruption_checker</td></tr>
<tr class="codeline" data-linenumber="187"><td class="num" id="LN187">187</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="188"><td class="num" id="LN188">188</td><td class="line">            thread_data_base* <span class='keyword'>const</span> thread_info;</td></tr>
<tr class="codeline" data-linenumber="189"><td class="num" id="LN189">189</td><td class="line">            pthread_mutex_t* m;</td></tr>
<tr class="codeline" data-linenumber="190"><td class="num" id="LN190">190</td><td class="line">            <span class='keyword'>bool</span> set;</td></tr>
<tr class="codeline" data-linenumber="191"><td class="num" id="LN191">191</td><td class="line">            <span class='keyword'>bool</span> done;</td></tr>
<tr class="codeline" data-linenumber="192"><td class="num" id="LN192">192</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="193"><td class="num" id="LN193">193</td><td class="line">            <span class='keyword'>void</span> check_for_interruption()</td></tr>
<tr class="codeline" data-linenumber="194"><td class="num" id="LN194">194</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="195"><td class="num" id="LN195">195</td><td class="line"><span class='directive'>#ifndef BOOST_NO_EXCEPTIONS</span></td></tr>
<tr class="codeline" data-linenumber="196"><td class="num" id="LN196">196</td><td class="line">                <span class='keyword'>if</span>(thread_info-&gt;interrupt_requested)</td></tr>
<tr class="codeline" data-linenumber="197"><td class="num" id="LN197">197</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="198"><td class="num" id="LN198">198</td><td class="line">                    thread_info-&gt;interrupt_requested=<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="199"><td class="num" id="LN199">199</td><td class="line">                    <span class='keyword'>throw</span> thread_interrupted(); <span class='comment'>// BOOST_NO_EXCEPTIONS protected</span></td></tr>
<tr class="codeline" data-linenumber="200"><td class="num" id="LN200">200</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="201"><td class="num" id="LN201">201</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="202"><td class="num" id="LN202">202</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="203"><td class="num" id="LN203">203</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="204"><td class="num" id="LN204">204</td><td class="line">            <span class='keyword'>void</span> <span class='keyword'>operator</span>=(interruption_checker&amp;);</td></tr>
<tr class="codeline" data-linenumber="205"><td class="num" id="LN205">205</td><td class="line">        <span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="206"><td class="num" id="LN206">206</td><td class="line">            <span class='keyword'>explicit</span> interruption_checker(pthread_mutex_t* cond_mutex,pthread_cond_t* cond):</td></tr>
<tr class="codeline" data-linenumber="207"><td class="num" id="LN207">207</td><td class="line">                thread_info(detail::get_current_thread_data()),m(cond_mutex),</td></tr>
<tr class="codeline" data-linenumber="208"><td class="num" id="LN208">208</td><td class="line">                set(thread_info &amp;&amp; thread_info-&gt;interrupt_enabled), done(<span class='keyword'>false</span>)</td></tr>
<tr class="codeline" data-linenumber="209"><td class="num" id="LN209">209</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="210"><td class="num" id="LN210">210</td><td class="line">                <span class='keyword'>if</span>(set)</td></tr>
<tr class="codeline" data-linenumber="211"><td class="num" id="LN211">211</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="212"><td class="num" id="LN212">212</td><td class="line">                    lock_guard&lt;mutex&gt; guard(thread_info-&gt;data_mutex);</td></tr>
<tr class="codeline" data-linenumber="213"><td class="num" id="LN213">213</td><td class="line">                    check_for_interruption();</td></tr>
<tr class="codeline" data-linenumber="214"><td class="num" id="LN214">214</td><td class="line">                    thread_info-&gt;cond_mutex=cond_mutex;</td></tr>
<tr class="codeline" data-linenumber="215"><td class="num" id="LN215">215</td><td class="line">                    thread_info-&gt;current_cond=cond;</td></tr>
<tr class="codeline" data-linenumber="216"><td class="num" id="LN216">216</td><td class="line">                    <span class='macro'>BOOST_VERIFY(!posix::pthread_mutex_lock(m))<span class='macro_popup'>(static_cast &lt;bool&gt; (!posix::pthread_mutex_lock(m)) ? void<br> (0) : __assert_fail ("!posix::pthread_mutex_lock(m)", "/usr/local/include/boost/thread/pthread/thread_data.hpp"<br>, 216, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="217"><td class="num" id="LN217">217</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="218"><td class="num" id="LN218">218</td><td class="line">                <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="219"><td class="num" id="LN219">219</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="220"><td class="num" id="LN220">220</td><td class="line">                    <span class='macro'>BOOST_VERIFY(!posix::pthread_mutex_lock(m))<span class='macro_popup'>(static_cast &lt;bool&gt; (!posix::pthread_mutex_lock(m)) ? void<br> (0) : __assert_fail ("!posix::pthread_mutex_lock(m)", "/usr/local/include/boost/thread/pthread/thread_data.hpp"<br>, 220, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="221"><td class="num" id="LN221">221</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="222"><td class="num" id="LN222">222</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="223"><td class="num" id="LN223">223</td><td class="line">            <span class='keyword'>void</span> unlock_if_locked()</td></tr>
<tr class="codeline" data-linenumber="224"><td class="num" id="LN224">224</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="225"><td class="num" id="LN225">225</td><td class="line">              <span class='keyword'>if</span> ( ! <span class='variable'><span class='variable'><span class='variable'><span class='variable'><span class='variable'><span class='variable'><span class='variable'><span class='variable'><span class='variable'>done<table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>22.1</div></td><td>Field 'done' is false</td></tr><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>38.1</div></td><td>Field 'done' is false</td></tr></tbody></table></span><table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>22.1</div></td><td>Field 'done' is false</td></tr><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>38.1</div></td><td>Field 'done' is false</td></tr></tbody></table></span><table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>22.1</div></td><td>Field 'done' is false</td></tr><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>38.1</div></td><td>Field 'done' is false</td></tr></tbody></table></span><table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>22.1</div></td><td>Field 'done' is false</td></tr><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>38.1</div></td><td>Field 'done' is false</td></tr></tbody></table></span><table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>22.1</div></td><td>Field 'done' is false</td></tr><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>38.1</div></td><td>Field 'done' is false</td></tr></tbody></table></span><table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>22.1</div></td><td>Field 'done' is false</td></tr><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>38.1</div></td><td>Field 'done' is false</td></tr></tbody></table></span><table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>22.1</div></td><td>Field 'done' is false</td></tr><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>38.1</div></td><td>Field 'done' is false</td></tr></tbody></table></span><table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>22.1</div></td><td>Field 'done' is false</td></tr><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>38.1</div></td><td>Field 'done' is false</td></tr></tbody></table></span><table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>22.1</div></td><td>Field 'done' is false</td></tr><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>38.1</div></td><td>Field 'done' is false</td></tr></tbody></table></span>) {</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path23" class="msg msgControl" style="margin-left:15ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">23</div></td><td><div class="PathNav"><a href="#Path22" title="Previous event (22)">&#x2190;</a></div></td><td>Taking true branch</td><td><div class="PathNav"><a href="#Path24" title="Next event (24)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path39" class="msg msgControl" style="margin-left:15ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">39</div></td><td><div class="PathNav"><a href="#Path38" title="Previous event (38)">&#x2190;</a></div></td><td>Taking true branch</td><td><div class="PathNav"><a href="#Path40" title="Next event (40)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="226"><td class="num" id="LN226">226</td><td class="line">                <span class='keyword'>if</span> (<span class='variable'><span class='variable'><span class='variable'><span class='variable'><span class='variable'><span class='variable'><span class='variable'><span class='variable'><span class='variable'>set<table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>23.1</div></td><td>Field 'set' is true</td></tr><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>39.1</div></td><td>Field 'set' is true</td></tr></tbody></table></span><table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>23.1</div></td><td>Field 'set' is true</td></tr><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>39.1</div></td><td>Field 'set' is true</td></tr></tbody></table></span><table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>23.1</div></td><td>Field 'set' is true</td></tr><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>39.1</div></td><td>Field 'set' is true</td></tr></tbody></table></span><table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>23.1</div></td><td>Field 'set' is true</td></tr><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>39.1</div></td><td>Field 'set' is true</td></tr></tbody></table></span><table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>23.1</div></td><td>Field 'set' is true</td></tr><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>39.1</div></td><td>Field 'set' is true</td></tr></tbody></table></span><table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>23.1</div></td><td>Field 'set' is true</td></tr><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>39.1</div></td><td>Field 'set' is true</td></tr></tbody></table></span><table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>23.1</div></td><td>Field 'set' is true</td></tr><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>39.1</div></td><td>Field 'set' is true</td></tr></tbody></table></span><table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>23.1</div></td><td>Field 'set' is true</td></tr><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>39.1</div></td><td>Field 'set' is true</td></tr></tbody></table></span><table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>23.1</div></td><td>Field 'set' is true</td></tr><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>39.1</div></td><td>Field 'set' is true</td></tr></tbody></table></span>)</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path24" class="msg msgControl" style="margin-left:17ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">24</div></td><td><div class="PathNav"><a href="#Path23" title="Previous event (23)">&#x2190;</a></div></td><td>Taking true branch</td><td><div class="PathNav"><a href="#Path25" title="Next event (25)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path40" class="msg msgControl" style="margin-left:17ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">40</div></td><td><div class="PathNav"><a href="#Path39" title="Previous event (39)">&#x2190;</a></div></td><td>Taking true branch</td><td><div class="PathNav"><a href="#Path41" title="Next event (41)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="227"><td class="num" id="LN227">227</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="228"><td class="num" id="LN228">228</td><td class="line">                    <span class="mrange"><span class="mrange"><span class='macro'>BOOST_VERIFY</span></span>(!posix::pthread_mutex_unlock(m))<span class='macro_popup'>(static_cast &lt;bool&gt; (!posix::pthread_mutex_unlock(m)) ?<br> void (0) : __assert_fail ("!posix::pthread_mutex_unlock(m)",<br> "/usr/local/include/boost/thread/pthread/thread_data.hpp", 228<br>, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path25" class="msg msgEvent" style="margin-left:21ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">25</div></td><td><div class="PathNav"><a href="#Path24" title="Previous event (24)">&#x2190;</a></div></td><td>Assuming the condition is true</td><td><div class="PathNav"><a href="#Path26" title="Next event (26)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path26" class="msg msgControl" style="margin-left:21ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">26</div></td><td><div class="PathNav"><a href="#Path25" title="Previous event (25)">&#x2190;</a></div></td><td>'?' condition is true</td><td><div class="PathNav"><a href="#Path27" title="Next event (27)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path41" class="msg msgEvent" style="margin-left:21ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">41</div></td><td><div class="PathNav"><a href="#Path40" title="Previous event (40)">&#x2190;</a></div></td><td>Assuming the condition is true</td><td><div class="PathNav"><a href="#Path42" title="Next event (42)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path42" class="msg msgControl" style="margin-left:21ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">42</div></td><td><div class="PathNav"><a href="#Path41" title="Previous event (41)">&#x2190;</a></div></td><td>'?' condition is true</td><td><div class="PathNav"><a href="#Path43" title="Next event (43)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="229"><td class="num" id="LN229">229</td><td class="line">                    lock_guard&lt;mutex&gt; <span class="mrange"><span class="mrange"><span class="mrange"><span class="mrange">guard(thread_info-&gt;data_mutex)</span></span></span></span>;</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path27" class="msg msgEvent" style="margin-left:39ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">27</div></td><td><div class="PathNav"><a href="#Path26" title="Previous event (26)">&#x2190;</a></div></td><td>Calling constructor for 'lock_guard&lt;boost::mutex&gt;'</td><td><div class="PathNav"><a href="#Path28" title="Next event (28)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path35" class="msg msgEvent" style="margin-left:39ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">35</div></td><td><div class="PathNav"><a href="#Path34" title="Previous event (34)">&#x2190;</a></div></td><td>Returning from constructor for 'lock_guard&lt;boost::mutex&gt;'</td><td><div class="PathNav"><a href="#Path36" title="Next event (36)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path43" class="msg msgEvent" style="margin-left:39ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">43</div></td><td><div class="PathNav"><a href="#Path42" title="Previous event (42)">&#x2190;</a></div></td><td>Calling constructor for 'lock_guard&lt;boost::mutex&gt;'</td><td><div class="PathNav"><a href="#Path44" title="Next event (44)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path51" class="msg msgEvent" style="margin-left:39ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">51</div></td><td><div class="PathNav"><a href="#Path50" title="Previous event (50)">&#x2190;</a></div></td><td>Returning from constructor for 'lock_guard&lt;boost::mutex&gt;'</td><td><div class="PathNav"><a href="#Path52" title="Next event (52)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="230"><td class="num" id="LN230">230</td><td class="line">                    thread_info-&gt;cond_mutex=<span class='macro'>NULL<span class='macro_popup'>__null</span></span>;</td></tr>
<tr class="codeline" data-linenumber="231"><td class="num" id="LN231">231</td><td class="line">                    thread_info-&gt;current_cond=<span class='macro'>NULL<span class='macro_popup'>__null</span></span>;</td></tr>
<tr class="codeline" data-linenumber="232"><td class="num" id="LN232">232</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="233"><td class="num" id="LN233">233</td><td class="line">                <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="234"><td class="num" id="LN234">234</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="235"><td class="num" id="LN235">235</td><td class="line">                    <span class='macro'>BOOST_VERIFY(!posix::pthread_mutex_unlock(m))<span class='macro_popup'>(static_cast &lt;bool&gt; (!posix::pthread_mutex_unlock(m)) ?<br> void (0) : __assert_fail ("!posix::pthread_mutex_unlock(m)",<br> "/usr/local/include/boost/thread/pthread/thread_data.hpp", 235<br>, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="236"><td class="num" id="LN236">236</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="237"><td class="num" id="LN237">237</td><td class="line">                done = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="238"><td class="num" id="LN238">238</td><td class="line">              }</td></tr>
<tr class="codeline" data-linenumber="239"><td class="num" id="LN239">239</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="240"><td class="num" id="LN240">240</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="241"><td class="num" id="LN241">241</td><td class="line">            ~interruption_checker() <span class='macro'>BOOST_NOEXCEPT_IF(<span class='keyword'>false</span>)<span class='macro_popup'>noexcept((false))</span></span></td></tr>
<tr class="codeline" data-linenumber="242"><td class="num" id="LN242">242</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="243"><td class="num" id="LN243">243</td><td class="line">                <span class="mrange"><span class="mrange">unlock_if_locked()</span></span>;</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path38" class="msg msgEvent" style="margin-left:17ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">38</div></td><td><div class="PathNav"><a href="#Path37" title="Previous event (37)">&#x2190;</a></div></td><td>Calling 'interruption_checker::unlock_if_locked'</td><td><div class="PathNav"><a href="#Path39" title="Next event (39)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path52" class="msg msgEvent" style="margin-left:17ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">52</div></td><td><div class="PathNav"><a href="#Path51" title="Previous event (51)">&#x2190;</a></div></td><td>Returning from 'interruption_checker::unlock_if_locked'</td><td><div class="PathNav"><a href="#EndPath" title="Next event (53)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="244"><td class="num" id="LN244">244</td><td class="line">            }</td></tr>
<tr><td class="num"></td><td class="line"><div id="EndPath" class="msg msgEvent" style="margin-left:13ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">53</div></td><td><div class="PathNav"><a href="#Path52" title="Previous event (52)">&#x2190;</a></div></td><td>Exception being thrown out of destructor</td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="245"><td class="num" id="LN245">245</td><td class="line">        };</td></tr>
<tr class="codeline" data-linenumber="246"><td class="num" id="LN246">246</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="247"><td class="num" id="LN247">247</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="248"><td class="num" id="LN248">248</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="249"><td class="num" id="LN249">249</td><td class="line">    <span class='keyword'>namespace</span> this_thread</td></tr>
<tr class="codeline" data-linenumber="250"><td class="num" id="LN250">250</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="251"><td class="num" id="LN251">251</td><td class="line">        <span class='keyword'>void</span> <span class='macro'>BOOST_THREAD_DECL<span class='macro_popup'>__attribute__((__visibility__("default")))</span></span> yield() <span class='macro'>BOOST_NOEXCEPT<span class='macro_popup'>noexcept</span></span>;</td></tr>
<tr class="codeline" data-linenumber="252"><td class="num" id="LN252">252</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="253"><td class="num" id="LN253">253</td><td class="line">        <span class='keyword'>namespace</span> hidden</td></tr>
<tr class="codeline" data-linenumber="254"><td class="num" id="LN254">254</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="255"><td class="num" id="LN255">255</td><td class="line">          <span class='keyword'>inline</span> <span class='keyword'>bool</span> always_false()</td></tr>
<tr class="codeline" data-linenumber="256"><td class="num" id="LN256">256</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="257"><td class="num" id="LN257">257</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="258"><td class="num" id="LN258">258</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="259"><td class="num" id="LN259">259</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="260"><td class="num" id="LN260">260</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="261"><td class="num" id="LN261">261</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_USES_DATETIME</span></td></tr>
<tr class="codeline" data-linenumber="262"><td class="num" id="LN262">262</td><td class="line"><span class='directive'>#ifdef __DECXXX</span></td></tr>
<tr class="codeline" data-linenumber="263"><td class="num" id="LN263">263</td><td class="line">        <span class='comment'>/// Workaround of DECCXX issue of incorrect template substitution</span></td></tr>
<tr class="codeline" data-linenumber="264"><td class="num" id="LN264">264</td><td class="line">        <span class='keyword'>template</span>&lt;&gt;</td></tr>
<tr class="codeline" data-linenumber="265"><td class="num" id="LN265">265</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="266"><td class="num" id="LN266">266</td><td class="line">        <span class='keyword'>inline</span> <span class='keyword'>void</span> sleep(system_time <span class='keyword'>const</span>&amp; abs_time)</td></tr>
<tr class="codeline" data-linenumber="267"><td class="num" id="LN267">267</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="268"><td class="num" id="LN268">268</td><td class="line">          mutex mx;</td></tr>
<tr class="codeline" data-linenumber="269"><td class="num" id="LN269">269</td><td class="line">          unique_lock&lt;mutex&gt; lock(mx);</td></tr>
<tr class="codeline" data-linenumber="270"><td class="num" id="LN270">270</td><td class="line">          condition_variable cond;</td></tr>
<tr class="codeline" data-linenumber="271"><td class="num" id="LN271">271</td><td class="line">          cond.timed_wait(lock, abs_time, hidden::always_false);</td></tr>
<tr class="codeline" data-linenumber="272"><td class="num" id="LN272">272</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="273"><td class="num" id="LN273">273</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="274"><td class="num" id="LN274">274</td><td class="line">        <span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> TimeDuration&gt;</td></tr>
<tr class="codeline" data-linenumber="275"><td class="num" id="LN275">275</td><td class="line">        <span class='keyword'>void</span> sleep(TimeDuration <span class='keyword'>const</span>&amp; rel_time)</td></tr>
<tr class="codeline" data-linenumber="276"><td class="num" id="LN276">276</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="277"><td class="num" id="LN277">277</td><td class="line">          mutex mx;</td></tr>
<tr class="codeline" data-linenumber="278"><td class="num" id="LN278">278</td><td class="line">          unique_lock&lt;mutex&gt; lock(mx);</td></tr>
<tr class="codeline" data-linenumber="279"><td class="num" id="LN279">279</td><td class="line">          condition_variable cond;</td></tr>
<tr class="codeline" data-linenumber="280"><td class="num" id="LN280">280</td><td class="line">          cond.timed_wait(lock, rel_time, hidden::always_false);</td></tr>
<tr class="codeline" data-linenumber="281"><td class="num" id="LN281">281</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="282"><td class="num" id="LN282">282</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="283"><td class="num" id="LN283">283</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="284"><td class="num" id="LN284">284</td><td class="line"><span class='directive'>#ifdef BOOST_THREAD_USES_CHRONO</span></td></tr>
<tr class="codeline" data-linenumber="285"><td class="num" id="LN285">285</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Clock, <span class='keyword'>class</span> Duration&gt;</td></tr>
<tr class="codeline" data-linenumber="286"><td class="num" id="LN286">286</td><td class="line">        <span class='keyword'>void</span> sleep_until(<span class='keyword'>const</span> chrono::time_point&lt;Clock, Duration&gt;&amp; t)</td></tr>
<tr class="codeline" data-linenumber="287"><td class="num" id="LN287">287</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="288"><td class="num" id="LN288">288</td><td class="line">          mutex mut;</td></tr>
<tr class="codeline" data-linenumber="289"><td class="num" id="LN289">289</td><td class="line">          unique_lock&lt;mutex&gt; lk(mut);</td></tr>
<tr class="codeline" data-linenumber="290"><td class="num" id="LN290">290</td><td class="line">          condition_variable cv;</td></tr>
<tr class="codeline" data-linenumber="291"><td class="num" id="LN291">291</td><td class="line">          cv.wait_until(lk, t, hidden::always_false);</td></tr>
<tr class="codeline" data-linenumber="292"><td class="num" id="LN292">292</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="293"><td class="num" id="LN293">293</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="294"><td class="num" id="LN294">294</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Rep, <span class='keyword'>class</span> Period&gt;</td></tr>
<tr class="codeline" data-linenumber="295"><td class="num" id="LN295">295</td><td class="line">        <span class='keyword'>void</span> sleep_for(<span class='keyword'>const</span> chrono::duration&lt;Rep, Period&gt;&amp; d)</td></tr>
<tr class="codeline" data-linenumber="296"><td class="num" id="LN296">296</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="297"><td class="num" id="LN297">297</td><td class="line">          mutex mut;</td></tr>
<tr class="codeline" data-linenumber="298"><td class="num" id="LN298">298</td><td class="line">          unique_lock&lt;mutex&gt; lk(mut);</td></tr>
<tr class="codeline" data-linenumber="299"><td class="num" id="LN299">299</td><td class="line">          condition_variable cv;</td></tr>
<tr class="codeline" data-linenumber="300"><td class="num" id="LN300">300</td><td class="line">          cv.wait_for(lk, d, hidden::always_false);</td></tr>
<tr class="codeline" data-linenumber="301"><td class="num" id="LN301">301</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="302"><td class="num" id="LN302">302</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="303"><td class="num" id="LN303">303</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="304"><td class="num" id="LN304">304</td><td class="line">        <span class='keyword'>namespace</span> no_interruption_point</td></tr>
<tr class="codeline" data-linenumber="305"><td class="num" id="LN305">305</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="306"><td class="num" id="LN306">306</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_SLEEP_FOR_IS_STEADY</span></td></tr>
<tr class="codeline" data-linenumber="307"><td class="num" id="LN307">307</td><td class="line"><span class='comment'>// Use pthread_delay_np or nanosleep when available</span></td></tr>
<tr class="codeline" data-linenumber="308"><td class="num" id="LN308">308</td><td class="line"><span class='comment'>// because they do not provide an interruption point.</span></td></tr>
<tr class="codeline" data-linenumber="309"><td class="num" id="LN309">309</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="310"><td class="num" id="LN310">310</td><td class="line">          <span class='keyword'>namespace</span> hidden</td></tr>
<tr class="codeline" data-linenumber="311"><td class="num" id="LN311">311</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="312"><td class="num" id="LN312">312</td><td class="line">            <span class='keyword'>void</span> <span class='macro'>BOOST_THREAD_DECL<span class='macro_popup'>__attribute__((__visibility__("default")))</span></span> sleep_for_internal(<span class='keyword'>const</span> detail::platform_duration&amp; ts);</td></tr>
<tr class="codeline" data-linenumber="313"><td class="num" id="LN313">313</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="314"><td class="num" id="LN314">314</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="315"><td class="num" id="LN315">315</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_USES_DATETIME</span></td></tr>
<tr class="codeline" data-linenumber="316"><td class="num" id="LN316">316</td><td class="line"><span class='directive'>#ifdef __DECXXX</span></td></tr>
<tr class="codeline" data-linenumber="317"><td class="num" id="LN317">317</td><td class="line">          <span class='comment'>/// Workaround of DECCXX issue of incorrect template substitution</span></td></tr>
<tr class="codeline" data-linenumber="318"><td class="num" id="LN318">318</td><td class="line">          <span class='keyword'>template</span>&lt;&gt;</td></tr>
<tr class="codeline" data-linenumber="319"><td class="num" id="LN319">319</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="320"><td class="num" id="LN320">320</td><td class="line">          <span class='keyword'>inline</span> <span class='keyword'>void</span> sleep(system_time <span class='keyword'>const</span>&amp; abs_time)</td></tr>
<tr class="codeline" data-linenumber="321"><td class="num" id="LN321">321</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="322"><td class="num" id="LN322">322</td><td class="line">            <span class='keyword'>const</span> detail::real_platform_timepoint ts(abs_time);</td></tr>
<tr class="codeline" data-linenumber="323"><td class="num" id="LN323">323</td><td class="line">            detail::platform_duration d(ts - detail::real_platform_clock::now());</td></tr>
<tr class="codeline" data-linenumber="324"><td class="num" id="LN324">324</td><td class="line">            <span class='keyword'>while</span> (d &gt; detail::platform_duration::zero())</td></tr>
<tr class="codeline" data-linenumber="325"><td class="num" id="LN325">325</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="326"><td class="num" id="LN326">326</td><td class="line">              d = (std::min)(d, detail::platform_milliseconds(<span class='macro'>BOOST_THREAD_POLL_INTERVAL_MILLISECONDS<span class='macro_popup'>100</span></span>));</td></tr>
<tr class="codeline" data-linenumber="327"><td class="num" id="LN327">327</td><td class="line">              hidden::sleep_for_internal(d);</td></tr>
<tr class="codeline" data-linenumber="328"><td class="num" id="LN328">328</td><td class="line">              d = ts - detail::real_platform_clock::now();</td></tr>
<tr class="codeline" data-linenumber="329"><td class="num" id="LN329">329</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="330"><td class="num" id="LN330">330</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="331"><td class="num" id="LN331">331</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="332"><td class="num" id="LN332">332</td><td class="line">          <span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> TimeDuration&gt;</td></tr>
<tr class="codeline" data-linenumber="333"><td class="num" id="LN333">333</td><td class="line">          <span class='keyword'>void</span> sleep(TimeDuration <span class='keyword'>const</span>&amp; rel_time)</td></tr>
<tr class="codeline" data-linenumber="334"><td class="num" id="LN334">334</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="335"><td class="num" id="LN335">335</td><td class="line">            hidden::sleep_for_internal(detail::platform_duration(rel_time));</td></tr>
<tr class="codeline" data-linenumber="336"><td class="num" id="LN336">336</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="337"><td class="num" id="LN337">337</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="338"><td class="num" id="LN338">338</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="339"><td class="num" id="LN339">339</td><td class="line"><span class='directive'>#ifdef BOOST_THREAD_USES_CHRONO</span></td></tr>
<tr class="codeline" data-linenumber="340"><td class="num" id="LN340">340</td><td class="line">          <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Rep, <span class='keyword'>class</span> Period&gt;</td></tr>
<tr class="codeline" data-linenumber="341"><td class="num" id="LN341">341</td><td class="line">          <span class='keyword'>void</span> sleep_for(<span class='keyword'>const</span> chrono::duration&lt;Rep, Period&gt;&amp; d)</td></tr>
<tr class="codeline" data-linenumber="342"><td class="num" id="LN342">342</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="343"><td class="num" id="LN343">343</td><td class="line">            hidden::sleep_for_internal(detail::platform_duration(d));</td></tr>
<tr class="codeline" data-linenumber="344"><td class="num" id="LN344">344</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="345"><td class="num" id="LN345">345</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="346"><td class="num" id="LN346">346</td><td class="line">          <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Duration&gt;</td></tr>
<tr class="codeline" data-linenumber="347"><td class="num" id="LN347">347</td><td class="line">          <span class='keyword'>void</span> sleep_until(<span class='keyword'>const</span> chrono::time_point&lt;chrono::steady_clock, Duration&gt;&amp; t)</td></tr>
<tr class="codeline" data-linenumber="348"><td class="num" id="LN348">348</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="349"><td class="num" id="LN349">349</td><td class="line">            sleep_for(t - chrono::steady_clock::now());</td></tr>
<tr class="codeline" data-linenumber="350"><td class="num" id="LN350">350</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="351"><td class="num" id="LN351">351</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="352"><td class="num" id="LN352">352</td><td class="line">          <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Clock, <span class='keyword'>class</span> Duration&gt;</td></tr>
<tr class="codeline" data-linenumber="353"><td class="num" id="LN353">353</td><td class="line">          <span class='keyword'>void</span> sleep_until(<span class='keyword'>const</span> chrono::time_point&lt;Clock, Duration&gt;&amp; t)</td></tr>
<tr class="codeline" data-linenumber="354"><td class="num" id="LN354">354</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="355"><td class="num" id="LN355">355</td><td class="line">            <span class='keyword'>typedef</span> <span class='keyword'>typename</span> common_type&lt;Duration, <span class='keyword'>typename</span> Clock::duration&gt;::type common_duration;</td></tr>
<tr class="codeline" data-linenumber="356"><td class="num" id="LN356">356</td><td class="line">            common_duration d(t - Clock::now());</td></tr>
<tr class="codeline" data-linenumber="357"><td class="num" id="LN357">357</td><td class="line">            <span class='keyword'>while</span> (d &gt; common_duration::zero())</td></tr>
<tr class="codeline" data-linenumber="358"><td class="num" id="LN358">358</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="359"><td class="num" id="LN359">359</td><td class="line">              d = (std::min)(d, common_duration(chrono::milliseconds(<span class='macro'>BOOST_THREAD_POLL_INTERVAL_MILLISECONDS<span class='macro_popup'>100</span></span>)));</td></tr>
<tr class="codeline" data-linenumber="360"><td class="num" id="LN360">360</td><td class="line">              hidden::sleep_for_internal(detail::platform_duration(d));</td></tr>
<tr class="codeline" data-linenumber="361"><td class="num" id="LN361">361</td><td class="line">              d = t - Clock::now();</td></tr>
<tr class="codeline" data-linenumber="362"><td class="num" id="LN362">362</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="363"><td class="num" id="LN363">363</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="364"><td class="num" id="LN364">364</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="365"><td class="num" id="LN365">365</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="366"><td class="num" id="LN366">366</td><td class="line"><span class='directive'>#else // BOOST_THREAD_SLEEP_FOR_IS_STEADY</span></td></tr>
<tr class="codeline" data-linenumber="367"><td class="num" id="LN367">367</td><td class="line"><span class='comment'>// When pthread_delay_np and nanosleep are not available,</span></td></tr>
<tr class="codeline" data-linenumber="368"><td class="num" id="LN368">368</td><td class="line"><span class='comment'>// fall back to using the interruptible sleep functions.</span></td></tr>
<tr class="codeline" data-linenumber="369"><td class="num" id="LN369">369</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="370"><td class="num" id="LN370">370</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_USES_DATETIME</span></td></tr>
<tr class="codeline" data-linenumber="371"><td class="num" id="LN371">371</td><td class="line"><span class='directive'>#ifdef __DECXXX</span></td></tr>
<tr class="codeline" data-linenumber="372"><td class="num" id="LN372">372</td><td class="line">          <span class='comment'>/// Workaround of DECCXX issue of incorrect template substitution</span></td></tr>
<tr class="codeline" data-linenumber="373"><td class="num" id="LN373">373</td><td class="line">          <span class='keyword'>template</span>&lt;&gt;</td></tr>
<tr class="codeline" data-linenumber="374"><td class="num" id="LN374">374</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="375"><td class="num" id="LN375">375</td><td class="line">          <span class='keyword'>inline</span> <span class='keyword'>void</span> sleep(system_time <span class='keyword'>const</span>&amp; abs_time)</td></tr>
<tr class="codeline" data-linenumber="376"><td class="num" id="LN376">376</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="377"><td class="num" id="LN377">377</td><td class="line">            this_thread::sleep(abs_time);</td></tr>
<tr class="codeline" data-linenumber="378"><td class="num" id="LN378">378</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="379"><td class="num" id="LN379">379</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="380"><td class="num" id="LN380">380</td><td class="line">          <span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> TimeDuration&gt;</td></tr>
<tr class="codeline" data-linenumber="381"><td class="num" id="LN381">381</td><td class="line">          <span class='keyword'>void</span> sleep(TimeDuration <span class='keyword'>const</span>&amp; rel_time)</td></tr>
<tr class="codeline" data-linenumber="382"><td class="num" id="LN382">382</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="383"><td class="num" id="LN383">383</td><td class="line">            this_thread::sleep(rel_time);</td></tr>
<tr class="codeline" data-linenumber="384"><td class="num" id="LN384">384</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="385"><td class="num" id="LN385">385</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="386"><td class="num" id="LN386">386</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="387"><td class="num" id="LN387">387</td><td class="line"><span class='directive'>#ifdef BOOST_THREAD_USES_CHRONO</span></td></tr>
<tr class="codeline" data-linenumber="388"><td class="num" id="LN388">388</td><td class="line">          <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Clock, <span class='keyword'>class</span> Duration&gt;</td></tr>
<tr class="codeline" data-linenumber="389"><td class="num" id="LN389">389</td><td class="line">          <span class='keyword'>void</span> sleep_until(<span class='keyword'>const</span> chrono::time_point&lt;Clock, Duration&gt;&amp; t)</td></tr>
<tr class="codeline" data-linenumber="390"><td class="num" id="LN390">390</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="391"><td class="num" id="LN391">391</td><td class="line">            this_thread::sleep_until(t);</td></tr>
<tr class="codeline" data-linenumber="392"><td class="num" id="LN392">392</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="393"><td class="num" id="LN393">393</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="394"><td class="num" id="LN394">394</td><td class="line">          <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Rep, <span class='keyword'>class</span> Period&gt;</td></tr>
<tr class="codeline" data-linenumber="395"><td class="num" id="LN395">395</td><td class="line">          <span class='keyword'>void</span> sleep_for(<span class='keyword'>const</span> chrono::duration&lt;Rep, Period&gt;&amp; d)</td></tr>
<tr class="codeline" data-linenumber="396"><td class="num" id="LN396">396</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="397"><td class="num" id="LN397">397</td><td class="line">            this_thread::sleep_for(d);</td></tr>
<tr class="codeline" data-linenumber="398"><td class="num" id="LN398">398</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="399"><td class="num" id="LN399">399</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="400"><td class="num" id="LN400">400</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="401"><td class="num" id="LN401">401</td><td class="line"><span class='directive'>#endif // BOOST_THREAD_SLEEP_FOR_IS_STEADY</span></td></tr>
<tr class="codeline" data-linenumber="402"><td class="num" id="LN402">402</td><td class="line">        } <span class='comment'>// no_interruption_point</span></td></tr>
<tr class="codeline" data-linenumber="403"><td class="num" id="LN403">403</td><td class="line">    } <span class='comment'>// this_thread</span></td></tr>
<tr class="codeline" data-linenumber="404"><td class="num" id="LN404">404</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="405"><td class="num" id="LN405">405</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="406"><td class="num" id="LN406">406</td><td class="line"><span class='directive'>#include &lt;boost/config/abi_suffix.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="407"><td class="num" id="LN407">407</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="408"><td class="num" id="LN408">408</td><td class="line"><span class='directive'>#endif</span></td></tr>
</table><hr class=divider>
<div id=File369278>
<div class=FileNav><a href="#File368885">&#x2190;</a></div><h4 class=FileName>/usr/local/include/boost/thread/pthread/mutex.hpp</h4>
<div class=FileNav><a href="#File112609">&#x2192;</a></div></div>
<table class="code" data-fileid="369278">
<tr class="codeline" data-linenumber="1"><td class="num" id="LN1">1</td><td class="line"><span class='directive'>#ifndef BOOST_THREAD_PTHREAD_MUTEX_HPP</span></td></tr>
<tr class="codeline" data-linenumber="2"><td class="num" id="LN2">2</td><td class="line"><span class='directive'>#define BOOST_THREAD_PTHREAD_MUTEX_HPP</span></td></tr>
<tr class="codeline" data-linenumber="3"><td class="num" id="LN3">3</td><td class="line"><span class='comment'>// (C) Copyright 2007-8 Anthony Williams</span></td></tr>
<tr class="codeline" data-linenumber="4"><td class="num" id="LN4">4</td><td class="line"><span class='comment'>// (C) Copyright 2011,2012,2015 Vicente J. Botet Escriba</span></td></tr>
<tr class="codeline" data-linenumber="5"><td class="num" id="LN5">5</td><td class="line"><span class='comment'>// Distributed under the Boost Software License, Version 1.0. (See</span></td></tr>
<tr class="codeline" data-linenumber="6"><td class="num" id="LN6">6</td><td class="line"><span class='comment'>// accompanying file LICENSE_1_0.txt or copy at</span></td></tr>
<tr class="codeline" data-linenumber="7"><td class="num" id="LN7">7</td><td class="line"><span class='comment'>// http://www.boost.org/LICENSE_1_0.txt)</span></td></tr>
<tr class="codeline" data-linenumber="8"><td class="num" id="LN8">8</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="9"><td class="num" id="LN9">9</td><td class="line"><span class='directive'>#include &lt;boost/thread/detail/config.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="10"><td class="num" id="LN10">10</td><td class="line"><span class='directive'>#include &lt;boost/assert.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="11"><td class="num" id="LN11">11</td><td class="line"><span class='directive'>#include &lt;pthread.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="12"><td class="num" id="LN12">12</td><td class="line"><span class='directive'>#include &lt;boost/throw_exception.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="13"><td class="num" id="LN13">13</td><td class="line"><span class='directive'>#include &lt;boost/core/ignore_unused.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="14"><td class="num" id="LN14">14</td><td class="line"><span class='directive'>#include &lt;boost/thread/exceptions.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="15"><td class="num" id="LN15">15</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_NESTED_LOCKS</span></td></tr>
<tr class="codeline" data-linenumber="16"><td class="num" id="LN16">16</td><td class="line"><span class='directive'>#include &lt;boost/thread/lock_types.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="17"><td class="num" id="LN17">17</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="18"><td class="num" id="LN18">18</td><td class="line"><span class='directive'>#include &lt;boost/thread/thread_time.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="19"><td class="num" id="LN19">19</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_USES_DATETIME</span></td></tr>
<tr class="codeline" data-linenumber="20"><td class="num" id="LN20">20</td><td class="line"><span class='directive'>#include &lt;boost/thread/xtime.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="21"><td class="num" id="LN21">21</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="22"><td class="num" id="LN22">22</td><td class="line"><span class='directive'>#include &lt;boost/assert.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="23"><td class="num" id="LN23">23</td><td class="line"><span class='directive'>#include &lt;<span class='macro'>errno<span class='macro_popup'>(*__errno_location ())</span></span>.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="24"><td class="num" id="LN24">24</td><td class="line"><span class='directive'>#include &lt;boost/thread/detail/platform_time.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="25"><td class="num" id="LN25">25</td><td class="line"><span class='directive'>#include &lt;boost/thread/pthread/pthread_mutex_scoped_lock.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="26"><td class="num" id="LN26">26</td><td class="line"><span class='directive'>#include &lt;boost/thread/pthread/pthread_helpers.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="27"><td class="num" id="LN27">27</td><td class="line"><span class='directive'>#ifdef BOOST_THREAD_USES_CHRONO</span></td></tr>
<tr class="codeline" data-linenumber="28"><td class="num" id="LN28">28</td><td class="line"><span class='directive'>#include &lt;boost/chrono/system_clocks.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="29"><td class="num" id="LN29">29</td><td class="line"><span class='directive'>#include &lt;boost/chrono/ceil.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="30"><td class="num" id="LN30">30</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="31"><td class="num" id="LN31">31</td><td class="line"><span class='directive'>#include &lt;boost/thread/detail/delete.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="32"><td class="num" id="LN32">32</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="33"><td class="num" id="LN33">33</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="34"><td class="num" id="LN34">34</td><td class="line"><span class='directive'>#include &lt;boost/config/abi_prefix.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="35"><td class="num" id="LN35">35</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="36"><td class="num" id="LN36">36</td><td class="line"><span class='keyword'>namespace</span> boost</td></tr>
<tr class="codeline" data-linenumber="37"><td class="num" id="LN37">37</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="38"><td class="num" id="LN38">38</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="39"><td class="num" id="LN39">39</td><td class="line">    <span class='keyword'>class</span> BOOST_THREAD_CAPABILITY(<span class='string_literal'>"mutex"</span>) mutex</td></tr>
<tr class="codeline" data-linenumber="40"><td class="num" id="LN40">40</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="41"><td class="num" id="LN41">41</td><td class="line">    <span class='keyword'>private</span>:</td></tr>
<tr class="codeline" data-linenumber="42"><td class="num" id="LN42">42</td><td class="line">        pthread_mutex_t m;</td></tr>
<tr class="codeline" data-linenumber="43"><td class="num" id="LN43">43</td><td class="line">    <span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="44"><td class="num" id="LN44">44</td><td class="line">        <span class='macro'>BOOST_THREAD_NO_COPYABLE(mutex)<span class='macro_popup'>mutex(mutex const&amp;) = delete; mutex&amp; operator=(mutex const<br>&amp;) = delete;</span></span></td></tr>
<tr class="codeline" data-linenumber="45"><td class="num" id="LN45">45</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="46"><td class="num" id="LN46">46</td><td class="line">        mutex()</td></tr>
<tr class="codeline" data-linenumber="47"><td class="num" id="LN47">47</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="48"><td class="num" id="LN48">48</td><td class="line">            <span class='keyword'>int</span> <span class='keyword'>const</span> res=posix::pthread_mutex_init(&amp;m);</td></tr>
<tr class="codeline" data-linenumber="49"><td class="num" id="LN49">49</td><td class="line">            <span class='keyword'>if</span>(res)</td></tr>
<tr class="codeline" data-linenumber="50"><td class="num" id="LN50">50</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="51"><td class="num" id="LN51">51</td><td class="line">                boost::throw_exception(thread_resource_error(res, <span class='string_literal'>"boost:: mutex constructor failed in pthread_mutex_init"</span>));</td></tr>
<tr class="codeline" data-linenumber="52"><td class="num" id="LN52">52</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="53"><td class="num" id="LN53">53</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="54"><td class="num" id="LN54">54</td><td class="line">        ~mutex()</td></tr>
<tr class="codeline" data-linenumber="55"><td class="num" id="LN55">55</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="56"><td class="num" id="LN56">56</td><td class="line">          <span class='macro'>BOOST_VERIFY(!posix::pthread_mutex_destroy(&amp;m))<span class='macro_popup'>(static_cast &lt;bool&gt; (!posix::pthread_mutex_destroy(&amp;<br>m)) ? void (0) : __assert_fail ("!posix::pthread_mutex_destroy(&amp;m)"<br>, "/usr/local/include/boost/thread/pthread/mutex.hpp", 56, __extension__<br> __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="57"><td class="num" id="LN57">57</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="58"><td class="num" id="LN58">58</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="59"><td class="num" id="LN59">59</td><td class="line">        <span class='keyword'>void</span> lock() BOOST_THREAD_ACQUIRE()</td></tr>
<tr class="codeline" data-linenumber="60"><td class="num" id="LN60">60</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="61"><td class="num" id="LN61">61</td><td class="line">            <span class='keyword'>int</span> res = posix::pthread_mutex_lock(&amp;m);</td></tr>
<tr class="codeline" data-linenumber="62"><td class="num" id="LN62">62</td><td class="line">            <span class='keyword'>if</span> (<span class="mrange"><span class="mrange">res</span></span>)</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path29" class="msg msgEvent" style="margin-left:17ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">29</div></td><td><div class="PathNav"><a href="#Path28" title="Previous event (28)">&#x2190;</a></div></td><td>Assuming 'res' is not equal to 0</td><td><div class="PathNav"><a href="#Path30" title="Next event (30)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path30" class="msg msgControl" style="margin-left:13ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">30</div></td><td><div class="PathNav"><a href="#Path29" title="Previous event (29)">&#x2190;</a></div></td><td>Taking true branch</td><td><div class="PathNav"><a href="#Path31" title="Next event (31)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path45" class="msg msgEvent" style="margin-left:17ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">45</div></td><td><div class="PathNav"><a href="#Path44" title="Previous event (44)">&#x2190;</a></div></td><td>Assuming 'res' is not equal to 0</td><td><div class="PathNav"><a href="#Path46" title="Next event (46)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path46" class="msg msgControl" style="margin-left:13ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">46</div></td><td><div class="PathNav"><a href="#Path45" title="Previous event (45)">&#x2190;</a></div></td><td>Taking true branch</td><td><div class="PathNav"><a href="#Path47" title="Next event (47)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="63"><td class="num" id="LN63">63</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="64"><td class="num" id="LN64">64</td><td class="line">                <span class="mrange"><span class="mrange"><span class="mrange"><span class="mrange">boost::throw_exception(lock_error(res,<span class='string_literal'>"boost: mutex lock failed in pthread_mutex_lock"</span>))</span></span></span></span>;</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path31" class="msg msgEvent" style="margin-left:17ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">31</div></td><td><div class="PathNav"><a href="#Path30" title="Previous event (30)">&#x2190;</a></div></td><td>Calling 'throw_exception&lt;boost::lock_error&gt;'</td><td><div class="PathNav"><a href="#Path32" title="Next event (32)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path33" class="msg msgEvent" style="margin-left:17ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">33</div></td><td><div class="PathNav"><a href="#Path32" title="Previous event (32)">&#x2190;</a></div></td><td>Returning from 'throw_exception&lt;boost::lock_error&gt;'</td><td><div class="PathNav"><a href="#Path34" title="Next event (34)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path47" class="msg msgEvent" style="margin-left:17ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">47</div></td><td><div class="PathNav"><a href="#Path46" title="Previous event (46)">&#x2190;</a></div></td><td>Calling 'throw_exception&lt;boost::lock_error&gt;'</td><td><div class="PathNav"><a href="#Path48" title="Next event (48)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path49" class="msg msgEvent" style="margin-left:17ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">49</div></td><td><div class="PathNav"><a href="#Path48" title="Previous event (48)">&#x2190;</a></div></td><td>Returning from 'throw_exception&lt;boost::lock_error&gt;'</td><td><div class="PathNav"><a href="#Path50" title="Next event (50)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="65"><td class="num" id="LN65">65</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="66"><td class="num" id="LN66">66</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="67"><td class="num" id="LN67">67</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="68"><td class="num" id="LN68">68</td><td class="line">        <span class='keyword'>void</span> unlock() BOOST_THREAD_RELEASE()</td></tr>
<tr class="codeline" data-linenumber="69"><td class="num" id="LN69">69</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="70"><td class="num" id="LN70">70</td><td class="line">            <span class='macro'>BOOST_VERIFY(!posix::pthread_mutex_unlock(&amp;m))<span class='macro_popup'>(static_cast &lt;bool&gt; (!posix::pthread_mutex_unlock(&amp;<br>m)) ? void (0) : __assert_fail ("!posix::pthread_mutex_unlock(&amp;m)"<br>, "/usr/local/include/boost/thread/pthread/mutex.hpp", 70, __extension__<br> __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="71"><td class="num" id="LN71">71</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="72"><td class="num" id="LN72">72</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="73"><td class="num" id="LN73">73</td><td class="line">        <span class='keyword'>bool</span> try_lock() BOOST_THREAD_TRY_ACQUIRE(<span class='keyword'>true</span>)</td></tr>
<tr class="codeline" data-linenumber="74"><td class="num" id="LN74">74</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="75"><td class="num" id="LN75">75</td><td class="line">            <span class='keyword'>int</span> res = posix::pthread_mutex_trylock(&amp;m);</td></tr>
<tr class="codeline" data-linenumber="76"><td class="num" id="LN76">76</td><td class="line">            <span class='keyword'>if</span> (res==<span class='macro'>EBUSY<span class='macro_popup'>16</span></span>)</td></tr>
<tr class="codeline" data-linenumber="77"><td class="num" id="LN77">77</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="78"><td class="num" id="LN78">78</td><td class="line">                <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="79"><td class="num" id="LN79">79</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="80"><td class="num" id="LN80">80</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="81"><td class="num" id="LN81">81</td><td class="line">            <span class='keyword'>return</span> !res;</td></tr>
<tr class="codeline" data-linenumber="82"><td class="num" id="LN82">82</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="83"><td class="num" id="LN83">83</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="84"><td class="num" id="LN84">84</td><td class="line"><span class='directive'>#define BOOST_THREAD_DEFINES_MUTEX_NATIVE_HANDLE</span></td></tr>
<tr class="codeline" data-linenumber="85"><td class="num" id="LN85">85</td><td class="line">        <span class='keyword'>typedef</span> pthread_mutex_t* native_handle_type;</td></tr>
<tr class="codeline" data-linenumber="86"><td class="num" id="LN86">86</td><td class="line">        native_handle_type native_handle()</td></tr>
<tr class="codeline" data-linenumber="87"><td class="num" id="LN87">87</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="88"><td class="num" id="LN88">88</td><td class="line">            <span class='keyword'>return</span> &amp;m;</td></tr>
<tr class="codeline" data-linenumber="89"><td class="num" id="LN89">89</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="90"><td class="num" id="LN90">90</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="91"><td class="num" id="LN91">91</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_NESTED_LOCKS</span></td></tr>
<tr class="codeline" data-linenumber="92"><td class="num" id="LN92">92</td><td class="line">        <span class='keyword'>typedef</span> unique_lock&lt;mutex&gt; scoped_lock;</td></tr>
<tr class="codeline" data-linenumber="93"><td class="num" id="LN93">93</td><td class="line">        <span class='keyword'>typedef</span> detail::try_lock_wrapper&lt;mutex&gt; scoped_try_lock;</td></tr>
<tr class="codeline" data-linenumber="94"><td class="num" id="LN94">94</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="95"><td class="num" id="LN95">95</td><td class="line">    };</td></tr>
<tr class="codeline" data-linenumber="96"><td class="num" id="LN96">96</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="97"><td class="num" id="LN97">97</td><td class="line">    <span class='keyword'>typedef</span> mutex try_mutex;</td></tr>
<tr class="codeline" data-linenumber="98"><td class="num" id="LN98">98</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="99"><td class="num" id="LN99">99</td><td class="line">    <span class='keyword'>class</span> timed_mutex</td></tr>
<tr class="codeline" data-linenumber="100"><td class="num" id="LN100">100</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="101"><td class="num" id="LN101">101</td><td class="line">    <span class='keyword'>private</span>:</td></tr>
<tr class="codeline" data-linenumber="102"><td class="num" id="LN102">102</td><td class="line">        pthread_mutex_t m;</td></tr>
<tr class="codeline" data-linenumber="103"><td class="num" id="LN103">103</td><td class="line"><span class='directive'>#ifndef BOOST_THREAD_USES_PTHREAD_TIMEDLOCK</span></td></tr>
<tr class="codeline" data-linenumber="104"><td class="num" id="LN104">104</td><td class="line">        pthread_cond_t cond;</td></tr>
<tr class="codeline" data-linenumber="105"><td class="num" id="LN105">105</td><td class="line">        <span class='keyword'>bool</span> is_locked;</td></tr>
<tr class="codeline" data-linenumber="106"><td class="num" id="LN106">106</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="107"><td class="num" id="LN107">107</td><td class="line">    <span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="108"><td class="num" id="LN108">108</td><td class="line">        <span class='macro'>BOOST_THREAD_NO_COPYABLE(timed_mutex)<span class='macro_popup'>timed_mutex(timed_mutex const&amp;) = delete; timed_mutex&amp;<br> operator=(timed_mutex const&amp;) = delete;</span></span></td></tr>
<tr class="codeline" data-linenumber="109"><td class="num" id="LN109">109</td><td class="line">        timed_mutex()</td></tr>
<tr class="codeline" data-linenumber="110"><td class="num" id="LN110">110</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="111"><td class="num" id="LN111">111</td><td class="line">            <span class='keyword'>int</span> <span class='keyword'>const</span> res=posix::pthread_mutex_init(&amp;m);</td></tr>
<tr class="codeline" data-linenumber="112"><td class="num" id="LN112">112</td><td class="line">            <span class='keyword'>if</span>(res)</td></tr>
<tr class="codeline" data-linenumber="113"><td class="num" id="LN113">113</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="114"><td class="num" id="LN114">114</td><td class="line">                boost::throw_exception(thread_resource_error(res, <span class='string_literal'>"boost:: timed_mutex constructor failed in pthread_mutex_init"</span>));</td></tr>
<tr class="codeline" data-linenumber="115"><td class="num" id="LN115">115</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="116"><td class="num" id="LN116">116</td><td class="line"><span class='directive'>#ifndef BOOST_THREAD_USES_PTHREAD_TIMEDLOCK</span></td></tr>
<tr class="codeline" data-linenumber="117"><td class="num" id="LN117">117</td><td class="line">            <span class='keyword'>int</span> <span class='keyword'>const</span> res2=posix::pthread_cond_init(&amp;cond);</td></tr>
<tr class="codeline" data-linenumber="118"><td class="num" id="LN118">118</td><td class="line">            <span class='keyword'>if</span>(res2)</td></tr>
<tr class="codeline" data-linenumber="119"><td class="num" id="LN119">119</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="120"><td class="num" id="LN120">120</td><td class="line">                <span class='macro'>BOOST_VERIFY(!posix::pthread_mutex_destroy(&amp;m))<span class='macro_popup'>(static_cast &lt;bool&gt; (!posix::pthread_mutex_destroy(&amp;<br>m)) ? void (0) : __assert_fail ("!posix::pthread_mutex_destroy(&amp;m)"<br>, "/usr/local/include/boost/thread/pthread/mutex.hpp", 120, __extension__<br> __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="121"><td class="num" id="LN121">121</td><td class="line">                boost::throw_exception(thread_resource_error(res2, <span class='string_literal'>"boost:: timed_mutex constructor failed in pthread_cond_init"</span>));</td></tr>
<tr class="codeline" data-linenumber="122"><td class="num" id="LN122">122</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="123"><td class="num" id="LN123">123</td><td class="line">            is_locked=<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="124"><td class="num" id="LN124">124</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="125"><td class="num" id="LN125">125</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="126"><td class="num" id="LN126">126</td><td class="line">        ~timed_mutex()</td></tr>
<tr class="codeline" data-linenumber="127"><td class="num" id="LN127">127</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="128"><td class="num" id="LN128">128</td><td class="line">            <span class='macro'>BOOST_VERIFY(!posix::pthread_mutex_destroy(&amp;m))<span class='macro_popup'>(static_cast &lt;bool&gt; (!posix::pthread_mutex_destroy(&amp;<br>m)) ? void (0) : __assert_fail ("!posix::pthread_mutex_destroy(&amp;m)"<br>, "/usr/local/include/boost/thread/pthread/mutex.hpp", 128, __extension__<br> __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="129"><td class="num" id="LN129">129</td><td class="line"><span class='directive'>#ifndef BOOST_THREAD_USES_PTHREAD_TIMEDLOCK</span></td></tr>
<tr class="codeline" data-linenumber="130"><td class="num" id="LN130">130</td><td class="line">            <span class='macro'>BOOST_VERIFY(!posix::pthread_cond_destroy(&amp;cond))<span class='macro_popup'>(static_cast &lt;bool&gt; (!posix::pthread_cond_destroy(&amp;<br>cond)) ? void (0) : __assert_fail ("!posix::pthread_cond_destroy(&amp;cond)"<br>, "/usr/local/include/boost/thread/pthread/mutex.hpp", 130, __extension__<br> __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="131"><td class="num" id="LN131">131</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="132"><td class="num" id="LN132">132</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="133"><td class="num" id="LN133">133</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="134"><td class="num" id="LN134">134</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_USES_DATETIME</span></td></tr>
<tr class="codeline" data-linenumber="135"><td class="num" id="LN135">135</td><td class="line">        <span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> TimeDuration&gt;</td></tr>
<tr class="codeline" data-linenumber="136"><td class="num" id="LN136">136</td><td class="line">        <span class='keyword'>bool</span> timed_lock(TimeDuration <span class='keyword'>const</span> &amp; relative_time)</td></tr>
<tr class="codeline" data-linenumber="137"><td class="num" id="LN137">137</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="138"><td class="num" id="LN138">138</td><td class="line">            <span class='keyword'>if</span> (relative_time.is_pos_infinity())</td></tr>
<tr class="codeline" data-linenumber="139"><td class="num" id="LN139">139</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="140"><td class="num" id="LN140">140</td><td class="line">                lock();</td></tr>
<tr class="codeline" data-linenumber="141"><td class="num" id="LN141">141</td><td class="line">                <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="142"><td class="num" id="LN142">142</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="143"><td class="num" id="LN143">143</td><td class="line">            <span class='keyword'>if</span> (relative_time.is_special())</td></tr>
<tr class="codeline" data-linenumber="144"><td class="num" id="LN144">144</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="145"><td class="num" id="LN145">145</td><td class="line">                <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="146"><td class="num" id="LN146">146</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="147"><td class="num" id="LN147">147</td><td class="line">            detail::platform_duration d(relative_time);</td></tr>
<tr class="codeline" data-linenumber="148"><td class="num" id="LN148">148</td><td class="line"><span class='directive'>#if defined(BOOST_THREAD_HAS_MONO_CLOCK) &amp;&amp; !defined(BOOST_THREAD_INTERNAL_CLOCK_IS_MONO)</span></td></tr>
<tr class="codeline" data-linenumber="149"><td class="num" id="LN149">149</td><td class="line">            <span class='keyword'>const</span> detail::mono_platform_timepoint ts(detail::mono_platform_clock::now() + d);</td></tr>
<tr class="codeline" data-linenumber="150"><td class="num" id="LN150">150</td><td class="line">            d = (std::min)(d, detail::platform_milliseconds(<span class='macro'>BOOST_THREAD_POLL_INTERVAL_MILLISECONDS<span class='macro_popup'>100</span></span>));</td></tr>
<tr class="codeline" data-linenumber="151"><td class="num" id="LN151">151</td><td class="line">            <span class='keyword'>while</span> ( ! do_try_lock_until(detail::internal_platform_clock::now() + d) )</td></tr>
<tr class="codeline" data-linenumber="152"><td class="num" id="LN152">152</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="153"><td class="num" id="LN153">153</td><td class="line">              d = ts - detail::mono_platform_clock::now();</td></tr>
<tr class="codeline" data-linenumber="154"><td class="num" id="LN154">154</td><td class="line">              <span class='keyword'>if</span> ( d &lt;= detail::platform_duration::zero() ) <span class='keyword'>return</span> <span class='keyword'>false</span>; <span class='comment'>// timeout occurred</span></td></tr>
<tr class="codeline" data-linenumber="155"><td class="num" id="LN155">155</td><td class="line">              d = (std::min)(d, detail::platform_milliseconds(<span class='macro'>BOOST_THREAD_POLL_INTERVAL_MILLISECONDS<span class='macro_popup'>100</span></span>));</td></tr>
<tr class="codeline" data-linenumber="156"><td class="num" id="LN156">156</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="157"><td class="num" id="LN157">157</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="158"><td class="num" id="LN158">158</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="159"><td class="num" id="LN159">159</td><td class="line">            <span class='keyword'>return</span> do_try_lock_until(detail::internal_platform_clock::now() + d);</td></tr>
<tr class="codeline" data-linenumber="160"><td class="num" id="LN160">160</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="161"><td class="num" id="LN161">161</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="162"><td class="num" id="LN162">162</td><td class="line">        <span class='keyword'>bool</span> timed_lock(boost::xtime <span class='keyword'>const</span> &amp; absolute_time)</td></tr>
<tr class="codeline" data-linenumber="163"><td class="num" id="LN163">163</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="164"><td class="num" id="LN164">164</td><td class="line">            <span class='keyword'>return</span> timed_lock(system_time(absolute_time));</td></tr>
<tr class="codeline" data-linenumber="165"><td class="num" id="LN165">165</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="166"><td class="num" id="LN166">166</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="167"><td class="num" id="LN167">167</td><td class="line"><span class='directive'>#ifdef BOOST_THREAD_USES_PTHREAD_TIMEDLOCK</span></td></tr>
<tr class="codeline" data-linenumber="168"><td class="num" id="LN168">168</td><td class="line">        <span class='keyword'>void</span> lock()</td></tr>
<tr class="codeline" data-linenumber="169"><td class="num" id="LN169">169</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="170"><td class="num" id="LN170">170</td><td class="line">            <span class='keyword'>int</span> res = posix::pthread_mutex_lock(&amp;m);</td></tr>
<tr class="codeline" data-linenumber="171"><td class="num" id="LN171">171</td><td class="line">            <span class='keyword'>if</span> (res)</td></tr>
<tr class="codeline" data-linenumber="172"><td class="num" id="LN172">172</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="173"><td class="num" id="LN173">173</td><td class="line">                boost::throw_exception(lock_error(res,<span class='string_literal'>"boost: mutex lock failed in pthread_mutex_lock"</span>));</td></tr>
<tr class="codeline" data-linenumber="174"><td class="num" id="LN174">174</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="175"><td class="num" id="LN175">175</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="176"><td class="num" id="LN176">176</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="177"><td class="num" id="LN177">177</td><td class="line">        <span class='keyword'>void</span> unlock()</td></tr>
<tr class="codeline" data-linenumber="178"><td class="num" id="LN178">178</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="179"><td class="num" id="LN179">179</td><td class="line">            <span class='macro'>BOOST_VERIFY(!posix::pthread_mutex_unlock(&amp;m))<span class='macro_popup'>(static_cast &lt;bool&gt; (!posix::pthread_mutex_unlock(&amp;<br>m)) ? void (0) : __assert_fail ("!posix::pthread_mutex_unlock(&amp;m)"<br>, "/usr/local/include/boost/thread/pthread/mutex.hpp", 179, __extension__<br> __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="180"><td class="num" id="LN180">180</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="181"><td class="num" id="LN181">181</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="182"><td class="num" id="LN182">182</td><td class="line">        <span class='keyword'>bool</span> try_lock()</td></tr>
<tr class="codeline" data-linenumber="183"><td class="num" id="LN183">183</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="184"><td class="num" id="LN184">184</td><td class="line">          <span class='keyword'>int</span> res = posix::pthread_mutex_trylock(&amp;m);</td></tr>
<tr class="codeline" data-linenumber="185"><td class="num" id="LN185">185</td><td class="line">          <span class='keyword'>if</span> (res==<span class='macro'>EBUSY<span class='macro_popup'>16</span></span>)</td></tr>
<tr class="codeline" data-linenumber="186"><td class="num" id="LN186">186</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="187"><td class="num" id="LN187">187</td><td class="line">              <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="188"><td class="num" id="LN188">188</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="189"><td class="num" id="LN189">189</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="190"><td class="num" id="LN190">190</td><td class="line">          <span class='keyword'>return</span> !res;</td></tr>
<tr class="codeline" data-linenumber="191"><td class="num" id="LN191">191</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="192"><td class="num" id="LN192">192</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="193"><td class="num" id="LN193">193</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="194"><td class="num" id="LN194">194</td><td class="line">    <span class='keyword'>private</span>:</td></tr>
<tr class="codeline" data-linenumber="195"><td class="num" id="LN195">195</td><td class="line">        <span class='keyword'>bool</span> do_try_lock_until(detail::internal_platform_timepoint <span class='keyword'>const</span> &amp;timeout)</td></tr>
<tr class="codeline" data-linenumber="196"><td class="num" id="LN196">196</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="197"><td class="num" id="LN197">197</td><td class="line">          <span class='keyword'>int</span> <span class='keyword'>const</span> res=pthread_mutex_timedlock(&amp;m,&amp;timeout.getTs());</td></tr>
<tr class="codeline" data-linenumber="198"><td class="num" id="LN198">198</td><td class="line">          <span class='macro'>BOOST_ASSERT(!res || res==ETIMEDOUT)<span class='macro_popup'>(static_cast &lt;bool&gt; (!res || res==110) ? void (0) : __assert_fail<br> ("!res || res==110", "/usr/local/include/boost/thread/pthread/mutex.hpp"<br>, 198, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="199"><td class="num" id="LN199">199</td><td class="line">          <span class='keyword'>return</span> !res;</td></tr>
<tr class="codeline" data-linenumber="200"><td class="num" id="LN200">200</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="201"><td class="num" id="LN201">201</td><td class="line">    <span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="202"><td class="num" id="LN202">202</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="203"><td class="num" id="LN203">203</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="204"><td class="num" id="LN204">204</td><td class="line">        <span class='keyword'>void</span> lock()</td></tr>
<tr class="codeline" data-linenumber="205"><td class="num" id="LN205">205</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="206"><td class="num" id="LN206">206</td><td class="line">            boost::pthread::pthread_mutex_scoped_lock <span class='keyword'>const</span> local_lock(&amp;m);</td></tr>
<tr class="codeline" data-linenumber="207"><td class="num" id="LN207">207</td><td class="line">            <span class='keyword'>while</span>(is_locked)</td></tr>
<tr class="codeline" data-linenumber="208"><td class="num" id="LN208">208</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="209"><td class="num" id="LN209">209</td><td class="line">                <span class='macro'>BOOST_VERIFY(!posix::pthread_cond_wait(&amp;cond,&amp;m))<span class='macro_popup'>(static_cast &lt;bool&gt; (!posix::pthread_cond_wait(&amp;cond<br>,&amp;m)) ? void (0) : __assert_fail ("!posix::pthread_cond_wait(&amp;cond,&amp;m)"<br>, "/usr/local/include/boost/thread/pthread/mutex.hpp", 209, __extension__<br> __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="210"><td class="num" id="LN210">210</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="211"><td class="num" id="LN211">211</td><td class="line">            is_locked=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="212"><td class="num" id="LN212">212</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="213"><td class="num" id="LN213">213</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="214"><td class="num" id="LN214">214</td><td class="line">        <span class='keyword'>void</span> unlock()</td></tr>
<tr class="codeline" data-linenumber="215"><td class="num" id="LN215">215</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="216"><td class="num" id="LN216">216</td><td class="line">            boost::pthread::pthread_mutex_scoped_lock <span class='keyword'>const</span> local_lock(&amp;m);</td></tr>
<tr class="codeline" data-linenumber="217"><td class="num" id="LN217">217</td><td class="line">            is_locked=<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="218"><td class="num" id="LN218">218</td><td class="line">            <span class='macro'>BOOST_VERIFY(!posix::pthread_cond_signal(&amp;cond))<span class='macro_popup'>(static_cast &lt;bool&gt; (!posix::pthread_cond_signal(&amp;cond<br>)) ? void (0) : __assert_fail ("!posix::pthread_cond_signal(&amp;cond)"<br>, "/usr/local/include/boost/thread/pthread/mutex.hpp", 218, __extension__<br> __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="219"><td class="num" id="LN219">219</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="220"><td class="num" id="LN220">220</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="221"><td class="num" id="LN221">221</td><td class="line">        <span class='keyword'>bool</span> try_lock()</td></tr>
<tr class="codeline" data-linenumber="222"><td class="num" id="LN222">222</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="223"><td class="num" id="LN223">223</td><td class="line">            boost::pthread::pthread_mutex_scoped_lock <span class='keyword'>const</span> local_lock(&amp;m);</td></tr>
<tr class="codeline" data-linenumber="224"><td class="num" id="LN224">224</td><td class="line">            <span class='keyword'>if</span>(is_locked)</td></tr>
<tr class="codeline" data-linenumber="225"><td class="num" id="LN225">225</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="226"><td class="num" id="LN226">226</td><td class="line">                <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="227"><td class="num" id="LN227">227</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="228"><td class="num" id="LN228">228</td><td class="line">            is_locked=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="229"><td class="num" id="LN229">229</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="230"><td class="num" id="LN230">230</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="231"><td class="num" id="LN231">231</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="232"><td class="num" id="LN232">232</td><td class="line">    <span class='keyword'>private</span>:</td></tr>
<tr class="codeline" data-linenumber="233"><td class="num" id="LN233">233</td><td class="line">        <span class='keyword'>bool</span> do_try_lock_until(detail::internal_platform_timepoint <span class='keyword'>const</span> &amp;timeout)</td></tr>
<tr class="codeline" data-linenumber="234"><td class="num" id="LN234">234</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="235"><td class="num" id="LN235">235</td><td class="line">            boost::pthread::pthread_mutex_scoped_lock <span class='keyword'>const</span> local_lock(&amp;m);</td></tr>
<tr class="codeline" data-linenumber="236"><td class="num" id="LN236">236</td><td class="line">            <span class='keyword'>while</span>(is_locked)</td></tr>
<tr class="codeline" data-linenumber="237"><td class="num" id="LN237">237</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="238"><td class="num" id="LN238">238</td><td class="line">                <span class='keyword'>int</span> <span class='keyword'>const</span> cond_res=posix::pthread_cond_timedwait(&amp;cond,&amp;m,&amp;timeout.getTs());</td></tr>
<tr class="codeline" data-linenumber="239"><td class="num" id="LN239">239</td><td class="line">                <span class='keyword'>if</span>(cond_res==<span class='macro'>ETIMEDOUT<span class='macro_popup'>110</span></span>)</td></tr>
<tr class="codeline" data-linenumber="240"><td class="num" id="LN240">240</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="241"><td class="num" id="LN241">241</td><td class="line">                    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="242"><td class="num" id="LN242">242</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="243"><td class="num" id="LN243">243</td><td class="line">                <span class='macro'>BOOST_ASSERT(!cond_res)<span class='macro_popup'>(static_cast &lt;bool&gt; (!cond_res) ? void (0) : __assert_fail<br> ("!cond_res", "/usr/local/include/boost/thread/pthread/mutex.hpp"<br>, 243, __extension__ __PRETTY_FUNCTION__))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="244"><td class="num" id="LN244">244</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="245"><td class="num" id="LN245">245</td><td class="line">            <span class='keyword'>if</span>(is_locked)</td></tr>
<tr class="codeline" data-linenumber="246"><td class="num" id="LN246">246</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="247"><td class="num" id="LN247">247</td><td class="line">                <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="248"><td class="num" id="LN248">248</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="249"><td class="num" id="LN249">249</td><td class="line">            is_locked=<span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="250"><td class="num" id="LN250">250</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="251"><td class="num" id="LN251">251</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="252"><td class="num" id="LN252">252</td><td class="line">    <span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="253"><td class="num" id="LN253">253</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="254"><td class="num" id="LN254">254</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="255"><td class="num" id="LN255">255</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_USES_DATETIME</span></td></tr>
<tr class="codeline" data-linenumber="256"><td class="num" id="LN256">256</td><td class="line">        <span class='keyword'>bool</span> timed_lock(system_time <span class='keyword'>const</span> &amp; abs_time)</td></tr>
<tr class="codeline" data-linenumber="257"><td class="num" id="LN257">257</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="258"><td class="num" id="LN258">258</td><td class="line">            <span class='keyword'>const</span> detail::real_platform_timepoint ts(abs_time);</td></tr>
<tr class="codeline" data-linenumber="259"><td class="num" id="LN259">259</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_INTERNAL_CLOCK_IS_MONO</span></td></tr>
<tr class="codeline" data-linenumber="260"><td class="num" id="LN260">260</td><td class="line">            detail::platform_duration d(ts - detail::real_platform_clock::now());</td></tr>
<tr class="codeline" data-linenumber="261"><td class="num" id="LN261">261</td><td class="line">            d = (std::min)(d, detail::platform_milliseconds(<span class='macro'>BOOST_THREAD_POLL_INTERVAL_MILLISECONDS<span class='macro_popup'>100</span></span>));</td></tr>
<tr class="codeline" data-linenumber="262"><td class="num" id="LN262">262</td><td class="line">            <span class='keyword'>while</span> ( ! do_try_lock_until(detail::internal_platform_clock::now() + d) )</td></tr>
<tr class="codeline" data-linenumber="263"><td class="num" id="LN263">263</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="264"><td class="num" id="LN264">264</td><td class="line">              d = ts - detail::real_platform_clock::now();</td></tr>
<tr class="codeline" data-linenumber="265"><td class="num" id="LN265">265</td><td class="line">              <span class='keyword'>if</span> ( d &lt;= detail::platform_duration::zero() ) <span class='keyword'>return</span> <span class='keyword'>false</span>; <span class='comment'>// timeout occurred</span></td></tr>
<tr class="codeline" data-linenumber="266"><td class="num" id="LN266">266</td><td class="line">              d = (std::min)(d, detail::platform_milliseconds(<span class='macro'>BOOST_THREAD_POLL_INTERVAL_MILLISECONDS<span class='macro_popup'>100</span></span>));</td></tr>
<tr class="codeline" data-linenumber="267"><td class="num" id="LN267">267</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="268"><td class="num" id="LN268">268</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="269"><td class="num" id="LN269">269</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="270"><td class="num" id="LN270">270</td><td class="line">            <span class='keyword'>return</span> do_try_lock_until(ts);</td></tr>
<tr class="codeline" data-linenumber="271"><td class="num" id="LN271">271</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="272"><td class="num" id="LN272">272</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="273"><td class="num" id="LN273">273</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="274"><td class="num" id="LN274">274</td><td class="line"><span class='directive'>#ifdef BOOST_THREAD_USES_CHRONO</span></td></tr>
<tr class="codeline" data-linenumber="275"><td class="num" id="LN275">275</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Rep, <span class='keyword'>class</span> Period&gt;</td></tr>
<tr class="codeline" data-linenumber="276"><td class="num" id="LN276">276</td><td class="line">        <span class='keyword'>bool</span> try_lock_for(<span class='keyword'>const</span> chrono::duration&lt;Rep, Period&gt;&amp; rel_time)</td></tr>
<tr class="codeline" data-linenumber="277"><td class="num" id="LN277">277</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="278"><td class="num" id="LN278">278</td><td class="line">          <span class='keyword'>return</span> try_lock_until(chrono::steady_clock::now() + rel_time);</td></tr>
<tr class="codeline" data-linenumber="279"><td class="num" id="LN279">279</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="280"><td class="num" id="LN280">280</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Clock, <span class='keyword'>class</span> Duration&gt;</td></tr>
<tr class="codeline" data-linenumber="281"><td class="num" id="LN281">281</td><td class="line">        <span class='keyword'>bool</span> try_lock_until(<span class='keyword'>const</span> chrono::time_point&lt;Clock, Duration&gt;&amp; t)</td></tr>
<tr class="codeline" data-linenumber="282"><td class="num" id="LN282">282</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="283"><td class="num" id="LN283">283</td><td class="line">          <span class='keyword'>typedef</span> <span class='keyword'>typename</span> common_type&lt;Duration, <span class='keyword'>typename</span> Clock::duration&gt;::type common_duration;</td></tr>
<tr class="codeline" data-linenumber="284"><td class="num" id="LN284">284</td><td class="line">          common_duration d(t - Clock::now());</td></tr>
<tr class="codeline" data-linenumber="285"><td class="num" id="LN285">285</td><td class="line">          d = (std::min)(d, common_duration(chrono::milliseconds(<span class='macro'>BOOST_THREAD_POLL_INTERVAL_MILLISECONDS<span class='macro_popup'>100</span></span>)));</td></tr>
<tr class="codeline" data-linenumber="286"><td class="num" id="LN286">286</td><td class="line">          <span class='keyword'>while</span> ( ! try_lock_until(detail::internal_chrono_clock::now() + d))</td></tr>
<tr class="codeline" data-linenumber="287"><td class="num" id="LN287">287</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="288"><td class="num" id="LN288">288</td><td class="line">              d = t - Clock::now();</td></tr>
<tr class="codeline" data-linenumber="289"><td class="num" id="LN289">289</td><td class="line">              <span class='keyword'>if</span> ( d &lt;= common_duration::zero() ) <span class='keyword'>return</span> <span class='keyword'>false</span>; <span class='comment'>// timeout occurred</span></td></tr>
<tr class="codeline" data-linenumber="290"><td class="num" id="LN290">290</td><td class="line">              d = (std::min)(d, common_duration(chrono::milliseconds(<span class='macro'>BOOST_THREAD_POLL_INTERVAL_MILLISECONDS<span class='macro_popup'>100</span></span>)));</td></tr>
<tr class="codeline" data-linenumber="291"><td class="num" id="LN291">291</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="292"><td class="num" id="LN292">292</td><td class="line">          <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="293"><td class="num" id="LN293">293</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="294"><td class="num" id="LN294">294</td><td class="line">        <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> Duration&gt;</td></tr>
<tr class="codeline" data-linenumber="295"><td class="num" id="LN295">295</td><td class="line">        <span class='keyword'>bool</span> try_lock_until(<span class='keyword'>const</span> chrono::time_point&lt;detail::internal_chrono_clock, Duration&gt;&amp; t)</td></tr>
<tr class="codeline" data-linenumber="296"><td class="num" id="LN296">296</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="297"><td class="num" id="LN297">297</td><td class="line">          detail::internal_platform_timepoint ts(t);</td></tr>
<tr class="codeline" data-linenumber="298"><td class="num" id="LN298">298</td><td class="line">          <span class='keyword'>return</span> do_try_lock_until(ts);</td></tr>
<tr class="codeline" data-linenumber="299"><td class="num" id="LN299">299</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="300"><td class="num" id="LN300">300</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="301"><td class="num" id="LN301">301</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="302"><td class="num" id="LN302">302</td><td class="line"><span class='directive'>#define BOOST_THREAD_DEFINES_TIMED_MUTEX_NATIVE_HANDLE</span></td></tr>
<tr class="codeline" data-linenumber="303"><td class="num" id="LN303">303</td><td class="line">        <span class='keyword'>typedef</span> pthread_mutex_t* native_handle_type;</td></tr>
<tr class="codeline" data-linenumber="304"><td class="num" id="LN304">304</td><td class="line">        native_handle_type native_handle()</td></tr>
<tr class="codeline" data-linenumber="305"><td class="num" id="LN305">305</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="306"><td class="num" id="LN306">306</td><td class="line">            <span class='keyword'>return</span> &amp;m;</td></tr>
<tr class="codeline" data-linenumber="307"><td class="num" id="LN307">307</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="308"><td class="num" id="LN308">308</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="309"><td class="num" id="LN309">309</td><td class="line"><span class='directive'>#if defined BOOST_THREAD_PROVIDES_NESTED_LOCKS</span></td></tr>
<tr class="codeline" data-linenumber="310"><td class="num" id="LN310">310</td><td class="line">        <span class='keyword'>typedef</span> unique_lock&lt;timed_mutex&gt; scoped_timed_lock;</td></tr>
<tr class="codeline" data-linenumber="311"><td class="num" id="LN311">311</td><td class="line">        <span class='keyword'>typedef</span> detail::try_lock_wrapper&lt;timed_mutex&gt; scoped_try_lock;</td></tr>
<tr class="codeline" data-linenumber="312"><td class="num" id="LN312">312</td><td class="line">        <span class='keyword'>typedef</span> scoped_timed_lock scoped_lock;</td></tr>
<tr class="codeline" data-linenumber="313"><td class="num" id="LN313">313</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="314"><td class="num" id="LN314">314</td><td class="line">    };</td></tr>
<tr class="codeline" data-linenumber="315"><td class="num" id="LN315">315</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="316"><td class="num" id="LN316">316</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="317"><td class="num" id="LN317">317</td><td class="line"><span class='directive'>#include &lt;boost/config/abi_suffix.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="318"><td class="num" id="LN318">318</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="319"><td class="num" id="LN319">319</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="320"><td class="num" id="LN320">320</td><td class="line"><span class='directive'>#endif</span></td></tr>
</table><hr class=divider>
<div id=File112609>
<div class=FileNav><a href="#File369278">&#x2190;</a></div><h4 class=FileName>/usr/local/include/boost/throw_exception.hpp</h4>
</div>
<table class="code" data-fileid="112609">
<tr class="codeline" data-linenumber="1"><td class="num" id="LN1">1</td><td class="line"><span class='directive'>#ifndef BOOST_THROW_EXCEPTION_HPP_INCLUDED</span></td></tr>
<tr class="codeline" data-linenumber="2"><td class="num" id="LN2">2</td><td class="line"><span class='directive'>#define BOOST_THROW_EXCEPTION_HPP_INCLUDED</span></td></tr>
<tr class="codeline" data-linenumber="3"><td class="num" id="LN3">3</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4"><td class="num" id="LN4">4</td><td class="line"><span class='comment'>// MS compatible compilers support #pragma once</span></td></tr>
<tr class="codeline" data-linenumber="5"><td class="num" id="LN5">5</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6"><td class="num" id="LN6">6</td><td class="line"><span class='directive'>#if defined(_MSC_VER) &amp;&amp; (_MSC_VER &gt;= 1020)</span></td></tr>
<tr class="codeline" data-linenumber="7"><td class="num" id="LN7">7</td><td class="line"><span class='directive'># pragma once</span></td></tr>
<tr class="codeline" data-linenumber="8"><td class="num" id="LN8">8</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="9"><td class="num" id="LN9">9</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="10"><td class="num" id="LN10">10</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="11"><td class="num" id="LN11">11</td><td class="line"><span class='comment'>//  boost/throw_exception.hpp</span></td></tr>
<tr class="codeline" data-linenumber="12"><td class="num" id="LN12">12</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="13"><td class="num" id="LN13">13</td><td class="line"><span class='comment'>//  Copyright (c) 2002, 2018, 2019 Peter Dimov</span></td></tr>
<tr class="codeline" data-linenumber="14"><td class="num" id="LN14">14</td><td class="line"><span class='comment'>//  Copyright (c) 2008-2009 Emil Dotchevski and Reverge Studios, Inc.</span></td></tr>
<tr class="codeline" data-linenumber="15"><td class="num" id="LN15">15</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="16"><td class="num" id="LN16">16</td><td class="line"><span class='comment'>//  Distributed under the Boost Software License, Version 1.0. (See</span></td></tr>
<tr class="codeline" data-linenumber="17"><td class="num" id="LN17">17</td><td class="line"><span class='comment'>//  accompanying file LICENSE_1_0.txt or copy at</span></td></tr>
<tr class="codeline" data-linenumber="18"><td class="num" id="LN18">18</td><td class="line"><span class='comment'>//  http://www.boost.org/LICENSE_1_0.txt)</span></td></tr>
<tr class="codeline" data-linenumber="19"><td class="num" id="LN19">19</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="20"><td class="num" id="LN20">20</td><td class="line"><span class='comment'>//  http://www.boost.org/libs/throw_exception</span></td></tr>
<tr class="codeline" data-linenumber="21"><td class="num" id="LN21">21</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="22"><td class="num" id="LN22">22</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="23"><td class="num" id="LN23">23</td><td class="line"><span class='directive'>#include &lt;boost/exception/exception.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="24"><td class="num" id="LN24">24</td><td class="line"><span class='directive'>#include &lt;boost/assert/source_location.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="25"><td class="num" id="LN25">25</td><td class="line"><span class='directive'>#include &lt;boost/config.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="26"><td class="num" id="LN26">26</td><td class="line"><span class='directive'>#include &lt;boost/config/workaround.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="27"><td class="num" id="LN27">27</td><td class="line"><span class='directive'>#include &lt;exception&gt;</span></td></tr>
<tr class="codeline" data-linenumber="28"><td class="num" id="LN28">28</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="29"><td class="num" id="LN29">29</td><td class="line"><span class='directive'>#if !defined( BOOST_EXCEPTION_DISABLE ) &amp;&amp; defined( BOOST_BORLANDC ) &amp;&amp; <span class='macro'>BOOST_WORKAROUND( BOOST_BORLANDC, BOOST_TESTED_AT(0x593) )<span class='macro_popup'>((1 + 0 == 0) &amp;&amp; (BOOST_BORLANDC != 0) &amp;&amp; (1 %<br> (( (BOOST_BORLANDC != ((0x593)-(0x593))) ) + 1)))</span></span></span></td></tr>
<tr class="codeline" data-linenumber="30"><td class="num" id="LN30">30</td><td class="line"><span class='directive'># define BOOST_EXCEPTION_DISABLE</span></td></tr>
<tr class="codeline" data-linenumber="31"><td class="num" id="LN31">31</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="32"><td class="num" id="LN32">32</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="33"><td class="num" id="LN33">33</td><td class="line"><span class='keyword'>namespace</span> boost</td></tr>
<tr class="codeline" data-linenumber="34"><td class="num" id="LN34">34</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="35"><td class="num" id="LN35">35</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="36"><td class="num" id="LN36">36</td><td class="line"><span class='directive'>#if defined( BOOST_NO_EXCEPTIONS )</span></td></tr>
<tr class="codeline" data-linenumber="37"><td class="num" id="LN37">37</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="38"><td class="num" id="LN38">38</td><td class="line"><span class='macro'>BOOST_NORETURN<span class='macro_popup'>__attribute__ ((__noreturn__))</span></span> <span class='keyword'>void</span> throw_exception( std::exception <span class='keyword'>const</span> &amp; e ); <span class='comment'>// user defined</span></td></tr>
<tr class="codeline" data-linenumber="39"><td class="num" id="LN39">39</td><td class="line"><span class='macro'>BOOST_NORETURN<span class='macro_popup'>__attribute__ ((__noreturn__))</span></span> <span class='keyword'>void</span> throw_exception( std::exception <span class='keyword'>const</span> &amp; e, boost::source_location <span class='keyword'>const</span> &amp; loc ); <span class='comment'>// user defined</span></td></tr>
<tr class="codeline" data-linenumber="40"><td class="num" id="LN40">40</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="41"><td class="num" id="LN41">41</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="42"><td class="num" id="LN42">42</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="43"><td class="num" id="LN43">43</td><td class="line"><span class='comment'>// boost::wrapexcept&lt;E&gt;</span></td></tr>
<tr class="codeline" data-linenumber="44"><td class="num" id="LN44">44</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="45"><td class="num" id="LN45">45</td><td class="line"><span class='keyword'>namespace</span> detail</td></tr>
<tr class="codeline" data-linenumber="46"><td class="num" id="LN46">46</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="47"><td class="num" id="LN47">47</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="48"><td class="num" id="LN48">48</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>char</span> (&amp;wrapexcept_s1)[ 1 ];</td></tr>
<tr class="codeline" data-linenumber="49"><td class="num" id="LN49">49</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>char</span> (&amp;wrapexcept_s2)[ 2 ];</td></tr>
<tr class="codeline" data-linenumber="50"><td class="num" id="LN50">50</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="51"><td class="num" id="LN51">51</td><td class="line"><span class='keyword'>template</span>&lt;<span class='keyword'>class</span> T&gt; wrapexcept_s1 wrapexcept_is_convertible( T* );</td></tr>
<tr class="codeline" data-linenumber="52"><td class="num" id="LN52">52</td><td class="line"><span class='keyword'>template</span>&lt;<span class='keyword'>class</span> T&gt; wrapexcept_s2 wrapexcept_is_convertible( <span class='keyword'>void</span>* );</td></tr>
<tr class="codeline" data-linenumber="53"><td class="num" id="LN53">53</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="54"><td class="num" id="LN54">54</td><td class="line"><span class='keyword'>template</span>&lt;<span class='keyword'>class</span> E, <span class='keyword'>class</span> B, <span class='keyword'>int</span> I = <span class='keyword'>sizeof</span>( wrapexcept_is_convertible&lt;B&gt;( <span class='keyword'>static_cast</span>&lt; E* &gt;( 0 ) ) ) &gt; <span class='keyword'>struct</span> wrapexcept_add_base;</td></tr>
<tr class="codeline" data-linenumber="55"><td class="num" id="LN55">55</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="56"><td class="num" id="LN56">56</td><td class="line"><span class='keyword'>template</span>&lt;<span class='keyword'>class</span> E, <span class='keyword'>class</span> B&gt; <span class='keyword'>struct</span> wrapexcept_add_base&lt;E, B, 1&gt;</td></tr>
<tr class="codeline" data-linenumber="57"><td class="num" id="LN57">57</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="58"><td class="num" id="LN58">58</td><td class="line">    <span class='keyword'>struct</span> type {};</td></tr>
<tr class="codeline" data-linenumber="59"><td class="num" id="LN59">59</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="60"><td class="num" id="LN60">60</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="61"><td class="num" id="LN61">61</td><td class="line"><span class='keyword'>template</span>&lt;<span class='keyword'>class</span> E, <span class='keyword'>class</span> B&gt; <span class='keyword'>struct</span> wrapexcept_add_base&lt;E, B, 2&gt;</td></tr>
<tr class="codeline" data-linenumber="62"><td class="num" id="LN62">62</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="63"><td class="num" id="LN63">63</td><td class="line">    <span class='keyword'>typedef</span> B type;</td></tr>
<tr class="codeline" data-linenumber="64"><td class="num" id="LN64">64</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="65"><td class="num" id="LN65">65</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="66"><td class="num" id="LN66">66</td><td class="line">} <span class='comment'>// namespace detail</span></td></tr>
<tr class="codeline" data-linenumber="67"><td class="num" id="LN67">67</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="68"><td class="num" id="LN68">68</td><td class="line"><span class='keyword'>template</span>&lt;<span class='keyword'>class</span> E&gt; <span class='keyword'>struct</span> <span class='macro'>BOOST_SYMBOL_VISIBLE<span class='macro_popup'>__attribute__((__visibility__("default")))</span></span> wrapexcept:</td></tr>
<tr class="codeline" data-linenumber="69"><td class="num" id="LN69">69</td><td class="line">    <span class='keyword'>public</span> detail::wrapexcept_add_base&lt;E, boost::exception_detail::clone_base&gt;::type,</td></tr>
<tr class="codeline" data-linenumber="70"><td class="num" id="LN70">70</td><td class="line">    <span class='keyword'>public</span> E,</td></tr>
<tr class="codeline" data-linenumber="71"><td class="num" id="LN71">71</td><td class="line">    <span class='keyword'>public</span> detail::wrapexcept_add_base&lt;E, boost::exception&gt;::type</td></tr>
<tr class="codeline" data-linenumber="72"><td class="num" id="LN72">72</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="73"><td class="num" id="LN73">73</td><td class="line"><span class='keyword'>private</span>:</td></tr>
<tr class="codeline" data-linenumber="74"><td class="num" id="LN74">74</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="75"><td class="num" id="LN75">75</td><td class="line">    <span class='keyword'>struct</span> deleter</td></tr>
<tr class="codeline" data-linenumber="76"><td class="num" id="LN76">76</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="77"><td class="num" id="LN77">77</td><td class="line">        wrapexcept * p_;</td></tr>
<tr class="codeline" data-linenumber="78"><td class="num" id="LN78">78</td><td class="line">        ~deleter() { <span class='keyword'>delete</span> p_; }</td></tr>
<tr class="codeline" data-linenumber="79"><td class="num" id="LN79">79</td><td class="line">    };</td></tr>
<tr class="codeline" data-linenumber="80"><td class="num" id="LN80">80</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="81"><td class="num" id="LN81">81</td><td class="line"><span class='keyword'>private</span>:</td></tr>
<tr class="codeline" data-linenumber="82"><td class="num" id="LN82">82</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="83"><td class="num" id="LN83">83</td><td class="line">    <span class='keyword'>void</span> copy_from( <span class='keyword'>void</span> <span class='keyword'>const</span>* )</td></tr>
<tr class="codeline" data-linenumber="84"><td class="num" id="LN84">84</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="85"><td class="num" id="LN85">85</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="86"><td class="num" id="LN86">86</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="87"><td class="num" id="LN87">87</td><td class="line">    <span class='keyword'>void</span> copy_from( boost::exception <span class='keyword'>const</span>* p )</td></tr>
<tr class="codeline" data-linenumber="88"><td class="num" id="LN88">88</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="89"><td class="num" id="LN89">89</td><td class="line">        <span class='keyword'>static_cast</span>&lt;boost::exception&amp;&gt;( *<span class='keyword'>this</span> ) = *p;</td></tr>
<tr class="codeline" data-linenumber="90"><td class="num" id="LN90">90</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="91"><td class="num" id="LN91">91</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="92"><td class="num" id="LN92">92</td><td class="line"><span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="93"><td class="num" id="LN93">93</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="94"><td class="num" id="LN94">94</td><td class="line">    <span class='keyword'>explicit</span> wrapexcept( E <span class='keyword'>const</span> &amp; e ): E( e )</td></tr>
<tr class="codeline" data-linenumber="95"><td class="num" id="LN95">95</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="96"><td class="num" id="LN96">96</td><td class="line">        copy_from( &amp;e );</td></tr>
<tr class="codeline" data-linenumber="97"><td class="num" id="LN97">97</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="98"><td class="num" id="LN98">98</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="99"><td class="num" id="LN99">99</td><td class="line">    <span class='keyword'>explicit</span> wrapexcept( E <span class='keyword'>const</span> &amp; e, boost::source_location <span class='keyword'>const</span> &amp; loc ): E( e )</td></tr>
<tr class="codeline" data-linenumber="100"><td class="num" id="LN100">100</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="101"><td class="num" id="LN101">101</td><td class="line">        copy_from( &amp;e );</td></tr>
<tr class="codeline" data-linenumber="102"><td class="num" id="LN102">102</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="103"><td class="num" id="LN103">103</td><td class="line">        set_info( *<span class='keyword'>this</span>, throw_file( loc.file_name() ) );</td></tr>
<tr class="codeline" data-linenumber="104"><td class="num" id="LN104">104</td><td class="line">        set_info( *<span class='keyword'>this</span>, throw_line( loc.line() ) );</td></tr>
<tr class="codeline" data-linenumber="105"><td class="num" id="LN105">105</td><td class="line">        set_info( *<span class='keyword'>this</span>, throw_function( loc.function_name() ) );</td></tr>
<tr class="codeline" data-linenumber="106"><td class="num" id="LN106">106</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="107"><td class="num" id="LN107">107</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="108"><td class="num" id="LN108">108</td><td class="line">    <span class='keyword'>virtual</span> boost::exception_detail::clone_base <span class='keyword'>const</span> * clone() <span class='keyword'>const</span> <span class='macro'>BOOST_OVERRIDE<span class='macro_popup'>override</span></span></td></tr>
<tr class="codeline" data-linenumber="109"><td class="num" id="LN109">109</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="110"><td class="num" id="LN110">110</td><td class="line">        wrapexcept * p = <span class='keyword'>new</span> wrapexcept( *<span class='keyword'>this</span> );</td></tr>
<tr class="codeline" data-linenumber="111"><td class="num" id="LN111">111</td><td class="line">        deleter del = { p };</td></tr>
<tr class="codeline" data-linenumber="112"><td class="num" id="LN112">112</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="113"><td class="num" id="LN113">113</td><td class="line">        boost::exception_detail::copy_boost_exception( p, <span class='keyword'>this</span> );</td></tr>
<tr class="codeline" data-linenumber="114"><td class="num" id="LN114">114</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="115"><td class="num" id="LN115">115</td><td class="line">        del.p_ = 0;</td></tr>
<tr class="codeline" data-linenumber="116"><td class="num" id="LN116">116</td><td class="line">        <span class='keyword'>return</span> p;</td></tr>
<tr class="codeline" data-linenumber="117"><td class="num" id="LN117">117</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="118"><td class="num" id="LN118">118</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="119"><td class="num" id="LN119">119</td><td class="line">    <span class='keyword'>virtual</span> <span class='keyword'>void</span> rethrow() <span class='keyword'>const</span> <span class='macro'>BOOST_OVERRIDE<span class='macro_popup'>override</span></span></td></tr>
<tr class="codeline" data-linenumber="120"><td class="num" id="LN120">120</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="121"><td class="num" id="LN121">121</td><td class="line"><span class='directive'>#if defined( BOOST_NO_EXCEPTIONS )</span></td></tr>
<tr class="codeline" data-linenumber="122"><td class="num" id="LN122">122</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="123"><td class="num" id="LN123">123</td><td class="line">        boost::throw_exception( *<span class='keyword'>this</span> );</td></tr>
<tr class="codeline" data-linenumber="124"><td class="num" id="LN124">124</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="125"><td class="num" id="LN125">125</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="126"><td class="num" id="LN126">126</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="127"><td class="num" id="LN127">127</td><td class="line">        <span class='keyword'>throw</span> *<span class='keyword'>this</span>;</td></tr>
<tr class="codeline" data-linenumber="128"><td class="num" id="LN128">128</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="129"><td class="num" id="LN129">129</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="130"><td class="num" id="LN130">130</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="131"><td class="num" id="LN131">131</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="132"><td class="num" id="LN132">132</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="133"><td class="num" id="LN133">133</td><td class="line"><span class='comment'>// All boost exceptions are required to derive from std::exception,</span></td></tr>
<tr class="codeline" data-linenumber="134"><td class="num" id="LN134">134</td><td class="line"><span class='comment'>// to ensure compatibility with BOOST_NO_EXCEPTIONS.</span></td></tr>
<tr class="codeline" data-linenumber="135"><td class="num" id="LN135">135</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="136"><td class="num" id="LN136">136</td><td class="line"><span class='keyword'>inline</span> <span class='keyword'>void</span> throw_exception_assert_compatibility( std::exception <span class='keyword'>const</span> &amp; ) {}</td></tr>
<tr class="codeline" data-linenumber="137"><td class="num" id="LN137">137</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="138"><td class="num" id="LN138">138</td><td class="line"><span class='comment'>// boost::throw_exception</span></td></tr>
<tr class="codeline" data-linenumber="139"><td class="num" id="LN139">139</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="140"><td class="num" id="LN140">140</td><td class="line"><span class='directive'>#if !defined( BOOST_NO_EXCEPTIONS )</span></td></tr>
<tr class="codeline" data-linenumber="141"><td class="num" id="LN141">141</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="142"><td class="num" id="LN142">142</td><td class="line"><span class='directive'>#if defined( BOOST_EXCEPTION_DISABLE )</span></td></tr>
<tr class="codeline" data-linenumber="143"><td class="num" id="LN143">143</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="144"><td class="num" id="LN144">144</td><td class="line"><span class='keyword'>template</span>&lt;<span class='keyword'>class</span> E&gt; <span class='macro'>BOOST_NORETURN<span class='macro_popup'>__attribute__ ((__noreturn__))</span></span> <span class='keyword'>void</span> throw_exception( E <span class='keyword'>const</span> &amp; e )</td></tr>
<tr class="codeline" data-linenumber="145"><td class="num" id="LN145">145</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="146"><td class="num" id="LN146">146</td><td class="line">    throw_exception_assert_compatibility( e );</td></tr>
<tr class="codeline" data-linenumber="147"><td class="num" id="LN147">147</td><td class="line">    <span class='keyword'>throw</span> e;</td></tr>
<tr class="codeline" data-linenumber="148"><td class="num" id="LN148">148</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="149"><td class="num" id="LN149">149</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="150"><td class="num" id="LN150">150</td><td class="line"><span class='keyword'>template</span>&lt;<span class='keyword'>class</span> E&gt; <span class='macro'>BOOST_NORETURN<span class='macro_popup'>__attribute__ ((__noreturn__))</span></span> <span class='keyword'>void</span> throw_exception( E <span class='keyword'>const</span> &amp; e, boost::source_location <span class='keyword'>const</span> &amp; )</td></tr>
<tr class="codeline" data-linenumber="151"><td class="num" id="LN151">151</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="152"><td class="num" id="LN152">152</td><td class="line">    throw_exception_assert_compatibility( e );</td></tr>
<tr class="codeline" data-linenumber="153"><td class="num" id="LN153">153</td><td class="line">    <span class='keyword'>throw</span> e;</td></tr>
<tr class="codeline" data-linenumber="154"><td class="num" id="LN154">154</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="155"><td class="num" id="LN155">155</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="156"><td class="num" id="LN156">156</td><td class="line"><span class='directive'>#else // defined( BOOST_EXCEPTION_DISABLE )</span></td></tr>
<tr class="codeline" data-linenumber="157"><td class="num" id="LN157">157</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="158"><td class="num" id="LN158">158</td><td class="line"><span class='keyword'>template</span>&lt;<span class='keyword'>class</span> E&gt; <span class='macro'>BOOST_NORETURN<span class='macro_popup'>__attribute__ ((__noreturn__))</span></span> <span class='keyword'>void</span> throw_exception( E <span class='keyword'>const</span> &amp; e )</td></tr>
<tr class="codeline" data-linenumber="159"><td class="num" id="LN159">159</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="160"><td class="num" id="LN160">160</td><td class="line">    throw_exception_assert_compatibility( e );</td></tr>
<tr class="codeline" data-linenumber="161"><td class="num" id="LN161">161</td><td class="line">    <span class='keyword'>throw</span> wrapexcept&lt;E&gt;( e );</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path32" class="msg msgEvent" style="margin-left:5ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">32</div></td><td><div class="PathNav"><a href="#Path31" title="Previous event (31)">&#x2190;</a></div></td><td>Throwing exception</td><td><div class="PathNav"><a href="#Path33" title="Next event (33)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path48" class="msg msgEvent" style="margin-left:5ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">48</div></td><td><div class="PathNav"><a href="#Path47" title="Previous event (47)">&#x2190;</a></div></td><td>Throwing exception</td><td><div class="PathNav"><a href="#Path49" title="Next event (49)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="162"><td class="num" id="LN162">162</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="163"><td class="num" id="LN163">163</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="164"><td class="num" id="LN164">164</td><td class="line"><span class='keyword'>template</span>&lt;<span class='keyword'>class</span> E&gt; <span class='macro'>BOOST_NORETURN<span class='macro_popup'>__attribute__ ((__noreturn__))</span></span> <span class='keyword'>void</span> throw_exception( E <span class='keyword'>const</span> &amp; e, boost::source_location <span class='keyword'>const</span> &amp; loc )</td></tr>
<tr class="codeline" data-linenumber="165"><td class="num" id="LN165">165</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="166"><td class="num" id="LN166">166</td><td class="line">    throw_exception_assert_compatibility( e );</td></tr>
<tr class="codeline" data-linenumber="167"><td class="num" id="LN167">167</td><td class="line">    <span class='keyword'>throw</span> wrapexcept&lt;E&gt;( e, loc );</td></tr>
<tr class="codeline" data-linenumber="168"><td class="num" id="LN168">168</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="169"><td class="num" id="LN169">169</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="170"><td class="num" id="LN170">170</td><td class="line"><span class='directive'>#endif // defined( BOOST_EXCEPTION_DISABLE )</span></td></tr>
<tr class="codeline" data-linenumber="171"><td class="num" id="LN171">171</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="172"><td class="num" id="LN172">172</td><td class="line"><span class='directive'>#endif // !defined( BOOST_NO_EXCEPTIONS )</span></td></tr>
<tr class="codeline" data-linenumber="173"><td class="num" id="LN173">173</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="174"><td class="num" id="LN174">174</td><td class="line">} <span class='comment'>// namespace boost</span></td></tr>
<tr class="codeline" data-linenumber="175"><td class="num" id="LN175">175</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="176"><td class="num" id="LN176">176</td><td class="line"><span class='comment'>// BOOST_THROW_EXCEPTION</span></td></tr>
<tr class="codeline" data-linenumber="177"><td class="num" id="LN177">177</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="178"><td class="num" id="LN178">178</td><td class="line"><span class='directive'>#define <span class='macro'>BOOST_THROW_EXCEPTION(x)<span class='macro_popup'>::boost::throw_exception(x, ::boost::source_location("/usr/local/include/boost/throw_exception.hpp"<br>, 178, static_cast&lt;char const*&gt;(__PRETTY_FUNCTION__)))</span></span> ::boost::throw_exception(x, <span class='macro'>BOOST_CURRENT_LOCATION<span class='macro_popup'>::boost::source_location("/usr/local/include/boost/throw_exception.hpp"<br>, 178, static_cast&lt;char const*&gt;(__PRETTY_FUNCTION__))</span></span>)</span></td></tr>
<tr class="codeline" data-linenumber="179"><td class="num" id="LN179">179</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="180"><td class="num" id="LN180">180</td><td class="line"><span class='directive'>#endif // #ifndef BOOST_THROW_EXCEPTION_HPP_INCLUDED</span></td></tr>
</table></body></html>
