<!doctype html>
<html>
<head>
<title>/home/zhh/projects/opencv-4.5.2/modules/core/src/system.cpp</title>

<style type="text/css">
body { color:#000000; background-color:#ffffff }
body { font-family:Helvetica, sans-serif; font-size:10pt }
h1 { font-size:14pt }
.FileName { margin-top: 5px; margin-bottom: 5px; display: inline; }
.FileNav { margin-left: 5px; margin-right: 5px; display: inline; }
.FileNav a { text-decoration:none; font-size: larger; }
.divider { margin-top: 30px; margin-bottom: 30px; height: 15px; }
.divider { background-color: gray; }
.code { border-collapse:collapse; width:100%; }
.code { font-family: "Monospace", monospace; font-size:10pt }
.code { line-height: 1.2em }
.comment { color: green; font-style: oblique }
.keyword { color: blue }
.string_literal { color: red }
.directive { color: darkmagenta }

/* Macros and variables could have pop-up notes hidden by default.
  - Macro pop-up:    expansion of the macro
  - Variable pop-up: value (table) of the variable */
.macro_popup, .variable_popup { display: none; }

/* Pop-up appears on mouse-hover event. */
.macro:hover .macro_popup, .variable:hover .variable_popup {
  display: block;
  padding: 2px;
  -webkit-border-radius:5px;
  -webkit-box-shadow:1px 1px 7px #000;
  border-radius:5px;
  box-shadow:1px 1px 7px #000;
  position: absolute;
  top: -1em;
  left:10em;
  z-index: 1
}

.macro_popup {
  border: 2px solid red;
  background-color:#FFF0F0;
  font-weight: normal;
}

.variable_popup {
  border: 2px solid blue;
  background-color:#F0F0FF;
  font-weight: bold;
  font-family: Helvetica, sans-serif;
  font-size: 9pt;
}

/* Pop-up notes needs a relative position as a base where they pops up. */
.macro, .variable {
  background-color: PaleGoldenRod;
  position: relative;
}
.macro { color: DarkMagenta; }

#tooltiphint {
  position: fixed;
  width: 50em;
  margin-left: -25em;
  left: 50%;
  padding: 10px;
  border: 1px solid #b0b0b0;
  border-radius: 2px;
  box-shadow: 1px 1px 7px black;
  background-color: #c0c0c0;
  z-index: 2;
}

.num { width:2.5em; padding-right:2ex; background-color:#eeeeee }
.num { text-align:right; font-size:8pt }
.num { color:#444444 }
.line { padding-left: 1ex; border-left: 3px solid #ccc }
.line { white-space: pre }
.msg { -webkit-box-shadow:1px 1px 7px #000 }
.msg { box-shadow:1px 1px 7px #000 }
.msg { -webkit-border-radius:5px }
.msg { border-radius:5px }
.msg { font-family:Helvetica, sans-serif; font-size:8pt }
.msg { float:left }
.msg { padding:0.25em 1ex 0.25em 1ex }
.msg { margin-top:10px; margin-bottom:10px }
.msg { font-weight:bold }
.msg { max-width:60em; word-wrap: break-word; white-space: pre-wrap }
.msgT { padding:0x; spacing:0x }
.msgEvent { background-color:#fff8b4; color:#000000 }
.msgControl { background-color:#bbbbbb; color:#000000 }
.msgNote { background-color:#ddeeff; color:#000000 }
.mrange { background-color:#dfddf3 }
.mrange { border-bottom:1px solid #6F9DBE }
.PathIndex { font-weight: bold; padding:0px 5px; margin-right:5px; }
.PathIndex { -webkit-border-radius:8px }
.PathIndex { border-radius:8px }
.PathIndexEvent { background-color:#bfba87 }
.PathIndexControl { background-color:#8c8c8c }
.PathIndexPopUp { background-color: #879abc; }
.PathNav a { text-decoration:none; font-size: larger }
.CodeInsertionHint { font-weight: bold; background-color: #10dd10 }
.CodeRemovalHint { background-color:#de1010 }
.CodeRemovalHint { border-bottom:1px solid #6F9DBE }
.selected{ background-color:orange !important; }

table.simpletable {
  padding: 5px;
  font-size:12pt;
  margin:20px;
  border-collapse: collapse; border-spacing: 0px;
}
td.rowname {
  text-align: right;
  vertical-align: top;
  font-weight: bold;
  color:#444444;
  padding-right:2ex;
}

/* Hidden text. */
input.spoilerhider + label {
  cursor: pointer;
  text-decoration: underline;
  display: block;
}
input.spoilerhider {
 display: none;
}
input.spoilerhider ~ .spoiler {
  overflow: hidden;
  margin: 10px auto 0;
  height: 0;
  opacity: 0;
}
input.spoilerhider:checked + label + .spoiler{
  height: auto;
  opacity: 1;
}
</style>
</head>
<body>
<!-- BUGDESC Exception being thrown out of destructor -->

<!-- BUGTYPE Throw out of destructor -->

<!-- BUGCATEGORY Exception -->

<!-- BUGFILE /home/zhh/projects/opencv-4.5.2/modules/core/src/system.cpp -->

<!-- FILENAME system.cpp -->

<!-- FUNCTIONNAME ~TLSDataContainer -->

<!-- ISSUEHASHCONTENTOFLINEINCONTEXT e6e91c3953c309409d210fd452851fe2 -->

<!-- BUGLINE 1758 -->

<!-- BUGCOLUMN 1 -->

<!-- EXCEPTIONAL -->

<!-- BUGPATHLENGTH 16 -->

<!-- BUGMETAEND -->
<!-- REPORTHEADER -->
<h3>Bug Summary [throw at system.cpp:1149:5]</h3>
<table class="simpletable">
<tr><td class="rowname">File:</td><td>/home/zhh/projects/opencv-4.5.2/modules/core/src/system.cpp</td></tr>
<tr><td class="rowname">Warning:</td><td><a href="#EndPath">line 1758, column 1</a><br />Exception being thrown out of destructor</td></tr>

</table>
<!-- REPORTSUMMARYEXTRA -->
<h3>Annotated Source Code</h3>
<p>Press <a href="#" onclick="toggleHelp(); return false;">'?'</a>
   to see keyboard shortcuts</p>
<input type="checkbox" class="spoilerhider" id="showinvocation" />
<label for="showinvocation" >Show analyzer invocation</label>
<div class="spoiler">clang -cc1 -cc1 -triple x86_64-unknown-linux-gnu -analyze -disable-free -disable-llvm-verifier -discard-value-names -main-file-name histogram.cpp -analyzer-store=region -analyzer-opt-analyze-nested-blocks -analyzer-checker=core -analyzer-checker=apiModeling -analyzer-checker=unix -analyzer-checker=deadcode -analyzer-checker=cplusplus -analyzer-checker=security.insecureAPI.UncheckedReturn -analyzer-checker=security.insecureAPI.getpw -analyzer-checker=security.insecureAPI.gets -analyzer-checker=security.insecureAPI.mktemp -analyzer-checker=security.insecureAPI.mkstemp -analyzer-checker=security.insecureAPI.vfork -analyzer-checker=nullability.NullPassedToNonnull -analyzer-checker=nullability.NullReturnedFromNonnull -analyzer-output plist -w -setup-static-analyzer -analyzer-config-compatibility-mode=true -mrelocation-model pic -pic-level 2 -fhalf-no-semantic-interposition -mframe-pointer=none -fmath-errno -fno-rounding-math -mconstructor-aliases -munwind-tables -target-cpu x86-64 -target-feature +sse -target-feature +sse2 -target-feature +sse3 -tune-cpu generic -fno-split-dwarf-inlining -debugger-tuning=gdb -ffunction-sections -fdata-sections -resource-dir /home/zhh/llvm/build/lib/clang/13.0.0 -D CVAPI_EXPORTS -D _USE_MATH_DEFINES -D __OPENCV_BUILD=1 -D __STDC_CONSTANT_MACROS -D __STDC_FORMAT_MACROS -D __STDC_LIMIT_MACROS -I /home/zhh/projects/opencv-4.5.2/build/3rdparty/ippicv/ippicv_lnx/icv/include -I /home/zhh/projects/opencv-4.5.2/build/3rdparty/ippicv/ippicv_lnx/iw/include -I /home/zhh/projects/opencv-4.5.2/build -I /home/zhh/projects/opencv-4.5.2/modules/imgproc/include -I /home/zhh/projects/opencv-4.5.2/build/modules/imgproc -I /home/zhh/projects/opencv-4.5.2/modules/core/include -D NDEBUG -D NDEBUG -internal-isystem /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9 -internal-isystem /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/x86_64-linux-gnu/c++/9 -internal-isystem /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/x86_64-linux-gnu/c++/9 -internal-isystem /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9/backward -internal-isystem /usr/local/include -internal-isystem /home/zhh/llvm/build/lib/clang/13.0.0/include -internal-externc-isystem /usr/include/x86_64-linux-gnu -internal-externc-isystem /include -internal-externc-isystem /usr/include -O3 -W -Wall -Werror=return-type -Werror=non-virtual-dtor -Werror=address -Werror=sequence-point -Wformat -Werror=format-security -Wmissing-declarations -Wmissing-prototypes -Wstrict-prototypes -Wundef -Winit-self -Wpointer-arith -Wshadow -Wsign-promo -Wuninitialized -Winconsistent-missing-override -Wno-delete-non-virtual-dtor -Wno-unnamed-type-template-args -Wno-comment -Wno-deprecated-enum-enum-conversion -Wno-deprecated-anon-enum-enum-conversion -Wno-long-long -std=c++11 -fdeprecated-macro -fdebug-compilation-dir=/home/zhh/projects/opencv-4.5.2/build/modules/imgproc -ferror-limit 19 -fvisibility hidden -fvisibility-inlines-hidden -pthread -fgnuc-version=4.2.1 -fcxx-exceptions -fexceptions -vectorize-loops -vectorize-slp -analyzer-checker=alpha.unix.Stream -analyzer-config cplusplus.Move:WarnOn=All -analyzer-config suppress-null-return-paths=false -analyzer-config suppress-inlined-defensive-checks=false -analyzer-config stable-report-filename=true -analyzer-config max-nodes=1000000 -stats-file=/home/zhh/projects/opencv-4.5.2/build/csa/eh-cross/cache/csa/home/zhh/projects/opencv-4.5.2/modules/imgproc/src/histogram.cpp.json -analyzer-output=html -analyzer-purge=none -analyzer-config crosscheck-with-z3=true -analyzer-config experimental-enable-naive-ctu-analysis=true -analyzer-config ctu-dir=/home/zhh/projects/opencv-4.5.2/build/csa/eh-cross/cache -faddrsig -o /home/zhh/projects/opencv-4.5.2/build/csa/eh-cross/reports/20220824-111826 -x c++ /home/zhh/projects/opencv-4.5.2/modules/imgproc/src/histogram.cpp
</div>
<div id='tooltiphint' hidden="true">
  <p>Keyboard shortcuts: </p>
  <ul>
    <li>Use 'j/k' keys for keyboard navigation</li>
    <li>Use 'Shift+S' to show/hide relevant lines</li>
    <li>Use '?' to toggle this window</li>
  </ul>
  <a href="#" onclick="toggleHelp(); return false;">Close</a>
</div>
<script type='text/javascript'>
var relevant_lines = {"1": {"717": 1}, "3366": {"63": 1, "66": 1}, "56205": {"67": 1}, "64471": {"288": 1, "289": 1, "290": 1, "291": 1, "1120": 1, "1121": 1, "1135": 1, "1138": 1, "1143": 1, "1149": 1, "1159": 1, "1160": 1, "1161": 1, "1755": 1, "1756": 1, "1757": 1, "1758": 1}, "64474": {"118": 1}};

var filterCounterexample = function (hide) {
  var tables = document.getElementsByClassName("code");
  for (var t=0; t<tables.length; t++) {
    var table = tables[t];
    var file_id = table.getAttribute("data-fileid");
    var lines_in_fid = relevant_lines[file_id];
    if (!lines_in_fid) {
      lines_in_fid = {};
    }
    var lines = table.getElementsByClassName("codeline");
    for (var i=0; i<lines.length; i++) {
        var el = lines[i];
        var lineNo = el.getAttribute("data-linenumber");
        if (!lines_in_fid[lineNo]) {
          if (hide) {
            el.setAttribute("hidden", "");
          } else {
            el.removeAttribute("hidden");
          }
        }
    }
  }
}

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "S") {
    var checked = document.getElementsByName("showCounterexample")[0].checked;
    filterCounterexample(!checked);
    document.getElementsByName("showCounterexample")[0].checked = !checked;
  } else {
    return;
  }
  event.preventDefault();
}, true);

document.addEventListener("DOMContentLoaded", function() {
    document.querySelector('input[name="showCounterexample"]').onchange=
        function (event) {
      filterCounterexample(this.checked);
    };
});
</script>

<form>
    <input type="checkbox" name="showCounterexample" id="showCounterexample" />
    <label for="showCounterexample">
       Show only relevant lines
    </label>
</form>

<script type='text/javascript'>
var digitMatcher = new RegExp("[0-9]+");

var querySelectorAllArray = function(selector) {
  return Array.prototype.slice.call(
    document.querySelectorAll(selector));
}

document.addEventListener("DOMContentLoaded", function() {
    querySelectorAllArray(".PathNav > a").forEach(
        function(currentValue, currentIndex) {
            var hrefValue = currentValue.getAttribute("href");
            currentValue.onclick = function() {
                scrollTo(document.querySelector(hrefValue));
                return false;
            };
        });
});

var findNum = function() {
    var s = document.querySelector(".selected");
    if (!s || s.id == "EndPath") {
        return 0;
    }
    var out = parseInt(digitMatcher.exec(s.id)[0]);
    return out;
};

var scrollTo = function(el) {
    querySelectorAllArray(".selected").forEach(function(s) {
        s.classList.remove("selected");
    });
    el.classList.add("selected");
    window.scrollBy(0, el.getBoundingClientRect().top -
        (window.innerHeight / 2));
}

var move = function(num, up, numItems) {
  if (num == 1 && up || num == numItems - 1 && !up) {
    return 0;
  } else if (num == 0 && up) {
    return numItems - 1;
  } else if (num == 0 && !up) {
    return 1 % numItems;
  }
  return up ? num - 1 : num + 1;
}

var numToId = function(num) {
  if (num == 0) {
    return document.getElementById("EndPath")
  }
  return document.getElementById("Path" + num);
};

var navigateTo = function(up) {
  var numItems = document.querySelectorAll(
      ".line > .msgEvent, .line > .msgControl").length;
  var currentSelected = findNum();
  var newSelected = move(currentSelected, up, numItems);
  var newEl = numToId(newSelected, numItems);

  // Scroll element into center.
  scrollTo(newEl);
};

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "j") {
    navigateTo(/*up=*/false);
  } else if (event.key == "k") {
    navigateTo(/*up=*/true);
  } else {
    return;
  }
  event.preventDefault();
}, true);
</script>
  
<script type='text/javascript'>

var toggleHelp = function() {
    var hint = document.querySelector("#tooltiphint");
    var attributeName = "hidden";
    if (hint.hasAttribute(attributeName)) {
      hint.removeAttribute(attributeName);
    } else {
      hint.setAttribute("hidden", "true");
    }
};
window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "?") {
    toggleHelp();
  } else {
    return;
  }
  event.preventDefault();
});
</script>
<div id=File1>
<h4 class=FileName>/home/zhh/projects/opencv-4.5.2/modules/imgproc/src/histogram.cpp</h4>
<div class=FileNav><a href="#File56205">&#x2192;</a></div></div>
<table class="code" data-fileid="1">
<tr class="codeline" data-linenumber="1"><td class="num" id="LN1">1</td><td class="line"><span class='comment'>/*M///////////////////////////////////////////////////////////////////////////////////////</span></td></tr>
<tr class="codeline" data-linenumber="2"><td class="num" id="LN2">2</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="3"><td class="num" id="LN3">3</td><td class="line"><span class='comment'>//  IMPORTANT: READ BEFORE DOWNLOADING, COPYING, INSTALLING OR USING.</span></td></tr>
<tr class="codeline" data-linenumber="4"><td class="num" id="LN4">4</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="5"><td class="num" id="LN5">5</td><td class="line"><span class='comment'>//  By downloading, copying, installing or using the software you agree to this license.</span></td></tr>
<tr class="codeline" data-linenumber="6"><td class="num" id="LN6">6</td><td class="line"><span class='comment'>//  If you do not agree to this license, do not download, install,</span></td></tr>
<tr class="codeline" data-linenumber="7"><td class="num" id="LN7">7</td><td class="line"><span class='comment'>//  copy or use the software.</span></td></tr>
<tr class="codeline" data-linenumber="8"><td class="num" id="LN8">8</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="9"><td class="num" id="LN9">9</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="10"><td class="num" id="LN10">10</td><td class="line"><span class='comment'>//            Intel License Agreement</span></td></tr>
<tr class="codeline" data-linenumber="11"><td class="num" id="LN11">11</td><td class="line"><span class='comment'>//        For Open Source Computer Vision Library</span></td></tr>
<tr class="codeline" data-linenumber="12"><td class="num" id="LN12">12</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="13"><td class="num" id="LN13">13</td><td class="line"><span class='comment'>// Copyright (C) 2000, Intel Corporation, all rights reserved.</span></td></tr>
<tr class="codeline" data-linenumber="14"><td class="num" id="LN14">14</td><td class="line"><span class='comment'>// Third party copyrights are property of their respective owners.</span></td></tr>
<tr class="codeline" data-linenumber="15"><td class="num" id="LN15">15</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="16"><td class="num" id="LN16">16</td><td class="line"><span class='comment'>// Redistribution and use in source and binary forms, with or without modification,</span></td></tr>
<tr class="codeline" data-linenumber="17"><td class="num" id="LN17">17</td><td class="line"><span class='comment'>// are permitted provided that the following conditions are met:</span></td></tr>
<tr class="codeline" data-linenumber="18"><td class="num" id="LN18">18</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="19"><td class="num" id="LN19">19</td><td class="line"><span class='comment'>//   * Redistribution's of source code must retain the above copyright notice,</span></td></tr>
<tr class="codeline" data-linenumber="20"><td class="num" id="LN20">20</td><td class="line"><span class='comment'>//     this list of conditions and the following disclaimer.</span></td></tr>
<tr class="codeline" data-linenumber="21"><td class="num" id="LN21">21</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="22"><td class="num" id="LN22">22</td><td class="line"><span class='comment'>//   * Redistribution's in binary form must reproduce the above copyright notice,</span></td></tr>
<tr class="codeline" data-linenumber="23"><td class="num" id="LN23">23</td><td class="line"><span class='comment'>//     this list of conditions and the following disclaimer in the documentation</span></td></tr>
<tr class="codeline" data-linenumber="24"><td class="num" id="LN24">24</td><td class="line"><span class='comment'>//     and/or other materials provided with the distribution.</span></td></tr>
<tr class="codeline" data-linenumber="25"><td class="num" id="LN25">25</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="26"><td class="num" id="LN26">26</td><td class="line"><span class='comment'>//   * The name of Intel Corporation may not be used to endorse or promote products</span></td></tr>
<tr class="codeline" data-linenumber="27"><td class="num" id="LN27">27</td><td class="line"><span class='comment'>//     derived from this software without specific prior written permission.</span></td></tr>
<tr class="codeline" data-linenumber="28"><td class="num" id="LN28">28</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="29"><td class="num" id="LN29">29</td><td class="line"><span class='comment'>// This software is provided by the copyright holders and contributors "as is" and</span></td></tr>
<tr class="codeline" data-linenumber="30"><td class="num" id="LN30">30</td><td class="line"><span class='comment'>// any express or implied warranties, including, but not limited to, the implied</span></td></tr>
<tr class="codeline" data-linenumber="31"><td class="num" id="LN31">31</td><td class="line"><span class='comment'>// warranties of merchantability and fitness for a particular purpose are disclaimed.</span></td></tr>
<tr class="codeline" data-linenumber="32"><td class="num" id="LN32">32</td><td class="line"><span class='comment'>// In no event shall the Intel Corporation or contributors be liable for any direct,</span></td></tr>
<tr class="codeline" data-linenumber="33"><td class="num" id="LN33">33</td><td class="line"><span class='comment'>// indirect, incidental, special, exemplary, or consequential damages</span></td></tr>
<tr class="codeline" data-linenumber="34"><td class="num" id="LN34">34</td><td class="line"><span class='comment'>// (including, but not limited to, procurement of substitute goods or services;</span></td></tr>
<tr class="codeline" data-linenumber="35"><td class="num" id="LN35">35</td><td class="line"><span class='comment'>// loss of use, data, or profits; or business interruption) however caused</span></td></tr>
<tr class="codeline" data-linenumber="36"><td class="num" id="LN36">36</td><td class="line"><span class='comment'>// and on any theory of liability, whether in contract, strict liability,</span></td></tr>
<tr class="codeline" data-linenumber="37"><td class="num" id="LN37">37</td><td class="line"><span class='comment'>// or tort (including negligence or otherwise) arising in any way out of</span></td></tr>
<tr class="codeline" data-linenumber="38"><td class="num" id="LN38">38</td><td class="line"><span class='comment'>// the use of this software, even if advised of the possibility of such damage.</span></td></tr>
<tr class="codeline" data-linenumber="39"><td class="num" id="LN39">39</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="40"><td class="num" id="LN40">40</td><td class="line"><span class='comment'>//M*/</span></td></tr>
<tr class="codeline" data-linenumber="41"><td class="num" id="LN41">41</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="42"><td class="num" id="LN42">42</td><td class="line"><span class='directive'>#include "precomp.hpp"</span></td></tr>
<tr class="codeline" data-linenumber="43"><td class="num" id="LN43">43</td><td class="line"><span class='directive'>#include "opencl_kernels_imgproc.hpp"</span></td></tr>
<tr class="codeline" data-linenumber="44"><td class="num" id="LN44">44</td><td class="line"><span class='directive'>#include "opencv2/core/hal/intrin.hpp"</span></td></tr>
<tr class="codeline" data-linenumber="45"><td class="num" id="LN45">45</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="46"><td class="num" id="LN46">46</td><td class="line"><span class='directive'>#include "opencv2/core/openvx/ovx_defs.hpp"</span></td></tr>
<tr class="codeline" data-linenumber="47"><td class="num" id="LN47">47</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="48"><td class="num" id="LN48">48</td><td class="line"><span class='directive'>#include "opencv2/core/utils/tls.hpp"</span></td></tr>
<tr class="codeline" data-linenumber="49"><td class="num" id="LN49">49</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="50"><td class="num" id="LN50">50</td><td class="line"><span class='keyword'>namespace</span> cv</td></tr>
<tr class="codeline" data-linenumber="51"><td class="num" id="LN51">51</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="52"><td class="num" id="LN52">52</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="53"><td class="num" id="LN53">53</td><td class="line"><span class='comment'>////////////////// Helper functions //////////////////////</span></td></tr>
<tr class="codeline" data-linenumber="54"><td class="num" id="LN54">54</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="55"><td class="num" id="LN55">55</td><td class="line"><span class='directive'>#define <span class='macro'>CV_CLAMP_INT(v, vmin, vmax)<span class='macro_popup'>(v &lt; vmin ? vmin : (vmax &lt; v ? vmax : v))</span></span> (v &lt; vmin ? vmin : (vmax &lt; v ? vmax : v))</span></td></tr>
<tr class="codeline" data-linenumber="56"><td class="num" id="LN56">56</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="57"><td class="num" id="LN57">57</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> size_t OUT_OF_RANGE = (size_t)1 &lt;&lt; (<span class='keyword'>sizeof</span>(size_t)*8 - 2);</td></tr>
<tr class="codeline" data-linenumber="58"><td class="num" id="LN58">58</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="59"><td class="num" id="LN59">59</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="60"><td class="num" id="LN60">60</td><td class="line">calcHistLookupTables_8u( <span class='keyword'>const</span> Mat&amp; hist, <span class='keyword'>const</span> SparseMat&amp; shist,</td></tr>
<tr class="codeline" data-linenumber="61"><td class="num" id="LN61">61</td><td class="line">                         <span class='keyword'>int</span> dims, <span class='keyword'>const</span> <span class='keyword'>float</span>** ranges, <span class='keyword'>const</span> <span class='keyword'>double</span>* uniranges,</td></tr>
<tr class="codeline" data-linenumber="62"><td class="num" id="LN62">62</td><td class="line">                         <span class='keyword'>bool</span> uniform, <span class='keyword'>bool</span> issparse, std::vector&lt;size_t&gt;&amp; _tab )</td></tr>
<tr class="codeline" data-linenumber="63"><td class="num" id="LN63">63</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="64"><td class="num" id="LN64">64</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>int</span> low = 0, high = 256;</td></tr>
<tr class="codeline" data-linenumber="65"><td class="num" id="LN65">65</td><td class="line">    <span class='keyword'>int</span> i, j;</td></tr>
<tr class="codeline" data-linenumber="66"><td class="num" id="LN66">66</td><td class="line">    _tab.resize((high-low)*dims);</td></tr>
<tr class="codeline" data-linenumber="67"><td class="num" id="LN67">67</td><td class="line">    size_t* tab = &amp;_tab[0];</td></tr>
<tr class="codeline" data-linenumber="68"><td class="num" id="LN68">68</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="69"><td class="num" id="LN69">69</td><td class="line">    <span class='keyword'>if</span>( uniform )</td></tr>
<tr class="codeline" data-linenumber="70"><td class="num" id="LN70">70</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="71"><td class="num" id="LN71">71</td><td class="line">        <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="72"><td class="num" id="LN72">72</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="73"><td class="num" id="LN73">73</td><td class="line">            <span class='keyword'>double</span> a = uniranges[i*2];</td></tr>
<tr class="codeline" data-linenumber="74"><td class="num" id="LN74">74</td><td class="line">            <span class='keyword'>double</span> b = uniranges[i*2+1];</td></tr>
<tr class="codeline" data-linenumber="75"><td class="num" id="LN75">75</td><td class="line">            <span class='keyword'>int</span> sz = !issparse ? hist.size[i] : shist.size(i);</td></tr>
<tr class="codeline" data-linenumber="76"><td class="num" id="LN76">76</td><td class="line">            size_t step = !issparse ? hist.step[i] : 1;</td></tr>
<tr class="codeline" data-linenumber="77"><td class="num" id="LN77">77</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="78"><td class="num" id="LN78">78</td><td class="line">            <span class='keyword'>double</span> v_lo = ranges ? ranges[i][0] : 0;</td></tr>
<tr class="codeline" data-linenumber="79"><td class="num" id="LN79">79</td><td class="line">            <span class='keyword'>double</span> v_hi = ranges ? ranges[i][1] : 256;</td></tr>
<tr class="codeline" data-linenumber="80"><td class="num" id="LN80">80</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="81"><td class="num" id="LN81">81</td><td class="line">            <span class='keyword'>for</span>( j = low; j &lt; high; j++ )</td></tr>
<tr class="codeline" data-linenumber="82"><td class="num" id="LN82">82</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="83"><td class="num" id="LN83">83</td><td class="line">                <span class='keyword'>int</span> idx = cvFloor(j*a + b);</td></tr>
<tr class="codeline" data-linenumber="84"><td class="num" id="LN84">84</td><td class="line">                size_t written_idx = OUT_OF_RANGE;</td></tr>
<tr class="codeline" data-linenumber="85"><td class="num" id="LN85">85</td><td class="line">                <span class='keyword'>if</span> (j &gt;= v_lo &amp;&amp; j &lt; v_hi)</td></tr>
<tr class="codeline" data-linenumber="86"><td class="num" id="LN86">86</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="87"><td class="num" id="LN87">87</td><td class="line">                    idx = <span class='macro'>CV_CLAMP_INT(idx, 0, sz - 1)<span class='macro_popup'>(idx &lt; 0 ? 0 : (sz - 1 &lt; idx ? sz - 1 : idx))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="88"><td class="num" id="LN88">88</td><td class="line">                    written_idx = idx*step;</td></tr>
<tr class="codeline" data-linenumber="89"><td class="num" id="LN89">89</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="90"><td class="num" id="LN90">90</td><td class="line">                tab[i*(high - low) + j - low] = written_idx;</td></tr>
<tr class="codeline" data-linenumber="91"><td class="num" id="LN91">91</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="92"><td class="num" id="LN92">92</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="93"><td class="num" id="LN93">93</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="94"><td class="num" id="LN94">94</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (ranges)</td></tr>
<tr class="codeline" data-linenumber="95"><td class="num" id="LN95">95</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="96"><td class="num" id="LN96">96</td><td class="line">        <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="97"><td class="num" id="LN97">97</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="98"><td class="num" id="LN98">98</td><td class="line">            <span class='keyword'>int</span> limit = std::min(cvCeil(ranges[i][0]), high);</td></tr>
<tr class="codeline" data-linenumber="99"><td class="num" id="LN99">99</td><td class="line">            <span class='keyword'>int</span> idx = -1, sz = !issparse ? hist.size[i] : shist.size(i);</td></tr>
<tr class="codeline" data-linenumber="100"><td class="num" id="LN100">100</td><td class="line">            size_t written_idx = OUT_OF_RANGE;</td></tr>
<tr class="codeline" data-linenumber="101"><td class="num" id="LN101">101</td><td class="line">            size_t step = !issparse ? hist.step[i] : 1;</td></tr>
<tr class="codeline" data-linenumber="102"><td class="num" id="LN102">102</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="103"><td class="num" id="LN103">103</td><td class="line">            <span class='keyword'>for</span>(j = low;;)</td></tr>
<tr class="codeline" data-linenumber="104"><td class="num" id="LN104">104</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="105"><td class="num" id="LN105">105</td><td class="line">                <span class='keyword'>for</span>( ; j &lt; limit; j++ )</td></tr>
<tr class="codeline" data-linenumber="106"><td class="num" id="LN106">106</td><td class="line">                    tab[i*(high - low) + j - low] = written_idx;</td></tr>
<tr class="codeline" data-linenumber="107"><td class="num" id="LN107">107</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="108"><td class="num" id="LN108">108</td><td class="line">                <span class='keyword'>if</span>( (<span class='keyword'>unsigned</span>)(++idx) &lt; (<span class='keyword'>unsigned</span>)sz )</td></tr>
<tr class="codeline" data-linenumber="109"><td class="num" id="LN109">109</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="110"><td class="num" id="LN110">110</td><td class="line">                    limit = std::min(cvCeil(ranges[i][idx+1]), high);</td></tr>
<tr class="codeline" data-linenumber="111"><td class="num" id="LN111">111</td><td class="line">                    written_idx = idx*step;</td></tr>
<tr class="codeline" data-linenumber="112"><td class="num" id="LN112">112</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="113"><td class="num" id="LN113">113</td><td class="line">                <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="114"><td class="num" id="LN114">114</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="115"><td class="num" id="LN115">115</td><td class="line">                    <span class='keyword'>for</span>( ; j &lt; high; j++ )</td></tr>
<tr class="codeline" data-linenumber="116"><td class="num" id="LN116">116</td><td class="line">                        tab[i*(high - low) + j - low] = OUT_OF_RANGE;</td></tr>
<tr class="codeline" data-linenumber="117"><td class="num" id="LN117">117</td><td class="line">                    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="118"><td class="num" id="LN118">118</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="119"><td class="num" id="LN119">119</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="120"><td class="num" id="LN120">120</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="121"><td class="num" id="LN121">121</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="122"><td class="num" id="LN122">122</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="123"><td class="num" id="LN123">123</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="124"><td class="num" id="LN124">124</td><td class="line">        <span class='macro'>CV_Error(Error::StsBadArg, <span class='string_literal'>"Either ranges, either uniform ranges should be provided"</span>)<span class='macro_popup'>do { (void)(Error::StsBadArg); (void)("Either ranges, either uniform ranges should be provided"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="125"><td class="num" id="LN125">125</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="126"><td class="num" id="LN126">126</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="127"><td class="num" id="LN127">127</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="128"><td class="num" id="LN128">128</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="129"><td class="num" id="LN129">129</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> histPrepareImages( <span class='keyword'>const</span> Mat* images, <span class='keyword'>int</span> nimages, <span class='keyword'>const</span> <span class='keyword'>int</span>* channels,</td></tr>
<tr class="codeline" data-linenumber="130"><td class="num" id="LN130">130</td><td class="line">                               <span class='keyword'>const</span> Mat&amp; mask, <span class='keyword'>int</span> dims, <span class='keyword'>const</span> <span class='keyword'>int</span>* histSize,</td></tr>
<tr class="codeline" data-linenumber="131"><td class="num" id="LN131">131</td><td class="line">                               <span class='keyword'>const</span> <span class='keyword'>float</span>** ranges, <span class='keyword'>bool</span> uniform,</td></tr>
<tr class="codeline" data-linenumber="132"><td class="num" id="LN132">132</td><td class="line">                               std::vector&lt;uchar*&gt;&amp; ptrs, std::vector&lt;<span class='keyword'>int</span>&gt;&amp; deltas,</td></tr>
<tr class="codeline" data-linenumber="133"><td class="num" id="LN133">133</td><td class="line">                               Size&amp; imsize, std::vector&lt;<span class='keyword'>double</span>&gt;&amp; uniranges )</td></tr>
<tr class="codeline" data-linenumber="134"><td class="num" id="LN134">134</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="135"><td class="num" id="LN135">135</td><td class="line">    <span class='keyword'>int</span> i, j, c;</td></tr>
<tr class="codeline" data-linenumber="136"><td class="num" id="LN136">136</td><td class="line">    <span class='macro'>CV_Assert( channels != 0 || nimages == dims )<span class='macro_popup'>do { if (!(channels != 0 || nimages == dims)) abort(); } while<br> (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="137"><td class="num" id="LN137">137</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="138"><td class="num" id="LN138">138</td><td class="line">    imsize = images[0].size();</td></tr>
<tr class="codeline" data-linenumber="139"><td class="num" id="LN139">139</td><td class="line">    <span class='keyword'>int</span> depth = images[0].depth(), esz1 = (<span class='keyword'>int</span>)images[0].elemSize1();</td></tr>
<tr class="codeline" data-linenumber="140"><td class="num" id="LN140">140</td><td class="line">    <span class='keyword'>bool</span> isContinuous = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="141"><td class="num" id="LN141">141</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="142"><td class="num" id="LN142">142</td><td class="line">    ptrs.resize(dims + 1);</td></tr>
<tr class="codeline" data-linenumber="143"><td class="num" id="LN143">143</td><td class="line">    deltas.resize((dims + 1)*2);</td></tr>
<tr class="codeline" data-linenumber="144"><td class="num" id="LN144">144</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="145"><td class="num" id="LN145">145</td><td class="line">    <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="146"><td class="num" id="LN146">146</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="147"><td class="num" id="LN147">147</td><td class="line">        <span class='keyword'>if</span>(!channels)</td></tr>
<tr class="codeline" data-linenumber="148"><td class="num" id="LN148">148</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="149"><td class="num" id="LN149">149</td><td class="line">            j = i;</td></tr>
<tr class="codeline" data-linenumber="150"><td class="num" id="LN150">150</td><td class="line">            c = 0;</td></tr>
<tr class="codeline" data-linenumber="151"><td class="num" id="LN151">151</td><td class="line">            <span class='macro'>CV_Assert( images[j].channels() == 1 )<span class='macro_popup'>do { if (!(images[j].channels() == 1)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="152"><td class="num" id="LN152">152</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="153"><td class="num" id="LN153">153</td><td class="line">        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="154"><td class="num" id="LN154">154</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="155"><td class="num" id="LN155">155</td><td class="line">            c = channels[i];</td></tr>
<tr class="codeline" data-linenumber="156"><td class="num" id="LN156">156</td><td class="line">            <span class='macro'>CV_Assert( c &gt;= 0 )<span class='macro_popup'>do { if (!(c &gt;= 0)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="157"><td class="num" id="LN157">157</td><td class="line">            <span class='keyword'>for</span>( j = 0; j &lt; nimages; c -= images[j].channels(), j++ )</td></tr>
<tr class="codeline" data-linenumber="158"><td class="num" id="LN158">158</td><td class="line">                <span class='keyword'>if</span>( c &lt; images[j].channels() )</td></tr>
<tr class="codeline" data-linenumber="159"><td class="num" id="LN159">159</td><td class="line">                    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="160"><td class="num" id="LN160">160</td><td class="line">            <span class='macro'>CV_Assert( j &lt; nimages )<span class='macro_popup'>do { if (!(j &lt; nimages)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="161"><td class="num" id="LN161">161</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="162"><td class="num" id="LN162">162</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="163"><td class="num" id="LN163">163</td><td class="line">        <span class='macro'>CV_Assert( images[j].size() == imsize &amp;&amp; images[j].depth() == depth )<span class='macro_popup'>do { if (!(images[j].size() == imsize &amp;&amp; images[j].depth<br>() == depth)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="164"><td class="num" id="LN164">164</td><td class="line">        <span class='keyword'>if</span>( !images[j].isContinuous() )</td></tr>
<tr class="codeline" data-linenumber="165"><td class="num" id="LN165">165</td><td class="line">            isContinuous = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="166"><td class="num" id="LN166">166</td><td class="line">        ptrs[i] = images[j].data + c*esz1;</td></tr>
<tr class="codeline" data-linenumber="167"><td class="num" id="LN167">167</td><td class="line">        deltas[i*2] = images[j].channels();</td></tr>
<tr class="codeline" data-linenumber="168"><td class="num" id="LN168">168</td><td class="line">        deltas[i*2+1] = (<span class='keyword'>int</span>)(images[j].step/esz1 - imsize.width*deltas[i*2]);</td></tr>
<tr class="codeline" data-linenumber="169"><td class="num" id="LN169">169</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="170"><td class="num" id="LN170">170</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="171"><td class="num" id="LN171">171</td><td class="line">    <span class='keyword'>if</span>( !mask.empty() )</td></tr>
<tr class="codeline" data-linenumber="172"><td class="num" id="LN172">172</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="173"><td class="num" id="LN173">173</td><td class="line">        <span class='macro'>CV_Assert( mask.size() == imsize &amp;&amp; mask.channels() == 1 )<span class='macro_popup'>do { if (!(mask.size() == imsize &amp;&amp; mask.channels() ==<br> 1)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="174"><td class="num" id="LN174">174</td><td class="line">        isContinuous = isContinuous &amp;&amp; mask.isContinuous();</td></tr>
<tr class="codeline" data-linenumber="175"><td class="num" id="LN175">175</td><td class="line">        ptrs[dims] = mask.data;</td></tr>
<tr class="codeline" data-linenumber="176"><td class="num" id="LN176">176</td><td class="line">        deltas[dims*2] = 1;</td></tr>
<tr class="codeline" data-linenumber="177"><td class="num" id="LN177">177</td><td class="line">        deltas[dims*2 + 1] = (<span class='keyword'>int</span>)(mask.step/mask.elemSize1());</td></tr>
<tr class="codeline" data-linenumber="178"><td class="num" id="LN178">178</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="179"><td class="num" id="LN179">179</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="180"><td class="num" id="LN180">180</td><td class="line">    <span class='keyword'>if</span>( isContinuous )</td></tr>
<tr class="codeline" data-linenumber="181"><td class="num" id="LN181">181</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="182"><td class="num" id="LN182">182</td><td class="line">        imsize.width *= imsize.height;</td></tr>
<tr class="codeline" data-linenumber="183"><td class="num" id="LN183">183</td><td class="line">        imsize.height = 1;</td></tr>
<tr class="codeline" data-linenumber="184"><td class="num" id="LN184">184</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="185"><td class="num" id="LN185">185</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="186"><td class="num" id="LN186">186</td><td class="line">    <span class='keyword'>if</span>( !ranges ) <span class='comment'>// implicit uniform ranges for 8U</span></td></tr>
<tr class="codeline" data-linenumber="187"><td class="num" id="LN187">187</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="188"><td class="num" id="LN188">188</td><td class="line">        <span class='macro'>CV_Assert( depth == CV_8U )<span class='macro_popup'>do { if (!(depth == 0)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="189"><td class="num" id="LN189">189</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="190"><td class="num" id="LN190">190</td><td class="line">        uniranges.resize( dims*2 );</td></tr>
<tr class="codeline" data-linenumber="191"><td class="num" id="LN191">191</td><td class="line">        <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="192"><td class="num" id="LN192">192</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="193"><td class="num" id="LN193">193</td><td class="line">            uniranges[i*2] = histSize[i]/256.;</td></tr>
<tr class="codeline" data-linenumber="194"><td class="num" id="LN194">194</td><td class="line">            uniranges[i*2+1] = 0;</td></tr>
<tr class="codeline" data-linenumber="195"><td class="num" id="LN195">195</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="196"><td class="num" id="LN196">196</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="197"><td class="num" id="LN197">197</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span>( uniform )</td></tr>
<tr class="codeline" data-linenumber="198"><td class="num" id="LN198">198</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="199"><td class="num" id="LN199">199</td><td class="line">        uniranges.resize( dims*2 );</td></tr>
<tr class="codeline" data-linenumber="200"><td class="num" id="LN200">200</td><td class="line">        <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="201"><td class="num" id="LN201">201</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="202"><td class="num" id="LN202">202</td><td class="line">            <span class='macro'>CV_Assert( ranges[i] &amp;&amp; ranges[i][0] &lt; ranges[i][1] )<span class='macro_popup'>do { if (!(ranges[i] &amp;&amp; ranges[i][0] &lt; ranges[i][1<br>])) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="203"><td class="num" id="LN203">203</td><td class="line">            <span class='keyword'>double</span> low = ranges[i][0], high = ranges[i][1];</td></tr>
<tr class="codeline" data-linenumber="204"><td class="num" id="LN204">204</td><td class="line">            <span class='keyword'>double</span> t = histSize[i]/(high - low);</td></tr>
<tr class="codeline" data-linenumber="205"><td class="num" id="LN205">205</td><td class="line">            uniranges[i*2] = t;</td></tr>
<tr class="codeline" data-linenumber="206"><td class="num" id="LN206">206</td><td class="line">            uniranges[i*2+1] = -t*low;</td></tr>
<tr class="codeline" data-linenumber="207"><td class="num" id="LN207">207</td><td class="line"><span class='directive'>#if 0  // This should be true by math, but it is not accurate numerically</span></td></tr>
<tr class="codeline" data-linenumber="208"><td class="num" id="LN208">208</td><td class="line">            <span class='macro'>CV_Assert(cvFloor(low * uniranges[i*2] + uniranges[i*2+1]) == 0)<span class='macro_popup'>do { if (!(cvFloor(low * uniranges[i*2] + uniranges[i*2+1]) ==<br> 0)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="209"><td class="num" id="LN209">209</td><td class="line">            <span class='macro'>CV_Assert((high * uniranges[i*2] + uniranges[i*2+1]) &lt; histSize[i])<span class='macro_popup'>do { if (!((high * uniranges[i*2] + uniranges[i*2+1]) &lt; histSize<br>[i])) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="210"><td class="num" id="LN210">210</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="211"><td class="num" id="LN211">211</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="212"><td class="num" id="LN212">212</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="213"><td class="num" id="LN213">213</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="214"><td class="num" id="LN214">214</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="215"><td class="num" id="LN215">215</td><td class="line">        <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="216"><td class="num" id="LN216">216</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="217"><td class="num" id="LN217">217</td><td class="line">            size_t n = histSize[i];</td></tr>
<tr class="codeline" data-linenumber="218"><td class="num" id="LN218">218</td><td class="line">            <span class='keyword'>for</span>(size_t k = 0; k &lt; n; k++ )</td></tr>
<tr class="codeline" data-linenumber="219"><td class="num" id="LN219">219</td><td class="line">                <span class='macro'>CV_Assert( ranges[i][k] &lt; ranges[i][k+1] )<span class='macro_popup'>do { if (!(ranges[i][k] &lt; ranges[i][k+1])) abort(); } while<br> (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="220"><td class="num" id="LN220">220</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="221"><td class="num" id="LN221">221</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="222"><td class="num" id="LN222">222</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="223"><td class="num" id="LN223">223</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="224"><td class="num" id="LN224">224</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="225"><td class="num" id="LN225">225</td><td class="line"><span class='comment'>////////////////////////////////// C A L C U L A T E    H I S T O G R A M ////////////////////////////////////</span></td></tr>
<tr class="codeline" data-linenumber="226"><td class="num" id="LN226">226</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="227"><td class="num" id="LN227">227</td><td class="line"><span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> T&gt; <span class='keyword'>static</span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="228"><td class="num" id="LN228">228</td><td class="line">calcHist_( std::vector&lt;uchar*&gt;&amp; _ptrs, <span class='keyword'>const</span> std::vector&lt;<span class='keyword'>int</span>&gt;&amp; _deltas,</td></tr>
<tr class="codeline" data-linenumber="229"><td class="num" id="LN229">229</td><td class="line">           Size imsize, Mat&amp; hist, <span class='keyword'>int</span> dims, <span class='keyword'>const</span> <span class='keyword'>float</span>** _ranges,</td></tr>
<tr class="codeline" data-linenumber="230"><td class="num" id="LN230">230</td><td class="line">           <span class='keyword'>const</span> <span class='keyword'>double</span>* _uniranges, <span class='keyword'>bool</span> uniform )</td></tr>
<tr class="codeline" data-linenumber="231"><td class="num" id="LN231">231</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="232"><td class="num" id="LN232">232</td><td class="line">    T** ptrs = (T**)&amp;_ptrs[0];</td></tr>
<tr class="codeline" data-linenumber="233"><td class="num" id="LN233">233</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>int</span>* deltas = &amp;_deltas[0];</td></tr>
<tr class="codeline" data-linenumber="234"><td class="num" id="LN234">234</td><td class="line">    uchar* H = hist.ptr();</td></tr>
<tr class="codeline" data-linenumber="235"><td class="num" id="LN235">235</td><td class="line">    <span class='keyword'>int</span> i, x;</td></tr>
<tr class="codeline" data-linenumber="236"><td class="num" id="LN236">236</td><td class="line">    <span class='keyword'>const</span> uchar* mask = _ptrs[dims];</td></tr>
<tr class="codeline" data-linenumber="237"><td class="num" id="LN237">237</td><td class="line">    <span class='keyword'>int</span> mstep = _deltas[dims*2 + 1];</td></tr>
<tr class="codeline" data-linenumber="238"><td class="num" id="LN238">238</td><td class="line">    <span class='keyword'>int</span> size[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>];</td></tr>
<tr class="codeline" data-linenumber="239"><td class="num" id="LN239">239</td><td class="line">    size_t hstep[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>];</td></tr>
<tr class="codeline" data-linenumber="240"><td class="num" id="LN240">240</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="241"><td class="num" id="LN241">241</td><td class="line">    <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="242"><td class="num" id="LN242">242</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="243"><td class="num" id="LN243">243</td><td class="line">        size[i] = hist.size[i];</td></tr>
<tr class="codeline" data-linenumber="244"><td class="num" id="LN244">244</td><td class="line">        hstep[i] = hist.step[i];</td></tr>
<tr class="codeline" data-linenumber="245"><td class="num" id="LN245">245</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="246"><td class="num" id="LN246">246</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="247"><td class="num" id="LN247">247</td><td class="line">    <span class='keyword'>if</span>( uniform )</td></tr>
<tr class="codeline" data-linenumber="248"><td class="num" id="LN248">248</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="249"><td class="num" id="LN249">249</td><td class="line">        <span class='keyword'>const</span> <span class='keyword'>double</span>* uniranges = &amp;_uniranges[0];</td></tr>
<tr class="codeline" data-linenumber="250"><td class="num" id="LN250">250</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="251"><td class="num" id="LN251">251</td><td class="line">        <span class='keyword'>if</span>( dims == 1 )</td></tr>
<tr class="codeline" data-linenumber="252"><td class="num" id="LN252">252</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="253"><td class="num" id="LN253">253</td><td class="line">            <span class='keyword'>double</span> a = uniranges[0], b = uniranges[1];</td></tr>
<tr class="codeline" data-linenumber="254"><td class="num" id="LN254">254</td><td class="line">            <span class='keyword'>int</span> sz = size[0], d0 = deltas[0], step0 = deltas[1];</td></tr>
<tr class="codeline" data-linenumber="255"><td class="num" id="LN255">255</td><td class="line">            <span class='keyword'>const</span> T* p0 = (<span class='keyword'>const</span> T*)ptrs[0];</td></tr>
<tr class="codeline" data-linenumber="256"><td class="num" id="LN256">256</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="257"><td class="num" id="LN257">257</td><td class="line">            <span class='keyword'>double</span> v0_lo = _ranges[0][0];</td></tr>
<tr class="codeline" data-linenumber="258"><td class="num" id="LN258">258</td><td class="line">            <span class='keyword'>double</span> v0_hi = _ranges[0][1];</td></tr>
<tr class="codeline" data-linenumber="259"><td class="num" id="LN259">259</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="260"><td class="num" id="LN260">260</td><td class="line">            <span class='keyword'>for</span>( ; imsize.height--; p0 += step0, mask += mstep )</td></tr>
<tr class="codeline" data-linenumber="261"><td class="num" id="LN261">261</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="262"><td class="num" id="LN262">262</td><td class="line">                <span class='keyword'>if</span>( !mask )</td></tr>
<tr class="codeline" data-linenumber="263"><td class="num" id="LN263">263</td><td class="line">                    <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++, p0 += d0 )</td></tr>
<tr class="codeline" data-linenumber="264"><td class="num" id="LN264">264</td><td class="line">                    {</td></tr>
<tr class="codeline" data-linenumber="265"><td class="num" id="LN265">265</td><td class="line">                        <span class='keyword'>double</span> v0 = (<span class='keyword'>double</span>)*p0;</td></tr>
<tr class="codeline" data-linenumber="266"><td class="num" id="LN266">266</td><td class="line">                        <span class='keyword'>int</span> idx = cvFloor(v0*a + b);</td></tr>
<tr class="codeline" data-linenumber="267"><td class="num" id="LN267">267</td><td class="line">                        <span class='keyword'>if</span> (v0 &lt; v0_lo || v0 &gt;= v0_hi)</td></tr>
<tr class="codeline" data-linenumber="268"><td class="num" id="LN268">268</td><td class="line">                            <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="269"><td class="num" id="LN269">269</td><td class="line">                        idx = <span class='macro'>CV_CLAMP_INT(idx, 0, sz - 1)<span class='macro_popup'>(idx &lt; 0 ? 0 : (sz - 1 &lt; idx ? sz - 1 : idx))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="270"><td class="num" id="LN270">270</td><td class="line">                        <span class='macro'>CV_DbgAssert((<span class='keyword'>unsigned</span>)idx &lt; (<span class='keyword'>unsigned</span>)sz)<span class='macro_popup'>do { if (!((unsigned)idx &lt; (unsigned)sz)) abort(); } while<br> (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="271"><td class="num" id="LN271">271</td><td class="line">                        ((<span class='keyword'>int</span>*)H)[idx]++;</td></tr>
<tr class="codeline" data-linenumber="272"><td class="num" id="LN272">272</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="273"><td class="num" id="LN273">273</td><td class="line">                <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="274"><td class="num" id="LN274">274</td><td class="line">                    <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++, p0 += d0 )</td></tr>
<tr class="codeline" data-linenumber="275"><td class="num" id="LN275">275</td><td class="line">                        <span class='keyword'>if</span>( mask[x] )</td></tr>
<tr class="codeline" data-linenumber="276"><td class="num" id="LN276">276</td><td class="line">                        {</td></tr>
<tr class="codeline" data-linenumber="277"><td class="num" id="LN277">277</td><td class="line">                            <span class='keyword'>double</span> v0 = (<span class='keyword'>double</span>)*p0;</td></tr>
<tr class="codeline" data-linenumber="278"><td class="num" id="LN278">278</td><td class="line">                            <span class='keyword'>int</span> idx = cvFloor(v0*a + b);</td></tr>
<tr class="codeline" data-linenumber="279"><td class="num" id="LN279">279</td><td class="line">                            <span class='keyword'>if</span> (v0 &lt; v0_lo || v0 &gt;= v0_hi)</td></tr>
<tr class="codeline" data-linenumber="280"><td class="num" id="LN280">280</td><td class="line">                                <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="281"><td class="num" id="LN281">281</td><td class="line">                            idx = <span class='macro'>CV_CLAMP_INT(idx, 0, sz - 1)<span class='macro_popup'>(idx &lt; 0 ? 0 : (sz - 1 &lt; idx ? sz - 1 : idx))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="282"><td class="num" id="LN282">282</td><td class="line">                            <span class='macro'>CV_DbgAssert((<span class='keyword'>unsigned</span>)idx &lt; (<span class='keyword'>unsigned</span>)sz)<span class='macro_popup'>do { if (!((unsigned)idx &lt; (unsigned)sz)) abort(); } while<br> (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="283"><td class="num" id="LN283">283</td><td class="line">                            ((<span class='keyword'>int</span>*)H)[idx]++;</td></tr>
<tr class="codeline" data-linenumber="284"><td class="num" id="LN284">284</td><td class="line">                        }</td></tr>
<tr class="codeline" data-linenumber="285"><td class="num" id="LN285">285</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="286"><td class="num" id="LN286">286</td><td class="line">            <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="287"><td class="num" id="LN287">287</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="288"><td class="num" id="LN288">288</td><td class="line">        <span class='keyword'>else</span> <span class='keyword'>if</span>( dims == 2 )</td></tr>
<tr class="codeline" data-linenumber="289"><td class="num" id="LN289">289</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="290"><td class="num" id="LN290">290</td><td class="line">            <span class='keyword'>double</span> a0 = uniranges[0], b0 = uniranges[1], a1 = uniranges[2], b1 = uniranges[3];</td></tr>
<tr class="codeline" data-linenumber="291"><td class="num" id="LN291">291</td><td class="line">            <span class='keyword'>int</span> sz0 = size[0], sz1 = size[1];</td></tr>
<tr class="codeline" data-linenumber="292"><td class="num" id="LN292">292</td><td class="line">            <span class='keyword'>int</span> d0 = deltas[0], step0 = deltas[1],</td></tr>
<tr class="codeline" data-linenumber="293"><td class="num" id="LN293">293</td><td class="line">                d1 = deltas[2], step1 = deltas[3];</td></tr>
<tr class="codeline" data-linenumber="294"><td class="num" id="LN294">294</td><td class="line">            size_t hstep0 = hstep[0];</td></tr>
<tr class="codeline" data-linenumber="295"><td class="num" id="LN295">295</td><td class="line">            <span class='keyword'>const</span> T* p0 = (<span class='keyword'>const</span> T*)ptrs[0];</td></tr>
<tr class="codeline" data-linenumber="296"><td class="num" id="LN296">296</td><td class="line">            <span class='keyword'>const</span> T* p1 = (<span class='keyword'>const</span> T*)ptrs[1];</td></tr>
<tr class="codeline" data-linenumber="297"><td class="num" id="LN297">297</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="298"><td class="num" id="LN298">298</td><td class="line">            <span class='keyword'>double</span> v0_lo = _ranges[0][0];</td></tr>
<tr class="codeline" data-linenumber="299"><td class="num" id="LN299">299</td><td class="line">            <span class='keyword'>double</span> v0_hi = _ranges[0][1];</td></tr>
<tr class="codeline" data-linenumber="300"><td class="num" id="LN300">300</td><td class="line">            <span class='keyword'>double</span> v1_lo = _ranges[1][0];</td></tr>
<tr class="codeline" data-linenumber="301"><td class="num" id="LN301">301</td><td class="line">            <span class='keyword'>double</span> v1_hi = _ranges[1][1];</td></tr>
<tr class="codeline" data-linenumber="302"><td class="num" id="LN302">302</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="303"><td class="num" id="LN303">303</td><td class="line">            <span class='keyword'>for</span>( ; imsize.height--; p0 += step0, p1 += step1, mask += mstep )</td></tr>
<tr class="codeline" data-linenumber="304"><td class="num" id="LN304">304</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="305"><td class="num" id="LN305">305</td><td class="line">                <span class='keyword'>if</span>( !mask )</td></tr>
<tr class="codeline" data-linenumber="306"><td class="num" id="LN306">306</td><td class="line">                    <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++, p0 += d0, p1 += d1 )</td></tr>
<tr class="codeline" data-linenumber="307"><td class="num" id="LN307">307</td><td class="line">                    {</td></tr>
<tr class="codeline" data-linenumber="308"><td class="num" id="LN308">308</td><td class="line">                        <span class='keyword'>double</span> v0 = (<span class='keyword'>double</span>)*p0;</td></tr>
<tr class="codeline" data-linenumber="309"><td class="num" id="LN309">309</td><td class="line">                        <span class='keyword'>double</span> v1 = (<span class='keyword'>double</span>)*p1;</td></tr>
<tr class="codeline" data-linenumber="310"><td class="num" id="LN310">310</td><td class="line">                        <span class='keyword'>int</span> idx0 = cvFloor(v0*a0 + b0);</td></tr>
<tr class="codeline" data-linenumber="311"><td class="num" id="LN311">311</td><td class="line">                        <span class='keyword'>int</span> idx1 = cvFloor(v1*a1 + b1);</td></tr>
<tr class="codeline" data-linenumber="312"><td class="num" id="LN312">312</td><td class="line">                        <span class='keyword'>if</span> (v0 &lt; v0_lo || v0 &gt;= v0_hi)</td></tr>
<tr class="codeline" data-linenumber="313"><td class="num" id="LN313">313</td><td class="line">                            <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="314"><td class="num" id="LN314">314</td><td class="line">                        <span class='keyword'>if</span> (v1 &lt; v1_lo || v1 &gt;= v1_hi)</td></tr>
<tr class="codeline" data-linenumber="315"><td class="num" id="LN315">315</td><td class="line">                            <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="316"><td class="num" id="LN316">316</td><td class="line">                        idx0 = <span class='macro'>CV_CLAMP_INT(idx0, 0, sz0 - 1)<span class='macro_popup'>(idx0 &lt; 0 ? 0 : (sz0 - 1 &lt; idx0 ? sz0 - 1 : idx0))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="317"><td class="num" id="LN317">317</td><td class="line">                        idx1 = <span class='macro'>CV_CLAMP_INT(idx1, 0, sz1 - 1)<span class='macro_popup'>(idx1 &lt; 0 ? 0 : (sz1 - 1 &lt; idx1 ? sz1 - 1 : idx1))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="318"><td class="num" id="LN318">318</td><td class="line">                        <span class='macro'>CV_DbgAssert((<span class='keyword'>unsigned</span>)idx0 &lt; (<span class='keyword'>unsigned</span>)sz0 &amp;&amp; (<span class='keyword'>unsigned</span>)idx1 &lt; (<span class='keyword'>unsigned</span>)sz1)<span class='macro_popup'>do { if (!((unsigned)idx0 &lt; (unsigned)sz0 &amp;&amp; (unsigned<br>)idx1 &lt; (unsigned)sz1)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="319"><td class="num" id="LN319">319</td><td class="line">                        ((<span class='keyword'>int</span>*)(H + hstep0*idx0))[idx1]++;</td></tr>
<tr class="codeline" data-linenumber="320"><td class="num" id="LN320">320</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="321"><td class="num" id="LN321">321</td><td class="line">                <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="322"><td class="num" id="LN322">322</td><td class="line">                    <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++, p0 += d0, p1 += d1 )</td></tr>
<tr class="codeline" data-linenumber="323"><td class="num" id="LN323">323</td><td class="line">                        <span class='keyword'>if</span>( mask[x] )</td></tr>
<tr class="codeline" data-linenumber="324"><td class="num" id="LN324">324</td><td class="line">                        {</td></tr>
<tr class="codeline" data-linenumber="325"><td class="num" id="LN325">325</td><td class="line">                            <span class='keyword'>double</span> v0 = (<span class='keyword'>double</span>)*p0;</td></tr>
<tr class="codeline" data-linenumber="326"><td class="num" id="LN326">326</td><td class="line">                            <span class='keyword'>double</span> v1 = (<span class='keyword'>double</span>)*p1;</td></tr>
<tr class="codeline" data-linenumber="327"><td class="num" id="LN327">327</td><td class="line">                            <span class='keyword'>int</span> idx0 = cvFloor(v0*a0 + b0);</td></tr>
<tr class="codeline" data-linenumber="328"><td class="num" id="LN328">328</td><td class="line">                            <span class='keyword'>int</span> idx1 = cvFloor(v1*a1 + b1);</td></tr>
<tr class="codeline" data-linenumber="329"><td class="num" id="LN329">329</td><td class="line">                            <span class='keyword'>if</span> (v0 &lt; v0_lo || v0 &gt;= v0_hi)</td></tr>
<tr class="codeline" data-linenumber="330"><td class="num" id="LN330">330</td><td class="line">                                <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="331"><td class="num" id="LN331">331</td><td class="line">                            <span class='keyword'>if</span> (v1 &lt; v1_lo || v1 &gt;= v1_hi)</td></tr>
<tr class="codeline" data-linenumber="332"><td class="num" id="LN332">332</td><td class="line">                                <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="333"><td class="num" id="LN333">333</td><td class="line">                            idx0 = <span class='macro'>CV_CLAMP_INT(idx0, 0, sz0 - 1)<span class='macro_popup'>(idx0 &lt; 0 ? 0 : (sz0 - 1 &lt; idx0 ? sz0 - 1 : idx0))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="334"><td class="num" id="LN334">334</td><td class="line">                            idx1 = <span class='macro'>CV_CLAMP_INT(idx1, 0, sz1 - 1)<span class='macro_popup'>(idx1 &lt; 0 ? 0 : (sz1 - 1 &lt; idx1 ? sz1 - 1 : idx1))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="335"><td class="num" id="LN335">335</td><td class="line">                            <span class='macro'>CV_DbgAssert((<span class='keyword'>unsigned</span>)idx0 &lt; (<span class='keyword'>unsigned</span>)sz0 &amp;&amp; (<span class='keyword'>unsigned</span>)idx1 &lt; (<span class='keyword'>unsigned</span>)sz1)<span class='macro_popup'>do { if (!((unsigned)idx0 &lt; (unsigned)sz0 &amp;&amp; (unsigned<br>)idx1 &lt; (unsigned)sz1)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="336"><td class="num" id="LN336">336</td><td class="line">                            ((<span class='keyword'>int</span>*)(H + hstep0*idx0))[idx1]++;</td></tr>
<tr class="codeline" data-linenumber="337"><td class="num" id="LN337">337</td><td class="line">                        }</td></tr>
<tr class="codeline" data-linenumber="338"><td class="num" id="LN338">338</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="339"><td class="num" id="LN339">339</td><td class="line">            <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="340"><td class="num" id="LN340">340</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="341"><td class="num" id="LN341">341</td><td class="line">        <span class='keyword'>else</span> <span class='keyword'>if</span>( dims == 3 )</td></tr>
<tr class="codeline" data-linenumber="342"><td class="num" id="LN342">342</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="343"><td class="num" id="LN343">343</td><td class="line">            <span class='keyword'>double</span> a0 = uniranges[0], b0 = uniranges[1],</td></tr>
<tr class="codeline" data-linenumber="344"><td class="num" id="LN344">344</td><td class="line">                   a1 = uniranges[2], b1 = uniranges[3],</td></tr>
<tr class="codeline" data-linenumber="345"><td class="num" id="LN345">345</td><td class="line">                   a2 = uniranges[4], b2 = uniranges[5];</td></tr>
<tr class="codeline" data-linenumber="346"><td class="num" id="LN346">346</td><td class="line">            <span class='keyword'>int</span> sz0 = size[0], sz1 = size[1], sz2 = size[2];</td></tr>
<tr class="codeline" data-linenumber="347"><td class="num" id="LN347">347</td><td class="line">            <span class='keyword'>int</span> d0 = deltas[0], step0 = deltas[1],</td></tr>
<tr class="codeline" data-linenumber="348"><td class="num" id="LN348">348</td><td class="line">                d1 = deltas[2], step1 = deltas[3],</td></tr>
<tr class="codeline" data-linenumber="349"><td class="num" id="LN349">349</td><td class="line">                d2 = deltas[4], step2 = deltas[5];</td></tr>
<tr class="codeline" data-linenumber="350"><td class="num" id="LN350">350</td><td class="line">            size_t hstep0 = hstep[0], hstep1 = hstep[1];</td></tr>
<tr class="codeline" data-linenumber="351"><td class="num" id="LN351">351</td><td class="line">            <span class='keyword'>const</span> T* p0 = (<span class='keyword'>const</span> T*)ptrs[0];</td></tr>
<tr class="codeline" data-linenumber="352"><td class="num" id="LN352">352</td><td class="line">            <span class='keyword'>const</span> T* p1 = (<span class='keyword'>const</span> T*)ptrs[1];</td></tr>
<tr class="codeline" data-linenumber="353"><td class="num" id="LN353">353</td><td class="line">            <span class='keyword'>const</span> T* p2 = (<span class='keyword'>const</span> T*)ptrs[2];</td></tr>
<tr class="codeline" data-linenumber="354"><td class="num" id="LN354">354</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="355"><td class="num" id="LN355">355</td><td class="line">            <span class='keyword'>double</span> v0_lo = _ranges[0][0];</td></tr>
<tr class="codeline" data-linenumber="356"><td class="num" id="LN356">356</td><td class="line">            <span class='keyword'>double</span> v0_hi = _ranges[0][1];</td></tr>
<tr class="codeline" data-linenumber="357"><td class="num" id="LN357">357</td><td class="line">            <span class='keyword'>double</span> v1_lo = _ranges[1][0];</td></tr>
<tr class="codeline" data-linenumber="358"><td class="num" id="LN358">358</td><td class="line">            <span class='keyword'>double</span> v1_hi = _ranges[1][1];</td></tr>
<tr class="codeline" data-linenumber="359"><td class="num" id="LN359">359</td><td class="line">            <span class='keyword'>double</span> v2_lo = _ranges[2][0];</td></tr>
<tr class="codeline" data-linenumber="360"><td class="num" id="LN360">360</td><td class="line">            <span class='keyword'>double</span> v2_hi = _ranges[2][1];</td></tr>
<tr class="codeline" data-linenumber="361"><td class="num" id="LN361">361</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="362"><td class="num" id="LN362">362</td><td class="line">            <span class='keyword'>for</span>( ; imsize.height--; p0 += step0, p1 += step1, p2 += step2, mask += mstep )</td></tr>
<tr class="codeline" data-linenumber="363"><td class="num" id="LN363">363</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="364"><td class="num" id="LN364">364</td><td class="line">                <span class='keyword'>if</span>( !mask )</td></tr>
<tr class="codeline" data-linenumber="365"><td class="num" id="LN365">365</td><td class="line">                    <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++, p0 += d0, p1 += d1, p2 += d2 )</td></tr>
<tr class="codeline" data-linenumber="366"><td class="num" id="LN366">366</td><td class="line">                    {</td></tr>
<tr class="codeline" data-linenumber="367"><td class="num" id="LN367">367</td><td class="line">                        <span class='keyword'>double</span> v0 = (<span class='keyword'>double</span>)*p0;</td></tr>
<tr class="codeline" data-linenumber="368"><td class="num" id="LN368">368</td><td class="line">                        <span class='keyword'>double</span> v1 = (<span class='keyword'>double</span>)*p1;</td></tr>
<tr class="codeline" data-linenumber="369"><td class="num" id="LN369">369</td><td class="line">                        <span class='keyword'>double</span> v2 = (<span class='keyword'>double</span>)*p2;</td></tr>
<tr class="codeline" data-linenumber="370"><td class="num" id="LN370">370</td><td class="line">                        <span class='keyword'>int</span> idx0 = cvFloor(v0*a0 + b0);</td></tr>
<tr class="codeline" data-linenumber="371"><td class="num" id="LN371">371</td><td class="line">                        <span class='keyword'>int</span> idx1 = cvFloor(v1*a1 + b1);</td></tr>
<tr class="codeline" data-linenumber="372"><td class="num" id="LN372">372</td><td class="line">                        <span class='keyword'>int</span> idx2 = cvFloor(v2*a2 + b2);</td></tr>
<tr class="codeline" data-linenumber="373"><td class="num" id="LN373">373</td><td class="line">                        <span class='keyword'>if</span> (v0 &lt; v0_lo || v0 &gt;= v0_hi)</td></tr>
<tr class="codeline" data-linenumber="374"><td class="num" id="LN374">374</td><td class="line">                            <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="375"><td class="num" id="LN375">375</td><td class="line">                        <span class='keyword'>if</span> (v1 &lt; v1_lo || v1 &gt;= v1_hi)</td></tr>
<tr class="codeline" data-linenumber="376"><td class="num" id="LN376">376</td><td class="line">                            <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="377"><td class="num" id="LN377">377</td><td class="line">                        <span class='keyword'>if</span> (v2 &lt; v2_lo || v2 &gt;= v2_hi)</td></tr>
<tr class="codeline" data-linenumber="378"><td class="num" id="LN378">378</td><td class="line">                            <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="379"><td class="num" id="LN379">379</td><td class="line">                        idx0 = <span class='macro'>CV_CLAMP_INT(idx0, 0, sz0 - 1)<span class='macro_popup'>(idx0 &lt; 0 ? 0 : (sz0 - 1 &lt; idx0 ? sz0 - 1 : idx0))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="380"><td class="num" id="LN380">380</td><td class="line">                        idx1 = <span class='macro'>CV_CLAMP_INT(idx1, 0, sz1 - 1)<span class='macro_popup'>(idx1 &lt; 0 ? 0 : (sz1 - 1 &lt; idx1 ? sz1 - 1 : idx1))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="381"><td class="num" id="LN381">381</td><td class="line">                        idx2 = <span class='macro'>CV_CLAMP_INT(idx2, 0, sz2 - 1)<span class='macro_popup'>(idx2 &lt; 0 ? 0 : (sz2 - 1 &lt; idx2 ? sz2 - 1 : idx2))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="382"><td class="num" id="LN382">382</td><td class="line">                        <span class='macro'>CV_DbgAssert(<span class='macro_popup'>do { if (!((unsigned)idx0 &lt; (unsigned)sz0 &amp;&amp; (unsigned<br>)idx1 &lt; (unsigned)sz1 &amp;&amp; (unsigned)idx2 &lt; (unsigned<br>)sz2)) abort(); } while (0)</span></span></td></tr>
<tr class="codeline" data-linenumber="383"><td class="num" id="LN383">383</td><td class="line">                            <span class='macro'>(<span class='keyword'>unsigned</span>)idx0 &lt; (<span class='keyword'>unsigned</span>)sz0 &amp;&amp;<span class='macro_popup'>do { if (!((unsigned)idx0 &lt; (unsigned)sz0 &amp;&amp; (unsigned<br>)idx1 &lt; (unsigned)sz1 &amp;&amp; (unsigned)idx2 &lt; (unsigned<br>)sz2)) abort(); } while (0)</span></span></td></tr>
<tr class="codeline" data-linenumber="384"><td class="num" id="LN384">384</td><td class="line">                            <span class='macro'>(<span class='keyword'>unsigned</span>)idx1 &lt; (<span class='keyword'>unsigned</span>)sz1 &amp;&amp;<span class='macro_popup'>do { if (!((unsigned)idx0 &lt; (unsigned)sz0 &amp;&amp; (unsigned<br>)idx1 &lt; (unsigned)sz1 &amp;&amp; (unsigned)idx2 &lt; (unsigned<br>)sz2)) abort(); } while (0)</span></span></td></tr>
<tr class="codeline" data-linenumber="385"><td class="num" id="LN385">385</td><td class="line">                            <span class='macro'>(<span class='keyword'>unsigned</span>)idx2 &lt; (<span class='keyword'>unsigned</span>)sz2)<span class='macro_popup'>do { if (!((unsigned)idx0 &lt; (unsigned)sz0 &amp;&amp; (unsigned<br>)idx1 &lt; (unsigned)sz1 &amp;&amp; (unsigned)idx2 &lt; (unsigned<br>)sz2)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="386"><td class="num" id="LN386">386</td><td class="line">                        ((<span class='keyword'>int</span>*)(H + hstep0*idx0 + hstep1*idx1))[idx2]++;</td></tr>
<tr class="codeline" data-linenumber="387"><td class="num" id="LN387">387</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="388"><td class="num" id="LN388">388</td><td class="line">                <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="389"><td class="num" id="LN389">389</td><td class="line">                    <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++, p0 += d0, p1 += d1, p2 += d2 )</td></tr>
<tr class="codeline" data-linenumber="390"><td class="num" id="LN390">390</td><td class="line">                        <span class='keyword'>if</span>( mask[x] )</td></tr>
<tr class="codeline" data-linenumber="391"><td class="num" id="LN391">391</td><td class="line">                        {</td></tr>
<tr class="codeline" data-linenumber="392"><td class="num" id="LN392">392</td><td class="line">                            <span class='keyword'>double</span> v0 = (<span class='keyword'>double</span>)*p0;</td></tr>
<tr class="codeline" data-linenumber="393"><td class="num" id="LN393">393</td><td class="line">                            <span class='keyword'>double</span> v1 = (<span class='keyword'>double</span>)*p1;</td></tr>
<tr class="codeline" data-linenumber="394"><td class="num" id="LN394">394</td><td class="line">                            <span class='keyword'>double</span> v2 = (<span class='keyword'>double</span>)*p2;</td></tr>
<tr class="codeline" data-linenumber="395"><td class="num" id="LN395">395</td><td class="line">                            <span class='keyword'>int</span> idx0 = cvFloor(v0*a0 + b0);</td></tr>
<tr class="codeline" data-linenumber="396"><td class="num" id="LN396">396</td><td class="line">                            <span class='keyword'>int</span> idx1 = cvFloor(v1*a1 + b1);</td></tr>
<tr class="codeline" data-linenumber="397"><td class="num" id="LN397">397</td><td class="line">                            <span class='keyword'>int</span> idx2 = cvFloor(v2*a2 + b2);</td></tr>
<tr class="codeline" data-linenumber="398"><td class="num" id="LN398">398</td><td class="line">                            <span class='keyword'>if</span> (v0 &lt; v0_lo || v0 &gt;= v0_hi)</td></tr>
<tr class="codeline" data-linenumber="399"><td class="num" id="LN399">399</td><td class="line">                                <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="400"><td class="num" id="LN400">400</td><td class="line">                            <span class='keyword'>if</span> (v1 &lt; v1_lo || v1 &gt;= v1_hi)</td></tr>
<tr class="codeline" data-linenumber="401"><td class="num" id="LN401">401</td><td class="line">                                <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="402"><td class="num" id="LN402">402</td><td class="line">                            <span class='keyword'>if</span> (v2 &lt; v2_lo || v2 &gt;= v2_hi)</td></tr>
<tr class="codeline" data-linenumber="403"><td class="num" id="LN403">403</td><td class="line">                                <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="404"><td class="num" id="LN404">404</td><td class="line">                            idx0 = <span class='macro'>CV_CLAMP_INT(idx0, 0, sz0 - 1)<span class='macro_popup'>(idx0 &lt; 0 ? 0 : (sz0 - 1 &lt; idx0 ? sz0 - 1 : idx0))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="405"><td class="num" id="LN405">405</td><td class="line">                            idx1 = <span class='macro'>CV_CLAMP_INT(idx1, 0, sz1 - 1)<span class='macro_popup'>(idx1 &lt; 0 ? 0 : (sz1 - 1 &lt; idx1 ? sz1 - 1 : idx1))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="406"><td class="num" id="LN406">406</td><td class="line">                            idx2 = <span class='macro'>CV_CLAMP_INT(idx2, 0, sz2 - 1)<span class='macro_popup'>(idx2 &lt; 0 ? 0 : (sz2 - 1 &lt; idx2 ? sz2 - 1 : idx2))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="407"><td class="num" id="LN407">407</td><td class="line">                            <span class='macro'>CV_DbgAssert(<span class='macro_popup'>do { if (!((unsigned)idx0 &lt; (unsigned)sz0 &amp;&amp; (unsigned<br>)idx1 &lt; (unsigned)sz1 &amp;&amp; (unsigned)idx2 &lt; (unsigned<br>)sz2)) abort(); } while (0)</span></span></td></tr>
<tr class="codeline" data-linenumber="408"><td class="num" id="LN408">408</td><td class="line">                                <span class='macro'>(<span class='keyword'>unsigned</span>)idx0 &lt; (<span class='keyword'>unsigned</span>)sz0 &amp;&amp;<span class='macro_popup'>do { if (!((unsigned)idx0 &lt; (unsigned)sz0 &amp;&amp; (unsigned<br>)idx1 &lt; (unsigned)sz1 &amp;&amp; (unsigned)idx2 &lt; (unsigned<br>)sz2)) abort(); } while (0)</span></span></td></tr>
<tr class="codeline" data-linenumber="409"><td class="num" id="LN409">409</td><td class="line">                                <span class='macro'>(<span class='keyword'>unsigned</span>)idx1 &lt; (<span class='keyword'>unsigned</span>)sz1 &amp;&amp;<span class='macro_popup'>do { if (!((unsigned)idx0 &lt; (unsigned)sz0 &amp;&amp; (unsigned<br>)idx1 &lt; (unsigned)sz1 &amp;&amp; (unsigned)idx2 &lt; (unsigned<br>)sz2)) abort(); } while (0)</span></span></td></tr>
<tr class="codeline" data-linenumber="410"><td class="num" id="LN410">410</td><td class="line">                                <span class='macro'>(<span class='keyword'>unsigned</span>)idx2 &lt; (<span class='keyword'>unsigned</span>)sz2)<span class='macro_popup'>do { if (!((unsigned)idx0 &lt; (unsigned)sz0 &amp;&amp; (unsigned<br>)idx1 &lt; (unsigned)sz1 &amp;&amp; (unsigned)idx2 &lt; (unsigned<br>)sz2)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="411"><td class="num" id="LN411">411</td><td class="line">                            ((<span class='keyword'>int</span>*)(H + hstep0*idx0 + hstep1*idx1))[idx2]++;</td></tr>
<tr class="codeline" data-linenumber="412"><td class="num" id="LN412">412</td><td class="line">                        }</td></tr>
<tr class="codeline" data-linenumber="413"><td class="num" id="LN413">413</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="414"><td class="num" id="LN414">414</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="415"><td class="num" id="LN415">415</td><td class="line">        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="416"><td class="num" id="LN416">416</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="417"><td class="num" id="LN417">417</td><td class="line">            <span class='keyword'>for</span>( ; imsize.height--; mask += mstep )</td></tr>
<tr class="codeline" data-linenumber="418"><td class="num" id="LN418">418</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="419"><td class="num" id="LN419">419</td><td class="line">                <span class='keyword'>if</span>( !mask )</td></tr>
<tr class="codeline" data-linenumber="420"><td class="num" id="LN420">420</td><td class="line">                    <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++ )</td></tr>
<tr class="codeline" data-linenumber="421"><td class="num" id="LN421">421</td><td class="line">                    {</td></tr>
<tr class="codeline" data-linenumber="422"><td class="num" id="LN422">422</td><td class="line">                        uchar* Hptr = H;</td></tr>
<tr class="codeline" data-linenumber="423"><td class="num" id="LN423">423</td><td class="line">                        <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="424"><td class="num" id="LN424">424</td><td class="line">                        {</td></tr>
<tr class="codeline" data-linenumber="425"><td class="num" id="LN425">425</td><td class="line">                            <span class='keyword'>double</span> v_lo = _ranges[i][0];</td></tr>
<tr class="codeline" data-linenumber="426"><td class="num" id="LN426">426</td><td class="line">                            <span class='keyword'>double</span> v_hi = _ranges[i][1];</td></tr>
<tr class="codeline" data-linenumber="427"><td class="num" id="LN427">427</td><td class="line">                            <span class='keyword'>double</span> v = *ptrs[i];</td></tr>
<tr class="codeline" data-linenumber="428"><td class="num" id="LN428">428</td><td class="line">                            <span class='keyword'>if</span> (v &lt; v_lo || v &gt;= v_hi)</td></tr>
<tr class="codeline" data-linenumber="429"><td class="num" id="LN429">429</td><td class="line">                                <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="430"><td class="num" id="LN430">430</td><td class="line">                            <span class='keyword'>int</span> idx = cvFloor(v*uniranges[i*2] + uniranges[i*2+1]);</td></tr>
<tr class="codeline" data-linenumber="431"><td class="num" id="LN431">431</td><td class="line">                            idx = <span class='macro'>CV_CLAMP_INT(idx, 0, size[i] - 1)<span class='macro_popup'>(idx &lt; 0 ? 0 : (size[i] - 1 &lt; idx ? size[i] - 1 : idx))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="432"><td class="num" id="LN432">432</td><td class="line">                            <span class='macro'>CV_DbgAssert((<span class='keyword'>unsigned</span>)idx &lt; (<span class='keyword'>unsigned</span>)size[i])<span class='macro_popup'>do { if (!((unsigned)idx &lt; (unsigned)size[i])) abort(); } while<br> (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="433"><td class="num" id="LN433">433</td><td class="line">                            ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="434"><td class="num" id="LN434">434</td><td class="line">                            Hptr += idx*hstep[i];</td></tr>
<tr class="codeline" data-linenumber="435"><td class="num" id="LN435">435</td><td class="line">                        }</td></tr>
<tr class="codeline" data-linenumber="436"><td class="num" id="LN436">436</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="437"><td class="num" id="LN437">437</td><td class="line">                        <span class='keyword'>if</span>( i == dims )</td></tr>
<tr class="codeline" data-linenumber="438"><td class="num" id="LN438">438</td><td class="line">                            ++*((<span class='keyword'>int</span>*)Hptr);</td></tr>
<tr class="codeline" data-linenumber="439"><td class="num" id="LN439">439</td><td class="line">                        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="440"><td class="num" id="LN440">440</td><td class="line">                            <span class='keyword'>for</span>( ; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="441"><td class="num" id="LN441">441</td><td class="line">                                ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="442"><td class="num" id="LN442">442</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="443"><td class="num" id="LN443">443</td><td class="line">                <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="444"><td class="num" id="LN444">444</td><td class="line">                    <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++ )</td></tr>
<tr class="codeline" data-linenumber="445"><td class="num" id="LN445">445</td><td class="line">                    {</td></tr>
<tr class="codeline" data-linenumber="446"><td class="num" id="LN446">446</td><td class="line">                        uchar* Hptr = H;</td></tr>
<tr class="codeline" data-linenumber="447"><td class="num" id="LN447">447</td><td class="line">                        i = 0;</td></tr>
<tr class="codeline" data-linenumber="448"><td class="num" id="LN448">448</td><td class="line">                        <span class='keyword'>if</span>( mask[x] )</td></tr>
<tr class="codeline" data-linenumber="449"><td class="num" id="LN449">449</td><td class="line">                            <span class='keyword'>for</span>( ; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="450"><td class="num" id="LN450">450</td><td class="line">                            {</td></tr>
<tr class="codeline" data-linenumber="451"><td class="num" id="LN451">451</td><td class="line">                                <span class='keyword'>double</span> v_lo = _ranges[i][0];</td></tr>
<tr class="codeline" data-linenumber="452"><td class="num" id="LN452">452</td><td class="line">                                <span class='keyword'>double</span> v_hi = _ranges[i][1];</td></tr>
<tr class="codeline" data-linenumber="453"><td class="num" id="LN453">453</td><td class="line">                                <span class='keyword'>double</span> v = *ptrs[i];</td></tr>
<tr class="codeline" data-linenumber="454"><td class="num" id="LN454">454</td><td class="line">                                <span class='keyword'>if</span> (v &lt; v_lo || v &gt;= v_hi)</td></tr>
<tr class="codeline" data-linenumber="455"><td class="num" id="LN455">455</td><td class="line">                                    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="456"><td class="num" id="LN456">456</td><td class="line">                                <span class='keyword'>int</span> idx = cvFloor(v*uniranges[i*2] + uniranges[i*2+1]);</td></tr>
<tr class="codeline" data-linenumber="457"><td class="num" id="LN457">457</td><td class="line">                                idx = <span class='macro'>CV_CLAMP_INT(idx, 0, size[i] - 1)<span class='macro_popup'>(idx &lt; 0 ? 0 : (size[i] - 1 &lt; idx ? size[i] - 1 : idx))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="458"><td class="num" id="LN458">458</td><td class="line">                                <span class='macro'>CV_DbgAssert((<span class='keyword'>unsigned</span>)idx &lt; (<span class='keyword'>unsigned</span>)size[i])<span class='macro_popup'>do { if (!((unsigned)idx &lt; (unsigned)size[i])) abort(); } while<br> (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="459"><td class="num" id="LN459">459</td><td class="line">                                ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="460"><td class="num" id="LN460">460</td><td class="line">                                Hptr += idx*hstep[i];</td></tr>
<tr class="codeline" data-linenumber="461"><td class="num" id="LN461">461</td><td class="line">                            }</td></tr>
<tr class="codeline" data-linenumber="462"><td class="num" id="LN462">462</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="463"><td class="num" id="LN463">463</td><td class="line">                        <span class='keyword'>if</span>( i == dims )</td></tr>
<tr class="codeline" data-linenumber="464"><td class="num" id="LN464">464</td><td class="line">                            ++*((<span class='keyword'>int</span>*)Hptr);</td></tr>
<tr class="codeline" data-linenumber="465"><td class="num" id="LN465">465</td><td class="line">                        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="466"><td class="num" id="LN466">466</td><td class="line">                            <span class='keyword'>for</span>( ; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="467"><td class="num" id="LN467">467</td><td class="line">                                ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="468"><td class="num" id="LN468">468</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="469"><td class="num" id="LN469">469</td><td class="line">                <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="470"><td class="num" id="LN470">470</td><td class="line">                    ptrs[i] += deltas[i*2 + 1];</td></tr>
<tr class="codeline" data-linenumber="471"><td class="num" id="LN471">471</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="472"><td class="num" id="LN472">472</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="473"><td class="num" id="LN473">473</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="474"><td class="num" id="LN474">474</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (_ranges)</td></tr>
<tr class="codeline" data-linenumber="475"><td class="num" id="LN475">475</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="476"><td class="num" id="LN476">476</td><td class="line">        <span class='comment'>// non-uniform histogram</span></td></tr>
<tr class="codeline" data-linenumber="477"><td class="num" id="LN477">477</td><td class="line">        <span class='keyword'>const</span> <span class='keyword'>float</span>* ranges[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>];</td></tr>
<tr class="codeline" data-linenumber="478"><td class="num" id="LN478">478</td><td class="line">        <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="479"><td class="num" id="LN479">479</td><td class="line">            ranges[i] = &amp;_ranges[i][0];</td></tr>
<tr class="codeline" data-linenumber="480"><td class="num" id="LN480">480</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="481"><td class="num" id="LN481">481</td><td class="line">        <span class='keyword'>for</span>( ; imsize.height--; mask += mstep )</td></tr>
<tr class="codeline" data-linenumber="482"><td class="num" id="LN482">482</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="483"><td class="num" id="LN483">483</td><td class="line">            <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++ )</td></tr>
<tr class="codeline" data-linenumber="484"><td class="num" id="LN484">484</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="485"><td class="num" id="LN485">485</td><td class="line">                uchar* Hptr = H;</td></tr>
<tr class="codeline" data-linenumber="486"><td class="num" id="LN486">486</td><td class="line">                i = 0;</td></tr>
<tr class="codeline" data-linenumber="487"><td class="num" id="LN487">487</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="488"><td class="num" id="LN488">488</td><td class="line">                <span class='keyword'>if</span>( !mask || mask[x] )</td></tr>
<tr class="codeline" data-linenumber="489"><td class="num" id="LN489">489</td><td class="line">                    <span class='keyword'>for</span>( ; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="490"><td class="num" id="LN490">490</td><td class="line">                    {</td></tr>
<tr class="codeline" data-linenumber="491"><td class="num" id="LN491">491</td><td class="line">                        <span class='keyword'>float</span> v = (<span class='keyword'>float</span>)*ptrs[i];</td></tr>
<tr class="codeline" data-linenumber="492"><td class="num" id="LN492">492</td><td class="line">                        <span class='keyword'>const</span> <span class='keyword'>float</span>* R = ranges[i];</td></tr>
<tr class="codeline" data-linenumber="493"><td class="num" id="LN493">493</td><td class="line">                        <span class='keyword'>int</span> idx = -1, sz = size[i];</td></tr>
<tr class="codeline" data-linenumber="494"><td class="num" id="LN494">494</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="495"><td class="num" id="LN495">495</td><td class="line">                        <span class='keyword'>while</span>( v &gt;= R[idx+1] &amp;&amp; ++idx &lt; sz )</td></tr>
<tr class="codeline" data-linenumber="496"><td class="num" id="LN496">496</td><td class="line">                            ; <span class='comment'>// nop</span></td></tr>
<tr class="codeline" data-linenumber="497"><td class="num" id="LN497">497</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="498"><td class="num" id="LN498">498</td><td class="line">                        <span class='keyword'>if</span>( (<span class='keyword'>unsigned</span>)idx &gt;= (<span class='keyword'>unsigned</span>)sz )</td></tr>
<tr class="codeline" data-linenumber="499"><td class="num" id="LN499">499</td><td class="line">                            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="500"><td class="num" id="LN500">500</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="501"><td class="num" id="LN501">501</td><td class="line">                        ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="502"><td class="num" id="LN502">502</td><td class="line">                        Hptr += idx*hstep[i];</td></tr>
<tr class="codeline" data-linenumber="503"><td class="num" id="LN503">503</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="504"><td class="num" id="LN504">504</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="505"><td class="num" id="LN505">505</td><td class="line">                <span class='keyword'>if</span>( i == dims )</td></tr>
<tr class="codeline" data-linenumber="506"><td class="num" id="LN506">506</td><td class="line">                    ++*((<span class='keyword'>int</span>*)Hptr);</td></tr>
<tr class="codeline" data-linenumber="507"><td class="num" id="LN507">507</td><td class="line">                <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="508"><td class="num" id="LN508">508</td><td class="line">                    <span class='keyword'>for</span>( ; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="509"><td class="num" id="LN509">509</td><td class="line">                        ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="510"><td class="num" id="LN510">510</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="511"><td class="num" id="LN511">511</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="512"><td class="num" id="LN512">512</td><td class="line">            <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="513"><td class="num" id="LN513">513</td><td class="line">                ptrs[i] += deltas[i*2 + 1];</td></tr>
<tr class="codeline" data-linenumber="514"><td class="num" id="LN514">514</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="515"><td class="num" id="LN515">515</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="516"><td class="num" id="LN516">516</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="517"><td class="num" id="LN517">517</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="518"><td class="num" id="LN518">518</td><td class="line">        <span class='macro'>CV_Error(Error::StsBadArg, <span class='string_literal'>"Either ranges, either uniform ranges should be provided"</span>)<span class='macro_popup'>do { (void)(Error::StsBadArg); (void)("Either ranges, either uniform ranges should be provided"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="519"><td class="num" id="LN519">519</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="520"><td class="num" id="LN520">520</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="521"><td class="num" id="LN521">521</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="522"><td class="num" id="LN522">522</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="523"><td class="num" id="LN523">523</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="524"><td class="num" id="LN524">524</td><td class="line">calcHist_8u( std::vector&lt;uchar*&gt;&amp; _ptrs, <span class='keyword'>const</span> std::vector&lt;<span class='keyword'>int</span>&gt;&amp; _deltas,</td></tr>
<tr class="codeline" data-linenumber="525"><td class="num" id="LN525">525</td><td class="line">             Size imsize, Mat&amp; hist, <span class='keyword'>int</span> dims, <span class='keyword'>const</span> <span class='keyword'>float</span>** _ranges,</td></tr>
<tr class="codeline" data-linenumber="526"><td class="num" id="LN526">526</td><td class="line">             <span class='keyword'>const</span> <span class='keyword'>double</span>* _uniranges, <span class='keyword'>bool</span> uniform )</td></tr>
<tr class="codeline" data-linenumber="527"><td class="num" id="LN527">527</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="528"><td class="num" id="LN528">528</td><td class="line">    uchar** ptrs = &amp;_ptrs[0];</td></tr>
<tr class="codeline" data-linenumber="529"><td class="num" id="LN529">529</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>int</span>* deltas = &amp;_deltas[0];</td></tr>
<tr class="codeline" data-linenumber="530"><td class="num" id="LN530">530</td><td class="line">    uchar* H = hist.ptr();</td></tr>
<tr class="codeline" data-linenumber="531"><td class="num" id="LN531">531</td><td class="line">    <span class='keyword'>int</span> x;</td></tr>
<tr class="codeline" data-linenumber="532"><td class="num" id="LN532">532</td><td class="line">    <span class='keyword'>const</span> uchar* mask = _ptrs[dims];</td></tr>
<tr class="codeline" data-linenumber="533"><td class="num" id="LN533">533</td><td class="line">    <span class='keyword'>int</span> mstep = _deltas[dims*2 + 1];</td></tr>
<tr class="codeline" data-linenumber="534"><td class="num" id="LN534">534</td><td class="line">    std::vector&lt;size_t&gt; _tab;</td></tr>
<tr class="codeline" data-linenumber="535"><td class="num" id="LN535">535</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="536"><td class="num" id="LN536">536</td><td class="line">    calcHistLookupTables_8u( hist, SparseMat(), dims, _ranges, _uniranges, uniform, <span class='keyword'>false</span>, _tab );</td></tr>
<tr class="codeline" data-linenumber="537"><td class="num" id="LN537">537</td><td class="line">    <span class='keyword'>const</span> size_t* tab = &amp;_tab[0];</td></tr>
<tr class="codeline" data-linenumber="538"><td class="num" id="LN538">538</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="539"><td class="num" id="LN539">539</td><td class="line">    <span class='keyword'>if</span>( dims == 1 )</td></tr>
<tr class="codeline" data-linenumber="540"><td class="num" id="LN540">540</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="541"><td class="num" id="LN541">541</td><td class="line">        <span class='keyword'>int</span> d0 = deltas[0], step0 = deltas[1];</td></tr>
<tr class="codeline" data-linenumber="542"><td class="num" id="LN542">542</td><td class="line">        <span class='keyword'>int</span> matH[256] = { 0, };</td></tr>
<tr class="codeline" data-linenumber="543"><td class="num" id="LN543">543</td><td class="line">        <span class='keyword'>const</span> uchar* p0 = (<span class='keyword'>const</span> uchar*)ptrs[0];</td></tr>
<tr class="codeline" data-linenumber="544"><td class="num" id="LN544">544</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="545"><td class="num" id="LN545">545</td><td class="line">        <span class='keyword'>for</span>( ; imsize.height--; p0 += step0, mask += mstep )</td></tr>
<tr class="codeline" data-linenumber="546"><td class="num" id="LN546">546</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="547"><td class="num" id="LN547">547</td><td class="line">            <span class='keyword'>if</span>( !mask )</td></tr>
<tr class="codeline" data-linenumber="548"><td class="num" id="LN548">548</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="549"><td class="num" id="LN549">549</td><td class="line">                <span class='keyword'>if</span>( d0 == 1 )</td></tr>
<tr class="codeline" data-linenumber="550"><td class="num" id="LN550">550</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="551"><td class="num" id="LN551">551</td><td class="line">                    <span class='keyword'>for</span>( x = 0; x &lt;= imsize.width - 4; x += 4 )</td></tr>
<tr class="codeline" data-linenumber="552"><td class="num" id="LN552">552</td><td class="line">                    {</td></tr>
<tr class="codeline" data-linenumber="553"><td class="num" id="LN553">553</td><td class="line">                        <span class='keyword'>int</span> t0 = p0[x], t1 = p0[x+1];</td></tr>
<tr class="codeline" data-linenumber="554"><td class="num" id="LN554">554</td><td class="line">                        matH[t0]++; matH[t1]++;</td></tr>
<tr class="codeline" data-linenumber="555"><td class="num" id="LN555">555</td><td class="line">                        t0 = p0[x+2]; t1 = p0[x+3];</td></tr>
<tr class="codeline" data-linenumber="556"><td class="num" id="LN556">556</td><td class="line">                        matH[t0]++; matH[t1]++;</td></tr>
<tr class="codeline" data-linenumber="557"><td class="num" id="LN557">557</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="558"><td class="num" id="LN558">558</td><td class="line">                    p0 += x;</td></tr>
<tr class="codeline" data-linenumber="559"><td class="num" id="LN559">559</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="560"><td class="num" id="LN560">560</td><td class="line">                <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="561"><td class="num" id="LN561">561</td><td class="line">                    <span class='keyword'>for</span>( x = 0; x &lt;= imsize.width - 4; x += 4 )</td></tr>
<tr class="codeline" data-linenumber="562"><td class="num" id="LN562">562</td><td class="line">                    {</td></tr>
<tr class="codeline" data-linenumber="563"><td class="num" id="LN563">563</td><td class="line">                        <span class='keyword'>int</span> t0 = p0[0], t1 = p0[d0];</td></tr>
<tr class="codeline" data-linenumber="564"><td class="num" id="LN564">564</td><td class="line">                        matH[t0]++; matH[t1]++;</td></tr>
<tr class="codeline" data-linenumber="565"><td class="num" id="LN565">565</td><td class="line">                        p0 += d0*2;</td></tr>
<tr class="codeline" data-linenumber="566"><td class="num" id="LN566">566</td><td class="line">                        t0 = p0[0]; t1 = p0[d0];</td></tr>
<tr class="codeline" data-linenumber="567"><td class="num" id="LN567">567</td><td class="line">                        matH[t0]++; matH[t1]++;</td></tr>
<tr class="codeline" data-linenumber="568"><td class="num" id="LN568">568</td><td class="line">                        p0 += d0*2;</td></tr>
<tr class="codeline" data-linenumber="569"><td class="num" id="LN569">569</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="570"><td class="num" id="LN570">570</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="571"><td class="num" id="LN571">571</td><td class="line">                <span class='keyword'>for</span>( ; x &lt; imsize.width; x++, p0 += d0 )</td></tr>
<tr class="codeline" data-linenumber="572"><td class="num" id="LN572">572</td><td class="line">                    matH[*p0]++;</td></tr>
<tr class="codeline" data-linenumber="573"><td class="num" id="LN573">573</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="574"><td class="num" id="LN574">574</td><td class="line">            <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="575"><td class="num" id="LN575">575</td><td class="line">                <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++, p0 += d0 )</td></tr>
<tr class="codeline" data-linenumber="576"><td class="num" id="LN576">576</td><td class="line">                    <span class='keyword'>if</span>( mask[x] )</td></tr>
<tr class="codeline" data-linenumber="577"><td class="num" id="LN577">577</td><td class="line">                        matH[*p0]++;</td></tr>
<tr class="codeline" data-linenumber="578"><td class="num" id="LN578">578</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="579"><td class="num" id="LN579">579</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="580"><td class="num" id="LN580">580</td><td class="line">        <span class='keyword'>for</span>(<span class='keyword'>int</span> i = 0; i &lt; 256; i++ )</td></tr>
<tr class="codeline" data-linenumber="581"><td class="num" id="LN581">581</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="582"><td class="num" id="LN582">582</td><td class="line">            size_t hidx = tab[i];</td></tr>
<tr class="codeline" data-linenumber="583"><td class="num" id="LN583">583</td><td class="line">            <span class='keyword'>if</span>( hidx &lt; OUT_OF_RANGE )</td></tr>
<tr class="codeline" data-linenumber="584"><td class="num" id="LN584">584</td><td class="line">                *(<span class='keyword'>int</span>*)(H + hidx) += matH[i];</td></tr>
<tr class="codeline" data-linenumber="585"><td class="num" id="LN585">585</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="586"><td class="num" id="LN586">586</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="587"><td class="num" id="LN587">587</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span>( dims == 2 )</td></tr>
<tr class="codeline" data-linenumber="588"><td class="num" id="LN588">588</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="589"><td class="num" id="LN589">589</td><td class="line">        <span class='keyword'>int</span> d0 = deltas[0], step0 = deltas[1],</td></tr>
<tr class="codeline" data-linenumber="590"><td class="num" id="LN590">590</td><td class="line">            d1 = deltas[2], step1 = deltas[3];</td></tr>
<tr class="codeline" data-linenumber="591"><td class="num" id="LN591">591</td><td class="line">        <span class='keyword'>const</span> uchar* p0 = (<span class='keyword'>const</span> uchar*)ptrs[0];</td></tr>
<tr class="codeline" data-linenumber="592"><td class="num" id="LN592">592</td><td class="line">        <span class='keyword'>const</span> uchar* p1 = (<span class='keyword'>const</span> uchar*)ptrs[1];</td></tr>
<tr class="codeline" data-linenumber="593"><td class="num" id="LN593">593</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="594"><td class="num" id="LN594">594</td><td class="line">        <span class='keyword'>for</span>( ; imsize.height--; p0 += step0, p1 += step1, mask += mstep )</td></tr>
<tr class="codeline" data-linenumber="595"><td class="num" id="LN595">595</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="596"><td class="num" id="LN596">596</td><td class="line">            <span class='keyword'>if</span>( !mask )</td></tr>
<tr class="codeline" data-linenumber="597"><td class="num" id="LN597">597</td><td class="line">                <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++, p0 += d0, p1 += d1 )</td></tr>
<tr class="codeline" data-linenumber="598"><td class="num" id="LN598">598</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="599"><td class="num" id="LN599">599</td><td class="line">                    size_t idx = tab[*p0] + tab[*p1 + 256];</td></tr>
<tr class="codeline" data-linenumber="600"><td class="num" id="LN600">600</td><td class="line">                    <span class='keyword'>if</span>( idx &lt; OUT_OF_RANGE )</td></tr>
<tr class="codeline" data-linenumber="601"><td class="num" id="LN601">601</td><td class="line">                        ++*(<span class='keyword'>int</span>*)(H + idx);</td></tr>
<tr class="codeline" data-linenumber="602"><td class="num" id="LN602">602</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="603"><td class="num" id="LN603">603</td><td class="line">            <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="604"><td class="num" id="LN604">604</td><td class="line">                <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++, p0 += d0, p1 += d1 )</td></tr>
<tr class="codeline" data-linenumber="605"><td class="num" id="LN605">605</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="606"><td class="num" id="LN606">606</td><td class="line">                    size_t idx;</td></tr>
<tr class="codeline" data-linenumber="607"><td class="num" id="LN607">607</td><td class="line">                    <span class='keyword'>if</span>( mask[x] &amp;&amp; (idx = tab[*p0] + tab[*p1 + 256]) &lt; OUT_OF_RANGE )</td></tr>
<tr class="codeline" data-linenumber="608"><td class="num" id="LN608">608</td><td class="line">                        ++*(<span class='keyword'>int</span>*)(H + idx);</td></tr>
<tr class="codeline" data-linenumber="609"><td class="num" id="LN609">609</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="610"><td class="num" id="LN610">610</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="611"><td class="num" id="LN611">611</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="612"><td class="num" id="LN612">612</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span>( dims == 3 )</td></tr>
<tr class="codeline" data-linenumber="613"><td class="num" id="LN613">613</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="614"><td class="num" id="LN614">614</td><td class="line">        <span class='keyword'>int</span> d0 = deltas[0], step0 = deltas[1],</td></tr>
<tr class="codeline" data-linenumber="615"><td class="num" id="LN615">615</td><td class="line">            d1 = deltas[2], step1 = deltas[3],</td></tr>
<tr class="codeline" data-linenumber="616"><td class="num" id="LN616">616</td><td class="line">            d2 = deltas[4], step2 = deltas[5];</td></tr>
<tr class="codeline" data-linenumber="617"><td class="num" id="LN617">617</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="618"><td class="num" id="LN618">618</td><td class="line">        <span class='keyword'>const</span> uchar* p0 = (<span class='keyword'>const</span> uchar*)ptrs[0];</td></tr>
<tr class="codeline" data-linenumber="619"><td class="num" id="LN619">619</td><td class="line">        <span class='keyword'>const</span> uchar* p1 = (<span class='keyword'>const</span> uchar*)ptrs[1];</td></tr>
<tr class="codeline" data-linenumber="620"><td class="num" id="LN620">620</td><td class="line">        <span class='keyword'>const</span> uchar* p2 = (<span class='keyword'>const</span> uchar*)ptrs[2];</td></tr>
<tr class="codeline" data-linenumber="621"><td class="num" id="LN621">621</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="622"><td class="num" id="LN622">622</td><td class="line">        <span class='keyword'>for</span>( ; imsize.height--; p0 += step0, p1 += step1, p2 += step2, mask += mstep )</td></tr>
<tr class="codeline" data-linenumber="623"><td class="num" id="LN623">623</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="624"><td class="num" id="LN624">624</td><td class="line">            <span class='keyword'>if</span>( !mask )</td></tr>
<tr class="codeline" data-linenumber="625"><td class="num" id="LN625">625</td><td class="line">                <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++, p0 += d0, p1 += d1, p2 += d2 )</td></tr>
<tr class="codeline" data-linenumber="626"><td class="num" id="LN626">626</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="627"><td class="num" id="LN627">627</td><td class="line">                    size_t idx = tab[*p0] + tab[*p1 + 256] + tab[*p2 + 512];</td></tr>
<tr class="codeline" data-linenumber="628"><td class="num" id="LN628">628</td><td class="line">                    <span class='keyword'>if</span>( idx &lt; OUT_OF_RANGE )</td></tr>
<tr class="codeline" data-linenumber="629"><td class="num" id="LN629">629</td><td class="line">                        ++*(<span class='keyword'>int</span>*)(H + idx);</td></tr>
<tr class="codeline" data-linenumber="630"><td class="num" id="LN630">630</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="631"><td class="num" id="LN631">631</td><td class="line">            <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="632"><td class="num" id="LN632">632</td><td class="line">                <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++, p0 += d0, p1 += d1, p2 += d2 )</td></tr>
<tr class="codeline" data-linenumber="633"><td class="num" id="LN633">633</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="634"><td class="num" id="LN634">634</td><td class="line">                    size_t idx;</td></tr>
<tr class="codeline" data-linenumber="635"><td class="num" id="LN635">635</td><td class="line">                    <span class='keyword'>if</span>( mask[x] &amp;&amp; (idx = tab[*p0] + tab[*p1 + 256] + tab[*p2 + 512]) &lt; OUT_OF_RANGE )</td></tr>
<tr class="codeline" data-linenumber="636"><td class="num" id="LN636">636</td><td class="line">                        ++*(<span class='keyword'>int</span>*)(H + idx);</td></tr>
<tr class="codeline" data-linenumber="637"><td class="num" id="LN637">637</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="638"><td class="num" id="LN638">638</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="639"><td class="num" id="LN639">639</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="640"><td class="num" id="LN640">640</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="641"><td class="num" id="LN641">641</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="642"><td class="num" id="LN642">642</td><td class="line">        <span class='keyword'>for</span>( ; imsize.height--; mask += mstep )</td></tr>
<tr class="codeline" data-linenumber="643"><td class="num" id="LN643">643</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="644"><td class="num" id="LN644">644</td><td class="line">            <span class='keyword'>if</span>( !mask )</td></tr>
<tr class="codeline" data-linenumber="645"><td class="num" id="LN645">645</td><td class="line">                <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++ )</td></tr>
<tr class="codeline" data-linenumber="646"><td class="num" id="LN646">646</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="647"><td class="num" id="LN647">647</td><td class="line">                    uchar* Hptr = H;</td></tr>
<tr class="codeline" data-linenumber="648"><td class="num" id="LN648">648</td><td class="line">                    <span class='keyword'>int</span> i = 0;</td></tr>
<tr class="codeline" data-linenumber="649"><td class="num" id="LN649">649</td><td class="line">                    <span class='keyword'>for</span>( ; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="650"><td class="num" id="LN650">650</td><td class="line">                    {</td></tr>
<tr class="codeline" data-linenumber="651"><td class="num" id="LN651">651</td><td class="line">                        size_t idx = tab[*ptrs[i] + i*256];</td></tr>
<tr class="codeline" data-linenumber="652"><td class="num" id="LN652">652</td><td class="line">                        <span class='keyword'>if</span>( idx &gt;= OUT_OF_RANGE )</td></tr>
<tr class="codeline" data-linenumber="653"><td class="num" id="LN653">653</td><td class="line">                            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="654"><td class="num" id="LN654">654</td><td class="line">                        Hptr += idx;</td></tr>
<tr class="codeline" data-linenumber="655"><td class="num" id="LN655">655</td><td class="line">                        ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="656"><td class="num" id="LN656">656</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="657"><td class="num" id="LN657">657</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="658"><td class="num" id="LN658">658</td><td class="line">                    <span class='keyword'>if</span>( i == dims )</td></tr>
<tr class="codeline" data-linenumber="659"><td class="num" id="LN659">659</td><td class="line">                        ++*((<span class='keyword'>int</span>*)Hptr);</td></tr>
<tr class="codeline" data-linenumber="660"><td class="num" id="LN660">660</td><td class="line">                    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="661"><td class="num" id="LN661">661</td><td class="line">                        <span class='keyword'>for</span>( ; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="662"><td class="num" id="LN662">662</td><td class="line">                            ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="663"><td class="num" id="LN663">663</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="664"><td class="num" id="LN664">664</td><td class="line">            <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="665"><td class="num" id="LN665">665</td><td class="line">                <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++ )</td></tr>
<tr class="codeline" data-linenumber="666"><td class="num" id="LN666">666</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="667"><td class="num" id="LN667">667</td><td class="line">                    uchar* Hptr = H;</td></tr>
<tr class="codeline" data-linenumber="668"><td class="num" id="LN668">668</td><td class="line">                    <span class='keyword'>int</span> i = 0;</td></tr>
<tr class="codeline" data-linenumber="669"><td class="num" id="LN669">669</td><td class="line">                    <span class='keyword'>if</span>( mask[x] )</td></tr>
<tr class="codeline" data-linenumber="670"><td class="num" id="LN670">670</td><td class="line">                        <span class='keyword'>for</span>( ; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="671"><td class="num" id="LN671">671</td><td class="line">                        {</td></tr>
<tr class="codeline" data-linenumber="672"><td class="num" id="LN672">672</td><td class="line">                            size_t idx = tab[*ptrs[i] + i*256];</td></tr>
<tr class="codeline" data-linenumber="673"><td class="num" id="LN673">673</td><td class="line">                            <span class='keyword'>if</span>( idx &gt;= OUT_OF_RANGE )</td></tr>
<tr class="codeline" data-linenumber="674"><td class="num" id="LN674">674</td><td class="line">                                <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="675"><td class="num" id="LN675">675</td><td class="line">                            Hptr += idx;</td></tr>
<tr class="codeline" data-linenumber="676"><td class="num" id="LN676">676</td><td class="line">                            ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="677"><td class="num" id="LN677">677</td><td class="line">                        }</td></tr>
<tr class="codeline" data-linenumber="678"><td class="num" id="LN678">678</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="679"><td class="num" id="LN679">679</td><td class="line">                    <span class='keyword'>if</span>( i == dims )</td></tr>
<tr class="codeline" data-linenumber="680"><td class="num" id="LN680">680</td><td class="line">                        ++*((<span class='keyword'>int</span>*)Hptr);</td></tr>
<tr class="codeline" data-linenumber="681"><td class="num" id="LN681">681</td><td class="line">                    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="682"><td class="num" id="LN682">682</td><td class="line">                        <span class='keyword'>for</span>( ; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="683"><td class="num" id="LN683">683</td><td class="line">                            ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="684"><td class="num" id="LN684">684</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="685"><td class="num" id="LN685">685</td><td class="line">            <span class='keyword'>for</span>(<span class='keyword'>int</span> i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="686"><td class="num" id="LN686">686</td><td class="line">                ptrs[i] += deltas[i*2 + 1];</td></tr>
<tr class="codeline" data-linenumber="687"><td class="num" id="LN687">687</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="688"><td class="num" id="LN688">688</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="689"><td class="num" id="LN689">689</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="690"><td class="num" id="LN690">690</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="691"><td class="num" id="LN691">691</td><td class="line"><span class='directive'>#ifdef HAVE_IPP</span></td></tr>
<tr class="codeline" data-linenumber="692"><td class="num" id="LN692">692</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="693"><td class="num" id="LN693">693</td><td class="line"><span class='keyword'>typedef</span> IppStatus(CV_STDCALL * IppiHistogram_C1)(<span class='keyword'>const</span> <span class='keyword'>void</span>* pSrc, <span class='keyword'>int</span> srcStep,</td></tr>
<tr class="codeline" data-linenumber="694"><td class="num" id="LN694">694</td><td class="line">    IppiSize roiSize, Ipp32u* pHist, <span class='keyword'>const</span> IppiHistogramSpec* pSpec, Ipp8u* pBuffer);</td></tr>
<tr class="codeline" data-linenumber="695"><td class="num" id="LN695">695</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="696"><td class="num" id="LN696">696</td><td class="line"><span class='keyword'>static</span> IppiHistogram_C1 getIppiHistogramFunction_C1(<span class='keyword'>int</span> type)</td></tr>
<tr class="codeline" data-linenumber="697"><td class="num" id="LN697">697</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="698"><td class="num" id="LN698">698</td><td class="line">    IppiHistogram_C1 ippFunction =</td></tr>
<tr class="codeline" data-linenumber="699"><td class="num" id="LN699">699</td><td class="line">        (type == <span class='macro'>CV_8UC1<span class='macro_popup'>(((0) &amp; ((1 &lt;&lt; 3) - 1)) + (((1)-1) &lt;&lt; 3))</span></span>) ? (IppiHistogram_C1)<span class='macro'>ippiHistogram_8u_C1R<span class='macro_popup'>ippicviHistogram_8u_C1R</span></span> :</td></tr>
<tr class="codeline" data-linenumber="700"><td class="num" id="LN700">700</td><td class="line">        (type == <span class='macro'>CV_16UC1<span class='macro_popup'>(((2) &amp; ((1 &lt;&lt; 3) - 1)) + (((1)-1) &lt;&lt; 3))</span></span>) ? (IppiHistogram_C1)<span class='macro'>ippiHistogram_16u_C1R<span class='macro_popup'>ippicviHistogram_16u_C1R</span></span> :</td></tr>
<tr class="codeline" data-linenumber="701"><td class="num" id="LN701">701</td><td class="line">        (type == <span class='macro'>CV_32FC1<span class='macro_popup'>(((5) &amp; ((1 &lt;&lt; 3) - 1)) + (((1)-1) &lt;&lt; 3))</span></span>) ? (IppiHistogram_C1)<span class='macro'>ippiHistogram_32f_C1R<span class='macro_popup'>ippicviHistogram_32f_C1R</span></span> :</td></tr>
<tr class="codeline" data-linenumber="702"><td class="num" id="LN702">702</td><td class="line">        <span class='macro'>NULL<span class='macro_popup'>__null</span></span>;</td></tr>
<tr class="codeline" data-linenumber="703"><td class="num" id="LN703">703</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="704"><td class="num" id="LN704">704</td><td class="line">    <span class='keyword'>return</span> ippFunction;</td></tr>
<tr class="codeline" data-linenumber="705"><td class="num" id="LN705">705</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="706"><td class="num" id="LN706">706</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="707"><td class="num" id="LN707">707</td><td class="line"><span class='keyword'>class</span> ipp_calcHistParallelTLS</td></tr>
<tr class="codeline" data-linenumber="708"><td class="num" id="LN708">708</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="709"><td class="num" id="LN709">709</td><td class="line"><span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="710"><td class="num" id="LN710">710</td><td class="line">    ipp_calcHistParallelTLS() {}</td></tr>
<tr class="codeline" data-linenumber="711"><td class="num" id="LN711">711</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="712"><td class="num" id="LN712">712</td><td class="line">    IppAutoBuffer&lt;IppiHistogramSpec&gt; spec;</td></tr>
<tr class="codeline" data-linenumber="713"><td class="num" id="LN713">713</td><td class="line">    IppAutoBuffer&lt;Ipp8u&gt;  buffer;</td></tr>
<tr class="codeline" data-linenumber="714"><td class="num" id="LN714">714</td><td class="line">    IppAutoBuffer&lt;Ipp32u&gt; thist;</td></tr>
<tr class="codeline" data-linenumber="715"><td class="num" id="LN715">715</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="716"><td class="num" id="LN716">716</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="717"><td class="num" id="LN717">717</td><td class="line"><span class='keyword'>class</span> ipp_calcHistParallel: <span class='keyword'>public</span> ParallelLoopBody</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path1" class="msg msgEvent" style="margin-left:7ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">1</div></td><td>Calling '~TLSData'</td><td><div class="PathNav"><a href="#Path2" title="Next event (2)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="718"><td class="num" id="LN718">718</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="719"><td class="num" id="LN719">719</td><td class="line"><span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="720"><td class="num" id="LN720">720</td><td class="line">    ipp_calcHistParallel(<span class='keyword'>const</span> Mat &amp;src, Mat &amp;hist, Ipp32s histSize, <span class='keyword'>const</span> <span class='keyword'>float</span> *ranges, <span class='keyword'>bool</span> uniform, <span class='keyword'>bool</span> &amp;ok):</td></tr>
<tr class="codeline" data-linenumber="721"><td class="num" id="LN721">721</td><td class="line">        ParallelLoopBody(), m_src(src), m_hist(hist), m_ok(ok)</td></tr>
<tr class="codeline" data-linenumber="722"><td class="num" id="LN722">722</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="723"><td class="num" id="LN723">723</td><td class="line">        ok = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="724"><td class="num" id="LN724">724</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="725"><td class="num" id="LN725">725</td><td class="line">        m_uniform        = uniform;</td></tr>
<tr class="codeline" data-linenumber="726"><td class="num" id="LN726">726</td><td class="line">        m_ranges         = ranges;</td></tr>
<tr class="codeline" data-linenumber="727"><td class="num" id="LN727">727</td><td class="line">        m_histSize       = histSize;</td></tr>
<tr class="codeline" data-linenumber="728"><td class="num" id="LN728">728</td><td class="line">        m_type           = ippiGetDataType(src.type());</td></tr>
<tr class="codeline" data-linenumber="729"><td class="num" id="LN729">729</td><td class="line">        m_levelsNum      = histSize+1;</td></tr>
<tr class="codeline" data-linenumber="730"><td class="num" id="LN730">730</td><td class="line">        ippiHistogram_C1 = getIppiHistogramFunction_C1(src.type());</td></tr>
<tr class="codeline" data-linenumber="731"><td class="num" id="LN731">731</td><td class="line">        m_fullRoi    = ippiSize(src.size());</td></tr>
<tr class="codeline" data-linenumber="732"><td class="num" id="LN732">732</td><td class="line">        m_bufferSize = 0;</td></tr>
<tr class="codeline" data-linenumber="733"><td class="num" id="LN733">733</td><td class="line">        m_specSize   = 0;</td></tr>
<tr class="codeline" data-linenumber="734"><td class="num" id="LN734">734</td><td class="line">        <span class='keyword'>if</span>(!ippiHistogram_C1)</td></tr>
<tr class="codeline" data-linenumber="735"><td class="num" id="LN735">735</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="736"><td class="num" id="LN736">736</td><td class="line">            ok = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="737"><td class="num" id="LN737">737</td><td class="line">            <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="738"><td class="num" id="LN738">738</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="739"><td class="num" id="LN739">739</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="740"><td class="num" id="LN740">740</td><td class="line">        <span class='keyword'>if</span>(<span class='macro'>ippiHistogramGetBufferSize<span class='macro_popup'>ippicviHistogramGetBufferSize</span></span>(m_type, m_fullRoi, &amp;m_levelsNum, 1, 1, &amp;m_specSize, &amp;m_bufferSize) &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="741"><td class="num" id="LN741">741</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="742"><td class="num" id="LN742">742</td><td class="line">            ok = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="743"><td class="num" id="LN743">743</td><td class="line">            <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="744"><td class="num" id="LN744">744</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="745"><td class="num" id="LN745">745</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="746"><td class="num" id="LN746">746</td><td class="line">        hist.setTo(0);</td></tr>
<tr class="codeline" data-linenumber="747"><td class="num" id="LN747">747</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="748"><td class="num" id="LN748">748</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="749"><td class="num" id="LN749">749</td><td class="line">    <span class='keyword'>virtual</span> <span class='keyword'>void</span> <span class='keyword'>operator</span>() (<span class='keyword'>const</span> Range &amp; range) <span class='keyword'>const</span> <span class='macro'>CV_OVERRIDE<span class='macro_popup'>override</span></span></td></tr>
<tr class="codeline" data-linenumber="750"><td class="num" id="LN750">750</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="751"><td class="num" id="LN751">751</td><td class="line">        <span class='macro'>CV_INSTRUMENT_REGION_IPP()<span class='macro_popup'>; static cv::utils::trace::details::Region::LocationExtraData<br>* __cv_trace_location_extra_region751 = 0; static const cv::utils<br>::trace::details::Region::LocationStaticStorage __cv_trace_location_region751<br> = { &amp;(__cv_trace_location_extra_region751), "IPP", "/home/zhh/projects/opencv-4.5.2/modules/imgproc/src/histogram.cpp"<br>, 751, cv::utils::trace::details::REGION_FLAG_IMPL_IPP};; cv::<br>utils::trace::details::Region __region_751(__cv_trace_location_region751<br>);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="752"><td class="num" id="LN752">752</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="753"><td class="num" id="LN753">753</td><td class="line">        <span class='keyword'>if</span>(!m_ok)</td></tr>
<tr class="codeline" data-linenumber="754"><td class="num" id="LN754">754</td><td class="line">            <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="755"><td class="num" id="LN755">755</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="756"><td class="num" id="LN756">756</td><td class="line">        ipp_calcHistParallelTLS *pTls = m_tls.get();</td></tr>
<tr class="codeline" data-linenumber="757"><td class="num" id="LN757">757</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="758"><td class="num" id="LN758">758</td><td class="line">        IppiSize roi = {m_src.cols, range.end - range.start };</td></tr>
<tr class="codeline" data-linenumber="759"><td class="num" id="LN759">759</td><td class="line">        <span class='keyword'>bool</span>     mtLoop = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="760"><td class="num" id="LN760">760</td><td class="line">        <span class='keyword'>if</span>(m_fullRoi.height != roi.height)</td></tr>
<tr class="codeline" data-linenumber="761"><td class="num" id="LN761">761</td><td class="line">            mtLoop = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="762"><td class="num" id="LN762">762</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="763"><td class="num" id="LN763">763</td><td class="line">        <span class='keyword'>if</span>(!pTls-&gt;spec)</td></tr>
<tr class="codeline" data-linenumber="764"><td class="num" id="LN764">764</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="765"><td class="num" id="LN765">765</td><td class="line">            pTls-&gt;spec.allocate(m_specSize);</td></tr>
<tr class="codeline" data-linenumber="766"><td class="num" id="LN766">766</td><td class="line">            <span class='keyword'>if</span>(!pTls-&gt;spec.get())</td></tr>
<tr class="codeline" data-linenumber="767"><td class="num" id="LN767">767</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="768"><td class="num" id="LN768">768</td><td class="line">                m_ok = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="769"><td class="num" id="LN769">769</td><td class="line">                <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="770"><td class="num" id="LN770">770</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="771"><td class="num" id="LN771">771</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="772"><td class="num" id="LN772">772</td><td class="line">            pTls-&gt;buffer.allocate(m_bufferSize);</td></tr>
<tr class="codeline" data-linenumber="773"><td class="num" id="LN773">773</td><td class="line">            <span class='keyword'>if</span>(!pTls-&gt;buffer.get() &amp;&amp; m_bufferSize)</td></tr>
<tr class="codeline" data-linenumber="774"><td class="num" id="LN774">774</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="775"><td class="num" id="LN775">775</td><td class="line">                m_ok = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="776"><td class="num" id="LN776">776</td><td class="line">                <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="777"><td class="num" id="LN777">777</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="778"><td class="num" id="LN778">778</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="779"><td class="num" id="LN779">779</td><td class="line">            <span class='keyword'>if</span>(m_uniform)</td></tr>
<tr class="codeline" data-linenumber="780"><td class="num" id="LN780">780</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="781"><td class="num" id="LN781">781</td><td class="line">                <span class='keyword'>if</span>(<span class='macro'>ippiHistogramUniformInit<span class='macro_popup'>ippicviHistogramUniformInit</span></span>(m_type, (Ipp32f*)&amp;m_ranges[0], (Ipp32f*)&amp;m_ranges[1], (Ipp32s*)&amp;m_levelsNum, 1, pTls-&gt;spec) &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="782"><td class="num" id="LN782">782</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="783"><td class="num" id="LN783">783</td><td class="line">                    m_ok = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="784"><td class="num" id="LN784">784</td><td class="line">                    <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="785"><td class="num" id="LN785">785</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="786"><td class="num" id="LN786">786</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="787"><td class="num" id="LN787">787</td><td class="line">            <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="788"><td class="num" id="LN788">788</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="789"><td class="num" id="LN789">789</td><td class="line">                <span class='keyword'>if</span>(<span class='macro'>ippiHistogramInit<span class='macro_popup'>ippicviHistogramInit</span></span>(m_type, (<span class='keyword'>const</span> Ipp32f**)&amp;m_ranges, (Ipp32s*)&amp;m_levelsNum, 1, pTls-&gt;spec) &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="790"><td class="num" id="LN790">790</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="791"><td class="num" id="LN791">791</td><td class="line">                    m_ok = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="792"><td class="num" id="LN792">792</td><td class="line">                    <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="793"><td class="num" id="LN793">793</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="794"><td class="num" id="LN794">794</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="795"><td class="num" id="LN795">795</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="796"><td class="num" id="LN796">796</td><td class="line">            pTls-&gt;thist.allocate(m_histSize*<span class='keyword'>sizeof</span>(Ipp32u));</td></tr>
<tr class="codeline" data-linenumber="797"><td class="num" id="LN797">797</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="798"><td class="num" id="LN798">798</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="799"><td class="num" id="LN799">799</td><td class="line">        <span class='keyword'>if</span>(<span class='macro'>CV_INSTRUMENT_FUN_IPP(ippiHistogram_C1, m_src.ptr(range.start), (<span class='keyword'>int</span>)m_src.step, roi, pTls-&gt;thist, pTls-&gt;spec, pTls-&gt;buffer)<span class='macro_popup'>((ippiHistogram_C1)(m_src.ptr(range.start), (int)m_src.step, roi<br>, pTls-&gt;thist, pTls-&gt;spec, pTls-&gt;buffer))</span></span> &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="800"><td class="num" id="LN800">800</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="801"><td class="num" id="LN801">801</td><td class="line">            m_ok = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="802"><td class="num" id="LN802">802</td><td class="line">            <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="803"><td class="num" id="LN803">803</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="804"><td class="num" id="LN804">804</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="805"><td class="num" id="LN805">805</td><td class="line">        <span class='keyword'>if</span>(mtLoop)</td></tr>
<tr class="codeline" data-linenumber="806"><td class="num" id="LN806">806</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="807"><td class="num" id="LN807">807</td><td class="line">            <span class='keyword'>for</span>(<span class='keyword'>int</span> i = 0; i &lt; m_histSize; i++)</td></tr>
<tr class="codeline" data-linenumber="808"><td class="num" id="LN808">808</td><td class="line">                <span class='macro'>CV_XADD((<span class='keyword'>int</span>*)(m_hist.ptr(i)), *(<span class='keyword'>int</span>*)((Ipp32u*)pTls-&gt;thist + i))<span class='macro_popup'>__c11_atomic_fetch_add((_Atomic(int)*)((int*)(m_hist.ptr(i)))<br>, *(int*)((Ipp32u*)pTls-&gt;thist + i), 4)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="809"><td class="num" id="LN809">809</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="810"><td class="num" id="LN810">810</td><td class="line">        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="811"><td class="num" id="LN811">811</td><td class="line">            <span class='macro'>ippiCopy_32s_C1R<span class='macro_popup'>ippicviCopy_32s_C1R</span></span>((Ipp32s*)pTls-&gt;thist.get(), <span class='keyword'>sizeof</span>(Ipp32u), (Ipp32s*)m_hist.ptr(), (<span class='keyword'>int</span>)m_hist.step, ippiSize(1, m_histSize));</td></tr>
<tr class="codeline" data-linenumber="812"><td class="num" id="LN812">812</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="813"><td class="num" id="LN813">813</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="814"><td class="num" id="LN814">814</td><td class="line"><span class='keyword'>private</span>:</td></tr>
<tr class="codeline" data-linenumber="815"><td class="num" id="LN815">815</td><td class="line">    <span class='keyword'>const</span> Mat      &amp;m_src;</td></tr>
<tr class="codeline" data-linenumber="816"><td class="num" id="LN816">816</td><td class="line">    Mat            &amp;m_hist;</td></tr>
<tr class="codeline" data-linenumber="817"><td class="num" id="LN817">817</td><td class="line">    Ipp32s          m_histSize;</td></tr>
<tr class="codeline" data-linenumber="818"><td class="num" id="LN818">818</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>float</span>    *m_ranges;</td></tr>
<tr class="codeline" data-linenumber="819"><td class="num" id="LN819">819</td><td class="line">    <span class='keyword'>bool</span>            m_uniform;</td></tr>
<tr class="codeline" data-linenumber="820"><td class="num" id="LN820">820</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="821"><td class="num" id="LN821">821</td><td class="line">    IppiHistogram_C1    ippiHistogram_C1;</td></tr>
<tr class="codeline" data-linenumber="822"><td class="num" id="LN822">822</td><td class="line">    IppiSize            m_fullRoi;</td></tr>
<tr class="codeline" data-linenumber="823"><td class="num" id="LN823">823</td><td class="line">    IppDataType         m_type;</td></tr>
<tr class="codeline" data-linenumber="824"><td class="num" id="LN824">824</td><td class="line">    Ipp32s              m_levelsNum;</td></tr>
<tr class="codeline" data-linenumber="825"><td class="num" id="LN825">825</td><td class="line">    <span class='keyword'>int</span>                 m_bufferSize;</td></tr>
<tr class="codeline" data-linenumber="826"><td class="num" id="LN826">826</td><td class="line">    <span class='keyword'>int</span>                 m_specSize;</td></tr>
<tr class="codeline" data-linenumber="827"><td class="num" id="LN827">827</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="828"><td class="num" id="LN828">828</td><td class="line">    <span class='keyword'>mutable</span> Mutex                    m_syncMutex;</td></tr>
<tr class="codeline" data-linenumber="829"><td class="num" id="LN829">829</td><td class="line">    TLSData&lt;ipp_calcHistParallelTLS&gt; m_tls;</td></tr>
<tr class="codeline" data-linenumber="830"><td class="num" id="LN830">830</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="831"><td class="num" id="LN831">831</td><td class="line">    <span class='keyword'>volatile</span> <span class='keyword'>bool</span> &amp;m_ok;</td></tr>
<tr class="codeline" data-linenumber="832"><td class="num" id="LN832">832</td><td class="line">    <span class='keyword'>const</span> ipp_calcHistParallel &amp; <span class='keyword'>operator</span> = (<span class='keyword'>const</span> ipp_calcHistParallel &amp; );</td></tr>
<tr class="codeline" data-linenumber="833"><td class="num" id="LN833">833</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="834"><td class="num" id="LN834">834</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="835"><td class="num" id="LN835">835</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="836"><td class="num" id="LN836">836</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="837"><td class="num" id="LN837">837</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="838"><td class="num" id="LN838">838</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="839"><td class="num" id="LN839">839</td><td class="line"><span class='directive'>#ifdef HAVE_OPENVX</span></td></tr>
<tr class="codeline" data-linenumber="840"><td class="num" id="LN840">840</td><td class="line"><span class='keyword'>namespace</span> cv</td></tr>
<tr class="codeline" data-linenumber="841"><td class="num" id="LN841">841</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="842"><td class="num" id="LN842">842</td><td class="line">    <span class='keyword'>namespace</span> ovx {</td></tr>
<tr class="codeline" data-linenumber="843"><td class="num" id="LN843">843</td><td class="line">        <span class='keyword'>template</span> &lt;&gt; <span class='keyword'>inline</span> <span class='keyword'>bool</span> skipSmallImages&lt;VX_KERNEL_HISTOGRAM&gt;(<span class='keyword'>int</span> w, <span class='keyword'>int</span> h) { <span class='keyword'>return</span> w*h &lt; 2048 * 1536; }</td></tr>
<tr class="codeline" data-linenumber="844"><td class="num" id="LN844">844</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="845"><td class="num" id="LN845">845</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>bool</span> openvx_calchist(<span class='keyword'>const</span> Mat&amp; image, OutputArray _hist, <span class='keyword'>const</span> <span class='keyword'>int</span> histSize,</td></tr>
<tr class="codeline" data-linenumber="846"><td class="num" id="LN846">846</td><td class="line">        <span class='keyword'>const</span> <span class='keyword'>float</span>* _range)</td></tr>
<tr class="codeline" data-linenumber="847"><td class="num" id="LN847">847</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="848"><td class="num" id="LN848">848</td><td class="line">        vx_int32 offset = (vx_int32)(_range[0]);</td></tr>
<tr class="codeline" data-linenumber="849"><td class="num" id="LN849">849</td><td class="line">        vx_uint32 range = (vx_uint32)(_range[1] - _range[0]);</td></tr>
<tr class="codeline" data-linenumber="850"><td class="num" id="LN850">850</td><td class="line">        <span class='keyword'>if</span> (<span class='keyword'>float</span>(offset) != _range[0] || <span class='keyword'>float</span>(range) != (_range[1] - _range[0]))</td></tr>
<tr class="codeline" data-linenumber="851"><td class="num" id="LN851">851</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="852"><td class="num" id="LN852">852</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="853"><td class="num" id="LN853">853</td><td class="line">        size_t total_size = image.total();</td></tr>
<tr class="codeline" data-linenumber="854"><td class="num" id="LN854">854</td><td class="line">        <span class='keyword'>int</span> rows = image.dims &gt; 1 ? image.size[0] : 1, cols = rows ? (<span class='keyword'>int</span>)(total_size / rows) : 0;</td></tr>
<tr class="codeline" data-linenumber="855"><td class="num" id="LN855">855</td><td class="line">        <span class='keyword'>if</span> (image.dims &gt; 2 &amp;&amp; !(image.isContinuous() &amp;&amp; cols &gt; 0 &amp;&amp; (size_t)rows*cols == total_size))</td></tr>
<tr class="codeline" data-linenumber="856"><td class="num" id="LN856">856</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="857"><td class="num" id="LN857">857</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="858"><td class="num" id="LN858">858</td><td class="line">        <span class='keyword'>try</span></td></tr>
<tr class="codeline" data-linenumber="859"><td class="num" id="LN859">859</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="860"><td class="num" id="LN860">860</td><td class="line">            ivx::Context ctx = ovx::getOpenVXContext();</td></tr>
<tr class="codeline" data-linenumber="861"><td class="num" id="LN861">861</td><td class="line"><span class='directive'>#if VX_VERSION &lt;= VX_VERSION_1_0</span></td></tr>
<tr class="codeline" data-linenumber="862"><td class="num" id="LN862">862</td><td class="line">            <span class='keyword'>if</span> (ctx.vendorID() == VX_ID_KHRONOS &amp;&amp; (range % histSize))</td></tr>
<tr class="codeline" data-linenumber="863"><td class="num" id="LN863">863</td><td class="line">                <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="864"><td class="num" id="LN864">864</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="865"><td class="num" id="LN865">865</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="866"><td class="num" id="LN866">866</td><td class="line">            ivx::Image</td></tr>
<tr class="codeline" data-linenumber="867"><td class="num" id="LN867">867</td><td class="line">                img = ivx::Image::createFromHandle(ctx, VX_DF_IMAGE_U8,</td></tr>
<tr class="codeline" data-linenumber="868"><td class="num" id="LN868">868</td><td class="line">                    ivx::Image::createAddressing(cols, rows, 1, (vx_int32)(image.step[0])), image.data);</td></tr>
<tr class="codeline" data-linenumber="869"><td class="num" id="LN869">869</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="870"><td class="num" id="LN870">870</td><td class="line">            ivx::Distribution vxHist = ivx::Distribution::create(ctx, histSize, offset, range);</td></tr>
<tr class="codeline" data-linenumber="871"><td class="num" id="LN871">871</td><td class="line">            ivx::IVX_CHECK_STATUS(vxuHistogram(ctx, img, vxHist));</td></tr>
<tr class="codeline" data-linenumber="872"><td class="num" id="LN872">872</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="873"><td class="num" id="LN873">873</td><td class="line">            _hist.create(1, &amp;histSize, <span class='macro'>CV_32F<span class='macro_popup'>5</span></span>);</td></tr>
<tr class="codeline" data-linenumber="874"><td class="num" id="LN874">874</td><td class="line">            Mat hist = _hist.getMat(), ihist = hist;</td></tr>
<tr class="codeline" data-linenumber="875"><td class="num" id="LN875">875</td><td class="line">            ihist.flags = (ihist.flags &amp; ~<span class='macro'>CV_MAT_TYPE_MASK<span class='macro_popup'>((1 &lt;&lt; 3)*512 - 1)</span></span>) | <span class='macro'>CV_32S<span class='macro_popup'>4</span></span>;</td></tr>
<tr class="codeline" data-linenumber="876"><td class="num" id="LN876">876</td><td class="line">            vxHist.copyTo(ihist);</td></tr>
<tr class="codeline" data-linenumber="877"><td class="num" id="LN877">877</td><td class="line">            ihist.convertTo(hist, <span class='macro'>CV_32F<span class='macro_popup'>5</span></span>);</td></tr>
<tr class="codeline" data-linenumber="878"><td class="num" id="LN878">878</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="879"><td class="num" id="LN879">879</td><td class="line"><span class='directive'>#ifdef VX_VERSION_1_1</span></td></tr>
<tr class="codeline" data-linenumber="880"><td class="num" id="LN880">880</td><td class="line">            img.swapHandle();</td></tr>
<tr class="codeline" data-linenumber="881"><td class="num" id="LN881">881</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="882"><td class="num" id="LN882">882</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="883"><td class="num" id="LN883">883</td><td class="line">        <span class='keyword'>catch</span> (<span class='keyword'>const</span> ivx::RuntimeError &amp; e)</td></tr>
<tr class="codeline" data-linenumber="884"><td class="num" id="LN884">884</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="885"><td class="num" id="LN885">885</td><td class="line">            <span class='macro'>VX_DbgThrow(e.what())<span class='macro_popup'>return false</span></span>;</td></tr>
<tr class="codeline" data-linenumber="886"><td class="num" id="LN886">886</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="887"><td class="num" id="LN887">887</td><td class="line">        <span class='keyword'>catch</span> (<span class='keyword'>const</span> ivx::WrapperError &amp; e)</td></tr>
<tr class="codeline" data-linenumber="888"><td class="num" id="LN888">888</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="889"><td class="num" id="LN889">889</td><td class="line">            <span class='macro'>VX_DbgThrow(e.what())<span class='macro_popup'>return false</span></span>;</td></tr>
<tr class="codeline" data-linenumber="890"><td class="num" id="LN890">890</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="891"><td class="num" id="LN891">891</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="892"><td class="num" id="LN892">892</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="893"><td class="num" id="LN893">893</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="894"><td class="num" id="LN894">894</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="895"><td class="num" id="LN895">895</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="896"><td class="num" id="LN896">896</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="897"><td class="num" id="LN897">897</td><td class="line"><span class='directive'>#ifdef HAVE_IPP</span></td></tr>
<tr class="codeline" data-linenumber="898"><td class="num" id="LN898">898</td><td class="line"><span class='directive'>#define <span class='macro'>IPP_HISTOGRAM_PARALLEL<span class='macro_popup'>1</span></span> 1</span></td></tr>
<tr class="codeline" data-linenumber="899"><td class="num" id="LN899">899</td><td class="line"><span class='keyword'>namespace</span> cv</td></tr>
<tr class="codeline" data-linenumber="900"><td class="num" id="LN900">900</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="901"><td class="num" id="LN901">901</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>bool</span> ipp_calchist(<span class='keyword'>const</span> Mat &amp;image, Mat &amp;hist, <span class='keyword'>int</span> histSize, <span class='keyword'>const</span> <span class='keyword'>float</span>** ranges, <span class='keyword'>bool</span> uniform, <span class='keyword'>bool</span> accumulate)</td></tr>
<tr class="codeline" data-linenumber="902"><td class="num" id="LN902">902</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="903"><td class="num" id="LN903">903</td><td class="line">    <span class='macro'>CV_INSTRUMENT_REGION_IPP()<span class='macro_popup'>; static cv::utils::trace::details::Region::LocationExtraData<br>* __cv_trace_location_extra_region903 = 0; static const cv::utils<br>::trace::details::Region::LocationStaticStorage __cv_trace_location_region903<br> = { &amp;(__cv_trace_location_extra_region903), "IPP", "/home/zhh/projects/opencv-4.5.2/modules/imgproc/src/histogram.cpp"<br>, 903, cv::utils::trace::details::REGION_FLAG_IMPL_IPP};; cv::<br>utils::trace::details::Region __region_903(__cv_trace_location_region903<br>);</span></span>;</td></tr>
<tr class="codeline" data-linenumber="904"><td class="num" id="LN904">904</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="905"><td class="num" id="LN905">905</td><td class="line"><span class='directive'>#if <span class='macro'>IPP_VERSION_X100<span class='macro_popup'>(2020 * 100 + 0*10 + 0)</span></span> &lt; 201801</span></td></tr>
<tr class="codeline" data-linenumber="906"><td class="num" id="LN906">906</td><td class="line">    <span class='comment'>// No SSE42 optimization for uniform 32f</span></td></tr>
<tr class="codeline" data-linenumber="907"><td class="num" id="LN907">907</td><td class="line">    <span class='keyword'>if</span>(uniform &amp;&amp; image.depth() == <span class='macro'>CV_32F<span class='macro_popup'>5</span></span> &amp;&amp; cv::ipp::getIppTopFeatures() == <span class='macro'>ippCPUID_SSE42<span class='macro_popup'>0x00000080</span></span>)</td></tr>
<tr class="codeline" data-linenumber="908"><td class="num" id="LN908">908</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="909"><td class="num" id="LN909">909</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="910"><td class="num" id="LN910">910</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="911"><td class="num" id="LN911">911</td><td class="line">    <span class='comment'>// IPP_DISABLE_HISTOGRAM - https://github.com/opencv/opencv/issues/11544</span></td></tr>
<tr class="codeline" data-linenumber="912"><td class="num" id="LN912">912</td><td class="line">    <span class='keyword'>if</span> (uniform &amp;&amp; (ranges[0][1] - ranges[0][0]) != histSize)</td></tr>
<tr class="codeline" data-linenumber="913"><td class="num" id="LN913">913</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="914"><td class="num" id="LN914">914</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="915"><td class="num" id="LN915">915</td><td class="line">    Mat ihist = hist;</td></tr>
<tr class="codeline" data-linenumber="916"><td class="num" id="LN916">916</td><td class="line">    <span class='keyword'>if</span>(accumulate)</td></tr>
<tr class="codeline" data-linenumber="917"><td class="num" id="LN917">917</td><td class="line">        ihist.create(1, &amp;histSize, <span class='macro'>CV_32S<span class='macro_popup'>4</span></span>);</td></tr>
<tr class="codeline" data-linenumber="918"><td class="num" id="LN918">918</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="919"><td class="num" id="LN919">919</td><td class="line">    <span class='keyword'>bool</span>  ok      = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="920"><td class="num" id="LN920">920</td><td class="line">    <span class='keyword'>int</span>   threads = ippiSuggestThreadsNum(image, (1+((<span class='keyword'>double</span>)ihist.total()/image.total()))*2);</td></tr>
<tr class="codeline" data-linenumber="921"><td class="num" id="LN921">921</td><td class="line">    Range range(0, image.rows);</td></tr>
<tr class="codeline" data-linenumber="922"><td class="num" id="LN922">922</td><td class="line">    ipp_calcHistParallel invoker(image, ihist, histSize, ranges[0], uniform, ok);</td></tr>
<tr class="codeline" data-linenumber="923"><td class="num" id="LN923">923</td><td class="line">    <span class='keyword'>if</span>(!ok)</td></tr>
<tr class="codeline" data-linenumber="924"><td class="num" id="LN924">924</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="925"><td class="num" id="LN925">925</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="926"><td class="num" id="LN926">926</td><td class="line">    <span class='keyword'>if</span>(<span class='macro'>IPP_HISTOGRAM_PARALLEL<span class='macro_popup'>1</span></span> &amp;&amp; threads &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="927"><td class="num" id="LN927">927</td><td class="line">        parallel_for_(range, invoker, threads*2);</td></tr>
<tr class="codeline" data-linenumber="928"><td class="num" id="LN928">928</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="929"><td class="num" id="LN929">929</td><td class="line">        invoker(range);</td></tr>
<tr class="codeline" data-linenumber="930"><td class="num" id="LN930">930</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="931"><td class="num" id="LN931">931</td><td class="line">    <span class='keyword'>if</span>(ok)</td></tr>
<tr class="codeline" data-linenumber="932"><td class="num" id="LN932">932</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="933"><td class="num" id="LN933">933</td><td class="line">        <span class='keyword'>if</span>(accumulate)</td></tr>
<tr class="codeline" data-linenumber="934"><td class="num" id="LN934">934</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="935"><td class="num" id="LN935">935</td><td class="line">            IppiSize histRoi = ippiSize(1, histSize);</td></tr>
<tr class="codeline" data-linenumber="936"><td class="num" id="LN936">936</td><td class="line">            IppAutoBuffer&lt;Ipp32f&gt; fhist(histSize*<span class='keyword'>sizeof</span>(Ipp32f));</td></tr>
<tr class="codeline" data-linenumber="937"><td class="num" id="LN937">937</td><td class="line">            <span class='macro'>CV_INSTRUMENT_FUN_IPP(ippiConvert_32s32f_C1R, (Ipp32s*)ihist.ptr(), (<span class='keyword'>int</span>)ihist.step, (Ipp32f*)fhist, <span class='keyword'>sizeof</span>(Ipp32f), histRoi)<span class='macro_popup'>((ippicviConvert_32s32f_C1R)((Ipp32s*)ihist.ptr(), (int)ihist<br>.step, (Ipp32f*)fhist, sizeof(Ipp32f), histRoi))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="938"><td class="num" id="LN938">938</td><td class="line">            <span class='macro'>CV_INSTRUMENT_FUN_IPP(ippiAdd_32f_C1IR, (Ipp32f*)fhist, <span class='keyword'>sizeof</span>(Ipp32f), (Ipp32f*)hist.ptr(), (<span class='keyword'>int</span>)hist.step, histRoi)<span class='macro_popup'>((ippicviAdd_32f_C1IR)((Ipp32f*)fhist, sizeof(Ipp32f), (Ipp32f<br>*)hist.ptr(), (int)hist.step, histRoi))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="939"><td class="num" id="LN939">939</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="940"><td class="num" id="LN940">940</td><td class="line">        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="941"><td class="num" id="LN941">941</td><td class="line">            <span class='macro'>CV_INSTRUMENT_FUN_IPP(ippiConvert_32s32f_C1R, (Ipp32s*)ihist.ptr(), (<span class='keyword'>int</span>)ihist.step, (Ipp32f*)hist.ptr(), (<span class='keyword'>int</span>)hist.step, ippiSize(1, histSize))<span class='macro_popup'>((ippicviConvert_32s32f_C1R)((Ipp32s*)ihist.ptr(), (int)ihist<br>.step, (Ipp32f*)hist.ptr(), (int)hist.step, ippiSize(1, histSize<br>)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="942"><td class="num" id="LN942">942</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="943"><td class="num" id="LN943">943</td><td class="line">    <span class='keyword'>return</span> ok;</td></tr>
<tr class="codeline" data-linenumber="944"><td class="num" id="LN944">944</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="945"><td class="num" id="LN945">945</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="946"><td class="num" id="LN946">946</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="947"><td class="num" id="LN947">947</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="948"><td class="num" id="LN948">948</td><td class="line"><span class='keyword'>void</span> cv::calcHist( <span class='keyword'>const</span> Mat* images, <span class='keyword'>int</span> nimages, <span class='keyword'>const</span> <span class='keyword'>int</span>* channels,</td></tr>
<tr class="codeline" data-linenumber="949"><td class="num" id="LN949">949</td><td class="line">                   InputArray _mask, OutputArray _hist, <span class='keyword'>int</span> dims, <span class='keyword'>const</span> <span class='keyword'>int</span>* histSize,</td></tr>
<tr class="codeline" data-linenumber="950"><td class="num" id="LN950">950</td><td class="line">                   <span class='keyword'>const</span> <span class='keyword'>float</span>** ranges, <span class='keyword'>bool</span> uniform, <span class='keyword'>bool</span> accumulate )</td></tr>
<tr class="codeline" data-linenumber="951"><td class="num" id="LN951">951</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="952"><td class="num" id="LN952">952</td><td class="line">    <span class='macro'>CV_INSTRUMENT_REGION()<span class='macro_popup'>; static cv::utils::trace::details::Region::LocationExtraData<br>* __cv_trace_location_extra_fn952 = 0; static const cv::utils<br>::trace::details::Region::LocationStaticStorage __cv_trace_location_fn952<br> = { &amp;(__cv_trace_location_extra_fn952), __PRETTY_FUNCTION__<br>, "/home/zhh/projects/opencv-4.5.2/modules/imgproc/src/histogram.cpp"<br>, 952, ((0) | cv::utils::trace::details::REGION_FLAG_FUNCTION<br>)};; const cv::utils::trace::details::Region __region_fn(__cv_trace_location_fn952<br>);;</span></span>;</td></tr>
<tr class="codeline" data-linenumber="953"><td class="num" id="LN953">953</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="954"><td class="num" id="LN954">954</td><td class="line">    <span class='macro'>CV_Assert(images &amp;&amp; nimages &gt; 0)<span class='macro_popup'>do { if (!(images &amp;&amp; nimages &gt; 0)) abort(); } while<br> (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="955"><td class="num" id="LN955">955</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="956"><td class="num" id="LN956">956</td><td class="line">    CV_OVX_RUN(</td></tr>
<tr class="codeline" data-linenumber="957"><td class="num" id="LN957">957</td><td class="line">        images &amp;&amp; histSize &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="958"><td class="num" id="LN958">958</td><td class="line">        nimages == 1 &amp;&amp; images[0].type() == CV_8UC1 &amp;&amp; dims == 1 &amp;&amp; _mask.getMat().empty() &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="959"><td class="num" id="LN959">959</td><td class="line">        (!channels || channels[0] == 0) &amp;&amp; !accumulate &amp;&amp; uniform &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="960"><td class="num" id="LN960">960</td><td class="line">        ranges &amp;&amp; ranges[0] &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="961"><td class="num" id="LN961">961</td><td class="line">        !ovx::skipSmallImages&lt;VX_KERNEL_HISTOGRAM&gt;(images[0].cols, images[0].rows),</td></tr>
<tr class="codeline" data-linenumber="962"><td class="num" id="LN962">962</td><td class="line">        openvx_calchist(images[0], _hist, histSize[0], ranges[0]))</td></tr>
<tr class="codeline" data-linenumber="963"><td class="num" id="LN963">963</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="964"><td class="num" id="LN964">964</td><td class="line">    Mat mask = _mask.getMat();</td></tr>
<tr class="codeline" data-linenumber="965"><td class="num" id="LN965">965</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="966"><td class="num" id="LN966">966</td><td class="line">    <span class='macro'>CV_Assert(dims &gt; 0 &amp;&amp; histSize)<span class='macro_popup'>do { if (!(dims &gt; 0 &amp;&amp; histSize)) abort(); } while<br> (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="967"><td class="num" id="LN967">967</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="968"><td class="num" id="LN968">968</td><td class="line">    <span class='keyword'>const</span> uchar* <span class='keyword'>const</span> histdata = _hist.getMat().ptr();</td></tr>
<tr class="codeline" data-linenumber="969"><td class="num" id="LN969">969</td><td class="line">    _hist.create(dims, histSize, <span class='macro'>CV_32F<span class='macro_popup'>5</span></span>);</td></tr>
<tr class="codeline" data-linenumber="970"><td class="num" id="LN970">970</td><td class="line">    Mat hist = _hist.getMat();</td></tr>
<tr class="codeline" data-linenumber="971"><td class="num" id="LN971">971</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="972"><td class="num" id="LN972">972</td><td class="line">    <span class='keyword'>if</span>(histdata != hist.data)</td></tr>
<tr class="codeline" data-linenumber="973"><td class="num" id="LN973">973</td><td class="line">        accumulate = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="974"><td class="num" id="LN974">974</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="975"><td class="num" id="LN975">975</td><td class="line">    <span class='macro'>CV_IPP_RUN(<span class='macro_popup'>if (cv::ipp::useIPP() &amp;&amp; ((nimages == 1 &amp;&amp; dims<br> == 1 &amp;&amp; channels &amp;&amp; channels[0] == 0 &amp;&amp;<br> _mask.empty() &amp;&amp; images[0].dims &lt;= 2 &amp;&amp; ranges<br> &amp;&amp; ranges[0]))) { static cv::utils::trace::details::<br>Region::LocationExtraData* __cv_trace_location_extra_region978<br> = 0; static const cv::utils::trace::details::Region::LocationStaticStorage<br> __cv_trace_location_region978 = { &amp;(__cv_trace_location_extra_region978<br>), "IPP:" "(ipp_calchist(images[0], hist, histSize[0], ranges, uniform, accumulate))"<br>, "/home/zhh/projects/opencv-4.5.2/modules/imgproc/src/histogram.cpp"<br>, 978, cv::utils::trace::details::REGION_FLAG_IMPL_IPP};; cv::<br>utils::trace::details::Region __region_978(__cv_trace_location_region978<br>); if((ipp_calchist(images[0], hist, histSize[0], ranges, uniform<br>, accumulate))) { ; return ; } }</span></span></td></tr>
<tr class="codeline" data-linenumber="976"><td class="num" id="LN976">976</td><td class="line">        <span class='macro'>nimages == 1 &amp;&amp; dims == 1 &amp;&amp; channels &amp;&amp; channels[0] == 0<span class='macro_popup'>if (cv::ipp::useIPP() &amp;&amp; ((nimages == 1 &amp;&amp; dims<br> == 1 &amp;&amp; channels &amp;&amp; channels[0] == 0 &amp;&amp;<br> _mask.empty() &amp;&amp; images[0].dims &lt;= 2 &amp;&amp; ranges<br> &amp;&amp; ranges[0]))) { static cv::utils::trace::details::<br>Region::LocationExtraData* __cv_trace_location_extra_region978<br> = 0; static const cv::utils::trace::details::Region::LocationStaticStorage<br> __cv_trace_location_region978 = { &amp;(__cv_trace_location_extra_region978<br>), "IPP:" "(ipp_calchist(images[0], hist, histSize[0], ranges, uniform, accumulate))"<br>, "/home/zhh/projects/opencv-4.5.2/modules/imgproc/src/histogram.cpp"<br>, 978, cv::utils::trace::details::REGION_FLAG_IMPL_IPP};; cv::<br>utils::trace::details::Region __region_978(__cv_trace_location_region978<br>); if((ipp_calchist(images[0], hist, histSize[0], ranges, uniform<br>, accumulate))) { ; return ; } }</span></span></td></tr>
<tr class="codeline" data-linenumber="977"><td class="num" id="LN977">977</td><td class="line">            <span class='macro'>&amp;&amp; _mask.empty() &amp;&amp; images[0].dims &lt;= 2 &amp;&amp; ranges &amp;&amp; ranges[0],<span class='macro_popup'>if (cv::ipp::useIPP() &amp;&amp; ((nimages == 1 &amp;&amp; dims<br> == 1 &amp;&amp; channels &amp;&amp; channels[0] == 0 &amp;&amp;<br> _mask.empty() &amp;&amp; images[0].dims &lt;= 2 &amp;&amp; ranges<br> &amp;&amp; ranges[0]))) { static cv::utils::trace::details::<br>Region::LocationExtraData* __cv_trace_location_extra_region978<br> = 0; static const cv::utils::trace::details::Region::LocationStaticStorage<br> __cv_trace_location_region978 = { &amp;(__cv_trace_location_extra_region978<br>), "IPP:" "(ipp_calchist(images[0], hist, histSize[0], ranges, uniform, accumulate))"<br>, "/home/zhh/projects/opencv-4.5.2/modules/imgproc/src/histogram.cpp"<br>, 978, cv::utils::trace::details::REGION_FLAG_IMPL_IPP};; cv::<br>utils::trace::details::Region __region_978(__cv_trace_location_region978<br>); if((ipp_calchist(images[0], hist, histSize[0], ranges, uniform<br>, accumulate))) { ; return ; } }</span></span></td></tr>
<tr class="codeline" data-linenumber="978"><td class="num" id="LN978">978</td><td class="line">        <span class='macro'>ipp_calchist(images[0], hist, histSize[0], ranges, uniform, accumulate))<span class='macro_popup'>if (cv::ipp::useIPP() &amp;&amp; ((nimages == 1 &amp;&amp; dims<br> == 1 &amp;&amp; channels &amp;&amp; channels[0] == 0 &amp;&amp;<br> _mask.empty() &amp;&amp; images[0].dims &lt;= 2 &amp;&amp; ranges<br> &amp;&amp; ranges[0]))) { static cv::utils::trace::details::<br>Region::LocationExtraData* __cv_trace_location_extra_region978<br> = 0; static const cv::utils::trace::details::Region::LocationStaticStorage<br> __cv_trace_location_region978 = { &amp;(__cv_trace_location_extra_region978<br>), "IPP:" "(ipp_calchist(images[0], hist, histSize[0], ranges, uniform, accumulate))"<br>, "/home/zhh/projects/opencv-4.5.2/modules/imgproc/src/histogram.cpp"<br>, 978, cv::utils::trace::details::REGION_FLAG_IMPL_IPP};; cv::<br>utils::trace::details::Region __region_978(__cv_trace_location_region978<br>); if((ipp_calchist(images[0], hist, histSize[0], ranges, uniform<br>, accumulate))) { ; return ; } }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="979"><td class="num" id="LN979">979</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="980"><td class="num" id="LN980">980</td><td class="line">    Mat ihist = hist;</td></tr>
<tr class="codeline" data-linenumber="981"><td class="num" id="LN981">981</td><td class="line">    ihist.flags = (ihist.flags &amp; ~<span class='macro'>CV_MAT_TYPE_MASK<span class='macro_popup'>((1 &lt;&lt; 3)*512 - 1)</span></span>)|<span class='macro'>CV_32S<span class='macro_popup'>4</span></span>;</td></tr>
<tr class="codeline" data-linenumber="982"><td class="num" id="LN982">982</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="983"><td class="num" id="LN983">983</td><td class="line">    <span class='keyword'>if</span>(!accumulate)</td></tr>
<tr class="codeline" data-linenumber="984"><td class="num" id="LN984">984</td><td class="line">        hist = Scalar(0.);</td></tr>
<tr class="codeline" data-linenumber="985"><td class="num" id="LN985">985</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="986"><td class="num" id="LN986">986</td><td class="line">        hist.convertTo(ihist, <span class='macro'>CV_32S<span class='macro_popup'>4</span></span>);</td></tr>
<tr class="codeline" data-linenumber="987"><td class="num" id="LN987">987</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="988"><td class="num" id="LN988">988</td><td class="line">    std::vector&lt;uchar*&gt; ptrs;</td></tr>
<tr class="codeline" data-linenumber="989"><td class="num" id="LN989">989</td><td class="line">    std::vector&lt;<span class='keyword'>int</span>&gt; deltas;</td></tr>
<tr class="codeline" data-linenumber="990"><td class="num" id="LN990">990</td><td class="line">    std::vector&lt;<span class='keyword'>double</span>&gt; uniranges;</td></tr>
<tr class="codeline" data-linenumber="991"><td class="num" id="LN991">991</td><td class="line">    Size imsize;</td></tr>
<tr class="codeline" data-linenumber="992"><td class="num" id="LN992">992</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="993"><td class="num" id="LN993">993</td><td class="line">    <span class='macro'>CV_Assert( mask.empty() || mask.type() == CV_8UC1 )<span class='macro_popup'>do { if (!(mask.empty() || mask.type() == (((0) &amp; ((1 &lt;&lt;<br> 3) - 1)) + (((1)-1) &lt;&lt; 3)))) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="994"><td class="num" id="LN994">994</td><td class="line">    histPrepareImages( images, nimages, channels, mask, dims, hist.size, ranges,</td></tr>
<tr class="codeline" data-linenumber="995"><td class="num" id="LN995">995</td><td class="line">                       uniform, ptrs, deltas, imsize, uniranges );</td></tr>
<tr class="codeline" data-linenumber="996"><td class="num" id="LN996">996</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>double</span>* _uniranges = uniform ? &amp;uniranges[0] : 0;</td></tr>
<tr class="codeline" data-linenumber="997"><td class="num" id="LN997">997</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="998"><td class="num" id="LN998">998</td><td class="line">    <span class='keyword'>int</span> depth = images[0].depth();</td></tr>
<tr class="codeline" data-linenumber="999"><td class="num" id="LN999">999</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1000"><td class="num" id="LN1000">1000</td><td class="line">    <span class='keyword'>if</span>( depth == <span class='macro'>CV_8U<span class='macro_popup'>0</span></span> )</td></tr>
<tr class="codeline" data-linenumber="1001"><td class="num" id="LN1001">1001</td><td class="line">        calcHist_8u(ptrs, deltas, imsize, ihist, dims, ranges, _uniranges, uniform );</td></tr>
<tr class="codeline" data-linenumber="1002"><td class="num" id="LN1002">1002</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span>( depth == <span class='macro'>CV_16U<span class='macro_popup'>2</span></span> )</td></tr>
<tr class="codeline" data-linenumber="1003"><td class="num" id="LN1003">1003</td><td class="line">        calcHist_&lt;ushort&gt;(ptrs, deltas, imsize, ihist, dims, ranges, _uniranges, uniform );</td></tr>
<tr class="codeline" data-linenumber="1004"><td class="num" id="LN1004">1004</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span>( depth == <span class='macro'>CV_32F<span class='macro_popup'>5</span></span> )</td></tr>
<tr class="codeline" data-linenumber="1005"><td class="num" id="LN1005">1005</td><td class="line">        calcHist_&lt;<span class='keyword'>float</span>&gt;(ptrs, deltas, imsize, ihist, dims, ranges, _uniranges, uniform );</td></tr>
<tr class="codeline" data-linenumber="1006"><td class="num" id="LN1006">1006</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1007"><td class="num" id="LN1007">1007</td><td class="line">        <span class='macro'>CV_Error(CV_StsUnsupportedFormat, <span class='string_literal'>""</span>)<span class='macro_popup'>do { (void)(CV_StsUnsupportedFormat); (void)(""); abort(); } while<br> (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1008"><td class="num" id="LN1008">1008</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1009"><td class="num" id="LN1009">1009</td><td class="line">    ihist.convertTo(hist, <span class='macro'>CV_32F<span class='macro_popup'>5</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1010"><td class="num" id="LN1010">1010</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1011"><td class="num" id="LN1011">1011</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1012"><td class="num" id="LN1012">1012</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1013"><td class="num" id="LN1013">1013</td><td class="line"><span class='keyword'>namespace</span> cv</td></tr>
<tr class="codeline" data-linenumber="1014"><td class="num" id="LN1014">1014</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1015"><td class="num" id="LN1015">1015</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1016"><td class="num" id="LN1016">1016</td><td class="line"><span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> T&gt; <span class='keyword'>static</span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="1017"><td class="num" id="LN1017">1017</td><td class="line">calcSparseHist_( std::vector&lt;uchar*&gt;&amp; _ptrs, <span class='keyword'>const</span> std::vector&lt;<span class='keyword'>int</span>&gt;&amp; _deltas,</td></tr>
<tr class="codeline" data-linenumber="1018"><td class="num" id="LN1018">1018</td><td class="line">                 Size imsize, SparseMat&amp; hist, <span class='keyword'>int</span> dims, <span class='keyword'>const</span> <span class='keyword'>float</span>** _ranges,</td></tr>
<tr class="codeline" data-linenumber="1019"><td class="num" id="LN1019">1019</td><td class="line">                 <span class='keyword'>const</span> <span class='keyword'>double</span>* _uniranges, <span class='keyword'>bool</span> uniform )</td></tr>
<tr class="codeline" data-linenumber="1020"><td class="num" id="LN1020">1020</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1021"><td class="num" id="LN1021">1021</td><td class="line">    T** ptrs = (T**)&amp;_ptrs[0];</td></tr>
<tr class="codeline" data-linenumber="1022"><td class="num" id="LN1022">1022</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>int</span>* deltas = &amp;_deltas[0];</td></tr>
<tr class="codeline" data-linenumber="1023"><td class="num" id="LN1023">1023</td><td class="line">    <span class='keyword'>int</span> i, x;</td></tr>
<tr class="codeline" data-linenumber="1024"><td class="num" id="LN1024">1024</td><td class="line">    <span class='keyword'>const</span> uchar* mask = _ptrs[dims];</td></tr>
<tr class="codeline" data-linenumber="1025"><td class="num" id="LN1025">1025</td><td class="line">    <span class='keyword'>int</span> mstep = _deltas[dims*2 + 1];</td></tr>
<tr class="codeline" data-linenumber="1026"><td class="num" id="LN1026">1026</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>int</span>* size = hist.hdr-&gt;size;</td></tr>
<tr class="codeline" data-linenumber="1027"><td class="num" id="LN1027">1027</td><td class="line">    <span class='keyword'>int</span> idx[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>];</td></tr>
<tr class="codeline" data-linenumber="1028"><td class="num" id="LN1028">1028</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1029"><td class="num" id="LN1029">1029</td><td class="line">    <span class='keyword'>if</span>( uniform )</td></tr>
<tr class="codeline" data-linenumber="1030"><td class="num" id="LN1030">1030</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1031"><td class="num" id="LN1031">1031</td><td class="line">        <span class='keyword'>const</span> <span class='keyword'>double</span>* uniranges = &amp;_uniranges[0];</td></tr>
<tr class="codeline" data-linenumber="1032"><td class="num" id="LN1032">1032</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1033"><td class="num" id="LN1033">1033</td><td class="line">        <span class='keyword'>for</span>( ; imsize.height--; mask += mstep )</td></tr>
<tr class="codeline" data-linenumber="1034"><td class="num" id="LN1034">1034</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1035"><td class="num" id="LN1035">1035</td><td class="line">            <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++ )</td></tr>
<tr class="codeline" data-linenumber="1036"><td class="num" id="LN1036">1036</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1037"><td class="num" id="LN1037">1037</td><td class="line">                i = 0;</td></tr>
<tr class="codeline" data-linenumber="1038"><td class="num" id="LN1038">1038</td><td class="line">                <span class='keyword'>if</span>( !mask || mask[x] )</td></tr>
<tr class="codeline" data-linenumber="1039"><td class="num" id="LN1039">1039</td><td class="line">                    <span class='keyword'>for</span>( ; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1040"><td class="num" id="LN1040">1040</td><td class="line">                    {</td></tr>
<tr class="codeline" data-linenumber="1041"><td class="num" id="LN1041">1041</td><td class="line">                        idx[i] = cvFloor(*ptrs[i]*uniranges[i*2] + uniranges[i*2+1]);</td></tr>
<tr class="codeline" data-linenumber="1042"><td class="num" id="LN1042">1042</td><td class="line">                        <span class='keyword'>if</span>( (<span class='keyword'>unsigned</span>)idx[i] &gt;= (<span class='keyword'>unsigned</span>)size[i] )</td></tr>
<tr class="codeline" data-linenumber="1043"><td class="num" id="LN1043">1043</td><td class="line">                            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1044"><td class="num" id="LN1044">1044</td><td class="line">                        ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="1045"><td class="num" id="LN1045">1045</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="1046"><td class="num" id="LN1046">1046</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1047"><td class="num" id="LN1047">1047</td><td class="line">                <span class='keyword'>if</span>( i == dims )</td></tr>
<tr class="codeline" data-linenumber="1048"><td class="num" id="LN1048">1048</td><td class="line">                    ++*(<span class='keyword'>int</span>*)hist.ptr(idx, <span class='keyword'>true</span>);</td></tr>
<tr class="codeline" data-linenumber="1049"><td class="num" id="LN1049">1049</td><td class="line">                <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1050"><td class="num" id="LN1050">1050</td><td class="line">                    <span class='keyword'>for</span>( ; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1051"><td class="num" id="LN1051">1051</td><td class="line">                        ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="1052"><td class="num" id="LN1052">1052</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1053"><td class="num" id="LN1053">1053</td><td class="line">            <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1054"><td class="num" id="LN1054">1054</td><td class="line">                ptrs[i] += deltas[i*2 + 1];</td></tr>
<tr class="codeline" data-linenumber="1055"><td class="num" id="LN1055">1055</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1056"><td class="num" id="LN1056">1056</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1057"><td class="num" id="LN1057">1057</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (_ranges)</td></tr>
<tr class="codeline" data-linenumber="1058"><td class="num" id="LN1058">1058</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1059"><td class="num" id="LN1059">1059</td><td class="line">        <span class='comment'>// non-uniform histogram</span></td></tr>
<tr class="codeline" data-linenumber="1060"><td class="num" id="LN1060">1060</td><td class="line">        <span class='keyword'>const</span> <span class='keyword'>float</span>* ranges[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>];</td></tr>
<tr class="codeline" data-linenumber="1061"><td class="num" id="LN1061">1061</td><td class="line">        <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1062"><td class="num" id="LN1062">1062</td><td class="line">            ranges[i] = &amp;_ranges[i][0];</td></tr>
<tr class="codeline" data-linenumber="1063"><td class="num" id="LN1063">1063</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1064"><td class="num" id="LN1064">1064</td><td class="line">        <span class='keyword'>for</span>( ; imsize.height--; mask += mstep )</td></tr>
<tr class="codeline" data-linenumber="1065"><td class="num" id="LN1065">1065</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1066"><td class="num" id="LN1066">1066</td><td class="line">            <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++ )</td></tr>
<tr class="codeline" data-linenumber="1067"><td class="num" id="LN1067">1067</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1068"><td class="num" id="LN1068">1068</td><td class="line">                i = 0;</td></tr>
<tr class="codeline" data-linenumber="1069"><td class="num" id="LN1069">1069</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1070"><td class="num" id="LN1070">1070</td><td class="line">                <span class='keyword'>if</span>( !mask || mask[x] )</td></tr>
<tr class="codeline" data-linenumber="1071"><td class="num" id="LN1071">1071</td><td class="line">                    <span class='keyword'>for</span>( ; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1072"><td class="num" id="LN1072">1072</td><td class="line">                    {</td></tr>
<tr class="codeline" data-linenumber="1073"><td class="num" id="LN1073">1073</td><td class="line">                        <span class='keyword'>float</span> v = (<span class='keyword'>float</span>)*ptrs[i];</td></tr>
<tr class="codeline" data-linenumber="1074"><td class="num" id="LN1074">1074</td><td class="line">                        <span class='keyword'>const</span> <span class='keyword'>float</span>* R = ranges[i];</td></tr>
<tr class="codeline" data-linenumber="1075"><td class="num" id="LN1075">1075</td><td class="line">                        <span class='keyword'>int</span> j = -1, sz = size[i];</td></tr>
<tr class="codeline" data-linenumber="1076"><td class="num" id="LN1076">1076</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1077"><td class="num" id="LN1077">1077</td><td class="line">                        <span class='keyword'>while</span>( v &gt;= R[j+1] &amp;&amp; ++j &lt; sz )</td></tr>
<tr class="codeline" data-linenumber="1078"><td class="num" id="LN1078">1078</td><td class="line">                            ; <span class='comment'>// nop</span></td></tr>
<tr class="codeline" data-linenumber="1079"><td class="num" id="LN1079">1079</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1080"><td class="num" id="LN1080">1080</td><td class="line">                        <span class='keyword'>if</span>( (<span class='keyword'>unsigned</span>)j &gt;= (<span class='keyword'>unsigned</span>)sz )</td></tr>
<tr class="codeline" data-linenumber="1081"><td class="num" id="LN1081">1081</td><td class="line">                            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1082"><td class="num" id="LN1082">1082</td><td class="line">                        ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="1083"><td class="num" id="LN1083">1083</td><td class="line">                        idx[i] = j;</td></tr>
<tr class="codeline" data-linenumber="1084"><td class="num" id="LN1084">1084</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="1085"><td class="num" id="LN1085">1085</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1086"><td class="num" id="LN1086">1086</td><td class="line">                <span class='keyword'>if</span>( i == dims )</td></tr>
<tr class="codeline" data-linenumber="1087"><td class="num" id="LN1087">1087</td><td class="line">                    ++*(<span class='keyword'>int</span>*)hist.ptr(idx, <span class='keyword'>true</span>);</td></tr>
<tr class="codeline" data-linenumber="1088"><td class="num" id="LN1088">1088</td><td class="line">                <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1089"><td class="num" id="LN1089">1089</td><td class="line">                    <span class='keyword'>for</span>( ; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1090"><td class="num" id="LN1090">1090</td><td class="line">                        ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="1091"><td class="num" id="LN1091">1091</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1092"><td class="num" id="LN1092">1092</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1093"><td class="num" id="LN1093">1093</td><td class="line">            <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1094"><td class="num" id="LN1094">1094</td><td class="line">                ptrs[i] += deltas[i*2 + 1];</td></tr>
<tr class="codeline" data-linenumber="1095"><td class="num" id="LN1095">1095</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1096"><td class="num" id="LN1096">1096</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1097"><td class="num" id="LN1097">1097</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1098"><td class="num" id="LN1098">1098</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1099"><td class="num" id="LN1099">1099</td><td class="line">        <span class='macro'>CV_Error(Error::StsBadArg, <span class='string_literal'>"Either ranges, either uniform ranges should be provided"</span>)<span class='macro_popup'>do { (void)(Error::StsBadArg); (void)("Either ranges, either uniform ranges should be provided"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1100"><td class="num" id="LN1100">1100</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1101"><td class="num" id="LN1101">1101</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1102"><td class="num" id="LN1102">1102</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1103"><td class="num" id="LN1103">1103</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1104"><td class="num" id="LN1104">1104</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="1105"><td class="num" id="LN1105">1105</td><td class="line">calcSparseHist_8u( std::vector&lt;uchar*&gt;&amp; _ptrs, <span class='keyword'>const</span> std::vector&lt;<span class='keyword'>int</span>&gt;&amp; _deltas,</td></tr>
<tr class="codeline" data-linenumber="1106"><td class="num" id="LN1106">1106</td><td class="line">                   Size imsize, SparseMat&amp; hist, <span class='keyword'>int</span> dims, <span class='keyword'>const</span> <span class='keyword'>float</span>** _ranges,</td></tr>
<tr class="codeline" data-linenumber="1107"><td class="num" id="LN1107">1107</td><td class="line">                   <span class='keyword'>const</span> <span class='keyword'>double</span>* _uniranges, <span class='keyword'>bool</span> uniform )</td></tr>
<tr class="codeline" data-linenumber="1108"><td class="num" id="LN1108">1108</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1109"><td class="num" id="LN1109">1109</td><td class="line">    uchar** ptrs = (uchar**)&amp;_ptrs[0];</td></tr>
<tr class="codeline" data-linenumber="1110"><td class="num" id="LN1110">1110</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>int</span>* deltas = &amp;_deltas[0];</td></tr>
<tr class="codeline" data-linenumber="1111"><td class="num" id="LN1111">1111</td><td class="line">    <span class='keyword'>int</span> x;</td></tr>
<tr class="codeline" data-linenumber="1112"><td class="num" id="LN1112">1112</td><td class="line">    <span class='keyword'>const</span> uchar* mask = _ptrs[dims];</td></tr>
<tr class="codeline" data-linenumber="1113"><td class="num" id="LN1113">1113</td><td class="line">    <span class='keyword'>int</span> mstep = _deltas[dims*2 + 1];</td></tr>
<tr class="codeline" data-linenumber="1114"><td class="num" id="LN1114">1114</td><td class="line">    <span class='keyword'>int</span> idx[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>];</td></tr>
<tr class="codeline" data-linenumber="1115"><td class="num" id="LN1115">1115</td><td class="line">    std::vector&lt;size_t&gt; _tab;</td></tr>
<tr class="codeline" data-linenumber="1116"><td class="num" id="LN1116">1116</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1117"><td class="num" id="LN1117">1117</td><td class="line">    calcHistLookupTables_8u( Mat(), hist, dims, _ranges, _uniranges, uniform, <span class='keyword'>true</span>, _tab );</td></tr>
<tr class="codeline" data-linenumber="1118"><td class="num" id="LN1118">1118</td><td class="line">    <span class='keyword'>const</span> size_t* tab = &amp;_tab[0];</td></tr>
<tr class="codeline" data-linenumber="1119"><td class="num" id="LN1119">1119</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1120"><td class="num" id="LN1120">1120</td><td class="line">    <span class='keyword'>for</span>( ; imsize.height--; mask += mstep )</td></tr>
<tr class="codeline" data-linenumber="1121"><td class="num" id="LN1121">1121</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1122"><td class="num" id="LN1122">1122</td><td class="line">        <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++ )</td></tr>
<tr class="codeline" data-linenumber="1123"><td class="num" id="LN1123">1123</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1124"><td class="num" id="LN1124">1124</td><td class="line">            <span class='keyword'>int</span> i = 0;</td></tr>
<tr class="codeline" data-linenumber="1125"><td class="num" id="LN1125">1125</td><td class="line">            <span class='keyword'>if</span>( !mask || mask[x] )</td></tr>
<tr class="codeline" data-linenumber="1126"><td class="num" id="LN1126">1126</td><td class="line">                <span class='keyword'>for</span>( ; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1127"><td class="num" id="LN1127">1127</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="1128"><td class="num" id="LN1128">1128</td><td class="line">                    size_t hidx = tab[*ptrs[i] + i*256];</td></tr>
<tr class="codeline" data-linenumber="1129"><td class="num" id="LN1129">1129</td><td class="line">                    <span class='keyword'>if</span>( hidx &gt;= OUT_OF_RANGE )</td></tr>
<tr class="codeline" data-linenumber="1130"><td class="num" id="LN1130">1130</td><td class="line">                        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1131"><td class="num" id="LN1131">1131</td><td class="line">                    ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="1132"><td class="num" id="LN1132">1132</td><td class="line">                    idx[i] = (<span class='keyword'>int</span>)hidx;</td></tr>
<tr class="codeline" data-linenumber="1133"><td class="num" id="LN1133">1133</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1134"><td class="num" id="LN1134">1134</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1135"><td class="num" id="LN1135">1135</td><td class="line">            <span class='keyword'>if</span>( i == dims )</td></tr>
<tr class="codeline" data-linenumber="1136"><td class="num" id="LN1136">1136</td><td class="line">                ++*(<span class='keyword'>int</span>*)hist.ptr(idx,<span class='keyword'>true</span>);</td></tr>
<tr class="codeline" data-linenumber="1137"><td class="num" id="LN1137">1137</td><td class="line">            <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1138"><td class="num" id="LN1138">1138</td><td class="line">                <span class='keyword'>for</span>( ; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1139"><td class="num" id="LN1139">1139</td><td class="line">                    ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="1140"><td class="num" id="LN1140">1140</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1141"><td class="num" id="LN1141">1141</td><td class="line">        <span class='keyword'>for</span>(<span class='keyword'>int</span> i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1142"><td class="num" id="LN1142">1142</td><td class="line">            ptrs[i] += deltas[i*2 + 1];</td></tr>
<tr class="codeline" data-linenumber="1143"><td class="num" id="LN1143">1143</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1144"><td class="num" id="LN1144">1144</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1145"><td class="num" id="LN1145">1145</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1146"><td class="num" id="LN1146">1146</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1147"><td class="num" id="LN1147">1147</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> calcHist( <span class='keyword'>const</span> Mat* images, <span class='keyword'>int</span> nimages, <span class='keyword'>const</span> <span class='keyword'>int</span>* channels,</td></tr>
<tr class="codeline" data-linenumber="1148"><td class="num" id="LN1148">1148</td><td class="line">                      <span class='keyword'>const</span> Mat&amp; mask, SparseMat&amp; hist, <span class='keyword'>int</span> dims, <span class='keyword'>const</span> <span class='keyword'>int</span>* histSize,</td></tr>
<tr class="codeline" data-linenumber="1149"><td class="num" id="LN1149">1149</td><td class="line">                      <span class='keyword'>const</span> <span class='keyword'>float</span>** ranges, <span class='keyword'>bool</span> uniform, <span class='keyword'>bool</span> accumulate, <span class='keyword'>bool</span> keepInt )</td></tr>
<tr class="codeline" data-linenumber="1150"><td class="num" id="LN1150">1150</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1151"><td class="num" id="LN1151">1151</td><td class="line">    size_t i, N;</td></tr>
<tr class="codeline" data-linenumber="1152"><td class="num" id="LN1152">1152</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1153"><td class="num" id="LN1153">1153</td><td class="line">    <span class='keyword'>if</span>( !accumulate )</td></tr>
<tr class="codeline" data-linenumber="1154"><td class="num" id="LN1154">1154</td><td class="line">        hist.create(dims, histSize, <span class='macro'>CV_32F<span class='macro_popup'>5</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1155"><td class="num" id="LN1155">1155</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1156"><td class="num" id="LN1156">1156</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1157"><td class="num" id="LN1157">1157</td><td class="line">        SparseMatIterator it = hist.begin();</td></tr>
<tr class="codeline" data-linenumber="1158"><td class="num" id="LN1158">1158</td><td class="line">        <span class='keyword'>for</span>( i = 0, N = hist.nzcount(); i &lt; N; i++, ++it )</td></tr>
<tr class="codeline" data-linenumber="1159"><td class="num" id="LN1159">1159</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1160"><td class="num" id="LN1160">1160</td><td class="line">            <span class='macro'>CV_Assert(it.ptr != NULL)<span class='macro_popup'>do { if (!(it.ptr != __null)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1161"><td class="num" id="LN1161">1161</td><td class="line">            Cv32suf* val = (Cv32suf*)it.ptr;</td></tr>
<tr class="codeline" data-linenumber="1162"><td class="num" id="LN1162">1162</td><td class="line">            val-&gt;i = cvRound(val-&gt;f);</td></tr>
<tr class="codeline" data-linenumber="1163"><td class="num" id="LN1163">1163</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1164"><td class="num" id="LN1164">1164</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1165"><td class="num" id="LN1165">1165</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1166"><td class="num" id="LN1166">1166</td><td class="line">    std::vector&lt;uchar*&gt; ptrs;</td></tr>
<tr class="codeline" data-linenumber="1167"><td class="num" id="LN1167">1167</td><td class="line">    std::vector&lt;<span class='keyword'>int</span>&gt; deltas;</td></tr>
<tr class="codeline" data-linenumber="1168"><td class="num" id="LN1168">1168</td><td class="line">    std::vector&lt;<span class='keyword'>double</span>&gt; uniranges;</td></tr>
<tr class="codeline" data-linenumber="1169"><td class="num" id="LN1169">1169</td><td class="line">    Size imsize;</td></tr>
<tr class="codeline" data-linenumber="1170"><td class="num" id="LN1170">1170</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1171"><td class="num" id="LN1171">1171</td><td class="line">    <span class='macro'>CV_Assert( mask.empty() || mask.type() == CV_8UC1 )<span class='macro_popup'>do { if (!(mask.empty() || mask.type() == (((0) &amp; ((1 &lt;&lt;<br> 3) - 1)) + (((1)-1) &lt;&lt; 3)))) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1172"><td class="num" id="LN1172">1172</td><td class="line">    histPrepareImages( images, nimages, channels, mask, dims, hist.hdr-&gt;size, ranges,</td></tr>
<tr class="codeline" data-linenumber="1173"><td class="num" id="LN1173">1173</td><td class="line">                       uniform, ptrs, deltas, imsize, uniranges );</td></tr>
<tr class="codeline" data-linenumber="1174"><td class="num" id="LN1174">1174</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>double</span>* _uniranges = uniform ? &amp;uniranges[0] : 0;</td></tr>
<tr class="codeline" data-linenumber="1175"><td class="num" id="LN1175">1175</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1176"><td class="num" id="LN1176">1176</td><td class="line">    <span class='keyword'>int</span> depth = images[0].depth();</td></tr>
<tr class="codeline" data-linenumber="1177"><td class="num" id="LN1177">1177</td><td class="line">    <span class='keyword'>if</span>( depth == <span class='macro'>CV_8U<span class='macro_popup'>0</span></span> )</td></tr>
<tr class="codeline" data-linenumber="1178"><td class="num" id="LN1178">1178</td><td class="line">        calcSparseHist_8u(ptrs, deltas, imsize, hist, dims, ranges, _uniranges, uniform );</td></tr>
<tr class="codeline" data-linenumber="1179"><td class="num" id="LN1179">1179</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span>( depth == <span class='macro'>CV_16U<span class='macro_popup'>2</span></span> )</td></tr>
<tr class="codeline" data-linenumber="1180"><td class="num" id="LN1180">1180</td><td class="line">        calcSparseHist_&lt;ushort&gt;(ptrs, deltas, imsize, hist, dims, ranges, _uniranges, uniform );</td></tr>
<tr class="codeline" data-linenumber="1181"><td class="num" id="LN1181">1181</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span>( depth == <span class='macro'>CV_32F<span class='macro_popup'>5</span></span> )</td></tr>
<tr class="codeline" data-linenumber="1182"><td class="num" id="LN1182">1182</td><td class="line">        calcSparseHist_&lt;<span class='keyword'>float</span>&gt;(ptrs, deltas, imsize, hist, dims, ranges, _uniranges, uniform );</td></tr>
<tr class="codeline" data-linenumber="1183"><td class="num" id="LN1183">1183</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1184"><td class="num" id="LN1184">1184</td><td class="line">        <span class='macro'>CV_Error(CV_StsUnsupportedFormat, <span class='string_literal'>""</span>)<span class='macro_popup'>do { (void)(CV_StsUnsupportedFormat); (void)(""); abort(); } while<br> (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1185"><td class="num" id="LN1185">1185</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1186"><td class="num" id="LN1186">1186</td><td class="line">    <span class='keyword'>if</span>( !keepInt )</td></tr>
<tr class="codeline" data-linenumber="1187"><td class="num" id="LN1187">1187</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1188"><td class="num" id="LN1188">1188</td><td class="line">        SparseMatIterator it = hist.begin();</td></tr>
<tr class="codeline" data-linenumber="1189"><td class="num" id="LN1189">1189</td><td class="line">        <span class='keyword'>for</span>( i = 0, N = hist.nzcount(); i &lt; N; i++, ++it )</td></tr>
<tr class="codeline" data-linenumber="1190"><td class="num" id="LN1190">1190</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1191"><td class="num" id="LN1191">1191</td><td class="line">            <span class='macro'>CV_Assert(it.ptr != NULL)<span class='macro_popup'>do { if (!(it.ptr != __null)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1192"><td class="num" id="LN1192">1192</td><td class="line">            Cv32suf* val = (Cv32suf*)it.ptr;</td></tr>
<tr class="codeline" data-linenumber="1193"><td class="num" id="LN1193">1193</td><td class="line">            val-&gt;f = (<span class='keyword'>float</span>)val-&gt;i;</td></tr>
<tr class="codeline" data-linenumber="1194"><td class="num" id="LN1194">1194</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1195"><td class="num" id="LN1195">1195</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1196"><td class="num" id="LN1196">1196</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1197"><td class="num" id="LN1197">1197</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1198"><td class="num" id="LN1198">1198</td><td class="line"><span class='directive'>#ifdef HAVE_OPENCL</span></td></tr>
<tr class="codeline" data-linenumber="1199"><td class="num" id="LN1199">1199</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1200"><td class="num" id="LN1200">1200</td><td class="line"><span class='keyword'>enum</span></td></tr>
<tr class="codeline" data-linenumber="1201"><td class="num" id="LN1201">1201</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1202"><td class="num" id="LN1202">1202</td><td class="line">    BINS = 256</td></tr>
<tr class="codeline" data-linenumber="1203"><td class="num" id="LN1203">1203</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="1204"><td class="num" id="LN1204">1204</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1205"><td class="num" id="LN1205">1205</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>bool</span> ocl_calcHist1(InputArray _src, OutputArray _hist, <span class='keyword'>int</span> ddepth = <span class='macro'>CV_32S<span class='macro_popup'>4</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1206"><td class="num" id="LN1206">1206</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1207"><td class="num" id="LN1207">1207</td><td class="line">    <span class='keyword'>const</span> ocl::Device &amp; dev = ocl::Device::getDefault();</td></tr>
<tr class="codeline" data-linenumber="1208"><td class="num" id="LN1208">1208</td><td class="line">    <span class='keyword'>int</span> compunits = dev.maxComputeUnits();</td></tr>
<tr class="codeline" data-linenumber="1209"><td class="num" id="LN1209">1209</td><td class="line">    size_t wgs = dev.maxWorkGroupSize();</td></tr>
<tr class="codeline" data-linenumber="1210"><td class="num" id="LN1210">1210</td><td class="line">    Size size = _src.size();</td></tr>
<tr class="codeline" data-linenumber="1211"><td class="num" id="LN1211">1211</td><td class="line">    <span class='keyword'>bool</span> use16 = size.width % 16 == 0 &amp;&amp; _src.offset() % 16 == 0 &amp;&amp; _src.step() % 16 == 0;</td></tr>
<tr class="codeline" data-linenumber="1212"><td class="num" id="LN1212">1212</td><td class="line">    <span class='keyword'>int</span> kercn = dev.isAMD() &amp;&amp; use16 ? 16 : std::min(4, ocl::predictOptimalVectorWidth(_src));</td></tr>
<tr class="codeline" data-linenumber="1213"><td class="num" id="LN1213">1213</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1214"><td class="num" id="LN1214">1214</td><td class="line">    ocl::Kernel k1(<span class='string_literal'>"calculate_histogram"</span>, ocl::imgproc::histogram_oclsrc,</td></tr>
<tr class="codeline" data-linenumber="1215"><td class="num" id="LN1215">1215</td><td class="line">                   format(<span class='string_literal'>"-D BINS=%d -D HISTS_COUNT=%d -D WGS=%zu -D kercn=%d -D T=%s%s"</span>,</td></tr>
<tr class="codeline" data-linenumber="1216"><td class="num" id="LN1216">1216</td><td class="line">                          BINS, compunits, wgs, kercn,</td></tr>
<tr class="codeline" data-linenumber="1217"><td class="num" id="LN1217">1217</td><td class="line">                          kercn == 4 ? <span class='string_literal'>"int"</span> : ocl::typeToStr(<span class='macro'>CV_8UC(kercn)<span class='macro_popup'>(((0) &amp; ((1 &lt;&lt; 3) - 1)) + ((((kercn))-1) &lt;&lt; 3<br>))</span></span>),</td></tr>
<tr class="codeline" data-linenumber="1218"><td class="num" id="LN1218">1218</td><td class="line">                          _src.isContinuous() ? <span class='string_literal'>" -D HAVE_SRC_CONT"</span> : <span class='string_literal'>""</span>));</td></tr>
<tr class="codeline" data-linenumber="1219"><td class="num" id="LN1219">1219</td><td class="line">    <span class='keyword'>if</span> (k1.empty())</td></tr>
<tr class="codeline" data-linenumber="1220"><td class="num" id="LN1220">1220</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1221"><td class="num" id="LN1221">1221</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1222"><td class="num" id="LN1222">1222</td><td class="line">    _hist.create(BINS, 1, ddepth);</td></tr>
<tr class="codeline" data-linenumber="1223"><td class="num" id="LN1223">1223</td><td class="line">    UMat src = _src.getUMat(), ghist(1, BINS * compunits, <span class='macro'>CV_32SC1<span class='macro_popup'>(((4) &amp; ((1 &lt;&lt; 3) - 1)) + (((1)-1) &lt;&lt; 3))</span></span>),</td></tr>
<tr class="codeline" data-linenumber="1224"><td class="num" id="LN1224">1224</td><td class="line">            hist = _hist.getUMat();</td></tr>
<tr class="codeline" data-linenumber="1225"><td class="num" id="LN1225">1225</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1226"><td class="num" id="LN1226">1226</td><td class="line">    k1.args(ocl::KernelArg::ReadOnly(src),</td></tr>
<tr class="codeline" data-linenumber="1227"><td class="num" id="LN1227">1227</td><td class="line">            ocl::KernelArg::PtrWriteOnly(ghist), (<span class='keyword'>int</span>)src.total());</td></tr>
<tr class="codeline" data-linenumber="1228"><td class="num" id="LN1228">1228</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1229"><td class="num" id="LN1229">1229</td><td class="line">    size_t globalsize = compunits * wgs;</td></tr>
<tr class="codeline" data-linenumber="1230"><td class="num" id="LN1230">1230</td><td class="line">    <span class='keyword'>if</span> (!k1.run(1, &amp;globalsize, &amp;wgs, <span class='keyword'>false</span>))</td></tr>
<tr class="codeline" data-linenumber="1231"><td class="num" id="LN1231">1231</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1232"><td class="num" id="LN1232">1232</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1233"><td class="num" id="LN1233">1233</td><td class="line">    wgs = std::min&lt;size_t&gt;(ocl::Device::getDefault().maxWorkGroupSize(), BINS);</td></tr>
<tr class="codeline" data-linenumber="1234"><td class="num" id="LN1234">1234</td><td class="line">    <span class='keyword'>char</span> cvt[40];</td></tr>
<tr class="codeline" data-linenumber="1235"><td class="num" id="LN1235">1235</td><td class="line">    ocl::Kernel k2(<span class='string_literal'>"merge_histogram"</span>, ocl::imgproc::histogram_oclsrc,</td></tr>
<tr class="codeline" data-linenumber="1236"><td class="num" id="LN1236">1236</td><td class="line">                   format(<span class='string_literal'>"-D BINS=%d -D HISTS_COUNT=%d -D WGS=%d -D convertToHT=%s -D HT=%s"</span>,</td></tr>
<tr class="codeline" data-linenumber="1237"><td class="num" id="LN1237">1237</td><td class="line">                          BINS, compunits, (<span class='keyword'>int</span>)wgs, ocl::convertTypeStr(<span class='macro'>CV_32S<span class='macro_popup'>4</span></span>, ddepth, 1, cvt),</td></tr>
<tr class="codeline" data-linenumber="1238"><td class="num" id="LN1238">1238</td><td class="line">                          ocl::typeToStr(ddepth)));</td></tr>
<tr class="codeline" data-linenumber="1239"><td class="num" id="LN1239">1239</td><td class="line">    <span class='keyword'>if</span> (k2.empty())</td></tr>
<tr class="codeline" data-linenumber="1240"><td class="num" id="LN1240">1240</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1241"><td class="num" id="LN1241">1241</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1242"><td class="num" id="LN1242">1242</td><td class="line">    k2.args(ocl::KernelArg::PtrReadOnly(ghist),</td></tr>
<tr class="codeline" data-linenumber="1243"><td class="num" id="LN1243">1243</td><td class="line">            ocl::KernelArg::WriteOnlyNoSize(hist));</td></tr>
<tr class="codeline" data-linenumber="1244"><td class="num" id="LN1244">1244</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1245"><td class="num" id="LN1245">1245</td><td class="line">    <span class='keyword'>return</span> k2.run(1, &amp;wgs, &amp;wgs, <span class='keyword'>false</span>);</td></tr>
<tr class="codeline" data-linenumber="1246"><td class="num" id="LN1246">1246</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1247"><td class="num" id="LN1247">1247</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1248"><td class="num" id="LN1248">1248</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>bool</span> ocl_calcHist(InputArrayOfArrays images, OutputArray hist)</td></tr>
<tr class="codeline" data-linenumber="1249"><td class="num" id="LN1249">1249</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1250"><td class="num" id="LN1250">1250</td><td class="line">    std::vector&lt;UMat&gt; v;</td></tr>
<tr class="codeline" data-linenumber="1251"><td class="num" id="LN1251">1251</td><td class="line">    images.getUMatVector(v);</td></tr>
<tr class="codeline" data-linenumber="1252"><td class="num" id="LN1252">1252</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1253"><td class="num" id="LN1253">1253</td><td class="line">    <span class='keyword'>return</span> ocl_calcHist1(v[0], hist, <span class='macro'>CV_32F<span class='macro_popup'>5</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1254"><td class="num" id="LN1254">1254</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1255"><td class="num" id="LN1255">1255</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1256"><td class="num" id="LN1256">1256</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1257"><td class="num" id="LN1257">1257</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1258"><td class="num" id="LN1258">1258</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1259"><td class="num" id="LN1259">1259</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1260"><td class="num" id="LN1260">1260</td><td class="line"><span class='keyword'>void</span> cv::calcHist( <span class='keyword'>const</span> Mat* images, <span class='keyword'>int</span> nimages, <span class='keyword'>const</span> <span class='keyword'>int</span>* channels,</td></tr>
<tr class="codeline" data-linenumber="1261"><td class="num" id="LN1261">1261</td><td class="line">               InputArray _mask, SparseMat&amp; hist, <span class='keyword'>int</span> dims, <span class='keyword'>const</span> <span class='keyword'>int</span>* histSize,</td></tr>
<tr class="codeline" data-linenumber="1262"><td class="num" id="LN1262">1262</td><td class="line">               <span class='keyword'>const</span> <span class='keyword'>float</span>** ranges, <span class='keyword'>bool</span> uniform, <span class='keyword'>bool</span> accumulate )</td></tr>
<tr class="codeline" data-linenumber="1263"><td class="num" id="LN1263">1263</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1264"><td class="num" id="LN1264">1264</td><td class="line">    <span class='macro'>CV_INSTRUMENT_REGION()<span class='macro_popup'>; static cv::utils::trace::details::Region::LocationExtraData<br>* __cv_trace_location_extra_fn1264 = 0; static const cv::utils<br>::trace::details::Region::LocationStaticStorage __cv_trace_location_fn1264<br> = { &amp;(__cv_trace_location_extra_fn1264), __PRETTY_FUNCTION__<br>, "/home/zhh/projects/opencv-4.5.2/modules/imgproc/src/histogram.cpp"<br>, 1264, ((0) | cv::utils::trace::details::REGION_FLAG_FUNCTION<br>)};; const cv::utils::trace::details::Region __region_fn(__cv_trace_location_fn1264<br>);;</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1265"><td class="num" id="LN1265">1265</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1266"><td class="num" id="LN1266">1266</td><td class="line">    <span class='macro'>CV_Assert(images &amp;&amp; nimages &gt; 0)<span class='macro_popup'>do { if (!(images &amp;&amp; nimages &gt; 0)) abort(); } while<br> (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1267"><td class="num" id="LN1267">1267</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1268"><td class="num" id="LN1268">1268</td><td class="line">    Mat mask = _mask.getMat();</td></tr>
<tr class="codeline" data-linenumber="1269"><td class="num" id="LN1269">1269</td><td class="line">    calcHist( images, nimages, channels, mask, hist, dims, histSize,</td></tr>
<tr class="codeline" data-linenumber="1270"><td class="num" id="LN1270">1270</td><td class="line">              ranges, uniform, accumulate, <span class='keyword'>false</span> );</td></tr>
<tr class="codeline" data-linenumber="1271"><td class="num" id="LN1271">1271</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1272"><td class="num" id="LN1272">1272</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1273"><td class="num" id="LN1273">1273</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1274"><td class="num" id="LN1274">1274</td><td class="line"><span class='keyword'>void</span> cv::calcHist( InputArrayOfArrays images, <span class='keyword'>const</span> std::vector&lt;<span class='keyword'>int</span>&gt;&amp; channels,</td></tr>
<tr class="codeline" data-linenumber="1275"><td class="num" id="LN1275">1275</td><td class="line">                   InputArray mask, OutputArray hist,</td></tr>
<tr class="codeline" data-linenumber="1276"><td class="num" id="LN1276">1276</td><td class="line">                   <span class='keyword'>const</span> std::vector&lt;<span class='keyword'>int</span>&gt;&amp; histSize,</td></tr>
<tr class="codeline" data-linenumber="1277"><td class="num" id="LN1277">1277</td><td class="line">                   <span class='keyword'>const</span> std::vector&lt;<span class='keyword'>float</span>&gt;&amp; ranges,</td></tr>
<tr class="codeline" data-linenumber="1278"><td class="num" id="LN1278">1278</td><td class="line">                   <span class='keyword'>bool</span> accumulate )</td></tr>
<tr class="codeline" data-linenumber="1279"><td class="num" id="LN1279">1279</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1280"><td class="num" id="LN1280">1280</td><td class="line">    <span class='macro'>CV_INSTRUMENT_REGION()<span class='macro_popup'>; static cv::utils::trace::details::Region::LocationExtraData<br>* __cv_trace_location_extra_fn1280 = 0; static const cv::utils<br>::trace::details::Region::LocationStaticStorage __cv_trace_location_fn1280<br> = { &amp;(__cv_trace_location_extra_fn1280), __PRETTY_FUNCTION__<br>, "/home/zhh/projects/opencv-4.5.2/modules/imgproc/src/histogram.cpp"<br>, 1280, ((0) | cv::utils::trace::details::REGION_FLAG_FUNCTION<br>)};; const cv::utils::trace::details::Region __region_fn(__cv_trace_location_fn1280<br>);;</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1281"><td class="num" id="LN1281">1281</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1282"><td class="num" id="LN1282">1282</td><td class="line">    <span class='macro'>CV_OCL_RUN(images.total() == 1 &amp;&amp; channels.size() == 1 &amp;&amp; images.channels(0) == 1 &amp;&amp;<span class='macro_popup'>try { if (cv::ocl::isOpenCLActivated() &amp;&amp; (images.total<br>() == 1 &amp;&amp; channels.size() == 1 &amp;&amp; images.channels<br>(0) == 1 &amp;&amp; channels[0] == 0 &amp;&amp; images.isUMatVector<br>() &amp;&amp; mask.empty() &amp;&amp; !accumulate &amp;&amp; histSize<br>.size() == 1 &amp;&amp; histSize[0] == BINS &amp;&amp; ranges<br>.size() == 2 &amp;&amp; ranges[0] == 0 &amp;&amp; ranges[1] ==<br> BINS) &amp;&amp; ocl_calcHist(images, hist)) { ; return ; } }<br> catch (const cv::Exception&amp; e) { (void)e; }</span></span></td></tr>
<tr class="codeline" data-linenumber="1283"><td class="num" id="LN1283">1283</td><td class="line">               <span class='macro'>channels[0] == 0 &amp;&amp; images.isUMatVector() &amp;&amp; mask.empty() &amp;&amp; !accumulate &amp;&amp;<span class='macro_popup'>try { if (cv::ocl::isOpenCLActivated() &amp;&amp; (images.total<br>() == 1 &amp;&amp; channels.size() == 1 &amp;&amp; images.channels<br>(0) == 1 &amp;&amp; channels[0] == 0 &amp;&amp; images.isUMatVector<br>() &amp;&amp; mask.empty() &amp;&amp; !accumulate &amp;&amp; histSize<br>.size() == 1 &amp;&amp; histSize[0] == BINS &amp;&amp; ranges<br>.size() == 2 &amp;&amp; ranges[0] == 0 &amp;&amp; ranges[1] ==<br> BINS) &amp;&amp; ocl_calcHist(images, hist)) { ; return ; } }<br> catch (const cv::Exception&amp; e) { (void)e; }</span></span></td></tr>
<tr class="codeline" data-linenumber="1284"><td class="num" id="LN1284">1284</td><td class="line">               <span class='macro'>histSize.size() == 1 &amp;&amp; histSize[0] == BINS &amp;&amp; ranges.size() == 2 &amp;&amp;<span class='macro_popup'>try { if (cv::ocl::isOpenCLActivated() &amp;&amp; (images.total<br>() == 1 &amp;&amp; channels.size() == 1 &amp;&amp; images.channels<br>(0) == 1 &amp;&amp; channels[0] == 0 &amp;&amp; images.isUMatVector<br>() &amp;&amp; mask.empty() &amp;&amp; !accumulate &amp;&amp; histSize<br>.size() == 1 &amp;&amp; histSize[0] == BINS &amp;&amp; ranges<br>.size() == 2 &amp;&amp; ranges[0] == 0 &amp;&amp; ranges[1] ==<br> BINS) &amp;&amp; ocl_calcHist(images, hist)) { ; return ; } }<br> catch (const cv::Exception&amp; e) { (void)e; }</span></span></td></tr>
<tr class="codeline" data-linenumber="1285"><td class="num" id="LN1285">1285</td><td class="line">               <span class='macro'>ranges[0] == 0 &amp;&amp; ranges[1] == BINS,<span class='macro_popup'>try { if (cv::ocl::isOpenCLActivated() &amp;&amp; (images.total<br>() == 1 &amp;&amp; channels.size() == 1 &amp;&amp; images.channels<br>(0) == 1 &amp;&amp; channels[0] == 0 &amp;&amp; images.isUMatVector<br>() &amp;&amp; mask.empty() &amp;&amp; !accumulate &amp;&amp; histSize<br>.size() == 1 &amp;&amp; histSize[0] == BINS &amp;&amp; ranges<br>.size() == 2 &amp;&amp; ranges[0] == 0 &amp;&amp; ranges[1] ==<br> BINS) &amp;&amp; ocl_calcHist(images, hist)) { ; return ; } }<br> catch (const cv::Exception&amp; e) { (void)e; }</span></span></td></tr>
<tr class="codeline" data-linenumber="1286"><td class="num" id="LN1286">1286</td><td class="line">               <span class='macro'>ocl_calcHist(images, hist))<span class='macro_popup'>try { if (cv::ocl::isOpenCLActivated() &amp;&amp; (images.total<br>() == 1 &amp;&amp; channels.size() == 1 &amp;&amp; images.channels<br>(0) == 1 &amp;&amp; channels[0] == 0 &amp;&amp; images.isUMatVector<br>() &amp;&amp; mask.empty() &amp;&amp; !accumulate &amp;&amp; histSize<br>.size() == 1 &amp;&amp; histSize[0] == BINS &amp;&amp; ranges<br>.size() == 2 &amp;&amp; ranges[0] == 0 &amp;&amp; ranges[1] ==<br> BINS) &amp;&amp; ocl_calcHist(images, hist)) { ; return ; } }<br> catch (const cv::Exception&amp; e) { (void)e; }</span></span></td></tr>
<tr class="codeline" data-linenumber="1287"><td class="num" id="LN1287">1287</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1288"><td class="num" id="LN1288">1288</td><td class="line">    <span class='keyword'>int</span> i, dims = (<span class='keyword'>int</span>)histSize.size(), rsz = (<span class='keyword'>int</span>)ranges.size(), csz = (<span class='keyword'>int</span>)channels.size();</td></tr>
<tr class="codeline" data-linenumber="1289"><td class="num" id="LN1289">1289</td><td class="line">    <span class='keyword'>int</span> nimages = (<span class='keyword'>int</span>)images.total();</td></tr>
<tr class="codeline" data-linenumber="1290"><td class="num" id="LN1290">1290</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1291"><td class="num" id="LN1291">1291</td><td class="line">    <span class='macro'>CV_Assert(nimages &gt; 0 &amp;&amp; dims &gt; 0)<span class='macro_popup'>do { if (!(nimages &gt; 0 &amp;&amp; dims &gt; 0)) abort(); }<br> while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1292"><td class="num" id="LN1292">1292</td><td class="line">    <span class='macro'>CV_Assert(rsz == dims*2 || (rsz == 0 &amp;&amp; images.depth(0) == CV_8U))<span class='macro_popup'>do { if (!(rsz == dims*2 || (rsz == 0 &amp;&amp; images.depth<br>(0) == 0))) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1293"><td class="num" id="LN1293">1293</td><td class="line">    <span class='macro'>CV_Assert(csz == 0 || csz == dims)<span class='macro_popup'>do { if (!(csz == 0 || csz == dims)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1294"><td class="num" id="LN1294">1294</td><td class="line">    <span class='keyword'>float</span>* _ranges[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>];</td></tr>
<tr class="codeline" data-linenumber="1295"><td class="num" id="LN1295">1295</td><td class="line">    <span class='keyword'>if</span>( rsz &gt; 0 )</td></tr>
<tr class="codeline" data-linenumber="1296"><td class="num" id="LN1296">1296</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1297"><td class="num" id="LN1297">1297</td><td class="line">        <span class='keyword'>for</span>( i = 0; i &lt; rsz/2; i++ )</td></tr>
<tr class="codeline" data-linenumber="1298"><td class="num" id="LN1298">1298</td><td class="line">            _ranges[i] = (<span class='keyword'>float</span>*)&amp;ranges[i*2];</td></tr>
<tr class="codeline" data-linenumber="1299"><td class="num" id="LN1299">1299</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1300"><td class="num" id="LN1300">1300</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1301"><td class="num" id="LN1301">1301</td><td class="line">    AutoBuffer&lt;Mat&gt; buf(nimages);</td></tr>
<tr class="codeline" data-linenumber="1302"><td class="num" id="LN1302">1302</td><td class="line">    <span class='keyword'>for</span>( i = 0; i &lt; nimages; i++ )</td></tr>
<tr class="codeline" data-linenumber="1303"><td class="num" id="LN1303">1303</td><td class="line">        buf[i] = images.getMat(i);</td></tr>
<tr class="codeline" data-linenumber="1304"><td class="num" id="LN1304">1304</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1305"><td class="num" id="LN1305">1305</td><td class="line">    calcHist(&amp;buf[0], nimages, csz ? &amp;channels[0] : 0,</td></tr>
<tr class="codeline" data-linenumber="1306"><td class="num" id="LN1306">1306</td><td class="line">            mask, hist, dims, &amp;histSize[0], rsz ? (<span class='keyword'>const</span> <span class='keyword'>float</span>**)_ranges : 0,</td></tr>
<tr class="codeline" data-linenumber="1307"><td class="num" id="LN1307">1307</td><td class="line">            <span class='keyword'>true</span>, accumulate);</td></tr>
<tr class="codeline" data-linenumber="1308"><td class="num" id="LN1308">1308</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1309"><td class="num" id="LN1309">1309</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1310"><td class="num" id="LN1310">1310</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1311"><td class="num" id="LN1311">1311</td><td class="line"><span class='comment'>/////////////////////////////////////// B A C K   P R O J E C T ////////////////////////////////////</span></td></tr>
<tr class="codeline" data-linenumber="1312"><td class="num" id="LN1312">1312</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1313"><td class="num" id="LN1313">1313</td><td class="line"><span class='keyword'>namespace</span> cv</td></tr>
<tr class="codeline" data-linenumber="1314"><td class="num" id="LN1314">1314</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1315"><td class="num" id="LN1315">1315</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1316"><td class="num" id="LN1316">1316</td><td class="line"><span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> T, <span class='keyword'>typename</span> BT&gt; <span class='keyword'>static</span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="1317"><td class="num" id="LN1317">1317</td><td class="line">calcBackProj_( std::vector&lt;uchar*&gt;&amp; _ptrs, <span class='keyword'>const</span> std::vector&lt;<span class='keyword'>int</span>&gt;&amp; _deltas,</td></tr>
<tr class="codeline" data-linenumber="1318"><td class="num" id="LN1318">1318</td><td class="line">               Size imsize, <span class='keyword'>const</span> Mat&amp; hist, <span class='keyword'>int</span> dims, <span class='keyword'>const</span> <span class='keyword'>float</span>** _ranges,</td></tr>
<tr class="codeline" data-linenumber="1319"><td class="num" id="LN1319">1319</td><td class="line">               <span class='keyword'>const</span> <span class='keyword'>double</span>* _uniranges, <span class='keyword'>float</span> scale, <span class='keyword'>bool</span> uniform )</td></tr>
<tr class="codeline" data-linenumber="1320"><td class="num" id="LN1320">1320</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1321"><td class="num" id="LN1321">1321</td><td class="line">    T** ptrs = (T**)&amp;_ptrs[0];</td></tr>
<tr class="codeline" data-linenumber="1322"><td class="num" id="LN1322">1322</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>int</span>* deltas = &amp;_deltas[0];</td></tr>
<tr class="codeline" data-linenumber="1323"><td class="num" id="LN1323">1323</td><td class="line">    <span class='keyword'>const</span> uchar* H = hist.ptr();</td></tr>
<tr class="codeline" data-linenumber="1324"><td class="num" id="LN1324">1324</td><td class="line">    <span class='keyword'>int</span> i, x;</td></tr>
<tr class="codeline" data-linenumber="1325"><td class="num" id="LN1325">1325</td><td class="line">    BT* bproj = (BT*)_ptrs[dims];</td></tr>
<tr class="codeline" data-linenumber="1326"><td class="num" id="LN1326">1326</td><td class="line">    <span class='keyword'>int</span> bpstep = _deltas[dims*2 + 1];</td></tr>
<tr class="codeline" data-linenumber="1327"><td class="num" id="LN1327">1327</td><td class="line">    <span class='keyword'>int</span> size[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>];</td></tr>
<tr class="codeline" data-linenumber="1328"><td class="num" id="LN1328">1328</td><td class="line">    size_t hstep[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>];</td></tr>
<tr class="codeline" data-linenumber="1329"><td class="num" id="LN1329">1329</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1330"><td class="num" id="LN1330">1330</td><td class="line">    <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1331"><td class="num" id="LN1331">1331</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1332"><td class="num" id="LN1332">1332</td><td class="line">        size[i] = hist.size[i];</td></tr>
<tr class="codeline" data-linenumber="1333"><td class="num" id="LN1333">1333</td><td class="line">        hstep[i] = hist.step[i];</td></tr>
<tr class="codeline" data-linenumber="1334"><td class="num" id="LN1334">1334</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1335"><td class="num" id="LN1335">1335</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1336"><td class="num" id="LN1336">1336</td><td class="line">    <span class='keyword'>if</span>( uniform )</td></tr>
<tr class="codeline" data-linenumber="1337"><td class="num" id="LN1337">1337</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1338"><td class="num" id="LN1338">1338</td><td class="line">        <span class='keyword'>const</span> <span class='keyword'>double</span>* uniranges = &amp;_uniranges[0];</td></tr>
<tr class="codeline" data-linenumber="1339"><td class="num" id="LN1339">1339</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1340"><td class="num" id="LN1340">1340</td><td class="line">        <span class='keyword'>if</span>( dims == 1 )</td></tr>
<tr class="codeline" data-linenumber="1341"><td class="num" id="LN1341">1341</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1342"><td class="num" id="LN1342">1342</td><td class="line">            <span class='keyword'>double</span> a = uniranges[0], b = uniranges[1];</td></tr>
<tr class="codeline" data-linenumber="1343"><td class="num" id="LN1343">1343</td><td class="line">            <span class='keyword'>int</span> sz = size[0], d0 = deltas[0], step0 = deltas[1];</td></tr>
<tr class="codeline" data-linenumber="1344"><td class="num" id="LN1344">1344</td><td class="line">            <span class='keyword'>const</span> T* p0 = (<span class='keyword'>const</span> T*)ptrs[0];</td></tr>
<tr class="codeline" data-linenumber="1345"><td class="num" id="LN1345">1345</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1346"><td class="num" id="LN1346">1346</td><td class="line">            <span class='keyword'>for</span>( ; imsize.height--; p0 += step0, bproj += bpstep )</td></tr>
<tr class="codeline" data-linenumber="1347"><td class="num" id="LN1347">1347</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1348"><td class="num" id="LN1348">1348</td><td class="line">                <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++, p0 += d0 )</td></tr>
<tr class="codeline" data-linenumber="1349"><td class="num" id="LN1349">1349</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="1350"><td class="num" id="LN1350">1350</td><td class="line">                    <span class='keyword'>int</span> idx = cvFloor(*p0*a + b);</td></tr>
<tr class="codeline" data-linenumber="1351"><td class="num" id="LN1351">1351</td><td class="line">                    bproj[x] = (<span class='keyword'>unsigned</span>)idx &lt; (<span class='keyword'>unsigned</span>)sz ? saturate_cast&lt;BT&gt;(((<span class='keyword'>const</span> <span class='keyword'>float</span>*)H)[idx]*scale) : 0;</td></tr>
<tr class="codeline" data-linenumber="1352"><td class="num" id="LN1352">1352</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1353"><td class="num" id="LN1353">1353</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1354"><td class="num" id="LN1354">1354</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1355"><td class="num" id="LN1355">1355</td><td class="line">        <span class='keyword'>else</span> <span class='keyword'>if</span>( dims == 2 )</td></tr>
<tr class="codeline" data-linenumber="1356"><td class="num" id="LN1356">1356</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1357"><td class="num" id="LN1357">1357</td><td class="line">            <span class='keyword'>double</span> a0 = uniranges[0], b0 = uniranges[1],</td></tr>
<tr class="codeline" data-linenumber="1358"><td class="num" id="LN1358">1358</td><td class="line">                   a1 = uniranges[2], b1 = uniranges[3];</td></tr>
<tr class="codeline" data-linenumber="1359"><td class="num" id="LN1359">1359</td><td class="line">            <span class='keyword'>int</span> sz0 = size[0], sz1 = size[1];</td></tr>
<tr class="codeline" data-linenumber="1360"><td class="num" id="LN1360">1360</td><td class="line">            <span class='keyword'>int</span> d0 = deltas[0], step0 = deltas[1],</td></tr>
<tr class="codeline" data-linenumber="1361"><td class="num" id="LN1361">1361</td><td class="line">                d1 = deltas[2], step1 = deltas[3];</td></tr>
<tr class="codeline" data-linenumber="1362"><td class="num" id="LN1362">1362</td><td class="line">            size_t hstep0 = hstep[0];</td></tr>
<tr class="codeline" data-linenumber="1363"><td class="num" id="LN1363">1363</td><td class="line">            <span class='keyword'>const</span> T* p0 = (<span class='keyword'>const</span> T*)ptrs[0];</td></tr>
<tr class="codeline" data-linenumber="1364"><td class="num" id="LN1364">1364</td><td class="line">            <span class='keyword'>const</span> T* p1 = (<span class='keyword'>const</span> T*)ptrs[1];</td></tr>
<tr class="codeline" data-linenumber="1365"><td class="num" id="LN1365">1365</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1366"><td class="num" id="LN1366">1366</td><td class="line">            <span class='keyword'>for</span>( ; imsize.height--; p0 += step0, p1 += step1, bproj += bpstep )</td></tr>
<tr class="codeline" data-linenumber="1367"><td class="num" id="LN1367">1367</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1368"><td class="num" id="LN1368">1368</td><td class="line">                <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++, p0 += d0, p1 += d1 )</td></tr>
<tr class="codeline" data-linenumber="1369"><td class="num" id="LN1369">1369</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="1370"><td class="num" id="LN1370">1370</td><td class="line">                    <span class='keyword'>int</span> idx0 = cvFloor(*p0*a0 + b0);</td></tr>
<tr class="codeline" data-linenumber="1371"><td class="num" id="LN1371">1371</td><td class="line">                    <span class='keyword'>int</span> idx1 = cvFloor(*p1*a1 + b1);</td></tr>
<tr class="codeline" data-linenumber="1372"><td class="num" id="LN1372">1372</td><td class="line">                    bproj[x] = (<span class='keyword'>unsigned</span>)idx0 &lt; (<span class='keyword'>unsigned</span>)sz0 &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1373"><td class="num" id="LN1373">1373</td><td class="line">                               (<span class='keyword'>unsigned</span>)idx1 &lt; (<span class='keyword'>unsigned</span>)sz1 ?</td></tr>
<tr class="codeline" data-linenumber="1374"><td class="num" id="LN1374">1374</td><td class="line">                        saturate_cast&lt;BT&gt;(((<span class='keyword'>const</span> <span class='keyword'>float</span>*)(H + hstep0*idx0))[idx1]*scale) : 0;</td></tr>
<tr class="codeline" data-linenumber="1375"><td class="num" id="LN1375">1375</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1376"><td class="num" id="LN1376">1376</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1377"><td class="num" id="LN1377">1377</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1378"><td class="num" id="LN1378">1378</td><td class="line">        <span class='keyword'>else</span> <span class='keyword'>if</span>( dims == 3 )</td></tr>
<tr class="codeline" data-linenumber="1379"><td class="num" id="LN1379">1379</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1380"><td class="num" id="LN1380">1380</td><td class="line">            <span class='keyword'>double</span> a0 = uniranges[0], b0 = uniranges[1],</td></tr>
<tr class="codeline" data-linenumber="1381"><td class="num" id="LN1381">1381</td><td class="line">                   a1 = uniranges[2], b1 = uniranges[3],</td></tr>
<tr class="codeline" data-linenumber="1382"><td class="num" id="LN1382">1382</td><td class="line">                   a2 = uniranges[4], b2 = uniranges[5];</td></tr>
<tr class="codeline" data-linenumber="1383"><td class="num" id="LN1383">1383</td><td class="line">            <span class='keyword'>int</span> sz0 = size[0], sz1 = size[1], sz2 = size[2];</td></tr>
<tr class="codeline" data-linenumber="1384"><td class="num" id="LN1384">1384</td><td class="line">            <span class='keyword'>int</span> d0 = deltas[0], step0 = deltas[1],</td></tr>
<tr class="codeline" data-linenumber="1385"><td class="num" id="LN1385">1385</td><td class="line">                d1 = deltas[2], step1 = deltas[3],</td></tr>
<tr class="codeline" data-linenumber="1386"><td class="num" id="LN1386">1386</td><td class="line">                d2 = deltas[4], step2 = deltas[5];</td></tr>
<tr class="codeline" data-linenumber="1387"><td class="num" id="LN1387">1387</td><td class="line">            size_t hstep0 = hstep[0], hstep1 = hstep[1];</td></tr>
<tr class="codeline" data-linenumber="1388"><td class="num" id="LN1388">1388</td><td class="line">            <span class='keyword'>const</span> T* p0 = (<span class='keyword'>const</span> T*)ptrs[0];</td></tr>
<tr class="codeline" data-linenumber="1389"><td class="num" id="LN1389">1389</td><td class="line">            <span class='keyword'>const</span> T* p1 = (<span class='keyword'>const</span> T*)ptrs[1];</td></tr>
<tr class="codeline" data-linenumber="1390"><td class="num" id="LN1390">1390</td><td class="line">            <span class='keyword'>const</span> T* p2 = (<span class='keyword'>const</span> T*)ptrs[2];</td></tr>
<tr class="codeline" data-linenumber="1391"><td class="num" id="LN1391">1391</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1392"><td class="num" id="LN1392">1392</td><td class="line">            <span class='keyword'>for</span>( ; imsize.height--; p0 += step0, p1 += step1, p2 += step2, bproj += bpstep )</td></tr>
<tr class="codeline" data-linenumber="1393"><td class="num" id="LN1393">1393</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1394"><td class="num" id="LN1394">1394</td><td class="line">                <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++, p0 += d0, p1 += d1, p2 += d2 )</td></tr>
<tr class="codeline" data-linenumber="1395"><td class="num" id="LN1395">1395</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="1396"><td class="num" id="LN1396">1396</td><td class="line">                    <span class='keyword'>int</span> idx0 = cvFloor(*p0*a0 + b0);</td></tr>
<tr class="codeline" data-linenumber="1397"><td class="num" id="LN1397">1397</td><td class="line">                    <span class='keyword'>int</span> idx1 = cvFloor(*p1*a1 + b1);</td></tr>
<tr class="codeline" data-linenumber="1398"><td class="num" id="LN1398">1398</td><td class="line">                    <span class='keyword'>int</span> idx2 = cvFloor(*p2*a2 + b2);</td></tr>
<tr class="codeline" data-linenumber="1399"><td class="num" id="LN1399">1399</td><td class="line">                    bproj[x] = (<span class='keyword'>unsigned</span>)idx0 &lt; (<span class='keyword'>unsigned</span>)sz0 &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1400"><td class="num" id="LN1400">1400</td><td class="line">                               (<span class='keyword'>unsigned</span>)idx1 &lt; (<span class='keyword'>unsigned</span>)sz1 &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="1401"><td class="num" id="LN1401">1401</td><td class="line">                               (<span class='keyword'>unsigned</span>)idx2 &lt; (<span class='keyword'>unsigned</span>)sz2 ?</td></tr>
<tr class="codeline" data-linenumber="1402"><td class="num" id="LN1402">1402</td><td class="line">                        saturate_cast&lt;BT&gt;(((<span class='keyword'>const</span> <span class='keyword'>float</span>*)(H + hstep0*idx0 + hstep1*idx1))[idx2]*scale) : 0;</td></tr>
<tr class="codeline" data-linenumber="1403"><td class="num" id="LN1403">1403</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1404"><td class="num" id="LN1404">1404</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1405"><td class="num" id="LN1405">1405</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1406"><td class="num" id="LN1406">1406</td><td class="line">        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1407"><td class="num" id="LN1407">1407</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1408"><td class="num" id="LN1408">1408</td><td class="line">            <span class='keyword'>for</span>( ; imsize.height--; bproj += bpstep )</td></tr>
<tr class="codeline" data-linenumber="1409"><td class="num" id="LN1409">1409</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1410"><td class="num" id="LN1410">1410</td><td class="line">                <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++ )</td></tr>
<tr class="codeline" data-linenumber="1411"><td class="num" id="LN1411">1411</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="1412"><td class="num" id="LN1412">1412</td><td class="line">                    <span class='keyword'>const</span> uchar* Hptr = H;</td></tr>
<tr class="codeline" data-linenumber="1413"><td class="num" id="LN1413">1413</td><td class="line">                    <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1414"><td class="num" id="LN1414">1414</td><td class="line">                    {</td></tr>
<tr class="codeline" data-linenumber="1415"><td class="num" id="LN1415">1415</td><td class="line">                        <span class='keyword'>int</span> idx = cvFloor(*ptrs[i]*uniranges[i*2] + uniranges[i*2+1]);</td></tr>
<tr class="codeline" data-linenumber="1416"><td class="num" id="LN1416">1416</td><td class="line">                        <span class='keyword'>if</span>( (<span class='keyword'>unsigned</span>)idx &gt;= (<span class='keyword'>unsigned</span>)size[i] || (_ranges &amp;&amp; *ptrs[i] &gt;= _ranges[i][1]))</td></tr>
<tr class="codeline" data-linenumber="1417"><td class="num" id="LN1417">1417</td><td class="line">                            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1418"><td class="num" id="LN1418">1418</td><td class="line">                        ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="1419"><td class="num" id="LN1419">1419</td><td class="line">                        Hptr += idx*hstep[i];</td></tr>
<tr class="codeline" data-linenumber="1420"><td class="num" id="LN1420">1420</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="1421"><td class="num" id="LN1421">1421</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1422"><td class="num" id="LN1422">1422</td><td class="line">                    <span class='keyword'>if</span>( i == dims )</td></tr>
<tr class="codeline" data-linenumber="1423"><td class="num" id="LN1423">1423</td><td class="line">                        bproj[x] = saturate_cast&lt;BT&gt;(*(<span class='keyword'>const</span> <span class='keyword'>float</span>*)Hptr*scale);</td></tr>
<tr class="codeline" data-linenumber="1424"><td class="num" id="LN1424">1424</td><td class="line">                    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1425"><td class="num" id="LN1425">1425</td><td class="line">                    {</td></tr>
<tr class="codeline" data-linenumber="1426"><td class="num" id="LN1426">1426</td><td class="line">                        bproj[x] = 0;</td></tr>
<tr class="codeline" data-linenumber="1427"><td class="num" id="LN1427">1427</td><td class="line">                        <span class='keyword'>for</span>( ; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1428"><td class="num" id="LN1428">1428</td><td class="line">                            ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="1429"><td class="num" id="LN1429">1429</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="1430"><td class="num" id="LN1430">1430</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1431"><td class="num" id="LN1431">1431</td><td class="line">                <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1432"><td class="num" id="LN1432">1432</td><td class="line">                    ptrs[i] += deltas[i*2 + 1];</td></tr>
<tr class="codeline" data-linenumber="1433"><td class="num" id="LN1433">1433</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1434"><td class="num" id="LN1434">1434</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1435"><td class="num" id="LN1435">1435</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1436"><td class="num" id="LN1436">1436</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (_ranges)</td></tr>
<tr class="codeline" data-linenumber="1437"><td class="num" id="LN1437">1437</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1438"><td class="num" id="LN1438">1438</td><td class="line">        <span class='comment'>// non-uniform histogram</span></td></tr>
<tr class="codeline" data-linenumber="1439"><td class="num" id="LN1439">1439</td><td class="line">        <span class='keyword'>const</span> <span class='keyword'>float</span>* ranges[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>];</td></tr>
<tr class="codeline" data-linenumber="1440"><td class="num" id="LN1440">1440</td><td class="line">        <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1441"><td class="num" id="LN1441">1441</td><td class="line">            ranges[i] = &amp;_ranges[i][0];</td></tr>
<tr class="codeline" data-linenumber="1442"><td class="num" id="LN1442">1442</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1443"><td class="num" id="LN1443">1443</td><td class="line">        <span class='keyword'>for</span>( ; imsize.height--; bproj += bpstep )</td></tr>
<tr class="codeline" data-linenumber="1444"><td class="num" id="LN1444">1444</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1445"><td class="num" id="LN1445">1445</td><td class="line">            <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++ )</td></tr>
<tr class="codeline" data-linenumber="1446"><td class="num" id="LN1446">1446</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1447"><td class="num" id="LN1447">1447</td><td class="line">                <span class='keyword'>const</span> uchar* Hptr = H;</td></tr>
<tr class="codeline" data-linenumber="1448"><td class="num" id="LN1448">1448</td><td class="line">                <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1449"><td class="num" id="LN1449">1449</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="1450"><td class="num" id="LN1450">1450</td><td class="line">                    <span class='keyword'>float</span> v = (<span class='keyword'>float</span>)*ptrs[i];</td></tr>
<tr class="codeline" data-linenumber="1451"><td class="num" id="LN1451">1451</td><td class="line">                    <span class='keyword'>const</span> <span class='keyword'>float</span>* R = ranges[i];</td></tr>
<tr class="codeline" data-linenumber="1452"><td class="num" id="LN1452">1452</td><td class="line">                    <span class='keyword'>int</span> idx = -1, sz = size[i];</td></tr>
<tr class="codeline" data-linenumber="1453"><td class="num" id="LN1453">1453</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1454"><td class="num" id="LN1454">1454</td><td class="line">                    <span class='keyword'>while</span>( v &gt;= R[idx+1] &amp;&amp; ++idx &lt; sz )</td></tr>
<tr class="codeline" data-linenumber="1455"><td class="num" id="LN1455">1455</td><td class="line">                        ; <span class='comment'>// nop</span></td></tr>
<tr class="codeline" data-linenumber="1456"><td class="num" id="LN1456">1456</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1457"><td class="num" id="LN1457">1457</td><td class="line">                    <span class='keyword'>if</span>( (<span class='keyword'>unsigned</span>)idx &gt;= (<span class='keyword'>unsigned</span>)sz )</td></tr>
<tr class="codeline" data-linenumber="1458"><td class="num" id="LN1458">1458</td><td class="line">                        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1459"><td class="num" id="LN1459">1459</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1460"><td class="num" id="LN1460">1460</td><td class="line">                    ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="1461"><td class="num" id="LN1461">1461</td><td class="line">                    Hptr += idx*hstep[i];</td></tr>
<tr class="codeline" data-linenumber="1462"><td class="num" id="LN1462">1462</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1463"><td class="num" id="LN1463">1463</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1464"><td class="num" id="LN1464">1464</td><td class="line">                <span class='keyword'>if</span>( i == dims )</td></tr>
<tr class="codeline" data-linenumber="1465"><td class="num" id="LN1465">1465</td><td class="line">                    bproj[x] = saturate_cast&lt;BT&gt;(*(<span class='keyword'>const</span> <span class='keyword'>float</span>*)Hptr*scale);</td></tr>
<tr class="codeline" data-linenumber="1466"><td class="num" id="LN1466">1466</td><td class="line">                <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1467"><td class="num" id="LN1467">1467</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="1468"><td class="num" id="LN1468">1468</td><td class="line">                    bproj[x] = 0;</td></tr>
<tr class="codeline" data-linenumber="1469"><td class="num" id="LN1469">1469</td><td class="line">                    <span class='keyword'>for</span>( ; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1470"><td class="num" id="LN1470">1470</td><td class="line">                        ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="1471"><td class="num" id="LN1471">1471</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1472"><td class="num" id="LN1472">1472</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1473"><td class="num" id="LN1473">1473</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1474"><td class="num" id="LN1474">1474</td><td class="line">            <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1475"><td class="num" id="LN1475">1475</td><td class="line">                ptrs[i] += deltas[i*2 + 1];</td></tr>
<tr class="codeline" data-linenumber="1476"><td class="num" id="LN1476">1476</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1477"><td class="num" id="LN1477">1477</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1478"><td class="num" id="LN1478">1478</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1479"><td class="num" id="LN1479">1479</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1480"><td class="num" id="LN1480">1480</td><td class="line">        <span class='macro'>CV_Error(Error::StsBadArg, <span class='string_literal'>"Either ranges, either uniform ranges should be provided"</span>)<span class='macro_popup'>do { (void)(Error::StsBadArg); (void)("Either ranges, either uniform ranges should be provided"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1481"><td class="num" id="LN1481">1481</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1482"><td class="num" id="LN1482">1482</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1483"><td class="num" id="LN1483">1483</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1484"><td class="num" id="LN1484">1484</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1485"><td class="num" id="LN1485">1485</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="1486"><td class="num" id="LN1486">1486</td><td class="line">calcBackProj_8u( std::vector&lt;uchar*&gt;&amp; _ptrs, <span class='keyword'>const</span> std::vector&lt;<span class='keyword'>int</span>&gt;&amp; _deltas,</td></tr>
<tr class="codeline" data-linenumber="1487"><td class="num" id="LN1487">1487</td><td class="line">                 Size imsize, <span class='keyword'>const</span> Mat&amp; hist, <span class='keyword'>int</span> dims, <span class='keyword'>const</span> <span class='keyword'>float</span>** _ranges,</td></tr>
<tr class="codeline" data-linenumber="1488"><td class="num" id="LN1488">1488</td><td class="line">                 <span class='keyword'>const</span> <span class='keyword'>double</span>* _uniranges, <span class='keyword'>float</span> scale, <span class='keyword'>bool</span> uniform )</td></tr>
<tr class="codeline" data-linenumber="1489"><td class="num" id="LN1489">1489</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1490"><td class="num" id="LN1490">1490</td><td class="line">    uchar** ptrs = &amp;_ptrs[0];</td></tr>
<tr class="codeline" data-linenumber="1491"><td class="num" id="LN1491">1491</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>int</span>* deltas = &amp;_deltas[0];</td></tr>
<tr class="codeline" data-linenumber="1492"><td class="num" id="LN1492">1492</td><td class="line">    <span class='keyword'>const</span> uchar* H = hist.ptr();</td></tr>
<tr class="codeline" data-linenumber="1493"><td class="num" id="LN1493">1493</td><td class="line">    <span class='keyword'>int</span> i, x;</td></tr>
<tr class="codeline" data-linenumber="1494"><td class="num" id="LN1494">1494</td><td class="line">    uchar* bproj = _ptrs[dims];</td></tr>
<tr class="codeline" data-linenumber="1495"><td class="num" id="LN1495">1495</td><td class="line">    <span class='keyword'>int</span> bpstep = _deltas[dims*2 + 1];</td></tr>
<tr class="codeline" data-linenumber="1496"><td class="num" id="LN1496">1496</td><td class="line">    std::vector&lt;size_t&gt; _tab;</td></tr>
<tr class="codeline" data-linenumber="1497"><td class="num" id="LN1497">1497</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1498"><td class="num" id="LN1498">1498</td><td class="line">    calcHistLookupTables_8u( hist, SparseMat(), dims, _ranges, _uniranges, uniform, <span class='keyword'>false</span>, _tab );</td></tr>
<tr class="codeline" data-linenumber="1499"><td class="num" id="LN1499">1499</td><td class="line">    <span class='keyword'>const</span> size_t* tab = &amp;_tab[0];</td></tr>
<tr class="codeline" data-linenumber="1500"><td class="num" id="LN1500">1500</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1501"><td class="num" id="LN1501">1501</td><td class="line">    <span class='keyword'>if</span>( dims == 1 )</td></tr>
<tr class="codeline" data-linenumber="1502"><td class="num" id="LN1502">1502</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1503"><td class="num" id="LN1503">1503</td><td class="line">        <span class='keyword'>int</span> d0 = deltas[0], step0 = deltas[1];</td></tr>
<tr class="codeline" data-linenumber="1504"><td class="num" id="LN1504">1504</td><td class="line">        uchar matH[256] = {0};</td></tr>
<tr class="codeline" data-linenumber="1505"><td class="num" id="LN1505">1505</td><td class="line">        <span class='keyword'>const</span> uchar* p0 = (<span class='keyword'>const</span> uchar*)ptrs[0];</td></tr>
<tr class="codeline" data-linenumber="1506"><td class="num" id="LN1506">1506</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1507"><td class="num" id="LN1507">1507</td><td class="line">        <span class='keyword'>for</span>( i = 0; i &lt; 256; i++ )</td></tr>
<tr class="codeline" data-linenumber="1508"><td class="num" id="LN1508">1508</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1509"><td class="num" id="LN1509">1509</td><td class="line">            size_t hidx = tab[i];</td></tr>
<tr class="codeline" data-linenumber="1510"><td class="num" id="LN1510">1510</td><td class="line">            <span class='keyword'>if</span>( hidx &lt; OUT_OF_RANGE )</td></tr>
<tr class="codeline" data-linenumber="1511"><td class="num" id="LN1511">1511</td><td class="line">                matH[i] = saturate_cast&lt;uchar&gt;(*(<span class='keyword'>float</span>*)(H + hidx)*scale);</td></tr>
<tr class="codeline" data-linenumber="1512"><td class="num" id="LN1512">1512</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1513"><td class="num" id="LN1513">1513</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1514"><td class="num" id="LN1514">1514</td><td class="line">        <span class='keyword'>for</span>( ; imsize.height--; p0 += step0, bproj += bpstep )</td></tr>
<tr class="codeline" data-linenumber="1515"><td class="num" id="LN1515">1515</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1516"><td class="num" id="LN1516">1516</td><td class="line">            <span class='keyword'>if</span>( d0 == 1 )</td></tr>
<tr class="codeline" data-linenumber="1517"><td class="num" id="LN1517">1517</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1518"><td class="num" id="LN1518">1518</td><td class="line">                <span class='keyword'>for</span>( x = 0; x &lt;= imsize.width - 4; x += 4 )</td></tr>
<tr class="codeline" data-linenumber="1519"><td class="num" id="LN1519">1519</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="1520"><td class="num" id="LN1520">1520</td><td class="line">                    uchar t0 = matH[p0[x]], t1 = matH[p0[x+1]];</td></tr>
<tr class="codeline" data-linenumber="1521"><td class="num" id="LN1521">1521</td><td class="line">                    bproj[x] = t0; bproj[x+1] = t1;</td></tr>
<tr class="codeline" data-linenumber="1522"><td class="num" id="LN1522">1522</td><td class="line">                    t0 = matH[p0[x+2]]; t1 = matH[p0[x+3]];</td></tr>
<tr class="codeline" data-linenumber="1523"><td class="num" id="LN1523">1523</td><td class="line">                    bproj[x+2] = t0; bproj[x+3] = t1;</td></tr>
<tr class="codeline" data-linenumber="1524"><td class="num" id="LN1524">1524</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1525"><td class="num" id="LN1525">1525</td><td class="line">                p0 += x;</td></tr>
<tr class="codeline" data-linenumber="1526"><td class="num" id="LN1526">1526</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1527"><td class="num" id="LN1527">1527</td><td class="line">            <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1528"><td class="num" id="LN1528">1528</td><td class="line">                <span class='keyword'>for</span>( x = 0; x &lt;= imsize.width - 4; x += 4 )</td></tr>
<tr class="codeline" data-linenumber="1529"><td class="num" id="LN1529">1529</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="1530"><td class="num" id="LN1530">1530</td><td class="line">                    uchar t0 = matH[p0[0]], t1 = matH[p0[d0]];</td></tr>
<tr class="codeline" data-linenumber="1531"><td class="num" id="LN1531">1531</td><td class="line">                    bproj[x] = t0; bproj[x+1] = t1;</td></tr>
<tr class="codeline" data-linenumber="1532"><td class="num" id="LN1532">1532</td><td class="line">                    p0 += d0*2;</td></tr>
<tr class="codeline" data-linenumber="1533"><td class="num" id="LN1533">1533</td><td class="line">                    t0 = matH[p0[0]]; t1 = matH[p0[d0]];</td></tr>
<tr class="codeline" data-linenumber="1534"><td class="num" id="LN1534">1534</td><td class="line">                    bproj[x+2] = t0; bproj[x+3] = t1;</td></tr>
<tr class="codeline" data-linenumber="1535"><td class="num" id="LN1535">1535</td><td class="line">                    p0 += d0*2;</td></tr>
<tr class="codeline" data-linenumber="1536"><td class="num" id="LN1536">1536</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1537"><td class="num" id="LN1537">1537</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1538"><td class="num" id="LN1538">1538</td><td class="line">            <span class='keyword'>for</span>( ; x &lt; imsize.width; x++, p0 += d0 )</td></tr>
<tr class="codeline" data-linenumber="1539"><td class="num" id="LN1539">1539</td><td class="line">                bproj[x] = matH[*p0];</td></tr>
<tr class="codeline" data-linenumber="1540"><td class="num" id="LN1540">1540</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1541"><td class="num" id="LN1541">1541</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1542"><td class="num" id="LN1542">1542</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span>( dims == 2 )</td></tr>
<tr class="codeline" data-linenumber="1543"><td class="num" id="LN1543">1543</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1544"><td class="num" id="LN1544">1544</td><td class="line">        <span class='keyword'>int</span> d0 = deltas[0], step0 = deltas[1],</td></tr>
<tr class="codeline" data-linenumber="1545"><td class="num" id="LN1545">1545</td><td class="line">            d1 = deltas[2], step1 = deltas[3];</td></tr>
<tr class="codeline" data-linenumber="1546"><td class="num" id="LN1546">1546</td><td class="line">        <span class='keyword'>const</span> uchar* p0 = (<span class='keyword'>const</span> uchar*)ptrs[0];</td></tr>
<tr class="codeline" data-linenumber="1547"><td class="num" id="LN1547">1547</td><td class="line">        <span class='keyword'>const</span> uchar* p1 = (<span class='keyword'>const</span> uchar*)ptrs[1];</td></tr>
<tr class="codeline" data-linenumber="1548"><td class="num" id="LN1548">1548</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1549"><td class="num" id="LN1549">1549</td><td class="line">        <span class='keyword'>for</span>( ; imsize.height--; p0 += step0, p1 += step1, bproj += bpstep )</td></tr>
<tr class="codeline" data-linenumber="1550"><td class="num" id="LN1550">1550</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1551"><td class="num" id="LN1551">1551</td><td class="line">            <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++, p0 += d0, p1 += d1 )</td></tr>
<tr class="codeline" data-linenumber="1552"><td class="num" id="LN1552">1552</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1553"><td class="num" id="LN1553">1553</td><td class="line">                size_t idx = tab[*p0] + tab[*p1 + 256];</td></tr>
<tr class="codeline" data-linenumber="1554"><td class="num" id="LN1554">1554</td><td class="line">                bproj[x] = idx &lt; OUT_OF_RANGE ? saturate_cast&lt;uchar&gt;(*(<span class='keyword'>const</span> <span class='keyword'>float</span>*)(H + idx)*scale) : 0;</td></tr>
<tr class="codeline" data-linenumber="1555"><td class="num" id="LN1555">1555</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1556"><td class="num" id="LN1556">1556</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1557"><td class="num" id="LN1557">1557</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1558"><td class="num" id="LN1558">1558</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span>( dims == 3 )</td></tr>
<tr class="codeline" data-linenumber="1559"><td class="num" id="LN1559">1559</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1560"><td class="num" id="LN1560">1560</td><td class="line">        <span class='keyword'>int</span> d0 = deltas[0], step0 = deltas[1],</td></tr>
<tr class="codeline" data-linenumber="1561"><td class="num" id="LN1561">1561</td><td class="line">        d1 = deltas[2], step1 = deltas[3],</td></tr>
<tr class="codeline" data-linenumber="1562"><td class="num" id="LN1562">1562</td><td class="line">        d2 = deltas[4], step2 = deltas[5];</td></tr>
<tr class="codeline" data-linenumber="1563"><td class="num" id="LN1563">1563</td><td class="line">        <span class='keyword'>const</span> uchar* p0 = (<span class='keyword'>const</span> uchar*)ptrs[0];</td></tr>
<tr class="codeline" data-linenumber="1564"><td class="num" id="LN1564">1564</td><td class="line">        <span class='keyword'>const</span> uchar* p1 = (<span class='keyword'>const</span> uchar*)ptrs[1];</td></tr>
<tr class="codeline" data-linenumber="1565"><td class="num" id="LN1565">1565</td><td class="line">        <span class='keyword'>const</span> uchar* p2 = (<span class='keyword'>const</span> uchar*)ptrs[2];</td></tr>
<tr class="codeline" data-linenumber="1566"><td class="num" id="LN1566">1566</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1567"><td class="num" id="LN1567">1567</td><td class="line">        <span class='keyword'>for</span>( ; imsize.height--; p0 += step0, p1 += step1, p2 += step2, bproj += bpstep )</td></tr>
<tr class="codeline" data-linenumber="1568"><td class="num" id="LN1568">1568</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1569"><td class="num" id="LN1569">1569</td><td class="line">            <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++, p0 += d0, p1 += d1, p2 += d2 )</td></tr>
<tr class="codeline" data-linenumber="1570"><td class="num" id="LN1570">1570</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1571"><td class="num" id="LN1571">1571</td><td class="line">                size_t idx = tab[*p0] + tab[*p1 + 256] + tab[*p2 + 512];</td></tr>
<tr class="codeline" data-linenumber="1572"><td class="num" id="LN1572">1572</td><td class="line">                bproj[x] = idx &lt; OUT_OF_RANGE ? saturate_cast&lt;uchar&gt;(*(<span class='keyword'>const</span> <span class='keyword'>float</span>*)(H + idx)*scale) : 0;</td></tr>
<tr class="codeline" data-linenumber="1573"><td class="num" id="LN1573">1573</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1574"><td class="num" id="LN1574">1574</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1575"><td class="num" id="LN1575">1575</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1576"><td class="num" id="LN1576">1576</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1577"><td class="num" id="LN1577">1577</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1578"><td class="num" id="LN1578">1578</td><td class="line">        <span class='keyword'>for</span>( ; imsize.height--; bproj += bpstep )</td></tr>
<tr class="codeline" data-linenumber="1579"><td class="num" id="LN1579">1579</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1580"><td class="num" id="LN1580">1580</td><td class="line">            <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++ )</td></tr>
<tr class="codeline" data-linenumber="1581"><td class="num" id="LN1581">1581</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1582"><td class="num" id="LN1582">1582</td><td class="line">                <span class='keyword'>const</span> uchar* Hptr = H;</td></tr>
<tr class="codeline" data-linenumber="1583"><td class="num" id="LN1583">1583</td><td class="line">                <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1584"><td class="num" id="LN1584">1584</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="1585"><td class="num" id="LN1585">1585</td><td class="line">                    size_t idx = tab[*ptrs[i] + i*256];</td></tr>
<tr class="codeline" data-linenumber="1586"><td class="num" id="LN1586">1586</td><td class="line">                    <span class='keyword'>if</span>( idx &gt;= OUT_OF_RANGE )</td></tr>
<tr class="codeline" data-linenumber="1587"><td class="num" id="LN1587">1587</td><td class="line">                        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1588"><td class="num" id="LN1588">1588</td><td class="line">                    ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="1589"><td class="num" id="LN1589">1589</td><td class="line">                    Hptr += idx;</td></tr>
<tr class="codeline" data-linenumber="1590"><td class="num" id="LN1590">1590</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1591"><td class="num" id="LN1591">1591</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1592"><td class="num" id="LN1592">1592</td><td class="line">                <span class='keyword'>if</span>( i == dims )</td></tr>
<tr class="codeline" data-linenumber="1593"><td class="num" id="LN1593">1593</td><td class="line">                    bproj[x] = saturate_cast&lt;uchar&gt;(*(<span class='keyword'>const</span> <span class='keyword'>float</span>*)Hptr*scale);</td></tr>
<tr class="codeline" data-linenumber="1594"><td class="num" id="LN1594">1594</td><td class="line">                <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1595"><td class="num" id="LN1595">1595</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="1596"><td class="num" id="LN1596">1596</td><td class="line">                    bproj[x] = 0;</td></tr>
<tr class="codeline" data-linenumber="1597"><td class="num" id="LN1597">1597</td><td class="line">                    <span class='keyword'>for</span>( ; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1598"><td class="num" id="LN1598">1598</td><td class="line">                        ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="1599"><td class="num" id="LN1599">1599</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1600"><td class="num" id="LN1600">1600</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1601"><td class="num" id="LN1601">1601</td><td class="line">            <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1602"><td class="num" id="LN1602">1602</td><td class="line">                ptrs[i] += deltas[i*2 + 1];</td></tr>
<tr class="codeline" data-linenumber="1603"><td class="num" id="LN1603">1603</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1604"><td class="num" id="LN1604">1604</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1605"><td class="num" id="LN1605">1605</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1606"><td class="num" id="LN1606">1606</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1607"><td class="num" id="LN1607">1607</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1608"><td class="num" id="LN1608">1608</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1609"><td class="num" id="LN1609">1609</td><td class="line"><span class='keyword'>void</span> cv::calcBackProject( <span class='keyword'>const</span> Mat* images, <span class='keyword'>int</span> nimages, <span class='keyword'>const</span> <span class='keyword'>int</span>* channels,</td></tr>
<tr class="codeline" data-linenumber="1610"><td class="num" id="LN1610">1610</td><td class="line">                          InputArray _hist, OutputArray _backProject,</td></tr>
<tr class="codeline" data-linenumber="1611"><td class="num" id="LN1611">1611</td><td class="line">                          <span class='keyword'>const</span> <span class='keyword'>float</span>** ranges, <span class='keyword'>double</span> scale, <span class='keyword'>bool</span> uniform )</td></tr>
<tr class="codeline" data-linenumber="1612"><td class="num" id="LN1612">1612</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1613"><td class="num" id="LN1613">1613</td><td class="line">    <span class='macro'>CV_INSTRUMENT_REGION()<span class='macro_popup'>; static cv::utils::trace::details::Region::LocationExtraData<br>* __cv_trace_location_extra_fn1613 = 0; static const cv::utils<br>::trace::details::Region::LocationStaticStorage __cv_trace_location_fn1613<br> = { &amp;(__cv_trace_location_extra_fn1613), __PRETTY_FUNCTION__<br>, "/home/zhh/projects/opencv-4.5.2/modules/imgproc/src/histogram.cpp"<br>, 1613, ((0) | cv::utils::trace::details::REGION_FLAG_FUNCTION<br>)};; const cv::utils::trace::details::Region __region_fn(__cv_trace_location_fn1613<br>);;</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1614"><td class="num" id="LN1614">1614</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1615"><td class="num" id="LN1615">1615</td><td class="line">    <span class='macro'>CV_Assert(images &amp;&amp; nimages &gt; 0)<span class='macro_popup'>do { if (!(images &amp;&amp; nimages &gt; 0)) abort(); } while<br> (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1616"><td class="num" id="LN1616">1616</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1617"><td class="num" id="LN1617">1617</td><td class="line">    Mat hist = _hist.getMat();</td></tr>
<tr class="codeline" data-linenumber="1618"><td class="num" id="LN1618">1618</td><td class="line">    std::vector&lt;uchar*&gt; ptrs;</td></tr>
<tr class="codeline" data-linenumber="1619"><td class="num" id="LN1619">1619</td><td class="line">    std::vector&lt;<span class='keyword'>int</span>&gt; deltas;</td></tr>
<tr class="codeline" data-linenumber="1620"><td class="num" id="LN1620">1620</td><td class="line">    std::vector&lt;<span class='keyword'>double</span>&gt; uniranges;</td></tr>
<tr class="codeline" data-linenumber="1621"><td class="num" id="LN1621">1621</td><td class="line">    Size imsize;</td></tr>
<tr class="codeline" data-linenumber="1622"><td class="num" id="LN1622">1622</td><td class="line">    <span class='keyword'>int</span> dims = hist.dims == 2 &amp;&amp; hist.size[1] == 1 ? 1 : hist.dims;</td></tr>
<tr class="codeline" data-linenumber="1623"><td class="num" id="LN1623">1623</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1624"><td class="num" id="LN1624">1624</td><td class="line">    <span class='macro'>CV_Assert( dims &gt; 0 &amp;&amp; !hist.empty() )<span class='macro_popup'>do { if (!(dims &gt; 0 &amp;&amp; !hist.empty())) abort(); } while<br> (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1625"><td class="num" id="LN1625">1625</td><td class="line">    _backProject.create( images[0].size(), images[0].depth() );</td></tr>
<tr class="codeline" data-linenumber="1626"><td class="num" id="LN1626">1626</td><td class="line">    Mat backProject = _backProject.getMat();</td></tr>
<tr class="codeline" data-linenumber="1627"><td class="num" id="LN1627">1627</td><td class="line">    histPrepareImages( images, nimages, channels, backProject, dims, hist.size, ranges,</td></tr>
<tr class="codeline" data-linenumber="1628"><td class="num" id="LN1628">1628</td><td class="line">                       uniform, ptrs, deltas, imsize, uniranges );</td></tr>
<tr class="codeline" data-linenumber="1629"><td class="num" id="LN1629">1629</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>double</span>* _uniranges = uniform ? &amp;uniranges[0] : 0;</td></tr>
<tr class="codeline" data-linenumber="1630"><td class="num" id="LN1630">1630</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1631"><td class="num" id="LN1631">1631</td><td class="line">    <span class='keyword'>int</span> depth = images[0].depth();</td></tr>
<tr class="codeline" data-linenumber="1632"><td class="num" id="LN1632">1632</td><td class="line">    <span class='keyword'>if</span>( depth == <span class='macro'>CV_8U<span class='macro_popup'>0</span></span> )</td></tr>
<tr class="codeline" data-linenumber="1633"><td class="num" id="LN1633">1633</td><td class="line">        calcBackProj_8u(ptrs, deltas, imsize, hist, dims, ranges, _uniranges, (<span class='keyword'>float</span>)scale, uniform);</td></tr>
<tr class="codeline" data-linenumber="1634"><td class="num" id="LN1634">1634</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span>( depth == <span class='macro'>CV_16U<span class='macro_popup'>2</span></span> )</td></tr>
<tr class="codeline" data-linenumber="1635"><td class="num" id="LN1635">1635</td><td class="line">        calcBackProj_&lt;ushort, ushort&gt;(ptrs, deltas, imsize, hist, dims, ranges, _uniranges, (<span class='keyword'>float</span>)scale, uniform );</td></tr>
<tr class="codeline" data-linenumber="1636"><td class="num" id="LN1636">1636</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span>( depth == <span class='macro'>CV_32F<span class='macro_popup'>5</span></span> )</td></tr>
<tr class="codeline" data-linenumber="1637"><td class="num" id="LN1637">1637</td><td class="line">        calcBackProj_&lt;<span class='keyword'>float</span>, <span class='keyword'>float</span>&gt;(ptrs, deltas, imsize, hist, dims, ranges, _uniranges, (<span class='keyword'>float</span>)scale, uniform );</td></tr>
<tr class="codeline" data-linenumber="1638"><td class="num" id="LN1638">1638</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1639"><td class="num" id="LN1639">1639</td><td class="line">        <span class='macro'>CV_Error(CV_StsUnsupportedFormat, <span class='string_literal'>""</span>)<span class='macro_popup'>do { (void)(CV_StsUnsupportedFormat); (void)(""); abort(); } while<br> (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1640"><td class="num" id="LN1640">1640</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1641"><td class="num" id="LN1641">1641</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1642"><td class="num" id="LN1642">1642</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1643"><td class="num" id="LN1643">1643</td><td class="line"><span class='keyword'>namespace</span> cv</td></tr>
<tr class="codeline" data-linenumber="1644"><td class="num" id="LN1644">1644</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1645"><td class="num" id="LN1645">1645</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1646"><td class="num" id="LN1646">1646</td><td class="line"><span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> T, <span class='keyword'>typename</span> BT&gt; <span class='keyword'>static</span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="1647"><td class="num" id="LN1647">1647</td><td class="line">calcSparseBackProj_( std::vector&lt;uchar*&gt;&amp; _ptrs, <span class='keyword'>const</span> std::vector&lt;<span class='keyword'>int</span>&gt;&amp; _deltas,</td></tr>
<tr class="codeline" data-linenumber="1648"><td class="num" id="LN1648">1648</td><td class="line">                     Size imsize, <span class='keyword'>const</span> SparseMat&amp; hist, <span class='keyword'>int</span> dims, <span class='keyword'>const</span> <span class='keyword'>float</span>** _ranges,</td></tr>
<tr class="codeline" data-linenumber="1649"><td class="num" id="LN1649">1649</td><td class="line">                     <span class='keyword'>const</span> <span class='keyword'>double</span>* _uniranges, <span class='keyword'>float</span> scale, <span class='keyword'>bool</span> uniform )</td></tr>
<tr class="codeline" data-linenumber="1650"><td class="num" id="LN1650">1650</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1651"><td class="num" id="LN1651">1651</td><td class="line">    T** ptrs = (T**)&amp;_ptrs[0];</td></tr>
<tr class="codeline" data-linenumber="1652"><td class="num" id="LN1652">1652</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>int</span>* deltas = &amp;_deltas[0];</td></tr>
<tr class="codeline" data-linenumber="1653"><td class="num" id="LN1653">1653</td><td class="line">    <span class='keyword'>int</span> i, x;</td></tr>
<tr class="codeline" data-linenumber="1654"><td class="num" id="LN1654">1654</td><td class="line">    BT* bproj = (BT*)_ptrs[dims];</td></tr>
<tr class="codeline" data-linenumber="1655"><td class="num" id="LN1655">1655</td><td class="line">    <span class='keyword'>int</span> bpstep = _deltas[dims*2 + 1];</td></tr>
<tr class="codeline" data-linenumber="1656"><td class="num" id="LN1656">1656</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>int</span>* size = hist.hdr-&gt;size;</td></tr>
<tr class="codeline" data-linenumber="1657"><td class="num" id="LN1657">1657</td><td class="line">    <span class='keyword'>int</span> idx[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>];</td></tr>
<tr class="codeline" data-linenumber="1658"><td class="num" id="LN1658">1658</td><td class="line">    <span class='keyword'>const</span> SparseMat_&lt;<span class='keyword'>float</span>&gt;&amp; hist_ = (<span class='keyword'>const</span> SparseMat_&lt;<span class='keyword'>float</span>&gt;&amp;)hist;</td></tr>
<tr class="codeline" data-linenumber="1659"><td class="num" id="LN1659">1659</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1660"><td class="num" id="LN1660">1660</td><td class="line">    <span class='keyword'>if</span>( uniform )</td></tr>
<tr class="codeline" data-linenumber="1661"><td class="num" id="LN1661">1661</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1662"><td class="num" id="LN1662">1662</td><td class="line">        <span class='keyword'>const</span> <span class='keyword'>double</span>* uniranges = &amp;_uniranges[0];</td></tr>
<tr class="codeline" data-linenumber="1663"><td class="num" id="LN1663">1663</td><td class="line">        <span class='keyword'>for</span>( ; imsize.height--; bproj += bpstep )</td></tr>
<tr class="codeline" data-linenumber="1664"><td class="num" id="LN1664">1664</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1665"><td class="num" id="LN1665">1665</td><td class="line">            <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++ )</td></tr>
<tr class="codeline" data-linenumber="1666"><td class="num" id="LN1666">1666</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1667"><td class="num" id="LN1667">1667</td><td class="line">                <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1668"><td class="num" id="LN1668">1668</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="1669"><td class="num" id="LN1669">1669</td><td class="line">                    idx[i] = cvFloor(*ptrs[i]*uniranges[i*2] + uniranges[i*2+1]);</td></tr>
<tr class="codeline" data-linenumber="1670"><td class="num" id="LN1670">1670</td><td class="line">                    <span class='keyword'>if</span>( (<span class='keyword'>unsigned</span>)idx[i] &gt;= (<span class='keyword'>unsigned</span>)size[i] )</td></tr>
<tr class="codeline" data-linenumber="1671"><td class="num" id="LN1671">1671</td><td class="line">                        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1672"><td class="num" id="LN1672">1672</td><td class="line">                    ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="1673"><td class="num" id="LN1673">1673</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1674"><td class="num" id="LN1674">1674</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1675"><td class="num" id="LN1675">1675</td><td class="line">                <span class='keyword'>if</span>( i == dims )</td></tr>
<tr class="codeline" data-linenumber="1676"><td class="num" id="LN1676">1676</td><td class="line">                    bproj[x] = saturate_cast&lt;BT&gt;(hist_(idx)*scale);</td></tr>
<tr class="codeline" data-linenumber="1677"><td class="num" id="LN1677">1677</td><td class="line">                <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1678"><td class="num" id="LN1678">1678</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="1679"><td class="num" id="LN1679">1679</td><td class="line">                    bproj[x] = 0;</td></tr>
<tr class="codeline" data-linenumber="1680"><td class="num" id="LN1680">1680</td><td class="line">                    <span class='keyword'>for</span>( ; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1681"><td class="num" id="LN1681">1681</td><td class="line">                        ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="1682"><td class="num" id="LN1682">1682</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1683"><td class="num" id="LN1683">1683</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1684"><td class="num" id="LN1684">1684</td><td class="line">            <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1685"><td class="num" id="LN1685">1685</td><td class="line">                ptrs[i] += deltas[i*2 + 1];</td></tr>
<tr class="codeline" data-linenumber="1686"><td class="num" id="LN1686">1686</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1687"><td class="num" id="LN1687">1687</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1688"><td class="num" id="LN1688">1688</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (_ranges)</td></tr>
<tr class="codeline" data-linenumber="1689"><td class="num" id="LN1689">1689</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1690"><td class="num" id="LN1690">1690</td><td class="line">        <span class='comment'>// non-uniform histogram</span></td></tr>
<tr class="codeline" data-linenumber="1691"><td class="num" id="LN1691">1691</td><td class="line">        <span class='keyword'>const</span> <span class='keyword'>float</span>* ranges[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>];</td></tr>
<tr class="codeline" data-linenumber="1692"><td class="num" id="LN1692">1692</td><td class="line">        <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1693"><td class="num" id="LN1693">1693</td><td class="line">            ranges[i] = &amp;_ranges[i][0];</td></tr>
<tr class="codeline" data-linenumber="1694"><td class="num" id="LN1694">1694</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1695"><td class="num" id="LN1695">1695</td><td class="line">        <span class='keyword'>for</span>( ; imsize.height--; bproj += bpstep )</td></tr>
<tr class="codeline" data-linenumber="1696"><td class="num" id="LN1696">1696</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1697"><td class="num" id="LN1697">1697</td><td class="line">            <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++ )</td></tr>
<tr class="codeline" data-linenumber="1698"><td class="num" id="LN1698">1698</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1699"><td class="num" id="LN1699">1699</td><td class="line">                <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1700"><td class="num" id="LN1700">1700</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="1701"><td class="num" id="LN1701">1701</td><td class="line">                    <span class='keyword'>float</span> v = (<span class='keyword'>float</span>)*ptrs[i];</td></tr>
<tr class="codeline" data-linenumber="1702"><td class="num" id="LN1702">1702</td><td class="line">                    <span class='keyword'>const</span> <span class='keyword'>float</span>* R = ranges[i];</td></tr>
<tr class="codeline" data-linenumber="1703"><td class="num" id="LN1703">1703</td><td class="line">                    <span class='keyword'>int</span> j = -1, sz = size[i];</td></tr>
<tr class="codeline" data-linenumber="1704"><td class="num" id="LN1704">1704</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1705"><td class="num" id="LN1705">1705</td><td class="line">                    <span class='keyword'>while</span>( v &gt;= R[j+1] &amp;&amp; ++j &lt; sz )</td></tr>
<tr class="codeline" data-linenumber="1706"><td class="num" id="LN1706">1706</td><td class="line">                        ; <span class='comment'>// nop</span></td></tr>
<tr class="codeline" data-linenumber="1707"><td class="num" id="LN1707">1707</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1708"><td class="num" id="LN1708">1708</td><td class="line">                    <span class='keyword'>if</span>( (<span class='keyword'>unsigned</span>)j &gt;= (<span class='keyword'>unsigned</span>)sz )</td></tr>
<tr class="codeline" data-linenumber="1709"><td class="num" id="LN1709">1709</td><td class="line">                        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1710"><td class="num" id="LN1710">1710</td><td class="line">                    idx[i] = j;</td></tr>
<tr class="codeline" data-linenumber="1711"><td class="num" id="LN1711">1711</td><td class="line">                    ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="1712"><td class="num" id="LN1712">1712</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1713"><td class="num" id="LN1713">1713</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1714"><td class="num" id="LN1714">1714</td><td class="line">                <span class='keyword'>if</span>( i == dims )</td></tr>
<tr class="codeline" data-linenumber="1715"><td class="num" id="LN1715">1715</td><td class="line">                    bproj[x] = saturate_cast&lt;BT&gt;(hist_(idx)*scale);</td></tr>
<tr class="codeline" data-linenumber="1716"><td class="num" id="LN1716">1716</td><td class="line">                <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1717"><td class="num" id="LN1717">1717</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="1718"><td class="num" id="LN1718">1718</td><td class="line">                    bproj[x] = 0;</td></tr>
<tr class="codeline" data-linenumber="1719"><td class="num" id="LN1719">1719</td><td class="line">                    <span class='keyword'>for</span>( ; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1720"><td class="num" id="LN1720">1720</td><td class="line">                        ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="1721"><td class="num" id="LN1721">1721</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1722"><td class="num" id="LN1722">1722</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1723"><td class="num" id="LN1723">1723</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1724"><td class="num" id="LN1724">1724</td><td class="line">            <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1725"><td class="num" id="LN1725">1725</td><td class="line">                ptrs[i] += deltas[i*2 + 1];</td></tr>
<tr class="codeline" data-linenumber="1726"><td class="num" id="LN1726">1726</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1727"><td class="num" id="LN1727">1727</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1728"><td class="num" id="LN1728">1728</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1729"><td class="num" id="LN1729">1729</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1730"><td class="num" id="LN1730">1730</td><td class="line">        <span class='macro'>CV_Error(Error::StsBadArg, <span class='string_literal'>"Either ranges, either uniform ranges should be provided"</span>)<span class='macro_popup'>do { (void)(Error::StsBadArg); (void)("Either ranges, either uniform ranges should be provided"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1731"><td class="num" id="LN1731">1731</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1732"><td class="num" id="LN1732">1732</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1733"><td class="num" id="LN1733">1733</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1734"><td class="num" id="LN1734">1734</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1735"><td class="num" id="LN1735">1735</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="1736"><td class="num" id="LN1736">1736</td><td class="line">calcSparseBackProj_8u( std::vector&lt;uchar*&gt;&amp; _ptrs, <span class='keyword'>const</span> std::vector&lt;<span class='keyword'>int</span>&gt;&amp; _deltas,</td></tr>
<tr class="codeline" data-linenumber="1737"><td class="num" id="LN1737">1737</td><td class="line">                       Size imsize, <span class='keyword'>const</span> SparseMat&amp; hist, <span class='keyword'>int</span> dims, <span class='keyword'>const</span> <span class='keyword'>float</span>** _ranges,</td></tr>
<tr class="codeline" data-linenumber="1738"><td class="num" id="LN1738">1738</td><td class="line">                       <span class='keyword'>const</span> <span class='keyword'>double</span>* _uniranges, <span class='keyword'>float</span> scale, <span class='keyword'>bool</span> uniform )</td></tr>
<tr class="codeline" data-linenumber="1739"><td class="num" id="LN1739">1739</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1740"><td class="num" id="LN1740">1740</td><td class="line">    uchar** ptrs = &amp;_ptrs[0];</td></tr>
<tr class="codeline" data-linenumber="1741"><td class="num" id="LN1741">1741</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>int</span>* deltas = &amp;_deltas[0];</td></tr>
<tr class="codeline" data-linenumber="1742"><td class="num" id="LN1742">1742</td><td class="line">    <span class='keyword'>int</span> i, x;</td></tr>
<tr class="codeline" data-linenumber="1743"><td class="num" id="LN1743">1743</td><td class="line">    uchar* bproj = _ptrs[dims];</td></tr>
<tr class="codeline" data-linenumber="1744"><td class="num" id="LN1744">1744</td><td class="line">    <span class='keyword'>int</span> bpstep = _deltas[dims*2 + 1];</td></tr>
<tr class="codeline" data-linenumber="1745"><td class="num" id="LN1745">1745</td><td class="line">    std::vector&lt;size_t&gt; _tab;</td></tr>
<tr class="codeline" data-linenumber="1746"><td class="num" id="LN1746">1746</td><td class="line">    <span class='keyword'>int</span> idx[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>];</td></tr>
<tr class="codeline" data-linenumber="1747"><td class="num" id="LN1747">1747</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1748"><td class="num" id="LN1748">1748</td><td class="line">    calcHistLookupTables_8u( Mat(), hist, dims, _ranges, _uniranges, uniform, <span class='keyword'>true</span>, _tab );</td></tr>
<tr class="codeline" data-linenumber="1749"><td class="num" id="LN1749">1749</td><td class="line">    <span class='keyword'>const</span> size_t* tab = &amp;_tab[0];</td></tr>
<tr class="codeline" data-linenumber="1750"><td class="num" id="LN1750">1750</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1751"><td class="num" id="LN1751">1751</td><td class="line">    <span class='keyword'>for</span>( ; imsize.height--; bproj += bpstep )</td></tr>
<tr class="codeline" data-linenumber="1752"><td class="num" id="LN1752">1752</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1753"><td class="num" id="LN1753">1753</td><td class="line">        <span class='keyword'>for</span>( x = 0; x &lt; imsize.width; x++ )</td></tr>
<tr class="codeline" data-linenumber="1754"><td class="num" id="LN1754">1754</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1755"><td class="num" id="LN1755">1755</td><td class="line">            <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1756"><td class="num" id="LN1756">1756</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1757"><td class="num" id="LN1757">1757</td><td class="line">                size_t hidx = tab[*ptrs[i] + i*256];</td></tr>
<tr class="codeline" data-linenumber="1758"><td class="num" id="LN1758">1758</td><td class="line">                <span class='keyword'>if</span>( hidx &gt;= OUT_OF_RANGE )</td></tr>
<tr class="codeline" data-linenumber="1759"><td class="num" id="LN1759">1759</td><td class="line">                    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1760"><td class="num" id="LN1760">1760</td><td class="line">                idx[i] = (<span class='keyword'>int</span>)hidx;</td></tr>
<tr class="codeline" data-linenumber="1761"><td class="num" id="LN1761">1761</td><td class="line">                ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="1762"><td class="num" id="LN1762">1762</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1763"><td class="num" id="LN1763">1763</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1764"><td class="num" id="LN1764">1764</td><td class="line">            <span class='keyword'>if</span>( i == dims )</td></tr>
<tr class="codeline" data-linenumber="1765"><td class="num" id="LN1765">1765</td><td class="line">                bproj[x] = saturate_cast&lt;uchar&gt;(hist.value&lt;<span class='keyword'>float</span>&gt;(idx)*scale);</td></tr>
<tr class="codeline" data-linenumber="1766"><td class="num" id="LN1766">1766</td><td class="line">            <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1767"><td class="num" id="LN1767">1767</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1768"><td class="num" id="LN1768">1768</td><td class="line">                bproj[x] = 0;</td></tr>
<tr class="codeline" data-linenumber="1769"><td class="num" id="LN1769">1769</td><td class="line">                <span class='keyword'>for</span>( ; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1770"><td class="num" id="LN1770">1770</td><td class="line">                    ptrs[i] += deltas[i*2];</td></tr>
<tr class="codeline" data-linenumber="1771"><td class="num" id="LN1771">1771</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1772"><td class="num" id="LN1772">1772</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1773"><td class="num" id="LN1773">1773</td><td class="line">        <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="1774"><td class="num" id="LN1774">1774</td><td class="line">            ptrs[i] += deltas[i*2 + 1];</td></tr>
<tr class="codeline" data-linenumber="1775"><td class="num" id="LN1775">1775</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1776"><td class="num" id="LN1776">1776</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1777"><td class="num" id="LN1777">1777</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1778"><td class="num" id="LN1778">1778</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1779"><td class="num" id="LN1779">1779</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1780"><td class="num" id="LN1780">1780</td><td class="line"><span class='keyword'>void</span> cv::calcBackProject( <span class='keyword'>const</span> Mat* images, <span class='keyword'>int</span> nimages, <span class='keyword'>const</span> <span class='keyword'>int</span>* channels,</td></tr>
<tr class="codeline" data-linenumber="1781"><td class="num" id="LN1781">1781</td><td class="line">                          <span class='keyword'>const</span> SparseMat&amp; hist, OutputArray _backProject,</td></tr>
<tr class="codeline" data-linenumber="1782"><td class="num" id="LN1782">1782</td><td class="line">                          <span class='keyword'>const</span> <span class='keyword'>float</span>** ranges, <span class='keyword'>double</span> scale, <span class='keyword'>bool</span> uniform )</td></tr>
<tr class="codeline" data-linenumber="1783"><td class="num" id="LN1783">1783</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1784"><td class="num" id="LN1784">1784</td><td class="line">    <span class='macro'>CV_INSTRUMENT_REGION()<span class='macro_popup'>; static cv::utils::trace::details::Region::LocationExtraData<br>* __cv_trace_location_extra_fn1784 = 0; static const cv::utils<br>::trace::details::Region::LocationStaticStorage __cv_trace_location_fn1784<br> = { &amp;(__cv_trace_location_extra_fn1784), __PRETTY_FUNCTION__<br>, "/home/zhh/projects/opencv-4.5.2/modules/imgproc/src/histogram.cpp"<br>, 1784, ((0) | cv::utils::trace::details::REGION_FLAG_FUNCTION<br>)};; const cv::utils::trace::details::Region __region_fn(__cv_trace_location_fn1784<br>);;</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1785"><td class="num" id="LN1785">1785</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1786"><td class="num" id="LN1786">1786</td><td class="line">    <span class='macro'>CV_Assert(images &amp;&amp; nimages &gt; 0)<span class='macro_popup'>do { if (!(images &amp;&amp; nimages &gt; 0)) abort(); } while<br> (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1787"><td class="num" id="LN1787">1787</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1788"><td class="num" id="LN1788">1788</td><td class="line">    std::vector&lt;uchar*&gt; ptrs;</td></tr>
<tr class="codeline" data-linenumber="1789"><td class="num" id="LN1789">1789</td><td class="line">    std::vector&lt;<span class='keyword'>int</span>&gt; deltas;</td></tr>
<tr class="codeline" data-linenumber="1790"><td class="num" id="LN1790">1790</td><td class="line">    std::vector&lt;<span class='keyword'>double</span>&gt; uniranges;</td></tr>
<tr class="codeline" data-linenumber="1791"><td class="num" id="LN1791">1791</td><td class="line">    Size imsize;</td></tr>
<tr class="codeline" data-linenumber="1792"><td class="num" id="LN1792">1792</td><td class="line">    <span class='keyword'>int</span> dims = hist.dims();</td></tr>
<tr class="codeline" data-linenumber="1793"><td class="num" id="LN1793">1793</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1794"><td class="num" id="LN1794">1794</td><td class="line">    <span class='macro'>CV_Assert( dims &gt; 0 )<span class='macro_popup'>do { if (!(dims &gt; 0)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1795"><td class="num" id="LN1795">1795</td><td class="line">    _backProject.create( images[0].size(), images[0].depth() );</td></tr>
<tr class="codeline" data-linenumber="1796"><td class="num" id="LN1796">1796</td><td class="line">    Mat backProject = _backProject.getMat();</td></tr>
<tr class="codeline" data-linenumber="1797"><td class="num" id="LN1797">1797</td><td class="line">    histPrepareImages( images, nimages, channels, backProject,</td></tr>
<tr class="codeline" data-linenumber="1798"><td class="num" id="LN1798">1798</td><td class="line">                       dims, hist.hdr-&gt;size, ranges,</td></tr>
<tr class="codeline" data-linenumber="1799"><td class="num" id="LN1799">1799</td><td class="line">                       uniform, ptrs, deltas, imsize, uniranges );</td></tr>
<tr class="codeline" data-linenumber="1800"><td class="num" id="LN1800">1800</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>double</span>* _uniranges = uniform ? &amp;uniranges[0] : 0;</td></tr>
<tr class="codeline" data-linenumber="1801"><td class="num" id="LN1801">1801</td><td class="line">    <span class='keyword'>int</span> depth = images[0].depth();</td></tr>
<tr class="codeline" data-linenumber="1802"><td class="num" id="LN1802">1802</td><td class="line">    <span class='keyword'>if</span>( depth == <span class='macro'>CV_8U<span class='macro_popup'>0</span></span> )</td></tr>
<tr class="codeline" data-linenumber="1803"><td class="num" id="LN1803">1803</td><td class="line">        calcSparseBackProj_8u(ptrs, deltas, imsize, hist, dims, ranges,</td></tr>
<tr class="codeline" data-linenumber="1804"><td class="num" id="LN1804">1804</td><td class="line">                              _uniranges, (<span class='keyword'>float</span>)scale, uniform);</td></tr>
<tr class="codeline" data-linenumber="1805"><td class="num" id="LN1805">1805</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span>( depth == <span class='macro'>CV_16U<span class='macro_popup'>2</span></span> )</td></tr>
<tr class="codeline" data-linenumber="1806"><td class="num" id="LN1806">1806</td><td class="line">        calcSparseBackProj_&lt;ushort, ushort&gt;(ptrs, deltas, imsize, hist, dims, ranges,</td></tr>
<tr class="codeline" data-linenumber="1807"><td class="num" id="LN1807">1807</td><td class="line">                                          _uniranges, (<span class='keyword'>float</span>)scale, uniform );</td></tr>
<tr class="codeline" data-linenumber="1808"><td class="num" id="LN1808">1808</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span>( depth == <span class='macro'>CV_32F<span class='macro_popup'>5</span></span> )</td></tr>
<tr class="codeline" data-linenumber="1809"><td class="num" id="LN1809">1809</td><td class="line">        calcSparseBackProj_&lt;<span class='keyword'>float</span>, <span class='keyword'>float</span>&gt;(ptrs, deltas, imsize, hist, dims, ranges,</td></tr>
<tr class="codeline" data-linenumber="1810"><td class="num" id="LN1810">1810</td><td class="line">                                          _uniranges, (<span class='keyword'>float</span>)scale, uniform );</td></tr>
<tr class="codeline" data-linenumber="1811"><td class="num" id="LN1811">1811</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1812"><td class="num" id="LN1812">1812</td><td class="line">        <span class='macro'>CV_Error(CV_StsUnsupportedFormat, <span class='string_literal'>""</span>)<span class='macro_popup'>do { (void)(CV_StsUnsupportedFormat); (void)(""); abort(); } while<br> (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1813"><td class="num" id="LN1813">1813</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1814"><td class="num" id="LN1814">1814</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1815"><td class="num" id="LN1815">1815</td><td class="line"><span class='directive'>#ifdef HAVE_OPENCL</span></td></tr>
<tr class="codeline" data-linenumber="1816"><td class="num" id="LN1816">1816</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1817"><td class="num" id="LN1817">1817</td><td class="line"><span class='keyword'>namespace</span> cv {</td></tr>
<tr class="codeline" data-linenumber="1818"><td class="num" id="LN1818">1818</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1819"><td class="num" id="LN1819">1819</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> getUMatIndex(<span class='keyword'>const</span> std::vector&lt;UMat&gt; &amp; um, <span class='keyword'>int</span> cn, <span class='keyword'>int</span> &amp; idx, <span class='keyword'>int</span> &amp; cnidx)</td></tr>
<tr class="codeline" data-linenumber="1820"><td class="num" id="LN1820">1820</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1821"><td class="num" id="LN1821">1821</td><td class="line">    <span class='keyword'>int</span> totalChannels = 0;</td></tr>
<tr class="codeline" data-linenumber="1822"><td class="num" id="LN1822">1822</td><td class="line">    <span class='keyword'>for</span> (size_t i = 0, size = um.size(); i &lt; size; ++i)</td></tr>
<tr class="codeline" data-linenumber="1823"><td class="num" id="LN1823">1823</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1824"><td class="num" id="LN1824">1824</td><td class="line">        <span class='keyword'>int</span> ccn = um[i].channels();</td></tr>
<tr class="codeline" data-linenumber="1825"><td class="num" id="LN1825">1825</td><td class="line">        totalChannels += ccn;</td></tr>
<tr class="codeline" data-linenumber="1826"><td class="num" id="LN1826">1826</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1827"><td class="num" id="LN1827">1827</td><td class="line">        <span class='keyword'>if</span> (totalChannels == cn)</td></tr>
<tr class="codeline" data-linenumber="1828"><td class="num" id="LN1828">1828</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1829"><td class="num" id="LN1829">1829</td><td class="line">            idx = (<span class='keyword'>int</span>)(i + 1);</td></tr>
<tr class="codeline" data-linenumber="1830"><td class="num" id="LN1830">1830</td><td class="line">            cnidx = 0;</td></tr>
<tr class="codeline" data-linenumber="1831"><td class="num" id="LN1831">1831</td><td class="line">            <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="1832"><td class="num" id="LN1832">1832</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1833"><td class="num" id="LN1833">1833</td><td class="line">        <span class='keyword'>else</span> <span class='keyword'>if</span> (totalChannels &gt; cn)</td></tr>
<tr class="codeline" data-linenumber="1834"><td class="num" id="LN1834">1834</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1835"><td class="num" id="LN1835">1835</td><td class="line">            idx = (<span class='keyword'>int</span>)i;</td></tr>
<tr class="codeline" data-linenumber="1836"><td class="num" id="LN1836">1836</td><td class="line">            cnidx = i == 0 ? cn : (cn - totalChannels + ccn);</td></tr>
<tr class="codeline" data-linenumber="1837"><td class="num" id="LN1837">1837</td><td class="line">            <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="1838"><td class="num" id="LN1838">1838</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1839"><td class="num" id="LN1839">1839</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1840"><td class="num" id="LN1840">1840</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1841"><td class="num" id="LN1841">1841</td><td class="line">    idx = cnidx = -1;</td></tr>
<tr class="codeline" data-linenumber="1842"><td class="num" id="LN1842">1842</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1843"><td class="num" id="LN1843">1843</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1844"><td class="num" id="LN1844">1844</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>bool</span> ocl_calcBackProject( InputArrayOfArrays _images, std::vector&lt;<span class='keyword'>int</span>&gt; channels,</td></tr>
<tr class="codeline" data-linenumber="1845"><td class="num" id="LN1845">1845</td><td class="line">                                 InputArray _hist, OutputArray _dst,</td></tr>
<tr class="codeline" data-linenumber="1846"><td class="num" id="LN1846">1846</td><td class="line">                                 <span class='keyword'>const</span> std::vector&lt;<span class='keyword'>float</span>&gt;&amp; ranges,</td></tr>
<tr class="codeline" data-linenumber="1847"><td class="num" id="LN1847">1847</td><td class="line">                                 <span class='keyword'>float</span> scale, size_t histdims )</td></tr>
<tr class="codeline" data-linenumber="1848"><td class="num" id="LN1848">1848</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1849"><td class="num" id="LN1849">1849</td><td class="line">    std::vector&lt;UMat&gt; images;</td></tr>
<tr class="codeline" data-linenumber="1850"><td class="num" id="LN1850">1850</td><td class="line">    _images.getUMatVector(images);</td></tr>
<tr class="codeline" data-linenumber="1851"><td class="num" id="LN1851">1851</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1852"><td class="num" id="LN1852">1852</td><td class="line">    size_t nimages = images.size(), totalcn = images[0].channels();</td></tr>
<tr class="codeline" data-linenumber="1853"><td class="num" id="LN1853">1853</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1854"><td class="num" id="LN1854">1854</td><td class="line">    <span class='macro'>CV_Assert(nimages &gt; 0)<span class='macro_popup'>do { if (!(nimages &gt; 0)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1855"><td class="num" id="LN1855">1855</td><td class="line">    Size size = images[0].size();</td></tr>
<tr class="codeline" data-linenumber="1856"><td class="num" id="LN1856">1856</td><td class="line">    <span class='keyword'>int</span> depth = images[0].depth();</td></tr>
<tr class="codeline" data-linenumber="1857"><td class="num" id="LN1857">1857</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1858"><td class="num" id="LN1858">1858</td><td class="line">    <span class='comment'>//kernels are valid for this type only</span></td></tr>
<tr class="codeline" data-linenumber="1859"><td class="num" id="LN1859">1859</td><td class="line">    <span class='keyword'>if</span> (depth != <span class='macro'>CV_8U<span class='macro_popup'>0</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1860"><td class="num" id="LN1860">1860</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1861"><td class="num" id="LN1861">1861</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1862"><td class="num" id="LN1862">1862</td><td class="line">    <span class='keyword'>for</span> (size_t i = 1; i &lt; nimages; ++i)</td></tr>
<tr class="codeline" data-linenumber="1863"><td class="num" id="LN1863">1863</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1864"><td class="num" id="LN1864">1864</td><td class="line">        <span class='keyword'>const</span> UMat &amp; m = images[i];</td></tr>
<tr class="codeline" data-linenumber="1865"><td class="num" id="LN1865">1865</td><td class="line">        totalcn += m.channels();</td></tr>
<tr class="codeline" data-linenumber="1866"><td class="num" id="LN1866">1866</td><td class="line">        <span class='macro'>CV_Assert(size == m.size() &amp;&amp; depth == m.depth())<span class='macro_popup'>do { if (!(size == m.size() &amp;&amp; depth == m.depth())) abort<br>(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1867"><td class="num" id="LN1867">1867</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1868"><td class="num" id="LN1868">1868</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1869"><td class="num" id="LN1869">1869</td><td class="line">    std::sort(channels.begin(), channels.end());</td></tr>
<tr class="codeline" data-linenumber="1870"><td class="num" id="LN1870">1870</td><td class="line">    <span class='keyword'>for</span> (size_t i = 0; i &lt; histdims; ++i)</td></tr>
<tr class="codeline" data-linenumber="1871"><td class="num" id="LN1871">1871</td><td class="line">        <span class='macro'>CV_Assert(channels[i] &lt; (<span class='keyword'>int</span>)totalcn)<span class='macro_popup'>do { if (!(channels[i] &lt; (int)totalcn)) abort(); } while (<br>0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1872"><td class="num" id="LN1872">1872</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1873"><td class="num" id="LN1873">1873</td><td class="line">    <span class='keyword'>if</span> (histdims == 1)</td></tr>
<tr class="codeline" data-linenumber="1874"><td class="num" id="LN1874">1874</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1875"><td class="num" id="LN1875">1875</td><td class="line">        <span class='keyword'>int</span> idx, cnidx;</td></tr>
<tr class="codeline" data-linenumber="1876"><td class="num" id="LN1876">1876</td><td class="line">        getUMatIndex(images, channels[0], idx, cnidx);</td></tr>
<tr class="codeline" data-linenumber="1877"><td class="num" id="LN1877">1877</td><td class="line">        <span class='macro'>CV_Assert(idx &gt;= 0)<span class='macro_popup'>do { if (!(idx &gt;= 0)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1878"><td class="num" id="LN1878">1878</td><td class="line">        UMat im = images[idx];</td></tr>
<tr class="codeline" data-linenumber="1879"><td class="num" id="LN1879">1879</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1880"><td class="num" id="LN1880">1880</td><td class="line">        String opts = format(<span class='string_literal'>"-D histdims=1 -D scn=%d"</span>, im.channels());</td></tr>
<tr class="codeline" data-linenumber="1881"><td class="num" id="LN1881">1881</td><td class="line">        ocl::Kernel lutk(<span class='string_literal'>"calcLUT"</span>, ocl::imgproc::calc_back_project_oclsrc, opts);</td></tr>
<tr class="codeline" data-linenumber="1882"><td class="num" id="LN1882">1882</td><td class="line">        <span class='keyword'>if</span> (lutk.empty())</td></tr>
<tr class="codeline" data-linenumber="1883"><td class="num" id="LN1883">1883</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1884"><td class="num" id="LN1884">1884</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1885"><td class="num" id="LN1885">1885</td><td class="line">        size_t lsize = 256;</td></tr>
<tr class="codeline" data-linenumber="1886"><td class="num" id="LN1886">1886</td><td class="line">        UMat lut(1, (<span class='keyword'>int</span>)lsize, <span class='macro'>CV_32SC1<span class='macro_popup'>(((4) &amp; ((1 &lt;&lt; 3) - 1)) + (((1)-1) &lt;&lt; 3))</span></span>), hist = _hist.getUMat(), uranges(ranges, <span class='keyword'>true</span>);</td></tr>
<tr class="codeline" data-linenumber="1887"><td class="num" id="LN1887">1887</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1888"><td class="num" id="LN1888">1888</td><td class="line">        lutk.args(ocl::KernelArg::ReadOnlyNoSize(hist), hist.rows,</td></tr>
<tr class="codeline" data-linenumber="1889"><td class="num" id="LN1889">1889</td><td class="line">                  ocl::KernelArg::PtrWriteOnly(lut), scale, ocl::KernelArg::PtrReadOnly(uranges));</td></tr>
<tr class="codeline" data-linenumber="1890"><td class="num" id="LN1890">1890</td><td class="line">        <span class='keyword'>if</span> (!lutk.run(1, &amp;lsize, <span class='macro'>NULL<span class='macro_popup'>__null</span></span>, <span class='keyword'>false</span>))</td></tr>
<tr class="codeline" data-linenumber="1891"><td class="num" id="LN1891">1891</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1892"><td class="num" id="LN1892">1892</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1893"><td class="num" id="LN1893">1893</td><td class="line">        ocl::Kernel mapk(<span class='string_literal'>"LUT"</span>, ocl::imgproc::calc_back_project_oclsrc, opts);</td></tr>
<tr class="codeline" data-linenumber="1894"><td class="num" id="LN1894">1894</td><td class="line">        <span class='keyword'>if</span> (mapk.empty())</td></tr>
<tr class="codeline" data-linenumber="1895"><td class="num" id="LN1895">1895</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1896"><td class="num" id="LN1896">1896</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1897"><td class="num" id="LN1897">1897</td><td class="line">        _dst.create(size, depth);</td></tr>
<tr class="codeline" data-linenumber="1898"><td class="num" id="LN1898">1898</td><td class="line">        UMat dst = _dst.getUMat();</td></tr>
<tr class="codeline" data-linenumber="1899"><td class="num" id="LN1899">1899</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1900"><td class="num" id="LN1900">1900</td><td class="line">        im.offset += cnidx;</td></tr>
<tr class="codeline" data-linenumber="1901"><td class="num" id="LN1901">1901</td><td class="line">        mapk.args(ocl::KernelArg::ReadOnlyNoSize(im), ocl::KernelArg::PtrReadOnly(lut),</td></tr>
<tr class="codeline" data-linenumber="1902"><td class="num" id="LN1902">1902</td><td class="line">                  ocl::KernelArg::WriteOnly(dst));</td></tr>
<tr class="codeline" data-linenumber="1903"><td class="num" id="LN1903">1903</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1904"><td class="num" id="LN1904">1904</td><td class="line">        size_t globalsize[2] = { (size_t)size.width, (size_t)size.height };</td></tr>
<tr class="codeline" data-linenumber="1905"><td class="num" id="LN1905">1905</td><td class="line">        <span class='keyword'>return</span> mapk.run(2, globalsize, <span class='macro'>NULL<span class='macro_popup'>__null</span></span>, <span class='keyword'>false</span>);</td></tr>
<tr class="codeline" data-linenumber="1906"><td class="num" id="LN1906">1906</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1907"><td class="num" id="LN1907">1907</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (histdims == 2)</td></tr>
<tr class="codeline" data-linenumber="1908"><td class="num" id="LN1908">1908</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1909"><td class="num" id="LN1909">1909</td><td class="line">        <span class='keyword'>int</span> idx0, idx1, cnidx0, cnidx1;</td></tr>
<tr class="codeline" data-linenumber="1910"><td class="num" id="LN1910">1910</td><td class="line">        getUMatIndex(images, channels[0], idx0, cnidx0);</td></tr>
<tr class="codeline" data-linenumber="1911"><td class="num" id="LN1911">1911</td><td class="line">        getUMatIndex(images, channels[1], idx1, cnidx1);</td></tr>
<tr class="codeline" data-linenumber="1912"><td class="num" id="LN1912">1912</td><td class="line">        <span class='macro'>CV_Assert(idx0 &gt;= 0 &amp;&amp; idx1 &gt;= 0)<span class='macro_popup'>do { if (!(idx0 &gt;= 0 &amp;&amp; idx1 &gt;= 0)) abort(); } while<br> (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1913"><td class="num" id="LN1913">1913</td><td class="line">        UMat im0 = images[idx0], im1 = images[idx1];</td></tr>
<tr class="codeline" data-linenumber="1914"><td class="num" id="LN1914">1914</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1915"><td class="num" id="LN1915">1915</td><td class="line">        <span class='comment'>// Lut for the first dimension</span></td></tr>
<tr class="codeline" data-linenumber="1916"><td class="num" id="LN1916">1916</td><td class="line">        String opts = format(<span class='string_literal'>"-D histdims=2 -D scn1=%d -D scn2=%d"</span>, im0.channels(), im1.channels());</td></tr>
<tr class="codeline" data-linenumber="1917"><td class="num" id="LN1917">1917</td><td class="line">        ocl::Kernel lutk1(<span class='string_literal'>"calcLUT"</span>, ocl::imgproc::calc_back_project_oclsrc, opts);</td></tr>
<tr class="codeline" data-linenumber="1918"><td class="num" id="LN1918">1918</td><td class="line">        <span class='keyword'>if</span> (lutk1.empty())</td></tr>
<tr class="codeline" data-linenumber="1919"><td class="num" id="LN1919">1919</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1920"><td class="num" id="LN1920">1920</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1921"><td class="num" id="LN1921">1921</td><td class="line">        size_t lsize = 256;</td></tr>
<tr class="codeline" data-linenumber="1922"><td class="num" id="LN1922">1922</td><td class="line">        UMat lut(1, (<span class='keyword'>int</span>)lsize&lt;&lt;1, <span class='macro'>CV_32SC1<span class='macro_popup'>(((4) &amp; ((1 &lt;&lt; 3) - 1)) + (((1)-1) &lt;&lt; 3))</span></span>), uranges(ranges, <span class='keyword'>true</span>), hist = _hist.getUMat();</td></tr>
<tr class="codeline" data-linenumber="1923"><td class="num" id="LN1923">1923</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1924"><td class="num" id="LN1924">1924</td><td class="line">        lutk1.args(hist.rows, ocl::KernelArg::PtrWriteOnly(lut), (<span class='keyword'>int</span>)0, ocl::KernelArg::PtrReadOnly(uranges), (<span class='keyword'>int</span>)0);</td></tr>
<tr class="codeline" data-linenumber="1925"><td class="num" id="LN1925">1925</td><td class="line">        <span class='keyword'>if</span> (!lutk1.run(1, &amp;lsize, <span class='macro'>NULL<span class='macro_popup'>__null</span></span>, <span class='keyword'>false</span>))</td></tr>
<tr class="codeline" data-linenumber="1926"><td class="num" id="LN1926">1926</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1927"><td class="num" id="LN1927">1927</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1928"><td class="num" id="LN1928">1928</td><td class="line">        <span class='comment'>// lut for the second dimension</span></td></tr>
<tr class="codeline" data-linenumber="1929"><td class="num" id="LN1929">1929</td><td class="line">        ocl::Kernel lutk2(<span class='string_literal'>"calcLUT"</span>, ocl::imgproc::calc_back_project_oclsrc, opts);</td></tr>
<tr class="codeline" data-linenumber="1930"><td class="num" id="LN1930">1930</td><td class="line">        <span class='keyword'>if</span> (lutk2.empty())</td></tr>
<tr class="codeline" data-linenumber="1931"><td class="num" id="LN1931">1931</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1932"><td class="num" id="LN1932">1932</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1933"><td class="num" id="LN1933">1933</td><td class="line">        lut.offset += lsize * <span class='keyword'>sizeof</span>(<span class='keyword'>int</span>);</td></tr>
<tr class="codeline" data-linenumber="1934"><td class="num" id="LN1934">1934</td><td class="line">        lutk2.args(hist.cols, ocl::KernelArg::PtrWriteOnly(lut), (<span class='keyword'>int</span>)256, ocl::KernelArg::PtrReadOnly(uranges), (<span class='keyword'>int</span>)2);</td></tr>
<tr class="codeline" data-linenumber="1935"><td class="num" id="LN1935">1935</td><td class="line">        <span class='keyword'>if</span> (!lutk2.run(1, &amp;lsize, <span class='macro'>NULL<span class='macro_popup'>__null</span></span>, <span class='keyword'>false</span>))</td></tr>
<tr class="codeline" data-linenumber="1936"><td class="num" id="LN1936">1936</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1937"><td class="num" id="LN1937">1937</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1938"><td class="num" id="LN1938">1938</td><td class="line">        <span class='comment'>// perform lut</span></td></tr>
<tr class="codeline" data-linenumber="1939"><td class="num" id="LN1939">1939</td><td class="line">        ocl::Kernel mapk(<span class='string_literal'>"LUT"</span>, ocl::imgproc::calc_back_project_oclsrc, opts);</td></tr>
<tr class="codeline" data-linenumber="1940"><td class="num" id="LN1940">1940</td><td class="line">        <span class='keyword'>if</span> (mapk.empty())</td></tr>
<tr class="codeline" data-linenumber="1941"><td class="num" id="LN1941">1941</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1942"><td class="num" id="LN1942">1942</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1943"><td class="num" id="LN1943">1943</td><td class="line">        _dst.create(size, depth);</td></tr>
<tr class="codeline" data-linenumber="1944"><td class="num" id="LN1944">1944</td><td class="line">        UMat dst = _dst.getUMat();</td></tr>
<tr class="codeline" data-linenumber="1945"><td class="num" id="LN1945">1945</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1946"><td class="num" id="LN1946">1946</td><td class="line">        im0.offset += cnidx0;</td></tr>
<tr class="codeline" data-linenumber="1947"><td class="num" id="LN1947">1947</td><td class="line">        im1.offset += cnidx1;</td></tr>
<tr class="codeline" data-linenumber="1948"><td class="num" id="LN1948">1948</td><td class="line">        mapk.args(ocl::KernelArg::ReadOnlyNoSize(im0), ocl::KernelArg::ReadOnlyNoSize(im1),</td></tr>
<tr class="codeline" data-linenumber="1949"><td class="num" id="LN1949">1949</td><td class="line">               ocl::KernelArg::ReadOnlyNoSize(hist), ocl::KernelArg::PtrReadOnly(lut), scale, ocl::KernelArg::WriteOnly(dst));</td></tr>
<tr class="codeline" data-linenumber="1950"><td class="num" id="LN1950">1950</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1951"><td class="num" id="LN1951">1951</td><td class="line">        size_t globalsize[2] = { (size_t)size.width, (size_t)size.height };</td></tr>
<tr class="codeline" data-linenumber="1952"><td class="num" id="LN1952">1952</td><td class="line">        <span class='keyword'>return</span> mapk.run(2, globalsize, <span class='macro'>NULL<span class='macro_popup'>__null</span></span>, <span class='keyword'>false</span>);</td></tr>
<tr class="codeline" data-linenumber="1953"><td class="num" id="LN1953">1953</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1954"><td class="num" id="LN1954">1954</td><td class="line">    <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1955"><td class="num" id="LN1955">1955</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1956"><td class="num" id="LN1956">1956</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1957"><td class="num" id="LN1957">1957</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1958"><td class="num" id="LN1958">1958</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1959"><td class="num" id="LN1959">1959</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1960"><td class="num" id="LN1960">1960</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1961"><td class="num" id="LN1961">1961</td><td class="line"><span class='keyword'>void</span> cv::calcBackProject( InputArrayOfArrays images, <span class='keyword'>const</span> std::vector&lt;<span class='keyword'>int</span>&gt;&amp; channels,</td></tr>
<tr class="codeline" data-linenumber="1962"><td class="num" id="LN1962">1962</td><td class="line">                          InputArray hist, OutputArray dst,</td></tr>
<tr class="codeline" data-linenumber="1963"><td class="num" id="LN1963">1963</td><td class="line">                          <span class='keyword'>const</span> std::vector&lt;<span class='keyword'>float</span>&gt;&amp; ranges,</td></tr>
<tr class="codeline" data-linenumber="1964"><td class="num" id="LN1964">1964</td><td class="line">                          <span class='keyword'>double</span> scale )</td></tr>
<tr class="codeline" data-linenumber="1965"><td class="num" id="LN1965">1965</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1966"><td class="num" id="LN1966">1966</td><td class="line">    <span class='macro'>CV_INSTRUMENT_REGION()<span class='macro_popup'>; static cv::utils::trace::details::Region::LocationExtraData<br>* __cv_trace_location_extra_fn1966 = 0; static const cv::utils<br>::trace::details::Region::LocationStaticStorage __cv_trace_location_fn1966<br> = { &amp;(__cv_trace_location_extra_fn1966), __PRETTY_FUNCTION__<br>, "/home/zhh/projects/opencv-4.5.2/modules/imgproc/src/histogram.cpp"<br>, 1966, ((0) | cv::utils::trace::details::REGION_FLAG_FUNCTION<br>)};; const cv::utils::trace::details::Region __region_fn(__cv_trace_location_fn1966<br>);;</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1967"><td class="num" id="LN1967">1967</td><td class="line">    <span class='keyword'>if</span> (hist.dims() &lt;= 2)</td></tr>
<tr class="codeline" data-linenumber="1968"><td class="num" id="LN1968">1968</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1969"><td class="num" id="LN1969">1969</td><td class="line"><span class='directive'>#ifdef HAVE_OPENCL</span></td></tr>
<tr class="codeline" data-linenumber="1970"><td class="num" id="LN1970">1970</td><td class="line">        Size histSize = hist.size();</td></tr>
<tr class="codeline" data-linenumber="1971"><td class="num" id="LN1971">1971</td><td class="line">        <span class='keyword'>bool</span> _1D = histSize.height == 1 || histSize.width == 1;</td></tr>
<tr class="codeline" data-linenumber="1972"><td class="num" id="LN1972">1972</td><td class="line">        size_t histdims = _1D ? 1 : hist.dims();</td></tr>
<tr class="codeline" data-linenumber="1973"><td class="num" id="LN1973">1973</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1974"><td class="num" id="LN1974">1974</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1975"><td class="num" id="LN1975">1975</td><td class="line">        <span class='macro'>CV_OCL_RUN(dst.isUMat() &amp;&amp; hist.type() == CV_32FC1 &amp;&amp;<span class='macro_popup'>try { if (cv::ocl::isOpenCLActivated() &amp;&amp; (dst.isUMat<br>() &amp;&amp; hist.type() == (((5) &amp; ((1 &lt;&lt; 3) - 1)<br>) + (((1)-1) &lt;&lt; 3)) &amp;&amp; histdims &lt;= 2 &amp;&amp;<br> ranges.size() == histdims * 2 &amp;&amp; histdims == channels<br>.size()) &amp;&amp; ocl_calcBackProject(images, channels, hist<br>, dst, ranges, (float)scale, histdims)) { ; return ; } } catch<br> (const cv::Exception&amp; e) { (void)e; }</span></span></td></tr>
<tr class="codeline" data-linenumber="1976"><td class="num" id="LN1976">1976</td><td class="line">            <span class='macro'>histdims &lt;= 2 &amp;&amp; ranges.size() == histdims * 2 &amp;&amp; histdims == channels.size(),<span class='macro_popup'>try { if (cv::ocl::isOpenCLActivated() &amp;&amp; (dst.isUMat<br>() &amp;&amp; hist.type() == (((5) &amp; ((1 &lt;&lt; 3) - 1)<br>) + (((1)-1) &lt;&lt; 3)) &amp;&amp; histdims &lt;= 2 &amp;&amp;<br> ranges.size() == histdims * 2 &amp;&amp; histdims == channels<br>.size()) &amp;&amp; ocl_calcBackProject(images, channels, hist<br>, dst, ranges, (float)scale, histdims)) { ; return ; } } catch<br> (const cv::Exception&amp; e) { (void)e; }</span></span></td></tr>
<tr class="codeline" data-linenumber="1977"><td class="num" id="LN1977">1977</td><td class="line">            <span class='macro'>ocl_calcBackProject(images, channels, hist, dst, ranges, (<span class='keyword'>float</span>)scale, histdims))<span class='macro_popup'>try { if (cv::ocl::isOpenCLActivated() &amp;&amp; (dst.isUMat<br>() &amp;&amp; hist.type() == (((5) &amp; ((1 &lt;&lt; 3) - 1)<br>) + (((1)-1) &lt;&lt; 3)) &amp;&amp; histdims &lt;= 2 &amp;&amp;<br> ranges.size() == histdims * 2 &amp;&amp; histdims == channels<br>.size()) &amp;&amp; ocl_calcBackProject(images, channels, hist<br>, dst, ranges, (float)scale, histdims)) { ; return ; } } catch<br> (const cv::Exception&amp; e) { (void)e; }</span></span></td></tr>
<tr class="codeline" data-linenumber="1978"><td class="num" id="LN1978">1978</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1979"><td class="num" id="LN1979">1979</td><td class="line">    Mat H0 = hist.getMat(), H;</td></tr>
<tr class="codeline" data-linenumber="1980"><td class="num" id="LN1980">1980</td><td class="line">    <span class='keyword'>int</span> hcn = H0.channels();</td></tr>
<tr class="codeline" data-linenumber="1981"><td class="num" id="LN1981">1981</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1982"><td class="num" id="LN1982">1982</td><td class="line">    <span class='keyword'>if</span>( hcn &gt; 1 )</td></tr>
<tr class="codeline" data-linenumber="1983"><td class="num" id="LN1983">1983</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1984"><td class="num" id="LN1984">1984</td><td class="line">        <span class='macro'>CV_Assert( H0.isContinuous() )<span class='macro_popup'>do { if (!(H0.isContinuous())) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1985"><td class="num" id="LN1985">1985</td><td class="line">        <span class='keyword'>int</span> hsz[<span class='macro'>CV_CN_MAX<span class='macro_popup'>512</span></span>+1];</td></tr>
<tr class="codeline" data-linenumber="1986"><td class="num" id="LN1986">1986</td><td class="line">        memcpy(hsz, &amp;H0.size[0], H0.dims*<span class='keyword'>sizeof</span>(hsz[0]));</td></tr>
<tr class="codeline" data-linenumber="1987"><td class="num" id="LN1987">1987</td><td class="line">        hsz[H0.dims] = hcn;</td></tr>
<tr class="codeline" data-linenumber="1988"><td class="num" id="LN1988">1988</td><td class="line">        H = Mat(H0.dims+1, hsz, H0.depth(), H0.ptr());</td></tr>
<tr class="codeline" data-linenumber="1989"><td class="num" id="LN1989">1989</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1990"><td class="num" id="LN1990">1990</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1991"><td class="num" id="LN1991">1991</td><td class="line">        H = H0;</td></tr>
<tr class="codeline" data-linenumber="1992"><td class="num" id="LN1992">1992</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1993"><td class="num" id="LN1993">1993</td><td class="line">    <span class='keyword'>bool</span> _1d = H.rows == 1 || H.cols == 1;</td></tr>
<tr class="codeline" data-linenumber="1994"><td class="num" id="LN1994">1994</td><td class="line">    <span class='keyword'>int</span> i, dims = H.dims, rsz = (<span class='keyword'>int</span>)ranges.size(), csz = (<span class='keyword'>int</span>)channels.size();</td></tr>
<tr class="codeline" data-linenumber="1995"><td class="num" id="LN1995">1995</td><td class="line">    <span class='keyword'>int</span> nimages = (<span class='keyword'>int</span>)images.total();</td></tr>
<tr class="codeline" data-linenumber="1996"><td class="num" id="LN1996">1996</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1997"><td class="num" id="LN1997">1997</td><td class="line">    <span class='macro'>CV_Assert(nimages &gt; 0)<span class='macro_popup'>do { if (!(nimages &gt; 0)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1998"><td class="num" id="LN1998">1998</td><td class="line">    <span class='macro'>CV_Assert(rsz == dims*2 || (rsz == 2 &amp;&amp; _1d) || (rsz == 0 &amp;&amp; images.depth(0) == CV_8U))<span class='macro_popup'>do { if (!(rsz == dims*2 || (rsz == 2 &amp;&amp; _1d) || (rsz<br> == 0 &amp;&amp; images.depth(0) == 0))) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1999"><td class="num" id="LN1999">1999</td><td class="line">    <span class='macro'>CV_Assert(csz == 0 || csz == dims || (csz == 1 &amp;&amp; _1d))<span class='macro_popup'>do { if (!(csz == 0 || csz == dims || (csz == 1 &amp;&amp; _1d<br>))) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2000"><td class="num" id="LN2000">2000</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2001"><td class="num" id="LN2001">2001</td><td class="line">    <span class='keyword'>float</span>* _ranges[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>];</td></tr>
<tr class="codeline" data-linenumber="2002"><td class="num" id="LN2002">2002</td><td class="line">    <span class='keyword'>if</span>( rsz &gt; 0 )</td></tr>
<tr class="codeline" data-linenumber="2003"><td class="num" id="LN2003">2003</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2004"><td class="num" id="LN2004">2004</td><td class="line">        <span class='keyword'>for</span>( i = 0; i &lt; rsz/2; i++ )</td></tr>
<tr class="codeline" data-linenumber="2005"><td class="num" id="LN2005">2005</td><td class="line">            _ranges[i] = (<span class='keyword'>float</span>*)&amp;ranges[i*2];</td></tr>
<tr class="codeline" data-linenumber="2006"><td class="num" id="LN2006">2006</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2007"><td class="num" id="LN2007">2007</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2008"><td class="num" id="LN2008">2008</td><td class="line">    AutoBuffer&lt;Mat&gt; buf(nimages);</td></tr>
<tr class="codeline" data-linenumber="2009"><td class="num" id="LN2009">2009</td><td class="line">    <span class='keyword'>for</span>( i = 0; i &lt; nimages; i++ )</td></tr>
<tr class="codeline" data-linenumber="2010"><td class="num" id="LN2010">2010</td><td class="line">        buf[i] = images.getMat(i);</td></tr>
<tr class="codeline" data-linenumber="2011"><td class="num" id="LN2011">2011</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2012"><td class="num" id="LN2012">2012</td><td class="line">    calcBackProject(&amp;buf[0], nimages, csz ? &amp;channels[0] : 0,</td></tr>
<tr class="codeline" data-linenumber="2013"><td class="num" id="LN2013">2013</td><td class="line">        hist, dst, rsz ? (<span class='keyword'>const</span> <span class='keyword'>float</span>**)_ranges : 0, scale, <span class='keyword'>true</span>);</td></tr>
<tr class="codeline" data-linenumber="2014"><td class="num" id="LN2014">2014</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2015"><td class="num" id="LN2015">2015</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2016"><td class="num" id="LN2016">2016</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2017"><td class="num" id="LN2017">2017</td><td class="line"><span class='comment'>////////////////// C O M P A R E   H I S T O G R A M S ////////////////////////</span></td></tr>
<tr class="codeline" data-linenumber="2018"><td class="num" id="LN2018">2018</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2019"><td class="num" id="LN2019">2019</td><td class="line"><span class='keyword'>double</span> cv::compareHist( InputArray _H1, InputArray _H2, <span class='keyword'>int</span> method )</td></tr>
<tr class="codeline" data-linenumber="2020"><td class="num" id="LN2020">2020</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2021"><td class="num" id="LN2021">2021</td><td class="line">    <span class='macro'>CV_INSTRUMENT_REGION()<span class='macro_popup'>; static cv::utils::trace::details::Region::LocationExtraData<br>* __cv_trace_location_extra_fn2021 = 0; static const cv::utils<br>::trace::details::Region::LocationStaticStorage __cv_trace_location_fn2021<br> = { &amp;(__cv_trace_location_extra_fn2021), __PRETTY_FUNCTION__<br>, "/home/zhh/projects/opencv-4.5.2/modules/imgproc/src/histogram.cpp"<br>, 2021, ((0) | cv::utils::trace::details::REGION_FLAG_FUNCTION<br>)};; const cv::utils::trace::details::Region __region_fn(__cv_trace_location_fn2021<br>);;</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2022"><td class="num" id="LN2022">2022</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2023"><td class="num" id="LN2023">2023</td><td class="line">    Mat H1 = _H1.getMat(), H2 = _H2.getMat();</td></tr>
<tr class="codeline" data-linenumber="2024"><td class="num" id="LN2024">2024</td><td class="line">    <span class='keyword'>const</span> Mat* arrays[] = {&amp;H1, &amp;H2, 0};</td></tr>
<tr class="codeline" data-linenumber="2025"><td class="num" id="LN2025">2025</td><td class="line">    Mat planes[2];</td></tr>
<tr class="codeline" data-linenumber="2026"><td class="num" id="LN2026">2026</td><td class="line">    NAryMatIterator it(arrays, planes);</td></tr>
<tr class="codeline" data-linenumber="2027"><td class="num" id="LN2027">2027</td><td class="line">    <span class='keyword'>double</span> result = 0;</td></tr>
<tr class="codeline" data-linenumber="2028"><td class="num" id="LN2028">2028</td><td class="line">    <span class='keyword'>int</span> j;</td></tr>
<tr class="codeline" data-linenumber="2029"><td class="num" id="LN2029">2029</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2030"><td class="num" id="LN2030">2030</td><td class="line">    <span class='macro'>CV_Assert( H1.type() == H2.type() &amp;&amp; H1.depth() == CV_32F )<span class='macro_popup'>do { if (!(H1.type() == H2.type() &amp;&amp; H1.depth() == 5)<br>) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2031"><td class="num" id="LN2031">2031</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2032"><td class="num" id="LN2032">2032</td><td class="line">    <span class='keyword'>double</span> s1 = 0, s2 = 0, s11 = 0, s12 = 0, s22 = 0;</td></tr>
<tr class="codeline" data-linenumber="2033"><td class="num" id="LN2033">2033</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2034"><td class="num" id="LN2034">2034</td><td class="line">    <span class='macro'>CV_Assert( it.planes[0].isContinuous() &amp;&amp; it.planes[1].isContinuous() )<span class='macro_popup'>do { if (!(it.planes[0].isContinuous() &amp;&amp; it.planes[1<br>].isContinuous())) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2035"><td class="num" id="LN2035">2035</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2036"><td class="num" id="LN2036">2036</td><td class="line">    <span class='keyword'>for</span>( size_t i = 0; i &lt; it.nplanes; i++, ++it )</td></tr>
<tr class="codeline" data-linenumber="2037"><td class="num" id="LN2037">2037</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2038"><td class="num" id="LN2038">2038</td><td class="line">        <span class='keyword'>const</span> <span class='keyword'>float</span>* h1 = it.planes[0].ptr&lt;<span class='keyword'>float</span>&gt;();</td></tr>
<tr class="codeline" data-linenumber="2039"><td class="num" id="LN2039">2039</td><td class="line">        <span class='keyword'>const</span> <span class='keyword'>float</span>* h2 = it.planes[1].ptr&lt;<span class='keyword'>float</span>&gt;();</td></tr>
<tr class="codeline" data-linenumber="2040"><td class="num" id="LN2040">2040</td><td class="line">        <span class='keyword'>const</span> <span class='keyword'>int</span> len = it.planes[0].rows*it.planes[0].cols*H1.channels();</td></tr>
<tr class="codeline" data-linenumber="2041"><td class="num" id="LN2041">2041</td><td class="line">        j = 0;</td></tr>
<tr class="codeline" data-linenumber="2042"><td class="num" id="LN2042">2042</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2043"><td class="num" id="LN2043">2043</td><td class="line">        <span class='keyword'>if</span>( (method == CV_COMP_CHISQR) || (method == CV_COMP_CHISQR_ALT))</td></tr>
<tr class="codeline" data-linenumber="2044"><td class="num" id="LN2044">2044</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2045"><td class="num" id="LN2045">2045</td><td class="line">            <span class='keyword'>for</span>( ; j &lt; len; j++ )</td></tr>
<tr class="codeline" data-linenumber="2046"><td class="num" id="LN2046">2046</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="2047"><td class="num" id="LN2047">2047</td><td class="line">                <span class='keyword'>double</span> a = h1[j] - h2[j];</td></tr>
<tr class="codeline" data-linenumber="2048"><td class="num" id="LN2048">2048</td><td class="line">                <span class='keyword'>double</span> b = (method == CV_COMP_CHISQR) ? h1[j] : h1[j] + h2[j];</td></tr>
<tr class="codeline" data-linenumber="2049"><td class="num" id="LN2049">2049</td><td class="line">                <span class='keyword'>if</span>( fabs(b) &gt; <span class='macro'>DBL_EPSILON<span class='macro_popup'>2.2204460492503131e-16</span></span> )</td></tr>
<tr class="codeline" data-linenumber="2050"><td class="num" id="LN2050">2050</td><td class="line">                    result += a*a/b;</td></tr>
<tr class="codeline" data-linenumber="2051"><td class="num" id="LN2051">2051</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2052"><td class="num" id="LN2052">2052</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2053"><td class="num" id="LN2053">2053</td><td class="line">        <span class='keyword'>else</span> <span class='keyword'>if</span>( method == CV_COMP_CORREL )</td></tr>
<tr class="codeline" data-linenumber="2054"><td class="num" id="LN2054">2054</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2055"><td class="num" id="LN2055">2055</td><td class="line"><span class='directive'>#if <span class='macro'>CV_SIMD_64F<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="2056"><td class="num" id="LN2056">2056</td><td class="line">            v_float64 v_s1 = vx_setzero_f64();</td></tr>
<tr class="codeline" data-linenumber="2057"><td class="num" id="LN2057">2057</td><td class="line">            v_float64 v_s2 = vx_setzero_f64();</td></tr>
<tr class="codeline" data-linenumber="2058"><td class="num" id="LN2058">2058</td><td class="line">            v_float64 v_s11 = vx_setzero_f64();</td></tr>
<tr class="codeline" data-linenumber="2059"><td class="num" id="LN2059">2059</td><td class="line">            v_float64 v_s12 = vx_setzero_f64();</td></tr>
<tr class="codeline" data-linenumber="2060"><td class="num" id="LN2060">2060</td><td class="line">            v_float64 v_s22 = vx_setzero_f64();</td></tr>
<tr class="codeline" data-linenumber="2061"><td class="num" id="LN2061">2061</td><td class="line">            <span class='keyword'>for</span> ( ; j &lt;= len - v_float32::nlanes; j += v_float32::nlanes)</td></tr>
<tr class="codeline" data-linenumber="2062"><td class="num" id="LN2062">2062</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="2063"><td class="num" id="LN2063">2063</td><td class="line">                v_float32 v_a = vx_load(h1 + j);</td></tr>
<tr class="codeline" data-linenumber="2064"><td class="num" id="LN2064">2064</td><td class="line">                v_float32 v_b = vx_load(h2 + j);</td></tr>
<tr class="codeline" data-linenumber="2065"><td class="num" id="LN2065">2065</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2066"><td class="num" id="LN2066">2066</td><td class="line">                <span class='comment'>// 0-1</span></td></tr>
<tr class="codeline" data-linenumber="2067"><td class="num" id="LN2067">2067</td><td class="line">                v_float64 v_ad = v_cvt_f64(v_a);</td></tr>
<tr class="codeline" data-linenumber="2068"><td class="num" id="LN2068">2068</td><td class="line">                v_float64 v_bd = v_cvt_f64(v_b);</td></tr>
<tr class="codeline" data-linenumber="2069"><td class="num" id="LN2069">2069</td><td class="line">                v_s12 = v_muladd(v_ad, v_bd, v_s12);</td></tr>
<tr class="codeline" data-linenumber="2070"><td class="num" id="LN2070">2070</td><td class="line">                v_s11 = v_muladd(v_ad, v_ad, v_s11);</td></tr>
<tr class="codeline" data-linenumber="2071"><td class="num" id="LN2071">2071</td><td class="line">                v_s22 = v_muladd(v_bd, v_bd, v_s22);</td></tr>
<tr class="codeline" data-linenumber="2072"><td class="num" id="LN2072">2072</td><td class="line">                v_s1 += v_ad;</td></tr>
<tr class="codeline" data-linenumber="2073"><td class="num" id="LN2073">2073</td><td class="line">                v_s2 += v_bd;</td></tr>
<tr class="codeline" data-linenumber="2074"><td class="num" id="LN2074">2074</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2075"><td class="num" id="LN2075">2075</td><td class="line">                <span class='comment'>// 2-3</span></td></tr>
<tr class="codeline" data-linenumber="2076"><td class="num" id="LN2076">2076</td><td class="line">                v_ad = v_cvt_f64_high(v_a);</td></tr>
<tr class="codeline" data-linenumber="2077"><td class="num" id="LN2077">2077</td><td class="line">                v_bd = v_cvt_f64_high(v_b);</td></tr>
<tr class="codeline" data-linenumber="2078"><td class="num" id="LN2078">2078</td><td class="line">                v_s12 = v_muladd(v_ad, v_bd, v_s12);</td></tr>
<tr class="codeline" data-linenumber="2079"><td class="num" id="LN2079">2079</td><td class="line">                v_s11 = v_muladd(v_ad, v_ad, v_s11);</td></tr>
<tr class="codeline" data-linenumber="2080"><td class="num" id="LN2080">2080</td><td class="line">                v_s22 = v_muladd(v_bd, v_bd, v_s22);</td></tr>
<tr class="codeline" data-linenumber="2081"><td class="num" id="LN2081">2081</td><td class="line">                v_s1 += v_ad;</td></tr>
<tr class="codeline" data-linenumber="2082"><td class="num" id="LN2082">2082</td><td class="line">                v_s2 += v_bd;</td></tr>
<tr class="codeline" data-linenumber="2083"><td class="num" id="LN2083">2083</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2084"><td class="num" id="LN2084">2084</td><td class="line">            s12 += v_reduce_sum(v_s12);</td></tr>
<tr class="codeline" data-linenumber="2085"><td class="num" id="LN2085">2085</td><td class="line">            s11 += v_reduce_sum(v_s11);</td></tr>
<tr class="codeline" data-linenumber="2086"><td class="num" id="LN2086">2086</td><td class="line">            s22 += v_reduce_sum(v_s22);</td></tr>
<tr class="codeline" data-linenumber="2087"><td class="num" id="LN2087">2087</td><td class="line">            s1 += v_reduce_sum(v_s1);</td></tr>
<tr class="codeline" data-linenumber="2088"><td class="num" id="LN2088">2088</td><td class="line">            s2 += v_reduce_sum(v_s2);</td></tr>
<tr class="codeline" data-linenumber="2089"><td class="num" id="LN2089">2089</td><td class="line"><span class='directive'>#elif <span class='macro'>CV_SIMD<span class='macro_popup'>1</span></span> &amp;&amp; 0 //Disable vectorization for CV_COMP_CORREL if f64 is unsupported due to low precision</span></td></tr>
<tr class="codeline" data-linenumber="2090"><td class="num" id="LN2090">2090</td><td class="line">            v_float32 v_s1 = vx_setzero_f32();</td></tr>
<tr class="codeline" data-linenumber="2091"><td class="num" id="LN2091">2091</td><td class="line">            v_float32 v_s2 = vx_setzero_f32();</td></tr>
<tr class="codeline" data-linenumber="2092"><td class="num" id="LN2092">2092</td><td class="line">            v_float32 v_s11 = vx_setzero_f32();</td></tr>
<tr class="codeline" data-linenumber="2093"><td class="num" id="LN2093">2093</td><td class="line">            v_float32 v_s12 = vx_setzero_f32();</td></tr>
<tr class="codeline" data-linenumber="2094"><td class="num" id="LN2094">2094</td><td class="line">            v_float32 v_s22 = vx_setzero_f32();</td></tr>
<tr class="codeline" data-linenumber="2095"><td class="num" id="LN2095">2095</td><td class="line">            <span class='keyword'>for</span> (; j &lt;= len - v_float32::nlanes; j += v_float32::nlanes)</td></tr>
<tr class="codeline" data-linenumber="2096"><td class="num" id="LN2096">2096</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="2097"><td class="num" id="LN2097">2097</td><td class="line">                v_float32 v_a = vx_load(h1 + j);</td></tr>
<tr class="codeline" data-linenumber="2098"><td class="num" id="LN2098">2098</td><td class="line">                v_float32 v_b = vx_load(h2 + j);</td></tr>
<tr class="codeline" data-linenumber="2099"><td class="num" id="LN2099">2099</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2100"><td class="num" id="LN2100">2100</td><td class="line">                v_s12 = v_muladd(v_a, v_b, v_s12);</td></tr>
<tr class="codeline" data-linenumber="2101"><td class="num" id="LN2101">2101</td><td class="line">                v_s11 = v_muladd(v_a, v_a, v_s11);</td></tr>
<tr class="codeline" data-linenumber="2102"><td class="num" id="LN2102">2102</td><td class="line">                v_s22 = v_muladd(v_b, v_b, v_s22);</td></tr>
<tr class="codeline" data-linenumber="2103"><td class="num" id="LN2103">2103</td><td class="line">                v_s1 += v_a;</td></tr>
<tr class="codeline" data-linenumber="2104"><td class="num" id="LN2104">2104</td><td class="line">                v_s2 += v_b;</td></tr>
<tr class="codeline" data-linenumber="2105"><td class="num" id="LN2105">2105</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2106"><td class="num" id="LN2106">2106</td><td class="line">            s12 += v_reduce_sum(v_s12);</td></tr>
<tr class="codeline" data-linenumber="2107"><td class="num" id="LN2107">2107</td><td class="line">            s11 += v_reduce_sum(v_s11);</td></tr>
<tr class="codeline" data-linenumber="2108"><td class="num" id="LN2108">2108</td><td class="line">            s22 += v_reduce_sum(v_s22);</td></tr>
<tr class="codeline" data-linenumber="2109"><td class="num" id="LN2109">2109</td><td class="line">            s1 += v_reduce_sum(v_s1);</td></tr>
<tr class="codeline" data-linenumber="2110"><td class="num" id="LN2110">2110</td><td class="line">            s2 += v_reduce_sum(v_s2);</td></tr>
<tr class="codeline" data-linenumber="2111"><td class="num" id="LN2111">2111</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2112"><td class="num" id="LN2112">2112</td><td class="line">            <span class='keyword'>for</span>( ; j &lt; len; j++ )</td></tr>
<tr class="codeline" data-linenumber="2113"><td class="num" id="LN2113">2113</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="2114"><td class="num" id="LN2114">2114</td><td class="line">                <span class='keyword'>double</span> a = h1[j];</td></tr>
<tr class="codeline" data-linenumber="2115"><td class="num" id="LN2115">2115</td><td class="line">                <span class='keyword'>double</span> b = h2[j];</td></tr>
<tr class="codeline" data-linenumber="2116"><td class="num" id="LN2116">2116</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2117"><td class="num" id="LN2117">2117</td><td class="line">                s12 += a*b;</td></tr>
<tr class="codeline" data-linenumber="2118"><td class="num" id="LN2118">2118</td><td class="line">                s1 += a;</td></tr>
<tr class="codeline" data-linenumber="2119"><td class="num" id="LN2119">2119</td><td class="line">                s11 += a*a;</td></tr>
<tr class="codeline" data-linenumber="2120"><td class="num" id="LN2120">2120</td><td class="line">                s2 += b;</td></tr>
<tr class="codeline" data-linenumber="2121"><td class="num" id="LN2121">2121</td><td class="line">                s22 += b*b;</td></tr>
<tr class="codeline" data-linenumber="2122"><td class="num" id="LN2122">2122</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2123"><td class="num" id="LN2123">2123</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2124"><td class="num" id="LN2124">2124</td><td class="line">        <span class='keyword'>else</span> <span class='keyword'>if</span>( method == CV_COMP_INTERSECT )</td></tr>
<tr class="codeline" data-linenumber="2125"><td class="num" id="LN2125">2125</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2126"><td class="num" id="LN2126">2126</td><td class="line"><span class='directive'>#if <span class='macro'>CV_SIMD_64F<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="2127"><td class="num" id="LN2127">2127</td><td class="line">            v_float64 v_result = vx_setzero_f64();</td></tr>
<tr class="codeline" data-linenumber="2128"><td class="num" id="LN2128">2128</td><td class="line">            <span class='keyword'>for</span> ( ; j &lt;= len - v_float32::nlanes; j += v_float32::nlanes)</td></tr>
<tr class="codeline" data-linenumber="2129"><td class="num" id="LN2129">2129</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="2130"><td class="num" id="LN2130">2130</td><td class="line">                v_float32 v_src = v_min(vx_load(h1 + j), vx_load(h2 + j));</td></tr>
<tr class="codeline" data-linenumber="2131"><td class="num" id="LN2131">2131</td><td class="line">                v_result += v_cvt_f64(v_src) + v_cvt_f64_high(v_src);</td></tr>
<tr class="codeline" data-linenumber="2132"><td class="num" id="LN2132">2132</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2133"><td class="num" id="LN2133">2133</td><td class="line">            result += v_reduce_sum(v_result);</td></tr>
<tr class="codeline" data-linenumber="2134"><td class="num" id="LN2134">2134</td><td class="line"><span class='directive'>#elif <span class='macro'>CV_SIMD<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="2135"><td class="num" id="LN2135">2135</td><td class="line">            v_float32 v_result = vx_setzero_f32();</td></tr>
<tr class="codeline" data-linenumber="2136"><td class="num" id="LN2136">2136</td><td class="line">            <span class='keyword'>for</span> (; j &lt;= len - v_float32::nlanes; j += v_float32::nlanes)</td></tr>
<tr class="codeline" data-linenumber="2137"><td class="num" id="LN2137">2137</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="2138"><td class="num" id="LN2138">2138</td><td class="line">                v_float32 v_src = v_min(vx_load(h1 + j), vx_load(h2 + j));</td></tr>
<tr class="codeline" data-linenumber="2139"><td class="num" id="LN2139">2139</td><td class="line">                v_result += v_src;</td></tr>
<tr class="codeline" data-linenumber="2140"><td class="num" id="LN2140">2140</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2141"><td class="num" id="LN2141">2141</td><td class="line">            result += v_reduce_sum(v_result);</td></tr>
<tr class="codeline" data-linenumber="2142"><td class="num" id="LN2142">2142</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2143"><td class="num" id="LN2143">2143</td><td class="line">            <span class='keyword'>for</span>( ; j &lt; len; j++ )</td></tr>
<tr class="codeline" data-linenumber="2144"><td class="num" id="LN2144">2144</td><td class="line">                result += std::min(h1[j], h2[j]);</td></tr>
<tr class="codeline" data-linenumber="2145"><td class="num" id="LN2145">2145</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2146"><td class="num" id="LN2146">2146</td><td class="line">        <span class='keyword'>else</span> <span class='keyword'>if</span>( method == CV_COMP_BHATTACHARYYA )</td></tr>
<tr class="codeline" data-linenumber="2147"><td class="num" id="LN2147">2147</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2148"><td class="num" id="LN2148">2148</td><td class="line"><span class='directive'>#if <span class='macro'>CV_SIMD_64F<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="2149"><td class="num" id="LN2149">2149</td><td class="line">            v_float64 v_s1 = vx_setzero_f64();</td></tr>
<tr class="codeline" data-linenumber="2150"><td class="num" id="LN2150">2150</td><td class="line">            v_float64 v_s2 = vx_setzero_f64();</td></tr>
<tr class="codeline" data-linenumber="2151"><td class="num" id="LN2151">2151</td><td class="line">            v_float64 v_result = vx_setzero_f64();</td></tr>
<tr class="codeline" data-linenumber="2152"><td class="num" id="LN2152">2152</td><td class="line">            <span class='keyword'>for</span> ( ; j &lt;= len - v_float32::nlanes; j += v_float32::nlanes)</td></tr>
<tr class="codeline" data-linenumber="2153"><td class="num" id="LN2153">2153</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="2154"><td class="num" id="LN2154">2154</td><td class="line">                v_float32 v_a = vx_load(h1 + j);</td></tr>
<tr class="codeline" data-linenumber="2155"><td class="num" id="LN2155">2155</td><td class="line">                v_float32 v_b = vx_load(h2 + j);</td></tr>
<tr class="codeline" data-linenumber="2156"><td class="num" id="LN2156">2156</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2157"><td class="num" id="LN2157">2157</td><td class="line">                v_float64 v_ad = v_cvt_f64(v_a);</td></tr>
<tr class="codeline" data-linenumber="2158"><td class="num" id="LN2158">2158</td><td class="line">                v_float64 v_bd = v_cvt_f64(v_b);</td></tr>
<tr class="codeline" data-linenumber="2159"><td class="num" id="LN2159">2159</td><td class="line">                v_s1 += v_ad;</td></tr>
<tr class="codeline" data-linenumber="2160"><td class="num" id="LN2160">2160</td><td class="line">                v_s2 += v_bd;</td></tr>
<tr class="codeline" data-linenumber="2161"><td class="num" id="LN2161">2161</td><td class="line">                v_result += v_sqrt(v_ad * v_bd);</td></tr>
<tr class="codeline" data-linenumber="2162"><td class="num" id="LN2162">2162</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2163"><td class="num" id="LN2163">2163</td><td class="line">                v_ad = v_cvt_f64_high(v_a);</td></tr>
<tr class="codeline" data-linenumber="2164"><td class="num" id="LN2164">2164</td><td class="line">                v_bd = v_cvt_f64_high(v_b);</td></tr>
<tr class="codeline" data-linenumber="2165"><td class="num" id="LN2165">2165</td><td class="line">                v_s1 += v_ad;</td></tr>
<tr class="codeline" data-linenumber="2166"><td class="num" id="LN2166">2166</td><td class="line">                v_s2 += v_bd;</td></tr>
<tr class="codeline" data-linenumber="2167"><td class="num" id="LN2167">2167</td><td class="line">                v_result += v_sqrt(v_ad * v_bd);</td></tr>
<tr class="codeline" data-linenumber="2168"><td class="num" id="LN2168">2168</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2169"><td class="num" id="LN2169">2169</td><td class="line">            s1 += v_reduce_sum(v_s1);</td></tr>
<tr class="codeline" data-linenumber="2170"><td class="num" id="LN2170">2170</td><td class="line">            s2 += v_reduce_sum(v_s2);</td></tr>
<tr class="codeline" data-linenumber="2171"><td class="num" id="LN2171">2171</td><td class="line">            result += v_reduce_sum(v_result);</td></tr>
<tr class="codeline" data-linenumber="2172"><td class="num" id="LN2172">2172</td><td class="line"><span class='directive'>#elif <span class='macro'>CV_SIMD<span class='macro_popup'>1</span></span> &amp;&amp; 0 //Disable vectorization for CV_COMP_BHATTACHARYYA if f64 is unsupported due to low precision</span></td></tr>
<tr class="codeline" data-linenumber="2173"><td class="num" id="LN2173">2173</td><td class="line">            v_float32 v_s1 = vx_setzero_f32();</td></tr>
<tr class="codeline" data-linenumber="2174"><td class="num" id="LN2174">2174</td><td class="line">            v_float32 v_s2 = vx_setzero_f32();</td></tr>
<tr class="codeline" data-linenumber="2175"><td class="num" id="LN2175">2175</td><td class="line">            v_float32 v_result = vx_setzero_f32();</td></tr>
<tr class="codeline" data-linenumber="2176"><td class="num" id="LN2176">2176</td><td class="line">            <span class='keyword'>for</span> (; j &lt;= len - v_float32::nlanes; j += v_float32::nlanes)</td></tr>
<tr class="codeline" data-linenumber="2177"><td class="num" id="LN2177">2177</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="2178"><td class="num" id="LN2178">2178</td><td class="line">                v_float32 v_a = vx_load(h1 + j);</td></tr>
<tr class="codeline" data-linenumber="2179"><td class="num" id="LN2179">2179</td><td class="line">                v_float32 v_b = vx_load(h2 + j);</td></tr>
<tr class="codeline" data-linenumber="2180"><td class="num" id="LN2180">2180</td><td class="line">                v_s1 += v_a;</td></tr>
<tr class="codeline" data-linenumber="2181"><td class="num" id="LN2181">2181</td><td class="line">                v_s2 += v_b;</td></tr>
<tr class="codeline" data-linenumber="2182"><td class="num" id="LN2182">2182</td><td class="line">                v_result += v_sqrt(v_a * v_b);</td></tr>
<tr class="codeline" data-linenumber="2183"><td class="num" id="LN2183">2183</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2184"><td class="num" id="LN2184">2184</td><td class="line">            s1 += v_reduce_sum(v_s1);</td></tr>
<tr class="codeline" data-linenumber="2185"><td class="num" id="LN2185">2185</td><td class="line">            s2 += v_reduce_sum(v_s2);</td></tr>
<tr class="codeline" data-linenumber="2186"><td class="num" id="LN2186">2186</td><td class="line">            result += v_reduce_sum(v_result);</td></tr>
<tr class="codeline" data-linenumber="2187"><td class="num" id="LN2187">2187</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2188"><td class="num" id="LN2188">2188</td><td class="line">            <span class='keyword'>for</span>( ; j &lt; len; j++ )</td></tr>
<tr class="codeline" data-linenumber="2189"><td class="num" id="LN2189">2189</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="2190"><td class="num" id="LN2190">2190</td><td class="line">                <span class='keyword'>double</span> a = h1[j];</td></tr>
<tr class="codeline" data-linenumber="2191"><td class="num" id="LN2191">2191</td><td class="line">                <span class='keyword'>double</span> b = h2[j];</td></tr>
<tr class="codeline" data-linenumber="2192"><td class="num" id="LN2192">2192</td><td class="line">                result += std::sqrt(a*b);</td></tr>
<tr class="codeline" data-linenumber="2193"><td class="num" id="LN2193">2193</td><td class="line">                s1 += a;</td></tr>
<tr class="codeline" data-linenumber="2194"><td class="num" id="LN2194">2194</td><td class="line">                s2 += b;</td></tr>
<tr class="codeline" data-linenumber="2195"><td class="num" id="LN2195">2195</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2196"><td class="num" id="LN2196">2196</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2197"><td class="num" id="LN2197">2197</td><td class="line">        <span class='keyword'>else</span> <span class='keyword'>if</span>( method == CV_COMP_KL_DIV )</td></tr>
<tr class="codeline" data-linenumber="2198"><td class="num" id="LN2198">2198</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2199"><td class="num" id="LN2199">2199</td><td class="line">            <span class='keyword'>for</span>( ; j &lt; len; j++ )</td></tr>
<tr class="codeline" data-linenumber="2200"><td class="num" id="LN2200">2200</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="2201"><td class="num" id="LN2201">2201</td><td class="line">                <span class='keyword'>double</span> p = h1[j];</td></tr>
<tr class="codeline" data-linenumber="2202"><td class="num" id="LN2202">2202</td><td class="line">                <span class='keyword'>double</span> q = h2[j];</td></tr>
<tr class="codeline" data-linenumber="2203"><td class="num" id="LN2203">2203</td><td class="line">                <span class='keyword'>if</span>( fabs(p) &lt;= <span class='macro'>DBL_EPSILON<span class='macro_popup'>2.2204460492503131e-16</span></span> ) {</td></tr>
<tr class="codeline" data-linenumber="2204"><td class="num" id="LN2204">2204</td><td class="line">                    <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="2205"><td class="num" id="LN2205">2205</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="2206"><td class="num" id="LN2206">2206</td><td class="line">                <span class='keyword'>if</span>(  fabs(q) &lt;= <span class='macro'>DBL_EPSILON<span class='macro_popup'>2.2204460492503131e-16</span></span> ) {</td></tr>
<tr class="codeline" data-linenumber="2207"><td class="num" id="LN2207">2207</td><td class="line">                    q = 1e-10;</td></tr>
<tr class="codeline" data-linenumber="2208"><td class="num" id="LN2208">2208</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="2209"><td class="num" id="LN2209">2209</td><td class="line">                result += p * std::log( p / q );</td></tr>
<tr class="codeline" data-linenumber="2210"><td class="num" id="LN2210">2210</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2211"><td class="num" id="LN2211">2211</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2212"><td class="num" id="LN2212">2212</td><td class="line">        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2213"><td class="num" id="LN2213">2213</td><td class="line">            <span class='macro'>CV_Error( CV_StsBadArg, <span class='string_literal'>"Unknown comparison method"</span> )<span class='macro_popup'>do { (void)(CV_StsBadArg); (void)("Unknown comparison method"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2214"><td class="num" id="LN2214">2214</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2215"><td class="num" id="LN2215">2215</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2216"><td class="num" id="LN2216">2216</td><td class="line">    <span class='keyword'>if</span>( method == CV_COMP_CHISQR_ALT )</td></tr>
<tr class="codeline" data-linenumber="2217"><td class="num" id="LN2217">2217</td><td class="line">        result *= 2;</td></tr>
<tr class="codeline" data-linenumber="2218"><td class="num" id="LN2218">2218</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span>( method == CV_COMP_CORREL )</td></tr>
<tr class="codeline" data-linenumber="2219"><td class="num" id="LN2219">2219</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2220"><td class="num" id="LN2220">2220</td><td class="line">        size_t total = H1.total();</td></tr>
<tr class="codeline" data-linenumber="2221"><td class="num" id="LN2221">2221</td><td class="line">        <span class='keyword'>double</span> scale = 1./total;</td></tr>
<tr class="codeline" data-linenumber="2222"><td class="num" id="LN2222">2222</td><td class="line">        <span class='keyword'>double</span> num = s12 - s1*s2*scale;</td></tr>
<tr class="codeline" data-linenumber="2223"><td class="num" id="LN2223">2223</td><td class="line">        <span class='keyword'>double</span> denom2 = (s11 - s1*s1*scale)*(s22 - s2*s2*scale);</td></tr>
<tr class="codeline" data-linenumber="2224"><td class="num" id="LN2224">2224</td><td class="line">        result = std::abs(denom2) &gt; <span class='macro'>DBL_EPSILON<span class='macro_popup'>2.2204460492503131e-16</span></span> ? num/std::sqrt(denom2) : 1.;</td></tr>
<tr class="codeline" data-linenumber="2225"><td class="num" id="LN2225">2225</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2226"><td class="num" id="LN2226">2226</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span>( method == CV_COMP_BHATTACHARYYA )</td></tr>
<tr class="codeline" data-linenumber="2227"><td class="num" id="LN2227">2227</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2228"><td class="num" id="LN2228">2228</td><td class="line">        s1 *= s2;</td></tr>
<tr class="codeline" data-linenumber="2229"><td class="num" id="LN2229">2229</td><td class="line">        s1 = fabs(s1) &gt; <span class='macro'>FLT_EPSILON<span class='macro_popup'>1.19209290e-7F</span></span> ? 1./std::sqrt(s1) : 1.;</td></tr>
<tr class="codeline" data-linenumber="2230"><td class="num" id="LN2230">2230</td><td class="line">        result = std::sqrt(std::max(1. - result*s1, 0.));</td></tr>
<tr class="codeline" data-linenumber="2231"><td class="num" id="LN2231">2231</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2232"><td class="num" id="LN2232">2232</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2233"><td class="num" id="LN2233">2233</td><td class="line">    <span class='keyword'>return</span> result;</td></tr>
<tr class="codeline" data-linenumber="2234"><td class="num" id="LN2234">2234</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2235"><td class="num" id="LN2235">2235</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2236"><td class="num" id="LN2236">2236</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2237"><td class="num" id="LN2237">2237</td><td class="line"><span class='keyword'>double</span> cv::compareHist( <span class='keyword'>const</span> SparseMat&amp; H1, <span class='keyword'>const</span> SparseMat&amp; H2, <span class='keyword'>int</span> method )</td></tr>
<tr class="codeline" data-linenumber="2238"><td class="num" id="LN2238">2238</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2239"><td class="num" id="LN2239">2239</td><td class="line">    <span class='macro'>CV_INSTRUMENT_REGION()<span class='macro_popup'>; static cv::utils::trace::details::Region::LocationExtraData<br>* __cv_trace_location_extra_fn2239 = 0; static const cv::utils<br>::trace::details::Region::LocationStaticStorage __cv_trace_location_fn2239<br> = { &amp;(__cv_trace_location_extra_fn2239), __PRETTY_FUNCTION__<br>, "/home/zhh/projects/opencv-4.5.2/modules/imgproc/src/histogram.cpp"<br>, 2239, ((0) | cv::utils::trace::details::REGION_FLAG_FUNCTION<br>)};; const cv::utils::trace::details::Region __region_fn(__cv_trace_location_fn2239<br>);;</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2240"><td class="num" id="LN2240">2240</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2241"><td class="num" id="LN2241">2241</td><td class="line">    <span class='keyword'>double</span> result = 0;</td></tr>
<tr class="codeline" data-linenumber="2242"><td class="num" id="LN2242">2242</td><td class="line">    <span class='keyword'>int</span> i, dims = H1.dims();</td></tr>
<tr class="codeline" data-linenumber="2243"><td class="num" id="LN2243">2243</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2244"><td class="num" id="LN2244">2244</td><td class="line">    <span class='macro'>CV_Assert( dims &gt; 0 &amp;&amp; dims == H2.dims() &amp;&amp; H1.type() == H2.type() &amp;&amp; H1.type() == CV_32F )<span class='macro_popup'>do { if (!(dims &gt; 0 &amp;&amp; dims == H2.dims() &amp;&amp;<br> H1.type() == H2.type() &amp;&amp; H1.type() == 5)) abort(); }<br> while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2245"><td class="num" id="LN2245">2245</td><td class="line">    <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="2246"><td class="num" id="LN2246">2246</td><td class="line">        <span class='macro'>CV_Assert( H1.size(i) == H2.size(i) )<span class='macro_popup'>do { if (!(H1.size(i) == H2.size(i))) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2247"><td class="num" id="LN2247">2247</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2248"><td class="num" id="LN2248">2248</td><td class="line">    <span class='keyword'>const</span> SparseMat *PH1 = &amp;H1, *PH2 = &amp;H2;</td></tr>
<tr class="codeline" data-linenumber="2249"><td class="num" id="LN2249">2249</td><td class="line">    <span class='keyword'>if</span>( PH1-&gt;nzcount() &gt; PH2-&gt;nzcount() &amp;&amp; method != CV_COMP_CHISQR &amp;&amp; method != CV_COMP_CHISQR_ALT &amp;&amp; method != CV_COMP_KL_DIV )</td></tr>
<tr class="codeline" data-linenumber="2250"><td class="num" id="LN2250">2250</td><td class="line">        std::swap(PH1, PH2);</td></tr>
<tr class="codeline" data-linenumber="2251"><td class="num" id="LN2251">2251</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2252"><td class="num" id="LN2252">2252</td><td class="line">    SparseMatConstIterator it = PH1-&gt;begin();</td></tr>
<tr class="codeline" data-linenumber="2253"><td class="num" id="LN2253">2253</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2254"><td class="num" id="LN2254">2254</td><td class="line">    <span class='keyword'>int</span> N1 = (<span class='keyword'>int</span>)PH1-&gt;nzcount(), N2 = (<span class='keyword'>int</span>)PH2-&gt;nzcount();</td></tr>
<tr class="codeline" data-linenumber="2255"><td class="num" id="LN2255">2255</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2256"><td class="num" id="LN2256">2256</td><td class="line">    <span class='keyword'>if</span>( (method == CV_COMP_CHISQR) || (method == CV_COMP_CHISQR_ALT) )</td></tr>
<tr class="codeline" data-linenumber="2257"><td class="num" id="LN2257">2257</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2258"><td class="num" id="LN2258">2258</td><td class="line">        <span class='keyword'>for</span>( i = 0; i &lt; N1; i++, ++it )</td></tr>
<tr class="codeline" data-linenumber="2259"><td class="num" id="LN2259">2259</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2260"><td class="num" id="LN2260">2260</td><td class="line">            <span class='macro'>CV_Assert(it.ptr != NULL)<span class='macro_popup'>do { if (!(it.ptr != __null)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2261"><td class="num" id="LN2261">2261</td><td class="line">            <span class='keyword'>float</span> v1 = it.value&lt;<span class='keyword'>float</span>&gt;();</td></tr>
<tr class="codeline" data-linenumber="2262"><td class="num" id="LN2262">2262</td><td class="line">            <span class='keyword'>const</span> SparseMat::Node* node = it.node();</td></tr>
<tr class="codeline" data-linenumber="2263"><td class="num" id="LN2263">2263</td><td class="line">            <span class='keyword'>float</span> v2 = PH2-&gt;value&lt;<span class='keyword'>float</span>&gt;(node-&gt;idx, (size_t*)&amp;node-&gt;hashval);</td></tr>
<tr class="codeline" data-linenumber="2264"><td class="num" id="LN2264">2264</td><td class="line">            <span class='keyword'>double</span> a = v1 - v2;</td></tr>
<tr class="codeline" data-linenumber="2265"><td class="num" id="LN2265">2265</td><td class="line">            <span class='keyword'>double</span> b = (method == CV_COMP_CHISQR) ? v1 : v1 + v2;</td></tr>
<tr class="codeline" data-linenumber="2266"><td class="num" id="LN2266">2266</td><td class="line">            <span class='keyword'>if</span>( fabs(b) &gt; <span class='macro'>DBL_EPSILON<span class='macro_popup'>2.2204460492503131e-16</span></span> )</td></tr>
<tr class="codeline" data-linenumber="2267"><td class="num" id="LN2267">2267</td><td class="line">                result += a*a/b;</td></tr>
<tr class="codeline" data-linenumber="2268"><td class="num" id="LN2268">2268</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2269"><td class="num" id="LN2269">2269</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2270"><td class="num" id="LN2270">2270</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span>( method == CV_COMP_CORREL )</td></tr>
<tr class="codeline" data-linenumber="2271"><td class="num" id="LN2271">2271</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2272"><td class="num" id="LN2272">2272</td><td class="line">        <span class='keyword'>double</span> s1 = 0, s2 = 0, s11 = 0, s12 = 0, s22 = 0;</td></tr>
<tr class="codeline" data-linenumber="2273"><td class="num" id="LN2273">2273</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2274"><td class="num" id="LN2274">2274</td><td class="line">        <span class='keyword'>for</span>( i = 0; i &lt; N1; i++, ++it )</td></tr>
<tr class="codeline" data-linenumber="2275"><td class="num" id="LN2275">2275</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2276"><td class="num" id="LN2276">2276</td><td class="line">            <span class='macro'>CV_Assert(it.ptr != NULL)<span class='macro_popup'>do { if (!(it.ptr != __null)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2277"><td class="num" id="LN2277">2277</td><td class="line">            <span class='keyword'>double</span> v1 = it.value&lt;<span class='keyword'>float</span>&gt;();</td></tr>
<tr class="codeline" data-linenumber="2278"><td class="num" id="LN2278">2278</td><td class="line">            <span class='keyword'>const</span> SparseMat::Node* node = it.node();</td></tr>
<tr class="codeline" data-linenumber="2279"><td class="num" id="LN2279">2279</td><td class="line">            s12 += v1*PH2-&gt;value&lt;<span class='keyword'>float</span>&gt;(node-&gt;idx, (size_t*)&amp;node-&gt;hashval);</td></tr>
<tr class="codeline" data-linenumber="2280"><td class="num" id="LN2280">2280</td><td class="line">            s1 += v1;</td></tr>
<tr class="codeline" data-linenumber="2281"><td class="num" id="LN2281">2281</td><td class="line">            s11 += v1*v1;</td></tr>
<tr class="codeline" data-linenumber="2282"><td class="num" id="LN2282">2282</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2283"><td class="num" id="LN2283">2283</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2284"><td class="num" id="LN2284">2284</td><td class="line">        it = PH2-&gt;begin();</td></tr>
<tr class="codeline" data-linenumber="2285"><td class="num" id="LN2285">2285</td><td class="line">        <span class='keyword'>for</span>( i = 0; i &lt; N2; i++, ++it )</td></tr>
<tr class="codeline" data-linenumber="2286"><td class="num" id="LN2286">2286</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2287"><td class="num" id="LN2287">2287</td><td class="line">            <span class='macro'>CV_Assert(it.ptr != NULL)<span class='macro_popup'>do { if (!(it.ptr != __null)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2288"><td class="num" id="LN2288">2288</td><td class="line">            <span class='keyword'>double</span> v2 = it.value&lt;<span class='keyword'>float</span>&gt;();</td></tr>
<tr class="codeline" data-linenumber="2289"><td class="num" id="LN2289">2289</td><td class="line">            s2 += v2;</td></tr>
<tr class="codeline" data-linenumber="2290"><td class="num" id="LN2290">2290</td><td class="line">            s22 += v2*v2;</td></tr>
<tr class="codeline" data-linenumber="2291"><td class="num" id="LN2291">2291</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2292"><td class="num" id="LN2292">2292</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2293"><td class="num" id="LN2293">2293</td><td class="line">        size_t total = 1;</td></tr>
<tr class="codeline" data-linenumber="2294"><td class="num" id="LN2294">2294</td><td class="line">        <span class='keyword'>for</span>( i = 0; i &lt; H1.dims(); i++ )</td></tr>
<tr class="codeline" data-linenumber="2295"><td class="num" id="LN2295">2295</td><td class="line">            total *= H1.size(i);</td></tr>
<tr class="codeline" data-linenumber="2296"><td class="num" id="LN2296">2296</td><td class="line">        <span class='keyword'>double</span> scale = 1./total;</td></tr>
<tr class="codeline" data-linenumber="2297"><td class="num" id="LN2297">2297</td><td class="line">        <span class='keyword'>double</span> num = s12 - s1*s2*scale;</td></tr>
<tr class="codeline" data-linenumber="2298"><td class="num" id="LN2298">2298</td><td class="line">        <span class='keyword'>double</span> denom2 = (s11 - s1*s1*scale)*(s22 - s2*s2*scale);</td></tr>
<tr class="codeline" data-linenumber="2299"><td class="num" id="LN2299">2299</td><td class="line">        result = std::abs(denom2) &gt; <span class='macro'>DBL_EPSILON<span class='macro_popup'>2.2204460492503131e-16</span></span> ? num/std::sqrt(denom2) : 1.;</td></tr>
<tr class="codeline" data-linenumber="2300"><td class="num" id="LN2300">2300</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2301"><td class="num" id="LN2301">2301</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span>( method == CV_COMP_INTERSECT )</td></tr>
<tr class="codeline" data-linenumber="2302"><td class="num" id="LN2302">2302</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2303"><td class="num" id="LN2303">2303</td><td class="line">        <span class='keyword'>for</span>( i = 0; i &lt; N1; i++, ++it )</td></tr>
<tr class="codeline" data-linenumber="2304"><td class="num" id="LN2304">2304</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2305"><td class="num" id="LN2305">2305</td><td class="line">            <span class='macro'>CV_Assert(it.ptr != NULL)<span class='macro_popup'>do { if (!(it.ptr != __null)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2306"><td class="num" id="LN2306">2306</td><td class="line">            <span class='keyword'>float</span> v1 = it.value&lt;<span class='keyword'>float</span>&gt;();</td></tr>
<tr class="codeline" data-linenumber="2307"><td class="num" id="LN2307">2307</td><td class="line">            <span class='keyword'>const</span> SparseMat::Node* node = it.node();</td></tr>
<tr class="codeline" data-linenumber="2308"><td class="num" id="LN2308">2308</td><td class="line">            <span class='keyword'>float</span> v2 = PH2-&gt;value&lt;<span class='keyword'>float</span>&gt;(node-&gt;idx, (size_t*)&amp;node-&gt;hashval);</td></tr>
<tr class="codeline" data-linenumber="2309"><td class="num" id="LN2309">2309</td><td class="line">            <span class='keyword'>if</span>( v2 )</td></tr>
<tr class="codeline" data-linenumber="2310"><td class="num" id="LN2310">2310</td><td class="line">                result += std::min(v1, v2);</td></tr>
<tr class="codeline" data-linenumber="2311"><td class="num" id="LN2311">2311</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2312"><td class="num" id="LN2312">2312</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2313"><td class="num" id="LN2313">2313</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span>( method == CV_COMP_BHATTACHARYYA )</td></tr>
<tr class="codeline" data-linenumber="2314"><td class="num" id="LN2314">2314</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2315"><td class="num" id="LN2315">2315</td><td class="line">        <span class='keyword'>double</span> s1 = 0, s2 = 0;</td></tr>
<tr class="codeline" data-linenumber="2316"><td class="num" id="LN2316">2316</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2317"><td class="num" id="LN2317">2317</td><td class="line">        <span class='keyword'>for</span>( i = 0; i &lt; N1; i++, ++it )</td></tr>
<tr class="codeline" data-linenumber="2318"><td class="num" id="LN2318">2318</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2319"><td class="num" id="LN2319">2319</td><td class="line">            <span class='macro'>CV_Assert(it.ptr != NULL)<span class='macro_popup'>do { if (!(it.ptr != __null)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2320"><td class="num" id="LN2320">2320</td><td class="line">            <span class='keyword'>double</span> v1 = it.value&lt;<span class='keyword'>float</span>&gt;();</td></tr>
<tr class="codeline" data-linenumber="2321"><td class="num" id="LN2321">2321</td><td class="line">            <span class='keyword'>const</span> SparseMat::Node* node = it.node();</td></tr>
<tr class="codeline" data-linenumber="2322"><td class="num" id="LN2322">2322</td><td class="line">            <span class='keyword'>double</span> v2 = PH2-&gt;value&lt;<span class='keyword'>float</span>&gt;(node-&gt;idx, (size_t*)&amp;node-&gt;hashval);</td></tr>
<tr class="codeline" data-linenumber="2323"><td class="num" id="LN2323">2323</td><td class="line">            result += std::sqrt(v1*v2);</td></tr>
<tr class="codeline" data-linenumber="2324"><td class="num" id="LN2324">2324</td><td class="line">            s1 += v1;</td></tr>
<tr class="codeline" data-linenumber="2325"><td class="num" id="LN2325">2325</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2326"><td class="num" id="LN2326">2326</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2327"><td class="num" id="LN2327">2327</td><td class="line">        it = PH2-&gt;begin();</td></tr>
<tr class="codeline" data-linenumber="2328"><td class="num" id="LN2328">2328</td><td class="line">        <span class='keyword'>for</span>( i = 0; i &lt; N2; i++, ++it )</td></tr>
<tr class="codeline" data-linenumber="2329"><td class="num" id="LN2329">2329</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2330"><td class="num" id="LN2330">2330</td><td class="line">            <span class='macro'>CV_Assert(it.ptr != NULL)<span class='macro_popup'>do { if (!(it.ptr != __null)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2331"><td class="num" id="LN2331">2331</td><td class="line">            s2 += it.value&lt;<span class='keyword'>float</span>&gt;();</td></tr>
<tr class="codeline" data-linenumber="2332"><td class="num" id="LN2332">2332</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2333"><td class="num" id="LN2333">2333</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2334"><td class="num" id="LN2334">2334</td><td class="line">        s1 *= s2;</td></tr>
<tr class="codeline" data-linenumber="2335"><td class="num" id="LN2335">2335</td><td class="line">        s1 = fabs(s1) &gt; <span class='macro'>FLT_EPSILON<span class='macro_popup'>1.19209290e-7F</span></span> ? 1./std::sqrt(s1) : 1.;</td></tr>
<tr class="codeline" data-linenumber="2336"><td class="num" id="LN2336">2336</td><td class="line">        result = std::sqrt(std::max(1. - result*s1, 0.));</td></tr>
<tr class="codeline" data-linenumber="2337"><td class="num" id="LN2337">2337</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2338"><td class="num" id="LN2338">2338</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span>( method == CV_COMP_KL_DIV )</td></tr>
<tr class="codeline" data-linenumber="2339"><td class="num" id="LN2339">2339</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2340"><td class="num" id="LN2340">2340</td><td class="line">        <span class='keyword'>for</span>( i = 0; i &lt; N1; i++, ++it )</td></tr>
<tr class="codeline" data-linenumber="2341"><td class="num" id="LN2341">2341</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2342"><td class="num" id="LN2342">2342</td><td class="line">            <span class='macro'>CV_Assert(it.ptr != NULL)<span class='macro_popup'>do { if (!(it.ptr != __null)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2343"><td class="num" id="LN2343">2343</td><td class="line">            <span class='keyword'>double</span> v1 = it.value&lt;<span class='keyword'>float</span>&gt;();</td></tr>
<tr class="codeline" data-linenumber="2344"><td class="num" id="LN2344">2344</td><td class="line">            <span class='keyword'>const</span> SparseMat::Node* node = it.node();</td></tr>
<tr class="codeline" data-linenumber="2345"><td class="num" id="LN2345">2345</td><td class="line">            <span class='keyword'>double</span> v2 = PH2-&gt;value&lt;<span class='keyword'>float</span>&gt;(node-&gt;idx, (size_t*)&amp;node-&gt;hashval);</td></tr>
<tr class="codeline" data-linenumber="2346"><td class="num" id="LN2346">2346</td><td class="line">            <span class='keyword'>if</span>( !v2 )</td></tr>
<tr class="codeline" data-linenumber="2347"><td class="num" id="LN2347">2347</td><td class="line">                v2 = 1e-10;</td></tr>
<tr class="codeline" data-linenumber="2348"><td class="num" id="LN2348">2348</td><td class="line">            result += v1 * std::log( v1 / v2 );</td></tr>
<tr class="codeline" data-linenumber="2349"><td class="num" id="LN2349">2349</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2350"><td class="num" id="LN2350">2350</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2351"><td class="num" id="LN2351">2351</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2352"><td class="num" id="LN2352">2352</td><td class="line">        <span class='macro'>CV_Error( CV_StsBadArg, <span class='string_literal'>"Unknown comparison method"</span> )<span class='macro_popup'>do { (void)(CV_StsBadArg); (void)("Unknown comparison method"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2353"><td class="num" id="LN2353">2353</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2354"><td class="num" id="LN2354">2354</td><td class="line">    <span class='keyword'>if</span>( method == CV_COMP_CHISQR_ALT )</td></tr>
<tr class="codeline" data-linenumber="2355"><td class="num" id="LN2355">2355</td><td class="line">        result *= 2;</td></tr>
<tr class="codeline" data-linenumber="2356"><td class="num" id="LN2356">2356</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2357"><td class="num" id="LN2357">2357</td><td class="line">    <span class='keyword'>return</span> result;</td></tr>
<tr class="codeline" data-linenumber="2358"><td class="num" id="LN2358">2358</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2359"><td class="num" id="LN2359">2359</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2360"><td class="num" id="LN2360">2360</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2361"><td class="num" id="LN2361">2361</td><td class="line"><span class='keyword'>const</span> <span class='keyword'>int</span> CV_HIST_DEFAULT_TYPE = <span class='macro'>CV_32F<span class='macro_popup'>5</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2362"><td class="num" id="LN2362">2362</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2363"><td class="num" id="LN2363">2363</td><td class="line"><span class='comment'>/* Creates new histogram */</span></td></tr>
<tr class="codeline" data-linenumber="2364"><td class="num" id="LN2364">2364</td><td class="line">CvHistogram *</td></tr>
<tr class="codeline" data-linenumber="2365"><td class="num" id="LN2365">2365</td><td class="line">cvCreateHist( <span class='keyword'>int</span> dims, <span class='keyword'>int</span> *sizes, CvHistType type, <span class='keyword'>float</span>** ranges, <span class='keyword'>int</span> uniform )</td></tr>
<tr class="codeline" data-linenumber="2366"><td class="num" id="LN2366">2366</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2367"><td class="num" id="LN2367">2367</td><td class="line">    CvHistogram *hist = 0;</td></tr>
<tr class="codeline" data-linenumber="2368"><td class="num" id="LN2368">2368</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2369"><td class="num" id="LN2369">2369</td><td class="line">    <span class='keyword'>if</span>( (<span class='keyword'>unsigned</span>)dims &gt; <span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span> )</td></tr>
<tr class="codeline" data-linenumber="2370"><td class="num" id="LN2370">2370</td><td class="line">        <span class='macro'>CV_Error( CV_BadOrder, <span class='string_literal'>"Number of dimensions is out of range"</span> )<span class='macro_popup'>do { (void)(CV_BadOrder); (void)("Number of dimensions is out of range"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2371"><td class="num" id="LN2371">2371</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2372"><td class="num" id="LN2372">2372</td><td class="line">    <span class='keyword'>if</span>( !sizes )</td></tr>
<tr class="codeline" data-linenumber="2373"><td class="num" id="LN2373">2373</td><td class="line">        <span class='macro'>CV_Error( CV_HeaderIsNull, <span class='string_literal'>"Null &lt;sizes&gt; pointer"</span> )<span class='macro_popup'>do { (void)(CV_HeaderIsNull); (void)("Null &lt;sizes&gt; pointer"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2374"><td class="num" id="LN2374">2374</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2375"><td class="num" id="LN2375">2375</td><td class="line">    hist = (CvHistogram *)cvAlloc( <span class='keyword'>sizeof</span>( CvHistogram ));</td></tr>
<tr class="codeline" data-linenumber="2376"><td class="num" id="LN2376">2376</td><td class="line">    hist-&gt;type = <span class='macro'>CV_HIST_MAGIC_VAL<span class='macro_popup'>0x42450000</span></span> + ((<span class='keyword'>int</span>)type &amp; 1);</td></tr>
<tr class="codeline" data-linenumber="2377"><td class="num" id="LN2377">2377</td><td class="line">    <span class='keyword'>if</span> (uniform) hist-&gt;type|= <span class='macro'>CV_HIST_UNIFORM_FLAG<span class='macro_popup'>(1 &lt;&lt; 10)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2378"><td class="num" id="LN2378">2378</td><td class="line">    hist-&gt;thresh2 = 0;</td></tr>
<tr class="codeline" data-linenumber="2379"><td class="num" id="LN2379">2379</td><td class="line">    hist-&gt;bins = 0;</td></tr>
<tr class="codeline" data-linenumber="2380"><td class="num" id="LN2380">2380</td><td class="line">    <span class='keyword'>if</span>( type == <span class='macro'>CV_HIST_ARRAY<span class='macro_popup'>0</span></span> )</td></tr>
<tr class="codeline" data-linenumber="2381"><td class="num" id="LN2381">2381</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2382"><td class="num" id="LN2382">2382</td><td class="line">        hist-&gt;bins = cvInitMatNDHeader( &amp;hist-&gt;mat, dims, sizes,</td></tr>
<tr class="codeline" data-linenumber="2383"><td class="num" id="LN2383">2383</td><td class="line">                                        CV_HIST_DEFAULT_TYPE );</td></tr>
<tr class="codeline" data-linenumber="2384"><td class="num" id="LN2384">2384</td><td class="line">        cvCreateData( hist-&gt;bins );</td></tr>
<tr class="codeline" data-linenumber="2385"><td class="num" id="LN2385">2385</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2386"><td class="num" id="LN2386">2386</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span>( type == <span class='macro'>CV_HIST_SPARSE<span class='macro_popup'>1</span></span> )</td></tr>
<tr class="codeline" data-linenumber="2387"><td class="num" id="LN2387">2387</td><td class="line">        hist-&gt;bins = cvCreateSparseMat( dims, sizes, CV_HIST_DEFAULT_TYPE );</td></tr>
<tr class="codeline" data-linenumber="2388"><td class="num" id="LN2388">2388</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2389"><td class="num" id="LN2389">2389</td><td class="line">        <span class='macro'>CV_Error( CV_StsBadArg, <span class='string_literal'>"Invalid histogram type"</span> )<span class='macro_popup'>do { (void)(CV_StsBadArg); (void)("Invalid histogram type"); abort<br>(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2390"><td class="num" id="LN2390">2390</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2391"><td class="num" id="LN2391">2391</td><td class="line">    <span class='keyword'>if</span>( ranges )</td></tr>
<tr class="codeline" data-linenumber="2392"><td class="num" id="LN2392">2392</td><td class="line">        cvSetHistBinRanges( hist, ranges, uniform );</td></tr>
<tr class="codeline" data-linenumber="2393"><td class="num" id="LN2393">2393</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2394"><td class="num" id="LN2394">2394</td><td class="line">    <span class='keyword'>return</span> hist;</td></tr>
<tr class="codeline" data-linenumber="2395"><td class="num" id="LN2395">2395</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2396"><td class="num" id="LN2396">2396</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2397"><td class="num" id="LN2397">2397</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2398"><td class="num" id="LN2398">2398</td><td class="line"><span class='comment'>/* Creates histogram wrapping header for given array */</span></td></tr>
<tr class="codeline" data-linenumber="2399"><td class="num" id="LN2399">2399</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> CvHistogram*</td></tr>
<tr class="codeline" data-linenumber="2400"><td class="num" id="LN2400">2400</td><td class="line">cvMakeHistHeaderForArray( <span class='keyword'>int</span> dims, <span class='keyword'>int</span> *sizes, CvHistogram *hist,</td></tr>
<tr class="codeline" data-linenumber="2401"><td class="num" id="LN2401">2401</td><td class="line">                          <span class='keyword'>float</span> *data, <span class='keyword'>float</span> **ranges, <span class='keyword'>int</span> uniform )</td></tr>
<tr class="codeline" data-linenumber="2402"><td class="num" id="LN2402">2402</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2403"><td class="num" id="LN2403">2403</td><td class="line">    <span class='keyword'>if</span>( !hist )</td></tr>
<tr class="codeline" data-linenumber="2404"><td class="num" id="LN2404">2404</td><td class="line">        <span class='macro'>CV_Error( CV_StsNullPtr, <span class='string_literal'>"Null histogram header pointer"</span> )<span class='macro_popup'>do { (void)(CV_StsNullPtr); (void)("Null histogram header pointer"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2405"><td class="num" id="LN2405">2405</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2406"><td class="num" id="LN2406">2406</td><td class="line">    <span class='keyword'>if</span>( !data )</td></tr>
<tr class="codeline" data-linenumber="2407"><td class="num" id="LN2407">2407</td><td class="line">        <span class='macro'>CV_Error( CV_StsNullPtr, <span class='string_literal'>"Null data pointer"</span> )<span class='macro_popup'>do { (void)(CV_StsNullPtr); (void)("Null data pointer"); abort<br>(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2408"><td class="num" id="LN2408">2408</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2409"><td class="num" id="LN2409">2409</td><td class="line">    hist-&gt;thresh2 = 0;</td></tr>
<tr class="codeline" data-linenumber="2410"><td class="num" id="LN2410">2410</td><td class="line">    hist-&gt;type = <span class='macro'>CV_HIST_MAGIC_VAL<span class='macro_popup'>0x42450000</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2411"><td class="num" id="LN2411">2411</td><td class="line">    hist-&gt;bins = cvInitMatNDHeader( &amp;hist-&gt;mat, dims, sizes, CV_HIST_DEFAULT_TYPE, data );</td></tr>
<tr class="codeline" data-linenumber="2412"><td class="num" id="LN2412">2412</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2413"><td class="num" id="LN2413">2413</td><td class="line">    <span class='keyword'>if</span>( ranges )</td></tr>
<tr class="codeline" data-linenumber="2414"><td class="num" id="LN2414">2414</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2415"><td class="num" id="LN2415">2415</td><td class="line">        <span class='keyword'>if</span>( !uniform )</td></tr>
<tr class="codeline" data-linenumber="2416"><td class="num" id="LN2416">2416</td><td class="line">            <span class='macro'>CV_Error( CV_StsBadArg, <span class='string_literal'>"Only uniform bin ranges can be used here "<span class='macro_popup'>do { (void)(CV_StsBadArg); (void)("Only uniform bin ranges can be used here "<br> "(to avoid memory allocation)"); abort(); } while (0)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="2417"><td class="num" id="LN2417">2417</td><td class="line">                                    <span class='string_literal'><span class='macro'>"(to avoid memory allocation)"</span> )<span class='macro_popup'>do { (void)(CV_StsBadArg); (void)("Only uniform bin ranges can be used here "<br> "(to avoid memory allocation)"); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2418"><td class="num" id="LN2418">2418</td><td class="line">        cvSetHistBinRanges( hist, ranges, uniform );</td></tr>
<tr class="codeline" data-linenumber="2419"><td class="num" id="LN2419">2419</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2420"><td class="num" id="LN2420">2420</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2421"><td class="num" id="LN2421">2421</td><td class="line">    <span class='keyword'>return</span> hist;</td></tr>
<tr class="codeline" data-linenumber="2422"><td class="num" id="LN2422">2422</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2423"><td class="num" id="LN2423">2423</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2424"><td class="num" id="LN2424">2424</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2425"><td class="num" id="LN2425">2425</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="2426"><td class="num" id="LN2426">2426</td><td class="line">cvReleaseHist( CvHistogram **hist )</td></tr>
<tr class="codeline" data-linenumber="2427"><td class="num" id="LN2427">2427</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2428"><td class="num" id="LN2428">2428</td><td class="line">    <span class='keyword'>if</span>( !hist )</td></tr>
<tr class="codeline" data-linenumber="2429"><td class="num" id="LN2429">2429</td><td class="line">        <span class='macro'>CV_Error( CV_StsNullPtr, <span class='string_literal'>""</span> )<span class='macro_popup'>do { (void)(CV_StsNullPtr); (void)(""); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2430"><td class="num" id="LN2430">2430</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2431"><td class="num" id="LN2431">2431</td><td class="line">    <span class='keyword'>if</span>( *hist )</td></tr>
<tr class="codeline" data-linenumber="2432"><td class="num" id="LN2432">2432</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2433"><td class="num" id="LN2433">2433</td><td class="line">        CvHistogram* temp = *hist;</td></tr>
<tr class="codeline" data-linenumber="2434"><td class="num" id="LN2434">2434</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2435"><td class="num" id="LN2435">2435</td><td class="line">        <span class='keyword'>if</span>( !<span class='macro'>CV_IS_HIST(temp)<span class='macro_popup'>((temp) != __null &amp;&amp; (((CvHistogram*)(temp))-&gt;type<br> &amp; 0xFFFF0000) == 0x42450000 &amp;&amp; (temp)-&gt;bins !=<br> __null)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2436"><td class="num" id="LN2436">2436</td><td class="line">            <span class='macro'>CV_Error( CV_StsBadArg, <span class='string_literal'>"Invalid histogram header"</span> )<span class='macro_popup'>do { (void)(CV_StsBadArg); (void)("Invalid histogram header")<br>; abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2437"><td class="num" id="LN2437">2437</td><td class="line">        *hist = 0;</td></tr>
<tr class="codeline" data-linenumber="2438"><td class="num" id="LN2438">2438</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2439"><td class="num" id="LN2439">2439</td><td class="line">        <span class='keyword'>if</span>( <span class='macro'>CV_IS_SPARSE_HIST( temp )<span class='macro_popup'>(((temp)-&gt;bins) != __null &amp;&amp; (((const CvSparseMat*<br>)((temp)-&gt;bins))-&gt;type &amp; 0xFFFF0000) == 0x42440000)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2440"><td class="num" id="LN2440">2440</td><td class="line">            cvReleaseSparseMat( (CvSparseMat**)&amp;temp-&gt;bins );</td></tr>
<tr class="codeline" data-linenumber="2441"><td class="num" id="LN2441">2441</td><td class="line">        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2442"><td class="num" id="LN2442">2442</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2443"><td class="num" id="LN2443">2443</td><td class="line">            cvReleaseData( temp-&gt;bins );</td></tr>
<tr class="codeline" data-linenumber="2444"><td class="num" id="LN2444">2444</td><td class="line">            temp-&gt;bins = 0;</td></tr>
<tr class="codeline" data-linenumber="2445"><td class="num" id="LN2445">2445</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2446"><td class="num" id="LN2446">2446</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2447"><td class="num" id="LN2447">2447</td><td class="line">        <span class='keyword'>if</span>( temp-&gt;thresh2 )</td></tr>
<tr class="codeline" data-linenumber="2448"><td class="num" id="LN2448">2448</td><td class="line">            <span class='macro'>cvFree( &amp;temp-&gt;thresh2 )<span class='macro_popup'>(cvFree_(*(&amp;temp-&gt;thresh2)), *(&amp;temp-&gt;thresh2)=<br>0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2449"><td class="num" id="LN2449">2449</td><td class="line">        <span class='macro'>cvFree( &amp;temp )<span class='macro_popup'>(cvFree_(*(&amp;temp)), *(&amp;temp)=0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2450"><td class="num" id="LN2450">2450</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2451"><td class="num" id="LN2451">2451</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2452"><td class="num" id="LN2452">2452</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2453"><td class="num" id="LN2453">2453</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="2454"><td class="num" id="LN2454">2454</td><td class="line">cvClearHist( CvHistogram *hist )</td></tr>
<tr class="codeline" data-linenumber="2455"><td class="num" id="LN2455">2455</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2456"><td class="num" id="LN2456">2456</td><td class="line">    <span class='keyword'>if</span>( !<span class='macro'>CV_IS_HIST(hist)<span class='macro_popup'>((hist) != __null &amp;&amp; (((CvHistogram*)(hist))-&gt;type<br> &amp; 0xFFFF0000) == 0x42450000 &amp;&amp; (hist)-&gt;bins !=<br> __null)</span></span> )</td></tr>
<tr class="codeline" data-linenumber="2457"><td class="num" id="LN2457">2457</td><td class="line">        <span class='macro'>CV_Error( CV_StsBadArg, <span class='string_literal'>"Invalid histogram header"</span> )<span class='macro_popup'>do { (void)(CV_StsBadArg); (void)("Invalid histogram header")<br>; abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2458"><td class="num" id="LN2458">2458</td><td class="line">    <span class='macro'>cvZero<span class='macro_popup'>cvSetZero</span></span>( hist-&gt;bins );</td></tr>
<tr class="codeline" data-linenumber="2459"><td class="num" id="LN2459">2459</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2460"><td class="num" id="LN2460">2460</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2461"><td class="num" id="LN2461">2461</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2462"><td class="num" id="LN2462">2462</td><td class="line"><span class='comment'>// Clears histogram bins that are below than threshold</span></td></tr>
<tr class="codeline" data-linenumber="2463"><td class="num" id="LN2463">2463</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="2464"><td class="num" id="LN2464">2464</td><td class="line">cvThreshHist( CvHistogram* hist, <span class='keyword'>double</span> thresh )</td></tr>
<tr class="codeline" data-linenumber="2465"><td class="num" id="LN2465">2465</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2466"><td class="num" id="LN2466">2466</td><td class="line">    <span class='keyword'>if</span>( !<span class='macro'>CV_IS_HIST(hist)<span class='macro_popup'>((hist) != __null &amp;&amp; (((CvHistogram*)(hist))-&gt;type<br> &amp; 0xFFFF0000) == 0x42450000 &amp;&amp; (hist)-&gt;bins !=<br> __null)</span></span> )</td></tr>
<tr class="codeline" data-linenumber="2467"><td class="num" id="LN2467">2467</td><td class="line">        <span class='macro'>CV_Error( CV_StsBadArg, <span class='string_literal'>"Invalid histogram header"</span> )<span class='macro_popup'>do { (void)(CV_StsBadArg); (void)("Invalid histogram header")<br>; abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2468"><td class="num" id="LN2468">2468</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2469"><td class="num" id="LN2469">2469</td><td class="line">    <span class='keyword'>if</span>( !<span class='macro'>CV_IS_SPARSE_MAT(hist-&gt;bins)<span class='macro_popup'>((hist-&gt;bins) != __null &amp;&amp; (((const CvSparseMat*)(<br>hist-&gt;bins))-&gt;type &amp; 0xFFFF0000) == 0x42440000)</span></span> )</td></tr>
<tr class="codeline" data-linenumber="2470"><td class="num" id="LN2470">2470</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2471"><td class="num" id="LN2471">2471</td><td class="line">        CvMat mat;</td></tr>
<tr class="codeline" data-linenumber="2472"><td class="num" id="LN2472">2472</td><td class="line">        cvGetMat( hist-&gt;bins, &amp;mat, 0, 1 );</td></tr>
<tr class="codeline" data-linenumber="2473"><td class="num" id="LN2473">2473</td><td class="line">        cvThreshold( &amp;mat, &amp;mat, thresh, 0, CV_THRESH_TOZERO );</td></tr>
<tr class="codeline" data-linenumber="2474"><td class="num" id="LN2474">2474</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2475"><td class="num" id="LN2475">2475</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2476"><td class="num" id="LN2476">2476</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2477"><td class="num" id="LN2477">2477</td><td class="line">        CvSparseMat* mat = (CvSparseMat*)hist-&gt;bins;</td></tr>
<tr class="codeline" data-linenumber="2478"><td class="num" id="LN2478">2478</td><td class="line">        CvSparseMatIterator iterator;</td></tr>
<tr class="codeline" data-linenumber="2479"><td class="num" id="LN2479">2479</td><td class="line">        CvSparseNode *node;</td></tr>
<tr class="codeline" data-linenumber="2480"><td class="num" id="LN2480">2480</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2481"><td class="num" id="LN2481">2481</td><td class="line">        <span class='keyword'>for</span>( node = cvInitSparseMatIterator( mat, &amp;iterator );</td></tr>
<tr class="codeline" data-linenumber="2482"><td class="num" id="LN2482">2482</td><td class="line">             node != 0; node = cvGetNextSparseNode( &amp;iterator ))</td></tr>
<tr class="codeline" data-linenumber="2483"><td class="num" id="LN2483">2483</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2484"><td class="num" id="LN2484">2484</td><td class="line">            <span class='keyword'>float</span>* val = (<span class='keyword'>float</span>*)<span class='macro'>CV_NODE_VAL( mat, node )<span class='macro_popup'>((void*)((uchar*)(node) + (mat)-&gt;valoffset))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2485"><td class="num" id="LN2485">2485</td><td class="line">            <span class='keyword'>if</span>( *val &lt;= thresh )</td></tr>
<tr class="codeline" data-linenumber="2486"><td class="num" id="LN2486">2486</td><td class="line">                *val = 0;</td></tr>
<tr class="codeline" data-linenumber="2487"><td class="num" id="LN2487">2487</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2488"><td class="num" id="LN2488">2488</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2489"><td class="num" id="LN2489">2489</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2490"><td class="num" id="LN2490">2490</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2491"><td class="num" id="LN2491">2491</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2492"><td class="num" id="LN2492">2492</td><td class="line"><span class='comment'>// Normalizes histogram (make sum of the histogram bins == factor)</span></td></tr>
<tr class="codeline" data-linenumber="2493"><td class="num" id="LN2493">2493</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="2494"><td class="num" id="LN2494">2494</td><td class="line">cvNormalizeHist( CvHistogram* hist, <span class='keyword'>double</span> factor )</td></tr>
<tr class="codeline" data-linenumber="2495"><td class="num" id="LN2495">2495</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2496"><td class="num" id="LN2496">2496</td><td class="line">    <span class='keyword'>double</span> sum = 0;</td></tr>
<tr class="codeline" data-linenumber="2497"><td class="num" id="LN2497">2497</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2498"><td class="num" id="LN2498">2498</td><td class="line">    <span class='keyword'>if</span>( !<span class='macro'>CV_IS_HIST(hist)<span class='macro_popup'>((hist) != __null &amp;&amp; (((CvHistogram*)(hist))-&gt;type<br> &amp; 0xFFFF0000) == 0x42450000 &amp;&amp; (hist)-&gt;bins !=<br> __null)</span></span> )</td></tr>
<tr class="codeline" data-linenumber="2499"><td class="num" id="LN2499">2499</td><td class="line">        <span class='macro'>CV_Error( CV_StsBadArg, <span class='string_literal'>"Invalid histogram header"</span> )<span class='macro_popup'>do { (void)(CV_StsBadArg); (void)("Invalid histogram header")<br>; abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2500"><td class="num" id="LN2500">2500</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2501"><td class="num" id="LN2501">2501</td><td class="line">    <span class='keyword'>if</span>( !<span class='macro'>CV_IS_SPARSE_HIST(hist)<span class='macro_popup'>(((hist)-&gt;bins) != __null &amp;&amp; (((const CvSparseMat*<br>)((hist)-&gt;bins))-&gt;type &amp; 0xFFFF0000) == 0x42440000)</span></span> )</td></tr>
<tr class="codeline" data-linenumber="2502"><td class="num" id="LN2502">2502</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2503"><td class="num" id="LN2503">2503</td><td class="line">        CvMat mat;</td></tr>
<tr class="codeline" data-linenumber="2504"><td class="num" id="LN2504">2504</td><td class="line">        cvGetMat( hist-&gt;bins, &amp;mat, 0, 1 );</td></tr>
<tr class="codeline" data-linenumber="2505"><td class="num" id="LN2505">2505</td><td class="line">        sum = cvSum( &amp;mat ).val[0];</td></tr>
<tr class="codeline" data-linenumber="2506"><td class="num" id="LN2506">2506</td><td class="line">        <span class='keyword'>if</span>( fabs(sum) &lt; <span class='macro'>DBL_EPSILON<span class='macro_popup'>2.2204460492503131e-16</span></span> )</td></tr>
<tr class="codeline" data-linenumber="2507"><td class="num" id="LN2507">2507</td><td class="line">            sum = 1;</td></tr>
<tr class="codeline" data-linenumber="2508"><td class="num" id="LN2508">2508</td><td class="line">        <span class='macro'>cvScale<span class='macro_popup'>cvConvertScale</span></span>( &amp;mat, &amp;mat, factor/sum, 0 );</td></tr>
<tr class="codeline" data-linenumber="2509"><td class="num" id="LN2509">2509</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2510"><td class="num" id="LN2510">2510</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2511"><td class="num" id="LN2511">2511</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2512"><td class="num" id="LN2512">2512</td><td class="line">        CvSparseMat* mat = (CvSparseMat*)hist-&gt;bins;</td></tr>
<tr class="codeline" data-linenumber="2513"><td class="num" id="LN2513">2513</td><td class="line">        CvSparseMatIterator iterator;</td></tr>
<tr class="codeline" data-linenumber="2514"><td class="num" id="LN2514">2514</td><td class="line">        CvSparseNode *node;</td></tr>
<tr class="codeline" data-linenumber="2515"><td class="num" id="LN2515">2515</td><td class="line">        <span class='keyword'>float</span> scale;</td></tr>
<tr class="codeline" data-linenumber="2516"><td class="num" id="LN2516">2516</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2517"><td class="num" id="LN2517">2517</td><td class="line">        <span class='keyword'>for</span>( node = cvInitSparseMatIterator( mat, &amp;iterator );</td></tr>
<tr class="codeline" data-linenumber="2518"><td class="num" id="LN2518">2518</td><td class="line">             node != 0; node = cvGetNextSparseNode( &amp;iterator ))</td></tr>
<tr class="codeline" data-linenumber="2519"><td class="num" id="LN2519">2519</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2520"><td class="num" id="LN2520">2520</td><td class="line">            sum += *(<span class='keyword'>float</span>*)<span class='macro'>CV_NODE_VAL(mat,node)<span class='macro_popup'>((void*)((uchar*)(node) + (mat)-&gt;valoffset))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2521"><td class="num" id="LN2521">2521</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2522"><td class="num" id="LN2522">2522</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2523"><td class="num" id="LN2523">2523</td><td class="line">        <span class='keyword'>if</span>( fabs(sum) &lt; <span class='macro'>DBL_EPSILON<span class='macro_popup'>2.2204460492503131e-16</span></span> )</td></tr>
<tr class="codeline" data-linenumber="2524"><td class="num" id="LN2524">2524</td><td class="line">            sum = 1;</td></tr>
<tr class="codeline" data-linenumber="2525"><td class="num" id="LN2525">2525</td><td class="line">        scale = (<span class='keyword'>float</span>)(factor/sum);</td></tr>
<tr class="codeline" data-linenumber="2526"><td class="num" id="LN2526">2526</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2527"><td class="num" id="LN2527">2527</td><td class="line">        <span class='keyword'>for</span>( node = cvInitSparseMatIterator( mat, &amp;iterator );</td></tr>
<tr class="codeline" data-linenumber="2528"><td class="num" id="LN2528">2528</td><td class="line">             node != 0; node = cvGetNextSparseNode( &amp;iterator ))</td></tr>
<tr class="codeline" data-linenumber="2529"><td class="num" id="LN2529">2529</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2530"><td class="num" id="LN2530">2530</td><td class="line">            *(<span class='keyword'>float</span>*)<span class='macro'>CV_NODE_VAL(mat,node)<span class='macro_popup'>((void*)((uchar*)(node) + (mat)-&gt;valoffset))</span></span> *= scale;</td></tr>
<tr class="codeline" data-linenumber="2531"><td class="num" id="LN2531">2531</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2532"><td class="num" id="LN2532">2532</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2533"><td class="num" id="LN2533">2533</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2534"><td class="num" id="LN2534">2534</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2535"><td class="num" id="LN2535">2535</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2536"><td class="num" id="LN2536">2536</td><td class="line"><span class='comment'>// Retrieves histogram global min, max and their positions</span></td></tr>
<tr class="codeline" data-linenumber="2537"><td class="num" id="LN2537">2537</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="2538"><td class="num" id="LN2538">2538</td><td class="line">cvGetMinMaxHistValue( <span class='keyword'>const</span> CvHistogram* hist,</td></tr>
<tr class="codeline" data-linenumber="2539"><td class="num" id="LN2539">2539</td><td class="line">                      <span class='keyword'>float</span> *value_min, <span class='keyword'>float</span>* value_max,</td></tr>
<tr class="codeline" data-linenumber="2540"><td class="num" id="LN2540">2540</td><td class="line">                      <span class='keyword'>int</span>* idx_min, <span class='keyword'>int</span>* idx_max )</td></tr>
<tr class="codeline" data-linenumber="2541"><td class="num" id="LN2541">2541</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2542"><td class="num" id="LN2542">2542</td><td class="line">    <span class='keyword'>double</span> minVal, maxVal;</td></tr>
<tr class="codeline" data-linenumber="2543"><td class="num" id="LN2543">2543</td><td class="line">    <span class='keyword'>int</span> dims, size[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>];</td></tr>
<tr class="codeline" data-linenumber="2544"><td class="num" id="LN2544">2544</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2545"><td class="num" id="LN2545">2545</td><td class="line">    <span class='keyword'>if</span>( !<span class='macro'>CV_IS_HIST(hist)<span class='macro_popup'>((hist) != __null &amp;&amp; (((CvHistogram*)(hist))-&gt;type<br> &amp; 0xFFFF0000) == 0x42450000 &amp;&amp; (hist)-&gt;bins !=<br> __null)</span></span> )</td></tr>
<tr class="codeline" data-linenumber="2546"><td class="num" id="LN2546">2546</td><td class="line">        <span class='macro'>CV_Error( CV_StsBadArg, <span class='string_literal'>"Invalid histogram header"</span> )<span class='macro_popup'>do { (void)(CV_StsBadArg); (void)("Invalid histogram header")<br>; abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2547"><td class="num" id="LN2547">2547</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2548"><td class="num" id="LN2548">2548</td><td class="line">    dims = cvGetDims( hist-&gt;bins, size );</td></tr>
<tr class="codeline" data-linenumber="2549"><td class="num" id="LN2549">2549</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2550"><td class="num" id="LN2550">2550</td><td class="line">    <span class='keyword'>if</span>( !<span class='macro'>CV_IS_SPARSE_HIST(hist)<span class='macro_popup'>(((hist)-&gt;bins) != __null &amp;&amp; (((const CvSparseMat*<br>)((hist)-&gt;bins))-&gt;type &amp; 0xFFFF0000) == 0x42440000)</span></span> )</td></tr>
<tr class="codeline" data-linenumber="2551"><td class="num" id="LN2551">2551</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2552"><td class="num" id="LN2552">2552</td><td class="line">        CvMat mat;</td></tr>
<tr class="codeline" data-linenumber="2553"><td class="num" id="LN2553">2553</td><td class="line">        CvPoint minPt = {0, 0}, maxPt = {0, 0};</td></tr>
<tr class="codeline" data-linenumber="2554"><td class="num" id="LN2554">2554</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2555"><td class="num" id="LN2555">2555</td><td class="line">        cvGetMat( hist-&gt;bins, &amp;mat, 0, 1 );</td></tr>
<tr class="codeline" data-linenumber="2556"><td class="num" id="LN2556">2556</td><td class="line">        cvMinMaxLoc( &amp;mat, &amp;minVal, &amp;maxVal, &amp;minPt, &amp;maxPt );</td></tr>
<tr class="codeline" data-linenumber="2557"><td class="num" id="LN2557">2557</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2558"><td class="num" id="LN2558">2558</td><td class="line">        <span class='keyword'>if</span>( dims == 1 )</td></tr>
<tr class="codeline" data-linenumber="2559"><td class="num" id="LN2559">2559</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2560"><td class="num" id="LN2560">2560</td><td class="line">            <span class='keyword'>if</span>( idx_min )</td></tr>
<tr class="codeline" data-linenumber="2561"><td class="num" id="LN2561">2561</td><td class="line">                *idx_min = minPt.y + minPt.x;</td></tr>
<tr class="codeline" data-linenumber="2562"><td class="num" id="LN2562">2562</td><td class="line">            <span class='keyword'>if</span>( idx_max )</td></tr>
<tr class="codeline" data-linenumber="2563"><td class="num" id="LN2563">2563</td><td class="line">                *idx_max = maxPt.y + maxPt.x;</td></tr>
<tr class="codeline" data-linenumber="2564"><td class="num" id="LN2564">2564</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2565"><td class="num" id="LN2565">2565</td><td class="line">        <span class='keyword'>else</span> <span class='keyword'>if</span>( dims == 2 )</td></tr>
<tr class="codeline" data-linenumber="2566"><td class="num" id="LN2566">2566</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2567"><td class="num" id="LN2567">2567</td><td class="line">            <span class='keyword'>if</span>( idx_min )</td></tr>
<tr class="codeline" data-linenumber="2568"><td class="num" id="LN2568">2568</td><td class="line">                idx_min[0] = minPt.y, idx_min[1] = minPt.x;</td></tr>
<tr class="codeline" data-linenumber="2569"><td class="num" id="LN2569">2569</td><td class="line">            <span class='keyword'>if</span>( idx_max )</td></tr>
<tr class="codeline" data-linenumber="2570"><td class="num" id="LN2570">2570</td><td class="line">                idx_max[0] = maxPt.y, idx_max[1] = maxPt.x;</td></tr>
<tr class="codeline" data-linenumber="2571"><td class="num" id="LN2571">2571</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2572"><td class="num" id="LN2572">2572</td><td class="line">        <span class='keyword'>else</span> <span class='keyword'>if</span>( idx_min || idx_max )</td></tr>
<tr class="codeline" data-linenumber="2573"><td class="num" id="LN2573">2573</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2574"><td class="num" id="LN2574">2574</td><td class="line">            <span class='keyword'>int</span> imin = minPt.y*mat.cols + minPt.x;</td></tr>
<tr class="codeline" data-linenumber="2575"><td class="num" id="LN2575">2575</td><td class="line">            <span class='keyword'>int</span> imax = maxPt.y*mat.cols + maxPt.x;</td></tr>
<tr class="codeline" data-linenumber="2576"><td class="num" id="LN2576">2576</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2577"><td class="num" id="LN2577">2577</td><td class="line">            <span class='keyword'>for</span>(<span class='keyword'>int</span> i = dims - 1; i &gt;= 0; i-- )</td></tr>
<tr class="codeline" data-linenumber="2578"><td class="num" id="LN2578">2578</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="2579"><td class="num" id="LN2579">2579</td><td class="line">                <span class='keyword'>if</span>( idx_min )</td></tr>
<tr class="codeline" data-linenumber="2580"><td class="num" id="LN2580">2580</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="2581"><td class="num" id="LN2581">2581</td><td class="line">                    <span class='keyword'>int</span> t = imin / size[i];</td></tr>
<tr class="codeline" data-linenumber="2582"><td class="num" id="LN2582">2582</td><td class="line">                    idx_min[i] = imin - t*size[i];</td></tr>
<tr class="codeline" data-linenumber="2583"><td class="num" id="LN2583">2583</td><td class="line">                    imin = t;</td></tr>
<tr class="codeline" data-linenumber="2584"><td class="num" id="LN2584">2584</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="2585"><td class="num" id="LN2585">2585</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2586"><td class="num" id="LN2586">2586</td><td class="line">                <span class='keyword'>if</span>( idx_max )</td></tr>
<tr class="codeline" data-linenumber="2587"><td class="num" id="LN2587">2587</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="2588"><td class="num" id="LN2588">2588</td><td class="line">                    <span class='keyword'>int</span> t = imax / size[i];</td></tr>
<tr class="codeline" data-linenumber="2589"><td class="num" id="LN2589">2589</td><td class="line">                    idx_max[i] = imax - t*size[i];</td></tr>
<tr class="codeline" data-linenumber="2590"><td class="num" id="LN2590">2590</td><td class="line">                    imax = t;</td></tr>
<tr class="codeline" data-linenumber="2591"><td class="num" id="LN2591">2591</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="2592"><td class="num" id="LN2592">2592</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2593"><td class="num" id="LN2593">2593</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2594"><td class="num" id="LN2594">2594</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2595"><td class="num" id="LN2595">2595</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2596"><td class="num" id="LN2596">2596</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2597"><td class="num" id="LN2597">2597</td><td class="line">        CvSparseMat* mat = (CvSparseMat*)hist-&gt;bins;</td></tr>
<tr class="codeline" data-linenumber="2598"><td class="num" id="LN2598">2598</td><td class="line">        CvSparseMatIterator iterator;</td></tr>
<tr class="codeline" data-linenumber="2599"><td class="num" id="LN2599">2599</td><td class="line">        CvSparseNode *node;</td></tr>
<tr class="codeline" data-linenumber="2600"><td class="num" id="LN2600">2600</td><td class="line">        <span class='keyword'>int</span> minv = <span class='macro'>INT_MAX<span class='macro_popup'>2147483647</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2601"><td class="num" id="LN2601">2601</td><td class="line">        <span class='keyword'>int</span> maxv = <span class='macro'>INT_MIN<span class='macro_popup'>(-2147483647 -1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2602"><td class="num" id="LN2602">2602</td><td class="line">        CvSparseNode* minNode = 0;</td></tr>
<tr class="codeline" data-linenumber="2603"><td class="num" id="LN2603">2603</td><td class="line">        CvSparseNode* maxNode = 0;</td></tr>
<tr class="codeline" data-linenumber="2604"><td class="num" id="LN2604">2604</td><td class="line">        <span class='keyword'>const</span> <span class='keyword'>int</span> *_idx_min = 0, *_idx_max = 0;</td></tr>
<tr class="codeline" data-linenumber="2605"><td class="num" id="LN2605">2605</td><td class="line">        Cv32suf m;</td></tr>
<tr class="codeline" data-linenumber="2606"><td class="num" id="LN2606">2606</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2607"><td class="num" id="LN2607">2607</td><td class="line">        <span class='keyword'>for</span>( node = cvInitSparseMatIterator( mat, &amp;iterator );</td></tr>
<tr class="codeline" data-linenumber="2608"><td class="num" id="LN2608">2608</td><td class="line">             node != 0; node = cvGetNextSparseNode( &amp;iterator ))</td></tr>
<tr class="codeline" data-linenumber="2609"><td class="num" id="LN2609">2609</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2610"><td class="num" id="LN2610">2610</td><td class="line">            <span class='keyword'>int</span> value = *(<span class='keyword'>int</span>*)<span class='macro'>CV_NODE_VAL(mat,node)<span class='macro_popup'>((void*)((uchar*)(node) + (mat)-&gt;valoffset))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2611"><td class="num" id="LN2611">2611</td><td class="line">            value = <span class='macro'>CV_TOGGLE_FLT(value)<span class='macro_popup'>((value)^((int)(value) &lt; 0 ? 0x7fffffff : 0))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2612"><td class="num" id="LN2612">2612</td><td class="line">            <span class='keyword'>if</span>( value &lt; minv )</td></tr>
<tr class="codeline" data-linenumber="2613"><td class="num" id="LN2613">2613</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="2614"><td class="num" id="LN2614">2614</td><td class="line">                minv = value;</td></tr>
<tr class="codeline" data-linenumber="2615"><td class="num" id="LN2615">2615</td><td class="line">                minNode = node;</td></tr>
<tr class="codeline" data-linenumber="2616"><td class="num" id="LN2616">2616</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2617"><td class="num" id="LN2617">2617</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2618"><td class="num" id="LN2618">2618</td><td class="line">            <span class='keyword'>if</span>( value &gt; maxv )</td></tr>
<tr class="codeline" data-linenumber="2619"><td class="num" id="LN2619">2619</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="2620"><td class="num" id="LN2620">2620</td><td class="line">                maxv = value;</td></tr>
<tr class="codeline" data-linenumber="2621"><td class="num" id="LN2621">2621</td><td class="line">                maxNode = node;</td></tr>
<tr class="codeline" data-linenumber="2622"><td class="num" id="LN2622">2622</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2623"><td class="num" id="LN2623">2623</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2624"><td class="num" id="LN2624">2624</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2625"><td class="num" id="LN2625">2625</td><td class="line">        <span class='keyword'>if</span>( minNode )</td></tr>
<tr class="codeline" data-linenumber="2626"><td class="num" id="LN2626">2626</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2627"><td class="num" id="LN2627">2627</td><td class="line">            _idx_min = <span class='macro'>CV_NODE_IDX(mat,minNode)<span class='macro_popup'>((int*)((uchar*)(minNode) + (mat)-&gt;idxoffset))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2628"><td class="num" id="LN2628">2628</td><td class="line">            _idx_max = <span class='macro'>CV_NODE_IDX(mat,maxNode)<span class='macro_popup'>((int*)((uchar*)(maxNode) + (mat)-&gt;idxoffset))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2629"><td class="num" id="LN2629">2629</td><td class="line">            m.i = <span class='macro'>CV_TOGGLE_FLT(minv)<span class='macro_popup'>((minv)^((int)(minv) &lt; 0 ? 0x7fffffff : 0))</span></span>; minVal = m.f;</td></tr>
<tr class="codeline" data-linenumber="2630"><td class="num" id="LN2630">2630</td><td class="line">            m.i = <span class='macro'>CV_TOGGLE_FLT(maxv)<span class='macro_popup'>((maxv)^((int)(maxv) &lt; 0 ? 0x7fffffff : 0))</span></span>; maxVal = m.f;</td></tr>
<tr class="codeline" data-linenumber="2631"><td class="num" id="LN2631">2631</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2632"><td class="num" id="LN2632">2632</td><td class="line">        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2633"><td class="num" id="LN2633">2633</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2634"><td class="num" id="LN2634">2634</td><td class="line">            minVal = maxVal = 0;</td></tr>
<tr class="codeline" data-linenumber="2635"><td class="num" id="LN2635">2635</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2636"><td class="num" id="LN2636">2636</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2637"><td class="num" id="LN2637">2637</td><td class="line">        <span class='keyword'>for</span>(<span class='keyword'>int</span> i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="2638"><td class="num" id="LN2638">2638</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2639"><td class="num" id="LN2639">2639</td><td class="line">            <span class='keyword'>if</span>( idx_min )</td></tr>
<tr class="codeline" data-linenumber="2640"><td class="num" id="LN2640">2640</td><td class="line">                idx_min[i] = _idx_min ? _idx_min[i] : -1;</td></tr>
<tr class="codeline" data-linenumber="2641"><td class="num" id="LN2641">2641</td><td class="line">            <span class='keyword'>if</span>( idx_max )</td></tr>
<tr class="codeline" data-linenumber="2642"><td class="num" id="LN2642">2642</td><td class="line">                idx_max[i] = _idx_max ? _idx_max[i] : -1;</td></tr>
<tr class="codeline" data-linenumber="2643"><td class="num" id="LN2643">2643</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2644"><td class="num" id="LN2644">2644</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2645"><td class="num" id="LN2645">2645</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2646"><td class="num" id="LN2646">2646</td><td class="line">    <span class='keyword'>if</span>( value_min )</td></tr>
<tr class="codeline" data-linenumber="2647"><td class="num" id="LN2647">2647</td><td class="line">        *value_min = (<span class='keyword'>float</span>)minVal;</td></tr>
<tr class="codeline" data-linenumber="2648"><td class="num" id="LN2648">2648</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2649"><td class="num" id="LN2649">2649</td><td class="line">    <span class='keyword'>if</span>( value_max )</td></tr>
<tr class="codeline" data-linenumber="2650"><td class="num" id="LN2650">2650</td><td class="line">        *value_max = (<span class='keyword'>float</span>)maxVal;</td></tr>
<tr class="codeline" data-linenumber="2651"><td class="num" id="LN2651">2651</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2652"><td class="num" id="LN2652">2652</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2653"><td class="num" id="LN2653">2653</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2654"><td class="num" id="LN2654">2654</td><td class="line"><span class='comment'>// Compares two histograms using one of a few methods</span></td></tr>
<tr class="codeline" data-linenumber="2655"><td class="num" id="LN2655">2655</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>double</span></td></tr>
<tr class="codeline" data-linenumber="2656"><td class="num" id="LN2656">2656</td><td class="line">cvCompareHist( <span class='keyword'>const</span> CvHistogram* hist1,</td></tr>
<tr class="codeline" data-linenumber="2657"><td class="num" id="LN2657">2657</td><td class="line">               <span class='keyword'>const</span> CvHistogram* hist2,</td></tr>
<tr class="codeline" data-linenumber="2658"><td class="num" id="LN2658">2658</td><td class="line">               <span class='keyword'>int</span> method )</td></tr>
<tr class="codeline" data-linenumber="2659"><td class="num" id="LN2659">2659</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2660"><td class="num" id="LN2660">2660</td><td class="line">    <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="2661"><td class="num" id="LN2661">2661</td><td class="line">    <span class='keyword'>int</span> size1[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>], size2[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>], total = 1;</td></tr>
<tr class="codeline" data-linenumber="2662"><td class="num" id="LN2662">2662</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2663"><td class="num" id="LN2663">2663</td><td class="line">    <span class='keyword'>if</span>( !<span class='macro'>CV_IS_HIST(hist1)<span class='macro_popup'>((hist1) != __null &amp;&amp; (((CvHistogram*)(hist1))-&gt;type<br> &amp; 0xFFFF0000) == 0x42450000 &amp;&amp; (hist1)-&gt;bins !=<br> __null)</span></span> || !<span class='macro'>CV_IS_HIST(hist2)<span class='macro_popup'>((hist2) != __null &amp;&amp; (((CvHistogram*)(hist2))-&gt;type<br> &amp; 0xFFFF0000) == 0x42450000 &amp;&amp; (hist2)-&gt;bins !=<br> __null)</span></span> )</td></tr>
<tr class="codeline" data-linenumber="2664"><td class="num" id="LN2664">2664</td><td class="line">        <span class='macro'>CV_Error( CV_StsBadArg, <span class='string_literal'>"Invalid histogram header[s]"</span> )<span class='macro_popup'>do { (void)(CV_StsBadArg); (void)("Invalid histogram header[s]"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2665"><td class="num" id="LN2665">2665</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2666"><td class="num" id="LN2666">2666</td><td class="line">    <span class='keyword'>if</span>( <span class='macro'>CV_IS_SPARSE_MAT(hist1-&gt;bins)<span class='macro_popup'>((hist1-&gt;bins) != __null &amp;&amp; (((const CvSparseMat*)<br>(hist1-&gt;bins))-&gt;type &amp; 0xFFFF0000) == 0x42440000)</span></span> != <span class='macro'>CV_IS_SPARSE_MAT(hist2-&gt;bins)<span class='macro_popup'>((hist2-&gt;bins) != __null &amp;&amp; (((const CvSparseMat*)<br>(hist2-&gt;bins))-&gt;type &amp; 0xFFFF0000) == 0x42440000)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2667"><td class="num" id="LN2667">2667</td><td class="line">        <span class='macro'>CV_Error(CV_StsUnmatchedFormats, <span class='string_literal'>"One of histograms is sparse and other is not"</span>)<span class='macro_popup'>do { (void)(CV_StsUnmatchedFormats); (void)("One of histograms is sparse and other is not"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2668"><td class="num" id="LN2668">2668</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2669"><td class="num" id="LN2669">2669</td><td class="line">    <span class='keyword'>if</span>( !<span class='macro'>CV_IS_SPARSE_MAT(hist1-&gt;bins)<span class='macro_popup'>((hist1-&gt;bins) != __null &amp;&amp; (((const CvSparseMat*)<br>(hist1-&gt;bins))-&gt;type &amp; 0xFFFF0000) == 0x42440000)</span></span> )</td></tr>
<tr class="codeline" data-linenumber="2670"><td class="num" id="LN2670">2670</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2671"><td class="num" id="LN2671">2671</td><td class="line">        cv::Mat H1 = cv::cvarrToMat(hist1-&gt;bins);</td></tr>
<tr class="codeline" data-linenumber="2672"><td class="num" id="LN2672">2672</td><td class="line">        cv::Mat H2 = cv::cvarrToMat(hist2-&gt;bins);</td></tr>
<tr class="codeline" data-linenumber="2673"><td class="num" id="LN2673">2673</td><td class="line">        <span class='keyword'>return</span> cv::compareHist(H1, H2, method);</td></tr>
<tr class="codeline" data-linenumber="2674"><td class="num" id="LN2674">2674</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2675"><td class="num" id="LN2675">2675</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2676"><td class="num" id="LN2676">2676</td><td class="line">    <span class='keyword'>int</span> dims1 = cvGetDims( hist1-&gt;bins, size1 );</td></tr>
<tr class="codeline" data-linenumber="2677"><td class="num" id="LN2677">2677</td><td class="line">    <span class='keyword'>int</span> dims2 = cvGetDims( hist2-&gt;bins, size2 );</td></tr>
<tr class="codeline" data-linenumber="2678"><td class="num" id="LN2678">2678</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2679"><td class="num" id="LN2679">2679</td><td class="line">    <span class='keyword'>if</span>( dims1 != dims2 )</td></tr>
<tr class="codeline" data-linenumber="2680"><td class="num" id="LN2680">2680</td><td class="line">        <span class='macro'>CV_Error( CV_StsUnmatchedSizes,<span class='macro_popup'>do { (void)(CV_StsUnmatchedSizes); (void)("The histograms have different numbers of dimensions"<br>); abort(); } while (0)</span></span></td></tr>
<tr class="codeline" data-linenumber="2681"><td class="num" id="LN2681">2681</td><td class="line">                 <span class='string_literal'><span class='macro'>"The histograms have different numbers of dimensions"</span> )<span class='macro_popup'>do { (void)(CV_StsUnmatchedSizes); (void)("The histograms have different numbers of dimensions"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2682"><td class="num" id="LN2682">2682</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2683"><td class="num" id="LN2683">2683</td><td class="line">    <span class='keyword'>for</span>( i = 0; i &lt; dims1; i++ )</td></tr>
<tr class="codeline" data-linenumber="2684"><td class="num" id="LN2684">2684</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2685"><td class="num" id="LN2685">2685</td><td class="line">        <span class='keyword'>if</span>( size1[i] != size2[i] )</td></tr>
<tr class="codeline" data-linenumber="2686"><td class="num" id="LN2686">2686</td><td class="line">            <span class='macro'>CV_Error( CV_StsUnmatchedSizes, <span class='string_literal'>"The histograms have different sizes"</span> )<span class='macro_popup'>do { (void)(CV_StsUnmatchedSizes); (void)("The histograms have different sizes"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2687"><td class="num" id="LN2687">2687</td><td class="line">        total *= size1[i];</td></tr>
<tr class="codeline" data-linenumber="2688"><td class="num" id="LN2688">2688</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2689"><td class="num" id="LN2689">2689</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2690"><td class="num" id="LN2690">2690</td><td class="line">    <span class='keyword'>double</span> result = 0;</td></tr>
<tr class="codeline" data-linenumber="2691"><td class="num" id="LN2691">2691</td><td class="line">    CvSparseMat* mat1 = (CvSparseMat*)(hist1-&gt;bins);</td></tr>
<tr class="codeline" data-linenumber="2692"><td class="num" id="LN2692">2692</td><td class="line">    CvSparseMat* mat2 = (CvSparseMat*)(hist2-&gt;bins);</td></tr>
<tr class="codeline" data-linenumber="2693"><td class="num" id="LN2693">2693</td><td class="line">    CvSparseMatIterator iterator;</td></tr>
<tr class="codeline" data-linenumber="2694"><td class="num" id="LN2694">2694</td><td class="line">    CvSparseNode *node1, *node2;</td></tr>
<tr class="codeline" data-linenumber="2695"><td class="num" id="LN2695">2695</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2696"><td class="num" id="LN2696">2696</td><td class="line">    <span class='keyword'>if</span>( mat1-&gt;heap-&gt;active_count &gt; mat2-&gt;heap-&gt;active_count &amp;&amp; method != CV_COMP_CHISQR &amp;&amp; method != CV_COMP_CHISQR_ALT &amp;&amp; method != CV_COMP_KL_DIV )</td></tr>
<tr class="codeline" data-linenumber="2697"><td class="num" id="LN2697">2697</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2698"><td class="num" id="LN2698">2698</td><td class="line">        CvSparseMat* t;</td></tr>
<tr class="codeline" data-linenumber="2699"><td class="num" id="LN2699">2699</td><td class="line">        <span class='macro'>CV_SWAP( mat1, mat2, t )<span class='macro_popup'>((t) = (mat1), (mat1) = (mat2), (mat2) = (t))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2700"><td class="num" id="LN2700">2700</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2701"><td class="num" id="LN2701">2701</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2702"><td class="num" id="LN2702">2702</td><td class="line">    <span class='keyword'>if</span>( (method == CV_COMP_CHISQR) || (method == CV_COMP_CHISQR_ALT) )</td></tr>
<tr class="codeline" data-linenumber="2703"><td class="num" id="LN2703">2703</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2704"><td class="num" id="LN2704">2704</td><td class="line">        <span class='keyword'>for</span>( node1 = cvInitSparseMatIterator( mat1, &amp;iterator );</td></tr>
<tr class="codeline" data-linenumber="2705"><td class="num" id="LN2705">2705</td><td class="line">             node1 != 0; node1 = cvGetNextSparseNode( &amp;iterator ))</td></tr>
<tr class="codeline" data-linenumber="2706"><td class="num" id="LN2706">2706</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2707"><td class="num" id="LN2707">2707</td><td class="line">            <span class='keyword'>double</span> v1 = *(<span class='keyword'>float</span>*)<span class='macro'>CV_NODE_VAL(mat1,node1)<span class='macro_popup'>((void*)((uchar*)(node1) + (mat1)-&gt;valoffset))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2708"><td class="num" id="LN2708">2708</td><td class="line">            uchar* node2_data = cvPtrND( mat2, <span class='macro'>CV_NODE_IDX(mat1,node1)<span class='macro_popup'>((int*)((uchar*)(node1) + (mat1)-&gt;idxoffset))</span></span>, 0, 0, &amp;node1-&gt;hashval );</td></tr>
<tr class="codeline" data-linenumber="2709"><td class="num" id="LN2709">2709</td><td class="line">            <span class='keyword'>double</span> v2 = node2_data ? *(<span class='keyword'>float</span>*)node2_data : 0.f;</td></tr>
<tr class="codeline" data-linenumber="2710"><td class="num" id="LN2710">2710</td><td class="line">            <span class='keyword'>double</span> a = v1 - v2;</td></tr>
<tr class="codeline" data-linenumber="2711"><td class="num" id="LN2711">2711</td><td class="line">            <span class='keyword'>double</span> b = (method == CV_COMP_CHISQR) ? v1 : v1 + v2;</td></tr>
<tr class="codeline" data-linenumber="2712"><td class="num" id="LN2712">2712</td><td class="line">            <span class='keyword'>if</span>( fabs(b) &gt; <span class='macro'>DBL_EPSILON<span class='macro_popup'>2.2204460492503131e-16</span></span> )</td></tr>
<tr class="codeline" data-linenumber="2713"><td class="num" id="LN2713">2713</td><td class="line">                result += a*a/b;</td></tr>
<tr class="codeline" data-linenumber="2714"><td class="num" id="LN2714">2714</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2715"><td class="num" id="LN2715">2715</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2716"><td class="num" id="LN2716">2716</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span>( method == CV_COMP_CORREL )</td></tr>
<tr class="codeline" data-linenumber="2717"><td class="num" id="LN2717">2717</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2718"><td class="num" id="LN2718">2718</td><td class="line">        <span class='keyword'>double</span> s1 = 0, s11 = 0;</td></tr>
<tr class="codeline" data-linenumber="2719"><td class="num" id="LN2719">2719</td><td class="line">        <span class='keyword'>double</span> s2 = 0, s22 = 0;</td></tr>
<tr class="codeline" data-linenumber="2720"><td class="num" id="LN2720">2720</td><td class="line">        <span class='keyword'>double</span> s12 = 0;</td></tr>
<tr class="codeline" data-linenumber="2721"><td class="num" id="LN2721">2721</td><td class="line">        <span class='keyword'>double</span> num, denom2, scale = 1./total;</td></tr>
<tr class="codeline" data-linenumber="2722"><td class="num" id="LN2722">2722</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2723"><td class="num" id="LN2723">2723</td><td class="line">        <span class='keyword'>for</span>( node1 = cvInitSparseMatIterator( mat1, &amp;iterator );</td></tr>
<tr class="codeline" data-linenumber="2724"><td class="num" id="LN2724">2724</td><td class="line">             node1 != 0; node1 = cvGetNextSparseNode( &amp;iterator ))</td></tr>
<tr class="codeline" data-linenumber="2725"><td class="num" id="LN2725">2725</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2726"><td class="num" id="LN2726">2726</td><td class="line">            <span class='keyword'>double</span> v1 = *(<span class='keyword'>float</span>*)<span class='macro'>CV_NODE_VAL(mat1,node1)<span class='macro_popup'>((void*)((uchar*)(node1) + (mat1)-&gt;valoffset))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2727"><td class="num" id="LN2727">2727</td><td class="line">            uchar* node2_data = cvPtrND( mat2, <span class='macro'>CV_NODE_IDX(mat1,node1)<span class='macro_popup'>((int*)((uchar*)(node1) + (mat1)-&gt;idxoffset))</span></span>,</td></tr>
<tr class="codeline" data-linenumber="2728"><td class="num" id="LN2728">2728</td><td class="line">                                        0, 0, &amp;node1-&gt;hashval );</td></tr>
<tr class="codeline" data-linenumber="2729"><td class="num" id="LN2729">2729</td><td class="line">            <span class='keyword'>if</span>( node2_data )</td></tr>
<tr class="codeline" data-linenumber="2730"><td class="num" id="LN2730">2730</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="2731"><td class="num" id="LN2731">2731</td><td class="line">                <span class='keyword'>double</span> v2 = *(<span class='keyword'>float</span>*)node2_data;</td></tr>
<tr class="codeline" data-linenumber="2732"><td class="num" id="LN2732">2732</td><td class="line">                s12 += v1*v2;</td></tr>
<tr class="codeline" data-linenumber="2733"><td class="num" id="LN2733">2733</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2734"><td class="num" id="LN2734">2734</td><td class="line">            s1 += v1;</td></tr>
<tr class="codeline" data-linenumber="2735"><td class="num" id="LN2735">2735</td><td class="line">            s11 += v1*v1;</td></tr>
<tr class="codeline" data-linenumber="2736"><td class="num" id="LN2736">2736</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2737"><td class="num" id="LN2737">2737</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2738"><td class="num" id="LN2738">2738</td><td class="line">        <span class='keyword'>for</span>( node2 = cvInitSparseMatIterator( mat2, &amp;iterator );</td></tr>
<tr class="codeline" data-linenumber="2739"><td class="num" id="LN2739">2739</td><td class="line">             node2 != 0; node2 = cvGetNextSparseNode( &amp;iterator ))</td></tr>
<tr class="codeline" data-linenumber="2740"><td class="num" id="LN2740">2740</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2741"><td class="num" id="LN2741">2741</td><td class="line">            <span class='keyword'>double</span> v2 = *(<span class='keyword'>float</span>*)<span class='macro'>CV_NODE_VAL(mat2,node2)<span class='macro_popup'>((void*)((uchar*)(node2) + (mat2)-&gt;valoffset))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2742"><td class="num" id="LN2742">2742</td><td class="line">            s2 += v2;</td></tr>
<tr class="codeline" data-linenumber="2743"><td class="num" id="LN2743">2743</td><td class="line">            s22 += v2*v2;</td></tr>
<tr class="codeline" data-linenumber="2744"><td class="num" id="LN2744">2744</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2745"><td class="num" id="LN2745">2745</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2746"><td class="num" id="LN2746">2746</td><td class="line">        num = s12 - s1*s2*scale;</td></tr>
<tr class="codeline" data-linenumber="2747"><td class="num" id="LN2747">2747</td><td class="line">        denom2 = (s11 - s1*s1*scale)*(s22 - s2*s2*scale);</td></tr>
<tr class="codeline" data-linenumber="2748"><td class="num" id="LN2748">2748</td><td class="line">        result = fabs(denom2) &gt; <span class='macro'>DBL_EPSILON<span class='macro_popup'>2.2204460492503131e-16</span></span> ? num/sqrt(denom2) : 1;</td></tr>
<tr class="codeline" data-linenumber="2749"><td class="num" id="LN2749">2749</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2750"><td class="num" id="LN2750">2750</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span>( method == CV_COMP_INTERSECT )</td></tr>
<tr class="codeline" data-linenumber="2751"><td class="num" id="LN2751">2751</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2752"><td class="num" id="LN2752">2752</td><td class="line">        <span class='keyword'>for</span>( node1 = cvInitSparseMatIterator( mat1, &amp;iterator );</td></tr>
<tr class="codeline" data-linenumber="2753"><td class="num" id="LN2753">2753</td><td class="line">             node1 != 0; node1 = cvGetNextSparseNode( &amp;iterator ))</td></tr>
<tr class="codeline" data-linenumber="2754"><td class="num" id="LN2754">2754</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2755"><td class="num" id="LN2755">2755</td><td class="line">            <span class='keyword'>float</span> v1 = *(<span class='keyword'>float</span>*)<span class='macro'>CV_NODE_VAL(mat1,node1)<span class='macro_popup'>((void*)((uchar*)(node1) + (mat1)-&gt;valoffset))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2756"><td class="num" id="LN2756">2756</td><td class="line">            uchar* node2_data = cvPtrND( mat2, <span class='macro'>CV_NODE_IDX(mat1,node1)<span class='macro_popup'>((int*)((uchar*)(node1) + (mat1)-&gt;idxoffset))</span></span>,</td></tr>
<tr class="codeline" data-linenumber="2757"><td class="num" id="LN2757">2757</td><td class="line">                                         0, 0, &amp;node1-&gt;hashval );</td></tr>
<tr class="codeline" data-linenumber="2758"><td class="num" id="LN2758">2758</td><td class="line">            <span class='keyword'>if</span>( node2_data )</td></tr>
<tr class="codeline" data-linenumber="2759"><td class="num" id="LN2759">2759</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="2760"><td class="num" id="LN2760">2760</td><td class="line">                <span class='keyword'>float</span> v2 = *(<span class='keyword'>float</span>*)node2_data;</td></tr>
<tr class="codeline" data-linenumber="2761"><td class="num" id="LN2761">2761</td><td class="line">                <span class='keyword'>if</span>( v1 &lt;= v2 )</td></tr>
<tr class="codeline" data-linenumber="2762"><td class="num" id="LN2762">2762</td><td class="line">                    result += v1;</td></tr>
<tr class="codeline" data-linenumber="2763"><td class="num" id="LN2763">2763</td><td class="line">                <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2764"><td class="num" id="LN2764">2764</td><td class="line">                    result += v2;</td></tr>
<tr class="codeline" data-linenumber="2765"><td class="num" id="LN2765">2765</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2766"><td class="num" id="LN2766">2766</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2767"><td class="num" id="LN2767">2767</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2768"><td class="num" id="LN2768">2768</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span>( method == CV_COMP_BHATTACHARYYA )</td></tr>
<tr class="codeline" data-linenumber="2769"><td class="num" id="LN2769">2769</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2770"><td class="num" id="LN2770">2770</td><td class="line">        <span class='keyword'>double</span> s1 = 0, s2 = 0;</td></tr>
<tr class="codeline" data-linenumber="2771"><td class="num" id="LN2771">2771</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2772"><td class="num" id="LN2772">2772</td><td class="line">        <span class='keyword'>for</span>( node1 = cvInitSparseMatIterator( mat1, &amp;iterator );</td></tr>
<tr class="codeline" data-linenumber="2773"><td class="num" id="LN2773">2773</td><td class="line">             node1 != 0; node1 = cvGetNextSparseNode( &amp;iterator ))</td></tr>
<tr class="codeline" data-linenumber="2774"><td class="num" id="LN2774">2774</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2775"><td class="num" id="LN2775">2775</td><td class="line">            <span class='keyword'>double</span> v1 = *(<span class='keyword'>float</span>*)<span class='macro'>CV_NODE_VAL(mat1,node1)<span class='macro_popup'>((void*)((uchar*)(node1) + (mat1)-&gt;valoffset))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2776"><td class="num" id="LN2776">2776</td><td class="line">            uchar* node2_data = cvPtrND( mat2, <span class='macro'>CV_NODE_IDX(mat1,node1)<span class='macro_popup'>((int*)((uchar*)(node1) + (mat1)-&gt;idxoffset))</span></span>,</td></tr>
<tr class="codeline" data-linenumber="2777"><td class="num" id="LN2777">2777</td><td class="line">                                         0, 0, &amp;node1-&gt;hashval );</td></tr>
<tr class="codeline" data-linenumber="2778"><td class="num" id="LN2778">2778</td><td class="line">            s1 += v1;</td></tr>
<tr class="codeline" data-linenumber="2779"><td class="num" id="LN2779">2779</td><td class="line">            <span class='keyword'>if</span>( node2_data )</td></tr>
<tr class="codeline" data-linenumber="2780"><td class="num" id="LN2780">2780</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="2781"><td class="num" id="LN2781">2781</td><td class="line">                <span class='keyword'>double</span> v2 = *(<span class='keyword'>float</span>*)node2_data;</td></tr>
<tr class="codeline" data-linenumber="2782"><td class="num" id="LN2782">2782</td><td class="line">                result += sqrt(v1 * v2);</td></tr>
<tr class="codeline" data-linenumber="2783"><td class="num" id="LN2783">2783</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2784"><td class="num" id="LN2784">2784</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2785"><td class="num" id="LN2785">2785</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2786"><td class="num" id="LN2786">2786</td><td class="line">        <span class='keyword'>for</span>( node1 = cvInitSparseMatIterator( mat2, &amp;iterator );</td></tr>
<tr class="codeline" data-linenumber="2787"><td class="num" id="LN2787">2787</td><td class="line">             node1 != 0; node1 = cvGetNextSparseNode( &amp;iterator ))</td></tr>
<tr class="codeline" data-linenumber="2788"><td class="num" id="LN2788">2788</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2789"><td class="num" id="LN2789">2789</td><td class="line">            <span class='keyword'>double</span> v2 = *(<span class='keyword'>float</span>*)<span class='macro'>CV_NODE_VAL(mat2,node1)<span class='macro_popup'>((void*)((uchar*)(node1) + (mat2)-&gt;valoffset))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2790"><td class="num" id="LN2790">2790</td><td class="line">            s2 += v2;</td></tr>
<tr class="codeline" data-linenumber="2791"><td class="num" id="LN2791">2791</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2792"><td class="num" id="LN2792">2792</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2793"><td class="num" id="LN2793">2793</td><td class="line">        s1 *= s2;</td></tr>
<tr class="codeline" data-linenumber="2794"><td class="num" id="LN2794">2794</td><td class="line">        s1 = fabs(s1) &gt; <span class='macro'>FLT_EPSILON<span class='macro_popup'>1.19209290e-7F</span></span> ? 1./sqrt(s1) : 1.;</td></tr>
<tr class="codeline" data-linenumber="2795"><td class="num" id="LN2795">2795</td><td class="line">        result = 1. - result*s1;</td></tr>
<tr class="codeline" data-linenumber="2796"><td class="num" id="LN2796">2796</td><td class="line">        result = sqrt(<span class='macro'>MAX(result,0.)<span class='macro_popup'>((result) &lt; (0.) ? (0.) : (result))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2797"><td class="num" id="LN2797">2797</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2798"><td class="num" id="LN2798">2798</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span>( method == CV_COMP_KL_DIV )</td></tr>
<tr class="codeline" data-linenumber="2799"><td class="num" id="LN2799">2799</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2800"><td class="num" id="LN2800">2800</td><td class="line">        cv::SparseMat sH1, sH2;</td></tr>
<tr class="codeline" data-linenumber="2801"><td class="num" id="LN2801">2801</td><td class="line">        ((<span class='keyword'>const</span> CvSparseMat*)hist1-&gt;bins)-&gt;copyToSparseMat(sH1);</td></tr>
<tr class="codeline" data-linenumber="2802"><td class="num" id="LN2802">2802</td><td class="line">        ((<span class='keyword'>const</span> CvSparseMat*)hist2-&gt;bins)-&gt;copyToSparseMat(sH2);</td></tr>
<tr class="codeline" data-linenumber="2803"><td class="num" id="LN2803">2803</td><td class="line">        result = cv::compareHist( sH1, sH2, CV_COMP_KL_DIV );</td></tr>
<tr class="codeline" data-linenumber="2804"><td class="num" id="LN2804">2804</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2805"><td class="num" id="LN2805">2805</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2806"><td class="num" id="LN2806">2806</td><td class="line">        <span class='macro'>CV_Error( CV_StsBadArg, <span class='string_literal'>"Unknown comparison method"</span> )<span class='macro_popup'>do { (void)(CV_StsBadArg); (void)("Unknown comparison method"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2807"><td class="num" id="LN2807">2807</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2808"><td class="num" id="LN2808">2808</td><td class="line">    <span class='keyword'>if</span>( method == CV_COMP_CHISQR_ALT )</td></tr>
<tr class="codeline" data-linenumber="2809"><td class="num" id="LN2809">2809</td><td class="line">        result *= 2;</td></tr>
<tr class="codeline" data-linenumber="2810"><td class="num" id="LN2810">2810</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2811"><td class="num" id="LN2811">2811</td><td class="line">    <span class='keyword'>return</span> result;</td></tr>
<tr class="codeline" data-linenumber="2812"><td class="num" id="LN2812">2812</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2813"><td class="num" id="LN2813">2813</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2814"><td class="num" id="LN2814">2814</td><td class="line"><span class='comment'>// copies one histogram to another</span></td></tr>
<tr class="codeline" data-linenumber="2815"><td class="num" id="LN2815">2815</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="2816"><td class="num" id="LN2816">2816</td><td class="line">cvCopyHist( <span class='keyword'>const</span> CvHistogram* src, CvHistogram** _dst )</td></tr>
<tr class="codeline" data-linenumber="2817"><td class="num" id="LN2817">2817</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2818"><td class="num" id="LN2818">2818</td><td class="line">    <span class='keyword'>if</span>( !_dst )</td></tr>
<tr class="codeline" data-linenumber="2819"><td class="num" id="LN2819">2819</td><td class="line">        <span class='macro'>CV_Error( CV_StsNullPtr, <span class='string_literal'>"Destination double pointer is NULL"</span> )<span class='macro_popup'>do { (void)(CV_StsNullPtr); (void)("Destination double pointer is NULL"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2820"><td class="num" id="LN2820">2820</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2821"><td class="num" id="LN2821">2821</td><td class="line">    CvHistogram* dst = *_dst;</td></tr>
<tr class="codeline" data-linenumber="2822"><td class="num" id="LN2822">2822</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2823"><td class="num" id="LN2823">2823</td><td class="line">    <span class='keyword'>if</span>( !<span class='macro'>CV_IS_HIST(src)<span class='macro_popup'>((src) != __null &amp;&amp; (((CvHistogram*)(src))-&gt;type &amp;<br> 0xFFFF0000) == 0x42450000 &amp;&amp; (src)-&gt;bins != __null<br>)</span></span> || (dst &amp;&amp; !<span class='macro'>CV_IS_HIST(dst)<span class='macro_popup'>((dst) != __null &amp;&amp; (((CvHistogram*)(dst))-&gt;type &amp;<br> 0xFFFF0000) == 0x42450000 &amp;&amp; (dst)-&gt;bins != __null<br>)</span></span>) )</td></tr>
<tr class="codeline" data-linenumber="2824"><td class="num" id="LN2824">2824</td><td class="line">        <span class='macro'>CV_Error( CV_StsBadArg, <span class='string_literal'>"Invalid histogram header[s]"</span> )<span class='macro_popup'>do { (void)(CV_StsBadArg); (void)("Invalid histogram header[s]"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2825"><td class="num" id="LN2825">2825</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2826"><td class="num" id="LN2826">2826</td><td class="line">    <span class='keyword'>bool</span> eq = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="2827"><td class="num" id="LN2827">2827</td><td class="line">    <span class='keyword'>int</span> size1[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>];</td></tr>
<tr class="codeline" data-linenumber="2828"><td class="num" id="LN2828">2828</td><td class="line">    <span class='keyword'>bool</span> is_sparse = <span class='macro'>CV_IS_SPARSE_MAT(src-&gt;bins)<span class='macro_popup'>((src-&gt;bins) != __null &amp;&amp; (((const CvSparseMat*)(src<br>-&gt;bins))-&gt;type &amp; 0xFFFF0000) == 0x42440000)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2829"><td class="num" id="LN2829">2829</td><td class="line">    <span class='keyword'>int</span> dims1 = cvGetDims( src-&gt;bins, size1 );</td></tr>
<tr class="codeline" data-linenumber="2830"><td class="num" id="LN2830">2830</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2831"><td class="num" id="LN2831">2831</td><td class="line">    <span class='keyword'>if</span>( dst &amp;&amp; (is_sparse == <span class='macro'>CV_IS_SPARSE_MAT(dst-&gt;bins)<span class='macro_popup'>((dst-&gt;bins) != __null &amp;&amp; (((const CvSparseMat*)(dst<br>-&gt;bins))-&gt;type &amp; 0xFFFF0000) == 0x42440000)</span></span>))</td></tr>
<tr class="codeline" data-linenumber="2832"><td class="num" id="LN2832">2832</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2833"><td class="num" id="LN2833">2833</td><td class="line">        <span class='keyword'>int</span> size2[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>];</td></tr>
<tr class="codeline" data-linenumber="2834"><td class="num" id="LN2834">2834</td><td class="line">        <span class='keyword'>int</span> dims2 = cvGetDims( dst-&gt;bins, size2 );</td></tr>
<tr class="codeline" data-linenumber="2835"><td class="num" id="LN2835">2835</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2836"><td class="num" id="LN2836">2836</td><td class="line">        <span class='keyword'>if</span>( dims1 == dims2 )</td></tr>
<tr class="codeline" data-linenumber="2837"><td class="num" id="LN2837">2837</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2838"><td class="num" id="LN2838">2838</td><td class="line">            <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="2839"><td class="num" id="LN2839">2839</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2840"><td class="num" id="LN2840">2840</td><td class="line">            <span class='keyword'>for</span>( i = 0; i &lt; dims1; i++ )</td></tr>
<tr class="codeline" data-linenumber="2841"><td class="num" id="LN2841">2841</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="2842"><td class="num" id="LN2842">2842</td><td class="line">                <span class='keyword'>if</span>( size1[i] != size2[i] )</td></tr>
<tr class="codeline" data-linenumber="2843"><td class="num" id="LN2843">2843</td><td class="line">                    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="2844"><td class="num" id="LN2844">2844</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2845"><td class="num" id="LN2845">2845</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2846"><td class="num" id="LN2846">2846</td><td class="line">            eq = (i == dims1);</td></tr>
<tr class="codeline" data-linenumber="2847"><td class="num" id="LN2847">2847</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2848"><td class="num" id="LN2848">2848</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2849"><td class="num" id="LN2849">2849</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2850"><td class="num" id="LN2850">2850</td><td class="line">    <span class='keyword'>if</span>( !eq )</td></tr>
<tr class="codeline" data-linenumber="2851"><td class="num" id="LN2851">2851</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2852"><td class="num" id="LN2852">2852</td><td class="line">        cvReleaseHist( _dst );</td></tr>
<tr class="codeline" data-linenumber="2853"><td class="num" id="LN2853">2853</td><td class="line">        dst = cvCreateHist( dims1, size1, !is_sparse ? <span class='macro'>CV_HIST_ARRAY<span class='macro_popup'>0</span></span> : <span class='macro'>CV_HIST_SPARSE<span class='macro_popup'>1</span></span>, 0, 0 );</td></tr>
<tr class="codeline" data-linenumber="2854"><td class="num" id="LN2854">2854</td><td class="line">        *_dst = dst;</td></tr>
<tr class="codeline" data-linenumber="2855"><td class="num" id="LN2855">2855</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2856"><td class="num" id="LN2856">2856</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2857"><td class="num" id="LN2857">2857</td><td class="line">    <span class='keyword'>if</span>( <span class='macro'>CV_HIST_HAS_RANGES( src )<span class='macro_popup'>(((src)-&gt;type &amp; (1 &lt;&lt; 11)) != 0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2858"><td class="num" id="LN2858">2858</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2859"><td class="num" id="LN2859">2859</td><td class="line">        <span class='keyword'>float</span>* ranges[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>];</td></tr>
<tr class="codeline" data-linenumber="2860"><td class="num" id="LN2860">2860</td><td class="line">        <span class='keyword'>float</span>** thresh = 0;</td></tr>
<tr class="codeline" data-linenumber="2861"><td class="num" id="LN2861">2861</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2862"><td class="num" id="LN2862">2862</td><td class="line">        <span class='keyword'>if</span>( <span class='macro'>CV_IS_UNIFORM_HIST( src )<span class='macro_popup'>(((src)-&gt;type &amp; (1 &lt;&lt; 10)) != 0)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2863"><td class="num" id="LN2863">2863</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2864"><td class="num" id="LN2864">2864</td><td class="line">            <span class='keyword'>for</span>( <span class='keyword'>int</span> i = 0; i &lt; dims1; i++ )</td></tr>
<tr class="codeline" data-linenumber="2865"><td class="num" id="LN2865">2865</td><td class="line">                ranges[i] = (<span class='keyword'>float</span>*)src-&gt;thresh[i];</td></tr>
<tr class="codeline" data-linenumber="2866"><td class="num" id="LN2866">2866</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2867"><td class="num" id="LN2867">2867</td><td class="line">            thresh = ranges;</td></tr>
<tr class="codeline" data-linenumber="2868"><td class="num" id="LN2868">2868</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2869"><td class="num" id="LN2869">2869</td><td class="line">        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2870"><td class="num" id="LN2870">2870</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2871"><td class="num" id="LN2871">2871</td><td class="line">            thresh = src-&gt;thresh2;</td></tr>
<tr class="codeline" data-linenumber="2872"><td class="num" id="LN2872">2872</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2873"><td class="num" id="LN2873">2873</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2874"><td class="num" id="LN2874">2874</td><td class="line">        cvSetHistBinRanges( dst, thresh, <span class='macro'>CV_IS_UNIFORM_HIST(src)<span class='macro_popup'>(((src)-&gt;type &amp; (1 &lt;&lt; 10)) != 0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2875"><td class="num" id="LN2875">2875</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2876"><td class="num" id="LN2876">2876</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2877"><td class="num" id="LN2877">2877</td><td class="line">    cvCopy( src-&gt;bins, dst-&gt;bins );</td></tr>
<tr class="codeline" data-linenumber="2878"><td class="num" id="LN2878">2878</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2879"><td class="num" id="LN2879">2879</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2880"><td class="num" id="LN2880">2880</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2881"><td class="num" id="LN2881">2881</td><td class="line"><span class='comment'>// Sets a value range for every histogram bin</span></td></tr>
<tr class="codeline" data-linenumber="2882"><td class="num" id="LN2882">2882</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="2883"><td class="num" id="LN2883">2883</td><td class="line">cvSetHistBinRanges( CvHistogram* hist, <span class='keyword'>float</span>** ranges, <span class='keyword'>int</span> uniform )</td></tr>
<tr class="codeline" data-linenumber="2884"><td class="num" id="LN2884">2884</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2885"><td class="num" id="LN2885">2885</td><td class="line">    <span class='keyword'>int</span> dims, size[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>], total = 0;</td></tr>
<tr class="codeline" data-linenumber="2886"><td class="num" id="LN2886">2886</td><td class="line">    <span class='keyword'>int</span> i, j;</td></tr>
<tr class="codeline" data-linenumber="2887"><td class="num" id="LN2887">2887</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2888"><td class="num" id="LN2888">2888</td><td class="line">    <span class='keyword'>if</span>( !ranges )</td></tr>
<tr class="codeline" data-linenumber="2889"><td class="num" id="LN2889">2889</td><td class="line">        <span class='macro'>CV_Error( CV_StsNullPtr, <span class='string_literal'>"NULL ranges pointer"</span> )<span class='macro_popup'>do { (void)(CV_StsNullPtr); (void)("NULL ranges pointer"); abort<br>(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2890"><td class="num" id="LN2890">2890</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2891"><td class="num" id="LN2891">2891</td><td class="line">    <span class='keyword'>if</span>( !<span class='macro'>CV_IS_HIST(hist)<span class='macro_popup'>((hist) != __null &amp;&amp; (((CvHistogram*)(hist))-&gt;type<br> &amp; 0xFFFF0000) == 0x42450000 &amp;&amp; (hist)-&gt;bins !=<br> __null)</span></span> )</td></tr>
<tr class="codeline" data-linenumber="2892"><td class="num" id="LN2892">2892</td><td class="line">        <span class='macro'>CV_Error( CV_StsBadArg, <span class='string_literal'>"Invalid histogram header"</span> )<span class='macro_popup'>do { (void)(CV_StsBadArg); (void)("Invalid histogram header")<br>; abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2893"><td class="num" id="LN2893">2893</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2894"><td class="num" id="LN2894">2894</td><td class="line">    dims = cvGetDims( hist-&gt;bins, size );</td></tr>
<tr class="codeline" data-linenumber="2895"><td class="num" id="LN2895">2895</td><td class="line">    <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="2896"><td class="num" id="LN2896">2896</td><td class="line">        total += size[i]+1;</td></tr>
<tr class="codeline" data-linenumber="2897"><td class="num" id="LN2897">2897</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2898"><td class="num" id="LN2898">2898</td><td class="line">    <span class='keyword'>if</span>( uniform )</td></tr>
<tr class="codeline" data-linenumber="2899"><td class="num" id="LN2899">2899</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2900"><td class="num" id="LN2900">2900</td><td class="line">        <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="2901"><td class="num" id="LN2901">2901</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2902"><td class="num" id="LN2902">2902</td><td class="line">            <span class='keyword'>if</span>( !ranges[i] )</td></tr>
<tr class="codeline" data-linenumber="2903"><td class="num" id="LN2903">2903</td><td class="line">                <span class='macro'>CV_Error( CV_StsNullPtr, <span class='string_literal'>"One of &lt;ranges&gt; elements is NULL"</span> )<span class='macro_popup'>do { (void)(CV_StsNullPtr); (void)("One of &lt;ranges&gt; elements is NULL"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2904"><td class="num" id="LN2904">2904</td><td class="line">            hist-&gt;thresh[i][0] = ranges[i][0];</td></tr>
<tr class="codeline" data-linenumber="2905"><td class="num" id="LN2905">2905</td><td class="line">            hist-&gt;thresh[i][1] = ranges[i][1];</td></tr>
<tr class="codeline" data-linenumber="2906"><td class="num" id="LN2906">2906</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2907"><td class="num" id="LN2907">2907</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2908"><td class="num" id="LN2908">2908</td><td class="line">        hist-&gt;type |= <span class='macro'>CV_HIST_UNIFORM_FLAG<span class='macro_popup'>(1 &lt;&lt; 10)</span></span> + <span class='macro'>CV_HIST_RANGES_FLAG<span class='macro_popup'>(1 &lt;&lt; 11)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2909"><td class="num" id="LN2909">2909</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2910"><td class="num" id="LN2910">2910</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2911"><td class="num" id="LN2911">2911</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2912"><td class="num" id="LN2912">2912</td><td class="line">        <span class='keyword'>float</span>* dim_ranges;</td></tr>
<tr class="codeline" data-linenumber="2913"><td class="num" id="LN2913">2913</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2914"><td class="num" id="LN2914">2914</td><td class="line">        <span class='keyword'>if</span>( !hist-&gt;thresh2 )</td></tr>
<tr class="codeline" data-linenumber="2915"><td class="num" id="LN2915">2915</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2916"><td class="num" id="LN2916">2916</td><td class="line">            hist-&gt;thresh2 = (<span class='keyword'>float</span>**)cvAlloc(</td></tr>
<tr class="codeline" data-linenumber="2917"><td class="num" id="LN2917">2917</td><td class="line">                        dims*<span class='keyword'>sizeof</span>(hist-&gt;thresh2[0])+</td></tr>
<tr class="codeline" data-linenumber="2918"><td class="num" id="LN2918">2918</td><td class="line">                        total*<span class='keyword'>sizeof</span>(hist-&gt;thresh2[0][0]));</td></tr>
<tr class="codeline" data-linenumber="2919"><td class="num" id="LN2919">2919</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2920"><td class="num" id="LN2920">2920</td><td class="line">        dim_ranges = (<span class='keyword'>float</span>*)(hist-&gt;thresh2 + dims);</td></tr>
<tr class="codeline" data-linenumber="2921"><td class="num" id="LN2921">2921</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2922"><td class="num" id="LN2922">2922</td><td class="line">        <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="2923"><td class="num" id="LN2923">2923</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2924"><td class="num" id="LN2924">2924</td><td class="line">            <span class='keyword'>float</span> val0 = -<span class='macro'>FLT_MAX<span class='macro_popup'>3.40282347e+38F</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2925"><td class="num" id="LN2925">2925</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2926"><td class="num" id="LN2926">2926</td><td class="line">            <span class='keyword'>if</span>( !ranges[i] )</td></tr>
<tr class="codeline" data-linenumber="2927"><td class="num" id="LN2927">2927</td><td class="line">                <span class='macro'>CV_Error( CV_StsNullPtr, <span class='string_literal'>"One of &lt;ranges&gt; elements is NULL"</span> )<span class='macro_popup'>do { (void)(CV_StsNullPtr); (void)("One of &lt;ranges&gt; elements is NULL"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2928"><td class="num" id="LN2928">2928</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2929"><td class="num" id="LN2929">2929</td><td class="line">            <span class='keyword'>for</span>( j = 0; j &lt;= size[i]; j++ )</td></tr>
<tr class="codeline" data-linenumber="2930"><td class="num" id="LN2930">2930</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="2931"><td class="num" id="LN2931">2931</td><td class="line">                <span class='keyword'>float</span> val = ranges[i][j];</td></tr>
<tr class="codeline" data-linenumber="2932"><td class="num" id="LN2932">2932</td><td class="line">                <span class='keyword'>if</span>( val &lt;= val0 )</td></tr>
<tr class="codeline" data-linenumber="2933"><td class="num" id="LN2933">2933</td><td class="line">                    <span class='macro'>CV_Error(CV_StsOutOfRange, <span class='string_literal'>"Bin ranges should go in ascenting order"</span>)<span class='macro_popup'>do { (void)(CV_StsOutOfRange); (void)("Bin ranges should go in ascenting order"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2934"><td class="num" id="LN2934">2934</td><td class="line">                val0 = dim_ranges[j] = val;</td></tr>
<tr class="codeline" data-linenumber="2935"><td class="num" id="LN2935">2935</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2936"><td class="num" id="LN2936">2936</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2937"><td class="num" id="LN2937">2937</td><td class="line">            hist-&gt;thresh2[i] = dim_ranges;</td></tr>
<tr class="codeline" data-linenumber="2938"><td class="num" id="LN2938">2938</td><td class="line">            dim_ranges += size[i] + 1;</td></tr>
<tr class="codeline" data-linenumber="2939"><td class="num" id="LN2939">2939</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2940"><td class="num" id="LN2940">2940</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2941"><td class="num" id="LN2941">2941</td><td class="line">        hist-&gt;type |= <span class='macro'>CV_HIST_RANGES_FLAG<span class='macro_popup'>(1 &lt;&lt; 11)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2942"><td class="num" id="LN2942">2942</td><td class="line">        hist-&gt;type &amp;= ~<span class='macro'>CV_HIST_UNIFORM_FLAG<span class='macro_popup'>(1 &lt;&lt; 10)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2943"><td class="num" id="LN2943">2943</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2944"><td class="num" id="LN2944">2944</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2945"><td class="num" id="LN2945">2945</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2946"><td class="num" id="LN2946">2946</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2947"><td class="num" id="LN2947">2947</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="2948"><td class="num" id="LN2948">2948</td><td class="line">cvCalcArrHist( CvArr** img, CvHistogram* hist, <span class='keyword'>int</span> accumulate, <span class='keyword'>const</span> CvArr* mask )</td></tr>
<tr class="codeline" data-linenumber="2949"><td class="num" id="LN2949">2949</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2950"><td class="num" id="LN2950">2950</td><td class="line">    <span class='keyword'>if</span>( !<span class='macro'>CV_IS_HIST(hist)<span class='macro_popup'>((hist) != __null &amp;&amp; (((CvHistogram*)(hist))-&gt;type<br> &amp; 0xFFFF0000) == 0x42450000 &amp;&amp; (hist)-&gt;bins !=<br> __null)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2951"><td class="num" id="LN2951">2951</td><td class="line">        <span class='macro'>CV_Error( CV_StsBadArg, <span class='string_literal'>"Bad histogram pointer"</span> )<span class='macro_popup'>do { (void)(CV_StsBadArg); (void)("Bad histogram pointer"); abort<br>(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2952"><td class="num" id="LN2952">2952</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2953"><td class="num" id="LN2953">2953</td><td class="line">    <span class='keyword'>if</span>( !img )</td></tr>
<tr class="codeline" data-linenumber="2954"><td class="num" id="LN2954">2954</td><td class="line">        <span class='macro'>CV_Error( CV_StsNullPtr, <span class='string_literal'>"Null double array pointer"</span> )<span class='macro_popup'>do { (void)(CV_StsNullPtr); (void)("Null double array pointer"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2955"><td class="num" id="LN2955">2955</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2956"><td class="num" id="LN2956">2956</td><td class="line">    <span class='keyword'>int</span> size[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>];</td></tr>
<tr class="codeline" data-linenumber="2957"><td class="num" id="LN2957">2957</td><td class="line">    <span class='keyword'>int</span> i, dims = cvGetDims( hist-&gt;bins, size);</td></tr>
<tr class="codeline" data-linenumber="2958"><td class="num" id="LN2958">2958</td><td class="line">    <span class='keyword'>bool</span> uniform = <span class='macro'>CV_IS_UNIFORM_HIST(hist)<span class='macro_popup'>(((hist)-&gt;type &amp; (1 &lt;&lt; 10)) != 0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2959"><td class="num" id="LN2959">2959</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2960"><td class="num" id="LN2960">2960</td><td class="line">    std::vector&lt;cv::Mat&gt; images(dims);</td></tr>
<tr class="codeline" data-linenumber="2961"><td class="num" id="LN2961">2961</td><td class="line">    <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="2962"><td class="num" id="LN2962">2962</td><td class="line">        images[i] = cv::cvarrToMat(img[i]);</td></tr>
<tr class="codeline" data-linenumber="2963"><td class="num" id="LN2963">2963</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2964"><td class="num" id="LN2964">2964</td><td class="line">    cv::Mat _mask;</td></tr>
<tr class="codeline" data-linenumber="2965"><td class="num" id="LN2965">2965</td><td class="line">    <span class='keyword'>if</span>( mask )</td></tr>
<tr class="codeline" data-linenumber="2966"><td class="num" id="LN2966">2966</td><td class="line">        _mask = cv::cvarrToMat(mask);</td></tr>
<tr class="codeline" data-linenumber="2967"><td class="num" id="LN2967">2967</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2968"><td class="num" id="LN2968">2968</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>float</span>* uranges[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>] = {0};</td></tr>
<tr class="codeline" data-linenumber="2969"><td class="num" id="LN2969">2969</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>float</span>** ranges = 0;</td></tr>
<tr class="codeline" data-linenumber="2970"><td class="num" id="LN2970">2970</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2971"><td class="num" id="LN2971">2971</td><td class="line">    <span class='keyword'>if</span>( hist-&gt;type &amp; <span class='macro'>CV_HIST_RANGES_FLAG<span class='macro_popup'>(1 &lt;&lt; 11)</span></span> )</td></tr>
<tr class="codeline" data-linenumber="2972"><td class="num" id="LN2972">2972</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2973"><td class="num" id="LN2973">2973</td><td class="line">        ranges = (<span class='keyword'>const</span> <span class='keyword'>float</span>**)hist-&gt;thresh2;</td></tr>
<tr class="codeline" data-linenumber="2974"><td class="num" id="LN2974">2974</td><td class="line">        <span class='keyword'>if</span>( uniform )</td></tr>
<tr class="codeline" data-linenumber="2975"><td class="num" id="LN2975">2975</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2976"><td class="num" id="LN2976">2976</td><td class="line">            <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="2977"><td class="num" id="LN2977">2977</td><td class="line">                uranges[i] = &amp;hist-&gt;thresh[i][0];</td></tr>
<tr class="codeline" data-linenumber="2978"><td class="num" id="LN2978">2978</td><td class="line">            ranges = uranges;</td></tr>
<tr class="codeline" data-linenumber="2979"><td class="num" id="LN2979">2979</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2980"><td class="num" id="LN2980">2980</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2981"><td class="num" id="LN2981">2981</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2982"><td class="num" id="LN2982">2982</td><td class="line">    <span class='keyword'>if</span>( !<span class='macro'>CV_IS_SPARSE_HIST(hist)<span class='macro_popup'>(((hist)-&gt;bins) != __null &amp;&amp; (((const CvSparseMat*<br>)((hist)-&gt;bins))-&gt;type &amp; 0xFFFF0000) == 0x42440000)</span></span> )</td></tr>
<tr class="codeline" data-linenumber="2983"><td class="num" id="LN2983">2983</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2984"><td class="num" id="LN2984">2984</td><td class="line">        cv::Mat H = cv::cvarrToMat(hist-&gt;bins);</td></tr>
<tr class="codeline" data-linenumber="2985"><td class="num" id="LN2985">2985</td><td class="line">        cv::calcHist( &amp;images[0], (<span class='keyword'>int</span>)images.size(), 0, _mask,</td></tr>
<tr class="codeline" data-linenumber="2986"><td class="num" id="LN2986">2986</td><td class="line">                      H, cvGetDims(hist-&gt;bins), H.size, ranges, uniform, accumulate != 0 );</td></tr>
<tr class="codeline" data-linenumber="2987"><td class="num" id="LN2987">2987</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2988"><td class="num" id="LN2988">2988</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2989"><td class="num" id="LN2989">2989</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2990"><td class="num" id="LN2990">2990</td><td class="line">        CvSparseMat* sparsemat = (CvSparseMat*)hist-&gt;bins;</td></tr>
<tr class="codeline" data-linenumber="2991"><td class="num" id="LN2991">2991</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2992"><td class="num" id="LN2992">2992</td><td class="line">        <span class='keyword'>if</span>( !accumulate )</td></tr>
<tr class="codeline" data-linenumber="2993"><td class="num" id="LN2993">2993</td><td class="line">            <span class='macro'>cvZero<span class='macro_popup'>cvSetZero</span></span>( hist-&gt;bins );</td></tr>
<tr class="codeline" data-linenumber="2994"><td class="num" id="LN2994">2994</td><td class="line">        cv::SparseMat sH;</td></tr>
<tr class="codeline" data-linenumber="2995"><td class="num" id="LN2995">2995</td><td class="line">        sparsemat-&gt;copyToSparseMat(sH);</td></tr>
<tr class="codeline" data-linenumber="2996"><td class="num" id="LN2996">2996</td><td class="line">        cv::calcHist( &amp;images[0], (<span class='keyword'>int</span>)images.size(), 0, _mask, sH, sH.dims(),</td></tr>
<tr class="codeline" data-linenumber="2997"><td class="num" id="LN2997">2997</td><td class="line">                      sH.dims() &gt; 0 ? sH.hdr-&gt;size : 0, ranges, uniform, accumulate != 0, <span class='keyword'>true</span> );</td></tr>
<tr class="codeline" data-linenumber="2998"><td class="num" id="LN2998">2998</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2999"><td class="num" id="LN2999">2999</td><td class="line">        <span class='keyword'>if</span>( accumulate )</td></tr>
<tr class="codeline" data-linenumber="3000"><td class="num" id="LN3000">3000</td><td class="line">            <span class='macro'>cvZero<span class='macro_popup'>cvSetZero</span></span>( sparsemat );</td></tr>
<tr class="codeline" data-linenumber="3001"><td class="num" id="LN3001">3001</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3002"><td class="num" id="LN3002">3002</td><td class="line">        cv::SparseMatConstIterator it = sH.begin();</td></tr>
<tr class="codeline" data-linenumber="3003"><td class="num" id="LN3003">3003</td><td class="line">        <span class='keyword'>int</span> nz = (<span class='keyword'>int</span>)sH.nzcount();</td></tr>
<tr class="codeline" data-linenumber="3004"><td class="num" id="LN3004">3004</td><td class="line">        <span class='keyword'>for</span>( i = 0; i &lt; nz; i++, ++it )</td></tr>
<tr class="codeline" data-linenumber="3005"><td class="num" id="LN3005">3005</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="3006"><td class="num" id="LN3006">3006</td><td class="line">            <span class='macro'>CV_Assert(it.ptr != NULL)<span class='macro_popup'>do { if (!(it.ptr != __null)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3007"><td class="num" id="LN3007">3007</td><td class="line">            *(<span class='keyword'>float</span>*)cvPtrND(sparsemat, it.node()-&gt;idx, 0, -2) = (<span class='keyword'>float</span>)*(<span class='keyword'>const</span> <span class='keyword'>int</span>*)it.ptr;</td></tr>
<tr class="codeline" data-linenumber="3008"><td class="num" id="LN3008">3008</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3009"><td class="num" id="LN3009">3009</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3010"><td class="num" id="LN3010">3010</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3011"><td class="num" id="LN3011">3011</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3012"><td class="num" id="LN3012">3012</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3013"><td class="num" id="LN3013">3013</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="3014"><td class="num" id="LN3014">3014</td><td class="line">cvCalcArrBackProject( CvArr** img, CvArr* dst, <span class='keyword'>const</span> CvHistogram* hist )</td></tr>
<tr class="codeline" data-linenumber="3015"><td class="num" id="LN3015">3015</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3016"><td class="num" id="LN3016">3016</td><td class="line">    <span class='keyword'>if</span>( !<span class='macro'>CV_IS_HIST(hist)<span class='macro_popup'>((hist) != __null &amp;&amp; (((CvHistogram*)(hist))-&gt;type<br> &amp; 0xFFFF0000) == 0x42450000 &amp;&amp; (hist)-&gt;bins !=<br> __null)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3017"><td class="num" id="LN3017">3017</td><td class="line">        <span class='macro'>CV_Error( CV_StsBadArg, <span class='string_literal'>"Bad histogram pointer"</span> )<span class='macro_popup'>do { (void)(CV_StsBadArg); (void)("Bad histogram pointer"); abort<br>(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3018"><td class="num" id="LN3018">3018</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3019"><td class="num" id="LN3019">3019</td><td class="line">    <span class='keyword'>if</span>( !img )</td></tr>
<tr class="codeline" data-linenumber="3020"><td class="num" id="LN3020">3020</td><td class="line">        <span class='macro'>CV_Error( CV_StsNullPtr, <span class='string_literal'>"Null double array pointer"</span> )<span class='macro_popup'>do { (void)(CV_StsNullPtr); (void)("Null double array pointer"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3021"><td class="num" id="LN3021">3021</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3022"><td class="num" id="LN3022">3022</td><td class="line">    <span class='keyword'>int</span> size[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>];</td></tr>
<tr class="codeline" data-linenumber="3023"><td class="num" id="LN3023">3023</td><td class="line">    <span class='keyword'>int</span> i, dims = cvGetDims( hist-&gt;bins, size );</td></tr>
<tr class="codeline" data-linenumber="3024"><td class="num" id="LN3024">3024</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3025"><td class="num" id="LN3025">3025</td><td class="line">    <span class='keyword'>bool</span> uniform = <span class='macro'>CV_IS_UNIFORM_HIST(hist)<span class='macro_popup'>(((hist)-&gt;type &amp; (1 &lt;&lt; 10)) != 0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3026"><td class="num" id="LN3026">3026</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>float</span>* uranges[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>] = {0};</td></tr>
<tr class="codeline" data-linenumber="3027"><td class="num" id="LN3027">3027</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>float</span>** ranges = 0;</td></tr>
<tr class="codeline" data-linenumber="3028"><td class="num" id="LN3028">3028</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3029"><td class="num" id="LN3029">3029</td><td class="line">    <span class='keyword'>if</span>( hist-&gt;type &amp; <span class='macro'>CV_HIST_RANGES_FLAG<span class='macro_popup'>(1 &lt;&lt; 11)</span></span> )</td></tr>
<tr class="codeline" data-linenumber="3030"><td class="num" id="LN3030">3030</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3031"><td class="num" id="LN3031">3031</td><td class="line">        ranges = (<span class='keyword'>const</span> <span class='keyword'>float</span>**)hist-&gt;thresh2;</td></tr>
<tr class="codeline" data-linenumber="3032"><td class="num" id="LN3032">3032</td><td class="line">        <span class='keyword'>if</span>( uniform )</td></tr>
<tr class="codeline" data-linenumber="3033"><td class="num" id="LN3033">3033</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="3034"><td class="num" id="LN3034">3034</td><td class="line">            <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="3035"><td class="num" id="LN3035">3035</td><td class="line">                uranges[i] = &amp;hist-&gt;thresh[i][0];</td></tr>
<tr class="codeline" data-linenumber="3036"><td class="num" id="LN3036">3036</td><td class="line">            ranges = uranges;</td></tr>
<tr class="codeline" data-linenumber="3037"><td class="num" id="LN3037">3037</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3038"><td class="num" id="LN3038">3038</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3039"><td class="num" id="LN3039">3039</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3040"><td class="num" id="LN3040">3040</td><td class="line">    std::vector&lt;cv::Mat&gt; images(dims);</td></tr>
<tr class="codeline" data-linenumber="3041"><td class="num" id="LN3041">3041</td><td class="line">    <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="3042"><td class="num" id="LN3042">3042</td><td class="line">        images[i] = cv::cvarrToMat(img[i]);</td></tr>
<tr class="codeline" data-linenumber="3043"><td class="num" id="LN3043">3043</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3044"><td class="num" id="LN3044">3044</td><td class="line">    cv::Mat _dst = cv::cvarrToMat(dst);</td></tr>
<tr class="codeline" data-linenumber="3045"><td class="num" id="LN3045">3045</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3046"><td class="num" id="LN3046">3046</td><td class="line">    <span class='macro'>CV_Assert( _dst.size() == images[0].size() &amp;&amp; _dst.depth() == images[0].depth() )<span class='macro_popup'>do { if (!(_dst.size() == images[0].size() &amp;&amp; _dst.depth<br>() == images[0].depth())) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3047"><td class="num" id="LN3047">3047</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3048"><td class="num" id="LN3048">3048</td><td class="line">    <span class='keyword'>if</span>( !<span class='macro'>CV_IS_SPARSE_HIST(hist)<span class='macro_popup'>(((hist)-&gt;bins) != __null &amp;&amp; (((const CvSparseMat*<br>)((hist)-&gt;bins))-&gt;type &amp; 0xFFFF0000) == 0x42440000)</span></span> )</td></tr>
<tr class="codeline" data-linenumber="3049"><td class="num" id="LN3049">3049</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3050"><td class="num" id="LN3050">3050</td><td class="line">        cv::Mat H = cv::cvarrToMat(hist-&gt;bins);</td></tr>
<tr class="codeline" data-linenumber="3051"><td class="num" id="LN3051">3051</td><td class="line">        cv::calcBackProject( &amp;images[0], (<span class='keyword'>int</span>)images.size(),</td></tr>
<tr class="codeline" data-linenumber="3052"><td class="num" id="LN3052">3052</td><td class="line">                            0, H, _dst, ranges, 1, uniform );</td></tr>
<tr class="codeline" data-linenumber="3053"><td class="num" id="LN3053">3053</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3054"><td class="num" id="LN3054">3054</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3055"><td class="num" id="LN3055">3055</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3056"><td class="num" id="LN3056">3056</td><td class="line">        cv::SparseMat sH;</td></tr>
<tr class="codeline" data-linenumber="3057"><td class="num" id="LN3057">3057</td><td class="line">        ((<span class='keyword'>const</span> CvSparseMat*)hist-&gt;bins)-&gt;copyToSparseMat(sH);</td></tr>
<tr class="codeline" data-linenumber="3058"><td class="num" id="LN3058">3058</td><td class="line">        cv::calcBackProject( &amp;images[0], (<span class='keyword'>int</span>)images.size(),</td></tr>
<tr class="codeline" data-linenumber="3059"><td class="num" id="LN3059">3059</td><td class="line">                             0, sH, _dst, ranges, 1, uniform );</td></tr>
<tr class="codeline" data-linenumber="3060"><td class="num" id="LN3060">3060</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3061"><td class="num" id="LN3061">3061</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3062"><td class="num" id="LN3062">3062</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3063"><td class="num" id="LN3063">3063</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3064"><td class="num" id="LN3064">3064</td><td class="line"><span class='comment'>////////////////////// B A C K   P R O J E C T   P A T C H /////////////////////////</span></td></tr>
<tr class="codeline" data-linenumber="3065"><td class="num" id="LN3065">3065</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3066"><td class="num" id="LN3066">3066</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="3067"><td class="num" id="LN3067">3067</td><td class="line">cvCalcArrBackProjectPatch( CvArr** arr, CvArr* dst, CvSize patch_size, CvHistogram* hist,</td></tr>
<tr class="codeline" data-linenumber="3068"><td class="num" id="LN3068">3068</td><td class="line">                           <span class='keyword'>int</span> method, <span class='keyword'>double</span> norm_factor )</td></tr>
<tr class="codeline" data-linenumber="3069"><td class="num" id="LN3069">3069</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3070"><td class="num" id="LN3070">3070</td><td class="line">    CvHistogram* model = 0;</td></tr>
<tr class="codeline" data-linenumber="3071"><td class="num" id="LN3071">3071</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3072"><td class="num" id="LN3072">3072</td><td class="line">    IplImage imgstub[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>], *img[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>];</td></tr>
<tr class="codeline" data-linenumber="3073"><td class="num" id="LN3073">3073</td><td class="line">    IplROI roi;</td></tr>
<tr class="codeline" data-linenumber="3074"><td class="num" id="LN3074">3074</td><td class="line">    CvMat dststub, *dstmat;</td></tr>
<tr class="codeline" data-linenumber="3075"><td class="num" id="LN3075">3075</td><td class="line">    <span class='keyword'>int</span> i, dims;</td></tr>
<tr class="codeline" data-linenumber="3076"><td class="num" id="LN3076">3076</td><td class="line">    <span class='keyword'>int</span> x, y;</td></tr>
<tr class="codeline" data-linenumber="3077"><td class="num" id="LN3077">3077</td><td class="line">    cv::Size size;</td></tr>
<tr class="codeline" data-linenumber="3078"><td class="num" id="LN3078">3078</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3079"><td class="num" id="LN3079">3079</td><td class="line">    <span class='keyword'>if</span>( !<span class='macro'>CV_IS_HIST(hist)<span class='macro_popup'>((hist) != __null &amp;&amp; (((CvHistogram*)(hist))-&gt;type<br> &amp; 0xFFFF0000) == 0x42450000 &amp;&amp; (hist)-&gt;bins !=<br> __null)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3080"><td class="num" id="LN3080">3080</td><td class="line">        <span class='macro'>CV_Error( CV_StsBadArg, <span class='string_literal'>"Bad histogram pointer"</span> )<span class='macro_popup'>do { (void)(CV_StsBadArg); (void)("Bad histogram pointer"); abort<br>(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3081"><td class="num" id="LN3081">3081</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3082"><td class="num" id="LN3082">3082</td><td class="line">    <span class='keyword'>if</span>( !arr )</td></tr>
<tr class="codeline" data-linenumber="3083"><td class="num" id="LN3083">3083</td><td class="line">        <span class='macro'>CV_Error( CV_StsNullPtr, <span class='string_literal'>"Null double array pointer"</span> )<span class='macro_popup'>do { (void)(CV_StsNullPtr); (void)("Null double array pointer"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3084"><td class="num" id="LN3084">3084</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3085"><td class="num" id="LN3085">3085</td><td class="line">    <span class='keyword'>if</span>( norm_factor &lt;= 0 )</td></tr>
<tr class="codeline" data-linenumber="3086"><td class="num" id="LN3086">3086</td><td class="line">        <span class='macro'>CV_Error( CV_StsOutOfRange,<span class='macro_popup'>do { (void)(CV_StsOutOfRange); (void)("Bad normalization factor (set it to 1.0 if unsure)"<br>); abort(); } while (0)</span></span></td></tr>
<tr class="codeline" data-linenumber="3087"><td class="num" id="LN3087">3087</td><td class="line">                  <span class='string_literal'><span class='macro'>"Bad normalization factor (set it to 1.0 if unsure)"</span> )<span class='macro_popup'>do { (void)(CV_StsOutOfRange); (void)("Bad normalization factor (set it to 1.0 if unsure)"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3088"><td class="num" id="LN3088">3088</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3089"><td class="num" id="LN3089">3089</td><td class="line">    <span class='keyword'>if</span>( patch_size.width &lt;= 0 || patch_size.height &lt;= 0 )</td></tr>
<tr class="codeline" data-linenumber="3090"><td class="num" id="LN3090">3090</td><td class="line">        <span class='macro'>CV_Error( CV_StsBadSize, <span class='string_literal'>"The patch width and height must be positive"</span> )<span class='macro_popup'>do { (void)(CV_StsBadSize); (void)("The patch width and height must be positive"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3091"><td class="num" id="LN3091">3091</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3092"><td class="num" id="LN3092">3092</td><td class="line">    dims = cvGetDims( hist-&gt;bins );</td></tr>
<tr class="codeline" data-linenumber="3093"><td class="num" id="LN3093">3093</td><td class="line">    <span class='keyword'>if</span> (dims &lt; 1)</td></tr>
<tr class="codeline" data-linenumber="3094"><td class="num" id="LN3094">3094</td><td class="line">        <span class='macro'>CV_Error( CV_StsOutOfRange, <span class='string_literal'>"Invalid number of dimensions"</span>)<span class='macro_popup'>do { (void)(CV_StsOutOfRange); (void)("Invalid number of dimensions"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3095"><td class="num" id="LN3095">3095</td><td class="line">    cvNormalizeHist( hist, norm_factor );</td></tr>
<tr class="codeline" data-linenumber="3096"><td class="num" id="LN3096">3096</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3097"><td class="num" id="LN3097">3097</td><td class="line">    <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="3098"><td class="num" id="LN3098">3098</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3099"><td class="num" id="LN3099">3099</td><td class="line">        CvMat stub, *mat;</td></tr>
<tr class="codeline" data-linenumber="3100"><td class="num" id="LN3100">3100</td><td class="line">        mat = cvGetMat( arr[i], &amp;stub, 0, 0 );</td></tr>
<tr class="codeline" data-linenumber="3101"><td class="num" id="LN3101">3101</td><td class="line">        img[i] = cvGetImage( mat, &amp;imgstub[i] );</td></tr>
<tr class="codeline" data-linenumber="3102"><td class="num" id="LN3102">3102</td><td class="line">        img[i]-&gt;roi = &amp;roi;</td></tr>
<tr class="codeline" data-linenumber="3103"><td class="num" id="LN3103">3103</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3104"><td class="num" id="LN3104">3104</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3105"><td class="num" id="LN3105">3105</td><td class="line">    dstmat = cvGetMat( dst, &amp;dststub, 0, 0 );</td></tr>
<tr class="codeline" data-linenumber="3106"><td class="num" id="LN3106">3106</td><td class="line">    <span class='keyword'>if</span>( <span class='macro'>CV_MAT_TYPE( dstmat-&gt;type )<span class='macro_popup'>((dstmat-&gt;type) &amp; ((1 &lt;&lt; 3)*512 - 1))</span></span> != <span class='macro'>CV_32FC1<span class='macro_popup'>(((5) &amp; ((1 &lt;&lt; 3) - 1)) + (((1)-1) &lt;&lt; 3))</span></span> )</td></tr>
<tr class="codeline" data-linenumber="3107"><td class="num" id="LN3107">3107</td><td class="line">        <span class='macro'>CV_Error( CV_StsUnsupportedFormat, <span class='string_literal'>"Resultant image must have 32fC1 type"</span> )<span class='macro_popup'>do { (void)(CV_StsUnsupportedFormat); (void)("Resultant image must have 32fC1 type"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3108"><td class="num" id="LN3108">3108</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3109"><td class="num" id="LN3109">3109</td><td class="line">    <span class='keyword'>if</span>( dstmat-&gt;cols != img[0]-&gt;width - patch_size.width + 1 ||</td></tr>
<tr class="codeline" data-linenumber="3110"><td class="num" id="LN3110">3110</td><td class="line">        dstmat-&gt;rows != img[0]-&gt;height - patch_size.height + 1 )</td></tr>
<tr class="codeline" data-linenumber="3111"><td class="num" id="LN3111">3111</td><td class="line">        <span class='macro'>CV_Error( CV_StsUnmatchedSizes,<span class='macro_popup'>do { (void)(CV_StsUnmatchedSizes); (void)("The output map must be (W-w+1 x H-h+1), "<br> "where the input images are (W x H) each and the patch is (w x h)"<br>); abort(); } while (0)</span></span></td></tr>
<tr class="codeline" data-linenumber="3112"><td class="num" id="LN3112">3112</td><td class="line">            <span class='string_literal'><span class='macro'>"The output map must be (W-w+1 x H-h+1), "<span class='macro_popup'>do { (void)(CV_StsUnmatchedSizes); (void)("The output map must be (W-w+1 x H-h+1), "<br> "where the input images are (W x H) each and the patch is (w x h)"<br>); abort(); } while (0)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="3113"><td class="num" id="LN3113">3113</td><td class="line">            <span class='string_literal'><span class='macro'>"where the input images are (W x H) each and the patch is (w x h)"</span> )<span class='macro_popup'>do { (void)(CV_StsUnmatchedSizes); (void)("The output map must be (W-w+1 x H-h+1), "<br> "where the input images are (W x H) each and the patch is (w x h)"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3114"><td class="num" id="LN3114">3114</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3115"><td class="num" id="LN3115">3115</td><td class="line">    cvCopyHist( hist, &amp;model );</td></tr>
<tr class="codeline" data-linenumber="3116"><td class="num" id="LN3116">3116</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3117"><td class="num" id="LN3117">3117</td><td class="line">    size = cvGetMatSize(dstmat);</td></tr>
<tr class="codeline" data-linenumber="3118"><td class="num" id="LN3118">3118</td><td class="line">    roi.coi = 0;</td></tr>
<tr class="codeline" data-linenumber="3119"><td class="num" id="LN3119">3119</td><td class="line">    roi.width = patch_size.width;</td></tr>
<tr class="codeline" data-linenumber="3120"><td class="num" id="LN3120">3120</td><td class="line">    roi.height = patch_size.height;</td></tr>
<tr class="codeline" data-linenumber="3121"><td class="num" id="LN3121">3121</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3122"><td class="num" id="LN3122">3122</td><td class="line">    <span class='keyword'>for</span>( y = 0; y &lt; size.height; y++ )</td></tr>
<tr class="codeline" data-linenumber="3123"><td class="num" id="LN3123">3123</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3124"><td class="num" id="LN3124">3124</td><td class="line">        <span class='keyword'>for</span>( x = 0; x &lt; size.width; x++ )</td></tr>
<tr class="codeline" data-linenumber="3125"><td class="num" id="LN3125">3125</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="3126"><td class="num" id="LN3126">3126</td><td class="line">            <span class='keyword'>double</span> result;</td></tr>
<tr class="codeline" data-linenumber="3127"><td class="num" id="LN3127">3127</td><td class="line">            roi.xOffset = x;</td></tr>
<tr class="codeline" data-linenumber="3128"><td class="num" id="LN3128">3128</td><td class="line">            roi.yOffset = y;</td></tr>
<tr class="codeline" data-linenumber="3129"><td class="num" id="LN3129">3129</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3130"><td class="num" id="LN3130">3130</td><td class="line">            cvCalcHist( img, model );</td></tr>
<tr class="codeline" data-linenumber="3131"><td class="num" id="LN3131">3131</td><td class="line">            cvNormalizeHist( model, norm_factor );</td></tr>
<tr class="codeline" data-linenumber="3132"><td class="num" id="LN3132">3132</td><td class="line">            result = cvCompareHist( model, hist, method );</td></tr>
<tr class="codeline" data-linenumber="3133"><td class="num" id="LN3133">3133</td><td class="line">            <span class='macro'>CV_MAT_ELEM( *dstmat, <span class='keyword'>float</span>, y, x )<span class='macro_popup'>(*(float*)((static_cast&lt;void&gt; (0)), (*dstmat).data.ptr +<br> (size_t)(*dstmat).step*(y) + (sizeof(float))*(x)))</span></span> = (<span class='keyword'>float</span>)result;</td></tr>
<tr class="codeline" data-linenumber="3134"><td class="num" id="LN3134">3134</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3135"><td class="num" id="LN3135">3135</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3136"><td class="num" id="LN3136">3136</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3137"><td class="num" id="LN3137">3137</td><td class="line">    cvReleaseHist( &amp;model );</td></tr>
<tr class="codeline" data-linenumber="3138"><td class="num" id="LN3138">3138</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3139"><td class="num" id="LN3139">3139</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3140"><td class="num" id="LN3140">3140</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3141"><td class="num" id="LN3141">3141</td><td class="line"><span class='comment'>// Calculates Bayes probabilistic histograms</span></td></tr>
<tr class="codeline" data-linenumber="3142"><td class="num" id="LN3142">3142</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="3143"><td class="num" id="LN3143">3143</td><td class="line">cvCalcBayesianProb( CvHistogram** src, <span class='keyword'>int</span> count, CvHistogram** dst )</td></tr>
<tr class="codeline" data-linenumber="3144"><td class="num" id="LN3144">3144</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3145"><td class="num" id="LN3145">3145</td><td class="line">    <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="3146"><td class="num" id="LN3146">3146</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3147"><td class="num" id="LN3147">3147</td><td class="line">    <span class='keyword'>if</span>( !src || !dst )</td></tr>
<tr class="codeline" data-linenumber="3148"><td class="num" id="LN3148">3148</td><td class="line">        <span class='macro'>CV_Error( CV_StsNullPtr, <span class='string_literal'>"NULL histogram array pointer"</span> )<span class='macro_popup'>do { (void)(CV_StsNullPtr); (void)("NULL histogram array pointer"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3149"><td class="num" id="LN3149">3149</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3150"><td class="num" id="LN3150">3150</td><td class="line">    <span class='keyword'>if</span>( count &lt; 2 )</td></tr>
<tr class="codeline" data-linenumber="3151"><td class="num" id="LN3151">3151</td><td class="line">        <span class='macro'>CV_Error( CV_StsOutOfRange, <span class='string_literal'>"Too small number of histograms"</span> )<span class='macro_popup'>do { (void)(CV_StsOutOfRange); (void)("Too small number of histograms"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3152"><td class="num" id="LN3152">3152</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3153"><td class="num" id="LN3153">3153</td><td class="line">    <span class='keyword'>for</span>( i = 0; i &lt; count; i++ )</td></tr>
<tr class="codeline" data-linenumber="3154"><td class="num" id="LN3154">3154</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3155"><td class="num" id="LN3155">3155</td><td class="line">        <span class='keyword'>if</span>( !<span class='macro'>CV_IS_HIST(src[i])<span class='macro_popup'>((src[i]) != __null &amp;&amp; (((CvHistogram*)(src[i]))-&gt;<br>type &amp; 0xFFFF0000) == 0x42450000 &amp;&amp; (src[i])-&gt;<br>bins != __null)</span></span> || !<span class='macro'>CV_IS_HIST(dst[i])<span class='macro_popup'>((dst[i]) != __null &amp;&amp; (((CvHistogram*)(dst[i]))-&gt;<br>type &amp; 0xFFFF0000) == 0x42450000 &amp;&amp; (dst[i])-&gt;<br>bins != __null)</span></span> )</td></tr>
<tr class="codeline" data-linenumber="3156"><td class="num" id="LN3156">3156</td><td class="line">            <span class='macro'>CV_Error( CV_StsBadArg, <span class='string_literal'>"Invalid histogram header"</span> )<span class='macro_popup'>do { (void)(CV_StsBadArg); (void)("Invalid histogram header")<br>; abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3157"><td class="num" id="LN3157">3157</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3158"><td class="num" id="LN3158">3158</td><td class="line">        <span class='keyword'>if</span>( !<span class='macro'>CV_IS_MATND(src[i]-&gt;bins)<span class='macro_popup'>(((src[i]-&gt;bins) != __null &amp;&amp; (((const CvMatND*)(src<br>[i]-&gt;bins))-&gt;type &amp; 0xFFFF0000) == 0x42430000) &amp;&amp;<br> ((const CvMatND*)(src[i]-&gt;bins))-&gt;data.ptr != __null)</span></span> || !<span class='macro'>CV_IS_MATND(dst[i]-&gt;bins)<span class='macro_popup'>(((dst[i]-&gt;bins) != __null &amp;&amp; (((const CvMatND*)(dst<br>[i]-&gt;bins))-&gt;type &amp; 0xFFFF0000) == 0x42430000) &amp;&amp;<br> ((const CvMatND*)(dst[i]-&gt;bins))-&gt;data.ptr != __null)</span></span> )</td></tr>
<tr class="codeline" data-linenumber="3159"><td class="num" id="LN3159">3159</td><td class="line">            <span class='macro'>CV_Error( CV_StsBadArg, <span class='string_literal'>"The function supports dense histograms only"</span> )<span class='macro_popup'>do { (void)(CV_StsBadArg); (void)("The function supports dense histograms only"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3160"><td class="num" id="LN3160">3160</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3161"><td class="num" id="LN3161">3161</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3162"><td class="num" id="LN3162">3162</td><td class="line">    <span class='macro'>cvZero<span class='macro_popup'>cvSetZero</span></span>( dst[0]-&gt;bins );</td></tr>
<tr class="codeline" data-linenumber="3163"><td class="num" id="LN3163">3163</td><td class="line">    <span class='comment'>// dst[0] = src[0] + ... + src[count-1]</span></td></tr>
<tr class="codeline" data-linenumber="3164"><td class="num" id="LN3164">3164</td><td class="line">    <span class='keyword'>for</span>( i = 0; i &lt; count; i++ )</td></tr>
<tr class="codeline" data-linenumber="3165"><td class="num" id="LN3165">3165</td><td class="line">        cvAdd( src[i]-&gt;bins, dst[0]-&gt;bins, dst[0]-&gt;bins );</td></tr>
<tr class="codeline" data-linenumber="3166"><td class="num" id="LN3166">3166</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3167"><td class="num" id="LN3167">3167</td><td class="line">    cvDiv( 0, dst[0]-&gt;bins, dst[0]-&gt;bins );</td></tr>
<tr class="codeline" data-linenumber="3168"><td class="num" id="LN3168">3168</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3169"><td class="num" id="LN3169">3169</td><td class="line">    <span class='comment'>// dst[i] = src[i]*(1/dst[0])</span></td></tr>
<tr class="codeline" data-linenumber="3170"><td class="num" id="LN3170">3170</td><td class="line">    <span class='keyword'>for</span>( i = count - 1; i &gt;= 0; i-- )</td></tr>
<tr class="codeline" data-linenumber="3171"><td class="num" id="LN3171">3171</td><td class="line">        cvMul( src[i]-&gt;bins, dst[0]-&gt;bins, dst[i]-&gt;bins );</td></tr>
<tr class="codeline" data-linenumber="3172"><td class="num" id="LN3172">3172</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3173"><td class="num" id="LN3173">3173</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3174"><td class="num" id="LN3174">3174</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3175"><td class="num" id="LN3175">3175</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>void</span></td></tr>
<tr class="codeline" data-linenumber="3176"><td class="num" id="LN3176">3176</td><td class="line">cvCalcProbDensity( <span class='keyword'>const</span> CvHistogram* hist, <span class='keyword'>const</span> CvHistogram* hist_mask,</td></tr>
<tr class="codeline" data-linenumber="3177"><td class="num" id="LN3177">3177</td><td class="line">                   CvHistogram* hist_dens, <span class='keyword'>double</span> scale )</td></tr>
<tr class="codeline" data-linenumber="3178"><td class="num" id="LN3178">3178</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3179"><td class="num" id="LN3179">3179</td><td class="line">    <span class='keyword'>if</span>( scale &lt;= 0 )</td></tr>
<tr class="codeline" data-linenumber="3180"><td class="num" id="LN3180">3180</td><td class="line">        <span class='macro'>CV_Error( CV_StsOutOfRange, <span class='string_literal'>"scale must be positive"</span> )<span class='macro_popup'>do { (void)(CV_StsOutOfRange); (void)("scale must be positive"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3181"><td class="num" id="LN3181">3181</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3182"><td class="num" id="LN3182">3182</td><td class="line">    <span class='keyword'>if</span>( !<span class='macro'>CV_IS_HIST(hist)<span class='macro_popup'>((hist) != __null &amp;&amp; (((CvHistogram*)(hist))-&gt;type<br> &amp; 0xFFFF0000) == 0x42450000 &amp;&amp; (hist)-&gt;bins !=<br> __null)</span></span> || !<span class='macro'>CV_IS_HIST(hist_mask)<span class='macro_popup'>((hist_mask) != __null &amp;&amp; (((CvHistogram*)(hist_mask)<br>)-&gt;type &amp; 0xFFFF0000) == 0x42450000 &amp;&amp; (hist_mask<br>)-&gt;bins != __null)</span></span> || !<span class='macro'>CV_IS_HIST(hist_dens)<span class='macro_popup'>((hist_dens) != __null &amp;&amp; (((CvHistogram*)(hist_dens)<br>)-&gt;type &amp; 0xFFFF0000) == 0x42450000 &amp;&amp; (hist_dens<br>)-&gt;bins != __null)</span></span> )</td></tr>
<tr class="codeline" data-linenumber="3183"><td class="num" id="LN3183">3183</td><td class="line">        <span class='macro'>CV_Error( CV_StsBadArg, <span class='string_literal'>"Invalid histogram pointer[s]"</span> )<span class='macro_popup'>do { (void)(CV_StsBadArg); (void)("Invalid histogram pointer[s]"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3184"><td class="num" id="LN3184">3184</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3185"><td class="num" id="LN3185">3185</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3186"><td class="num" id="LN3186">3186</td><td class="line">        CvArr* arrs[] = { hist-&gt;bins, hist_mask-&gt;bins, hist_dens-&gt;bins };</td></tr>
<tr class="codeline" data-linenumber="3187"><td class="num" id="LN3187">3187</td><td class="line">        CvMatND stubs[3];</td></tr>
<tr class="codeline" data-linenumber="3188"><td class="num" id="LN3188">3188</td><td class="line">        CvNArrayIterator iterator;</td></tr>
<tr class="codeline" data-linenumber="3189"><td class="num" id="LN3189">3189</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3190"><td class="num" id="LN3190">3190</td><td class="line">        cvInitNArrayIterator( 3, arrs, 0, stubs, &amp;iterator );</td></tr>
<tr class="codeline" data-linenumber="3191"><td class="num" id="LN3191">3191</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3192"><td class="num" id="LN3192">3192</td><td class="line">        <span class='keyword'>if</span>( <span class='macro'>CV_MAT_TYPE(iterator.hdr[0]-&gt;type)<span class='macro_popup'>((iterator.hdr[0]-&gt;type) &amp; ((1 &lt;&lt; 3)*512 - 1))</span></span> != <span class='macro'>CV_32FC1<span class='macro_popup'>(((5) &amp; ((1 &lt;&lt; 3) - 1)) + (((1)-1) &lt;&lt; 3))</span></span> )</td></tr>
<tr class="codeline" data-linenumber="3193"><td class="num" id="LN3193">3193</td><td class="line">            <span class='macro'>CV_Error( CV_StsUnsupportedFormat, <span class='string_literal'>"All histograms must have 32fC1 type"</span> )<span class='macro_popup'>do { (void)(CV_StsUnsupportedFormat); (void)("All histograms must have 32fC1 type"<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3194"><td class="num" id="LN3194">3194</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3195"><td class="num" id="LN3195">3195</td><td class="line">        <span class='keyword'>do</span></td></tr>
<tr class="codeline" data-linenumber="3196"><td class="num" id="LN3196">3196</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="3197"><td class="num" id="LN3197">3197</td><td class="line">            <span class='keyword'>const</span> <span class='keyword'>float</span>* srcdata = (<span class='keyword'>const</span> <span class='keyword'>float</span>*)(iterator.ptr[0]);</td></tr>
<tr class="codeline" data-linenumber="3198"><td class="num" id="LN3198">3198</td><td class="line">            <span class='keyword'>const</span> <span class='keyword'>float</span>* maskdata = (<span class='keyword'>const</span> <span class='keyword'>float</span>*)(iterator.ptr[1]);</td></tr>
<tr class="codeline" data-linenumber="3199"><td class="num" id="LN3199">3199</td><td class="line">            <span class='keyword'>float</span>* dstdata = (<span class='keyword'>float</span>*)(iterator.ptr[2]);</td></tr>
<tr class="codeline" data-linenumber="3200"><td class="num" id="LN3200">3200</td><td class="line">            <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="3201"><td class="num" id="LN3201">3201</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3202"><td class="num" id="LN3202">3202</td><td class="line">            <span class='keyword'>for</span>( i = 0; i &lt; iterator.size.width; i++ )</td></tr>
<tr class="codeline" data-linenumber="3203"><td class="num" id="LN3203">3203</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="3204"><td class="num" id="LN3204">3204</td><td class="line">                <span class='keyword'>float</span> s = srcdata[i];</td></tr>
<tr class="codeline" data-linenumber="3205"><td class="num" id="LN3205">3205</td><td class="line">                <span class='keyword'>float</span> m = maskdata[i];</td></tr>
<tr class="codeline" data-linenumber="3206"><td class="num" id="LN3206">3206</td><td class="line">                <span class='keyword'>if</span>( s &gt; <span class='macro'>FLT_EPSILON<span class='macro_popup'>1.19209290e-7F</span></span> )</td></tr>
<tr class="codeline" data-linenumber="3207"><td class="num" id="LN3207">3207</td><td class="line">                    <span class='keyword'>if</span>( m &lt;= s )</td></tr>
<tr class="codeline" data-linenumber="3208"><td class="num" id="LN3208">3208</td><td class="line">                        dstdata[i] = (<span class='keyword'>float</span>)(m*scale/s);</td></tr>
<tr class="codeline" data-linenumber="3209"><td class="num" id="LN3209">3209</td><td class="line">                    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3210"><td class="num" id="LN3210">3210</td><td class="line">                        dstdata[i] = (<span class='keyword'>float</span>)scale;</td></tr>
<tr class="codeline" data-linenumber="3211"><td class="num" id="LN3211">3211</td><td class="line">                <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3212"><td class="num" id="LN3212">3212</td><td class="line">                    dstdata[i] = (<span class='keyword'>float</span>)0;</td></tr>
<tr class="codeline" data-linenumber="3213"><td class="num" id="LN3213">3213</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="3214"><td class="num" id="LN3214">3214</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3215"><td class="num" id="LN3215">3215</td><td class="line">        <span class='keyword'>while</span>( cvNextNArraySlice( &amp;iterator ));</td></tr>
<tr class="codeline" data-linenumber="3216"><td class="num" id="LN3216">3216</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3217"><td class="num" id="LN3217">3217</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3218"><td class="num" id="LN3218">3218</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3219"><td class="num" id="LN3219">3219</td><td class="line"><span class='keyword'>class</span> EqualizeHistCalcHist_Invoker : <span class='keyword'>public</span> cv::ParallelLoopBody</td></tr>
<tr class="codeline" data-linenumber="3220"><td class="num" id="LN3220">3220</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3221"><td class="num" id="LN3221">3221</td><td class="line"><span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="3222"><td class="num" id="LN3222">3222</td><td class="line">    <span class='keyword'>enum</span> {HIST_SZ = 256};</td></tr>
<tr class="codeline" data-linenumber="3223"><td class="num" id="LN3223">3223</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3224"><td class="num" id="LN3224">3224</td><td class="line">    EqualizeHistCalcHist_Invoker(cv::Mat&amp; src, <span class='keyword'>int</span>* histogram, cv::Mutex* histogramLock)</td></tr>
<tr class="codeline" data-linenumber="3225"><td class="num" id="LN3225">3225</td><td class="line">        : src_(src), globalHistogram_(histogram), histogramLock_(histogramLock)</td></tr>
<tr class="codeline" data-linenumber="3226"><td class="num" id="LN3226">3226</td><td class="line">    { }</td></tr>
<tr class="codeline" data-linenumber="3227"><td class="num" id="LN3227">3227</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3228"><td class="num" id="LN3228">3228</td><td class="line">    <span class='keyword'>void</span> <span class='keyword'>operator</span>()( <span class='keyword'>const</span> cv::Range&amp; rowRange ) <span class='keyword'>const</span> <span class='macro'>CV_OVERRIDE<span class='macro_popup'>override</span></span></td></tr>
<tr class="codeline" data-linenumber="3229"><td class="num" id="LN3229">3229</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3230"><td class="num" id="LN3230">3230</td><td class="line">        <span class='keyword'>int</span> localHistogram[HIST_SZ] = {0, };</td></tr>
<tr class="codeline" data-linenumber="3231"><td class="num" id="LN3231">3231</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3232"><td class="num" id="LN3232">3232</td><td class="line">        <span class='keyword'>const</span> size_t sstep = src_.step;</td></tr>
<tr class="codeline" data-linenumber="3233"><td class="num" id="LN3233">3233</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3234"><td class="num" id="LN3234">3234</td><td class="line">        <span class='keyword'>int</span> width = src_.cols;</td></tr>
<tr class="codeline" data-linenumber="3235"><td class="num" id="LN3235">3235</td><td class="line">        <span class='keyword'>int</span> height = rowRange.end - rowRange.start;</td></tr>
<tr class="codeline" data-linenumber="3236"><td class="num" id="LN3236">3236</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3237"><td class="num" id="LN3237">3237</td><td class="line">        <span class='keyword'>if</span> (src_.isContinuous())</td></tr>
<tr class="codeline" data-linenumber="3238"><td class="num" id="LN3238">3238</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="3239"><td class="num" id="LN3239">3239</td><td class="line">            width *= height;</td></tr>
<tr class="codeline" data-linenumber="3240"><td class="num" id="LN3240">3240</td><td class="line">            height = 1;</td></tr>
<tr class="codeline" data-linenumber="3241"><td class="num" id="LN3241">3241</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3242"><td class="num" id="LN3242">3242</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3243"><td class="num" id="LN3243">3243</td><td class="line">        <span class='keyword'>for</span> (<span class='keyword'>const</span> uchar* ptr = src_.ptr&lt;uchar&gt;(rowRange.start); height--; ptr += sstep)</td></tr>
<tr class="codeline" data-linenumber="3244"><td class="num" id="LN3244">3244</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="3245"><td class="num" id="LN3245">3245</td><td class="line">            <span class='keyword'>int</span> x = 0;</td></tr>
<tr class="codeline" data-linenumber="3246"><td class="num" id="LN3246">3246</td><td class="line">            <span class='keyword'>for</span> (; x &lt;= width - 4; x += 4)</td></tr>
<tr class="codeline" data-linenumber="3247"><td class="num" id="LN3247">3247</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="3248"><td class="num" id="LN3248">3248</td><td class="line">                <span class='keyword'>int</span> t0 = ptr[x], t1 = ptr[x+1];</td></tr>
<tr class="codeline" data-linenumber="3249"><td class="num" id="LN3249">3249</td><td class="line">                localHistogram[t0]++; localHistogram[t1]++;</td></tr>
<tr class="codeline" data-linenumber="3250"><td class="num" id="LN3250">3250</td><td class="line">                t0 = ptr[x+2]; t1 = ptr[x+3];</td></tr>
<tr class="codeline" data-linenumber="3251"><td class="num" id="LN3251">3251</td><td class="line">                localHistogram[t0]++; localHistogram[t1]++;</td></tr>
<tr class="codeline" data-linenumber="3252"><td class="num" id="LN3252">3252</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="3253"><td class="num" id="LN3253">3253</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3254"><td class="num" id="LN3254">3254</td><td class="line">            <span class='keyword'>for</span> (; x &lt; width; ++x)</td></tr>
<tr class="codeline" data-linenumber="3255"><td class="num" id="LN3255">3255</td><td class="line">                localHistogram[ptr[x]]++;</td></tr>
<tr class="codeline" data-linenumber="3256"><td class="num" id="LN3256">3256</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3257"><td class="num" id="LN3257">3257</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3258"><td class="num" id="LN3258">3258</td><td class="line">        cv::AutoLock lock(*histogramLock_);</td></tr>
<tr class="codeline" data-linenumber="3259"><td class="num" id="LN3259">3259</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3260"><td class="num" id="LN3260">3260</td><td class="line">        <span class='keyword'>for</span>( <span class='keyword'>int</span> i = 0; i &lt; HIST_SZ; i++ )</td></tr>
<tr class="codeline" data-linenumber="3261"><td class="num" id="LN3261">3261</td><td class="line">            globalHistogram_[i] += localHistogram[i];</td></tr>
<tr class="codeline" data-linenumber="3262"><td class="num" id="LN3262">3262</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3263"><td class="num" id="LN3263">3263</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3264"><td class="num" id="LN3264">3264</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>bool</span> isWorthParallel( <span class='keyword'>const</span> cv::Mat&amp; src )</td></tr>
<tr class="codeline" data-linenumber="3265"><td class="num" id="LN3265">3265</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3266"><td class="num" id="LN3266">3266</td><td class="line">        <span class='keyword'>return</span> ( src.total() &gt;= 640*480 );</td></tr>
<tr class="codeline" data-linenumber="3267"><td class="num" id="LN3267">3267</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3268"><td class="num" id="LN3268">3268</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3269"><td class="num" id="LN3269">3269</td><td class="line"><span class='keyword'>private</span>:</td></tr>
<tr class="codeline" data-linenumber="3270"><td class="num" id="LN3270">3270</td><td class="line">    EqualizeHistCalcHist_Invoker&amp; <span class='keyword'>operator</span>=(<span class='keyword'>const</span> EqualizeHistCalcHist_Invoker&amp;);</td></tr>
<tr class="codeline" data-linenumber="3271"><td class="num" id="LN3271">3271</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3272"><td class="num" id="LN3272">3272</td><td class="line">    cv::Mat&amp; src_;</td></tr>
<tr class="codeline" data-linenumber="3273"><td class="num" id="LN3273">3273</td><td class="line">    <span class='keyword'>int</span>* globalHistogram_;</td></tr>
<tr class="codeline" data-linenumber="3274"><td class="num" id="LN3274">3274</td><td class="line">    cv::Mutex* histogramLock_;</td></tr>
<tr class="codeline" data-linenumber="3275"><td class="num" id="LN3275">3275</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="3276"><td class="num" id="LN3276">3276</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3277"><td class="num" id="LN3277">3277</td><td class="line"><span class='keyword'>class</span> EqualizeHistLut_Invoker : <span class='keyword'>public</span> cv::ParallelLoopBody</td></tr>
<tr class="codeline" data-linenumber="3278"><td class="num" id="LN3278">3278</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3279"><td class="num" id="LN3279">3279</td><td class="line"><span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="3280"><td class="num" id="LN3280">3280</td><td class="line">    EqualizeHistLut_Invoker( cv::Mat&amp; src, cv::Mat&amp; dst, <span class='keyword'>int</span>* lut )</td></tr>
<tr class="codeline" data-linenumber="3281"><td class="num" id="LN3281">3281</td><td class="line">        : src_(src),</td></tr>
<tr class="codeline" data-linenumber="3282"><td class="num" id="LN3282">3282</td><td class="line">          dst_(dst),</td></tr>
<tr class="codeline" data-linenumber="3283"><td class="num" id="LN3283">3283</td><td class="line">          lut_(lut)</td></tr>
<tr class="codeline" data-linenumber="3284"><td class="num" id="LN3284">3284</td><td class="line">    { }</td></tr>
<tr class="codeline" data-linenumber="3285"><td class="num" id="LN3285">3285</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3286"><td class="num" id="LN3286">3286</td><td class="line">    <span class='keyword'>void</span> <span class='keyword'>operator</span>()( <span class='keyword'>const</span> cv::Range&amp; rowRange ) <span class='keyword'>const</span> <span class='macro'>CV_OVERRIDE<span class='macro_popup'>override</span></span></td></tr>
<tr class="codeline" data-linenumber="3287"><td class="num" id="LN3287">3287</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3288"><td class="num" id="LN3288">3288</td><td class="line">        <span class='keyword'>const</span> size_t sstep = src_.step;</td></tr>
<tr class="codeline" data-linenumber="3289"><td class="num" id="LN3289">3289</td><td class="line">        <span class='keyword'>const</span> size_t dstep = dst_.step;</td></tr>
<tr class="codeline" data-linenumber="3290"><td class="num" id="LN3290">3290</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3291"><td class="num" id="LN3291">3291</td><td class="line">        <span class='keyword'>int</span> width = src_.cols;</td></tr>
<tr class="codeline" data-linenumber="3292"><td class="num" id="LN3292">3292</td><td class="line">        <span class='keyword'>int</span> height = rowRange.end - rowRange.start;</td></tr>
<tr class="codeline" data-linenumber="3293"><td class="num" id="LN3293">3293</td><td class="line">        <span class='keyword'>int</span>* lut = lut_;</td></tr>
<tr class="codeline" data-linenumber="3294"><td class="num" id="LN3294">3294</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3295"><td class="num" id="LN3295">3295</td><td class="line">        <span class='keyword'>if</span> (src_.isContinuous() &amp;&amp; dst_.isContinuous())</td></tr>
<tr class="codeline" data-linenumber="3296"><td class="num" id="LN3296">3296</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="3297"><td class="num" id="LN3297">3297</td><td class="line">            width *= height;</td></tr>
<tr class="codeline" data-linenumber="3298"><td class="num" id="LN3298">3298</td><td class="line">            height = 1;</td></tr>
<tr class="codeline" data-linenumber="3299"><td class="num" id="LN3299">3299</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3300"><td class="num" id="LN3300">3300</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3301"><td class="num" id="LN3301">3301</td><td class="line">        <span class='keyword'>const</span> uchar* sptr = src_.ptr&lt;uchar&gt;(rowRange.start);</td></tr>
<tr class="codeline" data-linenumber="3302"><td class="num" id="LN3302">3302</td><td class="line">        uchar* dptr = dst_.ptr&lt;uchar&gt;(rowRange.start);</td></tr>
<tr class="codeline" data-linenumber="3303"><td class="num" id="LN3303">3303</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3304"><td class="num" id="LN3304">3304</td><td class="line">        <span class='keyword'>for</span> (; height--; sptr += sstep, dptr += dstep)</td></tr>
<tr class="codeline" data-linenumber="3305"><td class="num" id="LN3305">3305</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="3306"><td class="num" id="LN3306">3306</td><td class="line">            <span class='keyword'>int</span> x = 0;</td></tr>
<tr class="codeline" data-linenumber="3307"><td class="num" id="LN3307">3307</td><td class="line">            <span class='keyword'>for</span> (; x &lt;= width - 4; x += 4)</td></tr>
<tr class="codeline" data-linenumber="3308"><td class="num" id="LN3308">3308</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="3309"><td class="num" id="LN3309">3309</td><td class="line">                <span class='keyword'>int</span> v0 = sptr[x];</td></tr>
<tr class="codeline" data-linenumber="3310"><td class="num" id="LN3310">3310</td><td class="line">                <span class='keyword'>int</span> v1 = sptr[x+1];</td></tr>
<tr class="codeline" data-linenumber="3311"><td class="num" id="LN3311">3311</td><td class="line">                <span class='keyword'>int</span> x0 = lut[v0];</td></tr>
<tr class="codeline" data-linenumber="3312"><td class="num" id="LN3312">3312</td><td class="line">                <span class='keyword'>int</span> x1 = lut[v1];</td></tr>
<tr class="codeline" data-linenumber="3313"><td class="num" id="LN3313">3313</td><td class="line">                dptr[x] = (uchar)x0;</td></tr>
<tr class="codeline" data-linenumber="3314"><td class="num" id="LN3314">3314</td><td class="line">                dptr[x+1] = (uchar)x1;</td></tr>
<tr class="codeline" data-linenumber="3315"><td class="num" id="LN3315">3315</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3316"><td class="num" id="LN3316">3316</td><td class="line">                v0 = sptr[x+2];</td></tr>
<tr class="codeline" data-linenumber="3317"><td class="num" id="LN3317">3317</td><td class="line">                v1 = sptr[x+3];</td></tr>
<tr class="codeline" data-linenumber="3318"><td class="num" id="LN3318">3318</td><td class="line">                x0 = lut[v0];</td></tr>
<tr class="codeline" data-linenumber="3319"><td class="num" id="LN3319">3319</td><td class="line">                x1 = lut[v1];</td></tr>
<tr class="codeline" data-linenumber="3320"><td class="num" id="LN3320">3320</td><td class="line">                dptr[x+2] = (uchar)x0;</td></tr>
<tr class="codeline" data-linenumber="3321"><td class="num" id="LN3321">3321</td><td class="line">                dptr[x+3] = (uchar)x1;</td></tr>
<tr class="codeline" data-linenumber="3322"><td class="num" id="LN3322">3322</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="3323"><td class="num" id="LN3323">3323</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3324"><td class="num" id="LN3324">3324</td><td class="line">            <span class='keyword'>for</span> (; x &lt; width; ++x)</td></tr>
<tr class="codeline" data-linenumber="3325"><td class="num" id="LN3325">3325</td><td class="line">                dptr[x] = (uchar)lut[sptr[x]];</td></tr>
<tr class="codeline" data-linenumber="3326"><td class="num" id="LN3326">3326</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3327"><td class="num" id="LN3327">3327</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3328"><td class="num" id="LN3328">3328</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3329"><td class="num" id="LN3329">3329</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>bool</span> isWorthParallel( <span class='keyword'>const</span> cv::Mat&amp; src )</td></tr>
<tr class="codeline" data-linenumber="3330"><td class="num" id="LN3330">3330</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3331"><td class="num" id="LN3331">3331</td><td class="line">        <span class='keyword'>return</span> ( src.total() &gt;= 640*480 );</td></tr>
<tr class="codeline" data-linenumber="3332"><td class="num" id="LN3332">3332</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3333"><td class="num" id="LN3333">3333</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3334"><td class="num" id="LN3334">3334</td><td class="line"><span class='keyword'>private</span>:</td></tr>
<tr class="codeline" data-linenumber="3335"><td class="num" id="LN3335">3335</td><td class="line">    EqualizeHistLut_Invoker&amp; <span class='keyword'>operator</span>=(<span class='keyword'>const</span> EqualizeHistLut_Invoker&amp;);</td></tr>
<tr class="codeline" data-linenumber="3336"><td class="num" id="LN3336">3336</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3337"><td class="num" id="LN3337">3337</td><td class="line">    cv::Mat&amp; src_;</td></tr>
<tr class="codeline" data-linenumber="3338"><td class="num" id="LN3338">3338</td><td class="line">    cv::Mat&amp; dst_;</td></tr>
<tr class="codeline" data-linenumber="3339"><td class="num" id="LN3339">3339</td><td class="line">    <span class='keyword'>int</span>* lut_;</td></tr>
<tr class="codeline" data-linenumber="3340"><td class="num" id="LN3340">3340</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="3341"><td class="num" id="LN3341">3341</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3342"><td class="num" id="LN3342">3342</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>void</span> cvEqualizeHist( <span class='keyword'>const</span> CvArr* srcarr, CvArr* dstarr )</td></tr>
<tr class="codeline" data-linenumber="3343"><td class="num" id="LN3343">3343</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3344"><td class="num" id="LN3344">3344</td><td class="line">    cv::equalizeHist(cv::cvarrToMat(srcarr), cv::cvarrToMat(dstarr));</td></tr>
<tr class="codeline" data-linenumber="3345"><td class="num" id="LN3345">3345</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3346"><td class="num" id="LN3346">3346</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3347"><td class="num" id="LN3347">3347</td><td class="line"><span class='directive'>#ifdef HAVE_OPENCL</span></td></tr>
<tr class="codeline" data-linenumber="3348"><td class="num" id="LN3348">3348</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3349"><td class="num" id="LN3349">3349</td><td class="line"><span class='keyword'>namespace</span> cv {</td></tr>
<tr class="codeline" data-linenumber="3350"><td class="num" id="LN3350">3350</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3351"><td class="num" id="LN3351">3351</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>bool</span> ocl_equalizeHist(InputArray _src, OutputArray _dst)</td></tr>
<tr class="codeline" data-linenumber="3352"><td class="num" id="LN3352">3352</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3353"><td class="num" id="LN3353">3353</td><td class="line">    <span class='keyword'>const</span> ocl::Device &amp; dev = ocl::Device::getDefault();</td></tr>
<tr class="codeline" data-linenumber="3354"><td class="num" id="LN3354">3354</td><td class="line">    <span class='keyword'>int</span> compunits = dev.maxComputeUnits();</td></tr>
<tr class="codeline" data-linenumber="3355"><td class="num" id="LN3355">3355</td><td class="line">    size_t wgs = dev.maxWorkGroupSize();</td></tr>
<tr class="codeline" data-linenumber="3356"><td class="num" id="LN3356">3356</td><td class="line">    Size size = _src.size();</td></tr>
<tr class="codeline" data-linenumber="3357"><td class="num" id="LN3357">3357</td><td class="line">    <span class='keyword'>bool</span> use16 = size.width % 16 == 0 &amp;&amp; _src.offset() % 16 == 0 &amp;&amp; _src.step() % 16 == 0;</td></tr>
<tr class="codeline" data-linenumber="3358"><td class="num" id="LN3358">3358</td><td class="line">    <span class='keyword'>int</span> kercn = dev.isAMD() &amp;&amp; use16 ? 16 : std::min(4, ocl::predictOptimalVectorWidth(_src));</td></tr>
<tr class="codeline" data-linenumber="3359"><td class="num" id="LN3359">3359</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3360"><td class="num" id="LN3360">3360</td><td class="line">    ocl::Kernel k1(<span class='string_literal'>"calculate_histogram"</span>, ocl::imgproc::histogram_oclsrc,</td></tr>
<tr class="codeline" data-linenumber="3361"><td class="num" id="LN3361">3361</td><td class="line">                   format(<span class='string_literal'>"-D BINS=%d -D HISTS_COUNT=%d -D WGS=%zu -D kercn=%d -D T=%s%s"</span>,</td></tr>
<tr class="codeline" data-linenumber="3362"><td class="num" id="LN3362">3362</td><td class="line">                          BINS, compunits, wgs, kercn,</td></tr>
<tr class="codeline" data-linenumber="3363"><td class="num" id="LN3363">3363</td><td class="line">                          kercn == 4 ? <span class='string_literal'>"int"</span> : ocl::typeToStr(<span class='macro'>CV_8UC(kercn)<span class='macro_popup'>(((0) &amp; ((1 &lt;&lt; 3) - 1)) + ((((kercn))-1) &lt;&lt; 3<br>))</span></span>),</td></tr>
<tr class="codeline" data-linenumber="3364"><td class="num" id="LN3364">3364</td><td class="line">                          _src.isContinuous() ? <span class='string_literal'>" -D HAVE_SRC_CONT"</span> : <span class='string_literal'>""</span>));</td></tr>
<tr class="codeline" data-linenumber="3365"><td class="num" id="LN3365">3365</td><td class="line">    <span class='keyword'>if</span> (k1.empty())</td></tr>
<tr class="codeline" data-linenumber="3366"><td class="num" id="LN3366">3366</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="3367"><td class="num" id="LN3367">3367</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3368"><td class="num" id="LN3368">3368</td><td class="line">    UMat src = _src.getUMat(), ghist(1, BINS * compunits, <span class='macro'>CV_32SC1<span class='macro_popup'>(((4) &amp; ((1 &lt;&lt; 3) - 1)) + (((1)-1) &lt;&lt; 3))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="3369"><td class="num" id="LN3369">3369</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3370"><td class="num" id="LN3370">3370</td><td class="line">    k1.args(ocl::KernelArg::ReadOnly(src),</td></tr>
<tr class="codeline" data-linenumber="3371"><td class="num" id="LN3371">3371</td><td class="line">            ocl::KernelArg::PtrWriteOnly(ghist), (<span class='keyword'>int</span>)src.total());</td></tr>
<tr class="codeline" data-linenumber="3372"><td class="num" id="LN3372">3372</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3373"><td class="num" id="LN3373">3373</td><td class="line">    size_t globalsize = compunits * wgs;</td></tr>
<tr class="codeline" data-linenumber="3374"><td class="num" id="LN3374">3374</td><td class="line">    <span class='keyword'>if</span> (!k1.run(1, &amp;globalsize, &amp;wgs, <span class='keyword'>false</span>))</td></tr>
<tr class="codeline" data-linenumber="3375"><td class="num" id="LN3375">3375</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="3376"><td class="num" id="LN3376">3376</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3377"><td class="num" id="LN3377">3377</td><td class="line">    wgs = std::min&lt;size_t&gt;(ocl::Device::getDefault().maxWorkGroupSize(), BINS);</td></tr>
<tr class="codeline" data-linenumber="3378"><td class="num" id="LN3378">3378</td><td class="line">    UMat lut(1, 256, <span class='macro'>CV_8UC1<span class='macro_popup'>(((0) &amp; ((1 &lt;&lt; 3) - 1)) + (((1)-1) &lt;&lt; 3))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="3379"><td class="num" id="LN3379">3379</td><td class="line">    ocl::Kernel k2(<span class='string_literal'>"calcLUT"</span>, ocl::imgproc::histogram_oclsrc,</td></tr>
<tr class="codeline" data-linenumber="3380"><td class="num" id="LN3380">3380</td><td class="line">                  format(<span class='string_literal'>"-D BINS=%d -D HISTS_COUNT=%d -D WGS=%d"</span>,</td></tr>
<tr class="codeline" data-linenumber="3381"><td class="num" id="LN3381">3381</td><td class="line">                         BINS, compunits, (<span class='keyword'>int</span>)wgs));</td></tr>
<tr class="codeline" data-linenumber="3382"><td class="num" id="LN3382">3382</td><td class="line">    k2.args(ocl::KernelArg::PtrWriteOnly(lut),</td></tr>
<tr class="codeline" data-linenumber="3383"><td class="num" id="LN3383">3383</td><td class="line">           ocl::KernelArg::PtrReadOnly(ghist), (<span class='keyword'>int</span>)_src.total());</td></tr>
<tr class="codeline" data-linenumber="3384"><td class="num" id="LN3384">3384</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3385"><td class="num" id="LN3385">3385</td><td class="line">    <span class='comment'>// calculation of LUT</span></td></tr>
<tr class="codeline" data-linenumber="3386"><td class="num" id="LN3386">3386</td><td class="line">    <span class='keyword'>if</span> (!k2.run(1, &amp;wgs, &amp;wgs, <span class='keyword'>false</span>))</td></tr>
<tr class="codeline" data-linenumber="3387"><td class="num" id="LN3387">3387</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="3388"><td class="num" id="LN3388">3388</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3389"><td class="num" id="LN3389">3389</td><td class="line">    <span class='comment'>// execute LUT transparently</span></td></tr>
<tr class="codeline" data-linenumber="3390"><td class="num" id="LN3390">3390</td><td class="line">    LUT(_src, lut, _dst);</td></tr>
<tr class="codeline" data-linenumber="3391"><td class="num" id="LN3391">3391</td><td class="line">    <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="3392"><td class="num" id="LN3392">3392</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3393"><td class="num" id="LN3393">3393</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3394"><td class="num" id="LN3394">3394</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3395"><td class="num" id="LN3395">3395</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3396"><td class="num" id="LN3396">3396</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3397"><td class="num" id="LN3397">3397</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3398"><td class="num" id="LN3398">3398</td><td class="line"><span class='directive'>#ifdef HAVE_OPENVX</span></td></tr>
<tr class="codeline" data-linenumber="3399"><td class="num" id="LN3399">3399</td><td class="line"><span class='keyword'>namespace</span> cv</td></tr>
<tr class="codeline" data-linenumber="3400"><td class="num" id="LN3400">3400</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3401"><td class="num" id="LN3401">3401</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>bool</span> openvx_equalize_hist(Mat srcMat, Mat dstMat)</td></tr>
<tr class="codeline" data-linenumber="3402"><td class="num" id="LN3402">3402</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3403"><td class="num" id="LN3403">3403</td><td class="line">    <span class='keyword'>using</span> <span class='keyword'>namespace</span> ivx;</td></tr>
<tr class="codeline" data-linenumber="3404"><td class="num" id="LN3404">3404</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3405"><td class="num" id="LN3405">3405</td><td class="line">    <span class='keyword'>try</span></td></tr>
<tr class="codeline" data-linenumber="3406"><td class="num" id="LN3406">3406</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3407"><td class="num" id="LN3407">3407</td><td class="line">        Context context = ovx::getOpenVXContext();</td></tr>
<tr class="codeline" data-linenumber="3408"><td class="num" id="LN3408">3408</td><td class="line">        Image srcImage = Image::createFromHandle(context, Image::matTypeToFormat(srcMat.type()),</td></tr>
<tr class="codeline" data-linenumber="3409"><td class="num" id="LN3409">3409</td><td class="line">                                                 Image::createAddressing(srcMat), srcMat.data);</td></tr>
<tr class="codeline" data-linenumber="3410"><td class="num" id="LN3410">3410</td><td class="line">        Image dstImage = Image::createFromHandle(context, Image::matTypeToFormat(dstMat.type()),</td></tr>
<tr class="codeline" data-linenumber="3411"><td class="num" id="LN3411">3411</td><td class="line">                                                 Image::createAddressing(dstMat), dstMat.data);</td></tr>
<tr class="codeline" data-linenumber="3412"><td class="num" id="LN3412">3412</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3413"><td class="num" id="LN3413">3413</td><td class="line">        IVX_CHECK_STATUS(vxuEqualizeHist(context, srcImage, dstImage));</td></tr>
<tr class="codeline" data-linenumber="3414"><td class="num" id="LN3414">3414</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3415"><td class="num" id="LN3415">3415</td><td class="line"><span class='directive'>#ifdef VX_VERSION_1_1</span></td></tr>
<tr class="codeline" data-linenumber="3416"><td class="num" id="LN3416">3416</td><td class="line">        <span class='comment'>//we should take user memory back before release</span></td></tr>
<tr class="codeline" data-linenumber="3417"><td class="num" id="LN3417">3417</td><td class="line">        <span class='comment'>//(it's not done automatically according to standard)</span></td></tr>
<tr class="codeline" data-linenumber="3418"><td class="num" id="LN3418">3418</td><td class="line">        srcImage.swapHandle(); dstImage.swapHandle();</td></tr>
<tr class="codeline" data-linenumber="3419"><td class="num" id="LN3419">3419</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3420"><td class="num" id="LN3420">3420</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3421"><td class="num" id="LN3421">3421</td><td class="line">    <span class='keyword'>catch</span> (<span class='keyword'>const</span> RuntimeError &amp; e)</td></tr>
<tr class="codeline" data-linenumber="3422"><td class="num" id="LN3422">3422</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3423"><td class="num" id="LN3423">3423</td><td class="line">        <span class='macro'>VX_DbgThrow(e.what())<span class='macro_popup'>return false</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3424"><td class="num" id="LN3424">3424</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3425"><td class="num" id="LN3425">3425</td><td class="line">    <span class='keyword'>catch</span> (<span class='keyword'>const</span> WrapperError &amp; e)</td></tr>
<tr class="codeline" data-linenumber="3426"><td class="num" id="LN3426">3426</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3427"><td class="num" id="LN3427">3427</td><td class="line">        <span class='macro'>VX_DbgThrow(e.what())<span class='macro_popup'>return false</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3428"><td class="num" id="LN3428">3428</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3429"><td class="num" id="LN3429">3429</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3430"><td class="num" id="LN3430">3430</td><td class="line">    <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="3431"><td class="num" id="LN3431">3431</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3432"><td class="num" id="LN3432">3432</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3433"><td class="num" id="LN3433">3433</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3434"><td class="num" id="LN3434">3434</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3435"><td class="num" id="LN3435">3435</td><td class="line"><span class='keyword'>void</span> cv::equalizeHist( InputArray _src, OutputArray _dst )</td></tr>
<tr class="codeline" data-linenumber="3436"><td class="num" id="LN3436">3436</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3437"><td class="num" id="LN3437">3437</td><td class="line">    <span class='macro'>CV_INSTRUMENT_REGION()<span class='macro_popup'>; static cv::utils::trace::details::Region::LocationExtraData<br>* __cv_trace_location_extra_fn3437 = 0; static const cv::utils<br>::trace::details::Region::LocationStaticStorage __cv_trace_location_fn3437<br> = { &amp;(__cv_trace_location_extra_fn3437), __PRETTY_FUNCTION__<br>, "/home/zhh/projects/opencv-4.5.2/modules/imgproc/src/histogram.cpp"<br>, 3437, ((0) | cv::utils::trace::details::REGION_FLAG_FUNCTION<br>)};; const cv::utils::trace::details::Region __region_fn(__cv_trace_location_fn3437<br>);;</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3438"><td class="num" id="LN3438">3438</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3439"><td class="num" id="LN3439">3439</td><td class="line">    <span class='macro'>CV_Assert( _src.type() == CV_8UC1 )<span class='macro_popup'>do { if (!(_src.type() == (((0) &amp; ((1 &lt;&lt; 3) - 1)) +<br> (((1)-1) &lt;&lt; 3)))) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3440"><td class="num" id="LN3440">3440</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3441"><td class="num" id="LN3441">3441</td><td class="line">    <span class='keyword'>if</span> (_src.empty())</td></tr>
<tr class="codeline" data-linenumber="3442"><td class="num" id="LN3442">3442</td><td class="line">        <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="3443"><td class="num" id="LN3443">3443</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3444"><td class="num" id="LN3444">3444</td><td class="line">    <span class='macro'>CV_OCL_RUN(_src.dims() &lt;= 2 &amp;&amp; _dst.isUMat(),<span class='macro_popup'>try { if (cv::ocl::isOpenCLActivated() &amp;&amp; (_src.dims(<br>) &lt;= 2 &amp;&amp; _dst.isUMat()) &amp;&amp; ocl_equalizeHist<br>(_src, _dst)) { ; return ; } } catch (const cv::Exception&amp;<br> e) { (void)e; }</span></span></td></tr>
<tr class="codeline" data-linenumber="3445"><td class="num" id="LN3445">3445</td><td class="line">               <span class='macro'>ocl_equalizeHist(_src, _dst))<span class='macro_popup'>try { if (cv::ocl::isOpenCLActivated() &amp;&amp; (_src.dims(<br>) &lt;= 2 &amp;&amp; _dst.isUMat()) &amp;&amp; ocl_equalizeHist<br>(_src, _dst)) { ; return ; } } catch (const cv::Exception&amp;<br> e) { (void)e; }</span></span></td></tr>
<tr class="codeline" data-linenumber="3446"><td class="num" id="LN3446">3446</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3447"><td class="num" id="LN3447">3447</td><td class="line">    Mat src = _src.getMat();</td></tr>
<tr class="codeline" data-linenumber="3448"><td class="num" id="LN3448">3448</td><td class="line">    _dst.create( src.size(), src.type() );</td></tr>
<tr class="codeline" data-linenumber="3449"><td class="num" id="LN3449">3449</td><td class="line">    Mat dst = _dst.getMat();</td></tr>
<tr class="codeline" data-linenumber="3450"><td class="num" id="LN3450">3450</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3451"><td class="num" id="LN3451">3451</td><td class="line">    CV_OVX_RUN(!ovx::skipSmallImages&lt;VX_KERNEL_EQUALIZE_HISTOGRAM&gt;(src.cols, src.rows),</td></tr>
<tr class="codeline" data-linenumber="3452"><td class="num" id="LN3452">3452</td><td class="line">               openvx_equalize_hist(src, dst))</td></tr>
<tr class="codeline" data-linenumber="3453"><td class="num" id="LN3453">3453</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3454"><td class="num" id="LN3454">3454</td><td class="line">    Mutex histogramLockInstance;</td></tr>
<tr class="codeline" data-linenumber="3455"><td class="num" id="LN3455">3455</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3456"><td class="num" id="LN3456">3456</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>int</span> hist_sz = EqualizeHistCalcHist_Invoker::HIST_SZ;</td></tr>
<tr class="codeline" data-linenumber="3457"><td class="num" id="LN3457">3457</td><td class="line">    <span class='keyword'>int</span> hist[hist_sz] = {0,};</td></tr>
<tr class="codeline" data-linenumber="3458"><td class="num" id="LN3458">3458</td><td class="line">    <span class='keyword'>int</span> lut[hist_sz];</td></tr>
<tr class="codeline" data-linenumber="3459"><td class="num" id="LN3459">3459</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3460"><td class="num" id="LN3460">3460</td><td class="line">    EqualizeHistCalcHist_Invoker calcBody(src, hist, &amp;histogramLockInstance);</td></tr>
<tr class="codeline" data-linenumber="3461"><td class="num" id="LN3461">3461</td><td class="line">    EqualizeHistLut_Invoker      lutBody(src, dst, lut);</td></tr>
<tr class="codeline" data-linenumber="3462"><td class="num" id="LN3462">3462</td><td class="line">    cv::Range heightRange(0, src.rows);</td></tr>
<tr class="codeline" data-linenumber="3463"><td class="num" id="LN3463">3463</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3464"><td class="num" id="LN3464">3464</td><td class="line">    <span class='keyword'>if</span>(EqualizeHistCalcHist_Invoker::isWorthParallel(src))</td></tr>
<tr class="codeline" data-linenumber="3465"><td class="num" id="LN3465">3465</td><td class="line">        parallel_for_(heightRange, calcBody);</td></tr>
<tr class="codeline" data-linenumber="3466"><td class="num" id="LN3466">3466</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3467"><td class="num" id="LN3467">3467</td><td class="line">        calcBody(heightRange);</td></tr>
<tr class="codeline" data-linenumber="3468"><td class="num" id="LN3468">3468</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3469"><td class="num" id="LN3469">3469</td><td class="line">    <span class='keyword'>int</span> i = 0;</td></tr>
<tr class="codeline" data-linenumber="3470"><td class="num" id="LN3470">3470</td><td class="line">    <span class='keyword'>while</span> (!hist[i]) ++i;</td></tr>
<tr class="codeline" data-linenumber="3471"><td class="num" id="LN3471">3471</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3472"><td class="num" id="LN3472">3472</td><td class="line">    <span class='keyword'>int</span> total = (<span class='keyword'>int</span>)src.total();</td></tr>
<tr class="codeline" data-linenumber="3473"><td class="num" id="LN3473">3473</td><td class="line">    <span class='keyword'>if</span> (hist[i] == total)</td></tr>
<tr class="codeline" data-linenumber="3474"><td class="num" id="LN3474">3474</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3475"><td class="num" id="LN3475">3475</td><td class="line">        dst.setTo(i);</td></tr>
<tr class="codeline" data-linenumber="3476"><td class="num" id="LN3476">3476</td><td class="line">        <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="3477"><td class="num" id="LN3477">3477</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3478"><td class="num" id="LN3478">3478</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3479"><td class="num" id="LN3479">3479</td><td class="line">    <span class='keyword'>float</span> scale = (hist_sz - 1.f)/(total - hist[i]);</td></tr>
<tr class="codeline" data-linenumber="3480"><td class="num" id="LN3480">3480</td><td class="line">    <span class='keyword'>int</span> sum = 0;</td></tr>
<tr class="codeline" data-linenumber="3481"><td class="num" id="LN3481">3481</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3482"><td class="num" id="LN3482">3482</td><td class="line">    <span class='keyword'>for</span> (lut[i++] = 0; i &lt; hist_sz; ++i)</td></tr>
<tr class="codeline" data-linenumber="3483"><td class="num" id="LN3483">3483</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3484"><td class="num" id="LN3484">3484</td><td class="line">        sum += hist[i];</td></tr>
<tr class="codeline" data-linenumber="3485"><td class="num" id="LN3485">3485</td><td class="line">        lut[i] = saturate_cast&lt;uchar&gt;(sum * scale);</td></tr>
<tr class="codeline" data-linenumber="3486"><td class="num" id="LN3486">3486</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3487"><td class="num" id="LN3487">3487</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3488"><td class="num" id="LN3488">3488</td><td class="line">    <span class='keyword'>if</span>(EqualizeHistLut_Invoker::isWorthParallel(src))</td></tr>
<tr class="codeline" data-linenumber="3489"><td class="num" id="LN3489">3489</td><td class="line">        parallel_for_(heightRange, lutBody);</td></tr>
<tr class="codeline" data-linenumber="3490"><td class="num" id="LN3490">3490</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3491"><td class="num" id="LN3491">3491</td><td class="line">        lutBody(heightRange);</td></tr>
<tr class="codeline" data-linenumber="3492"><td class="num" id="LN3492">3492</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3493"><td class="num" id="LN3493">3493</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3494"><td class="num" id="LN3494">3494</td><td class="line"><span class='directive'>#if 0</span></td></tr>
<tr class="codeline" data-linenumber="3495"><td class="num" id="LN3495">3495</td><td class="line"><span class='comment'>// ----------------------------------------------------------------------</span></td></tr>
<tr class="codeline" data-linenumber="3496"><td class="num" id="LN3496">3496</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3497"><td class="num" id="LN3497">3497</td><td class="line"><span class='comment'>/* Implementation of RTTI and Generic Functions for CvHistogram */</span></td></tr>
<tr class="codeline" data-linenumber="3498"><td class="num" id="LN3498">3498</td><td class="line"><span class='directive'>#define CV_TYPE_NAME_HIST "opencv-hist"</span></td></tr>
<tr class="codeline" data-linenumber="3499"><td class="num" id="LN3499">3499</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3500"><td class="num" id="LN3500">3500</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> icvIsHist( <span class='keyword'>const</span> <span class='keyword'>void</span> * ptr )</td></tr>
<tr class="codeline" data-linenumber="3501"><td class="num" id="LN3501">3501</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3502"><td class="num" id="LN3502">3502</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>CV_IS_HIST( ((CvHistogram*)ptr) )<span class='macro_popup'>((((CvHistogram*)ptr)) != __null &amp;&amp; (((CvHistogram*)(<br>((CvHistogram*)ptr)))-&gt;type &amp; 0xFFFF0000) == 0x42450000<br> &amp;&amp; (((CvHistogram*)ptr))-&gt;bins != __null)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3503"><td class="num" id="LN3503">3503</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3504"><td class="num" id="LN3504">3504</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3505"><td class="num" id="LN3505">3505</td><td class="line"><span class='keyword'>static</span> CvHistogram * icvCloneHist( <span class='keyword'>const</span> CvHistogram * src )</td></tr>
<tr class="codeline" data-linenumber="3506"><td class="num" id="LN3506">3506</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3507"><td class="num" id="LN3507">3507</td><td class="line">    CvHistogram * dst=<span class='macro'>NULL<span class='macro_popup'>__null</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3508"><td class="num" id="LN3508">3508</td><td class="line">    cvCopyHist(src, &amp;dst);</td></tr>
<tr class="codeline" data-linenumber="3509"><td class="num" id="LN3509">3509</td><td class="line">    <span class='keyword'>return</span> dst;</td></tr>
<tr class="codeline" data-linenumber="3510"><td class="num" id="LN3510">3510</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3511"><td class="num" id="LN3511">3511</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3512"><td class="num" id="LN3512">3512</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> *icvReadHist( CvFileStorage * fs, CvFileNode * node )</td></tr>
<tr class="codeline" data-linenumber="3513"><td class="num" id="LN3513">3513</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3514"><td class="num" id="LN3514">3514</td><td class="line">    CvHistogram * h = 0;</td></tr>
<tr class="codeline" data-linenumber="3515"><td class="num" id="LN3515">3515</td><td class="line">    <span class='keyword'>int</span> type = 0;</td></tr>
<tr class="codeline" data-linenumber="3516"><td class="num" id="LN3516">3516</td><td class="line">    <span class='keyword'>int</span> is_uniform = 0;</td></tr>
<tr class="codeline" data-linenumber="3517"><td class="num" id="LN3517">3517</td><td class="line">    <span class='keyword'>int</span> have_ranges = 0;</td></tr>
<tr class="codeline" data-linenumber="3518"><td class="num" id="LN3518">3518</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3519"><td class="num" id="LN3519">3519</td><td class="line">    h = (CvHistogram *)cvAlloc( <span class='keyword'>sizeof</span>(CvHistogram) );</td></tr>
<tr class="codeline" data-linenumber="3520"><td class="num" id="LN3520">3520</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3521"><td class="num" id="LN3521">3521</td><td class="line">    type = cvReadIntByName( fs, node, <span class='string_literal'>"type"</span>, 0 );</td></tr>
<tr class="codeline" data-linenumber="3522"><td class="num" id="LN3522">3522</td><td class="line">    is_uniform = cvReadIntByName( fs, node, <span class='string_literal'>"is_uniform"</span>, 0 );</td></tr>
<tr class="codeline" data-linenumber="3523"><td class="num" id="LN3523">3523</td><td class="line">    have_ranges = cvReadIntByName( fs, node, <span class='string_literal'>"have_ranges"</span>, 0 );</td></tr>
<tr class="codeline" data-linenumber="3524"><td class="num" id="LN3524">3524</td><td class="line">    h-&gt;type = <span class='macro'>CV_HIST_MAGIC_VAL<span class='macro_popup'>0x42450000</span></span> | type |</td></tr>
<tr class="codeline" data-linenumber="3525"><td class="num" id="LN3525">3525</td><td class="line">        (is_uniform ? <span class='macro'>CV_HIST_UNIFORM_FLAG<span class='macro_popup'>(1 &lt;&lt; 10)</span></span> : 0) |</td></tr>
<tr class="codeline" data-linenumber="3526"><td class="num" id="LN3526">3526</td><td class="line">        (have_ranges ? <span class='macro'>CV_HIST_RANGES_FLAG<span class='macro_popup'>(1 &lt;&lt; 11)</span></span> : 0);</td></tr>
<tr class="codeline" data-linenumber="3527"><td class="num" id="LN3527">3527</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3528"><td class="num" id="LN3528">3528</td><td class="line">    <span class='keyword'>if</span>(type == <span class='macro'>CV_HIST_ARRAY<span class='macro_popup'>0</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3529"><td class="num" id="LN3529">3529</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3530"><td class="num" id="LN3530">3530</td><td class="line">        <span class='comment'>// read histogram bins</span></td></tr>
<tr class="codeline" data-linenumber="3531"><td class="num" id="LN3531">3531</td><td class="line">        CvMatND* mat = (CvMatND*)cvReadByName( fs, node, <span class='string_literal'>"mat"</span> );</td></tr>
<tr class="codeline" data-linenumber="3532"><td class="num" id="LN3532">3532</td><td class="line">        <span class='keyword'>int</span> i, sizes[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>];</td></tr>
<tr class="codeline" data-linenumber="3533"><td class="num" id="LN3533">3533</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3534"><td class="num" id="LN3534">3534</td><td class="line">        <span class='keyword'>if</span>(!<span class='macro'>CV_IS_MATND(mat)<span class='macro_popup'>(((mat) != __null &amp;&amp; (((const CvMatND*)(mat))-&gt;type<br> &amp; 0xFFFF0000) == 0x42430000) &amp;&amp; ((const CvMatND*<br>)(mat))-&gt;data.ptr != __null)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3535"><td class="num" id="LN3535">3535</td><td class="line">            <span class='macro'>CV_Error( CV_StsError, <span class='string_literal'>"Expected CvMatND"</span>)<span class='macro_popup'>do { (void)(CV_StsError); (void)("Expected CvMatND"); abort()<br>; } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3536"><td class="num" id="LN3536">3536</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3537"><td class="num" id="LN3537">3537</td><td class="line">        <span class='keyword'>for</span>(i=0; i&lt;mat-&gt;dims; i++)</td></tr>
<tr class="codeline" data-linenumber="3538"><td class="num" id="LN3538">3538</td><td class="line">            sizes[i] = mat-&gt;dim[i].size;</td></tr>
<tr class="codeline" data-linenumber="3539"><td class="num" id="LN3539">3539</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3540"><td class="num" id="LN3540">3540</td><td class="line">        cvInitMatNDHeader( &amp;(h-&gt;mat), mat-&gt;dims, sizes, mat-&gt;type, mat-&gt;data.ptr );</td></tr>
<tr class="codeline" data-linenumber="3541"><td class="num" id="LN3541">3541</td><td class="line">        h-&gt;bins = &amp;(h-&gt;mat);</td></tr>
<tr class="codeline" data-linenumber="3542"><td class="num" id="LN3542">3542</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3543"><td class="num" id="LN3543">3543</td><td class="line">        <span class='comment'>// take ownership of refcount pointer as well</span></td></tr>
<tr class="codeline" data-linenumber="3544"><td class="num" id="LN3544">3544</td><td class="line">        h-&gt;mat.refcount = mat-&gt;refcount;</td></tr>
<tr class="codeline" data-linenumber="3545"><td class="num" id="LN3545">3545</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3546"><td class="num" id="LN3546">3546</td><td class="line">        <span class='comment'>// increase refcount so freeing temp header doesn't free data</span></td></tr>
<tr class="codeline" data-linenumber="3547"><td class="num" id="LN3547">3547</td><td class="line">        cvIncRefData( mat );</td></tr>
<tr class="codeline" data-linenumber="3548"><td class="num" id="LN3548">3548</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3549"><td class="num" id="LN3549">3549</td><td class="line">        <span class='comment'>// free temporary header</span></td></tr>
<tr class="codeline" data-linenumber="3550"><td class="num" id="LN3550">3550</td><td class="line">        cvReleaseMatND( &amp;mat );</td></tr>
<tr class="codeline" data-linenumber="3551"><td class="num" id="LN3551">3551</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3552"><td class="num" id="LN3552">3552</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3553"><td class="num" id="LN3553">3553</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3554"><td class="num" id="LN3554">3554</td><td class="line">        h-&gt;bins = cvReadByName( fs, node, <span class='string_literal'>"bins"</span> );</td></tr>
<tr class="codeline" data-linenumber="3555"><td class="num" id="LN3555">3555</td><td class="line">        <span class='keyword'>if</span>(!<span class='macro'>CV_IS_SPARSE_MAT(h-&gt;bins)<span class='macro_popup'>((h-&gt;bins) != __null &amp;&amp; (((const CvSparseMat*)(h-&gt;<br>bins))-&gt;type &amp; 0xFFFF0000) == 0x42440000)</span></span>){</td></tr>
<tr class="codeline" data-linenumber="3556"><td class="num" id="LN3556">3556</td><td class="line">            <span class='macro'>CV_Error( CV_StsError, <span class='string_literal'>"Unknown Histogram type"</span>)<span class='macro_popup'>do { (void)(CV_StsError); (void)("Unknown Histogram type"); abort<br>(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3557"><td class="num" id="LN3557">3557</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3558"><td class="num" id="LN3558">3558</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3559"><td class="num" id="LN3559">3559</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3560"><td class="num" id="LN3560">3560</td><td class="line">    <span class='comment'>// read thresholds</span></td></tr>
<tr class="codeline" data-linenumber="3561"><td class="num" id="LN3561">3561</td><td class="line">    <span class='keyword'>if</span>(have_ranges)</td></tr>
<tr class="codeline" data-linenumber="3562"><td class="num" id="LN3562">3562</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3563"><td class="num" id="LN3563">3563</td><td class="line">        <span class='keyword'>int</span> i, dims, size[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>], total = 0;</td></tr>
<tr class="codeline" data-linenumber="3564"><td class="num" id="LN3564">3564</td><td class="line">        CvSeqReader reader;</td></tr>
<tr class="codeline" data-linenumber="3565"><td class="num" id="LN3565">3565</td><td class="line">        CvFileNode * thresh_node;</td></tr>
<tr class="codeline" data-linenumber="3566"><td class="num" id="LN3566">3566</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3567"><td class="num" id="LN3567">3567</td><td class="line">        dims = cvGetDims( h-&gt;bins, size );</td></tr>
<tr class="codeline" data-linenumber="3568"><td class="num" id="LN3568">3568</td><td class="line">        <span class='keyword'>for</span>( i = 0; i &lt; dims; i++ )</td></tr>
<tr class="codeline" data-linenumber="3569"><td class="num" id="LN3569">3569</td><td class="line">            total += size[i]+1;</td></tr>
<tr class="codeline" data-linenumber="3570"><td class="num" id="LN3570">3570</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3571"><td class="num" id="LN3571">3571</td><td class="line">        thresh_node = cvGetFileNodeByName( fs, node, <span class='string_literal'>"thresh"</span> );</td></tr>
<tr class="codeline" data-linenumber="3572"><td class="num" id="LN3572">3572</td><td class="line">        <span class='keyword'>if</span>(!thresh_node)</td></tr>
<tr class="codeline" data-linenumber="3573"><td class="num" id="LN3573">3573</td><td class="line">            <span class='macro'>CV_Error( CV_StsError, <span class='string_literal'>"'thresh' node is missing"</span>)<span class='macro_popup'>do { (void)(CV_StsError); (void)("'thresh' node is missing");<br> abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3574"><td class="num" id="LN3574">3574</td><td class="line">        cvStartReadRawData( fs, thresh_node, &amp;reader );</td></tr>
<tr class="codeline" data-linenumber="3575"><td class="num" id="LN3575">3575</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3576"><td class="num" id="LN3576">3576</td><td class="line">        <span class='keyword'>if</span>(is_uniform)</td></tr>
<tr class="codeline" data-linenumber="3577"><td class="num" id="LN3577">3577</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="3578"><td class="num" id="LN3578">3578</td><td class="line">            <span class='keyword'>for</span>(i=0; i&lt;dims; i++)</td></tr>
<tr class="codeline" data-linenumber="3579"><td class="num" id="LN3579">3579</td><td class="line">                cvReadRawDataSlice( fs, &amp;reader, 2, h-&gt;thresh[i], <span class='string_literal'>"f"</span> );</td></tr>
<tr class="codeline" data-linenumber="3580"><td class="num" id="LN3580">3580</td><td class="line">            h-&gt;thresh2 = <span class='macro'>NULL<span class='macro_popup'>__null</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3581"><td class="num" id="LN3581">3581</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3582"><td class="num" id="LN3582">3582</td><td class="line">        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3583"><td class="num" id="LN3583">3583</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="3584"><td class="num" id="LN3584">3584</td><td class="line">            <span class='keyword'>float</span>* dim_ranges;</td></tr>
<tr class="codeline" data-linenumber="3585"><td class="num" id="LN3585">3585</td><td class="line">            h-&gt;thresh2 = (<span class='keyword'>float</span>**)cvAlloc(</td></tr>
<tr class="codeline" data-linenumber="3586"><td class="num" id="LN3586">3586</td><td class="line">                dims*<span class='keyword'>sizeof</span>(h-&gt;thresh2[0])+</td></tr>
<tr class="codeline" data-linenumber="3587"><td class="num" id="LN3587">3587</td><td class="line">                total*<span class='keyword'>sizeof</span>(h-&gt;thresh2[0][0]));</td></tr>
<tr class="codeline" data-linenumber="3588"><td class="num" id="LN3588">3588</td><td class="line">            dim_ranges = (<span class='keyword'>float</span>*)(h-&gt;thresh2 + dims);</td></tr>
<tr class="codeline" data-linenumber="3589"><td class="num" id="LN3589">3589</td><td class="line">            <span class='keyword'>for</span>(i=0; i &lt; dims; i++)</td></tr>
<tr class="codeline" data-linenumber="3590"><td class="num" id="LN3590">3590</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="3591"><td class="num" id="LN3591">3591</td><td class="line">                h-&gt;thresh2[i] = dim_ranges;</td></tr>
<tr class="codeline" data-linenumber="3592"><td class="num" id="LN3592">3592</td><td class="line">                cvReadRawDataSlice( fs, &amp;reader, size[i]+1, dim_ranges, <span class='string_literal'>"f"</span> );</td></tr>
<tr class="codeline" data-linenumber="3593"><td class="num" id="LN3593">3593</td><td class="line">                dim_ranges += size[i] + 1;</td></tr>
<tr class="codeline" data-linenumber="3594"><td class="num" id="LN3594">3594</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="3595"><td class="num" id="LN3595">3595</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3596"><td class="num" id="LN3596">3596</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3597"><td class="num" id="LN3597">3597</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3598"><td class="num" id="LN3598">3598</td><td class="line">    <span class='keyword'>return</span> h;</td></tr>
<tr class="codeline" data-linenumber="3599"><td class="num" id="LN3599">3599</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3600"><td class="num" id="LN3600">3600</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3601"><td class="num" id="LN3601">3601</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> icvWriteHist( CvFileStorage* fs, <span class='keyword'>const</span> <span class='keyword'>char</span>* name,</td></tr>
<tr class="codeline" data-linenumber="3602"><td class="num" id="LN3602">3602</td><td class="line">                          <span class='keyword'>const</span> <span class='keyword'>void</span>* struct_ptr, CvAttrList <span class='comment'>/*attributes*/</span> )</td></tr>
<tr class="codeline" data-linenumber="3603"><td class="num" id="LN3603">3603</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3604"><td class="num" id="LN3604">3604</td><td class="line">    <span class='keyword'>const</span> CvHistogram * hist = (<span class='keyword'>const</span> CvHistogram *) struct_ptr;</td></tr>
<tr class="codeline" data-linenumber="3605"><td class="num" id="LN3605">3605</td><td class="line">    <span class='keyword'>int</span> sizes[<span class='macro'>CV_MAX_DIM<span class='macro_popup'>32</span></span>];</td></tr>
<tr class="codeline" data-linenumber="3606"><td class="num" id="LN3606">3606</td><td class="line">    <span class='keyword'>int</span> dims;</td></tr>
<tr class="codeline" data-linenumber="3607"><td class="num" id="LN3607">3607</td><td class="line">    <span class='keyword'>int</span> i;</td></tr>
<tr class="codeline" data-linenumber="3608"><td class="num" id="LN3608">3608</td><td class="line">    <span class='keyword'>int</span> is_uniform, have_ranges;</td></tr>
<tr class="codeline" data-linenumber="3609"><td class="num" id="LN3609">3609</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3610"><td class="num" id="LN3610">3610</td><td class="line">    cvStartWriteStruct( fs, name, CV_NODE_MAP, CV_TYPE_NAME_HIST );</td></tr>
<tr class="codeline" data-linenumber="3611"><td class="num" id="LN3611">3611</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3612"><td class="num" id="LN3612">3612</td><td class="line">    is_uniform = (<span class='macro'>CV_IS_UNIFORM_HIST(hist)<span class='macro_popup'>(((hist)-&gt;type &amp; (1 &lt;&lt; 10)) != 0)</span></span> ? 1 : 0);</td></tr>
<tr class="codeline" data-linenumber="3613"><td class="num" id="LN3613">3613</td><td class="line">    have_ranges = (hist-&gt;type &amp; <span class='macro'>CV_HIST_RANGES_FLAG<span class='macro_popup'>(1 &lt;&lt; 11)</span></span> ? 1 : 0);</td></tr>
<tr class="codeline" data-linenumber="3614"><td class="num" id="LN3614">3614</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3615"><td class="num" id="LN3615">3615</td><td class="line">    cvWriteInt( fs, <span class='string_literal'>"type"</span>, (hist-&gt;type &amp; 1) );</td></tr>
<tr class="codeline" data-linenumber="3616"><td class="num" id="LN3616">3616</td><td class="line">    cvWriteInt( fs, <span class='string_literal'>"is_uniform"</span>, is_uniform );</td></tr>
<tr class="codeline" data-linenumber="3617"><td class="num" id="LN3617">3617</td><td class="line">    cvWriteInt( fs, <span class='string_literal'>"have_ranges"</span>, have_ranges );</td></tr>
<tr class="codeline" data-linenumber="3618"><td class="num" id="LN3618">3618</td><td class="line">    <span class='keyword'>if</span>(!<span class='macro'>CV_IS_SPARSE_HIST(hist)<span class='macro_popup'>(((hist)-&gt;bins) != __null &amp;&amp; (((const CvSparseMat*<br>)((hist)-&gt;bins))-&gt;type &amp; 0xFFFF0000) == 0x42440000)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3619"><td class="num" id="LN3619">3619</td><td class="line">        cvWrite( fs, <span class='string_literal'>"mat"</span>, &amp;(hist-&gt;mat) );</td></tr>
<tr class="codeline" data-linenumber="3620"><td class="num" id="LN3620">3620</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3621"><td class="num" id="LN3621">3621</td><td class="line">        cvWrite( fs, <span class='string_literal'>"bins"</span>, hist-&gt;bins );</td></tr>
<tr class="codeline" data-linenumber="3622"><td class="num" id="LN3622">3622</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3623"><td class="num" id="LN3623">3623</td><td class="line">    <span class='comment'>// write thresholds</span></td></tr>
<tr class="codeline" data-linenumber="3624"><td class="num" id="LN3624">3624</td><td class="line">    <span class='keyword'>if</span>(have_ranges){</td></tr>
<tr class="codeline" data-linenumber="3625"><td class="num" id="LN3625">3625</td><td class="line">        dims = cvGetDims( hist-&gt;bins, sizes );</td></tr>
<tr class="codeline" data-linenumber="3626"><td class="num" id="LN3626">3626</td><td class="line">        cvStartWriteStruct( fs, <span class='string_literal'>"thresh"</span>, CV_NODE_SEQ + CV_NODE_FLOW );</td></tr>
<tr class="codeline" data-linenumber="3627"><td class="num" id="LN3627">3627</td><td class="line">        <span class='keyword'>if</span>(is_uniform){</td></tr>
<tr class="codeline" data-linenumber="3628"><td class="num" id="LN3628">3628</td><td class="line">            <span class='keyword'>for</span>(i=0; i&lt;dims; i++){</td></tr>
<tr class="codeline" data-linenumber="3629"><td class="num" id="LN3629">3629</td><td class="line">                cvWriteRawData( fs, hist-&gt;thresh[i], 2, <span class='string_literal'>"f"</span> );</td></tr>
<tr class="codeline" data-linenumber="3630"><td class="num" id="LN3630">3630</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="3631"><td class="num" id="LN3631">3631</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3632"><td class="num" id="LN3632">3632</td><td class="line">        <span class='keyword'>else</span>{</td></tr>
<tr class="codeline" data-linenumber="3633"><td class="num" id="LN3633">3633</td><td class="line">            <span class='keyword'>for</span>(i=0; i&lt;dims; i++){</td></tr>
<tr class="codeline" data-linenumber="3634"><td class="num" id="LN3634">3634</td><td class="line">                cvWriteRawData( fs, hist-&gt;thresh2[i], sizes[i]+1, <span class='string_literal'>"f"</span> );</td></tr>
<tr class="codeline" data-linenumber="3635"><td class="num" id="LN3635">3635</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="3636"><td class="num" id="LN3636">3636</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3637"><td class="num" id="LN3637">3637</td><td class="line">        cvEndWriteStruct( fs );</td></tr>
<tr class="codeline" data-linenumber="3638"><td class="num" id="LN3638">3638</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3639"><td class="num" id="LN3639">3639</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3640"><td class="num" id="LN3640">3640</td><td class="line">    cvEndWriteStruct( fs );</td></tr>
<tr class="codeline" data-linenumber="3641"><td class="num" id="LN3641">3641</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3642"><td class="num" id="LN3642">3642</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3643"><td class="num" id="LN3643">3643</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3644"><td class="num" id="LN3644">3644</td><td class="line">CvType hist_type( CV_TYPE_NAME_HIST, icvIsHist, (CvReleaseFunc)cvReleaseHist,</td></tr>
<tr class="codeline" data-linenumber="3645"><td class="num" id="LN3645">3645</td><td class="line">                  icvReadHist, icvWriteHist, (CvCloneFunc)icvCloneHist );</td></tr>
<tr class="codeline" data-linenumber="3646"><td class="num" id="LN3646">3646</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3647"><td class="num" id="LN3647">3647</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3648"><td class="num" id="LN3648">3648</td><td class="line"><span class='comment'>/* End of file. */</span></td></tr>
</table><hr class=divider>
<div id=File56205>
<div class=FileNav><a href="#File1">&#x2190;</a></div><h4 class=FileName>/home/zhh/projects/opencv-4.5.2/modules/core/include/opencv2/core/utils/tls.hpp</h4>
<div class=FileNav><a href="#File64471">&#x2192;</a></div></div>
<table class="code" data-fileid="56205">
<tr class="codeline" data-linenumber="1"><td class="num" id="LN1">1</td><td class="line"><span class='comment'>// This file is part of OpenCV project.</span></td></tr>
<tr class="codeline" data-linenumber="2"><td class="num" id="LN2">2</td><td class="line"><span class='comment'>// It is subject to the license terms in the LICENSE file found in the top-level directory</span></td></tr>
<tr class="codeline" data-linenumber="3"><td class="num" id="LN3">3</td><td class="line"><span class='comment'>// of this distribution and at http://opencv.org/license.html.</span></td></tr>
<tr class="codeline" data-linenumber="4"><td class="num" id="LN4">4</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="5"><td class="num" id="LN5">5</td><td class="line"><span class='directive'>#ifndef OPENCV_UTILS_TLS_HPP</span></td></tr>
<tr class="codeline" data-linenumber="6"><td class="num" id="LN6">6</td><td class="line"><span class='directive'>#define OPENCV_UTILS_TLS_HPP</span></td></tr>
<tr class="codeline" data-linenumber="7"><td class="num" id="LN7">7</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="8"><td class="num" id="LN8">8</td><td class="line"><span class='directive'>#ifndef OPENCV_CORE_UTILITY_H</span></td></tr>
<tr class="codeline" data-linenumber="9"><td class="num" id="LN9">9</td><td class="line"><span class='directive'>#error "tls.hpp must be included after opencv2/core/utility.hpp or opencv2/core.hpp"</span></td></tr>
<tr class="codeline" data-linenumber="10"><td class="num" id="LN10">10</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="11"><td class="num" id="LN11">11</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="12"><td class="num" id="LN12">12</td><td class="line"><span class='keyword'>namespace</span> cv {</td></tr>
<tr class="codeline" data-linenumber="13"><td class="num" id="LN13">13</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="14"><td class="num" id="LN14">14</td><td class="line"><span class='comment'>//! @addtogroup core_utils</span></td></tr>
<tr class="codeline" data-linenumber="15"><td class="num" id="LN15">15</td><td class="line"><span class='comment'>//! @{</span></td></tr>
<tr class="codeline" data-linenumber="16"><td class="num" id="LN16">16</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="17"><td class="num" id="LN17">17</td><td class="line"><span class='keyword'>namespace</span> details { <span class='keyword'>class</span> TlsStorage; }</td></tr>
<tr class="codeline" data-linenumber="18"><td class="num" id="LN18">18</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="19"><td class="num" id="LN19">19</td><td class="line"><span class='comment'>/** TLS container base implementation</span></td></tr>
<tr class="codeline" data-linenumber="20"><td class="num" id="LN20">20</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="21"><td class="num" id="LN21">21</td><td class="line"> <span class='comment'>* Don't use directly.</span></td></tr>
<tr class="codeline" data-linenumber="22"><td class="num" id="LN22">22</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="23"><td class="num" id="LN23">23</td><td class="line"> <span class='comment'>* @sa TLSData, TLSDataAccumulator templates</span></td></tr>
<tr class="codeline" data-linenumber="24"><td class="num" id="LN24">24</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="25"><td class="num" id="LN25">25</td><td class="line"><span class='keyword'>class</span> <span class='macro'>CV_EXPORTS<span class='macro_popup'>__attribute__ ((visibility ("default")))</span></span> TLSDataContainer</td></tr>
<tr class="codeline" data-linenumber="26"><td class="num" id="LN26">26</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="27"><td class="num" id="LN27">27</td><td class="line"><span class='keyword'>protected</span>:</td></tr>
<tr class="codeline" data-linenumber="28"><td class="num" id="LN28">28</td><td class="line">    TLSDataContainer();</td></tr>
<tr class="codeline" data-linenumber="29"><td class="num" id="LN29">29</td><td class="line">    <span class='keyword'>virtual</span> ~TLSDataContainer();</td></tr>
<tr class="codeline" data-linenumber="30"><td class="num" id="LN30">30</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="31"><td class="num" id="LN31">31</td><td class="line">    <span class='comment'>/// @deprecated use detachData() instead</span></td></tr>
<tr class="codeline" data-linenumber="32"><td class="num" id="LN32">32</td><td class="line">    <span class='keyword'>void</span>  gatherData(std::vector&lt;<span class='keyword'>void</span>*&gt; &amp;data) <span class='keyword'>const</span>;</td></tr>
<tr class="codeline" data-linenumber="33"><td class="num" id="LN33">33</td><td class="line">    <span class='comment'>/// get TLS data and detach all data from threads (similar to cleanup() call)</span></td></tr>
<tr class="codeline" data-linenumber="34"><td class="num" id="LN34">34</td><td class="line">    <span class='keyword'>void</span>  detachData(std::vector&lt;<span class='keyword'>void</span>*&gt;&amp; data);</td></tr>
<tr class="codeline" data-linenumber="35"><td class="num" id="LN35">35</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="36"><td class="num" id="LN36">36</td><td class="line">    <span class='keyword'>void</span>* getData() <span class='keyword'>const</span>;</td></tr>
<tr class="codeline" data-linenumber="37"><td class="num" id="LN37">37</td><td class="line">    <span class='keyword'>void</span>  release();</td></tr>
<tr class="codeline" data-linenumber="38"><td class="num" id="LN38">38</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="39"><td class="num" id="LN39">39</td><td class="line"><span class='keyword'>protected</span>:</td></tr>
<tr class="codeline" data-linenumber="40"><td class="num" id="LN40">40</td><td class="line">    <span class='keyword'>virtual</span> <span class='keyword'>void</span>* createDataInstance() <span class='keyword'>const</span> = 0;</td></tr>
<tr class="codeline" data-linenumber="41"><td class="num" id="LN41">41</td><td class="line">    <span class='keyword'>virtual</span> <span class='keyword'>void</span>  deleteDataInstance(<span class='keyword'>void</span>* pData) <span class='keyword'>const</span> = 0;</td></tr>
<tr class="codeline" data-linenumber="42"><td class="num" id="LN42">42</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="43"><td class="num" id="LN43">43</td><td class="line"><span class='keyword'>private</span>:</td></tr>
<tr class="codeline" data-linenumber="44"><td class="num" id="LN44">44</td><td class="line">    <span class='keyword'>int</span> key_;</td></tr>
<tr class="codeline" data-linenumber="45"><td class="num" id="LN45">45</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="46"><td class="num" id="LN46">46</td><td class="line">    <span class='keyword'>friend</span> <span class='keyword'>class</span> cv::details::TlsStorage;  <span class='comment'>// core/src/system.cpp</span></td></tr>
<tr class="codeline" data-linenumber="47"><td class="num" id="LN47">47</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="48"><td class="num" id="LN48">48</td><td class="line"><span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="49"><td class="num" id="LN49">49</td><td class="line">    <span class='keyword'>void</span> cleanup(); <span class='comment'>//!&lt; Release created TLS data container objects. It is similar to release() call, but it keeps TLS container valid.</span></td></tr>
<tr class="codeline" data-linenumber="50"><td class="num" id="LN50">50</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="51"><td class="num" id="LN51">51</td><td class="line"><span class='keyword'>private</span>:</td></tr>
<tr class="codeline" data-linenumber="52"><td class="num" id="LN52">52</td><td class="line">    <span class='comment'>// Disable copy/assign (noncopyable pattern)</span></td></tr>
<tr class="codeline" data-linenumber="53"><td class="num" id="LN53">53</td><td class="line">    TLSDataContainer(TLSDataContainer &amp;) = <span class='keyword'>delete</span>;</td></tr>
<tr class="codeline" data-linenumber="54"><td class="num" id="LN54">54</td><td class="line">    TLSDataContainer&amp; <span class='keyword'>operator</span> =(<span class='keyword'>const</span> TLSDataContainer &amp;) = <span class='keyword'>delete</span>;</td></tr>
<tr class="codeline" data-linenumber="55"><td class="num" id="LN55">55</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="56"><td class="num" id="LN56">56</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="57"><td class="num" id="LN57">57</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="58"><td class="num" id="LN58">58</td><td class="line"><span class='comment'>/** @brief Simple TLS data class</span></td></tr>
<tr class="codeline" data-linenumber="59"><td class="num" id="LN59">59</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="60"><td class="num" id="LN60">60</td><td class="line"> <span class='comment'>* @sa TLSDataAccumulator</span></td></tr>
<tr class="codeline" data-linenumber="61"><td class="num" id="LN61">61</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="62"><td class="num" id="LN62">62</td><td class="line"><span class='keyword'>template</span> &lt;<span class='keyword'>typename</span> T&gt;</td></tr>
<tr class="codeline" data-linenumber="63"><td class="num" id="LN63">63</td><td class="line"><span class='keyword'>class</span> TLSData : <span class='keyword'>protected</span> TLSDataContainer</td></tr>
<tr class="codeline" data-linenumber="64"><td class="num" id="LN64">64</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="65"><td class="num" id="LN65">65</td><td class="line"><span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="66"><td class="num" id="LN66">66</td><td class="line">    <span class='keyword'>inline</span> TLSData() {}</td></tr>
<tr class="codeline" data-linenumber="67"><td class="num" id="LN67">67</td><td class="line">    <span class='keyword'>inline</span> ~TLSData() { release(); }</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path2" class="msg msgEvent" style="margin-left:36ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">2</div></td><td><div class="PathNav"><a href="#Path1" title="Previous event (1)">&#x2190;</a></div></td><td>Calling '~TLSDataContainer'</td><td><div class="PathNav"><a href="#Path3" title="Next event (3)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="68"><td class="num" id="LN68">68</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="69"><td class="num" id="LN69">69</td><td class="line">    <span class='keyword'>inline</span> T* get() <span class='keyword'>const</span>   { <span class='keyword'>return</span> (T*)getData(); }  <span class='comment'>//!&lt; Get data associated with key</span></td></tr>
<tr class="codeline" data-linenumber="70"><td class="num" id="LN70">70</td><td class="line">    <span class='keyword'>inline</span> T&amp; getRef() <span class='keyword'>const</span> { T* ptr = (T*)getData(); <span class='macro'>CV_DbgAssert(ptr)<span class='macro_popup'>do { if (!(ptr)) abort(); } while (0)</span></span>; <span class='keyword'>return</span> *ptr; }  <span class='comment'>//!&lt; Get data associated with key</span></td></tr>
<tr class="codeline" data-linenumber="71"><td class="num" id="LN71">71</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="72"><td class="num" id="LN72">72</td><td class="line">    <span class='comment'>/// Release associated thread data</span></td></tr>
<tr class="codeline" data-linenumber="73"><td class="num" id="LN73">73</td><td class="line">    <span class='keyword'>inline</span> <span class='keyword'>void</span> cleanup()</td></tr>
<tr class="codeline" data-linenumber="74"><td class="num" id="LN74">74</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="75"><td class="num" id="LN75">75</td><td class="line">        TLSDataContainer::cleanup();</td></tr>
<tr class="codeline" data-linenumber="76"><td class="num" id="LN76">76</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="77"><td class="num" id="LN77">77</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="78"><td class="num" id="LN78">78</td><td class="line"><span class='keyword'>protected</span>:</td></tr>
<tr class="codeline" data-linenumber="79"><td class="num" id="LN79">79</td><td class="line">    <span class='comment'>/// Wrapper to allocate data by template</span></td></tr>
<tr class="codeline" data-linenumber="80"><td class="num" id="LN80">80</td><td class="line">    <span class='keyword'>virtual</span> <span class='keyword'>void</span>* createDataInstance() <span class='keyword'>const</span> <span class='macro'>CV_OVERRIDE<span class='macro_popup'>override</span></span> { <span class='keyword'>return</span> <span class='keyword'>new</span> T; }</td></tr>
<tr class="codeline" data-linenumber="81"><td class="num" id="LN81">81</td><td class="line">    <span class='comment'>/// Wrapper to release data by template</span></td></tr>
<tr class="codeline" data-linenumber="82"><td class="num" id="LN82">82</td><td class="line">    <span class='keyword'>virtual</span> <span class='keyword'>void</span>  deleteDataInstance(<span class='keyword'>void</span>* pData) <span class='keyword'>const</span> <span class='macro'>CV_OVERRIDE<span class='macro_popup'>override</span></span> { <span class='keyword'>delete</span> (T*)pData; }</td></tr>
<tr class="codeline" data-linenumber="83"><td class="num" id="LN83">83</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="84"><td class="num" id="LN84">84</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="85"><td class="num" id="LN85">85</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="86"><td class="num" id="LN86">86</td><td class="line"><span class='comment'>/// TLS data accumulator with gathering methods</span></td></tr>
<tr class="codeline" data-linenumber="87"><td class="num" id="LN87">87</td><td class="line"><span class='keyword'>template</span> &lt;<span class='keyword'>typename</span> T&gt;</td></tr>
<tr class="codeline" data-linenumber="88"><td class="num" id="LN88">88</td><td class="line"><span class='keyword'>class</span> TLSDataAccumulator : <span class='keyword'>public</span> TLSData&lt;T&gt;</td></tr>
<tr class="codeline" data-linenumber="89"><td class="num" id="LN89">89</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="90"><td class="num" id="LN90">90</td><td class="line">    <span class='keyword'>mutable</span> cv::Mutex mutex;</td></tr>
<tr class="codeline" data-linenumber="91"><td class="num" id="LN91">91</td><td class="line">    <span class='keyword'>mutable</span> std::vector&lt;T*&gt; dataFromTerminatedThreads;</td></tr>
<tr class="codeline" data-linenumber="92"><td class="num" id="LN92">92</td><td class="line">    std::vector&lt;T*&gt; detachedData;</td></tr>
<tr class="codeline" data-linenumber="93"><td class="num" id="LN93">93</td><td class="line">    <span class='keyword'>bool</span> cleanupMode;</td></tr>
<tr class="codeline" data-linenumber="94"><td class="num" id="LN94">94</td><td class="line"><span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="95"><td class="num" id="LN95">95</td><td class="line">    TLSDataAccumulator() : cleanupMode(<span class='keyword'>false</span>) {}</td></tr>
<tr class="codeline" data-linenumber="96"><td class="num" id="LN96">96</td><td class="line">    ~TLSDataAccumulator()</td></tr>
<tr class="codeline" data-linenumber="97"><td class="num" id="LN97">97</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="98"><td class="num" id="LN98">98</td><td class="line">        release();</td></tr>
<tr class="codeline" data-linenumber="99"><td class="num" id="LN99">99</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="100"><td class="num" id="LN100">100</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="101"><td class="num" id="LN101">101</td><td class="line">    <span class='comment'>/** @brief Get data from all threads</span></td></tr>
<tr class="codeline" data-linenumber="102"><td class="num" id="LN102">102</td><td class="line">     <span class='comment'>* @deprecated replaced by detachData()</span></td></tr>
<tr class="codeline" data-linenumber="103"><td class="num" id="LN103">103</td><td class="line">     <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="104"><td class="num" id="LN104">104</td><td class="line">     <span class='comment'>* Lifetime of vector data is valid until next detachData()/cleanup()/release() calls</span></td></tr>
<tr class="codeline" data-linenumber="105"><td class="num" id="LN105">105</td><td class="line">     <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="106"><td class="num" id="LN106">106</td><td class="line">     <span class='comment'>* @param[out] data result buffer (should be empty)</span></td></tr>
<tr class="codeline" data-linenumber="107"><td class="num" id="LN107">107</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="108"><td class="num" id="LN108">108</td><td class="line">    <span class='keyword'>void</span> gather(std::vector&lt;T*&gt; &amp;data) <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="109"><td class="num" id="LN109">109</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="110"><td class="num" id="LN110">110</td><td class="line">        <span class='macro'>CV_Assert(cleanupMode == <span class='keyword'>false</span>)<span class='macro_popup'>do { if (!(cleanupMode == false)) abort(); } while (0)</span></span>;  <span class='comment'>// state is not valid</span></td></tr>
<tr class="codeline" data-linenumber="111"><td class="num" id="LN111">111</td><td class="line">        <span class='macro'>CV_Assert(data.empty())<span class='macro_popup'>do { if (!(data.empty())) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="112"><td class="num" id="LN112">112</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="113"><td class="num" id="LN113">113</td><td class="line">            std::vector&lt;<span class='keyword'>void</span>*&gt; &amp;dataVoid = <span class='keyword'>reinterpret_cast</span>&lt;std::vector&lt;<span class='keyword'>void</span>*&gt;&amp;&gt;(data);</td></tr>
<tr class="codeline" data-linenumber="114"><td class="num" id="LN114">114</td><td class="line">            TLSDataContainer::gatherData(dataVoid);</td></tr>
<tr class="codeline" data-linenumber="115"><td class="num" id="LN115">115</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="116"><td class="num" id="LN116">116</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="117"><td class="num" id="LN117">117</td><td class="line">            AutoLock lock(mutex);</td></tr>
<tr class="codeline" data-linenumber="118"><td class="num" id="LN118">118</td><td class="line">            data.reserve(data.size() + dataFromTerminatedThreads.size());</td></tr>
<tr class="codeline" data-linenumber="119"><td class="num" id="LN119">119</td><td class="line">            <span class='keyword'>for</span> (<span class='keyword'>typename</span> std::vector&lt;T*&gt;::const_iterator i = dataFromTerminatedThreads.begin(); i != dataFromTerminatedThreads.end(); ++i)</td></tr>
<tr class="codeline" data-linenumber="120"><td class="num" id="LN120">120</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="121"><td class="num" id="LN121">121</td><td class="line">                data.push_back((T*)*i);</td></tr>
<tr class="codeline" data-linenumber="122"><td class="num" id="LN122">122</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="123"><td class="num" id="LN123">123</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="124"><td class="num" id="LN124">124</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="125"><td class="num" id="LN125">125</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="126"><td class="num" id="LN126">126</td><td class="line">    <span class='comment'>/** @brief Get and detach data from all threads</span></td></tr>
<tr class="codeline" data-linenumber="127"><td class="num" id="LN127">127</td><td class="line">     <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="128"><td class="num" id="LN128">128</td><td class="line">     <span class='comment'>* Call cleanupDetachedData() when returned vector is not needed anymore.</span></td></tr>
<tr class="codeline" data-linenumber="129"><td class="num" id="LN129">129</td><td class="line">     <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="130"><td class="num" id="LN130">130</td><td class="line">     <span class='comment'>* @return Vector with associated data. Content is preserved (including lifetime of attached data pointers) until next detachData()/cleanupDetachedData()/cleanup()/release() calls</span></td></tr>
<tr class="codeline" data-linenumber="131"><td class="num" id="LN131">131</td><td class="line">     <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="132"><td class="num" id="LN132">132</td><td class="line">    std::vector&lt;T*&gt;&amp; detachData()</td></tr>
<tr class="codeline" data-linenumber="133"><td class="num" id="LN133">133</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="134"><td class="num" id="LN134">134</td><td class="line">        <span class='macro'>CV_Assert(cleanupMode == <span class='keyword'>false</span>)<span class='macro_popup'>do { if (!(cleanupMode == false)) abort(); } while (0)</span></span>;  <span class='comment'>// state is not valid</span></td></tr>
<tr class="codeline" data-linenumber="135"><td class="num" id="LN135">135</td><td class="line">        std::vector&lt;<span class='keyword'>void</span>*&gt; dataVoid;</td></tr>
<tr class="codeline" data-linenumber="136"><td class="num" id="LN136">136</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="137"><td class="num" id="LN137">137</td><td class="line">            TLSDataContainer::detachData(dataVoid);</td></tr>
<tr class="codeline" data-linenumber="138"><td class="num" id="LN138">138</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="139"><td class="num" id="LN139">139</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="140"><td class="num" id="LN140">140</td><td class="line">            AutoLock lock(mutex);</td></tr>
<tr class="codeline" data-linenumber="141"><td class="num" id="LN141">141</td><td class="line">            detachedData.reserve(dataVoid.size() + dataFromTerminatedThreads.size());</td></tr>
<tr class="codeline" data-linenumber="142"><td class="num" id="LN142">142</td><td class="line">            <span class='keyword'>for</span> (<span class='keyword'>typename</span> std::vector&lt;T*&gt;::const_iterator i = dataFromTerminatedThreads.begin(); i != dataFromTerminatedThreads.end(); ++i)</td></tr>
<tr class="codeline" data-linenumber="143"><td class="num" id="LN143">143</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="144"><td class="num" id="LN144">144</td><td class="line">                detachedData.push_back((T*)*i);</td></tr>
<tr class="codeline" data-linenumber="145"><td class="num" id="LN145">145</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="146"><td class="num" id="LN146">146</td><td class="line">            dataFromTerminatedThreads.clear();</td></tr>
<tr class="codeline" data-linenumber="147"><td class="num" id="LN147">147</td><td class="line">            <span class='keyword'>for</span> (<span class='keyword'>typename</span> std::vector&lt;<span class='keyword'>void</span>*&gt;::const_iterator i = dataVoid.begin(); i != dataVoid.end(); ++i)</td></tr>
<tr class="codeline" data-linenumber="148"><td class="num" id="LN148">148</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="149"><td class="num" id="LN149">149</td><td class="line">                detachedData.push_back((T*)(<span class='keyword'>void</span>*)*i);</td></tr>
<tr class="codeline" data-linenumber="150"><td class="num" id="LN150">150</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="151"><td class="num" id="LN151">151</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="152"><td class="num" id="LN152">152</td><td class="line">        dataVoid.clear();</td></tr>
<tr class="codeline" data-linenumber="153"><td class="num" id="LN153">153</td><td class="line">        <span class='keyword'>return</span> detachedData;</td></tr>
<tr class="codeline" data-linenumber="154"><td class="num" id="LN154">154</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="155"><td class="num" id="LN155">155</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="156"><td class="num" id="LN156">156</td><td class="line">    <span class='comment'>/// Release associated thread data returned by detachData() call</span></td></tr>
<tr class="codeline" data-linenumber="157"><td class="num" id="LN157">157</td><td class="line">    <span class='keyword'>void</span> cleanupDetachedData()</td></tr>
<tr class="codeline" data-linenumber="158"><td class="num" id="LN158">158</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="159"><td class="num" id="LN159">159</td><td class="line">        AutoLock lock(mutex);</td></tr>
<tr class="codeline" data-linenumber="160"><td class="num" id="LN160">160</td><td class="line">        cleanupMode = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="161"><td class="num" id="LN161">161</td><td class="line">        _cleanupDetachedData();</td></tr>
<tr class="codeline" data-linenumber="162"><td class="num" id="LN162">162</td><td class="line">        cleanupMode = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="163"><td class="num" id="LN163">163</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="164"><td class="num" id="LN164">164</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="165"><td class="num" id="LN165">165</td><td class="line">    <span class='comment'>/// Release associated thread data</span></td></tr>
<tr class="codeline" data-linenumber="166"><td class="num" id="LN166">166</td><td class="line">    <span class='keyword'>void</span> cleanup()</td></tr>
<tr class="codeline" data-linenumber="167"><td class="num" id="LN167">167</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="168"><td class="num" id="LN168">168</td><td class="line">        cleanupMode = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="169"><td class="num" id="LN169">169</td><td class="line">        TLSDataContainer::cleanup();</td></tr>
<tr class="codeline" data-linenumber="170"><td class="num" id="LN170">170</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="171"><td class="num" id="LN171">171</td><td class="line">        AutoLock lock(mutex);</td></tr>
<tr class="codeline" data-linenumber="172"><td class="num" id="LN172">172</td><td class="line">        _cleanupDetachedData();</td></tr>
<tr class="codeline" data-linenumber="173"><td class="num" id="LN173">173</td><td class="line">        _cleanupTerminatedData();</td></tr>
<tr class="codeline" data-linenumber="174"><td class="num" id="LN174">174</td><td class="line">        cleanupMode = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="175"><td class="num" id="LN175">175</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="176"><td class="num" id="LN176">176</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="177"><td class="num" id="LN177">177</td><td class="line">    <span class='comment'>/// Release associated thread data and free TLS key</span></td></tr>
<tr class="codeline" data-linenumber="178"><td class="num" id="LN178">178</td><td class="line">    <span class='keyword'>void</span> release()</td></tr>
<tr class="codeline" data-linenumber="179"><td class="num" id="LN179">179</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="180"><td class="num" id="LN180">180</td><td class="line">        cleanupMode = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="181"><td class="num" id="LN181">181</td><td class="line">        TLSDataContainer::release();</td></tr>
<tr class="codeline" data-linenumber="182"><td class="num" id="LN182">182</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="183"><td class="num" id="LN183">183</td><td class="line">            AutoLock lock(mutex);</td></tr>
<tr class="codeline" data-linenumber="184"><td class="num" id="LN184">184</td><td class="line">            _cleanupDetachedData();</td></tr>
<tr class="codeline" data-linenumber="185"><td class="num" id="LN185">185</td><td class="line">            _cleanupTerminatedData();</td></tr>
<tr class="codeline" data-linenumber="186"><td class="num" id="LN186">186</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="187"><td class="num" id="LN187">187</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="188"><td class="num" id="LN188">188</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="189"><td class="num" id="LN189">189</td><td class="line"><span class='keyword'>protected</span>:</td></tr>
<tr class="codeline" data-linenumber="190"><td class="num" id="LN190">190</td><td class="line">    <span class='comment'>// synchronized</span></td></tr>
<tr class="codeline" data-linenumber="191"><td class="num" id="LN191">191</td><td class="line">    <span class='keyword'>void</span> _cleanupDetachedData()</td></tr>
<tr class="codeline" data-linenumber="192"><td class="num" id="LN192">192</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="193"><td class="num" id="LN193">193</td><td class="line">        <span class='keyword'>for</span> (<span class='keyword'>typename</span> std::vector&lt;T*&gt;::iterator i = detachedData.begin(); i != detachedData.end(); ++i)</td></tr>
<tr class="codeline" data-linenumber="194"><td class="num" id="LN194">194</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="195"><td class="num" id="LN195">195</td><td class="line">            deleteDataInstance((T*)*i);</td></tr>
<tr class="codeline" data-linenumber="196"><td class="num" id="LN196">196</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="197"><td class="num" id="LN197">197</td><td class="line">        detachedData.clear();</td></tr>
<tr class="codeline" data-linenumber="198"><td class="num" id="LN198">198</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="199"><td class="num" id="LN199">199</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="200"><td class="num" id="LN200">200</td><td class="line">    <span class='comment'>// synchronized</span></td></tr>
<tr class="codeline" data-linenumber="201"><td class="num" id="LN201">201</td><td class="line">    <span class='keyword'>void</span> _cleanupTerminatedData()</td></tr>
<tr class="codeline" data-linenumber="202"><td class="num" id="LN202">202</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="203"><td class="num" id="LN203">203</td><td class="line">        <span class='keyword'>for</span> (<span class='keyword'>typename</span> std::vector&lt;T*&gt;::iterator i = dataFromTerminatedThreads.begin(); i != dataFromTerminatedThreads.end(); ++i)</td></tr>
<tr class="codeline" data-linenumber="204"><td class="num" id="LN204">204</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="205"><td class="num" id="LN205">205</td><td class="line">            deleteDataInstance((T*)*i);</td></tr>
<tr class="codeline" data-linenumber="206"><td class="num" id="LN206">206</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="207"><td class="num" id="LN207">207</td><td class="line">        dataFromTerminatedThreads.clear();</td></tr>
<tr class="codeline" data-linenumber="208"><td class="num" id="LN208">208</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="209"><td class="num" id="LN209">209</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="210"><td class="num" id="LN210">210</td><td class="line"><span class='keyword'>protected</span>:</td></tr>
<tr class="codeline" data-linenumber="211"><td class="num" id="LN211">211</td><td class="line">    <span class='keyword'>virtual</span> <span class='keyword'>void</span>* createDataInstance() <span class='keyword'>const</span> <span class='macro'>CV_OVERRIDE<span class='macro_popup'>override</span></span></td></tr>
<tr class="codeline" data-linenumber="212"><td class="num" id="LN212">212</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="213"><td class="num" id="LN213">213</td><td class="line">        <span class='comment'>// Note: we can collect all allocated data here, but this would require raced mutex locks</span></td></tr>
<tr class="codeline" data-linenumber="214"><td class="num" id="LN214">214</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>new</span> T;</td></tr>
<tr class="codeline" data-linenumber="215"><td class="num" id="LN215">215</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="216"><td class="num" id="LN216">216</td><td class="line">    <span class='keyword'>virtual</span> <span class='keyword'>void</span>  deleteDataInstance(<span class='keyword'>void</span>* pData) <span class='keyword'>const</span> <span class='macro'>CV_OVERRIDE<span class='macro_popup'>override</span></span></td></tr>
<tr class="codeline" data-linenumber="217"><td class="num" id="LN217">217</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="218"><td class="num" id="LN218">218</td><td class="line">        <span class='keyword'>if</span> (cleanupMode)</td></tr>
<tr class="codeline" data-linenumber="219"><td class="num" id="LN219">219</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="220"><td class="num" id="LN220">220</td><td class="line">            <span class='keyword'>delete</span> (T*)pData;</td></tr>
<tr class="codeline" data-linenumber="221"><td class="num" id="LN221">221</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="222"><td class="num" id="LN222">222</td><td class="line">        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="223"><td class="num" id="LN223">223</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="224"><td class="num" id="LN224">224</td><td class="line">            AutoLock lock(mutex);</td></tr>
<tr class="codeline" data-linenumber="225"><td class="num" id="LN225">225</td><td class="line">            dataFromTerminatedThreads.push_back((T*)pData);</td></tr>
<tr class="codeline" data-linenumber="226"><td class="num" id="LN226">226</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="227"><td class="num" id="LN227">227</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="228"><td class="num" id="LN228">228</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="229"><td class="num" id="LN229">229</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="230"><td class="num" id="LN230">230</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="231"><td class="num" id="LN231">231</td><td class="line"><span class='comment'>//! @}</span></td></tr>
<tr class="codeline" data-linenumber="232"><td class="num" id="LN232">232</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="233"><td class="num" id="LN233">233</td><td class="line">} <span class='comment'>// namespace</span></td></tr>
<tr class="codeline" data-linenumber="234"><td class="num" id="LN234">234</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="235"><td class="num" id="LN235">235</td><td class="line"><span class='directive'>#endif // OPENCV_UTILS_TLS_HPP</span></td></tr>
</table><hr class=divider>
<div id=File64471>
<div class=FileNav><a href="#File56205">&#x2190;</a></div><h4 class=FileName>/home/zhh/projects/opencv-4.5.2/modules/core/src/system.cpp</h4>
</div>
<table class="code" data-fileid="64471">
<tr class="codeline" data-linenumber="1"><td class="num" id="LN1">1</td><td class="line"><span class='comment'>/*M///////////////////////////////////////////////////////////////////////////////////////</span></td></tr>
<tr class="codeline" data-linenumber="2"><td class="num" id="LN2">2</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="3"><td class="num" id="LN3">3</td><td class="line"><span class='comment'>//  IMPORTANT: READ BEFORE DOWNLOADING, COPYING, INSTALLING OR USING.</span></td></tr>
<tr class="codeline" data-linenumber="4"><td class="num" id="LN4">4</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="5"><td class="num" id="LN5">5</td><td class="line"><span class='comment'>//  By downloading, copying, installing or using the software you agree to this license.</span></td></tr>
<tr class="codeline" data-linenumber="6"><td class="num" id="LN6">6</td><td class="line"><span class='comment'>//  If you do not agree to this license, do not download, install,</span></td></tr>
<tr class="codeline" data-linenumber="7"><td class="num" id="LN7">7</td><td class="line"><span class='comment'>//  copy or use the software.</span></td></tr>
<tr class="codeline" data-linenumber="8"><td class="num" id="LN8">8</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="9"><td class="num" id="LN9">9</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="10"><td class="num" id="LN10">10</td><td class="line"><span class='comment'>//                           License Agreement</span></td></tr>
<tr class="codeline" data-linenumber="11"><td class="num" id="LN11">11</td><td class="line"><span class='comment'>//                For Open Source Computer Vision Library</span></td></tr>
<tr class="codeline" data-linenumber="12"><td class="num" id="LN12">12</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="13"><td class="num" id="LN13">13</td><td class="line"><span class='comment'>// Copyright (C) 2000-2008, Intel Corporation, all rights reserved.</span></td></tr>
<tr class="codeline" data-linenumber="14"><td class="num" id="LN14">14</td><td class="line"><span class='comment'>// Copyright (C) 2009, Willow Garage Inc., all rights reserved.</span></td></tr>
<tr class="codeline" data-linenumber="15"><td class="num" id="LN15">15</td><td class="line"><span class='comment'>// Copyright (C) 2015, Itseez Inc., all rights reserved.</span></td></tr>
<tr class="codeline" data-linenumber="16"><td class="num" id="LN16">16</td><td class="line"><span class='comment'>// Third party copyrights are property of their respective owners.</span></td></tr>
<tr class="codeline" data-linenumber="17"><td class="num" id="LN17">17</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="18"><td class="num" id="LN18">18</td><td class="line"><span class='comment'>// Redistribution and use in source and binary forms, with or without modification,</span></td></tr>
<tr class="codeline" data-linenumber="19"><td class="num" id="LN19">19</td><td class="line"><span class='comment'>// are permitted provided that the following conditions are met:</span></td></tr>
<tr class="codeline" data-linenumber="20"><td class="num" id="LN20">20</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="21"><td class="num" id="LN21">21</td><td class="line"><span class='comment'>//   * Redistribution's of source code must retain the above copyright notice,</span></td></tr>
<tr class="codeline" data-linenumber="22"><td class="num" id="LN22">22</td><td class="line"><span class='comment'>//     this list of conditions and the following disclaimer.</span></td></tr>
<tr class="codeline" data-linenumber="23"><td class="num" id="LN23">23</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="24"><td class="num" id="LN24">24</td><td class="line"><span class='comment'>//   * Redistribution's in binary form must reproduce the above copyright notice,</span></td></tr>
<tr class="codeline" data-linenumber="25"><td class="num" id="LN25">25</td><td class="line"><span class='comment'>//     this list of conditions and the following disclaimer in the documentation</span></td></tr>
<tr class="codeline" data-linenumber="26"><td class="num" id="LN26">26</td><td class="line"><span class='comment'>//     and/or other materials provided with the distribution.</span></td></tr>
<tr class="codeline" data-linenumber="27"><td class="num" id="LN27">27</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="28"><td class="num" id="LN28">28</td><td class="line"><span class='comment'>//   * The name of the copyright holders may not be used to endorse or promote products</span></td></tr>
<tr class="codeline" data-linenumber="29"><td class="num" id="LN29">29</td><td class="line"><span class='comment'>//     derived from this software without specific prior written permission.</span></td></tr>
<tr class="codeline" data-linenumber="30"><td class="num" id="LN30">30</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="31"><td class="num" id="LN31">31</td><td class="line"><span class='comment'>// This software is provided by the copyright holders and contributors "as is" and</span></td></tr>
<tr class="codeline" data-linenumber="32"><td class="num" id="LN32">32</td><td class="line"><span class='comment'>// any express or implied warranties, including, but not limited to, the implied</span></td></tr>
<tr class="codeline" data-linenumber="33"><td class="num" id="LN33">33</td><td class="line"><span class='comment'>// warranties of merchantability and fitness for a particular purpose are disclaimed.</span></td></tr>
<tr class="codeline" data-linenumber="34"><td class="num" id="LN34">34</td><td class="line"><span class='comment'>// In no event shall the Intel Corporation or contributors be liable for any direct,</span></td></tr>
<tr class="codeline" data-linenumber="35"><td class="num" id="LN35">35</td><td class="line"><span class='comment'>// indirect, incidental, special, exemplary, or consequential damages</span></td></tr>
<tr class="codeline" data-linenumber="36"><td class="num" id="LN36">36</td><td class="line"><span class='comment'>// (including, but not limited to, procurement of substitute goods or services;</span></td></tr>
<tr class="codeline" data-linenumber="37"><td class="num" id="LN37">37</td><td class="line"><span class='comment'>// loss of use, data, or profits; or business interruption) however caused</span></td></tr>
<tr class="codeline" data-linenumber="38"><td class="num" id="LN38">38</td><td class="line"><span class='comment'>// and on any theory of liability, whether in contract, strict liability,</span></td></tr>
<tr class="codeline" data-linenumber="39"><td class="num" id="LN39">39</td><td class="line"><span class='comment'>// or tort (including negligence or otherwise) arising in any way out of</span></td></tr>
<tr class="codeline" data-linenumber="40"><td class="num" id="LN40">40</td><td class="line"><span class='comment'>// the use of this software, even if advised of the possibility of such damage.</span></td></tr>
<tr class="codeline" data-linenumber="41"><td class="num" id="LN41">41</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="42"><td class="num" id="LN42">42</td><td class="line"><span class='comment'>//M*/</span></td></tr>
<tr class="codeline" data-linenumber="43"><td class="num" id="LN43">43</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="44"><td class="num" id="LN44">44</td><td class="line"><span class='directive'>#include "precomp.hpp"</span></td></tr>
<tr class="codeline" data-linenumber="45"><td class="num" id="LN45">45</td><td class="line"><span class='directive'>#include &lt;iostream&gt;</span></td></tr>
<tr class="codeline" data-linenumber="46"><td class="num" id="LN46">46</td><td class="line"><span class='directive'>#include &lt;ostream&gt;</span></td></tr>
<tr class="codeline" data-linenumber="47"><td class="num" id="LN47">47</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="48"><td class="num" id="LN48">48</td><td class="line"><span class='directive'>#include &lt;opencv2/core/utils/configuration.private.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="49"><td class="num" id="LN49">49</td><td class="line"><span class='directive'>#include &lt;opencv2/core/utils/trace.private.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="50"><td class="num" id="LN50">50</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="51"><td class="num" id="LN51">51</td><td class="line"><span class='directive'>#include &lt;opencv2/core/utils/logger.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="52"><td class="num" id="LN52">52</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="53"><td class="num" id="LN53">53</td><td class="line"><span class='directive'>#include &lt;opencv2/core/utils/tls.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="54"><td class="num" id="LN54">54</td><td class="line"><span class='directive'>#include &lt;opencv2/core/utils/instrumentation.hpp&gt;</span></td></tr>
<tr class="codeline" data-linenumber="55"><td class="num" id="LN55">55</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="56"><td class="num" id="LN56">56</td><td class="line"><span class='keyword'>namespace</span> cv {</td></tr>
<tr class="codeline" data-linenumber="57"><td class="num" id="LN57">57</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="58"><td class="num" id="LN58">58</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> _initSystem()</td></tr>
<tr class="codeline" data-linenumber="59"><td class="num" id="LN59">59</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="60"><td class="num" id="LN60">60</td><td class="line"><span class='directive'>#ifdef __ANDROID__</span></td></tr>
<tr class="codeline" data-linenumber="61"><td class="num" id="LN61">61</td><td class="line">    <span class='comment'>// https://github.com/opencv/opencv/issues/14906</span></td></tr>
<tr class="codeline" data-linenumber="62"><td class="num" id="LN62">62</td><td class="line">    <span class='comment'>// "ios_base::Init" object is not a part of Android's "iostream" header (in case of clang toolchain, NDK 20).</span></td></tr>
<tr class="codeline" data-linenumber="63"><td class="num" id="LN63">63</td><td class="line">    <span class='comment'>// Ref1: https://en.cppreference.com/w/cpp/io/ios_base/Init</span></td></tr>
<tr class="codeline" data-linenumber="64"><td class="num" id="LN64">64</td><td class="line">    <span class='comment'>//       The header &lt;iostream&gt; behaves as if it defines (directly or indirectly) an instance of std::ios_base::Init with static storage duration</span></td></tr>
<tr class="codeline" data-linenumber="65"><td class="num" id="LN65">65</td><td class="line">    <span class='comment'>// Ref2: https://github.com/gcc-mirror/gcc/blob/gcc-8-branch/libstdc%2B%2B-v3/include/std/iostream#L73-L74</span></td></tr>
<tr class="codeline" data-linenumber="66"><td class="num" id="LN66">66</td><td class="line">    <span class='keyword'>static</span> std::ios_base::Init s_iostream_initializer;</td></tr>
<tr class="codeline" data-linenumber="67"><td class="num" id="LN67">67</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="68"><td class="num" id="LN68">68</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="69"><td class="num" id="LN69">69</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="70"><td class="num" id="LN70">70</td><td class="line"><span class='keyword'>static</span> Mutex* __initialization_mutex = <span class='macro'>NULL<span class='macro_popup'>__null</span></span>;</td></tr>
<tr class="codeline" data-linenumber="71"><td class="num" id="LN71">71</td><td class="line">Mutex&amp; getInitializationMutex()</td></tr>
<tr class="codeline" data-linenumber="72"><td class="num" id="LN72">72</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="73"><td class="num" id="LN73">73</td><td class="line">    <span class='keyword'>if</span> (__initialization_mutex == <span class='macro'>NULL<span class='macro_popup'>__null</span></span>)</td></tr>
<tr class="codeline" data-linenumber="74"><td class="num" id="LN74">74</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="75"><td class="num" id="LN75">75</td><td class="line">        (<span class='keyword'>void</span>)_initSystem();</td></tr>
<tr class="codeline" data-linenumber="76"><td class="num" id="LN76">76</td><td class="line">        __initialization_mutex = <span class='keyword'>new</span> Mutex();</td></tr>
<tr class="codeline" data-linenumber="77"><td class="num" id="LN77">77</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="78"><td class="num" id="LN78">78</td><td class="line">    <span class='keyword'>return</span> *__initialization_mutex;</td></tr>
<tr class="codeline" data-linenumber="79"><td class="num" id="LN79">79</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="80"><td class="num" id="LN80">80</td><td class="line"><span class='comment'>// force initialization (single-threaded environment)</span></td></tr>
<tr class="codeline" data-linenumber="81"><td class="num" id="LN81">81</td><td class="line">Mutex* __initialization_mutex_initializer = &amp;getInitializationMutex();</td></tr>
<tr class="codeline" data-linenumber="82"><td class="num" id="LN82">82</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="83"><td class="num" id="LN83">83</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>bool</span> param_dumpErrors = utils::getConfigurationParameterBool(<span class='string_literal'>"OPENCV_DUMP_ERRORS"</span>,</td></tr>
<tr class="codeline" data-linenumber="84"><td class="num" id="LN84">84</td><td class="line"><span class='directive'>#if defined(_DEBUG) || defined(__ANDROID__)</span></td></tr>
<tr class="codeline" data-linenumber="85"><td class="num" id="LN85">85</td><td class="line">    <span class='keyword'>true</span></td></tr>
<tr class="codeline" data-linenumber="86"><td class="num" id="LN86">86</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="87"><td class="num" id="LN87">87</td><td class="line">    <span class='keyword'>false</span></td></tr>
<tr class="codeline" data-linenumber="88"><td class="num" id="LN88">88</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="89"><td class="num" id="LN89">89</td><td class="line">);</td></tr>
<tr class="codeline" data-linenumber="90"><td class="num" id="LN90">90</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="91"><td class="num" id="LN91">91</td><td class="line"><span class='keyword'>void</span>* allocSingletonBuffer(size_t size) { <span class='keyword'>return</span> fastMalloc(size); }</td></tr>
<tr class="codeline" data-linenumber="92"><td class="num" id="LN92">92</td><td class="line"><span class='keyword'>void</span>* allocSingletonNewBuffer(size_t size) { <span class='keyword'>return</span> malloc(size); }</td></tr>
<tr class="codeline" data-linenumber="93"><td class="num" id="LN93">93</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="94"><td class="num" id="LN94">94</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="95"><td class="num" id="LN95">95</td><td class="line">} <span class='comment'>// namespace cv</span></td></tr>
<tr class="codeline" data-linenumber="96"><td class="num" id="LN96">96</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="97"><td class="num" id="LN97">97</td><td class="line"><span class='directive'>#ifndef CV_ERROR_SET_TERMINATE_HANDLER  // build config option</span></td></tr>
<tr class="codeline" data-linenumber="98"><td class="num" id="LN98">98</td><td class="line"><span class='directive'># if defined(_WIN32)</span></td></tr>
<tr class="codeline" data-linenumber="99"><td class="num" id="LN99">99</td><td class="line"><span class='directive'>#   define CV_ERROR_SET_TERMINATE_HANDLER 1</span></td></tr>
<tr class="codeline" data-linenumber="100"><td class="num" id="LN100">100</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="101"><td class="num" id="LN101">101</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="102"><td class="num" id="LN102">102</td><td class="line"><span class='directive'>#if defined(CV_ERROR_SET_TERMINATE_HANDLER) &amp;&amp; !CV_ERROR_SET_TERMINATE_HANDLER</span></td></tr>
<tr class="codeline" data-linenumber="103"><td class="num" id="LN103">103</td><td class="line"><span class='directive'># undef CV_ERROR_SET_TERMINATE_HANDLER</span></td></tr>
<tr class="codeline" data-linenumber="104"><td class="num" id="LN104">104</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="105"><td class="num" id="LN105">105</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="106"><td class="num" id="LN106">106</td><td class="line"><span class='directive'>#ifdef _MSC_VER</span></td></tr>
<tr class="codeline" data-linenumber="107"><td class="num" id="LN107">107</td><td class="line"><span class='directive'># if _MSC_VER &gt;= 1700</span></td></tr>
<tr class="codeline" data-linenumber="108"><td class="num" id="LN108">108</td><td class="line"><span class='directive'>#  pragma warning(disable:4447) // Disable warning 'main' signature found without threading model</span></td></tr>
<tr class="codeline" data-linenumber="109"><td class="num" id="LN109">109</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="110"><td class="num" id="LN110">110</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="111"><td class="num" id="LN111">111</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="112"><td class="num" id="LN112">112</td><td class="line"><span class='directive'>#ifdef CV_ERROR_SET_TERMINATE_HANDLER</span></td></tr>
<tr class="codeline" data-linenumber="113"><td class="num" id="LN113">113</td><td class="line"><span class='directive'>#include &lt;exception&gt;      // std::set_terminate</span></td></tr>
<tr class="codeline" data-linenumber="114"><td class="num" id="LN114">114</td><td class="line"><span class='directive'>#include &lt;cstdlib&gt;        // std::abort</span></td></tr>
<tr class="codeline" data-linenumber="115"><td class="num" id="LN115">115</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="116"><td class="num" id="LN116">116</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="117"><td class="num" id="LN117">117</td><td class="line"><span class='directive'>#if defined __ANDROID__ || defined <span class='macro'>__linux__<span class='macro_popup'>1</span></span> || defined __FreeBSD__ || defined __OpenBSD__ || defined __HAIKU__ || defined __Fuchsia__</span></td></tr>
<tr class="codeline" data-linenumber="118"><td class="num" id="LN118">118</td><td class="line"><span class='directive'>#  include &lt;unistd.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="119"><td class="num" id="LN119">119</td><td class="line"><span class='directive'>#  include &lt;fcntl.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="120"><td class="num" id="LN120">120</td><td class="line"><span class='directive'>#  include &lt;elf.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="121"><td class="num" id="LN121">121</td><td class="line"><span class='directive'>#if defined __ANDROID__ || defined <span class='macro'>__linux__<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="122"><td class="num" id="LN122">122</td><td class="line"><span class='directive'>#  include &lt;linux/auxvec.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="123"><td class="num" id="LN123">123</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="124"><td class="num" id="LN124">124</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="125"><td class="num" id="LN125">125</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="126"><td class="num" id="LN126">126</td><td class="line"><span class='directive'>#if defined __ANDROID__ &amp;&amp; defined HAVE_CPUFEATURES</span></td></tr>
<tr class="codeline" data-linenumber="127"><td class="num" id="LN127">127</td><td class="line"><span class='directive'>#  include &lt;cpu-features.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="128"><td class="num" id="LN128">128</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="129"><td class="num" id="LN129">129</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="130"><td class="num" id="LN130">130</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="131"><td class="num" id="LN131">131</td><td class="line"><span class='directive'>#if (defined __ppc64__ || defined __PPC64__) &amp;&amp; defined <span class='macro'>__linux__<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="132"><td class="num" id="LN132">132</td><td class="line"><span class='directive'># include "sys/auxv.h"</span></td></tr>
<tr class="codeline" data-linenumber="133"><td class="num" id="LN133">133</td><td class="line"><span class='directive'># ifndef AT_HWCAP2</span></td></tr>
<tr class="codeline" data-linenumber="134"><td class="num" id="LN134">134</td><td class="line"><span class='directive'>#   define AT_HWCAP2 26</span></td></tr>
<tr class="codeline" data-linenumber="135"><td class="num" id="LN135">135</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="136"><td class="num" id="LN136">136</td><td class="line"><span class='directive'># ifndef PPC_FEATURE2_ARCH_2_07</span></td></tr>
<tr class="codeline" data-linenumber="137"><td class="num" id="LN137">137</td><td class="line"><span class='directive'>#   define PPC_FEATURE2_ARCH_2_07 0x80000000</span></td></tr>
<tr class="codeline" data-linenumber="138"><td class="num" id="LN138">138</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="139"><td class="num" id="LN139">139</td><td class="line"><span class='directive'># ifndef PPC_FEATURE2_ARCH_3_00</span></td></tr>
<tr class="codeline" data-linenumber="140"><td class="num" id="LN140">140</td><td class="line"><span class='directive'>#   define PPC_FEATURE2_ARCH_3_00 0x00800000</span></td></tr>
<tr class="codeline" data-linenumber="141"><td class="num" id="LN141">141</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="142"><td class="num" id="LN142">142</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="143"><td class="num" id="LN143">143</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="144"><td class="num" id="LN144">144</td><td class="line"><span class='directive'>#if defined _WIN32 || defined WINCE</span></td></tr>
<tr class="codeline" data-linenumber="145"><td class="num" id="LN145">145</td><td class="line"><span class='directive'>#ifndef _WIN32_WINNT           // This is needed for the declaration of TryEnterCriticalSection in winbase.h with Visual Studio 2005 (and older?)</span></td></tr>
<tr class="codeline" data-linenumber="146"><td class="num" id="LN146">146</td><td class="line">  <span class='directive'>#define _WIN32_WINNT 0x0400  // http://msdn.microsoft.com/en-us/library/ms686857(VS.85).aspx</span></td></tr>
<tr class="codeline" data-linenumber="147"><td class="num" id="LN147">147</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="148"><td class="num" id="LN148">148</td><td class="line"><span class='directive'>#include &lt;windows.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="149"><td class="num" id="LN149">149</td><td class="line"><span class='directive'>#if (_WIN32_WINNT &gt;= 0x0602)</span></td></tr>
<tr class="codeline" data-linenumber="150"><td class="num" id="LN150">150</td><td class="line">  <span class='directive'>#include &lt;synchapi.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="151"><td class="num" id="LN151">151</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="152"><td class="num" id="LN152">152</td><td class="line"><span class='directive'>#if ((_WIN32_WINNT &gt;= 0x0600) &amp;&amp; !defined(CV_DISABLE_FLS)) || defined(CV_FORCE_FLS)</span></td></tr>
<tr class="codeline" data-linenumber="153"><td class="num" id="LN153">153</td><td class="line">  <span class='directive'>#include &lt;fibersapi.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="154"><td class="num" id="LN154">154</td><td class="line">  <span class='directive'>#define CV_USE_FLS</span></td></tr>
<tr class="codeline" data-linenumber="155"><td class="num" id="LN155">155</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="156"><td class="num" id="LN156">156</td><td class="line"><span class='directive'>#undef small</span></td></tr>
<tr class="codeline" data-linenumber="157"><td class="num" id="LN157">157</td><td class="line"><span class='directive'>#undef min</span></td></tr>
<tr class="codeline" data-linenumber="158"><td class="num" id="LN158">158</td><td class="line"><span class='directive'>#undef max</span></td></tr>
<tr class="codeline" data-linenumber="159"><td class="num" id="LN159">159</td><td class="line"><span class='directive'>#undef abs</span></td></tr>
<tr class="codeline" data-linenumber="160"><td class="num" id="LN160">160</td><td class="line"><span class='directive'>#include &lt;tchar.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="161"><td class="num" id="LN161">161</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="162"><td class="num" id="LN162">162</td><td class="line"><span class='directive'>#ifdef WINRT</span></td></tr>
<tr class="codeline" data-linenumber="163"><td class="num" id="LN163">163</td><td class="line"><span class='directive'>#include &lt;wrl/client.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="164"><td class="num" id="LN164">164</td><td class="line"><span class='directive'>#ifndef __cplusplus_winrt</span></td></tr>
<tr class="codeline" data-linenumber="165"><td class="num" id="LN165">165</td><td class="line"><span class='directive'>#include &lt;windows.storage.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="166"><td class="num" id="LN166">166</td><td class="line"><span class='directive'>#pragma comment(lib, "runtimeobject.lib")</span></td></tr>
<tr class="codeline" data-linenumber="167"><td class="num" id="LN167">167</td><td class="line"><span class='directive'>#endif // WINRT</span></td></tr>
<tr class="codeline" data-linenumber="168"><td class="num" id="LN168">168</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="169"><td class="num" id="LN169">169</td><td class="line">std::wstring GetTempPathWinRT()</td></tr>
<tr class="codeline" data-linenumber="170"><td class="num" id="LN170">170</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="171"><td class="num" id="LN171">171</td><td class="line"><span class='directive'>#ifdef __cplusplus_winrt</span></td></tr>
<tr class="codeline" data-linenumber="172"><td class="num" id="LN172">172</td><td class="line">    <span class='keyword'>return</span> std::wstring(Windows::Storage::ApplicationData::Current-&gt;TemporaryFolder-&gt;Path-&gt;Data());</td></tr>
<tr class="codeline" data-linenumber="173"><td class="num" id="LN173">173</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="174"><td class="num" id="LN174">174</td><td class="line">    Microsoft::WRL::ComPtr&lt;ABI::Windows::Storage::IApplicationDataStatics&gt; appdataFactory;</td></tr>
<tr class="codeline" data-linenumber="175"><td class="num" id="LN175">175</td><td class="line">    Microsoft::WRL::ComPtr&lt;ABI::Windows::Storage::IApplicationData&gt; appdataRef;</td></tr>
<tr class="codeline" data-linenumber="176"><td class="num" id="LN176">176</td><td class="line">    Microsoft::WRL::ComPtr&lt;ABI::Windows::Storage::IStorageFolder&gt; storagefolderRef;</td></tr>
<tr class="codeline" data-linenumber="177"><td class="num" id="LN177">177</td><td class="line">    Microsoft::WRL::ComPtr&lt;ABI::Windows::Storage::IStorageItem&gt; storageitemRef;</td></tr>
<tr class="codeline" data-linenumber="178"><td class="num" id="LN178">178</td><td class="line">    HSTRING str;</td></tr>
<tr class="codeline" data-linenumber="179"><td class="num" id="LN179">179</td><td class="line">    HSTRING_HEADER hstrHead;</td></tr>
<tr class="codeline" data-linenumber="180"><td class="num" id="LN180">180</td><td class="line">    std::wstring wstr;</td></tr>
<tr class="codeline" data-linenumber="181"><td class="num" id="LN181">181</td><td class="line">    <span class='keyword'>if</span> (FAILED(WindowsCreateStringReference(RuntimeClass_Windows_Storage_ApplicationData,</td></tr>
<tr class="codeline" data-linenumber="182"><td class="num" id="LN182">182</td><td class="line">                                            (UINT32)wcslen(RuntimeClass_Windows_Storage_ApplicationData), &amp;hstrHead, &amp;str)))</td></tr>
<tr class="codeline" data-linenumber="183"><td class="num" id="LN183">183</td><td class="line">        <span class='keyword'>return</span> wstr;</td></tr>
<tr class="codeline" data-linenumber="184"><td class="num" id="LN184">184</td><td class="line">    <span class='keyword'>if</span> (FAILED(RoGetActivationFactory(str, IID_PPV_ARGS(appdataFactory.ReleaseAndGetAddressOf()))))</td></tr>
<tr class="codeline" data-linenumber="185"><td class="num" id="LN185">185</td><td class="line">        <span class='keyword'>return</span> wstr;</td></tr>
<tr class="codeline" data-linenumber="186"><td class="num" id="LN186">186</td><td class="line">    <span class='keyword'>if</span> (FAILED(appdataFactory-&gt;get_Current(appdataRef.ReleaseAndGetAddressOf())))</td></tr>
<tr class="codeline" data-linenumber="187"><td class="num" id="LN187">187</td><td class="line">        <span class='keyword'>return</span> wstr;</td></tr>
<tr class="codeline" data-linenumber="188"><td class="num" id="LN188">188</td><td class="line">    <span class='keyword'>if</span> (FAILED(appdataRef-&gt;get_TemporaryFolder(storagefolderRef.ReleaseAndGetAddressOf())))</td></tr>
<tr class="codeline" data-linenumber="189"><td class="num" id="LN189">189</td><td class="line">        <span class='keyword'>return</span> wstr;</td></tr>
<tr class="codeline" data-linenumber="190"><td class="num" id="LN190">190</td><td class="line">    <span class='keyword'>if</span> (FAILED(storagefolderRef.As(&amp;storageitemRef)))</td></tr>
<tr class="codeline" data-linenumber="191"><td class="num" id="LN191">191</td><td class="line">        <span class='keyword'>return</span> wstr;</td></tr>
<tr class="codeline" data-linenumber="192"><td class="num" id="LN192">192</td><td class="line">    str = <span class='macro'>NULL<span class='macro_popup'>__null</span></span>;</td></tr>
<tr class="codeline" data-linenumber="193"><td class="num" id="LN193">193</td><td class="line">    <span class='keyword'>if</span> (FAILED(storageitemRef-&gt;get_Path(&amp;str)))</td></tr>
<tr class="codeline" data-linenumber="194"><td class="num" id="LN194">194</td><td class="line">        <span class='keyword'>return</span> wstr;</td></tr>
<tr class="codeline" data-linenumber="195"><td class="num" id="LN195">195</td><td class="line">    wstr = WindowsGetStringRawBuffer(str, <span class='macro'>NULL<span class='macro_popup'>__null</span></span>);</td></tr>
<tr class="codeline" data-linenumber="196"><td class="num" id="LN196">196</td><td class="line">    WindowsDeleteString(str);</td></tr>
<tr class="codeline" data-linenumber="197"><td class="num" id="LN197">197</td><td class="line">    <span class='keyword'>return</span> wstr;</td></tr>
<tr class="codeline" data-linenumber="198"><td class="num" id="LN198">198</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="199"><td class="num" id="LN199">199</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="200"><td class="num" id="LN200">200</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="201"><td class="num" id="LN201">201</td><td class="line">std::wstring GetTempFileNameWinRT(std::wstring prefix)</td></tr>
<tr class="codeline" data-linenumber="202"><td class="num" id="LN202">202</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="203"><td class="num" id="LN203">203</td><td class="line">    <span class='keyword'>wchar_t</span> guidStr[40];</td></tr>
<tr class="codeline" data-linenumber="204"><td class="num" id="LN204">204</td><td class="line">    GUID g;</td></tr>
<tr class="codeline" data-linenumber="205"><td class="num" id="LN205">205</td><td class="line">    CoCreateGuid(&amp;g);</td></tr>
<tr class="codeline" data-linenumber="206"><td class="num" id="LN206">206</td><td class="line">    <span class='keyword'>wchar_t</span>* mask = L<span class='string_literal'>"%08x_%04x_%04x_%02x%02x_%02x%02x%02x%02x%02x%02x"</span>;</td></tr>
<tr class="codeline" data-linenumber="207"><td class="num" id="LN207">207</td><td class="line">    swprintf(&amp;guidStr[0], <span class='keyword'>sizeof</span>(guidStr)/<span class='keyword'>sizeof</span>(<span class='keyword'>wchar_t</span>), mask,</td></tr>
<tr class="codeline" data-linenumber="208"><td class="num" id="LN208">208</td><td class="line">             g.Data1, g.Data2, g.Data3, UINT(g.Data4[0]), UINT(g.Data4[1]),</td></tr>
<tr class="codeline" data-linenumber="209"><td class="num" id="LN209">209</td><td class="line">             UINT(g.Data4[2]), UINT(g.Data4[3]), UINT(g.Data4[4]),</td></tr>
<tr class="codeline" data-linenumber="210"><td class="num" id="LN210">210</td><td class="line">             UINT(g.Data4[5]), UINT(g.Data4[6]), UINT(g.Data4[7]));</td></tr>
<tr class="codeline" data-linenumber="211"><td class="num" id="LN211">211</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="212"><td class="num" id="LN212">212</td><td class="line">    <span class='keyword'>return</span> prefix.append(std::wstring(guidStr));</td></tr>
<tr class="codeline" data-linenumber="213"><td class="num" id="LN213">213</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="214"><td class="num" id="LN214">214</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="215"><td class="num" id="LN215">215</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="216"><td class="num" id="LN216">216</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="217"><td class="num" id="LN217">217</td><td class="line"><span class='directive'>#include &lt;pthread.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="218"><td class="num" id="LN218">218</td><td class="line"><span class='directive'>#include &lt;sys/time.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="219"><td class="num" id="LN219">219</td><td class="line"><span class='directive'>#include &lt;time.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="220"><td class="num" id="LN220">220</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="221"><td class="num" id="LN221">221</td><td class="line"><span class='directive'>#if defined __MACH__ &amp;&amp; defined __APPLE__</span></td></tr>
<tr class="codeline" data-linenumber="222"><td class="num" id="LN222">222</td><td class="line"><span class='directive'>#include &lt;mach/mach.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="223"><td class="num" id="LN223">223</td><td class="line"><span class='directive'>#include &lt;mach/mach_time.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="224"><td class="num" id="LN224">224</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="225"><td class="num" id="LN225">225</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="226"><td class="num" id="LN226">226</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="227"><td class="num" id="LN227">227</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="228"><td class="num" id="LN228">228</td><td class="line"><span class='directive'>#ifdef _OPENMP</span></td></tr>
<tr class="codeline" data-linenumber="229"><td class="num" id="LN229">229</td><td class="line"><span class='directive'>#include "omp.h"</span></td></tr>
<tr class="codeline" data-linenumber="230"><td class="num" id="LN230">230</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="231"><td class="num" id="LN231">231</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="232"><td class="num" id="LN232">232</td><td class="line"><span class='directive'>#if defined <span class='macro'>__linux__<span class='macro_popup'>1</span></span> || defined __APPLE__ || defined __EMSCRIPTEN__ || defined __FreeBSD__ || defined <span class='macro'>__GLIBC__<span class='macro_popup'>2</span></span> || defined __HAIKU__</span></td></tr>
<tr class="codeline" data-linenumber="233"><td class="num" id="LN233">233</td><td class="line"><span class='directive'>#include &lt;unistd.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="234"><td class="num" id="LN234">234</td><td class="line"><span class='directive'>#include &lt;stdio.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="235"><td class="num" id="LN235">235</td><td class="line"><span class='directive'>#include &lt;sys/types.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="236"><td class="num" id="LN236">236</td><td class="line"><span class='directive'>#if defined __ANDROID__</span></td></tr>
<tr class="codeline" data-linenumber="237"><td class="num" id="LN237">237</td><td class="line"><span class='directive'>#include &lt;sys/sysconf.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="238"><td class="num" id="LN238">238</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="239"><td class="num" id="LN239">239</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="240"><td class="num" id="LN240">240</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="241"><td class="num" id="LN241">241</td><td class="line"><span class='directive'>#ifdef __ANDROID__</span></td></tr>
<tr class="codeline" data-linenumber="242"><td class="num" id="LN242">242</td><td class="line"><span class='directive'># include &lt;android/log.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="243"><td class="num" id="LN243">243</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="244"><td class="num" id="LN244">244</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="245"><td class="num" id="LN245">245</td><td class="line"><span class='directive'>#ifdef DECLARE_CV_CPUID_X86</span></td></tr>
<tr class="codeline" data-linenumber="246"><td class="num" id="LN246">246</td><td class="line">DECLARE_CV_CPUID_X86</td></tr>
<tr class="codeline" data-linenumber="247"><td class="num" id="LN247">247</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="248"><td class="num" id="LN248">248</td><td class="line"><span class='directive'>#ifndef CV_CPUID_X86</span></td></tr>
<tr class="codeline" data-linenumber="249"><td class="num" id="LN249">249</td><td class="line">  <span class='directive'>#if defined _MSC_VER &amp;&amp; (defined _M_IX86 || defined _M_X64)</span></td></tr>
<tr class="codeline" data-linenumber="250"><td class="num" id="LN250">250</td><td class="line">    <span class='directive'>#if _MSC_VER &gt;= 1400  // MSVS 2005</span></td></tr>
<tr class="codeline" data-linenumber="251"><td class="num" id="LN251">251</td><td class="line">      <span class='directive'>#include &lt;intrin.h&gt;  // __cpuidex()</span></td></tr>
<tr class="codeline" data-linenumber="252"><td class="num" id="LN252">252</td><td class="line">      <span class='directive'>#define CV_CPUID_X86 __cpuidex</span></td></tr>
<tr class="codeline" data-linenumber="253"><td class="num" id="LN253">253</td><td class="line">    <span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="254"><td class="num" id="LN254">254</td><td class="line">      <span class='directive'>#error "Required MSVS 2005+"</span></td></tr>
<tr class="codeline" data-linenumber="255"><td class="num" id="LN255">255</td><td class="line">    <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="256"><td class="num" id="LN256">256</td><td class="line">  <span class='directive'>#elif defined <span class='macro'>__GNUC__<span class='macro_popup'>4</span></span> &amp;&amp; (defined __i386__ || defined <span class='macro'>__x86_64__<span class='macro_popup'>1</span></span>)</span></td></tr>
<tr class="codeline" data-linenumber="257"><td class="num" id="LN257">257</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>void</span> cv_cpuid(<span class='keyword'>int</span>* cpuid_data, <span class='keyword'>int</span> reg_eax, <span class='keyword'>int</span> reg_ecx)</td></tr>
<tr class="codeline" data-linenumber="258"><td class="num" id="LN258">258</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="259"><td class="num" id="LN259">259</td><td class="line">        <span class='keyword'>int</span> __eax = reg_eax, __ebx = 0, __ecx = reg_ecx, __edx = 0;</td></tr>
<tr class="codeline" data-linenumber="260"><td class="num" id="LN260">260</td><td class="line"><span class='comment'>// tested with available compilers (-fPIC -O2 -m32/-m64): https://godbolt.org/</span></td></tr>
<tr class="codeline" data-linenumber="261"><td class="num" id="LN261">261</td><td class="line"><span class='directive'>#if !defined(<span class='macro'>__PIC__<span class='macro_popup'>2</span></span>) \</span></td></tr>
<tr class="codeline" data-linenumber="262"><td class="num" id="LN262">262</td><td class="line">    <span class='directive'>|| defined(<span class='macro'>__x86_64__<span class='macro_popup'>1</span></span>) || <span class='macro'>__GNUC__<span class='macro_popup'>4</span></span> &gt;= 5 \</span></td></tr>
<tr class="codeline" data-linenumber="263"><td class="num" id="LN263">263</td><td class="line">    <span class='directive'>|| defined(<span class='macro'>__clang__<span class='macro_popup'>1</span></span>) || defined(__INTEL_COMPILER)</span></td></tr>
<tr class="codeline" data-linenumber="264"><td class="num" id="LN264">264</td><td class="line">        <span class='keyword'>__asm__</span>(<span class='string_literal'>"cpuid\n\t"</span></td></tr>
<tr class="codeline" data-linenumber="265"><td class="num" id="LN265">265</td><td class="line">                : <span class='string_literal'>"+a"</span> (__eax), <span class='string_literal'>"=b"</span> (__ebx), <span class='string_literal'>"+c"</span> (__ecx), <span class='string_literal'>"=d"</span> (__edx)</td></tr>
<tr class="codeline" data-linenumber="266"><td class="num" id="LN266">266</td><td class="line">        );</td></tr>
<tr class="codeline" data-linenumber="267"><td class="num" id="LN267">267</td><td class="line"><span class='directive'>#elif defined(__i386__)  // ebx may be reserved as the PIC register</span></td></tr>
<tr class="codeline" data-linenumber="268"><td class="num" id="LN268">268</td><td class="line">        <span class='keyword'>__asm__</span>(<span class='string_literal'>"xchg{l}\t{%%}ebx, %1\n\t"</span></td></tr>
<tr class="codeline" data-linenumber="269"><td class="num" id="LN269">269</td><td class="line">                <span class='string_literal'>"cpuid\n\t"</span></td></tr>
<tr class="codeline" data-linenumber="270"><td class="num" id="LN270">270</td><td class="line">                <span class='string_literal'>"xchg{l}\t{%%}ebx, %1\n\t"</span></td></tr>
<tr class="codeline" data-linenumber="271"><td class="num" id="LN271">271</td><td class="line">                : <span class='string_literal'>"+a"</span> (__eax), <span class='string_literal'>"=&amp;r"</span> (__ebx), <span class='string_literal'>"+c"</span> (__ecx), <span class='string_literal'>"=d"</span> (__edx)</td></tr>
<tr class="codeline" data-linenumber="272"><td class="num" id="LN272">272</td><td class="line">        );</td></tr>
<tr class="codeline" data-linenumber="273"><td class="num" id="LN273">273</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="274"><td class="num" id="LN274">274</td><td class="line"><span class='directive'>#error "Configuration error"</span></td></tr>
<tr class="codeline" data-linenumber="275"><td class="num" id="LN275">275</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="276"><td class="num" id="LN276">276</td><td class="line">        cpuid_data[0] = __eax; cpuid_data[1] = __ebx; cpuid_data[2] = __ecx; cpuid_data[3] = __edx;</td></tr>
<tr class="codeline" data-linenumber="277"><td class="num" id="LN277">277</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="278"><td class="num" id="LN278">278</td><td class="line">    <span class='directive'>#define CV_CPUID_X86 cv_cpuid</span></td></tr>
<tr class="codeline" data-linenumber="279"><td class="num" id="LN279">279</td><td class="line">  <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="280"><td class="num" id="LN280">280</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="281"><td class="num" id="LN281">281</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="282"><td class="num" id="LN282">282</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="283"><td class="num" id="LN283">283</td><td class="line"><span class='keyword'>namespace</span> cv</td></tr>
<tr class="codeline" data-linenumber="284"><td class="num" id="LN284">284</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="285"><td class="num" id="LN285">285</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="286"><td class="num" id="LN286">286</td><td class="line">Exception::Exception() { code = 0; line = 0; }</td></tr>
<tr class="codeline" data-linenumber="287"><td class="num" id="LN287">287</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="288"><td class="num" id="LN288">288</td><td class="line">Exception::Exception(<span class='keyword'>int</span> _code, <span class='keyword'>const</span> String&amp; _err, <span class='keyword'>const</span> String&amp; _func, <span class='keyword'>const</span> String&amp; _file, <span class='keyword'>int</span> _line)</td></tr>
<tr class="codeline" data-linenumber="289"><td class="num" id="LN289">289</td><td class="line">: code(_code), err(_err), func(_func), file(_file), line(_line)</td></tr>
<tr class="codeline" data-linenumber="290"><td class="num" id="LN290">290</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="291"><td class="num" id="LN291">291</td><td class="line">    formatMessage();</td></tr>
<tr class="codeline" data-linenumber="292"><td class="num" id="LN292">292</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="293"><td class="num" id="LN293">293</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="294"><td class="num" id="LN294">294</td><td class="line">Exception::~Exception() <span class='keyword'>throw</span>() {}</td></tr>
<tr class="codeline" data-linenumber="295"><td class="num" id="LN295">295</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="296"><td class="num" id="LN296">296</td><td class="line"><span class='comment'>/*!</span></td></tr>
<tr class="codeline" data-linenumber="297"><td class="num" id="LN297">297</td><td class="line"> <span class='comment'>\return the error description and the context as a text string.</span></td></tr>
<tr class="codeline" data-linenumber="298"><td class="num" id="LN298">298</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="299"><td class="num" id="LN299">299</td><td class="line"><span class='keyword'>const</span> <span class='keyword'>char</span>* Exception::what() <span class='keyword'>const</span> <span class='keyword'>throw</span>() { <span class='keyword'>return</span> msg.c_str(); }</td></tr>
<tr class="codeline" data-linenumber="300"><td class="num" id="LN300">300</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="301"><td class="num" id="LN301">301</td><td class="line"><span class='keyword'>void</span> Exception::formatMessage()</td></tr>
<tr class="codeline" data-linenumber="302"><td class="num" id="LN302">302</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="303"><td class="num" id="LN303">303</td><td class="line">    size_t pos = err.find('\n');</td></tr>
<tr class="codeline" data-linenumber="304"><td class="num" id="LN304">304</td><td class="line">    <span class='keyword'>bool</span> multiline = pos != cv::String::npos;</td></tr>
<tr class="codeline" data-linenumber="305"><td class="num" id="LN305">305</td><td class="line">    <span class='keyword'>if</span> (multiline)</td></tr>
<tr class="codeline" data-linenumber="306"><td class="num" id="LN306">306</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="307"><td class="num" id="LN307">307</td><td class="line">        std::stringstream ss;</td></tr>
<tr class="codeline" data-linenumber="308"><td class="num" id="LN308">308</td><td class="line">        size_t prev_pos = 0;</td></tr>
<tr class="codeline" data-linenumber="309"><td class="num" id="LN309">309</td><td class="line">        <span class='keyword'>while</span> (pos != cv::String::npos)</td></tr>
<tr class="codeline" data-linenumber="310"><td class="num" id="LN310">310</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="311"><td class="num" id="LN311">311</td><td class="line">           ss &lt;&lt; <span class='string_literal'>"&gt; "</span> &lt;&lt; err.substr(prev_pos, pos - prev_pos) &lt;&lt; std::endl;</td></tr>
<tr class="codeline" data-linenumber="312"><td class="num" id="LN312">312</td><td class="line">           prev_pos = pos + 1;</td></tr>
<tr class="codeline" data-linenumber="313"><td class="num" id="LN313">313</td><td class="line">           pos = err.find('\n', prev_pos);</td></tr>
<tr class="codeline" data-linenumber="314"><td class="num" id="LN314">314</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="315"><td class="num" id="LN315">315</td><td class="line">        ss &lt;&lt; <span class='string_literal'>"&gt; "</span> &lt;&lt; err.substr(prev_pos);</td></tr>
<tr class="codeline" data-linenumber="316"><td class="num" id="LN316">316</td><td class="line">        <span class='keyword'>if</span> (err[err.size() - 1] != '\n')</td></tr>
<tr class="codeline" data-linenumber="317"><td class="num" id="LN317">317</td><td class="line">            ss &lt;&lt; std::endl;</td></tr>
<tr class="codeline" data-linenumber="318"><td class="num" id="LN318">318</td><td class="line">        err = ss.str();</td></tr>
<tr class="codeline" data-linenumber="319"><td class="num" id="LN319">319</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="320"><td class="num" id="LN320">320</td><td class="line">    <span class='keyword'>if</span> (func.size() &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="321"><td class="num" id="LN321">321</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="322"><td class="num" id="LN322">322</td><td class="line">        <span class='keyword'>if</span> (multiline)</td></tr>
<tr class="codeline" data-linenumber="323"><td class="num" id="LN323">323</td><td class="line">            msg = format(<span class='string_literal'>"OpenCV(%s) %s:%d: error: (%d:%s) in function '%s'\n%s"</span>, <span class='macro'>CV_VERSION<span class='macro_popup'>"4" "." "5" "." "2" ""</span></span>, file.c_str(), line, code, cvErrorStr(code), func.c_str(), err.c_str());</td></tr>
<tr class="codeline" data-linenumber="324"><td class="num" id="LN324">324</td><td class="line">        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="325"><td class="num" id="LN325">325</td><td class="line">            msg = format(<span class='string_literal'>"OpenCV(%s) %s:%d: error: (%d:%s) %s in function '%s'\n"</span>, <span class='macro'>CV_VERSION<span class='macro_popup'>"4" "." "5" "." "2" ""</span></span>, file.c_str(), line, code, cvErrorStr(code), err.c_str(), func.c_str());</td></tr>
<tr class="codeline" data-linenumber="326"><td class="num" id="LN326">326</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="327"><td class="num" id="LN327">327</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="328"><td class="num" id="LN328">328</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="329"><td class="num" id="LN329">329</td><td class="line">        msg = format(<span class='string_literal'>"OpenCV(%s) %s:%d: error: (%d:%s) %s%s"</span>, <span class='macro'>CV_VERSION<span class='macro_popup'>"4" "." "5" "." "2" ""</span></span>, file.c_str(), line, code, cvErrorStr(code), err.c_str(), multiline ? <span class='string_literal'>""</span> : <span class='string_literal'>"\n"</span>);</td></tr>
<tr class="codeline" data-linenumber="330"><td class="num" id="LN330">330</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="331"><td class="num" id="LN331">331</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="332"><td class="num" id="LN332">332</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="333"><td class="num" id="LN333">333</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span>* g_hwFeatureNames[<span class='macro'>CV_HARDWARE_MAX_FEATURE<span class='macro_popup'>512</span></span>] = { <span class='macro'>NULL<span class='macro_popup'>__null</span></span> };</td></tr>
<tr class="codeline" data-linenumber="334"><td class="num" id="LN334">334</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="335"><td class="num" id="LN335">335</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span>* getHWFeatureName(<span class='keyword'>int</span> id)</td></tr>
<tr class="codeline" data-linenumber="336"><td class="num" id="LN336">336</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="337"><td class="num" id="LN337">337</td><td class="line">    <span class='keyword'>return</span> (id &lt; <span class='macro'>CV_HARDWARE_MAX_FEATURE<span class='macro_popup'>512</span></span>) ? g_hwFeatureNames[id] : <span class='macro'>NULL<span class='macro_popup'>__null</span></span>;</td></tr>
<tr class="codeline" data-linenumber="338"><td class="num" id="LN338">338</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="339"><td class="num" id="LN339">339</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span>* getHWFeatureNameSafe(<span class='keyword'>int</span> id)</td></tr>
<tr class="codeline" data-linenumber="340"><td class="num" id="LN340">340</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="341"><td class="num" id="LN341">341</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>char</span>* name = getHWFeatureName(id);</td></tr>
<tr class="codeline" data-linenumber="342"><td class="num" id="LN342">342</td><td class="line">    <span class='keyword'>return</span> name ? name : <span class='string_literal'>"Unknown feature"</span>;</td></tr>
<tr class="codeline" data-linenumber="343"><td class="num" id="LN343">343</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="344"><td class="num" id="LN344">344</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="345"><td class="num" id="LN345">345</td><td class="line"><span class='keyword'>struct</span> HWFeatures</td></tr>
<tr class="codeline" data-linenumber="346"><td class="num" id="LN346">346</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="347"><td class="num" id="LN347">347</td><td class="line">    <span class='keyword'>enum</span> { MAX_FEATURE = <span class='macro'>CV_HARDWARE_MAX_FEATURE<span class='macro_popup'>512</span></span> };</td></tr>
<tr class="codeline" data-linenumber="348"><td class="num" id="LN348">348</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="349"><td class="num" id="LN349">349</td><td class="line">    HWFeatures(<span class='keyword'>bool</span> run_initialize = <span class='keyword'>false</span>)</td></tr>
<tr class="codeline" data-linenumber="350"><td class="num" id="LN350">350</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="351"><td class="num" id="LN351">351</td><td class="line">        <span class='keyword'>if</span> (run_initialize)</td></tr>
<tr class="codeline" data-linenumber="352"><td class="num" id="LN352">352</td><td class="line">            initialize();</td></tr>
<tr class="codeline" data-linenumber="353"><td class="num" id="LN353">353</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="354"><td class="num" id="LN354">354</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="355"><td class="num" id="LN355">355</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>void</span> initializeNames()</td></tr>
<tr class="codeline" data-linenumber="356"><td class="num" id="LN356">356</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="357"><td class="num" id="LN357">357</td><td class="line">        <span class='keyword'>for</span> (<span class='keyword'>int</span> i = 0; i &lt; <span class='macro'>CV_HARDWARE_MAX_FEATURE<span class='macro_popup'>512</span></span>; i++)</td></tr>
<tr class="codeline" data-linenumber="358"><td class="num" id="LN358">358</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="359"><td class="num" id="LN359">359</td><td class="line">            g_hwFeatureNames[i] = 0;</td></tr>
<tr class="codeline" data-linenumber="360"><td class="num" id="LN360">360</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="361"><td class="num" id="LN361">361</td><td class="line">        g_hwFeatureNames[CPU_MMX] = <span class='string_literal'>"MMX"</span>;</td></tr>
<tr class="codeline" data-linenumber="362"><td class="num" id="LN362">362</td><td class="line">        g_hwFeatureNames[CPU_SSE] = <span class='string_literal'>"SSE"</span>;</td></tr>
<tr class="codeline" data-linenumber="363"><td class="num" id="LN363">363</td><td class="line">        g_hwFeatureNames[CPU_SSE2] = <span class='string_literal'>"SSE2"</span>;</td></tr>
<tr class="codeline" data-linenumber="364"><td class="num" id="LN364">364</td><td class="line">        g_hwFeatureNames[CPU_SSE3] = <span class='string_literal'>"SSE3"</span>;</td></tr>
<tr class="codeline" data-linenumber="365"><td class="num" id="LN365">365</td><td class="line">        g_hwFeatureNames[CPU_SSSE3] = <span class='string_literal'>"SSSE3"</span>;</td></tr>
<tr class="codeline" data-linenumber="366"><td class="num" id="LN366">366</td><td class="line">        g_hwFeatureNames[CPU_SSE4_1] = <span class='string_literal'>"SSE4.1"</span>;</td></tr>
<tr class="codeline" data-linenumber="367"><td class="num" id="LN367">367</td><td class="line">        g_hwFeatureNames[CPU_SSE4_2] = <span class='string_literal'>"SSE4.2"</span>;</td></tr>
<tr class="codeline" data-linenumber="368"><td class="num" id="LN368">368</td><td class="line">        g_hwFeatureNames[CPU_POPCNT] = <span class='string_literal'>"POPCNT"</span>;</td></tr>
<tr class="codeline" data-linenumber="369"><td class="num" id="LN369">369</td><td class="line">        g_hwFeatureNames[CPU_FP16] = <span class='string_literal'>"FP16"</span>;</td></tr>
<tr class="codeline" data-linenumber="370"><td class="num" id="LN370">370</td><td class="line">        g_hwFeatureNames[CPU_AVX] = <span class='string_literal'>"AVX"</span>;</td></tr>
<tr class="codeline" data-linenumber="371"><td class="num" id="LN371">371</td><td class="line">        g_hwFeatureNames[CPU_AVX2] = <span class='string_literal'>"AVX2"</span>;</td></tr>
<tr class="codeline" data-linenumber="372"><td class="num" id="LN372">372</td><td class="line">        g_hwFeatureNames[CPU_FMA3] = <span class='string_literal'>"FMA3"</span>;</td></tr>
<tr class="codeline" data-linenumber="373"><td class="num" id="LN373">373</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="374"><td class="num" id="LN374">374</td><td class="line">        g_hwFeatureNames[CPU_AVX_512F] = <span class='string_literal'>"AVX512F"</span>;</td></tr>
<tr class="codeline" data-linenumber="375"><td class="num" id="LN375">375</td><td class="line">        g_hwFeatureNames[CPU_AVX_512BW] = <span class='string_literal'>"AVX512BW"</span>;</td></tr>
<tr class="codeline" data-linenumber="376"><td class="num" id="LN376">376</td><td class="line">        g_hwFeatureNames[CPU_AVX_512CD] = <span class='string_literal'>"AVX512CD"</span>;</td></tr>
<tr class="codeline" data-linenumber="377"><td class="num" id="LN377">377</td><td class="line">        g_hwFeatureNames[CPU_AVX_512DQ] = <span class='string_literal'>"AVX512DQ"</span>;</td></tr>
<tr class="codeline" data-linenumber="378"><td class="num" id="LN378">378</td><td class="line">        g_hwFeatureNames[CPU_AVX_512ER] = <span class='string_literal'>"AVX512ER"</span>;</td></tr>
<tr class="codeline" data-linenumber="379"><td class="num" id="LN379">379</td><td class="line">        g_hwFeatureNames[CPU_AVX_512IFMA] = <span class='string_literal'>"AVX512IFMA"</span>;</td></tr>
<tr class="codeline" data-linenumber="380"><td class="num" id="LN380">380</td><td class="line">        g_hwFeatureNames[CPU_AVX_512PF] = <span class='string_literal'>"AVX512PF"</span>;</td></tr>
<tr class="codeline" data-linenumber="381"><td class="num" id="LN381">381</td><td class="line">        g_hwFeatureNames[CPU_AVX_512VBMI] = <span class='string_literal'>"AVX512VBMI"</span>;</td></tr>
<tr class="codeline" data-linenumber="382"><td class="num" id="LN382">382</td><td class="line">        g_hwFeatureNames[CPU_AVX_512VL] = <span class='string_literal'>"AVX512VL"</span>;</td></tr>
<tr class="codeline" data-linenumber="383"><td class="num" id="LN383">383</td><td class="line">        g_hwFeatureNames[CPU_AVX_512VBMI2] = <span class='string_literal'>"AVX512VBMI2"</span>;</td></tr>
<tr class="codeline" data-linenumber="384"><td class="num" id="LN384">384</td><td class="line">        g_hwFeatureNames[CPU_AVX_512VNNI] = <span class='string_literal'>"AVX512VNNI"</span>;</td></tr>
<tr class="codeline" data-linenumber="385"><td class="num" id="LN385">385</td><td class="line">        g_hwFeatureNames[CPU_AVX_512BITALG] = <span class='string_literal'>"AVX512BITALG"</span>;</td></tr>
<tr class="codeline" data-linenumber="386"><td class="num" id="LN386">386</td><td class="line">        g_hwFeatureNames[CPU_AVX_512VPOPCNTDQ] = <span class='string_literal'>"AVX512VPOPCNTDQ"</span>;</td></tr>
<tr class="codeline" data-linenumber="387"><td class="num" id="LN387">387</td><td class="line">        g_hwFeatureNames[CPU_AVX_5124VNNIW] = <span class='string_literal'>"AVX5124VNNIW"</span>;</td></tr>
<tr class="codeline" data-linenumber="388"><td class="num" id="LN388">388</td><td class="line">        g_hwFeatureNames[CPU_AVX_5124FMAPS] = <span class='string_literal'>"AVX5124FMAPS"</span>;</td></tr>
<tr class="codeline" data-linenumber="389"><td class="num" id="LN389">389</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="390"><td class="num" id="LN390">390</td><td class="line">        g_hwFeatureNames[CPU_NEON] = <span class='string_literal'>"NEON"</span>;</td></tr>
<tr class="codeline" data-linenumber="391"><td class="num" id="LN391">391</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="392"><td class="num" id="LN392">392</td><td class="line">        g_hwFeatureNames[CPU_VSX] = <span class='string_literal'>"VSX"</span>;</td></tr>
<tr class="codeline" data-linenumber="393"><td class="num" id="LN393">393</td><td class="line">        g_hwFeatureNames[CPU_VSX3] = <span class='string_literal'>"VSX3"</span>;</td></tr>
<tr class="codeline" data-linenumber="394"><td class="num" id="LN394">394</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="395"><td class="num" id="LN395">395</td><td class="line">        g_hwFeatureNames[CPU_MSA] = <span class='string_literal'>"CPU_MSA"</span>;</td></tr>
<tr class="codeline" data-linenumber="396"><td class="num" id="LN396">396</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="397"><td class="num" id="LN397">397</td><td class="line">        g_hwFeatureNames[CPU_AVX512_COMMON] = <span class='string_literal'>"AVX512-COMMON"</span>;</td></tr>
<tr class="codeline" data-linenumber="398"><td class="num" id="LN398">398</td><td class="line">        g_hwFeatureNames[CPU_AVX512_SKX] = <span class='string_literal'>"AVX512-SKX"</span>;</td></tr>
<tr class="codeline" data-linenumber="399"><td class="num" id="LN399">399</td><td class="line">        g_hwFeatureNames[CPU_AVX512_KNL] = <span class='string_literal'>"AVX512-KNL"</span>;</td></tr>
<tr class="codeline" data-linenumber="400"><td class="num" id="LN400">400</td><td class="line">        g_hwFeatureNames[CPU_AVX512_KNM] = <span class='string_literal'>"AVX512-KNM"</span>;</td></tr>
<tr class="codeline" data-linenumber="401"><td class="num" id="LN401">401</td><td class="line">        g_hwFeatureNames[CPU_AVX512_CNL] = <span class='string_literal'>"AVX512-CNL"</span>;</td></tr>
<tr class="codeline" data-linenumber="402"><td class="num" id="LN402">402</td><td class="line">        g_hwFeatureNames[CPU_AVX512_CLX] = <span class='string_literal'>"AVX512-CLX"</span>;</td></tr>
<tr class="codeline" data-linenumber="403"><td class="num" id="LN403">403</td><td class="line">        g_hwFeatureNames[CPU_AVX512_ICL] = <span class='string_literal'>"AVX512-ICL"</span>;</td></tr>
<tr class="codeline" data-linenumber="404"><td class="num" id="LN404">404</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="405"><td class="num" id="LN405">405</td><td class="line">        g_hwFeatureNames[CPU_RVV] = <span class='string_literal'>"RVV"</span>;</td></tr>
<tr class="codeline" data-linenumber="406"><td class="num" id="LN406">406</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="407"><td class="num" id="LN407">407</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="408"><td class="num" id="LN408">408</td><td class="line">    <span class='keyword'>void</span> initialize(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="409"><td class="num" id="LN409">409</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="410"><td class="num" id="LN410">410</td><td class="line"><span class='directive'>#ifndef NO_GETENV</span></td></tr>
<tr class="codeline" data-linenumber="411"><td class="num" id="LN411">411</td><td class="line">        <span class='keyword'>if</span> (getenv(<span class='string_literal'>"OPENCV_DUMP_CONFIG"</span>))</td></tr>
<tr class="codeline" data-linenumber="412"><td class="num" id="LN412">412</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="413"><td class="num" id="LN413">413</td><td class="line">            fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, <span class='string_literal'>"\nOpenCV build configuration is:\n%s\n"</span>,</td></tr>
<tr class="codeline" data-linenumber="414"><td class="num" id="LN414">414</td><td class="line">                cv::getBuildInformation().c_str());</td></tr>
<tr class="codeline" data-linenumber="415"><td class="num" id="LN415">415</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="416"><td class="num" id="LN416">416</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="417"><td class="num" id="LN417">417</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="418"><td class="num" id="LN418">418</td><td class="line">        initializeNames();</td></tr>
<tr class="codeline" data-linenumber="419"><td class="num" id="LN419">419</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="420"><td class="num" id="LN420">420</td><td class="line">    <span class='directive'>#ifdef CV_CPUID_X86</span></td></tr>
<tr class="codeline" data-linenumber="421"><td class="num" id="LN421">421</td><td class="line">        <span class='keyword'>int</span> cpuid_data[4] = { 0, 0, 0, 0 };</td></tr>
<tr class="codeline" data-linenumber="422"><td class="num" id="LN422">422</td><td class="line">        <span class='keyword'>int</span> cpuid_data_ex[4] = { 0, 0, 0, 0 };</td></tr>
<tr class="codeline" data-linenumber="423"><td class="num" id="LN423">423</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="424"><td class="num" id="LN424">424</td><td class="line">        CV_CPUID_X86(cpuid_data, 1, 0<span class='comment'>/*unused*/</span>);</td></tr>
<tr class="codeline" data-linenumber="425"><td class="num" id="LN425">425</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="426"><td class="num" id="LN426">426</td><td class="line">        <span class='keyword'>int</span> x86_family = (cpuid_data[0] &gt;&gt; 8) &amp; 15;</td></tr>
<tr class="codeline" data-linenumber="427"><td class="num" id="LN427">427</td><td class="line">        <span class='keyword'>if</span>( x86_family &gt;= 6 )</td></tr>
<tr class="codeline" data-linenumber="428"><td class="num" id="LN428">428</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="429"><td class="num" id="LN429">429</td><td class="line">            have[<span class='macro'>CV_CPU_MMX<span class='macro_popup'>1</span></span>]    = (cpuid_data[3] &amp; (1&lt;&lt;23)) != 0;</td></tr>
<tr class="codeline" data-linenumber="430"><td class="num" id="LN430">430</td><td class="line">            have[<span class='macro'>CV_CPU_SSE<span class='macro_popup'>2</span></span>]    = (cpuid_data[3] &amp; (1&lt;&lt;25)) != 0;</td></tr>
<tr class="codeline" data-linenumber="431"><td class="num" id="LN431">431</td><td class="line">            have[<span class='macro'>CV_CPU_SSE2<span class='macro_popup'>3</span></span>]   = (cpuid_data[3] &amp; (1&lt;&lt;26)) != 0;</td></tr>
<tr class="codeline" data-linenumber="432"><td class="num" id="LN432">432</td><td class="line">            have[<span class='macro'>CV_CPU_SSE3<span class='macro_popup'>4</span></span>]   = (cpuid_data[2] &amp; (1&lt;&lt;0)) != 0;</td></tr>
<tr class="codeline" data-linenumber="433"><td class="num" id="LN433">433</td><td class="line">            have[<span class='macro'>CV_CPU_SSSE3<span class='macro_popup'>5</span></span>]  = (cpuid_data[2] &amp; (1&lt;&lt;9)) != 0;</td></tr>
<tr class="codeline" data-linenumber="434"><td class="num" id="LN434">434</td><td class="line">            have[<span class='macro'>CV_CPU_FMA3<span class='macro_popup'>12</span></span>]   = (cpuid_data[2] &amp; (1&lt;&lt;12)) != 0;</td></tr>
<tr class="codeline" data-linenumber="435"><td class="num" id="LN435">435</td><td class="line">            have[<span class='macro'>CV_CPU_SSE4_1<span class='macro_popup'>6</span></span>] = (cpuid_data[2] &amp; (1&lt;&lt;19)) != 0;</td></tr>
<tr class="codeline" data-linenumber="436"><td class="num" id="LN436">436</td><td class="line">            have[<span class='macro'>CV_CPU_SSE4_2<span class='macro_popup'>7</span></span>] = (cpuid_data[2] &amp; (1&lt;&lt;20)) != 0;</td></tr>
<tr class="codeline" data-linenumber="437"><td class="num" id="LN437">437</td><td class="line">            have[<span class='macro'>CV_CPU_POPCNT<span class='macro_popup'>8</span></span>] = (cpuid_data[2] &amp; (1&lt;&lt;23)) != 0;</td></tr>
<tr class="codeline" data-linenumber="438"><td class="num" id="LN438">438</td><td class="line">            have[<span class='macro'>CV_CPU_AVX<span class='macro_popup'>10</span></span>]    = (cpuid_data[2] &amp; (1&lt;&lt;28)) != 0;</td></tr>
<tr class="codeline" data-linenumber="439"><td class="num" id="LN439">439</td><td class="line">            have[<span class='macro'>CV_CPU_FP16<span class='macro_popup'>9</span></span>]   = (cpuid_data[2] &amp; (1&lt;&lt;29)) != 0;</td></tr>
<tr class="codeline" data-linenumber="440"><td class="num" id="LN440">440</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="441"><td class="num" id="LN441">441</td><td class="line">            <span class='comment'>// make the second call to the cpuid command in order to get</span></td></tr>
<tr class="codeline" data-linenumber="442"><td class="num" id="LN442">442</td><td class="line">            <span class='comment'>// information about extended features like AVX2</span></td></tr>
<tr class="codeline" data-linenumber="443"><td class="num" id="LN443">443</td><td class="line">            CV_CPUID_X86(cpuid_data_ex, 7, 0);</td></tr>
<tr class="codeline" data-linenumber="444"><td class="num" id="LN444">444</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="445"><td class="num" id="LN445">445</td><td class="line">            have[<span class='macro'>CV_CPU_AVX2<span class='macro_popup'>11</span></span>]   = (cpuid_data_ex[1] &amp; (1&lt;&lt;5)) != 0;</td></tr>
<tr class="codeline" data-linenumber="446"><td class="num" id="LN446">446</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="447"><td class="num" id="LN447">447</td><td class="line">            have[<span class='macro'>CV_CPU_AVX_512F<span class='macro_popup'>13</span></span>]         = (cpuid_data_ex[1] &amp; (1&lt;&lt;16)) != 0;</td></tr>
<tr class="codeline" data-linenumber="448"><td class="num" id="LN448">448</td><td class="line">            have[<span class='macro'>CV_CPU_AVX_512DQ<span class='macro_popup'>16</span></span>]        = (cpuid_data_ex[1] &amp; (1&lt;&lt;17)) != 0;</td></tr>
<tr class="codeline" data-linenumber="449"><td class="num" id="LN449">449</td><td class="line">            have[<span class='macro'>CV_CPU_AVX_512IFMA<span class='macro_popup'>18</span></span>]      = (cpuid_data_ex[1] &amp; (1&lt;&lt;21)) != 0;</td></tr>
<tr class="codeline" data-linenumber="450"><td class="num" id="LN450">450</td><td class="line">            have[<span class='macro'>CV_CPU_AVX_512PF<span class='macro_popup'>19</span></span>]        = (cpuid_data_ex[1] &amp; (1&lt;&lt;26)) != 0;</td></tr>
<tr class="codeline" data-linenumber="451"><td class="num" id="LN451">451</td><td class="line">            have[<span class='macro'>CV_CPU_AVX_512ER<span class='macro_popup'>17</span></span>]        = (cpuid_data_ex[1] &amp; (1&lt;&lt;27)) != 0;</td></tr>
<tr class="codeline" data-linenumber="452"><td class="num" id="LN452">452</td><td class="line">            have[<span class='macro'>CV_CPU_AVX_512CD<span class='macro_popup'>15</span></span>]        = (cpuid_data_ex[1] &amp; (1&lt;&lt;28)) != 0;</td></tr>
<tr class="codeline" data-linenumber="453"><td class="num" id="LN453">453</td><td class="line">            have[<span class='macro'>CV_CPU_AVX_512BW<span class='macro_popup'>14</span></span>]        = (cpuid_data_ex[1] &amp; (1&lt;&lt;30)) != 0;</td></tr>
<tr class="codeline" data-linenumber="454"><td class="num" id="LN454">454</td><td class="line">            have[<span class='macro'>CV_CPU_AVX_512VL<span class='macro_popup'>21</span></span>]        = (cpuid_data_ex[1] &amp; (1&lt;&lt;31)) != 0;</td></tr>
<tr class="codeline" data-linenumber="455"><td class="num" id="LN455">455</td><td class="line">            have[<span class='macro'>CV_CPU_AVX_512VBMI<span class='macro_popup'>20</span></span>]      = (cpuid_data_ex[2] &amp; (1&lt;&lt;1))  != 0;</td></tr>
<tr class="codeline" data-linenumber="456"><td class="num" id="LN456">456</td><td class="line">            have[<span class='macro'>CV_CPU_AVX_512VBMI2<span class='macro_popup'>22</span></span>]     = (cpuid_data_ex[2] &amp; (1&lt;&lt;6))  != 0;</td></tr>
<tr class="codeline" data-linenumber="457"><td class="num" id="LN457">457</td><td class="line">            have[<span class='macro'>CV_CPU_AVX_512VNNI<span class='macro_popup'>23</span></span>]      = (cpuid_data_ex[2] &amp; (1&lt;&lt;11)) != 0;</td></tr>
<tr class="codeline" data-linenumber="458"><td class="num" id="LN458">458</td><td class="line">            have[<span class='macro'>CV_CPU_AVX_512BITALG<span class='macro_popup'>24</span></span>]    = (cpuid_data_ex[2] &amp; (1&lt;&lt;12)) != 0;</td></tr>
<tr class="codeline" data-linenumber="459"><td class="num" id="LN459">459</td><td class="line">            have[<span class='macro'>CV_CPU_AVX_512VPOPCNTDQ<span class='macro_popup'>25</span></span>] = (cpuid_data_ex[2] &amp; (1&lt;&lt;14)) != 0;</td></tr>
<tr class="codeline" data-linenumber="460"><td class="num" id="LN460">460</td><td class="line">            have[<span class='macro'>CV_CPU_AVX_5124VNNIW<span class='macro_popup'>26</span></span>]    = (cpuid_data_ex[3] &amp; (1&lt;&lt;2))  != 0;</td></tr>
<tr class="codeline" data-linenumber="461"><td class="num" id="LN461">461</td><td class="line">            have[<span class='macro'>CV_CPU_AVX_5124FMAPS<span class='macro_popup'>27</span></span>]    = (cpuid_data_ex[3] &amp; (1&lt;&lt;3))  != 0;</td></tr>
<tr class="codeline" data-linenumber="462"><td class="num" id="LN462">462</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="463"><td class="num" id="LN463">463</td><td class="line">            <span class='keyword'>bool</span> have_AVX_OS_support = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="464"><td class="num" id="LN464">464</td><td class="line">            <span class='keyword'>bool</span> have_AVX512_OS_support = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="465"><td class="num" id="LN465">465</td><td class="line">            <span class='keyword'>if</span> (!(cpuid_data[2] &amp; (1&lt;&lt;27)))</td></tr>
<tr class="codeline" data-linenumber="466"><td class="num" id="LN466">466</td><td class="line">                have_AVX_OS_support = <span class='keyword'>false</span>; <span class='comment'>// OS uses XSAVE_XRSTORE and CPU support AVX</span></td></tr>
<tr class="codeline" data-linenumber="467"><td class="num" id="LN467">467</td><td class="line">            <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="468"><td class="num" id="LN468">468</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="469"><td class="num" id="LN469">469</td><td class="line">                <span class='keyword'>int</span> xcr0 = 0;</td></tr>
<tr class="codeline" data-linenumber="470"><td class="num" id="LN470">470</td><td class="line">            <span class='directive'>#ifdef _XCR_XFEATURE_ENABLED_MASK // requires immintrin.h</span></td></tr>
<tr class="codeline" data-linenumber="471"><td class="num" id="LN471">471</td><td class="line">                xcr0 = (<span class='keyword'>int</span>)_xgetbv(_XCR_XFEATURE_ENABLED_MASK);</td></tr>
<tr class="codeline" data-linenumber="472"><td class="num" id="LN472">472</td><td class="line">            <span class='directive'>#elif defined <span class='macro'>__GNUC__<span class='macro_popup'>4</span></span> &amp;&amp; (defined __i386__ || defined <span class='macro'>__x86_64__<span class='macro_popup'>1</span></span>)</span></td></tr>
<tr class="codeline" data-linenumber="473"><td class="num" id="LN473">473</td><td class="line">                <span class='keyword'>__asm__</span> (<span class='string_literal'>"xgetbv\n\t"</span> : <span class='string_literal'>"=a"</span> (xcr0) : <span class='string_literal'>"c"</span> (0) : <span class='string_literal'>"%edx"</span> );</td></tr>
<tr class="codeline" data-linenumber="474"><td class="num" id="LN474">474</td><td class="line">            <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="475"><td class="num" id="LN475">475</td><td class="line">                <span class='keyword'>if</span> ((xcr0 &amp; 0x6) != 0x6)</td></tr>
<tr class="codeline" data-linenumber="476"><td class="num" id="LN476">476</td><td class="line">                    have_AVX_OS_support = <span class='keyword'>false</span>; <span class='comment'>// YMM registers</span></td></tr>
<tr class="codeline" data-linenumber="477"><td class="num" id="LN477">477</td><td class="line">                <span class='keyword'>if</span> ((xcr0 &amp; 0xe6) != 0xe6)</td></tr>
<tr class="codeline" data-linenumber="478"><td class="num" id="LN478">478</td><td class="line">                    have_AVX512_OS_support = <span class='keyword'>false</span>; <span class='comment'>// ZMM registers</span></td></tr>
<tr class="codeline" data-linenumber="479"><td class="num" id="LN479">479</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="480"><td class="num" id="LN480">480</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="481"><td class="num" id="LN481">481</td><td class="line">            <span class='keyword'>if</span> (!have_AVX_OS_support)</td></tr>
<tr class="codeline" data-linenumber="482"><td class="num" id="LN482">482</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="483"><td class="num" id="LN483">483</td><td class="line">                have[<span class='macro'>CV_CPU_AVX<span class='macro_popup'>10</span></span>] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="484"><td class="num" id="LN484">484</td><td class="line">                have[<span class='macro'>CV_CPU_FP16<span class='macro_popup'>9</span></span>] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="485"><td class="num" id="LN485">485</td><td class="line">                have[<span class='macro'>CV_CPU_AVX2<span class='macro_popup'>11</span></span>] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="486"><td class="num" id="LN486">486</td><td class="line">                have[<span class='macro'>CV_CPU_FMA3<span class='macro_popup'>12</span></span>] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="487"><td class="num" id="LN487">487</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="488"><td class="num" id="LN488">488</td><td class="line">            <span class='keyword'>if</span> (!have_AVX_OS_support || !have_AVX512_OS_support)</td></tr>
<tr class="codeline" data-linenumber="489"><td class="num" id="LN489">489</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="490"><td class="num" id="LN490">490</td><td class="line">                have[<span class='macro'>CV_CPU_AVX_512F<span class='macro_popup'>13</span></span>] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="491"><td class="num" id="LN491">491</td><td class="line">                have[<span class='macro'>CV_CPU_AVX_512BW<span class='macro_popup'>14</span></span>] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="492"><td class="num" id="LN492">492</td><td class="line">                have[<span class='macro'>CV_CPU_AVX_512CD<span class='macro_popup'>15</span></span>] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="493"><td class="num" id="LN493">493</td><td class="line">                have[<span class='macro'>CV_CPU_AVX_512DQ<span class='macro_popup'>16</span></span>] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="494"><td class="num" id="LN494">494</td><td class="line">                have[<span class='macro'>CV_CPU_AVX_512ER<span class='macro_popup'>17</span></span>] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="495"><td class="num" id="LN495">495</td><td class="line">                have[<span class='macro'>CV_CPU_AVX_512IFMA<span class='macro_popup'>18</span></span>] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="496"><td class="num" id="LN496">496</td><td class="line">                have[<span class='macro'>CV_CPU_AVX_512PF<span class='macro_popup'>19</span></span>] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="497"><td class="num" id="LN497">497</td><td class="line">                have[<span class='macro'>CV_CPU_AVX_512VBMI<span class='macro_popup'>20</span></span>] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="498"><td class="num" id="LN498">498</td><td class="line">                have[<span class='macro'>CV_CPU_AVX_512VL<span class='macro_popup'>21</span></span>] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="499"><td class="num" id="LN499">499</td><td class="line">                have[<span class='macro'>CV_CPU_AVX_512VBMI2<span class='macro_popup'>22</span></span>] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="500"><td class="num" id="LN500">500</td><td class="line">                have[<span class='macro'>CV_CPU_AVX_512VNNI<span class='macro_popup'>23</span></span>] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="501"><td class="num" id="LN501">501</td><td class="line">                have[<span class='macro'>CV_CPU_AVX_512BITALG<span class='macro_popup'>24</span></span>] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="502"><td class="num" id="LN502">502</td><td class="line">                have[<span class='macro'>CV_CPU_AVX_512VPOPCNTDQ<span class='macro_popup'>25</span></span>] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="503"><td class="num" id="LN503">503</td><td class="line">                have[<span class='macro'>CV_CPU_AVX_5124VNNIW<span class='macro_popup'>26</span></span>] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="504"><td class="num" id="LN504">504</td><td class="line">                have[<span class='macro'>CV_CPU_AVX_5124FMAPS<span class='macro_popup'>27</span></span>] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="505"><td class="num" id="LN505">505</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="506"><td class="num" id="LN506">506</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="507"><td class="num" id="LN507">507</td><td class="line">            have[<span class='macro'>CV_CPU_AVX512_COMMON<span class='macro_popup'>257</span></span>] = have[<span class='macro'>CV_CPU_AVX_512F<span class='macro_popup'>13</span></span>] &amp;&amp; have[<span class='macro'>CV_CPU_AVX_512CD<span class='macro_popup'>15</span></span>];</td></tr>
<tr class="codeline" data-linenumber="508"><td class="num" id="LN508">508</td><td class="line">            <span class='keyword'>if</span> (have[<span class='macro'>CV_CPU_AVX512_COMMON<span class='macro_popup'>257</span></span>])</td></tr>
<tr class="codeline" data-linenumber="509"><td class="num" id="LN509">509</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="510"><td class="num" id="LN510">510</td><td class="line">                have[<span class='macro'>CV_CPU_AVX512_KNL<span class='macro_popup'>258</span></span>] = have[<span class='macro'>CV_CPU_AVX_512ER<span class='macro_popup'>17</span></span>]  &amp;&amp; have[<span class='macro'>CV_CPU_AVX_512PF<span class='macro_popup'>19</span></span>];</td></tr>
<tr class="codeline" data-linenumber="511"><td class="num" id="LN511">511</td><td class="line">                have[<span class='macro'>CV_CPU_AVX512_KNM<span class='macro_popup'>259</span></span>] = have[<span class='macro'>CV_CPU_AVX512_KNL<span class='macro_popup'>258</span></span>] &amp;&amp; have[<span class='macro'>CV_CPU_AVX_5124FMAPS<span class='macro_popup'>27</span></span>] &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="512"><td class="num" id="LN512">512</td><td class="line">                                          have[<span class='macro'>CV_CPU_AVX_5124VNNIW<span class='macro_popup'>26</span></span>] &amp;&amp; have[<span class='macro'>CV_CPU_AVX_512VPOPCNTDQ<span class='macro_popup'>25</span></span>];</td></tr>
<tr class="codeline" data-linenumber="513"><td class="num" id="LN513">513</td><td class="line">                have[<span class='macro'>CV_CPU_AVX512_SKX<span class='macro_popup'>256</span></span>] = have[<span class='macro'>CV_CPU_AVX_512BW<span class='macro_popup'>14</span></span>] &amp;&amp; have[<span class='macro'>CV_CPU_AVX_512DQ<span class='macro_popup'>16</span></span>] &amp;&amp; have[<span class='macro'>CV_CPU_AVX_512VL<span class='macro_popup'>21</span></span>];</td></tr>
<tr class="codeline" data-linenumber="514"><td class="num" id="LN514">514</td><td class="line">                have[<span class='macro'>CV_CPU_AVX512_CNL<span class='macro_popup'>260</span></span>] = have[<span class='macro'>CV_CPU_AVX512_SKX<span class='macro_popup'>256</span></span>] &amp;&amp; have[<span class='macro'>CV_CPU_AVX_512IFMA<span class='macro_popup'>18</span></span>] &amp;&amp; have[<span class='macro'>CV_CPU_AVX_512VBMI<span class='macro_popup'>20</span></span>];</td></tr>
<tr class="codeline" data-linenumber="515"><td class="num" id="LN515">515</td><td class="line">                have[<span class='macro'>CV_CPU_AVX512_CLX<span class='macro_popup'>261</span></span>] = have[<span class='macro'>CV_CPU_AVX512_SKX<span class='macro_popup'>256</span></span>] &amp;&amp; have[<span class='macro'>CV_CPU_AVX_512VNNI<span class='macro_popup'>23</span></span>];</td></tr>
<tr class="codeline" data-linenumber="516"><td class="num" id="LN516">516</td><td class="line">                have[<span class='macro'>CV_CPU_AVX512_ICL<span class='macro_popup'>262</span></span>] = have[<span class='macro'>CV_CPU_AVX512_SKX<span class='macro_popup'>256</span></span>] &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="517"><td class="num" id="LN517">517</td><td class="line">                                          have[<span class='macro'>CV_CPU_AVX_512IFMA<span class='macro_popup'>18</span></span>] &amp;&amp; have[<span class='macro'>CV_CPU_AVX_512VBMI<span class='macro_popup'>20</span></span>] &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="518"><td class="num" id="LN518">518</td><td class="line">                                          have[<span class='macro'>CV_CPU_AVX_512VNNI<span class='macro_popup'>23</span></span>] &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="519"><td class="num" id="LN519">519</td><td class="line">                                          have[<span class='macro'>CV_CPU_AVX_512VBMI2<span class='macro_popup'>22</span></span>] &amp;&amp; have[<span class='macro'>CV_CPU_AVX_512BITALG<span class='macro_popup'>24</span></span>] &amp;&amp; have[<span class='macro'>CV_CPU_AVX_512VPOPCNTDQ<span class='macro_popup'>25</span></span>];</td></tr>
<tr class="codeline" data-linenumber="520"><td class="num" id="LN520">520</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="521"><td class="num" id="LN521">521</td><td class="line">            <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="522"><td class="num" id="LN522">522</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="523"><td class="num" id="LN523">523</td><td class="line">                have[<span class='macro'>CV_CPU_AVX512_KNL<span class='macro_popup'>258</span></span>] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="524"><td class="num" id="LN524">524</td><td class="line">                have[<span class='macro'>CV_CPU_AVX512_KNM<span class='macro_popup'>259</span></span>] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="525"><td class="num" id="LN525">525</td><td class="line">                have[<span class='macro'>CV_CPU_AVX512_SKX<span class='macro_popup'>256</span></span>] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="526"><td class="num" id="LN526">526</td><td class="line">                have[<span class='macro'>CV_CPU_AVX512_CNL<span class='macro_popup'>260</span></span>] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="527"><td class="num" id="LN527">527</td><td class="line">                have[<span class='macro'>CV_CPU_AVX512_CLX<span class='macro_popup'>261</span></span>] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="528"><td class="num" id="LN528">528</td><td class="line">                have[<span class='macro'>CV_CPU_AVX512_ICL<span class='macro_popup'>262</span></span>] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="529"><td class="num" id="LN529">529</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="530"><td class="num" id="LN530">530</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="531"><td class="num" id="LN531">531</td><td class="line">    <span class='directive'>#endif // CV_CPUID_X86</span></td></tr>
<tr class="codeline" data-linenumber="532"><td class="num" id="LN532">532</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="533"><td class="num" id="LN533">533</td><td class="line">    <span class='directive'>#if defined __ANDROID__ || defined <span class='macro'>__linux__<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="534"><td class="num" id="LN534">534</td><td class="line">    <span class='directive'>#ifdef __aarch64__</span></td></tr>
<tr class="codeline" data-linenumber="535"><td class="num" id="LN535">535</td><td class="line">        have[<span class='macro'>CV_CPU_NEON<span class='macro_popup'>100</span></span>] = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="536"><td class="num" id="LN536">536</td><td class="line">        have[<span class='macro'>CV_CPU_FP16<span class='macro_popup'>9</span></span>] = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="537"><td class="num" id="LN537">537</td><td class="line">    <span class='directive'>#elif defined __arm__ &amp;&amp; defined __ANDROID__</span></td></tr>
<tr class="codeline" data-linenumber="538"><td class="num" id="LN538">538</td><td class="line">      <span class='directive'>#if defined HAVE_CPUFEATURES</span></td></tr>
<tr class="codeline" data-linenumber="539"><td class="num" id="LN539">539</td><td class="line">        CV_LOG_INFO(<span class='macro'>NULL<span class='macro_popup'>__null</span></span>, <span class='string_literal'>"calling android_getCpuFeatures() ..."</span>);</td></tr>
<tr class="codeline" data-linenumber="540"><td class="num" id="LN540">540</td><td class="line">        uint64_t features = android_getCpuFeatures();</td></tr>
<tr class="codeline" data-linenumber="541"><td class="num" id="LN541">541</td><td class="line">        CV_LOG_INFO(<span class='macro'>NULL<span class='macro_popup'>__null</span></span>, cv::format(<span class='string_literal'>"calling android_getCpuFeatures() ... Done (%llx)"</span>, (<span class='keyword'>long</span> <span class='keyword'>long</span>)features));</td></tr>
<tr class="codeline" data-linenumber="542"><td class="num" id="LN542">542</td><td class="line">        have[<span class='macro'>CV_CPU_NEON<span class='macro_popup'>100</span></span>] = (features &amp; ANDROID_CPU_ARM_FEATURE_NEON) != 0;</td></tr>
<tr class="codeline" data-linenumber="543"><td class="num" id="LN543">543</td><td class="line">        have[<span class='macro'>CV_CPU_FP16<span class='macro_popup'>9</span></span>] = (features &amp; ANDROID_CPU_ARM_FEATURE_VFP_FP16) != 0;</td></tr>
<tr class="codeline" data-linenumber="544"><td class="num" id="LN544">544</td><td class="line">      <span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="545"><td class="num" id="LN545">545</td><td class="line">        CV_LOG_INFO(<span class='macro'>NULL<span class='macro_popup'>__null</span></span>, <span class='string_literal'>"cpufeatures library is not available for CPU detection"</span>);</td></tr>
<tr class="codeline" data-linenumber="546"><td class="num" id="LN546">546</td><td class="line">        <span class='directive'>#if <span class='macro'>CV_NEON<span class='macro_popup'>0</span></span></span></td></tr>
<tr class="codeline" data-linenumber="547"><td class="num" id="LN547">547</td><td class="line">        CV_LOG_INFO(<span class='macro'>NULL<span class='macro_popup'>__null</span></span>, <span class='string_literal'>"- NEON instructions is enabled via build flags"</span>);</td></tr>
<tr class="codeline" data-linenumber="548"><td class="num" id="LN548">548</td><td class="line">        have[<span class='macro'>CV_CPU_NEON<span class='macro_popup'>100</span></span>] = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="549"><td class="num" id="LN549">549</td><td class="line">        <span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="550"><td class="num" id="LN550">550</td><td class="line">        CV_LOG_INFO(<span class='macro'>NULL<span class='macro_popup'>__null</span></span>, <span class='string_literal'>"- NEON instructions is NOT enabled via build flags"</span>);</td></tr>
<tr class="codeline" data-linenumber="551"><td class="num" id="LN551">551</td><td class="line">        <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="552"><td class="num" id="LN552">552</td><td class="line">        <span class='directive'>#if <span class='macro'>CV_FP16<span class='macro_popup'>0</span></span></span></td></tr>
<tr class="codeline" data-linenumber="553"><td class="num" id="LN553">553</td><td class="line">        CV_LOG_INFO(<span class='macro'>NULL<span class='macro_popup'>__null</span></span>, <span class='string_literal'>"- FP16 instructions is enabled via build flags"</span>);</td></tr>
<tr class="codeline" data-linenumber="554"><td class="num" id="LN554">554</td><td class="line">        have[<span class='macro'>CV_CPU_FP16<span class='macro_popup'>9</span></span>] = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="555"><td class="num" id="LN555">555</td><td class="line">        <span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="556"><td class="num" id="LN556">556</td><td class="line">        CV_LOG_INFO(<span class='macro'>NULL<span class='macro_popup'>__null</span></span>, <span class='string_literal'>"- FP16 instructions is NOT enabled via build flags"</span>);</td></tr>
<tr class="codeline" data-linenumber="557"><td class="num" id="LN557">557</td><td class="line">        <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="558"><td class="num" id="LN558">558</td><td class="line">      <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="559"><td class="num" id="LN559">559</td><td class="line">    <span class='directive'>#elif defined __arm__</span></td></tr>
<tr class="codeline" data-linenumber="560"><td class="num" id="LN560">560</td><td class="line">        <span class='keyword'>int</span> cpufile = open(<span class='string_literal'>"/proc/self/auxv"</span>, O_RDONLY);</td></tr>
<tr class="codeline" data-linenumber="561"><td class="num" id="LN561">561</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="562"><td class="num" id="LN562">562</td><td class="line">        <span class='keyword'>if</span> (cpufile &gt;= 0)</td></tr>
<tr class="codeline" data-linenumber="563"><td class="num" id="LN563">563</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="564"><td class="num" id="LN564">564</td><td class="line">            Elf32_auxv_t auxv;</td></tr>
<tr class="codeline" data-linenumber="565"><td class="num" id="LN565">565</td><td class="line">            <span class='keyword'>const</span> size_t size_auxv_t = <span class='keyword'>sizeof</span>(auxv);</td></tr>
<tr class="codeline" data-linenumber="566"><td class="num" id="LN566">566</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="567"><td class="num" id="LN567">567</td><td class="line">            <span class='keyword'>while</span> ((size_t)read(cpufile, &amp;auxv, size_auxv_t) == size_auxv_t)</td></tr>
<tr class="codeline" data-linenumber="568"><td class="num" id="LN568">568</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="569"><td class="num" id="LN569">569</td><td class="line">                <span class='keyword'>if</span> (auxv.a_type == AT_HWCAP)</td></tr>
<tr class="codeline" data-linenumber="570"><td class="num" id="LN570">570</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="571"><td class="num" id="LN571">571</td><td class="line">                    have[<span class='macro'>CV_CPU_NEON<span class='macro_popup'>100</span></span>] = (auxv.a_un.a_val &amp; 4096) != 0;</td></tr>
<tr class="codeline" data-linenumber="572"><td class="num" id="LN572">572</td><td class="line">                    have[<span class='macro'>CV_CPU_FP16<span class='macro_popup'>9</span></span>] = (auxv.a_un.a_val &amp; 2) != 0;</td></tr>
<tr class="codeline" data-linenumber="573"><td class="num" id="LN573">573</td><td class="line">                    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="574"><td class="num" id="LN574">574</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="575"><td class="num" id="LN575">575</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="576"><td class="num" id="LN576">576</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="577"><td class="num" id="LN577">577</td><td class="line">            close(cpufile);</td></tr>
<tr class="codeline" data-linenumber="578"><td class="num" id="LN578">578</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="579"><td class="num" id="LN579">579</td><td class="line">    <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="580"><td class="num" id="LN580">580</td><td class="line">    <span class='directive'>#elif (defined <span class='macro'>__clang__<span class='macro_popup'>1</span></span> || defined __APPLE__)</span></td></tr>
<tr class="codeline" data-linenumber="581"><td class="num" id="LN581">581</td><td class="line">    <span class='directive'>#if (defined __ARM_NEON__ || (defined __ARM_NEON &amp;&amp; defined __aarch64__))</span></td></tr>
<tr class="codeline" data-linenumber="582"><td class="num" id="LN582">582</td><td class="line">        have[<span class='macro'>CV_CPU_NEON<span class='macro_popup'>100</span></span>] = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="583"><td class="num" id="LN583">583</td><td class="line">    <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="584"><td class="num" id="LN584">584</td><td class="line">    <span class='directive'>#if (defined __ARM_FP  &amp;&amp; (((__ARM_FP &amp; 0x2) != 0) &amp;&amp; defined __ARM_NEON__))</span></td></tr>
<tr class="codeline" data-linenumber="585"><td class="num" id="LN585">585</td><td class="line">        have[<span class='macro'>CV_CPU_FP16<span class='macro_popup'>9</span></span>] = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="586"><td class="num" id="LN586">586</td><td class="line">    <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="587"><td class="num" id="LN587">587</td><td class="line">    <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="588"><td class="num" id="LN588">588</td><td class="line">    <span class='directive'>#if defined _ARM_ &amp;&amp; (defined(_WIN32_WCE) &amp;&amp; _WIN32_WCE &gt;= 0x800)</span></td></tr>
<tr class="codeline" data-linenumber="589"><td class="num" id="LN589">589</td><td class="line">        have[<span class='macro'>CV_CPU_NEON<span class='macro_popup'>100</span></span>] = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="590"><td class="num" id="LN590">590</td><td class="line">    <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="591"><td class="num" id="LN591">591</td><td class="line">    <span class='directive'>#ifdef __mips_msa</span></td></tr>
<tr class="codeline" data-linenumber="592"><td class="num" id="LN592">592</td><td class="line">        have[<span class='macro'>CV_CPU_MSA<span class='macro_popup'>150</span></span>] = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="593"><td class="num" id="LN593">593</td><td class="line">    <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="594"><td class="num" id="LN594">594</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="595"><td class="num" id="LN595">595</td><td class="line">    <span class='directive'>#if (defined __ppc64__ || defined __PPC64__) &amp;&amp; defined <span class='macro'>__linux__<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="596"><td class="num" id="LN596">596</td><td class="line">        <span class='keyword'>unsigned</span> <span class='keyword'>int</span> hwcap = getauxval(AT_HWCAP);</td></tr>
<tr class="codeline" data-linenumber="597"><td class="num" id="LN597">597</td><td class="line">        <span class='keyword'>if</span> (hwcap &amp; PPC_FEATURE_HAS_VSX) {</td></tr>
<tr class="codeline" data-linenumber="598"><td class="num" id="LN598">598</td><td class="line">            hwcap = getauxval(AT_HWCAP2);</td></tr>
<tr class="codeline" data-linenumber="599"><td class="num" id="LN599">599</td><td class="line">            <span class='keyword'>if</span> (hwcap &amp; PPC_FEATURE2_ARCH_3_00) {</td></tr>
<tr class="codeline" data-linenumber="600"><td class="num" id="LN600">600</td><td class="line">                have[<span class='macro'>CV_CPU_VSX<span class='macro_popup'>200</span></span>] = have[<span class='macro'>CV_CPU_VSX3<span class='macro_popup'>201</span></span>] = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="601"><td class="num" id="LN601">601</td><td class="line">            } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="602"><td class="num" id="LN602">602</td><td class="line">                have[<span class='macro'>CV_CPU_VSX<span class='macro_popup'>200</span></span>] = (hwcap &amp; PPC_FEATURE2_ARCH_2_07) != 0;</td></tr>
<tr class="codeline" data-linenumber="603"><td class="num" id="LN603">603</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="604"><td class="num" id="LN604">604</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="605"><td class="num" id="LN605">605</td><td class="line">    <span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="606"><td class="num" id="LN606">606</td><td class="line">        <span class='comment'>// TODO: AIX, FreeBSD</span></td></tr>
<tr class="codeline" data-linenumber="607"><td class="num" id="LN607">607</td><td class="line">        <span class='directive'>#if <span class='macro'>CV_VSX<span class='macro_popup'>0</span></span> || defined _ARCH_PWR8 || defined __POWER9_VECTOR__</span></td></tr>
<tr class="codeline" data-linenumber="608"><td class="num" id="LN608">608</td><td class="line">            have[<span class='macro'>CV_CPU_VSX<span class='macro_popup'>200</span></span>] = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="609"><td class="num" id="LN609">609</td><td class="line">        <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="610"><td class="num" id="LN610">610</td><td class="line">        <span class='directive'>#if <span class='macro'>CV_VSX3<span class='macro_popup'>0</span></span> || defined __POWER9_VECTOR__</span></td></tr>
<tr class="codeline" data-linenumber="611"><td class="num" id="LN611">611</td><td class="line">            have[<span class='macro'>CV_CPU_VSX3<span class='macro_popup'>201</span></span>] = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="612"><td class="num" id="LN612">612</td><td class="line">        <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="613"><td class="num" id="LN613">613</td><td class="line">    <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="614"><td class="num" id="LN614">614</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="615"><td class="num" id="LN615">615</td><td class="line">    <span class='directive'>#if defined __riscv &amp;&amp; defined __riscv_vector</span></td></tr>
<tr class="codeline" data-linenumber="616"><td class="num" id="LN616">616</td><td class="line">        have[<span class='macro'>CV_CPU_RVV<span class='macro_popup'>210</span></span>] = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="617"><td class="num" id="LN617">617</td><td class="line">    <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="618"><td class="num" id="LN618">618</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="619"><td class="num" id="LN619">619</td><td class="line">        <span class='keyword'>bool</span> skip_baseline_check = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="620"><td class="num" id="LN620">620</td><td class="line"><span class='directive'>#ifndef NO_GETENV</span></td></tr>
<tr class="codeline" data-linenumber="621"><td class="num" id="LN621">621</td><td class="line">        <span class='keyword'>if</span> (getenv(<span class='string_literal'>"OPENCV_SKIP_CPU_BASELINE_CHECK"</span>))</td></tr>
<tr class="codeline" data-linenumber="622"><td class="num" id="LN622">622</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="623"><td class="num" id="LN623">623</td><td class="line">            skip_baseline_check = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="624"><td class="num" id="LN624">624</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="625"><td class="num" id="LN625">625</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="626"><td class="num" id="LN626">626</td><td class="line">        <span class='keyword'>int</span> baseline_features[] = { <span class='macro'>CV_CPU_BASELINE_FEATURES<span class='macro_popup'>0 , 2 , 3 , 4</span></span> };</td></tr>
<tr class="codeline" data-linenumber="627"><td class="num" id="LN627">627</td><td class="line">        <span class='keyword'>if</span> (!checkFeatures(baseline_features, <span class='keyword'>sizeof</span>(baseline_features) / <span class='keyword'>sizeof</span>(baseline_features[0]))</td></tr>
<tr class="codeline" data-linenumber="628"><td class="num" id="LN628">628</td><td class="line">            &amp;&amp; !skip_baseline_check)</td></tr>
<tr class="codeline" data-linenumber="629"><td class="num" id="LN629">629</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="630"><td class="num" id="LN630">630</td><td class="line">            fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, <span class='string_literal'>"\n"</span></td></tr>
<tr class="codeline" data-linenumber="631"><td class="num" id="LN631">631</td><td class="line">                    <span class='string_literal'>"******************************************************************\n"</span></td></tr>
<tr class="codeline" data-linenumber="632"><td class="num" id="LN632">632</td><td class="line">                    <span class='string_literal'>"* FATAL ERROR:                                                   *\n"</span></td></tr>
<tr class="codeline" data-linenumber="633"><td class="num" id="LN633">633</td><td class="line">                    <span class='string_literal'>"* This OpenCV build doesn't support current CPU/HW configuration *\n"</span></td></tr>
<tr class="codeline" data-linenumber="634"><td class="num" id="LN634">634</td><td class="line">                    <span class='string_literal'>"*                                                                *\n"</span></td></tr>
<tr class="codeline" data-linenumber="635"><td class="num" id="LN635">635</td><td class="line">                    <span class='string_literal'>"* Use OPENCV_DUMP_CONFIG=1 environment variable for details      *\n"</span></td></tr>
<tr class="codeline" data-linenumber="636"><td class="num" id="LN636">636</td><td class="line">                    <span class='string_literal'>"******************************************************************\n"</span>);</td></tr>
<tr class="codeline" data-linenumber="637"><td class="num" id="LN637">637</td><td class="line">            fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, <span class='string_literal'>"\nRequired baseline features:\n"</span>);</td></tr>
<tr class="codeline" data-linenumber="638"><td class="num" id="LN638">638</td><td class="line">            checkFeatures(baseline_features, <span class='keyword'>sizeof</span>(baseline_features) / <span class='keyword'>sizeof</span>(baseline_features[0]), <span class='keyword'>true</span>);</td></tr>
<tr class="codeline" data-linenumber="639"><td class="num" id="LN639">639</td><td class="line">            <span class='macro'>CV_Error(cv::Error::StsAssert, <span class='string_literal'>"Missing support for required CPU baseline features. Check OpenCV build configuration and required CPU/HW setup."</span>)<span class='macro_popup'>do { (void)(cv::Error::StsAssert); (void)("Missing support for required CPU baseline features. Check OpenCV build configuration and required CPU/HW setup."<br>); abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="640"><td class="num" id="LN640">640</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="641"><td class="num" id="LN641">641</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="642"><td class="num" id="LN642">642</td><td class="line">        readSettings(baseline_features, <span class='keyword'>sizeof</span>(baseline_features) / <span class='keyword'>sizeof</span>(baseline_features[0]));</td></tr>
<tr class="codeline" data-linenumber="643"><td class="num" id="LN643">643</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="644"><td class="num" id="LN644">644</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="645"><td class="num" id="LN645">645</td><td class="line">    <span class='keyword'>bool</span> checkFeatures(<span class='keyword'>const</span> <span class='keyword'>int</span>* features, <span class='keyword'>int</span> count, <span class='keyword'>bool</span> dump = <span class='keyword'>false</span>)</td></tr>
<tr class="codeline" data-linenumber="646"><td class="num" id="LN646">646</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="647"><td class="num" id="LN647">647</td><td class="line">        <span class='keyword'>bool</span> result = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="648"><td class="num" id="LN648">648</td><td class="line">        <span class='keyword'>for</span> (<span class='keyword'>int</span> i = 0; i &lt; count; i++)</td></tr>
<tr class="codeline" data-linenumber="649"><td class="num" id="LN649">649</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="650"><td class="num" id="LN650">650</td><td class="line">            <span class='keyword'>int</span> feature = features[i];</td></tr>
<tr class="codeline" data-linenumber="651"><td class="num" id="LN651">651</td><td class="line">            <span class='keyword'>if</span> (feature)</td></tr>
<tr class="codeline" data-linenumber="652"><td class="num" id="LN652">652</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="653"><td class="num" id="LN653">653</td><td class="line">                <span class='keyword'>if</span> (have[feature])</td></tr>
<tr class="codeline" data-linenumber="654"><td class="num" id="LN654">654</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="655"><td class="num" id="LN655">655</td><td class="line">                    <span class='keyword'>if</span> (dump) fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, <span class='string_literal'>"    ID=%3d (%s) - OK\n"</span>, feature, getHWFeatureNameSafe(feature));</td></tr>
<tr class="codeline" data-linenumber="656"><td class="num" id="LN656">656</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="657"><td class="num" id="LN657">657</td><td class="line">                <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="658"><td class="num" id="LN658">658</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="659"><td class="num" id="LN659">659</td><td class="line">                    result = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="660"><td class="num" id="LN660">660</td><td class="line">                    <span class='keyword'>if</span> (dump) fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, <span class='string_literal'>"    ID=%3d (%s) - NOT AVAILABLE\n"</span>, feature, getHWFeatureNameSafe(feature));</td></tr>
<tr class="codeline" data-linenumber="661"><td class="num" id="LN661">661</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="662"><td class="num" id="LN662">662</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="663"><td class="num" id="LN663">663</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="664"><td class="num" id="LN664">664</td><td class="line">        <span class='keyword'>return</span> result;</td></tr>
<tr class="codeline" data-linenumber="665"><td class="num" id="LN665">665</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="666"><td class="num" id="LN666">666</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="667"><td class="num" id="LN667">667</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>inline</span> <span class='keyword'>bool</span> isSymbolSeparator(<span class='keyword'>char</span> c)</td></tr>
<tr class="codeline" data-linenumber="668"><td class="num" id="LN668">668</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="669"><td class="num" id="LN669">669</td><td class="line">        <span class='keyword'>return</span> c == ',' || c == ';';</td></tr>
<tr class="codeline" data-linenumber="670"><td class="num" id="LN670">670</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="671"><td class="num" id="LN671">671</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="672"><td class="num" id="LN672">672</td><td class="line">    <span class='keyword'>void</span> readSettings(<span class='keyword'>const</span> <span class='keyword'>int</span>* baseline_features, <span class='keyword'>int</span> baseline_count)</td></tr>
<tr class="codeline" data-linenumber="673"><td class="num" id="LN673">673</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="674"><td class="num" id="LN674">674</td><td class="line">        <span class='keyword'>bool</span> dump = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="675"><td class="num" id="LN675">675</td><td class="line">        <span class='keyword'>const</span> <span class='keyword'>char</span>* disabled_features =</td></tr>
<tr class="codeline" data-linenumber="676"><td class="num" id="LN676">676</td><td class="line"><span class='directive'>#ifdef NO_GETENV</span></td></tr>
<tr class="codeline" data-linenumber="677"><td class="num" id="LN677">677</td><td class="line">                <span class='macro'>NULL<span class='macro_popup'>__null</span></span>;</td></tr>
<tr class="codeline" data-linenumber="678"><td class="num" id="LN678">678</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="679"><td class="num" id="LN679">679</td><td class="line">                getenv(<span class='string_literal'>"OPENCV_CPU_DISABLE"</span>);</td></tr>
<tr class="codeline" data-linenumber="680"><td class="num" id="LN680">680</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="681"><td class="num" id="LN681">681</td><td class="line">        <span class='keyword'>if</span> (disabled_features &amp;&amp; disabled_features[0] != 0)</td></tr>
<tr class="codeline" data-linenumber="682"><td class="num" id="LN682">682</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="683"><td class="num" id="LN683">683</td><td class="line">            <span class='keyword'>const</span> <span class='keyword'>char</span>* start = disabled_features;</td></tr>
<tr class="codeline" data-linenumber="684"><td class="num" id="LN684">684</td><td class="line">            <span class='keyword'>for</span> (;;)</td></tr>
<tr class="codeline" data-linenumber="685"><td class="num" id="LN685">685</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="686"><td class="num" id="LN686">686</td><td class="line">                <span class='keyword'>while</span> (start[0] != 0 &amp;&amp; isSymbolSeparator(start[0]))</td></tr>
<tr class="codeline" data-linenumber="687"><td class="num" id="LN687">687</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="688"><td class="num" id="LN688">688</td><td class="line">                    start++;</td></tr>
<tr class="codeline" data-linenumber="689"><td class="num" id="LN689">689</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="690"><td class="num" id="LN690">690</td><td class="line">                <span class='keyword'>if</span> (start[0] == 0)</td></tr>
<tr class="codeline" data-linenumber="691"><td class="num" id="LN691">691</td><td class="line">                    <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="692"><td class="num" id="LN692">692</td><td class="line">                <span class='keyword'>const</span> <span class='keyword'>char</span>* end = start;</td></tr>
<tr class="codeline" data-linenumber="693"><td class="num" id="LN693">693</td><td class="line">                <span class='keyword'>while</span> (end[0] != 0 &amp;&amp; !isSymbolSeparator(end[0]))</td></tr>
<tr class="codeline" data-linenumber="694"><td class="num" id="LN694">694</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="695"><td class="num" id="LN695">695</td><td class="line">                    end++;</td></tr>
<tr class="codeline" data-linenumber="696"><td class="num" id="LN696">696</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="697"><td class="num" id="LN697">697</td><td class="line">                <span class='keyword'>if</span> (end == start)</td></tr>
<tr class="codeline" data-linenumber="698"><td class="num" id="LN698">698</td><td class="line">                    <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="699"><td class="num" id="LN699">699</td><td class="line">                cv::String feature(start, end);</td></tr>
<tr class="codeline" data-linenumber="700"><td class="num" id="LN700">700</td><td class="line">                start = end;</td></tr>
<tr class="codeline" data-linenumber="701"><td class="num" id="LN701">701</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="702"><td class="num" id="LN702">702</td><td class="line">                <span class='macro'>CV_Assert(feature.size() &gt; 0)<span class='macro_popup'>do { if (!(feature.size() &gt; 0)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="703"><td class="num" id="LN703">703</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="704"><td class="num" id="LN704">704</td><td class="line">                <span class='keyword'>bool</span> found = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="705"><td class="num" id="LN705">705</td><td class="line">                <span class='keyword'>for</span> (<span class='keyword'>int</span> i = 0; i &lt; <span class='macro'>CV_HARDWARE_MAX_FEATURE<span class='macro_popup'>512</span></span>; i++)</td></tr>
<tr class="codeline" data-linenumber="706"><td class="num" id="LN706">706</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="707"><td class="num" id="LN707">707</td><td class="line">                    <span class='keyword'>if</span> (!g_hwFeatureNames[i]) <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="708"><td class="num" id="LN708">708</td><td class="line">                    size_t len = strlen(g_hwFeatureNames[i]);</td></tr>
<tr class="codeline" data-linenumber="709"><td class="num" id="LN709">709</td><td class="line">                    <span class='keyword'>if</span> (len != feature.size()) <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="710"><td class="num" id="LN710">710</td><td class="line">                    <span class='keyword'>if</span> (feature.compare(g_hwFeatureNames[i]) == 0)</td></tr>
<tr class="codeline" data-linenumber="711"><td class="num" id="LN711">711</td><td class="line">                    {</td></tr>
<tr class="codeline" data-linenumber="712"><td class="num" id="LN712">712</td><td class="line">                        <span class='keyword'>bool</span> isBaseline = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="713"><td class="num" id="LN713">713</td><td class="line">                        <span class='keyword'>for</span> (<span class='keyword'>int</span> k = 0; k &lt; baseline_count; k++)</td></tr>
<tr class="codeline" data-linenumber="714"><td class="num" id="LN714">714</td><td class="line">                        {</td></tr>
<tr class="codeline" data-linenumber="715"><td class="num" id="LN715">715</td><td class="line">                            <span class='keyword'>if</span> (baseline_features[k] == i)</td></tr>
<tr class="codeline" data-linenumber="716"><td class="num" id="LN716">716</td><td class="line">                            {</td></tr>
<tr class="codeline" data-linenumber="717"><td class="num" id="LN717">717</td><td class="line">                                isBaseline = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="718"><td class="num" id="LN718">718</td><td class="line">                                <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="719"><td class="num" id="LN719">719</td><td class="line">                            }</td></tr>
<tr class="codeline" data-linenumber="720"><td class="num" id="LN720">720</td><td class="line">                        }</td></tr>
<tr class="codeline" data-linenumber="721"><td class="num" id="LN721">721</td><td class="line">                        <span class='keyword'>if</span> (isBaseline)</td></tr>
<tr class="codeline" data-linenumber="722"><td class="num" id="LN722">722</td><td class="line">                        {</td></tr>
<tr class="codeline" data-linenumber="723"><td class="num" id="LN723">723</td><td class="line">                            <span class='keyword'>if</span> (dump) fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, <span class='string_literal'>"OPENCV: Trying to disable baseline CPU feature: '%s'."</span></td></tr>
<tr class="codeline" data-linenumber="724"><td class="num" id="LN724">724</td><td class="line">                                                      <span class='string_literal'>"This has very limited effect, because code optimizations for this feature are executed unconditionally "</span></td></tr>
<tr class="codeline" data-linenumber="725"><td class="num" id="LN725">725</td><td class="line">                                                      <span class='string_literal'>"in the most cases.\n"</span>, getHWFeatureNameSafe(i));</td></tr>
<tr class="codeline" data-linenumber="726"><td class="num" id="LN726">726</td><td class="line">                        }</td></tr>
<tr class="codeline" data-linenumber="727"><td class="num" id="LN727">727</td><td class="line">                        <span class='keyword'>if</span> (!have[i])</td></tr>
<tr class="codeline" data-linenumber="728"><td class="num" id="LN728">728</td><td class="line">                        {</td></tr>
<tr class="codeline" data-linenumber="729"><td class="num" id="LN729">729</td><td class="line">                            <span class='keyword'>if</span> (dump) fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, <span class='string_literal'>"OPENCV: Trying to disable unavailable CPU feature on the current platform: '%s'.\n"</span>,</td></tr>
<tr class="codeline" data-linenumber="730"><td class="num" id="LN730">730</td><td class="line">                                getHWFeatureNameSafe(i));</td></tr>
<tr class="codeline" data-linenumber="731"><td class="num" id="LN731">731</td><td class="line">                        }</td></tr>
<tr class="codeline" data-linenumber="732"><td class="num" id="LN732">732</td><td class="line">                        have[i] = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="733"><td class="num" id="LN733">733</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="734"><td class="num" id="LN734">734</td><td class="line">                        found = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="735"><td class="num" id="LN735">735</td><td class="line">                        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="736"><td class="num" id="LN736">736</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="737"><td class="num" id="LN737">737</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="738"><td class="num" id="LN738">738</td><td class="line">                <span class='keyword'>if</span> (!found)</td></tr>
<tr class="codeline" data-linenumber="739"><td class="num" id="LN739">739</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="740"><td class="num" id="LN740">740</td><td class="line">                    <span class='keyword'>if</span> (dump) fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, <span class='string_literal'>"OPENCV: Trying to disable unknown CPU feature: '%s'.\n"</span>, feature.c_str());</td></tr>
<tr class="codeline" data-linenumber="741"><td class="num" id="LN741">741</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="742"><td class="num" id="LN742">742</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="743"><td class="num" id="LN743">743</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="744"><td class="num" id="LN744">744</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="745"><td class="num" id="LN745">745</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="746"><td class="num" id="LN746">746</td><td class="line">    <span class='keyword'>bool</span> have[MAX_FEATURE+1]{};</td></tr>
<tr class="codeline" data-linenumber="747"><td class="num" id="LN747">747</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="748"><td class="num" id="LN748">748</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="749"><td class="num" id="LN749">749</td><td class="line"><span class='keyword'>static</span> HWFeatures  featuresEnabled(<span class='keyword'>true</span>), featuresDisabled = HWFeatures(<span class='keyword'>false</span>);</td></tr>
<tr class="codeline" data-linenumber="750"><td class="num" id="LN750">750</td><td class="line"><span class='keyword'>static</span> HWFeatures* currentFeatures = &amp;featuresEnabled;</td></tr>
<tr class="codeline" data-linenumber="751"><td class="num" id="LN751">751</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="752"><td class="num" id="LN752">752</td><td class="line"><span class='keyword'>bool</span> checkHardwareSupport(<span class='keyword'>int</span> feature)</td></tr>
<tr class="codeline" data-linenumber="753"><td class="num" id="LN753">753</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="754"><td class="num" id="LN754">754</td><td class="line">    <span class='macro'>CV_DbgAssert( 0 &lt;= feature &amp;&amp; feature &lt;= CV_HARDWARE_MAX_FEATURE )<span class='macro_popup'>do { if (!(0 &lt;= feature &amp;&amp; feature &lt;= 512)) abort<br>(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="755"><td class="num" id="LN755">755</td><td class="line">    <span class='keyword'>return</span> currentFeatures-&gt;have[feature];</td></tr>
<tr class="codeline" data-linenumber="756"><td class="num" id="LN756">756</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="757"><td class="num" id="LN757">757</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="758"><td class="num" id="LN758">758</td><td class="line">String getHardwareFeatureName(<span class='keyword'>int</span> feature)</td></tr>
<tr class="codeline" data-linenumber="759"><td class="num" id="LN759">759</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="760"><td class="num" id="LN760">760</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>char</span>* name = getHWFeatureName(feature);</td></tr>
<tr class="codeline" data-linenumber="761"><td class="num" id="LN761">761</td><td class="line">    <span class='keyword'>return</span> name ? String(name) : String();</td></tr>
<tr class="codeline" data-linenumber="762"><td class="num" id="LN762">762</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="763"><td class="num" id="LN763">763</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="764"><td class="num" id="LN764">764</td><td class="line">std::string getCPUFeaturesLine()</td></tr>
<tr class="codeline" data-linenumber="765"><td class="num" id="LN765">765</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="766"><td class="num" id="LN766">766</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>int</span> features[] = { <span class='macro'>CV_CPU_BASELINE_FEATURES<span class='macro_popup'>0 , 2 , 3 , 4</span></span>, <span class='macro'>CV_CPU_DISPATCH_FEATURES<span class='macro_popup'>0 , 6 , 7 , 9 , 10 , 11 , 256</span></span> };</td></tr>
<tr class="codeline" data-linenumber="767"><td class="num" id="LN767">767</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>int</span> sz = <span class='keyword'>sizeof</span>(features) / <span class='keyword'>sizeof</span>(features[0]);</td></tr>
<tr class="codeline" data-linenumber="768"><td class="num" id="LN768">768</td><td class="line">    std::string result;</td></tr>
<tr class="codeline" data-linenumber="769"><td class="num" id="LN769">769</td><td class="line">    std::string prefix;</td></tr>
<tr class="codeline" data-linenumber="770"><td class="num" id="LN770">770</td><td class="line">    <span class='keyword'>for</span> (<span class='keyword'>int</span> i = 1; i &lt; sz; ++i)</td></tr>
<tr class="codeline" data-linenumber="771"><td class="num" id="LN771">771</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="772"><td class="num" id="LN772">772</td><td class="line">        <span class='keyword'>if</span> (features[i] == 0)</td></tr>
<tr class="codeline" data-linenumber="773"><td class="num" id="LN773">773</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="774"><td class="num" id="LN774">774</td><td class="line">            prefix = <span class='string_literal'>"*"</span>;</td></tr>
<tr class="codeline" data-linenumber="775"><td class="num" id="LN775">775</td><td class="line">            <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="776"><td class="num" id="LN776">776</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="777"><td class="num" id="LN777">777</td><td class="line">        <span class='keyword'>if</span> (i != 1) result.append(<span class='string_literal'>" "</span>);</td></tr>
<tr class="codeline" data-linenumber="778"><td class="num" id="LN778">778</td><td class="line">        result.append(prefix);</td></tr>
<tr class="codeline" data-linenumber="779"><td class="num" id="LN779">779</td><td class="line">        result.append(getHWFeatureNameSafe(features[i]));</td></tr>
<tr class="codeline" data-linenumber="780"><td class="num" id="LN780">780</td><td class="line">        <span class='keyword'>if</span> (!checkHardwareSupport(features[i])) result.append(<span class='string_literal'>"?"</span>);</td></tr>
<tr class="codeline" data-linenumber="781"><td class="num" id="LN781">781</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="782"><td class="num" id="LN782">782</td><td class="line">    <span class='keyword'>return</span> result;</td></tr>
<tr class="codeline" data-linenumber="783"><td class="num" id="LN783">783</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="784"><td class="num" id="LN784">784</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="785"><td class="num" id="LN785">785</td><td class="line"><span class='keyword'>volatile</span> <span class='keyword'>bool</span> useOptimizedFlag = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="786"><td class="num" id="LN786">786</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="787"><td class="num" id="LN787">787</td><td class="line"><span class='keyword'>void</span> setUseOptimized( <span class='keyword'>bool</span> flag )</td></tr>
<tr class="codeline" data-linenumber="788"><td class="num" id="LN788">788</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="789"><td class="num" id="LN789">789</td><td class="line">    useOptimizedFlag = flag;</td></tr>
<tr class="codeline" data-linenumber="790"><td class="num" id="LN790">790</td><td class="line">    currentFeatures = flag ? &amp;featuresEnabled : &amp;featuresDisabled;</td></tr>
<tr class="codeline" data-linenumber="791"><td class="num" id="LN791">791</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="792"><td class="num" id="LN792">792</td><td class="line">    ipp::setUseIPP(flag);</td></tr>
<tr class="codeline" data-linenumber="793"><td class="num" id="LN793">793</td><td class="line"><span class='directive'>#ifdef HAVE_OPENCL</span></td></tr>
<tr class="codeline" data-linenumber="794"><td class="num" id="LN794">794</td><td class="line">    ocl::setUseOpenCL(flag);</td></tr>
<tr class="codeline" data-linenumber="795"><td class="num" id="LN795">795</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="796"><td class="num" id="LN796">796</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="797"><td class="num" id="LN797">797</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="798"><td class="num" id="LN798">798</td><td class="line"><span class='keyword'>bool</span> useOptimized(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="799"><td class="num" id="LN799">799</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="800"><td class="num" id="LN800">800</td><td class="line">    <span class='keyword'>return</span> useOptimizedFlag;</td></tr>
<tr class="codeline" data-linenumber="801"><td class="num" id="LN801">801</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="802"><td class="num" id="LN802">802</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="803"><td class="num" id="LN803">803</td><td class="line">int64 getTickCount(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="804"><td class="num" id="LN804">804</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="805"><td class="num" id="LN805">805</td><td class="line"><span class='directive'>#if defined _WIN32 || defined WINCE</span></td></tr>
<tr class="codeline" data-linenumber="806"><td class="num" id="LN806">806</td><td class="line">    LARGE_INTEGER counter;</td></tr>
<tr class="codeline" data-linenumber="807"><td class="num" id="LN807">807</td><td class="line">    QueryPerformanceCounter( &amp;counter );</td></tr>
<tr class="codeline" data-linenumber="808"><td class="num" id="LN808">808</td><td class="line">    <span class='keyword'>return</span> (int64)counter.QuadPart;</td></tr>
<tr class="codeline" data-linenumber="809"><td class="num" id="LN809">809</td><td class="line"><span class='directive'>#elif defined <span class='macro'>__linux<span class='macro_popup'>1</span></span> || defined <span class='macro'>__linux__<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="810"><td class="num" id="LN810">810</td><td class="line">    <span class='keyword'>struct</span> timespec tp;</td></tr>
<tr class="codeline" data-linenumber="811"><td class="num" id="LN811">811</td><td class="line">    clock_gettime(<span class='macro'>CLOCK_MONOTONIC<span class='macro_popup'>1</span></span>, &amp;tp);</td></tr>
<tr class="codeline" data-linenumber="812"><td class="num" id="LN812">812</td><td class="line">    <span class='keyword'>return</span> (int64)tp.tv_sec*1000000000 + tp.tv_nsec;</td></tr>
<tr class="codeline" data-linenumber="813"><td class="num" id="LN813">813</td><td class="line"><span class='directive'>#elif defined __MACH__ &amp;&amp; defined __APPLE__</span></td></tr>
<tr class="codeline" data-linenumber="814"><td class="num" id="LN814">814</td><td class="line">    <span class='keyword'>return</span> (int64)mach_absolute_time();</td></tr>
<tr class="codeline" data-linenumber="815"><td class="num" id="LN815">815</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="816"><td class="num" id="LN816">816</td><td class="line">    <span class='keyword'>struct</span> timeval tv;</td></tr>
<tr class="codeline" data-linenumber="817"><td class="num" id="LN817">817</td><td class="line">    gettimeofday(&amp;tv, <span class='macro'>NULL<span class='macro_popup'>__null</span></span>);</td></tr>
<tr class="codeline" data-linenumber="818"><td class="num" id="LN818">818</td><td class="line">    <span class='keyword'>return</span> (int64)tv.tv_sec*1000000 + tv.tv_usec;</td></tr>
<tr class="codeline" data-linenumber="819"><td class="num" id="LN819">819</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="820"><td class="num" id="LN820">820</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="821"><td class="num" id="LN821">821</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="822"><td class="num" id="LN822">822</td><td class="line"><span class='keyword'>double</span> getTickFrequency(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="823"><td class="num" id="LN823">823</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="824"><td class="num" id="LN824">824</td><td class="line"><span class='directive'>#if defined _WIN32 || defined WINCE</span></td></tr>
<tr class="codeline" data-linenumber="825"><td class="num" id="LN825">825</td><td class="line">    LARGE_INTEGER freq;</td></tr>
<tr class="codeline" data-linenumber="826"><td class="num" id="LN826">826</td><td class="line">    QueryPerformanceFrequency(&amp;freq);</td></tr>
<tr class="codeline" data-linenumber="827"><td class="num" id="LN827">827</td><td class="line">    <span class='keyword'>return</span> (<span class='keyword'>double</span>)freq.QuadPart;</td></tr>
<tr class="codeline" data-linenumber="828"><td class="num" id="LN828">828</td><td class="line"><span class='directive'>#elif defined <span class='macro'>__linux<span class='macro_popup'>1</span></span> || defined <span class='macro'>__linux__<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="829"><td class="num" id="LN829">829</td><td class="line">    <span class='keyword'>return</span> 1e9;</td></tr>
<tr class="codeline" data-linenumber="830"><td class="num" id="LN830">830</td><td class="line"><span class='directive'>#elif defined __MACH__ &amp;&amp; defined __APPLE__</span></td></tr>
<tr class="codeline" data-linenumber="831"><td class="num" id="LN831">831</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>double</span> freq = 0;</td></tr>
<tr class="codeline" data-linenumber="832"><td class="num" id="LN832">832</td><td class="line">    <span class='keyword'>if</span>( freq == 0 )</td></tr>
<tr class="codeline" data-linenumber="833"><td class="num" id="LN833">833</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="834"><td class="num" id="LN834">834</td><td class="line">        mach_timebase_info_data_t sTimebaseInfo;</td></tr>
<tr class="codeline" data-linenumber="835"><td class="num" id="LN835">835</td><td class="line">        mach_timebase_info(&amp;sTimebaseInfo);</td></tr>
<tr class="codeline" data-linenumber="836"><td class="num" id="LN836">836</td><td class="line">        freq = sTimebaseInfo.denom*1e9/sTimebaseInfo.numer;</td></tr>
<tr class="codeline" data-linenumber="837"><td class="num" id="LN837">837</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="838"><td class="num" id="LN838">838</td><td class="line">    <span class='keyword'>return</span> freq;</td></tr>
<tr class="codeline" data-linenumber="839"><td class="num" id="LN839">839</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="840"><td class="num" id="LN840">840</td><td class="line">    <span class='keyword'>return</span> 1e6;</td></tr>
<tr class="codeline" data-linenumber="841"><td class="num" id="LN841">841</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="842"><td class="num" id="LN842">842</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="843"><td class="num" id="LN843">843</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="844"><td class="num" id="LN844">844</td><td class="line"><span class='directive'>#if defined <span class='macro'>__GNUC__<span class='macro_popup'>4</span></span> &amp;&amp; (defined __i386__ || defined <span class='macro'>__x86_64__<span class='macro_popup'>1</span></span> || defined __ppc__)</span></td></tr>
<tr class="codeline" data-linenumber="845"><td class="num" id="LN845">845</td><td class="line"><span class='directive'>#if defined(__i386__)</span></td></tr>
<tr class="codeline" data-linenumber="846"><td class="num" id="LN846">846</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="847"><td class="num" id="LN847">847</td><td class="line">int64 getCPUTickCount(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="848"><td class="num" id="LN848">848</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="849"><td class="num" id="LN849">849</td><td class="line">    int64 x;</td></tr>
<tr class="codeline" data-linenumber="850"><td class="num" id="LN850">850</td><td class="line">    <span class='keyword'>__asm__</span> <span class='keyword'>volatile</span> (<span class='string_literal'>".byte 0x0f, 0x31"</span> : <span class='string_literal'>"=A"</span> (x));</td></tr>
<tr class="codeline" data-linenumber="851"><td class="num" id="LN851">851</td><td class="line">    <span class='keyword'>return</span> x;</td></tr>
<tr class="codeline" data-linenumber="852"><td class="num" id="LN852">852</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="853"><td class="num" id="LN853">853</td><td class="line"><span class='directive'>#elif defined(<span class='macro'>__x86_64__<span class='macro_popup'>1</span></span>)</span></td></tr>
<tr class="codeline" data-linenumber="854"><td class="num" id="LN854">854</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="855"><td class="num" id="LN855">855</td><td class="line">int64 getCPUTickCount(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="856"><td class="num" id="LN856">856</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="857"><td class="num" id="LN857">857</td><td class="line">    <span class='keyword'>unsigned</span> hi, lo;</td></tr>
<tr class="codeline" data-linenumber="858"><td class="num" id="LN858">858</td><td class="line">    <span class='keyword'>__asm__</span> <span class='keyword'>__volatile__</span> (<span class='string_literal'>"rdtsc"</span> : <span class='string_literal'>"=a"</span>(lo), <span class='string_literal'>"=d"</span>(hi));</td></tr>
<tr class="codeline" data-linenumber="859"><td class="num" id="LN859">859</td><td class="line">    <span class='keyword'>return</span> (int64)lo | ((int64)hi &lt;&lt; 32);</td></tr>
<tr class="codeline" data-linenumber="860"><td class="num" id="LN860">860</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="861"><td class="num" id="LN861">861</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="862"><td class="num" id="LN862">862</td><td class="line"><span class='directive'>#elif defined(__ppc__)</span></td></tr>
<tr class="codeline" data-linenumber="863"><td class="num" id="LN863">863</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="864"><td class="num" id="LN864">864</td><td class="line">int64 getCPUTickCount(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="865"><td class="num" id="LN865">865</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="866"><td class="num" id="LN866">866</td><td class="line">    <span class='keyword'>unsigned</span> upper, lower, tmp;</td></tr>
<tr class="codeline" data-linenumber="867"><td class="num" id="LN867">867</td><td class="line">    <span class='keyword'>__asm__</span> <span class='keyword'>volatile</span>(</td></tr>
<tr class="codeline" data-linenumber="868"><td class="num" id="LN868">868</td><td class="line">                     <span class='string_literal'>"0:                  \n"</span></td></tr>
<tr class="codeline" data-linenumber="869"><td class="num" id="LN869">869</td><td class="line">                     <span class='string_literal'>"\tmftbu   %0           \n"</span></td></tr>
<tr class="codeline" data-linenumber="870"><td class="num" id="LN870">870</td><td class="line">                     <span class='string_literal'>"\tmftb    %1           \n"</span></td></tr>
<tr class="codeline" data-linenumber="871"><td class="num" id="LN871">871</td><td class="line">                     <span class='string_literal'>"\tmftbu   %2           \n"</span></td></tr>
<tr class="codeline" data-linenumber="872"><td class="num" id="LN872">872</td><td class="line">                     <span class='string_literal'>"\tcmpw    %2,%0        \n"</span></td></tr>
<tr class="codeline" data-linenumber="873"><td class="num" id="LN873">873</td><td class="line">                     <span class='string_literal'>"\tbne     0b         \n"</span></td></tr>
<tr class="codeline" data-linenumber="874"><td class="num" id="LN874">874</td><td class="line">                     : <span class='string_literal'>"=r"</span>(upper),<span class='string_literal'>"=r"</span>(lower),<span class='string_literal'>"=r"</span>(tmp)</td></tr>
<tr class="codeline" data-linenumber="875"><td class="num" id="LN875">875</td><td class="line">                     );</td></tr>
<tr class="codeline" data-linenumber="876"><td class="num" id="LN876">876</td><td class="line">    <span class='keyword'>return</span> lower | ((int64)upper &lt;&lt; 32);</td></tr>
<tr class="codeline" data-linenumber="877"><td class="num" id="LN877">877</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="878"><td class="num" id="LN878">878</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="879"><td class="num" id="LN879">879</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="880"><td class="num" id="LN880">880</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="881"><td class="num" id="LN881">881</td><td class="line"><span class='directive'>#error "RDTSC not defined"</span></td></tr>
<tr class="codeline" data-linenumber="882"><td class="num" id="LN882">882</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="883"><td class="num" id="LN883">883</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="884"><td class="num" id="LN884">884</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="885"><td class="num" id="LN885">885</td><td class="line"><span class='directive'>#elif defined _MSC_VER &amp;&amp; defined _WIN32 &amp;&amp; defined _M_IX86</span></td></tr>
<tr class="codeline" data-linenumber="886"><td class="num" id="LN886">886</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="887"><td class="num" id="LN887">887</td><td class="line">int64 getCPUTickCount(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="888"><td class="num" id="LN888">888</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="889"><td class="num" id="LN889">889</td><td class="line">    <span class='keyword'>__asm</span> _emit 0x0f;</td></tr>
<tr class="codeline" data-linenumber="890"><td class="num" id="LN890">890</td><td class="line">    <span class='keyword'>__asm</span> _emit 0x31;</td></tr>
<tr class="codeline" data-linenumber="891"><td class="num" id="LN891">891</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="892"><td class="num" id="LN892">892</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="893"><td class="num" id="LN893">893</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="894"><td class="num" id="LN894">894</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="895"><td class="num" id="LN895">895</td><td class="line"><span class='comment'>//#ifdef HAVE_IPP</span></td></tr>
<tr class="codeline" data-linenumber="896"><td class="num" id="LN896">896</td><td class="line"><span class='comment'>//int64 getCPUTickCount(void)</span></td></tr>
<tr class="codeline" data-linenumber="897"><td class="num" id="LN897">897</td><td class="line"><span class='comment'>//{</span></td></tr>
<tr class="codeline" data-linenumber="898"><td class="num" id="LN898">898</td><td class="line"><span class='comment'>//    return ippGetCpuClocks();</span></td></tr>
<tr class="codeline" data-linenumber="899"><td class="num" id="LN899">899</td><td class="line"><span class='comment'>//}</span></td></tr>
<tr class="codeline" data-linenumber="900"><td class="num" id="LN900">900</td><td class="line"><span class='comment'>//#else</span></td></tr>
<tr class="codeline" data-linenumber="901"><td class="num" id="LN901">901</td><td class="line">int64 getCPUTickCount(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="902"><td class="num" id="LN902">902</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="903"><td class="num" id="LN903">903</td><td class="line">    <span class='keyword'>return</span> getTickCount();</td></tr>
<tr class="codeline" data-linenumber="904"><td class="num" id="LN904">904</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="905"><td class="num" id="LN905">905</td><td class="line"><span class='comment'>//#endif</span></td></tr>
<tr class="codeline" data-linenumber="906"><td class="num" id="LN906">906</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="907"><td class="num" id="LN907">907</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="908"><td class="num" id="LN908">908</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="909"><td class="num" id="LN909">909</td><td class="line"><span class='keyword'>const</span> String&amp; getBuildInformation()</td></tr>
<tr class="codeline" data-linenumber="910"><td class="num" id="LN910">910</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="911"><td class="num" id="LN911">911</td><td class="line">    <span class='keyword'>static</span> String build_info =</td></tr>
<tr class="codeline" data-linenumber="912"><td class="num" id="LN912">912</td><td class="line"><span class='directive'>#include "version_string.inc"</span></td></tr>
<tr class="codeline" data-linenumber="913"><td class="num" id="LN913">913</td><td class="line">    ;</td></tr>
<tr class="codeline" data-linenumber="914"><td class="num" id="LN914">914</td><td class="line">    <span class='keyword'>return</span> build_info;</td></tr>
<tr class="codeline" data-linenumber="915"><td class="num" id="LN915">915</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="916"><td class="num" id="LN916">916</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="917"><td class="num" id="LN917">917</td><td class="line">String getVersionString() { <span class='keyword'>return</span> String(<span class='macro'>CV_VERSION<span class='macro_popup'>"4" "." "5" "." "2" ""</span></span>); }</td></tr>
<tr class="codeline" data-linenumber="918"><td class="num" id="LN918">918</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="919"><td class="num" id="LN919">919</td><td class="line"><span class='keyword'>int</span> getVersionMajor() { <span class='keyword'>return</span> <span class='macro'>CV_VERSION_MAJOR<span class='macro_popup'>4</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="920"><td class="num" id="LN920">920</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="921"><td class="num" id="LN921">921</td><td class="line"><span class='keyword'>int</span> getVersionMinor() { <span class='keyword'>return</span> <span class='macro'>CV_VERSION_MINOR<span class='macro_popup'>5</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="922"><td class="num" id="LN922">922</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="923"><td class="num" id="LN923">923</td><td class="line"><span class='keyword'>int</span> getVersionRevision() { <span class='keyword'>return</span> <span class='macro'>CV_VERSION_REVISION<span class='macro_popup'>2</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="924"><td class="num" id="LN924">924</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="925"><td class="num" id="LN925">925</td><td class="line">String format( <span class='keyword'>const</span> <span class='keyword'>char</span>* fmt, ... )</td></tr>
<tr class="codeline" data-linenumber="926"><td class="num" id="LN926">926</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="927"><td class="num" id="LN927">927</td><td class="line">    AutoBuffer&lt;<span class='keyword'>char</span>, 1024&gt; buf;</td></tr>
<tr class="codeline" data-linenumber="928"><td class="num" id="LN928">928</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="929"><td class="num" id="LN929">929</td><td class="line">    <span class='keyword'>for</span> ( ; ; )</td></tr>
<tr class="codeline" data-linenumber="930"><td class="num" id="LN930">930</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="931"><td class="num" id="LN931">931</td><td class="line">        va_list va;</td></tr>
<tr class="codeline" data-linenumber="932"><td class="num" id="LN932">932</td><td class="line">        <span class='macro'>va_start(va, fmt)<span class='macro_popup'>__builtin_va_start(va, fmt)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="933"><td class="num" id="LN933">933</td><td class="line">        <span class='keyword'>int</span> bsize = <span class='keyword'>static_cast</span>&lt;<span class='keyword'>int</span>&gt;(buf.size());</td></tr>
<tr class="codeline" data-linenumber="934"><td class="num" id="LN934">934</td><td class="line">        <span class='keyword'>int</span> len = cv_vsnprintf(buf.data(), bsize, fmt, va);</td></tr>
<tr class="codeline" data-linenumber="935"><td class="num" id="LN935">935</td><td class="line">        <span class='macro'>va_end(va)<span class='macro_popup'>__builtin_va_end(va)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="936"><td class="num" id="LN936">936</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="937"><td class="num" id="LN937">937</td><td class="line">        <span class='macro'>CV_Assert(len &gt;= 0 &amp;&amp; <span class='string_literal'>"Check format string for errors"</span>)<span class='macro_popup'>do { if (!(len &gt;= 0 &amp;&amp; "Check format string for errors"<br>)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="938"><td class="num" id="LN938">938</td><td class="line">        <span class='keyword'>if</span> (len &gt;= bsize)</td></tr>
<tr class="codeline" data-linenumber="939"><td class="num" id="LN939">939</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="940"><td class="num" id="LN940">940</td><td class="line">            buf.resize(len + 1);</td></tr>
<tr class="codeline" data-linenumber="941"><td class="num" id="LN941">941</td><td class="line">            <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="942"><td class="num" id="LN942">942</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="943"><td class="num" id="LN943">943</td><td class="line">        buf[bsize - 1] = 0;</td></tr>
<tr class="codeline" data-linenumber="944"><td class="num" id="LN944">944</td><td class="line">        <span class='keyword'>return</span> String(buf.data(), len);</td></tr>
<tr class="codeline" data-linenumber="945"><td class="num" id="LN945">945</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="946"><td class="num" id="LN946">946</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="947"><td class="num" id="LN947">947</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="948"><td class="num" id="LN948">948</td><td class="line">String tempfile( <span class='keyword'>const</span> <span class='keyword'>char</span>* suffix )</td></tr>
<tr class="codeline" data-linenumber="949"><td class="num" id="LN949">949</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="950"><td class="num" id="LN950">950</td><td class="line">    String fname;</td></tr>
<tr class="codeline" data-linenumber="951"><td class="num" id="LN951">951</td><td class="line"><span class='directive'>#ifndef NO_GETENV</span></td></tr>
<tr class="codeline" data-linenumber="952"><td class="num" id="LN952">952</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>char</span> *temp_dir = getenv(<span class='string_literal'>"OPENCV_TEMP_PATH"</span>);</td></tr>
<tr class="codeline" data-linenumber="953"><td class="num" id="LN953">953</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="954"><td class="num" id="LN954">954</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="955"><td class="num" id="LN955">955</td><td class="line"><span class='directive'>#if defined _WIN32</span></td></tr>
<tr class="codeline" data-linenumber="956"><td class="num" id="LN956">956</td><td class="line"><span class='directive'>#ifdef WINRT</span></td></tr>
<tr class="codeline" data-linenumber="957"><td class="num" id="LN957">957</td><td class="line">    RoInitialize(RO_INIT_MULTITHREADED);</td></tr>
<tr class="codeline" data-linenumber="958"><td class="num" id="LN958">958</td><td class="line">    std::wstring temp_dir = GetTempPathWinRT();</td></tr>
<tr class="codeline" data-linenumber="959"><td class="num" id="LN959">959</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="960"><td class="num" id="LN960">960</td><td class="line">    std::wstring temp_file = GetTempFileNameWinRT(L<span class='string_literal'>"ocv"</span>);</td></tr>
<tr class="codeline" data-linenumber="961"><td class="num" id="LN961">961</td><td class="line">    <span class='keyword'>if</span> (temp_file.empty())</td></tr>
<tr class="codeline" data-linenumber="962"><td class="num" id="LN962">962</td><td class="line">        <span class='keyword'>return</span> String();</td></tr>
<tr class="codeline" data-linenumber="963"><td class="num" id="LN963">963</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="964"><td class="num" id="LN964">964</td><td class="line">    temp_file = temp_dir.append(std::wstring(L<span class='string_literal'>"\\"</span>)).append(temp_file);</td></tr>
<tr class="codeline" data-linenumber="965"><td class="num" id="LN965">965</td><td class="line">    DeleteFileW(temp_file.c_str());</td></tr>
<tr class="codeline" data-linenumber="966"><td class="num" id="LN966">966</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="967"><td class="num" id="LN967">967</td><td class="line">    <span class='keyword'>char</span> aname[MAX_PATH];</td></tr>
<tr class="codeline" data-linenumber="968"><td class="num" id="LN968">968</td><td class="line">    size_t copied = wcstombs(aname, temp_file.c_str(), MAX_PATH);</td></tr>
<tr class="codeline" data-linenumber="969"><td class="num" id="LN969">969</td><td class="line">    <span class='macro'>CV_Assert((copied != MAX_PATH) &amp;&amp; (copied != (size_t)-1))<span class='macro_popup'>do { if (!((copied != MAX_PATH) &amp;&amp; (copied != (size_t<br>)-1))) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="970"><td class="num" id="LN970">970</td><td class="line">    fname = String(aname);</td></tr>
<tr class="codeline" data-linenumber="971"><td class="num" id="LN971">971</td><td class="line">    RoUninitialize();</td></tr>
<tr class="codeline" data-linenumber="972"><td class="num" id="LN972">972</td><td class="line"><span class='directive'>#elif defined(_WIN32_WCE)</span></td></tr>
<tr class="codeline" data-linenumber="973"><td class="num" id="LN973">973</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>auto</span> kMaxPathSize = MAX_PATH+1;</td></tr>
<tr class="codeline" data-linenumber="974"><td class="num" id="LN974">974</td><td class="line">    <span class='keyword'>wchar_t</span> temp_dir[kMaxPathSize] = {0};</td></tr>
<tr class="codeline" data-linenumber="975"><td class="num" id="LN975">975</td><td class="line">    <span class='keyword'>wchar_t</span> temp_file[kMaxPathSize] = {0};</td></tr>
<tr class="codeline" data-linenumber="976"><td class="num" id="LN976">976</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="977"><td class="num" id="LN977">977</td><td class="line">    ::GetTempPathW(kMaxPathSize, temp_dir);</td></tr>
<tr class="codeline" data-linenumber="978"><td class="num" id="LN978">978</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="979"><td class="num" id="LN979">979</td><td class="line">    <span class='keyword'>if</span>(0 != ::GetTempFileNameW(temp_dir, L<span class='string_literal'>"ocv"</span>, 0, temp_file)) {</td></tr>
<tr class="codeline" data-linenumber="980"><td class="num" id="LN980">980</td><td class="line">        DeleteFileW(temp_file);</td></tr>
<tr class="codeline" data-linenumber="981"><td class="num" id="LN981">981</td><td class="line">        <span class='keyword'>char</span> aname[MAX_PATH];</td></tr>
<tr class="codeline" data-linenumber="982"><td class="num" id="LN982">982</td><td class="line">        size_t copied = wcstombs(aname, temp_file, MAX_PATH);</td></tr>
<tr class="codeline" data-linenumber="983"><td class="num" id="LN983">983</td><td class="line">        <span class='macro'>CV_Assert((copied != MAX_PATH) &amp;&amp; (copied != (size_t)-1))<span class='macro_popup'>do { if (!((copied != MAX_PATH) &amp;&amp; (copied != (size_t<br>)-1))) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="984"><td class="num" id="LN984">984</td><td class="line">        fname = String(aname);</td></tr>
<tr class="codeline" data-linenumber="985"><td class="num" id="LN985">985</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="986"><td class="num" id="LN986">986</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="987"><td class="num" id="LN987">987</td><td class="line">    <span class='keyword'>char</span> temp_dir2[MAX_PATH] = { 0 };</td></tr>
<tr class="codeline" data-linenumber="988"><td class="num" id="LN988">988</td><td class="line">    <span class='keyword'>char</span> temp_file[MAX_PATH] = { 0 };</td></tr>
<tr class="codeline" data-linenumber="989"><td class="num" id="LN989">989</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="990"><td class="num" id="LN990">990</td><td class="line">    <span class='keyword'>if</span> (temp_dir == 0 || temp_dir[0] == 0)</td></tr>
<tr class="codeline" data-linenumber="991"><td class="num" id="LN991">991</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="992"><td class="num" id="LN992">992</td><td class="line">        ::GetTempPathA(<span class='keyword'>sizeof</span>(temp_dir2), temp_dir2);</td></tr>
<tr class="codeline" data-linenumber="993"><td class="num" id="LN993">993</td><td class="line">        temp_dir = temp_dir2;</td></tr>
<tr class="codeline" data-linenumber="994"><td class="num" id="LN994">994</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="995"><td class="num" id="LN995">995</td><td class="line">    <span class='keyword'>if</span>(0 == ::GetTempFileNameA(temp_dir, <span class='string_literal'>"ocv"</span>, 0, temp_file))</td></tr>
<tr class="codeline" data-linenumber="996"><td class="num" id="LN996">996</td><td class="line">        <span class='keyword'>return</span> String();</td></tr>
<tr class="codeline" data-linenumber="997"><td class="num" id="LN997">997</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="998"><td class="num" id="LN998">998</td><td class="line">    DeleteFileA(temp_file);</td></tr>
<tr class="codeline" data-linenumber="999"><td class="num" id="LN999">999</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1000"><td class="num" id="LN1000">1000</td><td class="line">    fname = temp_file;</td></tr>
<tr class="codeline" data-linenumber="1001"><td class="num" id="LN1001">1001</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1002"><td class="num" id="LN1002">1002</td><td class="line"><span class='directive'># else</span></td></tr>
<tr class="codeline" data-linenumber="1003"><td class="num" id="LN1003">1003</td><td class="line"><span class='directive'>#  ifdef __ANDROID__</span></td></tr>
<tr class="codeline" data-linenumber="1004"><td class="num" id="LN1004">1004</td><td class="line">    <span class='comment'>//char defaultTemplate[] = "/mnt/sdcard/__opencv_temp.XXXXXX";</span></td></tr>
<tr class="codeline" data-linenumber="1005"><td class="num" id="LN1005">1005</td><td class="line">    <span class='keyword'>char</span> defaultTemplate[] = <span class='string_literal'>"/data/local/tmp/__opencv_temp.XXXXXX"</span>;</td></tr>
<tr class="codeline" data-linenumber="1006"><td class="num" id="LN1006">1006</td><td class="line"><span class='directive'>#  else</span></td></tr>
<tr class="codeline" data-linenumber="1007"><td class="num" id="LN1007">1007</td><td class="line">    <span class='keyword'>char</span> defaultTemplate[] = <span class='string_literal'>"/tmp/__opencv_temp.XXXXXX"</span>;</td></tr>
<tr class="codeline" data-linenumber="1008"><td class="num" id="LN1008">1008</td><td class="line"><span class='directive'>#  endif</span></td></tr>
<tr class="codeline" data-linenumber="1009"><td class="num" id="LN1009">1009</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1010"><td class="num" id="LN1010">1010</td><td class="line">    <span class='keyword'>if</span> (temp_dir == 0 || temp_dir[0] == 0)</td></tr>
<tr class="codeline" data-linenumber="1011"><td class="num" id="LN1011">1011</td><td class="line">        fname = defaultTemplate;</td></tr>
<tr class="codeline" data-linenumber="1012"><td class="num" id="LN1012">1012</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1013"><td class="num" id="LN1013">1013</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1014"><td class="num" id="LN1014">1014</td><td class="line">        fname = temp_dir;</td></tr>
<tr class="codeline" data-linenumber="1015"><td class="num" id="LN1015">1015</td><td class="line">        <span class='keyword'>char</span> ech = fname[fname.size() - 1];</td></tr>
<tr class="codeline" data-linenumber="1016"><td class="num" id="LN1016">1016</td><td class="line">        <span class='keyword'>if</span>(ech != '/' &amp;&amp; ech != '\\')</td></tr>
<tr class="codeline" data-linenumber="1017"><td class="num" id="LN1017">1017</td><td class="line">            fname = fname + <span class='string_literal'>"/"</span>;</td></tr>
<tr class="codeline" data-linenumber="1018"><td class="num" id="LN1018">1018</td><td class="line">        fname = fname + <span class='string_literal'>"__opencv_temp.XXXXXX"</span>;</td></tr>
<tr class="codeline" data-linenumber="1019"><td class="num" id="LN1019">1019</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1020"><td class="num" id="LN1020">1020</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1021"><td class="num" id="LN1021">1021</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>int</span> fd = mkstemp((<span class='keyword'>char</span>*)fname.c_str());</td></tr>
<tr class="codeline" data-linenumber="1022"><td class="num" id="LN1022">1022</td><td class="line">    <span class='keyword'>if</span> (fd == -1) <span class='keyword'>return</span> String();</td></tr>
<tr class="codeline" data-linenumber="1023"><td class="num" id="LN1023">1023</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1024"><td class="num" id="LN1024">1024</td><td class="line">    close(fd);</td></tr>
<tr class="codeline" data-linenumber="1025"><td class="num" id="LN1025">1025</td><td class="line">    remove(fname.c_str());</td></tr>
<tr class="codeline" data-linenumber="1026"><td class="num" id="LN1026">1026</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="1027"><td class="num" id="LN1027">1027</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1028"><td class="num" id="LN1028">1028</td><td class="line">    <span class='keyword'>if</span> (suffix)</td></tr>
<tr class="codeline" data-linenumber="1029"><td class="num" id="LN1029">1029</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1030"><td class="num" id="LN1030">1030</td><td class="line">        <span class='keyword'>if</span> (suffix[0] != '.')</td></tr>
<tr class="codeline" data-linenumber="1031"><td class="num" id="LN1031">1031</td><td class="line">            <span class='keyword'>return</span> fname + <span class='string_literal'>"."</span> + suffix;</td></tr>
<tr class="codeline" data-linenumber="1032"><td class="num" id="LN1032">1032</td><td class="line">        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1033"><td class="num" id="LN1033">1033</td><td class="line">            <span class='keyword'>return</span> fname + suffix;</td></tr>
<tr class="codeline" data-linenumber="1034"><td class="num" id="LN1034">1034</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1035"><td class="num" id="LN1035">1035</td><td class="line">    <span class='keyword'>return</span> fname;</td></tr>
<tr class="codeline" data-linenumber="1036"><td class="num" id="LN1036">1036</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1037"><td class="num" id="LN1037">1037</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1038"><td class="num" id="LN1038">1038</td><td class="line"><span class='keyword'>static</span> ErrorCallback customErrorCallback = 0;</td></tr>
<tr class="codeline" data-linenumber="1039"><td class="num" id="LN1039">1039</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span>* customErrorCallbackData = 0;</td></tr>
<tr class="codeline" data-linenumber="1040"><td class="num" id="LN1040">1040</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>bool</span> breakOnError = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1041"><td class="num" id="LN1041">1041</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1042"><td class="num" id="LN1042">1042</td><td class="line"><span class='keyword'>bool</span> setBreakOnError(<span class='keyword'>bool</span> value)</td></tr>
<tr class="codeline" data-linenumber="1043"><td class="num" id="LN1043">1043</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1044"><td class="num" id="LN1044">1044</td><td class="line">    <span class='keyword'>bool</span> prevVal = breakOnError;</td></tr>
<tr class="codeline" data-linenumber="1045"><td class="num" id="LN1045">1045</td><td class="line">    breakOnError = value;</td></tr>
<tr class="codeline" data-linenumber="1046"><td class="num" id="LN1046">1046</td><td class="line">    <span class='keyword'>return</span> prevVal;</td></tr>
<tr class="codeline" data-linenumber="1047"><td class="num" id="LN1047">1047</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1048"><td class="num" id="LN1048">1048</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1049"><td class="num" id="LN1049">1049</td><td class="line"><span class='keyword'>int</span> cv_snprintf(<span class='keyword'>char</span>* buf, <span class='keyword'>int</span> len, <span class='keyword'>const</span> <span class='keyword'>char</span>* fmt, ...)</td></tr>
<tr class="codeline" data-linenumber="1050"><td class="num" id="LN1050">1050</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1051"><td class="num" id="LN1051">1051</td><td class="line">    va_list va;</td></tr>
<tr class="codeline" data-linenumber="1052"><td class="num" id="LN1052">1052</td><td class="line">    <span class='macro'>va_start(va, fmt)<span class='macro_popup'>__builtin_va_start(va, fmt)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1053"><td class="num" id="LN1053">1053</td><td class="line">    <span class='keyword'>int</span> res = cv_vsnprintf(buf, len, fmt, va);</td></tr>
<tr class="codeline" data-linenumber="1054"><td class="num" id="LN1054">1054</td><td class="line">    <span class='macro'>va_end(va)<span class='macro_popup'>__builtin_va_end(va)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1055"><td class="num" id="LN1055">1055</td><td class="line">    <span class='keyword'>return</span> res;</td></tr>
<tr class="codeline" data-linenumber="1056"><td class="num" id="LN1056">1056</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1057"><td class="num" id="LN1057">1057</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1058"><td class="num" id="LN1058">1058</td><td class="line"><span class='keyword'>int</span> cv_vsnprintf(<span class='keyword'>char</span>* buf, <span class='keyword'>int</span> len, <span class='keyword'>const</span> <span class='keyword'>char</span>* fmt, va_list args)</td></tr>
<tr class="codeline" data-linenumber="1059"><td class="num" id="LN1059">1059</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1060"><td class="num" id="LN1060">1060</td><td class="line"><span class='directive'>#if defined _MSC_VER</span></td></tr>
<tr class="codeline" data-linenumber="1061"><td class="num" id="LN1061">1061</td><td class="line">    <span class='keyword'>if</span> (len &lt;= 0) <span class='keyword'>return</span> len == 0 ? 1024 : -1;</td></tr>
<tr class="codeline" data-linenumber="1062"><td class="num" id="LN1062">1062</td><td class="line">    <span class='keyword'>int</span> res = _vsnprintf_s(buf, len, _TRUNCATE, fmt, args);</td></tr>
<tr class="codeline" data-linenumber="1063"><td class="num" id="LN1063">1063</td><td class="line">    <span class='comment'>// ensure null terminating on VS</span></td></tr>
<tr class="codeline" data-linenumber="1064"><td class="num" id="LN1064">1064</td><td class="line">    <span class='keyword'>if</span> (res &gt;= 0 &amp;&amp; res &lt; len)</td></tr>
<tr class="codeline" data-linenumber="1065"><td class="num" id="LN1065">1065</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1066"><td class="num" id="LN1066">1066</td><td class="line">        buf[res] = 0;</td></tr>
<tr class="codeline" data-linenumber="1067"><td class="num" id="LN1067">1067</td><td class="line">        <span class='keyword'>return</span> res;</td></tr>
<tr class="codeline" data-linenumber="1068"><td class="num" id="LN1068">1068</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1069"><td class="num" id="LN1069">1069</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1070"><td class="num" id="LN1070">1070</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1071"><td class="num" id="LN1071">1071</td><td class="line">        buf[len - 1] = 0; <span class='comment'>// truncate happened</span></td></tr>
<tr class="codeline" data-linenumber="1072"><td class="num" id="LN1072">1072</td><td class="line">        <span class='keyword'>return</span> res &gt;= len ? res : (len * 2);</td></tr>
<tr class="codeline" data-linenumber="1073"><td class="num" id="LN1073">1073</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1074"><td class="num" id="LN1074">1074</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="1075"><td class="num" id="LN1075">1075</td><td class="line">    <span class='keyword'>return</span> vsnprintf(buf, len, fmt, args);</td></tr>
<tr class="codeline" data-linenumber="1076"><td class="num" id="LN1076">1076</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1077"><td class="num" id="LN1077">1077</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1078"><td class="num" id="LN1078">1078</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1079"><td class="num" id="LN1079">1079</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> dumpException(<span class='keyword'>const</span> Exception&amp; exc)</td></tr>
<tr class="codeline" data-linenumber="1080"><td class="num" id="LN1080">1080</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1081"><td class="num" id="LN1081">1081</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>char</span>* errorStr = cvErrorStr(exc.code);</td></tr>
<tr class="codeline" data-linenumber="1082"><td class="num" id="LN1082">1082</td><td class="line">    <span class='keyword'>char</span> buf[1 &lt;&lt; 12];</td></tr>
<tr class="codeline" data-linenumber="1083"><td class="num" id="LN1083">1083</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1084"><td class="num" id="LN1084">1084</td><td class="line">    cv_snprintf(buf, <span class='keyword'>sizeof</span>(buf),</td></tr>
<tr class="codeline" data-linenumber="1085"><td class="num" id="LN1085">1085</td><td class="line">        <span class='string_literal'>"OpenCV(%s) Error: %s (%s) in %s, file %s, line %d"</span>,</td></tr>
<tr class="codeline" data-linenumber="1086"><td class="num" id="LN1086">1086</td><td class="line">        <span class='macro'>CV_VERSION<span class='macro_popup'>"4" "." "5" "." "2" ""</span></span>,</td></tr>
<tr class="codeline" data-linenumber="1087"><td class="num" id="LN1087">1087</td><td class="line">        errorStr, exc.err.c_str(), exc.func.size() &gt; 0 ?</td></tr>
<tr class="codeline" data-linenumber="1088"><td class="num" id="LN1088">1088</td><td class="line">        exc.func.c_str() : <span class='string_literal'>"unknown function"</span>, exc.file.c_str(), exc.line);</td></tr>
<tr class="codeline" data-linenumber="1089"><td class="num" id="LN1089">1089</td><td class="line"><span class='directive'>#ifdef __ANDROID__</span></td></tr>
<tr class="codeline" data-linenumber="1090"><td class="num" id="LN1090">1090</td><td class="line">    __android_log_print(ANDROID_LOG_ERROR, <span class='string_literal'>"cv::error()"</span>, <span class='string_literal'>"%s"</span>, buf);</td></tr>
<tr class="codeline" data-linenumber="1091"><td class="num" id="LN1091">1091</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="1092"><td class="num" id="LN1092">1092</td><td class="line">    fflush(<span class='macro'>stdout<span class='macro_popup'>stdout</span></span>); fflush(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1093"><td class="num" id="LN1093">1093</td><td class="line">    fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, <span class='string_literal'>"%s\n"</span>, buf);</td></tr>
<tr class="codeline" data-linenumber="1094"><td class="num" id="LN1094">1094</td><td class="line">    fflush(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1095"><td class="num" id="LN1095">1095</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1096"><td class="num" id="LN1096">1096</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1097"><td class="num" id="LN1097">1097</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1098"><td class="num" id="LN1098">1098</td><td class="line"><span class='directive'>#ifdef CV_ERROR_SET_TERMINATE_HANDLER</span></td></tr>
<tr class="codeline" data-linenumber="1099"><td class="num" id="LN1099">1099</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>bool</span> cv_terminate_handler_installed = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1100"><td class="num" id="LN1100">1100</td><td class="line"><span class='keyword'>static</span> std::terminate_handler cv_old_terminate_handler;</td></tr>
<tr class="codeline" data-linenumber="1101"><td class="num" id="LN1101">1101</td><td class="line"><span class='keyword'>static</span> cv::Exception cv_terminate_handler_exception;</td></tr>
<tr class="codeline" data-linenumber="1102"><td class="num" id="LN1102">1102</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>bool</span> param_setupTerminateHandler = utils::getConfigurationParameterBool(<span class='string_literal'>"OPENCV_SETUP_TERMINATE_HANDLER"</span>, <span class='keyword'>true</span>);</td></tr>
<tr class="codeline" data-linenumber="1103"><td class="num" id="LN1103">1103</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> cv_terminate_handler() {</td></tr>
<tr class="codeline" data-linenumber="1104"><td class="num" id="LN1104">1104</td><td class="line">    std::cerr &lt;&lt; <span class='string_literal'>"OpenCV: terminate handler is called! The last OpenCV error is:\n"</span>;</td></tr>
<tr class="codeline" data-linenumber="1105"><td class="num" id="LN1105">1105</td><td class="line">    dumpException(cv_terminate_handler_exception);</td></tr>
<tr class="codeline" data-linenumber="1106"><td class="num" id="LN1106">1106</td><td class="line">    <span class='keyword'>if</span> (<span class='keyword'>false</span> <span class='comment'>/*cv_old_terminate_handler*/</span>)  <span class='comment'>// buggy behavior is observed with doubled "abort/retry/ignore" windows</span></td></tr>
<tr class="codeline" data-linenumber="1107"><td class="num" id="LN1107">1107</td><td class="line">        cv_old_terminate_handler();</td></tr>
<tr class="codeline" data-linenumber="1108"><td class="num" id="LN1108">1108</td><td class="line">    abort();</td></tr>
<tr class="codeline" data-linenumber="1109"><td class="num" id="LN1109">1109</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1110"><td class="num" id="LN1110">1110</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1111"><td class="num" id="LN1111">1111</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1112"><td class="num" id="LN1112">1112</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1113"><td class="num" id="LN1113">1113</td><td class="line"><span class='directive'>#ifdef <span class='macro'>__GNUC__<span class='macro_popup'>4</span></span></span></td></tr>
<tr class="codeline" data-linenumber="1114"><td class="num" id="LN1114">1114</td><td class="line"><span class='directive'># if defined <span class='macro'>__clang__<span class='macro_popup'>1</span></span> || defined __APPLE__</span></td></tr>
<tr class="codeline" data-linenumber="1115"><td class="num" id="LN1115">1115</td><td class="line"><span class='directive'>#   pragma GCC diagnostic push</span></td></tr>
<tr class="codeline" data-linenumber="1116"><td class="num" id="LN1116">1116</td><td class="line"><span class='directive'>#   pragma GCC diagnostic ignored "-Winvalid-noreturn"</span></td></tr>
<tr class="codeline" data-linenumber="1117"><td class="num" id="LN1117">1117</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="1118"><td class="num" id="LN1118">1118</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1119"><td class="num" id="LN1119">1119</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1120"><td class="num" id="LN1120">1120</td><td class="line"><span class='keyword'>void</span> error( <span class='keyword'>const</span> Exception&amp; exc )</td></tr>
<tr class="codeline" data-linenumber="1121"><td class="num" id="LN1121">1121</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1122"><td class="num" id="LN1122">1122</td><td class="line"><span class='directive'>#ifdef CV_ERROR_SET_TERMINATE_HANDLER</span></td></tr>
<tr class="codeline" data-linenumber="1123"><td class="num" id="LN1123">1123</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1124"><td class="num" id="LN1124">1124</td><td class="line">        cv::AutoLock lock(getInitializationMutex());</td></tr>
<tr class="codeline" data-linenumber="1125"><td class="num" id="LN1125">1125</td><td class="line">        <span class='keyword'>if</span> (!cv_terminate_handler_installed)</td></tr>
<tr class="codeline" data-linenumber="1126"><td class="num" id="LN1126">1126</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1127"><td class="num" id="LN1127">1127</td><td class="line">            <span class='keyword'>if</span> (param_setupTerminateHandler)</td></tr>
<tr class="codeline" data-linenumber="1128"><td class="num" id="LN1128">1128</td><td class="line">                cv_old_terminate_handler = std::set_terminate(cv_terminate_handler);</td></tr>
<tr class="codeline" data-linenumber="1129"><td class="num" id="LN1129">1129</td><td class="line">            cv_terminate_handler_installed = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="1130"><td class="num" id="LN1130">1130</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1131"><td class="num" id="LN1131">1131</td><td class="line">        cv_terminate_handler_exception = exc;</td></tr>
<tr class="codeline" data-linenumber="1132"><td class="num" id="LN1132">1132</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1133"><td class="num" id="LN1133">1133</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1134"><td class="num" id="LN1134">1134</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1135"><td class="num" id="LN1135">1135</td><td class="line">    <span class='keyword'>if</span> (<span class="mrange">customErrorCallback != 0</span>)</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path7" class="msg msgEvent" style="margin-left:9ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">7</div></td><td><div class="PathNav"><a href="#Path6" title="Previous event (6)">&#x2190;</a></div></td><td>Assuming 'customErrorCallback' is equal to null</td><td><div class="PathNav"><a href="#Path8" title="Next event (8)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path8" class="msg msgControl" style="margin-left:5ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">8</div></td><td><div class="PathNav"><a href="#Path7" title="Previous event (7)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path9" title="Next event (9)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="1136"><td class="num" id="LN1136">1136</td><td class="line">        customErrorCallback(exc.code, exc.func.c_str(), exc.err.c_str(),</td></tr>
<tr class="codeline" data-linenumber="1137"><td class="num" id="LN1137">1137</td><td class="line">                            exc.file.c_str(), exc.line, customErrorCallbackData);</td></tr>
<tr class="codeline" data-linenumber="1138"><td class="num" id="LN1138">1138</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (<span class="mrange">param_dumpErrors</span>)</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path9" class="msg msgEvent" style="margin-left:14ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">9</div></td><td><div class="PathNav"><a href="#Path8" title="Previous event (8)">&#x2190;</a></div></td><td>Assuming 'param_dumpErrors' is false</td><td><div class="PathNav"><a href="#Path10" title="Next event (10)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path10" class="msg msgControl" style="margin-left:10ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">10</div></td><td><div class="PathNav"><a href="#Path9" title="Previous event (9)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path11" title="Next event (11)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="1139"><td class="num" id="LN1139">1139</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1140"><td class="num" id="LN1140">1140</td><td class="line">        dumpException(exc);</td></tr>
<tr class="codeline" data-linenumber="1141"><td class="num" id="LN1141">1141</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1142"><td class="num" id="LN1142">1142</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1143"><td class="num" id="LN1143">1143</td><td class="line">    <span class='keyword'>if</span>(<span class="mrange">breakOnError</span>)</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path11" class="msg msgEvent" style="margin-left:8ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">11</div></td><td><div class="PathNav"><a href="#Path10" title="Previous event (10)">&#x2190;</a></div></td><td>Assuming 'breakOnError' is false</td><td><div class="PathNav"><a href="#Path12" title="Next event (12)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path12" class="msg msgControl" style="margin-left:5ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">12</div></td><td><div class="PathNav"><a href="#Path11" title="Previous event (11)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path13" title="Next event (13)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="1144"><td class="num" id="LN1144">1144</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1145"><td class="num" id="LN1145">1145</td><td class="line">        <span class='keyword'>static</span> <span class='keyword'>volatile</span> <span class='keyword'>int</span>* p = 0;</td></tr>
<tr class="codeline" data-linenumber="1146"><td class="num" id="LN1146">1146</td><td class="line">        *p = 0;</td></tr>
<tr class="codeline" data-linenumber="1147"><td class="num" id="LN1147">1147</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1148"><td class="num" id="LN1148">1148</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1149"><td class="num" id="LN1149">1149</td><td class="line">    <span class='keyword'>throw</span> exc;</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path13" class="msg msgEvent" style="margin-left:5ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">13</div></td><td><div class="PathNav"><a href="#Path12" title="Previous event (12)">&#x2190;</a></div></td><td>Throwing exception</td><td><div class="PathNav"><a href="#Path14" title="Next event (14)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="1150"><td class="num" id="LN1150">1150</td><td class="line"><span class='directive'>#ifdef <span class='macro'>__GNUC__<span class='macro_popup'>4</span></span></span></td></tr>
<tr class="codeline" data-linenumber="1151"><td class="num" id="LN1151">1151</td><td class="line"><span class='directive'># if !defined <span class='macro'>__clang__<span class='macro_popup'>1</span></span> &amp;&amp; !defined __APPLE__</span></td></tr>
<tr class="codeline" data-linenumber="1152"><td class="num" id="LN1152">1152</td><td class="line">    <span class='comment'>// this suppresses this warning: "noreturn" function does return [enabled by default]</span></td></tr>
<tr class="codeline" data-linenumber="1153"><td class="num" id="LN1153">1153</td><td class="line">    __builtin_trap();</td></tr>
<tr class="codeline" data-linenumber="1154"><td class="num" id="LN1154">1154</td><td class="line">    <span class='comment'>// or use infinite loop: for (;;) {}</span></td></tr>
<tr class="codeline" data-linenumber="1155"><td class="num" id="LN1155">1155</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="1156"><td class="num" id="LN1156">1156</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1157"><td class="num" id="LN1157">1157</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1158"><td class="num" id="LN1158">1158</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1159"><td class="num" id="LN1159">1159</td><td class="line"><span class='keyword'>void</span> error(<span class='keyword'>int</span> _code, <span class='keyword'>const</span> String&amp; _err, <span class='keyword'>const</span> <span class='keyword'>char</span>* _func, <span class='keyword'>const</span> <span class='keyword'>char</span>* _file, <span class='keyword'>int</span> _line)</td></tr>
<tr class="codeline" data-linenumber="1160"><td class="num" id="LN1160">1160</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1161"><td class="num" id="LN1161">1161</td><td class="line">    <span class="mrange"><span class="mrange">error(cv::Exception(_code, _err, _func, _file, _line))</span></span>;</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path6" class="msg msgEvent" style="margin-left:5ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">6</div></td><td><div class="PathNav"><a href="#Path5" title="Previous event (5)">&#x2190;</a></div></td><td>Calling 'error'</td><td><div class="PathNav"><a href="#Path7" title="Next event (7)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path14" class="msg msgEvent" style="margin-left:5ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">14</div></td><td><div class="PathNav"><a href="#Path13" title="Previous event (13)">&#x2190;</a></div></td><td>Returning from 'error'</td><td><div class="PathNav"><a href="#Path15" title="Next event (15)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="1162"><td class="num" id="LN1162">1162</td><td class="line"><span class='directive'>#ifdef <span class='macro'>__GNUC__<span class='macro_popup'>4</span></span></span></td></tr>
<tr class="codeline" data-linenumber="1163"><td class="num" id="LN1163">1163</td><td class="line"><span class='directive'># if !defined <span class='macro'>__clang__<span class='macro_popup'>1</span></span> &amp;&amp; !defined __APPLE__</span></td></tr>
<tr class="codeline" data-linenumber="1164"><td class="num" id="LN1164">1164</td><td class="line">    <span class='comment'>// this suppresses this warning: "noreturn" function does return [enabled by default]</span></td></tr>
<tr class="codeline" data-linenumber="1165"><td class="num" id="LN1165">1165</td><td class="line">    __builtin_trap();</td></tr>
<tr class="codeline" data-linenumber="1166"><td class="num" id="LN1166">1166</td><td class="line">    <span class='comment'>// or use infinite loop: for (;;) {}</span></td></tr>
<tr class="codeline" data-linenumber="1167"><td class="num" id="LN1167">1167</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="1168"><td class="num" id="LN1168">1168</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1169"><td class="num" id="LN1169">1169</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1170"><td class="num" id="LN1170">1170</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1171"><td class="num" id="LN1171">1171</td><td class="line"><span class='directive'>#ifdef <span class='macro'>__GNUC__<span class='macro_popup'>4</span></span></span></td></tr>
<tr class="codeline" data-linenumber="1172"><td class="num" id="LN1172">1172</td><td class="line"><span class='directive'># if defined <span class='macro'>__clang__<span class='macro_popup'>1</span></span> || defined __APPLE__</span></td></tr>
<tr class="codeline" data-linenumber="1173"><td class="num" id="LN1173">1173</td><td class="line"><span class='directive'>#   pragma GCC diagnostic pop</span></td></tr>
<tr class="codeline" data-linenumber="1174"><td class="num" id="LN1174">1174</td><td class="line"><span class='directive'># endif</span></td></tr>
<tr class="codeline" data-linenumber="1175"><td class="num" id="LN1175">1175</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1176"><td class="num" id="LN1176">1176</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1177"><td class="num" id="LN1177">1177</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1178"><td class="num" id="LN1178">1178</td><td class="line">ErrorCallback</td></tr>
<tr class="codeline" data-linenumber="1179"><td class="num" id="LN1179">1179</td><td class="line">redirectError( ErrorCallback errCallback, <span class='keyword'>void</span>* userdata, <span class='keyword'>void</span>** prevUserdata)</td></tr>
<tr class="codeline" data-linenumber="1180"><td class="num" id="LN1180">1180</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1181"><td class="num" id="LN1181">1181</td><td class="line">    <span class='keyword'>if</span>( prevUserdata )</td></tr>
<tr class="codeline" data-linenumber="1182"><td class="num" id="LN1182">1182</td><td class="line">        *prevUserdata = customErrorCallbackData;</td></tr>
<tr class="codeline" data-linenumber="1183"><td class="num" id="LN1183">1183</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1184"><td class="num" id="LN1184">1184</td><td class="line">    ErrorCallback prevCallback = customErrorCallback;</td></tr>
<tr class="codeline" data-linenumber="1185"><td class="num" id="LN1185">1185</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1186"><td class="num" id="LN1186">1186</td><td class="line">    customErrorCallback     = errCallback;</td></tr>
<tr class="codeline" data-linenumber="1187"><td class="num" id="LN1187">1187</td><td class="line">    customErrorCallbackData = userdata;</td></tr>
<tr class="codeline" data-linenumber="1188"><td class="num" id="LN1188">1188</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1189"><td class="num" id="LN1189">1189</td><td class="line">    <span class='keyword'>return</span> prevCallback;</td></tr>
<tr class="codeline" data-linenumber="1190"><td class="num" id="LN1190">1190</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1191"><td class="num" id="LN1191">1191</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1192"><td class="num" id="LN1192">1192</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1193"><td class="num" id="LN1193">1193</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1194"><td class="num" id="LN1194">1194</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>int</span> cvCheckHardwareSupport(<span class='keyword'>int</span> feature)</td></tr>
<tr class="codeline" data-linenumber="1195"><td class="num" id="LN1195">1195</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1196"><td class="num" id="LN1196">1196</td><td class="line">    <span class='macro'>CV_DbgAssert( 0 &lt;= feature &amp;&amp; feature &lt;= CV_HARDWARE_MAX_FEATURE )<span class='macro_popup'>do { if (!(0 &lt;= feature &amp;&amp; feature &lt;= 512)) abort<br>(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1197"><td class="num" id="LN1197">1197</td><td class="line">    <span class='keyword'>return</span> cv::currentFeatures-&gt;have[feature];</td></tr>
<tr class="codeline" data-linenumber="1198"><td class="num" id="LN1198">1198</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1199"><td class="num" id="LN1199">1199</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1200"><td class="num" id="LN1200">1200</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>int</span> cvUseOptimized( <span class='keyword'>int</span> flag )</td></tr>
<tr class="codeline" data-linenumber="1201"><td class="num" id="LN1201">1201</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1202"><td class="num" id="LN1202">1202</td><td class="line">    <span class='keyword'>int</span> prevMode = cv::useOptimizedFlag;</td></tr>
<tr class="codeline" data-linenumber="1203"><td class="num" id="LN1203">1203</td><td class="line">    cv::setUseOptimized( flag != 0 );</td></tr>
<tr class="codeline" data-linenumber="1204"><td class="num" id="LN1204">1204</td><td class="line">    <span class='keyword'>return</span> prevMode;</td></tr>
<tr class="codeline" data-linenumber="1205"><td class="num" id="LN1205">1205</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1206"><td class="num" id="LN1206">1206</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1207"><td class="num" id="LN1207">1207</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> int64  cvGetTickCount(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="1208"><td class="num" id="LN1208">1208</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1209"><td class="num" id="LN1209">1209</td><td class="line">    <span class='keyword'>return</span> cv::getTickCount();</td></tr>
<tr class="codeline" data-linenumber="1210"><td class="num" id="LN1210">1210</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1211"><td class="num" id="LN1211">1211</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1212"><td class="num" id="LN1212">1212</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>double</span> cvGetTickFrequency(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="1213"><td class="num" id="LN1213">1213</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1214"><td class="num" id="LN1214">1214</td><td class="line">    <span class='keyword'>return</span> cv::getTickFrequency()*1e-6;</td></tr>
<tr class="codeline" data-linenumber="1215"><td class="num" id="LN1215">1215</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1216"><td class="num" id="LN1216">1216</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1217"><td class="num" id="LN1217">1217</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> CvErrorCallback</td></tr>
<tr class="codeline" data-linenumber="1218"><td class="num" id="LN1218">1218</td><td class="line">cvRedirectError( CvErrorCallback errCallback, <span class='keyword'>void</span>* userdata, <span class='keyword'>void</span>** prevUserdata)</td></tr>
<tr class="codeline" data-linenumber="1219"><td class="num" id="LN1219">1219</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1220"><td class="num" id="LN1220">1220</td><td class="line">    <span class='keyword'>return</span> cv::redirectError(errCallback, userdata, prevUserdata);</td></tr>
<tr class="codeline" data-linenumber="1221"><td class="num" id="LN1221">1221</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1222"><td class="num" id="LN1222">1222</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1223"><td class="num" id="LN1223">1223</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>int</span> cvNulDevReport( <span class='keyword'>int</span>, <span class='keyword'>const</span> <span class='keyword'>char</span>*, <span class='keyword'>const</span> <span class='keyword'>char</span>*,</td></tr>
<tr class="codeline" data-linenumber="1224"><td class="num" id="LN1224">1224</td><td class="line">                            <span class='keyword'>const</span> <span class='keyword'>char</span>*, <span class='keyword'>int</span>, <span class='keyword'>void</span>* )</td></tr>
<tr class="codeline" data-linenumber="1225"><td class="num" id="LN1225">1225</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1226"><td class="num" id="LN1226">1226</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1227"><td class="num" id="LN1227">1227</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1228"><td class="num" id="LN1228">1228</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1229"><td class="num" id="LN1229">1229</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>int</span> cvStdErrReport( <span class='keyword'>int</span>, <span class='keyword'>const</span> <span class='keyword'>char</span>*, <span class='keyword'>const</span> <span class='keyword'>char</span>*,</td></tr>
<tr class="codeline" data-linenumber="1230"><td class="num" id="LN1230">1230</td><td class="line">                            <span class='keyword'>const</span> <span class='keyword'>char</span>*, <span class='keyword'>int</span>, <span class='keyword'>void</span>* )</td></tr>
<tr class="codeline" data-linenumber="1231"><td class="num" id="LN1231">1231</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1232"><td class="num" id="LN1232">1232</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1233"><td class="num" id="LN1233">1233</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1234"><td class="num" id="LN1234">1234</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1235"><td class="num" id="LN1235">1235</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>int</span> cvGuiBoxReport( <span class='keyword'>int</span>, <span class='keyword'>const</span> <span class='keyword'>char</span>*, <span class='keyword'>const</span> <span class='keyword'>char</span>*,</td></tr>
<tr class="codeline" data-linenumber="1236"><td class="num" id="LN1236">1236</td><td class="line">                            <span class='keyword'>const</span> <span class='keyword'>char</span>*, <span class='keyword'>int</span>, <span class='keyword'>void</span>* )</td></tr>
<tr class="codeline" data-linenumber="1237"><td class="num" id="LN1237">1237</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1238"><td class="num" id="LN1238">1238</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1239"><td class="num" id="LN1239">1239</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1240"><td class="num" id="LN1240">1240</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1241"><td class="num" id="LN1241">1241</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>int</span> cvGetErrInfo( <span class='keyword'>const</span> <span class='keyword'>char</span>**, <span class='keyword'>const</span> <span class='keyword'>char</span>**, <span class='keyword'>const</span> <span class='keyword'>char</span>**, <span class='keyword'>int</span>* )</td></tr>
<tr class="codeline" data-linenumber="1242"><td class="num" id="LN1242">1242</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1243"><td class="num" id="LN1243">1243</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1244"><td class="num" id="LN1244">1244</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1245"><td class="num" id="LN1245">1245</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1246"><td class="num" id="LN1246">1246</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1247"><td class="num" id="LN1247">1247</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>const</span> <span class='keyword'>char</span>* cvErrorStr( <span class='keyword'>int</span> status )</td></tr>
<tr class="codeline" data-linenumber="1248"><td class="num" id="LN1248">1248</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1249"><td class="num" id="LN1249">1249</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>char</span> buf[256];</td></tr>
<tr class="codeline" data-linenumber="1250"><td class="num" id="LN1250">1250</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1251"><td class="num" id="LN1251">1251</td><td class="line">    <span class='keyword'>switch</span> (status)</td></tr>
<tr class="codeline" data-linenumber="1252"><td class="num" id="LN1252">1252</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1253"><td class="num" id="LN1253">1253</td><td class="line">    <span class='keyword'>case</span> CV_StsOk :                  <span class='keyword'>return</span> <span class='string_literal'>"No Error"</span>;</td></tr>
<tr class="codeline" data-linenumber="1254"><td class="num" id="LN1254">1254</td><td class="line">    <span class='keyword'>case</span> CV_StsBackTrace :           <span class='keyword'>return</span> <span class='string_literal'>"Backtrace"</span>;</td></tr>
<tr class="codeline" data-linenumber="1255"><td class="num" id="LN1255">1255</td><td class="line">    <span class='keyword'>case</span> CV_StsError :               <span class='keyword'>return</span> <span class='string_literal'>"Unspecified error"</span>;</td></tr>
<tr class="codeline" data-linenumber="1256"><td class="num" id="LN1256">1256</td><td class="line">    <span class='keyword'>case</span> CV_StsInternal :            <span class='keyword'>return</span> <span class='string_literal'>"Internal error"</span>;</td></tr>
<tr class="codeline" data-linenumber="1257"><td class="num" id="LN1257">1257</td><td class="line">    <span class='keyword'>case</span> CV_StsNoMem :               <span class='keyword'>return</span> <span class='string_literal'>"Insufficient memory"</span>;</td></tr>
<tr class="codeline" data-linenumber="1258"><td class="num" id="LN1258">1258</td><td class="line">    <span class='keyword'>case</span> CV_StsBadArg :              <span class='keyword'>return</span> <span class='string_literal'>"Bad argument"</span>;</td></tr>
<tr class="codeline" data-linenumber="1259"><td class="num" id="LN1259">1259</td><td class="line">    <span class='keyword'>case</span> CV_StsNoConv :              <span class='keyword'>return</span> <span class='string_literal'>"Iterations do not converge"</span>;</td></tr>
<tr class="codeline" data-linenumber="1260"><td class="num" id="LN1260">1260</td><td class="line">    <span class='keyword'>case</span> CV_StsAutoTrace :           <span class='keyword'>return</span> <span class='string_literal'>"Autotrace call"</span>;</td></tr>
<tr class="codeline" data-linenumber="1261"><td class="num" id="LN1261">1261</td><td class="line">    <span class='keyword'>case</span> CV_StsBadSize :             <span class='keyword'>return</span> <span class='string_literal'>"Incorrect size of input array"</span>;</td></tr>
<tr class="codeline" data-linenumber="1262"><td class="num" id="LN1262">1262</td><td class="line">    <span class='keyword'>case</span> CV_StsNullPtr :             <span class='keyword'>return</span> <span class='string_literal'>"Null pointer"</span>;</td></tr>
<tr class="codeline" data-linenumber="1263"><td class="num" id="LN1263">1263</td><td class="line">    <span class='keyword'>case</span> CV_StsDivByZero :           <span class='keyword'>return</span> <span class='string_literal'>"Division by zero occurred"</span>;</td></tr>
<tr class="codeline" data-linenumber="1264"><td class="num" id="LN1264">1264</td><td class="line">    <span class='keyword'>case</span> CV_BadStep :                <span class='keyword'>return</span> <span class='string_literal'>"Image step is wrong"</span>;</td></tr>
<tr class="codeline" data-linenumber="1265"><td class="num" id="LN1265">1265</td><td class="line">    <span class='keyword'>case</span> CV_StsInplaceNotSupported : <span class='keyword'>return</span> <span class='string_literal'>"Inplace operation is not supported"</span>;</td></tr>
<tr class="codeline" data-linenumber="1266"><td class="num" id="LN1266">1266</td><td class="line">    <span class='keyword'>case</span> CV_StsObjectNotFound :      <span class='keyword'>return</span> <span class='string_literal'>"Requested object was not found"</span>;</td></tr>
<tr class="codeline" data-linenumber="1267"><td class="num" id="LN1267">1267</td><td class="line">    <span class='keyword'>case</span> CV_BadDepth :               <span class='keyword'>return</span> <span class='string_literal'>"Input image depth is not supported by function"</span>;</td></tr>
<tr class="codeline" data-linenumber="1268"><td class="num" id="LN1268">1268</td><td class="line">    <span class='keyword'>case</span> CV_StsUnmatchedFormats :    <span class='keyword'>return</span> <span class='string_literal'>"Formats of input arguments do not match"</span>;</td></tr>
<tr class="codeline" data-linenumber="1269"><td class="num" id="LN1269">1269</td><td class="line">    <span class='keyword'>case</span> CV_StsUnmatchedSizes :      <span class='keyword'>return</span> <span class='string_literal'>"Sizes of input arguments do not match"</span>;</td></tr>
<tr class="codeline" data-linenumber="1270"><td class="num" id="LN1270">1270</td><td class="line">    <span class='keyword'>case</span> CV_StsOutOfRange :          <span class='keyword'>return</span> <span class='string_literal'>"One of the arguments\' values is out of range"</span>;</td></tr>
<tr class="codeline" data-linenumber="1271"><td class="num" id="LN1271">1271</td><td class="line">    <span class='keyword'>case</span> CV_StsUnsupportedFormat :   <span class='keyword'>return</span> <span class='string_literal'>"Unsupported format or combination of formats"</span>;</td></tr>
<tr class="codeline" data-linenumber="1272"><td class="num" id="LN1272">1272</td><td class="line">    <span class='keyword'>case</span> CV_BadCOI :                 <span class='keyword'>return</span> <span class='string_literal'>"Input COI is not supported"</span>;</td></tr>
<tr class="codeline" data-linenumber="1273"><td class="num" id="LN1273">1273</td><td class="line">    <span class='keyword'>case</span> CV_BadNumChannels :         <span class='keyword'>return</span> <span class='string_literal'>"Bad number of channels"</span>;</td></tr>
<tr class="codeline" data-linenumber="1274"><td class="num" id="LN1274">1274</td><td class="line">    <span class='keyword'>case</span> CV_StsBadFlag :             <span class='keyword'>return</span> <span class='string_literal'>"Bad flag (parameter or structure field)"</span>;</td></tr>
<tr class="codeline" data-linenumber="1275"><td class="num" id="LN1275">1275</td><td class="line">    <span class='keyword'>case</span> CV_StsBadPoint :            <span class='keyword'>return</span> <span class='string_literal'>"Bad parameter of type CvPoint"</span>;</td></tr>
<tr class="codeline" data-linenumber="1276"><td class="num" id="LN1276">1276</td><td class="line">    <span class='keyword'>case</span> CV_StsBadMask :             <span class='keyword'>return</span> <span class='string_literal'>"Bad type of mask argument"</span>;</td></tr>
<tr class="codeline" data-linenumber="1277"><td class="num" id="LN1277">1277</td><td class="line">    <span class='keyword'>case</span> CV_StsParseError :          <span class='keyword'>return</span> <span class='string_literal'>"Parsing error"</span>;</td></tr>
<tr class="codeline" data-linenumber="1278"><td class="num" id="LN1278">1278</td><td class="line">    <span class='keyword'>case</span> CV_StsNotImplemented :      <span class='keyword'>return</span> <span class='string_literal'>"The function/feature is not implemented"</span>;</td></tr>
<tr class="codeline" data-linenumber="1279"><td class="num" id="LN1279">1279</td><td class="line">    <span class='keyword'>case</span> CV_StsBadMemBlock :         <span class='keyword'>return</span> <span class='string_literal'>"Memory block has been corrupted"</span>;</td></tr>
<tr class="codeline" data-linenumber="1280"><td class="num" id="LN1280">1280</td><td class="line">    <span class='keyword'>case</span> CV_StsAssert :              <span class='keyword'>return</span> <span class='string_literal'>"Assertion failed"</span>;</td></tr>
<tr class="codeline" data-linenumber="1281"><td class="num" id="LN1281">1281</td><td class="line">    <span class='keyword'>case</span> CV_GpuNotSupported :        <span class='keyword'>return</span> <span class='string_literal'>"No CUDA support"</span>;</td></tr>
<tr class="codeline" data-linenumber="1282"><td class="num" id="LN1282">1282</td><td class="line">    <span class='keyword'>case</span> CV_GpuApiCallError :        <span class='keyword'>return</span> <span class='string_literal'>"Gpu API call"</span>;</td></tr>
<tr class="codeline" data-linenumber="1283"><td class="num" id="LN1283">1283</td><td class="line">    <span class='keyword'>case</span> CV_OpenGlNotSupported :     <span class='keyword'>return</span> <span class='string_literal'>"No OpenGL support"</span>;</td></tr>
<tr class="codeline" data-linenumber="1284"><td class="num" id="LN1284">1284</td><td class="line">    <span class='keyword'>case</span> CV_OpenGlApiCallError :     <span class='keyword'>return</span> <span class='string_literal'>"OpenGL API call"</span>;</td></tr>
<tr class="codeline" data-linenumber="1285"><td class="num" id="LN1285">1285</td><td class="line">    };</td></tr>
<tr class="codeline" data-linenumber="1286"><td class="num" id="LN1286">1286</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1287"><td class="num" id="LN1287">1287</td><td class="line">    sprintf(buf, <span class='string_literal'>"Unknown %s code %d"</span>, status &gt;= 0 ? <span class='string_literal'>"status"</span>:<span class='string_literal'>"error"</span>, status);</td></tr>
<tr class="codeline" data-linenumber="1288"><td class="num" id="LN1288">1288</td><td class="line">    <span class='keyword'>return</span> buf;</td></tr>
<tr class="codeline" data-linenumber="1289"><td class="num" id="LN1289">1289</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1290"><td class="num" id="LN1290">1290</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1291"><td class="num" id="LN1291">1291</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>int</span> cvGetErrMode(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="1292"><td class="num" id="LN1292">1292</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1293"><td class="num" id="LN1293">1293</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1294"><td class="num" id="LN1294">1294</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1295"><td class="num" id="LN1295">1295</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1296"><td class="num" id="LN1296">1296</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>int</span> cvSetErrMode(<span class='keyword'>int</span>)</td></tr>
<tr class="codeline" data-linenumber="1297"><td class="num" id="LN1297">1297</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1298"><td class="num" id="LN1298">1298</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1299"><td class="num" id="LN1299">1299</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1300"><td class="num" id="LN1300">1300</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1301"><td class="num" id="LN1301">1301</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>int</span> cvGetErrStatus(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="1302"><td class="num" id="LN1302">1302</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1303"><td class="num" id="LN1303">1303</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1304"><td class="num" id="LN1304">1304</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1305"><td class="num" id="LN1305">1305</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1306"><td class="num" id="LN1306">1306</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>void</span> cvSetErrStatus(<span class='keyword'>int</span>)</td></tr>
<tr class="codeline" data-linenumber="1307"><td class="num" id="LN1307">1307</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1308"><td class="num" id="LN1308">1308</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1309"><td class="num" id="LN1309">1309</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1310"><td class="num" id="LN1310">1310</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1311"><td class="num" id="LN1311">1311</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>void</span> cvError( <span class='keyword'>int</span> code, <span class='keyword'>const</span> <span class='keyword'>char</span>* func_name,</td></tr>
<tr class="codeline" data-linenumber="1312"><td class="num" id="LN1312">1312</td><td class="line">                      <span class='keyword'>const</span> <span class='keyword'>char</span>* err_msg,</td></tr>
<tr class="codeline" data-linenumber="1313"><td class="num" id="LN1313">1313</td><td class="line">                      <span class='keyword'>const</span> <span class='keyword'>char</span>* file_name, <span class='keyword'>int</span> line )</td></tr>
<tr class="codeline" data-linenumber="1314"><td class="num" id="LN1314">1314</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1315"><td class="num" id="LN1315">1315</td><td class="line">    cv::error(cv::Exception(code, err_msg, func_name, file_name, line));</td></tr>
<tr class="codeline" data-linenumber="1316"><td class="num" id="LN1316">1316</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1317"><td class="num" id="LN1317">1317</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1318"><td class="num" id="LN1318">1318</td><td class="line"><span class='comment'>/* function, which converts int to int */</span></td></tr>
<tr class="codeline" data-linenumber="1319"><td class="num" id="LN1319">1319</td><td class="line"><span class='macro'>CV_IMPL<span class='macro_popup'>extern "C"</span></span> <span class='keyword'>int</span></td></tr>
<tr class="codeline" data-linenumber="1320"><td class="num" id="LN1320">1320</td><td class="line">cvErrorFromIppStatus( <span class='keyword'>int</span> status )</td></tr>
<tr class="codeline" data-linenumber="1321"><td class="num" id="LN1321">1321</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1322"><td class="num" id="LN1322">1322</td><td class="line">    <span class='keyword'>switch</span> (status)</td></tr>
<tr class="codeline" data-linenumber="1323"><td class="num" id="LN1323">1323</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1324"><td class="num" id="LN1324">1324</td><td class="line">    <span class='keyword'>case</span> CV_BADSIZE_ERR:               <span class='keyword'>return</span> CV_StsBadSize;</td></tr>
<tr class="codeline" data-linenumber="1325"><td class="num" id="LN1325">1325</td><td class="line">    <span class='keyword'>case</span> CV_BADMEMBLOCK_ERR:           <span class='keyword'>return</span> CV_StsBadMemBlock;</td></tr>
<tr class="codeline" data-linenumber="1326"><td class="num" id="LN1326">1326</td><td class="line">    <span class='keyword'>case</span> CV_NULLPTR_ERR:               <span class='keyword'>return</span> CV_StsNullPtr;</td></tr>
<tr class="codeline" data-linenumber="1327"><td class="num" id="LN1327">1327</td><td class="line">    <span class='keyword'>case</span> CV_DIV_BY_ZERO_ERR:           <span class='keyword'>return</span> CV_StsDivByZero;</td></tr>
<tr class="codeline" data-linenumber="1328"><td class="num" id="LN1328">1328</td><td class="line">    <span class='keyword'>case</span> CV_BADSTEP_ERR:               <span class='keyword'>return</span> CV_BadStep;</td></tr>
<tr class="codeline" data-linenumber="1329"><td class="num" id="LN1329">1329</td><td class="line">    <span class='keyword'>case</span> CV_OUTOFMEM_ERR:              <span class='keyword'>return</span> CV_StsNoMem;</td></tr>
<tr class="codeline" data-linenumber="1330"><td class="num" id="LN1330">1330</td><td class="line">    <span class='keyword'>case</span> CV_BADARG_ERR:                <span class='keyword'>return</span> CV_StsBadArg;</td></tr>
<tr class="codeline" data-linenumber="1331"><td class="num" id="LN1331">1331</td><td class="line">    <span class='keyword'>case</span> CV_NOTDEFINED_ERR:            <span class='keyword'>return</span> CV_StsError;</td></tr>
<tr class="codeline" data-linenumber="1332"><td class="num" id="LN1332">1332</td><td class="line">    <span class='keyword'>case</span> CV_INPLACE_NOT_SUPPORTED_ERR: <span class='keyword'>return</span> CV_StsInplaceNotSupported;</td></tr>
<tr class="codeline" data-linenumber="1333"><td class="num" id="LN1333">1333</td><td class="line">    <span class='keyword'>case</span> CV_NOTFOUND_ERR:              <span class='keyword'>return</span> CV_StsObjectNotFound;</td></tr>
<tr class="codeline" data-linenumber="1334"><td class="num" id="LN1334">1334</td><td class="line">    <span class='keyword'>case</span> CV_BADCONVERGENCE_ERR:        <span class='keyword'>return</span> CV_StsNoConv;</td></tr>
<tr class="codeline" data-linenumber="1335"><td class="num" id="LN1335">1335</td><td class="line">    <span class='keyword'>case</span> CV_BADDEPTH_ERR:              <span class='keyword'>return</span> CV_BadDepth;</td></tr>
<tr class="codeline" data-linenumber="1336"><td class="num" id="LN1336">1336</td><td class="line">    <span class='keyword'>case</span> CV_UNMATCHED_FORMATS_ERR:     <span class='keyword'>return</span> CV_StsUnmatchedFormats;</td></tr>
<tr class="codeline" data-linenumber="1337"><td class="num" id="LN1337">1337</td><td class="line">    <span class='keyword'>case</span> CV_UNSUPPORTED_COI_ERR:       <span class='keyword'>return</span> CV_BadCOI;</td></tr>
<tr class="codeline" data-linenumber="1338"><td class="num" id="LN1338">1338</td><td class="line">    <span class='keyword'>case</span> CV_UNSUPPORTED_CHANNELS_ERR:  <span class='keyword'>return</span> CV_BadNumChannels;</td></tr>
<tr class="codeline" data-linenumber="1339"><td class="num" id="LN1339">1339</td><td class="line">    <span class='keyword'>case</span> CV_BADFLAG_ERR:               <span class='keyword'>return</span> CV_StsBadFlag;</td></tr>
<tr class="codeline" data-linenumber="1340"><td class="num" id="LN1340">1340</td><td class="line">    <span class='keyword'>case</span> CV_BADRANGE_ERR:              <span class='keyword'>return</span> CV_StsBadArg;</td></tr>
<tr class="codeline" data-linenumber="1341"><td class="num" id="LN1341">1341</td><td class="line">    <span class='keyword'>case</span> CV_BADCOEF_ERR:               <span class='keyword'>return</span> CV_StsBadArg;</td></tr>
<tr class="codeline" data-linenumber="1342"><td class="num" id="LN1342">1342</td><td class="line">    <span class='keyword'>case</span> CV_BADFACTOR_ERR:             <span class='keyword'>return</span> CV_StsBadArg;</td></tr>
<tr class="codeline" data-linenumber="1343"><td class="num" id="LN1343">1343</td><td class="line">    <span class='keyword'>case</span> CV_BADPOINT_ERR:              <span class='keyword'>return</span> CV_StsBadPoint;</td></tr>
<tr class="codeline" data-linenumber="1344"><td class="num" id="LN1344">1344</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1345"><td class="num" id="LN1345">1345</td><td class="line">    <span class='keyword'>default</span>:</td></tr>
<tr class="codeline" data-linenumber="1346"><td class="num" id="LN1346">1346</td><td class="line">      <span class='keyword'>return</span> CV_StsError;</td></tr>
<tr class="codeline" data-linenumber="1347"><td class="num" id="LN1347">1347</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1348"><td class="num" id="LN1348">1348</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1349"><td class="num" id="LN1349">1349</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1350"><td class="num" id="LN1350">1350</td><td class="line"><span class='keyword'>namespace</span> cv {</td></tr>
<tr class="codeline" data-linenumber="1351"><td class="num" id="LN1351">1351</td><td class="line"><span class='keyword'>bool</span> __termination = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1352"><td class="num" id="LN1352">1352</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1353"><td class="num" id="LN1353">1353</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1354"><td class="num" id="LN1354">1354</td><td class="line"><span class='comment'>//////////////////////////////// thread-local storage ////////////////////////////////</span></td></tr>
<tr class="codeline" data-linenumber="1355"><td class="num" id="LN1355">1355</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1356"><td class="num" id="LN1356">1356</td><td class="line"><span class='keyword'>namespace</span> details {</td></tr>
<tr class="codeline" data-linenumber="1357"><td class="num" id="LN1357">1357</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1358"><td class="num" id="LN1358">1358</td><td class="line"><span class='directive'>#ifdef _WIN32</span></td></tr>
<tr class="codeline" data-linenumber="1359"><td class="num" id="LN1359">1359</td><td class="line"><span class='directive'>#ifdef _MSC_VER</span></td></tr>
<tr class="codeline" data-linenumber="1360"><td class="num" id="LN1360">1360</td><td class="line"><span class='directive'>#pragma warning(disable:4505) // unreferenced local function has been removed</span></td></tr>
<tr class="codeline" data-linenumber="1361"><td class="num" id="LN1361">1361</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1362"><td class="num" id="LN1362">1362</td><td class="line"><span class='directive'>#ifndef TLS_OUT_OF_INDEXES</span></td></tr>
<tr class="codeline" data-linenumber="1363"><td class="num" id="LN1363">1363</td><td class="line"><span class='directive'>#define TLS_OUT_OF_INDEXES ((DWORD)0xFFFFFFFF)</span></td></tr>
<tr class="codeline" data-linenumber="1364"><td class="num" id="LN1364">1364</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1365"><td class="num" id="LN1365">1365</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1366"><td class="num" id="LN1366">1366</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1367"><td class="num" id="LN1367">1367</td><td class="line"><span class='keyword'>template</span> &lt;<span class='keyword'>class</span> T&gt;</td></tr>
<tr class="codeline" data-linenumber="1368"><td class="num" id="LN1368">1368</td><td class="line"><span class='keyword'>class</span> DisposedSingletonMark</td></tr>
<tr class="codeline" data-linenumber="1369"><td class="num" id="LN1369">1369</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1370"><td class="num" id="LN1370">1370</td><td class="line"><span class='keyword'>private</span>:</td></tr>
<tr class="codeline" data-linenumber="1371"><td class="num" id="LN1371">1371</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>bool</span> mark;</td></tr>
<tr class="codeline" data-linenumber="1372"><td class="num" id="LN1372">1372</td><td class="line"><span class='keyword'>protected</span>:</td></tr>
<tr class="codeline" data-linenumber="1373"><td class="num" id="LN1373">1373</td><td class="line">    DisposedSingletonMark() {}</td></tr>
<tr class="codeline" data-linenumber="1374"><td class="num" id="LN1374">1374</td><td class="line">    ~DisposedSingletonMark()</td></tr>
<tr class="codeline" data-linenumber="1375"><td class="num" id="LN1375">1375</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1376"><td class="num" id="LN1376">1376</td><td class="line">        mark = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="1377"><td class="num" id="LN1377">1377</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1378"><td class="num" id="LN1378">1378</td><td class="line"><span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="1379"><td class="num" id="LN1379">1379</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>bool</span> isDisposed() { <span class='keyword'>return</span> mark; }</td></tr>
<tr class="codeline" data-linenumber="1380"><td class="num" id="LN1380">1380</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="1381"><td class="num" id="LN1381">1381</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1382"><td class="num" id="LN1382">1382</td><td class="line"><span class='comment'>// TLS platform abstraction layer</span></td></tr>
<tr class="codeline" data-linenumber="1383"><td class="num" id="LN1383">1383</td><td class="line"><span class='keyword'>class</span> TlsAbstraction : <span class='keyword'>public</span> DisposedSingletonMark&lt;TlsAbstraction&gt;</td></tr>
<tr class="codeline" data-linenumber="1384"><td class="num" id="LN1384">1384</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1385"><td class="num" id="LN1385">1385</td><td class="line"><span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="1386"><td class="num" id="LN1386">1386</td><td class="line">    TlsAbstraction();</td></tr>
<tr class="codeline" data-linenumber="1387"><td class="num" id="LN1387">1387</td><td class="line">    ~TlsAbstraction();</td></tr>
<tr class="codeline" data-linenumber="1388"><td class="num" id="LN1388">1388</td><td class="line">    <span class='keyword'>void</span>* getData() <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="1389"><td class="num" id="LN1389">1389</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1390"><td class="num" id="LN1390">1390</td><td class="line">        <span class='keyword'>if</span> (isDisposed())  <span class='comment'>// guard: static initialization order fiasco</span></td></tr>
<tr class="codeline" data-linenumber="1391"><td class="num" id="LN1391">1391</td><td class="line">            <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>__null</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1392"><td class="num" id="LN1392">1392</td><td class="line">        <span class='keyword'>return</span> getData_();</td></tr>
<tr class="codeline" data-linenumber="1393"><td class="num" id="LN1393">1393</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1394"><td class="num" id="LN1394">1394</td><td class="line">    <span class='keyword'>void</span> setData(<span class='keyword'>void</span> *pData)</td></tr>
<tr class="codeline" data-linenumber="1395"><td class="num" id="LN1395">1395</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1396"><td class="num" id="LN1396">1396</td><td class="line">        <span class='keyword'>if</span> (isDisposed())  <span class='comment'>// guard: static initialization order fiasco</span></td></tr>
<tr class="codeline" data-linenumber="1397"><td class="num" id="LN1397">1397</td><td class="line">            <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="1398"><td class="num" id="LN1398">1398</td><td class="line">        <span class='keyword'>return</span> setData_(pData);</td></tr>
<tr class="codeline" data-linenumber="1399"><td class="num" id="LN1399">1399</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1400"><td class="num" id="LN1400">1400</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1401"><td class="num" id="LN1401">1401</td><td class="line"><span class='keyword'>private</span>:</td></tr>
<tr class="codeline" data-linenumber="1402"><td class="num" id="LN1402">1402</td><td class="line">    <span class='keyword'>void</span>* getData_() <span class='keyword'>const</span>;</td></tr>
<tr class="codeline" data-linenumber="1403"><td class="num" id="LN1403">1403</td><td class="line">    <span class='keyword'>void</span> setData_(<span class='keyword'>void</span> *pData);</td></tr>
<tr class="codeline" data-linenumber="1404"><td class="num" id="LN1404">1404</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1405"><td class="num" id="LN1405">1405</td><td class="line"><span class='directive'>#ifdef _WIN32</span></td></tr>
<tr class="codeline" data-linenumber="1406"><td class="num" id="LN1406">1406</td><td class="line"><span class='directive'>#ifndef WINRT</span></td></tr>
<tr class="codeline" data-linenumber="1407"><td class="num" id="LN1407">1407</td><td class="line">    DWORD tlsKey;</td></tr>
<tr class="codeline" data-linenumber="1408"><td class="num" id="LN1408">1408</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1409"><td class="num" id="LN1409">1409</td><td class="line"><span class='directive'>#else // _WIN32</span></td></tr>
<tr class="codeline" data-linenumber="1410"><td class="num" id="LN1410">1410</td><td class="line">    pthread_key_t  tlsKey;</td></tr>
<tr class="codeline" data-linenumber="1411"><td class="num" id="LN1411">1411</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1412"><td class="num" id="LN1412">1412</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="1413"><td class="num" id="LN1413">1413</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1414"><td class="num" id="LN1414">1414</td><td class="line"><span class='keyword'>template</span>&lt;&gt; <span class='keyword'>bool</span> DisposedSingletonMark&lt;TlsAbstraction&gt;::mark = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1415"><td class="num" id="LN1415">1415</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1416"><td class="num" id="LN1416">1416</td><td class="line"><span class='keyword'>static</span> TlsAbstraction&amp; getTlsAbstraction_()</td></tr>
<tr class="codeline" data-linenumber="1417"><td class="num" id="LN1417">1417</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1418"><td class="num" id="LN1418">1418</td><td class="line">    <span class='keyword'>static</span> TlsAbstraction g_tls;  <span class='comment'>// disposed in atexit() handlers (required for unregistering our callbacks)</span></td></tr>
<tr class="codeline" data-linenumber="1419"><td class="num" id="LN1419">1419</td><td class="line">    <span class='keyword'>return</span> g_tls;</td></tr>
<tr class="codeline" data-linenumber="1420"><td class="num" id="LN1420">1420</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1421"><td class="num" id="LN1421">1421</td><td class="line"><span class='keyword'>static</span> TlsAbstraction* getTlsAbstraction()</td></tr>
<tr class="codeline" data-linenumber="1422"><td class="num" id="LN1422">1422</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1423"><td class="num" id="LN1423">1423</td><td class="line">    <span class='keyword'>static</span> TlsAbstraction* instance = &amp;getTlsAbstraction_();</td></tr>
<tr class="codeline" data-linenumber="1424"><td class="num" id="LN1424">1424</td><td class="line">    <span class='keyword'>return</span> DisposedSingletonMark&lt;TlsAbstraction&gt;::isDisposed() ? <span class='macro'>NULL<span class='macro_popup'>__null</span></span> : instance;</td></tr>
<tr class="codeline" data-linenumber="1425"><td class="num" id="LN1425">1425</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1426"><td class="num" id="LN1426">1426</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1427"><td class="num" id="LN1427">1427</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1428"><td class="num" id="LN1428">1428</td><td class="line"><span class='directive'>#ifdef _WIN32</span></td></tr>
<tr class="codeline" data-linenumber="1429"><td class="num" id="LN1429">1429</td><td class="line"><span class='directive'>#ifdef WINRT</span></td></tr>
<tr class="codeline" data-linenumber="1430"><td class="num" id="LN1430">1430</td><td class="line"><span class='keyword'>static</span> __declspec( thread ) <span class='keyword'>void</span>* tlsData = <span class='macro'>NULL<span class='macro_popup'>__null</span></span>; <span class='comment'>// using C++11 thread attribute for local thread data</span></td></tr>
<tr class="codeline" data-linenumber="1431"><td class="num" id="LN1431">1431</td><td class="line">TlsAbstraction::TlsAbstraction() {}</td></tr>
<tr class="codeline" data-linenumber="1432"><td class="num" id="LN1432">1432</td><td class="line">TlsAbstraction::~TlsAbstraction()</td></tr>
<tr class="codeline" data-linenumber="1433"><td class="num" id="LN1433">1433</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1434"><td class="num" id="LN1434">1434</td><td class="line">    cv::__termination = <span class='keyword'>true</span>;  <span class='comment'>// DllMain is missing in static builds</span></td></tr>
<tr class="codeline" data-linenumber="1435"><td class="num" id="LN1435">1435</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1436"><td class="num" id="LN1436">1436</td><td class="line"><span class='keyword'>void</span>* TlsAbstraction::getData_() <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="1437"><td class="num" id="LN1437">1437</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1438"><td class="num" id="LN1438">1438</td><td class="line">    <span class='keyword'>return</span> tlsData;</td></tr>
<tr class="codeline" data-linenumber="1439"><td class="num" id="LN1439">1439</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1440"><td class="num" id="LN1440">1440</td><td class="line"><span class='keyword'>void</span> TlsAbstraction::setData_(<span class='keyword'>void</span> *pData)</td></tr>
<tr class="codeline" data-linenumber="1441"><td class="num" id="LN1441">1441</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1442"><td class="num" id="LN1442">1442</td><td class="line">    tlsData = pData;</td></tr>
<tr class="codeline" data-linenumber="1443"><td class="num" id="LN1443">1443</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1444"><td class="num" id="LN1444">1444</td><td class="line"><span class='directive'>#else //WINRT</span></td></tr>
<tr class="codeline" data-linenumber="1445"><td class="num" id="LN1445">1445</td><td class="line"><span class='directive'>#ifdef CV_USE_FLS</span></td></tr>
<tr class="codeline" data-linenumber="1446"><td class="num" id="LN1446">1446</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> NTAPI opencv_fls_destructor(<span class='keyword'>void</span>* pData);</td></tr>
<tr class="codeline" data-linenumber="1447"><td class="num" id="LN1447">1447</td><td class="line"><span class='directive'>#endif // CV_USE_FLS</span></td></tr>
<tr class="codeline" data-linenumber="1448"><td class="num" id="LN1448">1448</td><td class="line">TlsAbstraction::TlsAbstraction()</td></tr>
<tr class="codeline" data-linenumber="1449"><td class="num" id="LN1449">1449</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1450"><td class="num" id="LN1450">1450</td><td class="line"><span class='directive'>#ifndef CV_USE_FLS</span></td></tr>
<tr class="codeline" data-linenumber="1451"><td class="num" id="LN1451">1451</td><td class="line">    tlsKey = TlsAlloc();</td></tr>
<tr class="codeline" data-linenumber="1452"><td class="num" id="LN1452">1452</td><td class="line"><span class='directive'>#else // CV_USE_FLS</span></td></tr>
<tr class="codeline" data-linenumber="1453"><td class="num" id="LN1453">1453</td><td class="line">    tlsKey = FlsAlloc(opencv_fls_destructor);</td></tr>
<tr class="codeline" data-linenumber="1454"><td class="num" id="LN1454">1454</td><td class="line"><span class='directive'>#endif // CV_USE_FLS</span></td></tr>
<tr class="codeline" data-linenumber="1455"><td class="num" id="LN1455">1455</td><td class="line">    <span class='macro'>CV_Assert(tlsKey != TLS_OUT_OF_INDEXES)<span class='macro_popup'>do { if (!(tlsKey != TLS_OUT_OF_INDEXES)) abort(); } while (0<br>)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1456"><td class="num" id="LN1456">1456</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1457"><td class="num" id="LN1457">1457</td><td class="line">TlsAbstraction::~TlsAbstraction()</td></tr>
<tr class="codeline" data-linenumber="1458"><td class="num" id="LN1458">1458</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1459"><td class="num" id="LN1459">1459</td><td class="line">    cv::__termination = <span class='keyword'>true</span>;  <span class='comment'>// DllMain is missing in static builds</span></td></tr>
<tr class="codeline" data-linenumber="1460"><td class="num" id="LN1460">1460</td><td class="line"><span class='directive'>#ifndef CV_USE_FLS</span></td></tr>
<tr class="codeline" data-linenumber="1461"><td class="num" id="LN1461">1461</td><td class="line">    TlsFree(tlsKey);</td></tr>
<tr class="codeline" data-linenumber="1462"><td class="num" id="LN1462">1462</td><td class="line"><span class='directive'>#else // CV_USE_FLS</span></td></tr>
<tr class="codeline" data-linenumber="1463"><td class="num" id="LN1463">1463</td><td class="line">    FlsFree(tlsKey);</td></tr>
<tr class="codeline" data-linenumber="1464"><td class="num" id="LN1464">1464</td><td class="line"><span class='directive'>#endif // CV_USE_FLS</span></td></tr>
<tr class="codeline" data-linenumber="1465"><td class="num" id="LN1465">1465</td><td class="line">    tlsKey = TLS_OUT_OF_INDEXES;</td></tr>
<tr class="codeline" data-linenumber="1466"><td class="num" id="LN1466">1466</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1467"><td class="num" id="LN1467">1467</td><td class="line"><span class='keyword'>void</span>* TlsAbstraction::getData_() <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="1468"><td class="num" id="LN1468">1468</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1469"><td class="num" id="LN1469">1469</td><td class="line"><span class='directive'>#ifndef CV_USE_FLS</span></td></tr>
<tr class="codeline" data-linenumber="1470"><td class="num" id="LN1470">1470</td><td class="line">    <span class='keyword'>return</span> TlsGetValue(tlsKey);</td></tr>
<tr class="codeline" data-linenumber="1471"><td class="num" id="LN1471">1471</td><td class="line"><span class='directive'>#else // CV_USE_FLS</span></td></tr>
<tr class="codeline" data-linenumber="1472"><td class="num" id="LN1472">1472</td><td class="line">    <span class='keyword'>return</span> FlsGetValue(tlsKey);</td></tr>
<tr class="codeline" data-linenumber="1473"><td class="num" id="LN1473">1473</td><td class="line"><span class='directive'>#endif // CV_USE_FLS</span></td></tr>
<tr class="codeline" data-linenumber="1474"><td class="num" id="LN1474">1474</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1475"><td class="num" id="LN1475">1475</td><td class="line"><span class='keyword'>void</span> TlsAbstraction::setData_(<span class='keyword'>void</span> *pData)</td></tr>
<tr class="codeline" data-linenumber="1476"><td class="num" id="LN1476">1476</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1477"><td class="num" id="LN1477">1477</td><td class="line"><span class='directive'>#ifndef CV_USE_FLS</span></td></tr>
<tr class="codeline" data-linenumber="1478"><td class="num" id="LN1478">1478</td><td class="line">    <span class='macro'>CV_Assert(TlsSetValue(tlsKey, pData) == TRUE)<span class='macro_popup'>do { if (!(TlsSetValue(tlsKey, pData) == TRUE)) abort(); } while<br> (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1479"><td class="num" id="LN1479">1479</td><td class="line"><span class='directive'>#else // CV_USE_FLS</span></td></tr>
<tr class="codeline" data-linenumber="1480"><td class="num" id="LN1480">1480</td><td class="line">    <span class='macro'>CV_Assert(FlsSetValue(tlsKey, pData) == TRUE)<span class='macro_popup'>do { if (!(FlsSetValue(tlsKey, pData) == TRUE)) abort(); } while<br> (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1481"><td class="num" id="LN1481">1481</td><td class="line"><span class='directive'>#endif // CV_USE_FLS</span></td></tr>
<tr class="codeline" data-linenumber="1482"><td class="num" id="LN1482">1482</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1483"><td class="num" id="LN1483">1483</td><td class="line"><span class='directive'>#endif // WINRT</span></td></tr>
<tr class="codeline" data-linenumber="1484"><td class="num" id="LN1484">1484</td><td class="line"><span class='directive'>#else // _WIN32</span></td></tr>
<tr class="codeline" data-linenumber="1485"><td class="num" id="LN1485">1485</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> opencv_tls_destructor(<span class='keyword'>void</span>* pData);</td></tr>
<tr class="codeline" data-linenumber="1486"><td class="num" id="LN1486">1486</td><td class="line">TlsAbstraction::TlsAbstraction()</td></tr>
<tr class="codeline" data-linenumber="1487"><td class="num" id="LN1487">1487</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1488"><td class="num" id="LN1488">1488</td><td class="line">    <span class='macro'>CV_Assert(pthread_key_create(&amp;tlsKey, opencv_tls_destructor) == 0)<span class='macro_popup'>do { if (!(pthread_key_create(&amp;tlsKey, opencv_tls_destructor<br>) == 0)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1489"><td class="num" id="LN1489">1489</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1490"><td class="num" id="LN1490">1490</td><td class="line">TlsAbstraction::~TlsAbstraction()</td></tr>
<tr class="codeline" data-linenumber="1491"><td class="num" id="LN1491">1491</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1492"><td class="num" id="LN1492">1492</td><td class="line">    cv::__termination = <span class='keyword'>true</span>;  <span class='comment'>// DllMain is missing in static builds</span></td></tr>
<tr class="codeline" data-linenumber="1493"><td class="num" id="LN1493">1493</td><td class="line">    <span class='keyword'>if</span> (pthread_key_delete(tlsKey) != 0)</td></tr>
<tr class="codeline" data-linenumber="1494"><td class="num" id="LN1494">1494</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1495"><td class="num" id="LN1495">1495</td><td class="line">        <span class='comment'>// Don't use logging here</span></td></tr>
<tr class="codeline" data-linenumber="1496"><td class="num" id="LN1496">1496</td><td class="line">        fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, <span class='string_literal'>"OpenCV ERROR: TlsAbstraction::~TlsAbstraction(): pthread_key_delete() call failed\n"</span>);</td></tr>
<tr class="codeline" data-linenumber="1497"><td class="num" id="LN1497">1497</td><td class="line">        fflush(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1498"><td class="num" id="LN1498">1498</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1499"><td class="num" id="LN1499">1499</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1500"><td class="num" id="LN1500">1500</td><td class="line"><span class='keyword'>void</span>* TlsAbstraction::getData_() <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="1501"><td class="num" id="LN1501">1501</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1502"><td class="num" id="LN1502">1502</td><td class="line">    <span class='keyword'>return</span> pthread_getspecific(tlsKey);</td></tr>
<tr class="codeline" data-linenumber="1503"><td class="num" id="LN1503">1503</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1504"><td class="num" id="LN1504">1504</td><td class="line"><span class='keyword'>void</span> TlsAbstraction::setData_(<span class='keyword'>void</span> *pData)</td></tr>
<tr class="codeline" data-linenumber="1505"><td class="num" id="LN1505">1505</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1506"><td class="num" id="LN1506">1506</td><td class="line">    <span class='macro'>CV_Assert(pthread_setspecific(tlsKey, pData) == 0)<span class='macro_popup'>do { if (!(pthread_setspecific(tlsKey, pData) == 0)) abort();<br> } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1507"><td class="num" id="LN1507">1507</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1508"><td class="num" id="LN1508">1508</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1509"><td class="num" id="LN1509">1509</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1510"><td class="num" id="LN1510">1510</td><td class="line"><span class='comment'>// Per-thread data structure</span></td></tr>
<tr class="codeline" data-linenumber="1511"><td class="num" id="LN1511">1511</td><td class="line"><span class='keyword'>struct</span> ThreadData</td></tr>
<tr class="codeline" data-linenumber="1512"><td class="num" id="LN1512">1512</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1513"><td class="num" id="LN1513">1513</td><td class="line">    ThreadData()</td></tr>
<tr class="codeline" data-linenumber="1514"><td class="num" id="LN1514">1514</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1515"><td class="num" id="LN1515">1515</td><td class="line">        idx = 0;</td></tr>
<tr class="codeline" data-linenumber="1516"><td class="num" id="LN1516">1516</td><td class="line">        slots.reserve(32);</td></tr>
<tr class="codeline" data-linenumber="1517"><td class="num" id="LN1517">1517</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1518"><td class="num" id="LN1518">1518</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1519"><td class="num" id="LN1519">1519</td><td class="line">    std::vector&lt;<span class='keyword'>void</span>*&gt; slots; <span class='comment'>// Data array for a thread</span></td></tr>
<tr class="codeline" data-linenumber="1520"><td class="num" id="LN1520">1520</td><td class="line">    size_t idx;               <span class='comment'>// Thread index in TLS storage. This is not OS thread ID!</span></td></tr>
<tr class="codeline" data-linenumber="1521"><td class="num" id="LN1521">1521</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="1522"><td class="num" id="LN1522">1522</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1523"><td class="num" id="LN1523">1523</td><td class="line"><span class='comment'>// Main TLS storage class</span></td></tr>
<tr class="codeline" data-linenumber="1524"><td class="num" id="LN1524">1524</td><td class="line"><span class='keyword'>class</span> TlsStorage</td></tr>
<tr class="codeline" data-linenumber="1525"><td class="num" id="LN1525">1525</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1526"><td class="num" id="LN1526">1526</td><td class="line"><span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="1527"><td class="num" id="LN1527">1527</td><td class="line">    TlsStorage() :</td></tr>
<tr class="codeline" data-linenumber="1528"><td class="num" id="LN1528">1528</td><td class="line">        tlsSlotsSize(0)</td></tr>
<tr class="codeline" data-linenumber="1529"><td class="num" id="LN1529">1529</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1530"><td class="num" id="LN1530">1530</td><td class="line">        tlsSlots.reserve(32);</td></tr>
<tr class="codeline" data-linenumber="1531"><td class="num" id="LN1531">1531</td><td class="line">        threads.reserve(32);</td></tr>
<tr class="codeline" data-linenumber="1532"><td class="num" id="LN1532">1532</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1533"><td class="num" id="LN1533">1533</td><td class="line">    ~TlsStorage()</td></tr>
<tr class="codeline" data-linenumber="1534"><td class="num" id="LN1534">1534</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1535"><td class="num" id="LN1535">1535</td><td class="line">        <span class='comment'>// TlsStorage object should not be released</span></td></tr>
<tr class="codeline" data-linenumber="1536"><td class="num" id="LN1536">1536</td><td class="line">        <span class='comment'>// There is no reliable way to avoid problems caused by static initialization order fiasco</span></td></tr>
<tr class="codeline" data-linenumber="1537"><td class="num" id="LN1537">1537</td><td class="line">        <span class='comment'>// Don't use logging here</span></td></tr>
<tr class="codeline" data-linenumber="1538"><td class="num" id="LN1538">1538</td><td class="line">        fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, <span class='string_literal'>"OpenCV FATAL: TlsStorage::~TlsStorage() call is not expected\n"</span>);</td></tr>
<tr class="codeline" data-linenumber="1539"><td class="num" id="LN1539">1539</td><td class="line">        fflush(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1540"><td class="num" id="LN1540">1540</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1541"><td class="num" id="LN1541">1541</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1542"><td class="num" id="LN1542">1542</td><td class="line">    <span class='keyword'>void</span> releaseThread(<span class='keyword'>void</span>* tlsValue = <span class='macro'>NULL<span class='macro_popup'>__null</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1543"><td class="num" id="LN1543">1543</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1544"><td class="num" id="LN1544">1544</td><td class="line">        TlsAbstraction* tls = getTlsAbstraction();</td></tr>
<tr class="codeline" data-linenumber="1545"><td class="num" id="LN1545">1545</td><td class="line">        <span class='keyword'>if</span> (<span class='macro'>NULL<span class='macro_popup'>__null</span></span> == tls)</td></tr>
<tr class="codeline" data-linenumber="1546"><td class="num" id="LN1546">1546</td><td class="line">            <span class='keyword'>return</span>;  <span class='comment'>// TLS singleton is not available (terminated)</span></td></tr>
<tr class="codeline" data-linenumber="1547"><td class="num" id="LN1547">1547</td><td class="line">        ThreadData *pTD = tlsValue == <span class='macro'>NULL<span class='macro_popup'>__null</span></span> ? (ThreadData*)tls-&gt;getData() : (ThreadData*)tlsValue;</td></tr>
<tr class="codeline" data-linenumber="1548"><td class="num" id="LN1548">1548</td><td class="line">        <span class='keyword'>if</span> (pTD == <span class='macro'>NULL<span class='macro_popup'>__null</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1549"><td class="num" id="LN1549">1549</td><td class="line">            <span class='keyword'>return</span>;  <span class='comment'>// no OpenCV TLS data for this thread</span></td></tr>
<tr class="codeline" data-linenumber="1550"><td class="num" id="LN1550">1550</td><td class="line">        AutoLock guard(mtxGlobalAccess);</td></tr>
<tr class="codeline" data-linenumber="1551"><td class="num" id="LN1551">1551</td><td class="line">        <span class='keyword'>for</span> (size_t i = 0; i &lt; threads.size(); i++)</td></tr>
<tr class="codeline" data-linenumber="1552"><td class="num" id="LN1552">1552</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1553"><td class="num" id="LN1553">1553</td><td class="line">            <span class='keyword'>if</span> (pTD == threads[i])</td></tr>
<tr class="codeline" data-linenumber="1554"><td class="num" id="LN1554">1554</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1555"><td class="num" id="LN1555">1555</td><td class="line">                threads[i] = <span class='macro'>NULL<span class='macro_popup'>__null</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1556"><td class="num" id="LN1556">1556</td><td class="line">                <span class='keyword'>if</span> (tlsValue == <span class='macro'>NULL<span class='macro_popup'>__null</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1557"><td class="num" id="LN1557">1557</td><td class="line">                    tls-&gt;setData(0);</td></tr>
<tr class="codeline" data-linenumber="1558"><td class="num" id="LN1558">1558</td><td class="line">                std::vector&lt;<span class='keyword'>void</span>*&gt;&amp; thread_slots = pTD-&gt;slots;</td></tr>
<tr class="codeline" data-linenumber="1559"><td class="num" id="LN1559">1559</td><td class="line">                <span class='keyword'>for</span> (size_t slotIdx = 0; slotIdx &lt; thread_slots.size(); slotIdx++)</td></tr>
<tr class="codeline" data-linenumber="1560"><td class="num" id="LN1560">1560</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="1561"><td class="num" id="LN1561">1561</td><td class="line">                    <span class='keyword'>void</span>* pData = thread_slots[slotIdx];</td></tr>
<tr class="codeline" data-linenumber="1562"><td class="num" id="LN1562">1562</td><td class="line">                    thread_slots[slotIdx] = <span class='macro'>NULL<span class='macro_popup'>__null</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1563"><td class="num" id="LN1563">1563</td><td class="line">                    <span class='keyword'>if</span> (!pData)</td></tr>
<tr class="codeline" data-linenumber="1564"><td class="num" id="LN1564">1564</td><td class="line">                        <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="1565"><td class="num" id="LN1565">1565</td><td class="line">                    TLSDataContainer* container = tlsSlots[slotIdx].container;</td></tr>
<tr class="codeline" data-linenumber="1566"><td class="num" id="LN1566">1566</td><td class="line">                    <span class='keyword'>if</span> (container)</td></tr>
<tr class="codeline" data-linenumber="1567"><td class="num" id="LN1567">1567</td><td class="line">                        container-&gt;deleteDataInstance(pData);</td></tr>
<tr class="codeline" data-linenumber="1568"><td class="num" id="LN1568">1568</td><td class="line">                    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1569"><td class="num" id="LN1569">1569</td><td class="line">                    {</td></tr>
<tr class="codeline" data-linenumber="1570"><td class="num" id="LN1570">1570</td><td class="line">                        fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, <span class='string_literal'>"OpenCV ERROR: TLS: container for slotIdx=%d is NULL. Can't release thread data\n"</span>, (<span class='keyword'>int</span>)slotIdx);</td></tr>
<tr class="codeline" data-linenumber="1571"><td class="num" id="LN1571">1571</td><td class="line">                        fflush(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1572"><td class="num" id="LN1572">1572</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="1573"><td class="num" id="LN1573">1573</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1574"><td class="num" id="LN1574">1574</td><td class="line">                <span class='keyword'>delete</span> pTD;</td></tr>
<tr class="codeline" data-linenumber="1575"><td class="num" id="LN1575">1575</td><td class="line">                <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="1576"><td class="num" id="LN1576">1576</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1577"><td class="num" id="LN1577">1577</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1578"><td class="num" id="LN1578">1578</td><td class="line">        fprintf(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>, <span class='string_literal'>"OpenCV WARNING: TLS: Can't release thread TLS data (unknown pointer or data race): %p\n"</span>, (<span class='keyword'>void</span>*)pTD); fflush(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1579"><td class="num" id="LN1579">1579</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1580"><td class="num" id="LN1580">1580</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1581"><td class="num" id="LN1581">1581</td><td class="line">    <span class='comment'>// Reserve TLS storage index</span></td></tr>
<tr class="codeline" data-linenumber="1582"><td class="num" id="LN1582">1582</td><td class="line">    size_t reserveSlot(TLSDataContainer* container)</td></tr>
<tr class="codeline" data-linenumber="1583"><td class="num" id="LN1583">1583</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1584"><td class="num" id="LN1584">1584</td><td class="line">        AutoLock guard(mtxGlobalAccess);</td></tr>
<tr class="codeline" data-linenumber="1585"><td class="num" id="LN1585">1585</td><td class="line">        <span class='macro'>CV_Assert(tlsSlotsSize == tlsSlots.size())<span class='macro_popup'>do { if (!(tlsSlotsSize == tlsSlots.size())) abort(); } while<br> (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1586"><td class="num" id="LN1586">1586</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1587"><td class="num" id="LN1587">1587</td><td class="line">        <span class='comment'>// Find unused slots</span></td></tr>
<tr class="codeline" data-linenumber="1588"><td class="num" id="LN1588">1588</td><td class="line">        <span class='keyword'>for</span>(size_t slot = 0; slot &lt; tlsSlotsSize; slot++)</td></tr>
<tr class="codeline" data-linenumber="1589"><td class="num" id="LN1589">1589</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1590"><td class="num" id="LN1590">1590</td><td class="line">            <span class='keyword'>if</span> (tlsSlots[slot].container == <span class='macro'>NULL<span class='macro_popup'>__null</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1591"><td class="num" id="LN1591">1591</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1592"><td class="num" id="LN1592">1592</td><td class="line">                tlsSlots[slot].container = container;</td></tr>
<tr class="codeline" data-linenumber="1593"><td class="num" id="LN1593">1593</td><td class="line">                <span class='keyword'>return</span> slot;</td></tr>
<tr class="codeline" data-linenumber="1594"><td class="num" id="LN1594">1594</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1595"><td class="num" id="LN1595">1595</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1596"><td class="num" id="LN1596">1596</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1597"><td class="num" id="LN1597">1597</td><td class="line">        <span class='comment'>// Create new slot</span></td></tr>
<tr class="codeline" data-linenumber="1598"><td class="num" id="LN1598">1598</td><td class="line">        tlsSlots.push_back(TlsSlotInfo(container)); tlsSlotsSize++;</td></tr>
<tr class="codeline" data-linenumber="1599"><td class="num" id="LN1599">1599</td><td class="line">        <span class='keyword'>return</span> tlsSlotsSize - 1;</td></tr>
<tr class="codeline" data-linenumber="1600"><td class="num" id="LN1600">1600</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1601"><td class="num" id="LN1601">1601</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1602"><td class="num" id="LN1602">1602</td><td class="line">    <span class='comment'>// Release TLS storage index and pass associated data to caller</span></td></tr>
<tr class="codeline" data-linenumber="1603"><td class="num" id="LN1603">1603</td><td class="line">    <span class='keyword'>void</span> releaseSlot(size_t slotIdx, std::vector&lt;<span class='keyword'>void</span>*&gt; &amp;dataVec, <span class='keyword'>bool</span> keepSlot = <span class='keyword'>false</span>)</td></tr>
<tr class="codeline" data-linenumber="1604"><td class="num" id="LN1604">1604</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1605"><td class="num" id="LN1605">1605</td><td class="line">        AutoLock guard(mtxGlobalAccess);</td></tr>
<tr class="codeline" data-linenumber="1606"><td class="num" id="LN1606">1606</td><td class="line">        <span class='macro'>CV_Assert(tlsSlotsSize == tlsSlots.size())<span class='macro_popup'>do { if (!(tlsSlotsSize == tlsSlots.size())) abort(); } while<br> (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1607"><td class="num" id="LN1607">1607</td><td class="line">        <span class='macro'>CV_Assert(tlsSlotsSize &gt; slotIdx)<span class='macro_popup'>do { if (!(tlsSlotsSize &gt; slotIdx)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1608"><td class="num" id="LN1608">1608</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1609"><td class="num" id="LN1609">1609</td><td class="line">        <span class='keyword'>for</span>(size_t i = 0; i &lt; threads.size(); i++)</td></tr>
<tr class="codeline" data-linenumber="1610"><td class="num" id="LN1610">1610</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1611"><td class="num" id="LN1611">1611</td><td class="line">            <span class='keyword'>if</span>(threads[i])</td></tr>
<tr class="codeline" data-linenumber="1612"><td class="num" id="LN1612">1612</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1613"><td class="num" id="LN1613">1613</td><td class="line">                std::vector&lt;<span class='keyword'>void</span>*&gt;&amp; thread_slots = threads[i]-&gt;slots;</td></tr>
<tr class="codeline" data-linenumber="1614"><td class="num" id="LN1614">1614</td><td class="line">                <span class='keyword'>if</span> (thread_slots.size() &gt; slotIdx &amp;&amp; thread_slots[slotIdx])</td></tr>
<tr class="codeline" data-linenumber="1615"><td class="num" id="LN1615">1615</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="1616"><td class="num" id="LN1616">1616</td><td class="line">                    dataVec.push_back(thread_slots[slotIdx]);</td></tr>
<tr class="codeline" data-linenumber="1617"><td class="num" id="LN1617">1617</td><td class="line">                    thread_slots[slotIdx] = <span class='macro'>NULL<span class='macro_popup'>__null</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1618"><td class="num" id="LN1618">1618</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1619"><td class="num" id="LN1619">1619</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1620"><td class="num" id="LN1620">1620</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1621"><td class="num" id="LN1621">1621</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1622"><td class="num" id="LN1622">1622</td><td class="line">        <span class='keyword'>if</span> (!keepSlot)</td></tr>
<tr class="codeline" data-linenumber="1623"><td class="num" id="LN1623">1623</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1624"><td class="num" id="LN1624">1624</td><td class="line">            tlsSlots[slotIdx].container = <span class='macro'>NULL<span class='macro_popup'>__null</span></span>;  <span class='comment'>// mark slot as free (see reserveSlot() implementation)</span></td></tr>
<tr class="codeline" data-linenumber="1625"><td class="num" id="LN1625">1625</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1626"><td class="num" id="LN1626">1626</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1627"><td class="num" id="LN1627">1627</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1628"><td class="num" id="LN1628">1628</td><td class="line">    <span class='comment'>// Get data by TLS storage index</span></td></tr>
<tr class="codeline" data-linenumber="1629"><td class="num" id="LN1629">1629</td><td class="line">    <span class='keyword'>void</span>* getData(size_t slotIdx) <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="1630"><td class="num" id="LN1630">1630</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1631"><td class="num" id="LN1631">1631</td><td class="line"><span class='directive'>#ifndef CV_THREAD_SANITIZER</span></td></tr>
<tr class="codeline" data-linenumber="1632"><td class="num" id="LN1632">1632</td><td class="line">        <span class='macro'>CV_Assert(tlsSlotsSize &gt; slotIdx)<span class='macro_popup'>do { if (!(tlsSlotsSize &gt; slotIdx)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1633"><td class="num" id="LN1633">1633</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1634"><td class="num" id="LN1634">1634</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1635"><td class="num" id="LN1635">1635</td><td class="line">        TlsAbstraction* tls = getTlsAbstraction();</td></tr>
<tr class="codeline" data-linenumber="1636"><td class="num" id="LN1636">1636</td><td class="line">        <span class='keyword'>if</span> (<span class='macro'>NULL<span class='macro_popup'>__null</span></span> == tls)</td></tr>
<tr class="codeline" data-linenumber="1637"><td class="num" id="LN1637">1637</td><td class="line">            <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>__null</span></span>;  <span class='comment'>// TLS singleton is not available (terminated)</span></td></tr>
<tr class="codeline" data-linenumber="1638"><td class="num" id="LN1638">1638</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1639"><td class="num" id="LN1639">1639</td><td class="line">        ThreadData* threadData = (ThreadData*)tls-&gt;getData();</td></tr>
<tr class="codeline" data-linenumber="1640"><td class="num" id="LN1640">1640</td><td class="line">        <span class='keyword'>if</span>(threadData &amp;&amp; threadData-&gt;slots.size() &gt; slotIdx)</td></tr>
<tr class="codeline" data-linenumber="1641"><td class="num" id="LN1641">1641</td><td class="line">            <span class='keyword'>return</span> threadData-&gt;slots[slotIdx];</td></tr>
<tr class="codeline" data-linenumber="1642"><td class="num" id="LN1642">1642</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1643"><td class="num" id="LN1643">1643</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>__null</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1644"><td class="num" id="LN1644">1644</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1645"><td class="num" id="LN1645">1645</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1646"><td class="num" id="LN1646">1646</td><td class="line">    <span class='comment'>// Gather data from threads by TLS storage index</span></td></tr>
<tr class="codeline" data-linenumber="1647"><td class="num" id="LN1647">1647</td><td class="line">    <span class='keyword'>void</span> gather(size_t slotIdx, std::vector&lt;<span class='keyword'>void</span>*&gt; &amp;dataVec)</td></tr>
<tr class="codeline" data-linenumber="1648"><td class="num" id="LN1648">1648</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1649"><td class="num" id="LN1649">1649</td><td class="line">        AutoLock guard(mtxGlobalAccess);</td></tr>
<tr class="codeline" data-linenumber="1650"><td class="num" id="LN1650">1650</td><td class="line">        <span class='macro'>CV_Assert(tlsSlotsSize == tlsSlots.size())<span class='macro_popup'>do { if (!(tlsSlotsSize == tlsSlots.size())) abort(); } while<br> (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1651"><td class="num" id="LN1651">1651</td><td class="line">        <span class='macro'>CV_Assert(tlsSlotsSize &gt; slotIdx)<span class='macro_popup'>do { if (!(tlsSlotsSize &gt; slotIdx)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1652"><td class="num" id="LN1652">1652</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1653"><td class="num" id="LN1653">1653</td><td class="line">        <span class='keyword'>for</span>(size_t i = 0; i &lt; threads.size(); i++)</td></tr>
<tr class="codeline" data-linenumber="1654"><td class="num" id="LN1654">1654</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1655"><td class="num" id="LN1655">1655</td><td class="line">            <span class='keyword'>if</span>(threads[i])</td></tr>
<tr class="codeline" data-linenumber="1656"><td class="num" id="LN1656">1656</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1657"><td class="num" id="LN1657">1657</td><td class="line">                std::vector&lt;<span class='keyword'>void</span>*&gt;&amp; thread_slots = threads[i]-&gt;slots;</td></tr>
<tr class="codeline" data-linenumber="1658"><td class="num" id="LN1658">1658</td><td class="line">                <span class='keyword'>if</span> (thread_slots.size() &gt; slotIdx &amp;&amp; thread_slots[slotIdx])</td></tr>
<tr class="codeline" data-linenumber="1659"><td class="num" id="LN1659">1659</td><td class="line">                    dataVec.push_back(thread_slots[slotIdx]);</td></tr>
<tr class="codeline" data-linenumber="1660"><td class="num" id="LN1660">1660</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1661"><td class="num" id="LN1661">1661</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1662"><td class="num" id="LN1662">1662</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1663"><td class="num" id="LN1663">1663</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1664"><td class="num" id="LN1664">1664</td><td class="line">    <span class='comment'>// Set data to storage index</span></td></tr>
<tr class="codeline" data-linenumber="1665"><td class="num" id="LN1665">1665</td><td class="line">    <span class='keyword'>void</span> setData(size_t slotIdx, <span class='keyword'>void</span>* pData)</td></tr>
<tr class="codeline" data-linenumber="1666"><td class="num" id="LN1666">1666</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1667"><td class="num" id="LN1667">1667</td><td class="line"><span class='directive'>#ifndef CV_THREAD_SANITIZER</span></td></tr>
<tr class="codeline" data-linenumber="1668"><td class="num" id="LN1668">1668</td><td class="line">        <span class='macro'>CV_Assert(tlsSlotsSize &gt; slotIdx)<span class='macro_popup'>do { if (!(tlsSlotsSize &gt; slotIdx)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1669"><td class="num" id="LN1669">1669</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1670"><td class="num" id="LN1670">1670</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1671"><td class="num" id="LN1671">1671</td><td class="line">        TlsAbstraction* tls = getTlsAbstraction();</td></tr>
<tr class="codeline" data-linenumber="1672"><td class="num" id="LN1672">1672</td><td class="line">        <span class='keyword'>if</span> (<span class='macro'>NULL<span class='macro_popup'>__null</span></span> == tls)</td></tr>
<tr class="codeline" data-linenumber="1673"><td class="num" id="LN1673">1673</td><td class="line">            <span class='keyword'>return</span>;  <span class='comment'>// TLS singleton is not available (terminated)</span></td></tr>
<tr class="codeline" data-linenumber="1674"><td class="num" id="LN1674">1674</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1675"><td class="num" id="LN1675">1675</td><td class="line">        ThreadData* threadData = (ThreadData*)tls-&gt;getData();</td></tr>
<tr class="codeline" data-linenumber="1676"><td class="num" id="LN1676">1676</td><td class="line">        <span class='keyword'>if</span>(!threadData)</td></tr>
<tr class="codeline" data-linenumber="1677"><td class="num" id="LN1677">1677</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1678"><td class="num" id="LN1678">1678</td><td class="line">            threadData = <span class='keyword'>new</span> ThreadData;</td></tr>
<tr class="codeline" data-linenumber="1679"><td class="num" id="LN1679">1679</td><td class="line">            tls-&gt;setData((<span class='keyword'>void</span>*)threadData);</td></tr>
<tr class="codeline" data-linenumber="1680"><td class="num" id="LN1680">1680</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1681"><td class="num" id="LN1681">1681</td><td class="line">                AutoLock guard(mtxGlobalAccess);</td></tr>
<tr class="codeline" data-linenumber="1682"><td class="num" id="LN1682">1682</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1683"><td class="num" id="LN1683">1683</td><td class="line">                <span class='keyword'>bool</span> found = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1684"><td class="num" id="LN1684">1684</td><td class="line">                <span class='comment'>// Find unused slots</span></td></tr>
<tr class="codeline" data-linenumber="1685"><td class="num" id="LN1685">1685</td><td class="line">                <span class='keyword'>for</span>(size_t slot = 0; slot &lt; threads.size(); slot++)</td></tr>
<tr class="codeline" data-linenumber="1686"><td class="num" id="LN1686">1686</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="1687"><td class="num" id="LN1687">1687</td><td class="line">                    <span class='keyword'>if</span> (threads[slot] == <span class='macro'>NULL<span class='macro_popup'>__null</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1688"><td class="num" id="LN1688">1688</td><td class="line">                    {</td></tr>
<tr class="codeline" data-linenumber="1689"><td class="num" id="LN1689">1689</td><td class="line">                        threadData-&gt;idx = (<span class='keyword'>int</span>)slot;</td></tr>
<tr class="codeline" data-linenumber="1690"><td class="num" id="LN1690">1690</td><td class="line">                        threads[slot] = threadData;</td></tr>
<tr class="codeline" data-linenumber="1691"><td class="num" id="LN1691">1691</td><td class="line">                        found = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="1692"><td class="num" id="LN1692">1692</td><td class="line">                        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1693"><td class="num" id="LN1693">1693</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="1694"><td class="num" id="LN1694">1694</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1695"><td class="num" id="LN1695">1695</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1696"><td class="num" id="LN1696">1696</td><td class="line">                <span class='keyword'>if</span> (!found)</td></tr>
<tr class="codeline" data-linenumber="1697"><td class="num" id="LN1697">1697</td><td class="line">                {</td></tr>
<tr class="codeline" data-linenumber="1698"><td class="num" id="LN1698">1698</td><td class="line">                    <span class='comment'>// Create new slot</span></td></tr>
<tr class="codeline" data-linenumber="1699"><td class="num" id="LN1699">1699</td><td class="line">                    threadData-&gt;idx = threads.size();</td></tr>
<tr class="codeline" data-linenumber="1700"><td class="num" id="LN1700">1700</td><td class="line">                    threads.push_back(threadData);</td></tr>
<tr class="codeline" data-linenumber="1701"><td class="num" id="LN1701">1701</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1702"><td class="num" id="LN1702">1702</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1703"><td class="num" id="LN1703">1703</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1704"><td class="num" id="LN1704">1704</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1705"><td class="num" id="LN1705">1705</td><td class="line">        <span class='keyword'>if</span>(slotIdx &gt;= threadData-&gt;slots.size())</td></tr>
<tr class="codeline" data-linenumber="1706"><td class="num" id="LN1706">1706</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1707"><td class="num" id="LN1707">1707</td><td class="line">            AutoLock guard(mtxGlobalAccess); <span class='comment'>// keep synchronization with gather() calls</span></td></tr>
<tr class="codeline" data-linenumber="1708"><td class="num" id="LN1708">1708</td><td class="line">            threadData-&gt;slots.resize(slotIdx + 1, <span class='macro'>NULL<span class='macro_popup'>__null</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1709"><td class="num" id="LN1709">1709</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1710"><td class="num" id="LN1710">1710</td><td class="line">        threadData-&gt;slots[slotIdx] = pData;</td></tr>
<tr class="codeline" data-linenumber="1711"><td class="num" id="LN1711">1711</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1712"><td class="num" id="LN1712">1712</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1713"><td class="num" id="LN1713">1713</td><td class="line"><span class='keyword'>private</span>:</td></tr>
<tr class="codeline" data-linenumber="1714"><td class="num" id="LN1714">1714</td><td class="line">    Mutex  mtxGlobalAccess;           <span class='comment'>// Shared objects operation guard</span></td></tr>
<tr class="codeline" data-linenumber="1715"><td class="num" id="LN1715">1715</td><td class="line">    size_t tlsSlotsSize;              <span class='comment'>// equal to tlsSlots.size() in synchronized sections</span></td></tr>
<tr class="codeline" data-linenumber="1716"><td class="num" id="LN1716">1716</td><td class="line">                                      <span class='comment'>// without synchronization this counter doesn't decrease - it is used for slotIdx sanity checks</span></td></tr>
<tr class="codeline" data-linenumber="1717"><td class="num" id="LN1717">1717</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1718"><td class="num" id="LN1718">1718</td><td class="line">    <span class='keyword'>struct</span> TlsSlotInfo</td></tr>
<tr class="codeline" data-linenumber="1719"><td class="num" id="LN1719">1719</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1720"><td class="num" id="LN1720">1720</td><td class="line">        TlsSlotInfo(TLSDataContainer* _container) : container(_container) {}</td></tr>
<tr class="codeline" data-linenumber="1721"><td class="num" id="LN1721">1721</td><td class="line">        TLSDataContainer* container;  <span class='comment'>// attached container (to dispose data of terminated threads)</span></td></tr>
<tr class="codeline" data-linenumber="1722"><td class="num" id="LN1722">1722</td><td class="line">    };</td></tr>
<tr class="codeline" data-linenumber="1723"><td class="num" id="LN1723">1723</td><td class="line">    std::vector&lt;<span class='keyword'>struct</span> TlsSlotInfo&gt; tlsSlots;  <span class='comment'>// TLS keys state</span></td></tr>
<tr class="codeline" data-linenumber="1724"><td class="num" id="LN1724">1724</td><td class="line">    std::vector&lt;ThreadData*&gt; threads; <span class='comment'>// Array for all allocated data. Thread data pointers are placed here to allow data cleanup</span></td></tr>
<tr class="codeline" data-linenumber="1725"><td class="num" id="LN1725">1725</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="1726"><td class="num" id="LN1726">1726</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1727"><td class="num" id="LN1727">1727</td><td class="line"><span class='comment'>// Create global TLS storage object</span></td></tr>
<tr class="codeline" data-linenumber="1728"><td class="num" id="LN1728">1728</td><td class="line"><span class='keyword'>static</span> TlsStorage &amp;getTlsStorage()</td></tr>
<tr class="codeline" data-linenumber="1729"><td class="num" id="LN1729">1729</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1730"><td class="num" id="LN1730">1730</td><td class="line">    CV_SINGLETON_LAZY_INIT_REF(TlsStorage, <span class='keyword'>new</span> TlsStorage())</td></tr>
<tr class="codeline" data-linenumber="1731"><td class="num" id="LN1731">1731</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1732"><td class="num" id="LN1732">1732</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1733"><td class="num" id="LN1733">1733</td><td class="line"><span class='directive'>#ifndef _WIN32  // pthread key destructor</span></td></tr>
<tr class="codeline" data-linenumber="1734"><td class="num" id="LN1734">1734</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> opencv_tls_destructor(<span class='keyword'>void</span>* pData)</td></tr>
<tr class="codeline" data-linenumber="1735"><td class="num" id="LN1735">1735</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1736"><td class="num" id="LN1736">1736</td><td class="line">    getTlsStorage().releaseThread(pData);</td></tr>
<tr class="codeline" data-linenumber="1737"><td class="num" id="LN1737">1737</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1738"><td class="num" id="LN1738">1738</td><td class="line"><span class='directive'>#else // _WIN32</span></td></tr>
<tr class="codeline" data-linenumber="1739"><td class="num" id="LN1739">1739</td><td class="line"><span class='directive'>#ifdef CV_USE_FLS</span></td></tr>
<tr class="codeline" data-linenumber="1740"><td class="num" id="LN1740">1740</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> WINAPI opencv_fls_destructor(<span class='keyword'>void</span>* pData)</td></tr>
<tr class="codeline" data-linenumber="1741"><td class="num" id="LN1741">1741</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1742"><td class="num" id="LN1742">1742</td><td class="line">    getTlsStorage().releaseThread(pData);</td></tr>
<tr class="codeline" data-linenumber="1743"><td class="num" id="LN1743">1743</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1744"><td class="num" id="LN1744">1744</td><td class="line"><span class='directive'>#endif // CV_USE_FLS</span></td></tr>
<tr class="codeline" data-linenumber="1745"><td class="num" id="LN1745">1745</td><td class="line"><span class='directive'>#endif // _WIN32</span></td></tr>
<tr class="codeline" data-linenumber="1746"><td class="num" id="LN1746">1746</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1747"><td class="num" id="LN1747">1747</td><td class="line">} <span class='comment'>// namespace details</span></td></tr>
<tr class="codeline" data-linenumber="1748"><td class="num" id="LN1748">1748</td><td class="line"><span class='keyword'>using</span> <span class='keyword'>namespace</span> details;</td></tr>
<tr class="codeline" data-linenumber="1749"><td class="num" id="LN1749">1749</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1750"><td class="num" id="LN1750">1750</td><td class="line">TLSDataContainer::TLSDataContainer()</td></tr>
<tr class="codeline" data-linenumber="1751"><td class="num" id="LN1751">1751</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1752"><td class="num" id="LN1752">1752</td><td class="line">    key_ = (<span class='keyword'>int</span>)getTlsStorage().reserveSlot(<span class='keyword'>this</span>); <span class='comment'>// Reserve key from TLS storage</span></td></tr>
<tr class="codeline" data-linenumber="1753"><td class="num" id="LN1753">1753</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1754"><td class="num" id="LN1754">1754</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1755"><td class="num" id="LN1755">1755</td><td class="line">TLSDataContainer::~TLSDataContainer()</td></tr>
<tr class="codeline" data-linenumber="1756"><td class="num" id="LN1756">1756</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1757"><td class="num" id="LN1757">1757</td><td class="line">    <span class="mrange"><span class="mrange"><span class="mrange"><span class='macro'>CV_Assert</span></span></span>(key_ == -1)<span class='macro_popup'>do { if (!(key_ == -1)) abort(); } while (0)</span></span>; <span class='comment'>// Key must be released in child object</span></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path3" class="msg msgEvent" style="margin-left:5ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">3</div></td><td><div class="PathNav"><a href="#Path2" title="Previous event (2)">&#x2190;</a></div></td><td>Assuming the condition is false</td><td><div class="PathNav"><a href="#Path4" title="Next event (4)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path4" class="msg msgControl" style="margin-left:5ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">4</div></td><td><div class="PathNav"><a href="#Path3" title="Previous event (3)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path5" title="Next event (5)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path5" class="msg msgEvent" style="margin-left:5ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">5</div></td><td><div class="PathNav"><a href="#Path4" title="Previous event (4)">&#x2190;</a></div></td><td>Calling 'error'</td><td><div class="PathNav"><a href="#Path6" title="Next event (6)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path15" class="msg msgEvent" style="margin-left:5ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">15</div></td><td><div class="PathNav"><a href="#Path14" title="Previous event (14)">&#x2190;</a></div></td><td>Returning from 'error'</td><td><div class="PathNav"><a href="#EndPath" title="Next event (16)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="1758"><td class="num" id="LN1758">1758</td><td class="line">}</td></tr>
<tr><td class="num"></td><td class="line"><div id="EndPath" class="msg msgEvent" style="margin-left:1ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">16</div></td><td><div class="PathNav"><a href="#Path15" title="Previous event (15)">&#x2190;</a></div></td><td>Exception being thrown out of destructor</td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="1759"><td class="num" id="LN1759">1759</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1760"><td class="num" id="LN1760">1760</td><td class="line"><span class='keyword'>void</span> TLSDataContainer::gatherData(std::vector&lt;<span class='keyword'>void</span>*&gt; &amp;data) <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="1761"><td class="num" id="LN1761">1761</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1762"><td class="num" id="LN1762">1762</td><td class="line">    getTlsStorage().gather(key_, data);</td></tr>
<tr class="codeline" data-linenumber="1763"><td class="num" id="LN1763">1763</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1764"><td class="num" id="LN1764">1764</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1765"><td class="num" id="LN1765">1765</td><td class="line"><span class='keyword'>void</span> TLSDataContainer::detachData(std::vector&lt;<span class='keyword'>void</span>*&gt; &amp;data)</td></tr>
<tr class="codeline" data-linenumber="1766"><td class="num" id="LN1766">1766</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1767"><td class="num" id="LN1767">1767</td><td class="line">    getTlsStorage().releaseSlot(key_, data, <span class='keyword'>true</span>);</td></tr>
<tr class="codeline" data-linenumber="1768"><td class="num" id="LN1768">1768</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1769"><td class="num" id="LN1769">1769</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1770"><td class="num" id="LN1770">1770</td><td class="line"><span class='keyword'>void</span> TLSDataContainer::release()</td></tr>
<tr class="codeline" data-linenumber="1771"><td class="num" id="LN1771">1771</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1772"><td class="num" id="LN1772">1772</td><td class="line">    <span class='keyword'>if</span> (key_ == -1)</td></tr>
<tr class="codeline" data-linenumber="1773"><td class="num" id="LN1773">1773</td><td class="line">        <span class='keyword'>return</span>;  <span class='comment'>// already released</span></td></tr>
<tr class="codeline" data-linenumber="1774"><td class="num" id="LN1774">1774</td><td class="line">    std::vector&lt;<span class='keyword'>void</span>*&gt; data; data.reserve(32);</td></tr>
<tr class="codeline" data-linenumber="1775"><td class="num" id="LN1775">1775</td><td class="line">    getTlsStorage().releaseSlot(key_, data, <span class='keyword'>false</span>); <span class='comment'>// Release key and get stored data for proper destruction</span></td></tr>
<tr class="codeline" data-linenumber="1776"><td class="num" id="LN1776">1776</td><td class="line">    key_ = -1;</td></tr>
<tr class="codeline" data-linenumber="1777"><td class="num" id="LN1777">1777</td><td class="line">    <span class='keyword'>for</span>(size_t i = 0; i &lt; data.size(); i++)  <span class='comment'>// Delete all associated data</span></td></tr>
<tr class="codeline" data-linenumber="1778"><td class="num" id="LN1778">1778</td><td class="line">        deleteDataInstance(data[i]);</td></tr>
<tr class="codeline" data-linenumber="1779"><td class="num" id="LN1779">1779</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1780"><td class="num" id="LN1780">1780</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1781"><td class="num" id="LN1781">1781</td><td class="line"><span class='keyword'>void</span> TLSDataContainer::cleanup()</td></tr>
<tr class="codeline" data-linenumber="1782"><td class="num" id="LN1782">1782</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1783"><td class="num" id="LN1783">1783</td><td class="line">    std::vector&lt;<span class='keyword'>void</span>*&gt; data; data.reserve(32);</td></tr>
<tr class="codeline" data-linenumber="1784"><td class="num" id="LN1784">1784</td><td class="line">    getTlsStorage().releaseSlot(key_, data, <span class='keyword'>true</span>); <span class='comment'>// Extract stored data with removal from TLS tables</span></td></tr>
<tr class="codeline" data-linenumber="1785"><td class="num" id="LN1785">1785</td><td class="line">    <span class='keyword'>for</span>(size_t i = 0; i &lt; data.size(); i++)  <span class='comment'>// Delete all associated data</span></td></tr>
<tr class="codeline" data-linenumber="1786"><td class="num" id="LN1786">1786</td><td class="line">        deleteDataInstance(data[i]);</td></tr>
<tr class="codeline" data-linenumber="1787"><td class="num" id="LN1787">1787</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1788"><td class="num" id="LN1788">1788</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1789"><td class="num" id="LN1789">1789</td><td class="line"><span class='keyword'>void</span>* TLSDataContainer::getData() <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="1790"><td class="num" id="LN1790">1790</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1791"><td class="num" id="LN1791">1791</td><td class="line">    <span class='macro'>CV_Assert(key_ != -1 &amp;&amp; <span class='string_literal'>"Can't fetch data from terminated TLS container."</span>)<span class='macro_popup'>do { if (!(key_ != -1 &amp;&amp; "Can't fetch data from terminated TLS container."<br>)) abort(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1792"><td class="num" id="LN1792">1792</td><td class="line">    <span class='keyword'>void</span>* pData = getTlsStorage().getData(key_); <span class='comment'>// Check if data was already allocated</span></td></tr>
<tr class="codeline" data-linenumber="1793"><td class="num" id="LN1793">1793</td><td class="line">    <span class='keyword'>if</span>(!pData)</td></tr>
<tr class="codeline" data-linenumber="1794"><td class="num" id="LN1794">1794</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1795"><td class="num" id="LN1795">1795</td><td class="line">        <span class='comment'>// Create new data instance and save it to TLS storage</span></td></tr>
<tr class="codeline" data-linenumber="1796"><td class="num" id="LN1796">1796</td><td class="line">        pData = createDataInstance();</td></tr>
<tr class="codeline" data-linenumber="1797"><td class="num" id="LN1797">1797</td><td class="line">        getTlsStorage().setData(key_, pData);</td></tr>
<tr class="codeline" data-linenumber="1798"><td class="num" id="LN1798">1798</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1799"><td class="num" id="LN1799">1799</td><td class="line">    <span class='keyword'>return</span> pData;</td></tr>
<tr class="codeline" data-linenumber="1800"><td class="num" id="LN1800">1800</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1801"><td class="num" id="LN1801">1801</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1802"><td class="num" id="LN1802">1802</td><td class="line"><span class='keyword'>static</span> TLSData&lt;CoreTLSData&gt;&amp; getCoreTlsDataTLS()</td></tr>
<tr class="codeline" data-linenumber="1803"><td class="num" id="LN1803">1803</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1804"><td class="num" id="LN1804">1804</td><td class="line">    CV_SINGLETON_LAZY_INIT_REF(TLSData&lt;CoreTLSData&gt;, <span class='keyword'>new</span> TLSData&lt;CoreTLSData&gt;())</td></tr>
<tr class="codeline" data-linenumber="1805"><td class="num" id="LN1805">1805</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1806"><td class="num" id="LN1806">1806</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1807"><td class="num" id="LN1807">1807</td><td class="line">CoreTLSData&amp; getCoreTlsData()</td></tr>
<tr class="codeline" data-linenumber="1808"><td class="num" id="LN1808">1808</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1809"><td class="num" id="LN1809">1809</td><td class="line">    <span class='keyword'>return</span> getCoreTlsDataTLS().getRef();</td></tr>
<tr class="codeline" data-linenumber="1810"><td class="num" id="LN1810">1810</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1811"><td class="num" id="LN1811">1811</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1812"><td class="num" id="LN1812">1812</td><td class="line"><span class='directive'>#if defined <span class='macro'>CVAPI_EXPORTS<span class='macro_popup'>1</span></span> &amp;&amp; defined _WIN32 &amp;&amp; !defined WINCE</span></td></tr>
<tr class="codeline" data-linenumber="1813"><td class="num" id="LN1813">1813</td><td class="line"><span class='directive'>#ifdef WINRT</span></td></tr>
<tr class="codeline" data-linenumber="1814"><td class="num" id="LN1814">1814</td><td class="line">    <span class='directive'>#pragma warning(disable:4447) // Disable warning 'main' signature found without threading model</span></td></tr>
<tr class="codeline" data-linenumber="1815"><td class="num" id="LN1815">1815</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1816"><td class="num" id="LN1816">1816</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1817"><td class="num" id="LN1817">1817</td><td class="line"><span class='keyword'>extern</span> <span class='string_literal'>"C"</span></td></tr>
<tr class="codeline" data-linenumber="1818"><td class="num" id="LN1818">1818</td><td class="line">BOOL WINAPI DllMain(HINSTANCE, DWORD fdwReason, LPVOID lpReserved);</td></tr>
<tr class="codeline" data-linenumber="1819"><td class="num" id="LN1819">1819</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1820"><td class="num" id="LN1820">1820</td><td class="line"><span class='keyword'>extern</span> <span class='string_literal'>"C"</span></td></tr>
<tr class="codeline" data-linenumber="1821"><td class="num" id="LN1821">1821</td><td class="line">BOOL WINAPI DllMain(HINSTANCE, DWORD fdwReason, LPVOID lpReserved)</td></tr>
<tr class="codeline" data-linenumber="1822"><td class="num" id="LN1822">1822</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1823"><td class="num" id="LN1823">1823</td><td class="line">    <span class='keyword'>if</span> (fdwReason == DLL_THREAD_DETACH || fdwReason == DLL_PROCESS_DETACH)</td></tr>
<tr class="codeline" data-linenumber="1824"><td class="num" id="LN1824">1824</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1825"><td class="num" id="LN1825">1825</td><td class="line">        <span class='keyword'>if</span> (lpReserved != <span class='macro'>NULL<span class='macro_popup'>__null</span></span>) <span class='comment'>// called after ExitProcess() call</span></td></tr>
<tr class="codeline" data-linenumber="1826"><td class="num" id="LN1826">1826</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1827"><td class="num" id="LN1827">1827</td><td class="line">            cv::__termination = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="1828"><td class="num" id="LN1828">1828</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1829"><td class="num" id="LN1829">1829</td><td class="line">        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1830"><td class="num" id="LN1830">1830</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1831"><td class="num" id="LN1831">1831</td><td class="line">            <span class='comment'>// Not allowed to free resources if lpReserved is non-null</span></td></tr>
<tr class="codeline" data-linenumber="1832"><td class="num" id="LN1832">1832</td><td class="line">            <span class='comment'>// http://msdn.microsoft.com/en-us/library/windows/desktop/ms682583.aspx</span></td></tr>
<tr class="codeline" data-linenumber="1833"><td class="num" id="LN1833">1833</td><td class="line">            cv::getTlsStorage().releaseThread();</td></tr>
<tr class="codeline" data-linenumber="1834"><td class="num" id="LN1834">1834</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1835"><td class="num" id="LN1835">1835</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1836"><td class="num" id="LN1836">1836</td><td class="line">    <span class='keyword'>return</span> TRUE;</td></tr>
<tr class="codeline" data-linenumber="1837"><td class="num" id="LN1837">1837</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1838"><td class="num" id="LN1838">1838</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1839"><td class="num" id="LN1839">1839</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1840"><td class="num" id="LN1840">1840</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1841"><td class="num" id="LN1841">1841</td><td class="line"><span class='keyword'>namespace</span> {</td></tr>
<tr class="codeline" data-linenumber="1842"><td class="num" id="LN1842">1842</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1843"><td class="num" id="LN1843">1843</td><td class="line"><span class='directive'>#ifdef OPENCV_WITH_ITT</span></td></tr>
<tr class="codeline" data-linenumber="1844"><td class="num" id="LN1844">1844</td><td class="line"><span class='keyword'>bool</span> overrideThreadName()</td></tr>
<tr class="codeline" data-linenumber="1845"><td class="num" id="LN1845">1845</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1846"><td class="num" id="LN1846">1846</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>bool</span> param = utils::getConfigurationParameterBool(<span class='string_literal'>"OPENCV_TRACE_ITT_SET_THREAD_NAME"</span>, <span class='keyword'>false</span>);</td></tr>
<tr class="codeline" data-linenumber="1847"><td class="num" id="LN1847">1847</td><td class="line">    <span class='keyword'>return</span> param;</td></tr>
<tr class="codeline" data-linenumber="1848"><td class="num" id="LN1848">1848</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1849"><td class="num" id="LN1849">1849</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1850"><td class="num" id="LN1850">1850</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1851"><td class="num" id="LN1851">1851</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> g_threadNum = 0;</td></tr>
<tr class="codeline" data-linenumber="1852"><td class="num" id="LN1852">1852</td><td class="line"><span class='keyword'>class</span> ThreadID {</td></tr>
<tr class="codeline" data-linenumber="1853"><td class="num" id="LN1853">1853</td><td class="line"><span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="1854"><td class="num" id="LN1854">1854</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>int</span> id;</td></tr>
<tr class="codeline" data-linenumber="1855"><td class="num" id="LN1855">1855</td><td class="line">    ThreadID() :</td></tr>
<tr class="codeline" data-linenumber="1856"><td class="num" id="LN1856">1856</td><td class="line">        id(<span class='macro'>CV_XADD(&amp;g_threadNum, 1)<span class='macro_popup'>__c11_atomic_fetch_add((_Atomic(int)*)(&amp;g_threadNum), 1, 4<br>)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="1857"><td class="num" id="LN1857">1857</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1858"><td class="num" id="LN1858">1858</td><td class="line"><span class='directive'>#ifdef OPENCV_WITH_ITT</span></td></tr>
<tr class="codeline" data-linenumber="1859"><td class="num" id="LN1859">1859</td><td class="line">        <span class='keyword'>if</span> (overrideThreadName())</td></tr>
<tr class="codeline" data-linenumber="1860"><td class="num" id="LN1860">1860</td><td class="line">            __itt_thread_set_name(cv::format(<span class='string_literal'>"OpenCVThread-%03d"</span>, id).c_str());</td></tr>
<tr class="codeline" data-linenumber="1861"><td class="num" id="LN1861">1861</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1862"><td class="num" id="LN1862">1862</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1863"><td class="num" id="LN1863">1863</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="1864"><td class="num" id="LN1864">1864</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1865"><td class="num" id="LN1865">1865</td><td class="line"><span class='keyword'>static</span> TLSData&lt;ThreadID&gt;&amp; getThreadIDTLS()</td></tr>
<tr class="codeline" data-linenumber="1866"><td class="num" id="LN1866">1866</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1867"><td class="num" id="LN1867">1867</td><td class="line">    CV_SINGLETON_LAZY_INIT_REF(TLSData&lt;ThreadID&gt;, <span class='keyword'>new</span> TLSData&lt;ThreadID&gt;());</td></tr>
<tr class="codeline" data-linenumber="1868"><td class="num" id="LN1868">1868</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1869"><td class="num" id="LN1869">1869</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1870"><td class="num" id="LN1870">1870</td><td class="line">} <span class='comment'>// namespace</span></td></tr>
<tr class="codeline" data-linenumber="1871"><td class="num" id="LN1871">1871</td><td class="line"><span class='keyword'>int</span> utils::getThreadID() { <span class='keyword'>return</span> getThreadIDTLS().get()-&gt;id; }</td></tr>
<tr class="codeline" data-linenumber="1872"><td class="num" id="LN1872">1872</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1873"><td class="num" id="LN1873">1873</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1874"><td class="num" id="LN1874">1874</td><td class="line"><span class='keyword'>class</span> ParseError</td></tr>
<tr class="codeline" data-linenumber="1875"><td class="num" id="LN1875">1875</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1876"><td class="num" id="LN1876">1876</td><td class="line">    std::string bad_value;</td></tr>
<tr class="codeline" data-linenumber="1877"><td class="num" id="LN1877">1877</td><td class="line"><span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="1878"><td class="num" id="LN1878">1878</td><td class="line">    ParseError(<span class='keyword'>const</span> std::string &amp;bad_value_) :bad_value(bad_value_) {}</td></tr>
<tr class="codeline" data-linenumber="1879"><td class="num" id="LN1879">1879</td><td class="line">    std::string toString(<span class='keyword'>const</span> std::string &amp;param) <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="1880"><td class="num" id="LN1880">1880</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1881"><td class="num" id="LN1881">1881</td><td class="line">        std::ostringstream out;</td></tr>
<tr class="codeline" data-linenumber="1882"><td class="num" id="LN1882">1882</td><td class="line">        out &lt;&lt; <span class='string_literal'>"Invalid value for parameter "</span> &lt;&lt; param &lt;&lt; <span class='string_literal'>": "</span> &lt;&lt; bad_value;</td></tr>
<tr class="codeline" data-linenumber="1883"><td class="num" id="LN1883">1883</td><td class="line">        <span class='keyword'>return</span> out.str();</td></tr>
<tr class="codeline" data-linenumber="1884"><td class="num" id="LN1884">1884</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1885"><td class="num" id="LN1885">1885</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="1886"><td class="num" id="LN1886">1886</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1887"><td class="num" id="LN1887">1887</td><td class="line"><span class='keyword'>template</span> &lt;<span class='keyword'>typename</span> T&gt;</td></tr>
<tr class="codeline" data-linenumber="1888"><td class="num" id="LN1888">1888</td><td class="line">T parseOption(<span class='keyword'>const</span> std::string &amp;);</td></tr>
<tr class="codeline" data-linenumber="1889"><td class="num" id="LN1889">1889</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1890"><td class="num" id="LN1890">1890</td><td class="line"><span class='keyword'>template</span>&lt;&gt;</td></tr>
<tr class="codeline" data-linenumber="1891"><td class="num" id="LN1891">1891</td><td class="line"><span class='keyword'>inline</span> <span class='keyword'>bool</span> parseOption(<span class='keyword'>const</span> std::string &amp; value)</td></tr>
<tr class="codeline" data-linenumber="1892"><td class="num" id="LN1892">1892</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1893"><td class="num" id="LN1893">1893</td><td class="line">    <span class='keyword'>if</span> (value == <span class='string_literal'>"1"</span> || value == <span class='string_literal'>"True"</span> || value == <span class='string_literal'>"true"</span> || value == <span class='string_literal'>"TRUE"</span>)</td></tr>
<tr class="codeline" data-linenumber="1894"><td class="num" id="LN1894">1894</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1895"><td class="num" id="LN1895">1895</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="1896"><td class="num" id="LN1896">1896</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1897"><td class="num" id="LN1897">1897</td><td class="line">    <span class='keyword'>if</span> (value == <span class='string_literal'>"0"</span> || value == <span class='string_literal'>"False"</span> || value == <span class='string_literal'>"false"</span> || value == <span class='string_literal'>"FALSE"</span>)</td></tr>
<tr class="codeline" data-linenumber="1898"><td class="num" id="LN1898">1898</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1899"><td class="num" id="LN1899">1899</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="1900"><td class="num" id="LN1900">1900</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1901"><td class="num" id="LN1901">1901</td><td class="line">    <span class='keyword'>throw</span> ParseError(value);</td></tr>
<tr class="codeline" data-linenumber="1902"><td class="num" id="LN1902">1902</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1903"><td class="num" id="LN1903">1903</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1904"><td class="num" id="LN1904">1904</td><td class="line"><span class='keyword'>template</span>&lt;&gt;</td></tr>
<tr class="codeline" data-linenumber="1905"><td class="num" id="LN1905">1905</td><td class="line"><span class='keyword'>inline</span> size_t parseOption(<span class='keyword'>const</span> std::string &amp;value)</td></tr>
<tr class="codeline" data-linenumber="1906"><td class="num" id="LN1906">1906</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1907"><td class="num" id="LN1907">1907</td><td class="line">    size_t pos = 0;</td></tr>
<tr class="codeline" data-linenumber="1908"><td class="num" id="LN1908">1908</td><td class="line">    <span class='keyword'>for</span> (; pos &lt; value.size(); pos++)</td></tr>
<tr class="codeline" data-linenumber="1909"><td class="num" id="LN1909">1909</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1910"><td class="num" id="LN1910">1910</td><td class="line">        <span class='keyword'>if</span> (!isdigit(value[pos]))</td></tr>
<tr class="codeline" data-linenumber="1911"><td class="num" id="LN1911">1911</td><td class="line">            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1912"><td class="num" id="LN1912">1912</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1913"><td class="num" id="LN1913">1913</td><td class="line">    cv::String valueStr = value.substr(0, pos);</td></tr>
<tr class="codeline" data-linenumber="1914"><td class="num" id="LN1914">1914</td><td class="line">    cv::String suffixStr = value.substr(pos, value.length() - pos);</td></tr>
<tr class="codeline" data-linenumber="1915"><td class="num" id="LN1915">1915</td><td class="line">    size_t v = (size_t)std::stoull(valueStr);</td></tr>
<tr class="codeline" data-linenumber="1916"><td class="num" id="LN1916">1916</td><td class="line">    <span class='keyword'>if</span> (suffixStr.length() == 0)</td></tr>
<tr class="codeline" data-linenumber="1917"><td class="num" id="LN1917">1917</td><td class="line">        <span class='keyword'>return</span> v;</td></tr>
<tr class="codeline" data-linenumber="1918"><td class="num" id="LN1918">1918</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (suffixStr == <span class='string_literal'>"MB"</span> || suffixStr == <span class='string_literal'>"Mb"</span> || suffixStr == <span class='string_literal'>"mb"</span>)</td></tr>
<tr class="codeline" data-linenumber="1919"><td class="num" id="LN1919">1919</td><td class="line">        <span class='keyword'>return</span> v * 1024 * 1024;</td></tr>
<tr class="codeline" data-linenumber="1920"><td class="num" id="LN1920">1920</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (suffixStr == <span class='string_literal'>"KB"</span> || suffixStr == <span class='string_literal'>"Kb"</span> || suffixStr == <span class='string_literal'>"kb"</span>)</td></tr>
<tr class="codeline" data-linenumber="1921"><td class="num" id="LN1921">1921</td><td class="line">        <span class='keyword'>return</span> v * 1024;</td></tr>
<tr class="codeline" data-linenumber="1922"><td class="num" id="LN1922">1922</td><td class="line">    <span class='keyword'>throw</span> ParseError(value);</td></tr>
<tr class="codeline" data-linenumber="1923"><td class="num" id="LN1923">1923</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1924"><td class="num" id="LN1924">1924</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1925"><td class="num" id="LN1925">1925</td><td class="line"><span class='keyword'>template</span>&lt;&gt;</td></tr>
<tr class="codeline" data-linenumber="1926"><td class="num" id="LN1926">1926</td><td class="line"><span class='keyword'>inline</span> cv::String parseOption(<span class='keyword'>const</span> std::string &amp;value)</td></tr>
<tr class="codeline" data-linenumber="1927"><td class="num" id="LN1927">1927</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1928"><td class="num" id="LN1928">1928</td><td class="line">    <span class='keyword'>return</span> value;</td></tr>
<tr class="codeline" data-linenumber="1929"><td class="num" id="LN1929">1929</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1930"><td class="num" id="LN1930">1930</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1931"><td class="num" id="LN1931">1931</td><td class="line"><span class='keyword'>template</span>&lt;&gt;</td></tr>
<tr class="codeline" data-linenumber="1932"><td class="num" id="LN1932">1932</td><td class="line"><span class='keyword'>inline</span> utils::Paths parseOption(<span class='keyword'>const</span> std::string &amp;value)</td></tr>
<tr class="codeline" data-linenumber="1933"><td class="num" id="LN1933">1933</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1934"><td class="num" id="LN1934">1934</td><td class="line">    utils::Paths result;</td></tr>
<tr class="codeline" data-linenumber="1935"><td class="num" id="LN1935">1935</td><td class="line"><span class='directive'>#ifdef _WIN32</span></td></tr>
<tr class="codeline" data-linenumber="1936"><td class="num" id="LN1936">1936</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>char</span> sep = ';';</td></tr>
<tr class="codeline" data-linenumber="1937"><td class="num" id="LN1937">1937</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="1938"><td class="num" id="LN1938">1938</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>char</span> sep = ':';</td></tr>
<tr class="codeline" data-linenumber="1939"><td class="num" id="LN1939">1939</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1940"><td class="num" id="LN1940">1940</td><td class="line">    size_t start_pos = 0;</td></tr>
<tr class="codeline" data-linenumber="1941"><td class="num" id="LN1941">1941</td><td class="line">    <span class='keyword'>while</span> (start_pos != std::string::npos)</td></tr>
<tr class="codeline" data-linenumber="1942"><td class="num" id="LN1942">1942</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1943"><td class="num" id="LN1943">1943</td><td class="line">        <span class='keyword'>const</span> size_t pos = value.find(sep, start_pos);</td></tr>
<tr class="codeline" data-linenumber="1944"><td class="num" id="LN1944">1944</td><td class="line">        <span class='keyword'>const</span> std::string one_piece(value, start_pos, pos == std::string::npos ? pos : pos - start_pos);</td></tr>
<tr class="codeline" data-linenumber="1945"><td class="num" id="LN1945">1945</td><td class="line">        <span class='keyword'>if</span> (!one_piece.empty())</td></tr>
<tr class="codeline" data-linenumber="1946"><td class="num" id="LN1946">1946</td><td class="line">            result.push_back(one_piece);</td></tr>
<tr class="codeline" data-linenumber="1947"><td class="num" id="LN1947">1947</td><td class="line">        start_pos = pos == std::string::npos ? pos : pos + 1;</td></tr>
<tr class="codeline" data-linenumber="1948"><td class="num" id="LN1948">1948</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1949"><td class="num" id="LN1949">1949</td><td class="line">    <span class='keyword'>return</span> result;</td></tr>
<tr class="codeline" data-linenumber="1950"><td class="num" id="LN1950">1950</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1951"><td class="num" id="LN1951">1951</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1952"><td class="num" id="LN1952">1952</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>inline</span> <span class='keyword'>const</span> <span class='keyword'>char</span> * envRead(<span class='keyword'>const</span> <span class='keyword'>char</span> * name)</td></tr>
<tr class="codeline" data-linenumber="1953"><td class="num" id="LN1953">1953</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1954"><td class="num" id="LN1954">1954</td><td class="line"><span class='directive'>#ifdef NO_GETENV</span></td></tr>
<tr class="codeline" data-linenumber="1955"><td class="num" id="LN1955">1955</td><td class="line">    <span class='macro'>CV_UNUSED(name)<span class='macro_popup'>(void)name</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1956"><td class="num" id="LN1956">1956</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>__null</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1957"><td class="num" id="LN1957">1957</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="1958"><td class="num" id="LN1958">1958</td><td class="line">    <span class='keyword'>return</span> getenv(name);</td></tr>
<tr class="codeline" data-linenumber="1959"><td class="num" id="LN1959">1959</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1960"><td class="num" id="LN1960">1960</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1961"><td class="num" id="LN1961">1961</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1962"><td class="num" id="LN1962">1962</td><td class="line"><span class='keyword'>template</span>&lt;<span class='keyword'>typename</span> T&gt;</td></tr>
<tr class="codeline" data-linenumber="1963"><td class="num" id="LN1963">1963</td><td class="line"><span class='keyword'>inline</span> T read(<span class='keyword'>const</span> std::string &amp; k, <span class='keyword'>const</span> T &amp; defaultValue)</td></tr>
<tr class="codeline" data-linenumber="1964"><td class="num" id="LN1964">1964</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1965"><td class="num" id="LN1965">1965</td><td class="line">    <span class='keyword'>try</span></td></tr>
<tr class="codeline" data-linenumber="1966"><td class="num" id="LN1966">1966</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1967"><td class="num" id="LN1967">1967</td><td class="line">        <span class='keyword'>const</span> <span class='keyword'>char</span> * res = envRead(k.c_str());</td></tr>
<tr class="codeline" data-linenumber="1968"><td class="num" id="LN1968">1968</td><td class="line">        <span class='keyword'>if</span> (res)</td></tr>
<tr class="codeline" data-linenumber="1969"><td class="num" id="LN1969">1969</td><td class="line">            <span class='keyword'>return</span> parseOption&lt;T&gt;(std::string(res));</td></tr>
<tr class="codeline" data-linenumber="1970"><td class="num" id="LN1970">1970</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1971"><td class="num" id="LN1971">1971</td><td class="line">    <span class='keyword'>catch</span> (<span class='keyword'>const</span> ParseError &amp;err)</td></tr>
<tr class="codeline" data-linenumber="1972"><td class="num" id="LN1972">1972</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1973"><td class="num" id="LN1973">1973</td><td class="line">        <span class='macro'>CV_Error(cv::Error::StsBadArg, err.toString(k))<span class='macro_popup'>do { (void)(cv::Error::StsBadArg); (void)(err.toString(k)); abort<br>(); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1974"><td class="num" id="LN1974">1974</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1975"><td class="num" id="LN1975">1975</td><td class="line">    <span class='keyword'>return</span> defaultValue;</td></tr>
<tr class="codeline" data-linenumber="1976"><td class="num" id="LN1976">1976</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1977"><td class="num" id="LN1977">1977</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1978"><td class="num" id="LN1978">1978</td><td class="line"><span class='keyword'>bool</span> utils::getConfigurationParameterBool(<span class='keyword'>const</span> <span class='keyword'>char</span>* name, <span class='keyword'>bool</span> defaultValue)</td></tr>
<tr class="codeline" data-linenumber="1979"><td class="num" id="LN1979">1979</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1980"><td class="num" id="LN1980">1980</td><td class="line">    <span class='keyword'>return</span> read&lt;<span class='keyword'>bool</span>&gt;(name, defaultValue);</td></tr>
<tr class="codeline" data-linenumber="1981"><td class="num" id="LN1981">1981</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1982"><td class="num" id="LN1982">1982</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1983"><td class="num" id="LN1983">1983</td><td class="line">size_t utils::getConfigurationParameterSizeT(<span class='keyword'>const</span> <span class='keyword'>char</span>* name, size_t defaultValue)</td></tr>
<tr class="codeline" data-linenumber="1984"><td class="num" id="LN1984">1984</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1985"><td class="num" id="LN1985">1985</td><td class="line">    <span class='keyword'>return</span> read&lt;size_t&gt;(name, defaultValue);</td></tr>
<tr class="codeline" data-linenumber="1986"><td class="num" id="LN1986">1986</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1987"><td class="num" id="LN1987">1987</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1988"><td class="num" id="LN1988">1988</td><td class="line">cv::String utils::getConfigurationParameterString(<span class='keyword'>const</span> <span class='keyword'>char</span>* name, <span class='keyword'>const</span> <span class='keyword'>char</span>* defaultValue)</td></tr>
<tr class="codeline" data-linenumber="1989"><td class="num" id="LN1989">1989</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1990"><td class="num" id="LN1990">1990</td><td class="line">    <span class='keyword'>return</span> read&lt;cv::String&gt;(name, defaultValue ? cv::String(defaultValue) : cv::String());</td></tr>
<tr class="codeline" data-linenumber="1991"><td class="num" id="LN1991">1991</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1992"><td class="num" id="LN1992">1992</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1993"><td class="num" id="LN1993">1993</td><td class="line">utils::Paths utils::getConfigurationParameterPaths(<span class='keyword'>const</span> <span class='keyword'>char</span>* name, <span class='keyword'>const</span> utils::Paths &amp;defaultValue)</td></tr>
<tr class="codeline" data-linenumber="1994"><td class="num" id="LN1994">1994</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1995"><td class="num" id="LN1995">1995</td><td class="line">    <span class='keyword'>return</span> read&lt;utils::Paths&gt;(name, defaultValue);</td></tr>
<tr class="codeline" data-linenumber="1996"><td class="num" id="LN1996">1996</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1997"><td class="num" id="LN1997">1997</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1998"><td class="num" id="LN1998">1998</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1999"><td class="num" id="LN1999">1999</td><td class="line"><span class='directive'>#ifdef CV_COLLECT_IMPL_DATA</span></td></tr>
<tr class="codeline" data-linenumber="2000"><td class="num" id="LN2000">2000</td><td class="line">ImplCollector&amp; getImplData()</td></tr>
<tr class="codeline" data-linenumber="2001"><td class="num" id="LN2001">2001</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2002"><td class="num" id="LN2002">2002</td><td class="line">    CV_SINGLETON_LAZY_INIT_REF(ImplCollector, <span class='keyword'>new</span> ImplCollector())</td></tr>
<tr class="codeline" data-linenumber="2003"><td class="num" id="LN2003">2003</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2004"><td class="num" id="LN2004">2004</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2005"><td class="num" id="LN2005">2005</td><td class="line"><span class='keyword'>void</span> setImpl(<span class='keyword'>int</span> flags)</td></tr>
<tr class="codeline" data-linenumber="2006"><td class="num" id="LN2006">2006</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2007"><td class="num" id="LN2007">2007</td><td class="line">    cv::AutoLock lock(getImplData().mutex);</td></tr>
<tr class="codeline" data-linenumber="2008"><td class="num" id="LN2008">2008</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2009"><td class="num" id="LN2009">2009</td><td class="line">    getImplData().implFlags = flags;</td></tr>
<tr class="codeline" data-linenumber="2010"><td class="num" id="LN2010">2010</td><td class="line">    getImplData().implCode.clear();</td></tr>
<tr class="codeline" data-linenumber="2011"><td class="num" id="LN2011">2011</td><td class="line">    getImplData().implFun.clear();</td></tr>
<tr class="codeline" data-linenumber="2012"><td class="num" id="LN2012">2012</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2013"><td class="num" id="LN2013">2013</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2014"><td class="num" id="LN2014">2014</td><td class="line"><span class='keyword'>void</span> addImpl(<span class='keyword'>int</span> flag, <span class='keyword'>const</span> <span class='keyword'>char</span>* func)</td></tr>
<tr class="codeline" data-linenumber="2015"><td class="num" id="LN2015">2015</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2016"><td class="num" id="LN2016">2016</td><td class="line">    cv::AutoLock lock(getImplData().mutex);</td></tr>
<tr class="codeline" data-linenumber="2017"><td class="num" id="LN2017">2017</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2018"><td class="num" id="LN2018">2018</td><td class="line">    getImplData().implFlags |= flag;</td></tr>
<tr class="codeline" data-linenumber="2019"><td class="num" id="LN2019">2019</td><td class="line">    <span class='keyword'>if</span>(func) <span class='comment'>// use lazy collection if name was not specified</span></td></tr>
<tr class="codeline" data-linenumber="2020"><td class="num" id="LN2020">2020</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2021"><td class="num" id="LN2021">2021</td><td class="line">        size_t index = getImplData().implCode.size();</td></tr>
<tr class="codeline" data-linenumber="2022"><td class="num" id="LN2022">2022</td><td class="line">        <span class='keyword'>if</span>(!index || (getImplData().implCode[index-1] != flag || getImplData().implFun[index-1].compare(func))) <span class='comment'>// avoid duplicates</span></td></tr>
<tr class="codeline" data-linenumber="2023"><td class="num" id="LN2023">2023</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2024"><td class="num" id="LN2024">2024</td><td class="line">            getImplData().implCode.push_back(flag);</td></tr>
<tr class="codeline" data-linenumber="2025"><td class="num" id="LN2025">2025</td><td class="line">            getImplData().implFun.push_back(func);</td></tr>
<tr class="codeline" data-linenumber="2026"><td class="num" id="LN2026">2026</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2027"><td class="num" id="LN2027">2027</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2028"><td class="num" id="LN2028">2028</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2029"><td class="num" id="LN2029">2029</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2030"><td class="num" id="LN2030">2030</td><td class="line"><span class='keyword'>int</span> getImpl(std::vector&lt;<span class='keyword'>int</span>&gt; &amp;impl, std::vector&lt;String&gt; &amp;funName)</td></tr>
<tr class="codeline" data-linenumber="2031"><td class="num" id="LN2031">2031</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2032"><td class="num" id="LN2032">2032</td><td class="line">    cv::AutoLock lock(getImplData().mutex);</td></tr>
<tr class="codeline" data-linenumber="2033"><td class="num" id="LN2033">2033</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2034"><td class="num" id="LN2034">2034</td><td class="line">    impl    = getImplData().implCode;</td></tr>
<tr class="codeline" data-linenumber="2035"><td class="num" id="LN2035">2035</td><td class="line">    funName = getImplData().implFun;</td></tr>
<tr class="codeline" data-linenumber="2036"><td class="num" id="LN2036">2036</td><td class="line">    <span class='keyword'>return</span> getImplData().implFlags; <span class='comment'>// return actual flags for lazy collection</span></td></tr>
<tr class="codeline" data-linenumber="2037"><td class="num" id="LN2037">2037</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2038"><td class="num" id="LN2038">2038</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2039"><td class="num" id="LN2039">2039</td><td class="line"><span class='keyword'>bool</span> useCollection()</td></tr>
<tr class="codeline" data-linenumber="2040"><td class="num" id="LN2040">2040</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2041"><td class="num" id="LN2041">2041</td><td class="line">    <span class='keyword'>return</span> getImplData().useCollection;</td></tr>
<tr class="codeline" data-linenumber="2042"><td class="num" id="LN2042">2042</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2043"><td class="num" id="LN2043">2043</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2044"><td class="num" id="LN2044">2044</td><td class="line"><span class='keyword'>void</span> setUseCollection(<span class='keyword'>bool</span> flag)</td></tr>
<tr class="codeline" data-linenumber="2045"><td class="num" id="LN2045">2045</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2046"><td class="num" id="LN2046">2046</td><td class="line">    cv::AutoLock lock(getImplData().mutex);</td></tr>
<tr class="codeline" data-linenumber="2047"><td class="num" id="LN2047">2047</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2048"><td class="num" id="LN2048">2048</td><td class="line">    getImplData().useCollection = flag;</td></tr>
<tr class="codeline" data-linenumber="2049"><td class="num" id="LN2049">2049</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2050"><td class="num" id="LN2050">2050</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2051"><td class="num" id="LN2051">2051</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2052"><td class="num" id="LN2052">2052</td><td class="line"><span class='keyword'>namespace</span> instr</td></tr>
<tr class="codeline" data-linenumber="2053"><td class="num" id="LN2053">2053</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2054"><td class="num" id="LN2054">2054</td><td class="line"><span class='keyword'>bool</span> useInstrumentation()</td></tr>
<tr class="codeline" data-linenumber="2055"><td class="num" id="LN2055">2055</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2056"><td class="num" id="LN2056">2056</td><td class="line"><span class='directive'>#ifdef ENABLE_INSTRUMENTATION</span></td></tr>
<tr class="codeline" data-linenumber="2057"><td class="num" id="LN2057">2057</td><td class="line">    <span class='keyword'>return</span> getInstrumentStruct().useInstr;</td></tr>
<tr class="codeline" data-linenumber="2058"><td class="num" id="LN2058">2058</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="2059"><td class="num" id="LN2059">2059</td><td class="line">    <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="2060"><td class="num" id="LN2060">2060</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2061"><td class="num" id="LN2061">2061</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2062"><td class="num" id="LN2062">2062</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2063"><td class="num" id="LN2063">2063</td><td class="line"><span class='keyword'>void</span> setUseInstrumentation(<span class='keyword'>bool</span> flag)</td></tr>
<tr class="codeline" data-linenumber="2064"><td class="num" id="LN2064">2064</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2065"><td class="num" id="LN2065">2065</td><td class="line"><span class='directive'>#ifdef ENABLE_INSTRUMENTATION</span></td></tr>
<tr class="codeline" data-linenumber="2066"><td class="num" id="LN2066">2066</td><td class="line">    getInstrumentStruct().useInstr = flag;</td></tr>
<tr class="codeline" data-linenumber="2067"><td class="num" id="LN2067">2067</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="2068"><td class="num" id="LN2068">2068</td><td class="line">    <span class='macro'>CV_UNUSED(flag)<span class='macro_popup'>(void)flag</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2069"><td class="num" id="LN2069">2069</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2070"><td class="num" id="LN2070">2070</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2071"><td class="num" id="LN2071">2071</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2072"><td class="num" id="LN2072">2072</td><td class="line">InstrNode* getTrace()</td></tr>
<tr class="codeline" data-linenumber="2073"><td class="num" id="LN2073">2073</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2074"><td class="num" id="LN2074">2074</td><td class="line"><span class='directive'>#ifdef ENABLE_INSTRUMENTATION</span></td></tr>
<tr class="codeline" data-linenumber="2075"><td class="num" id="LN2075">2075</td><td class="line">    <span class='keyword'>return</span> &amp;getInstrumentStruct().rootNode;</td></tr>
<tr class="codeline" data-linenumber="2076"><td class="num" id="LN2076">2076</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="2077"><td class="num" id="LN2077">2077</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>__null</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2078"><td class="num" id="LN2078">2078</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2079"><td class="num" id="LN2079">2079</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2080"><td class="num" id="LN2080">2080</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2081"><td class="num" id="LN2081">2081</td><td class="line"><span class='keyword'>void</span> resetTrace()</td></tr>
<tr class="codeline" data-linenumber="2082"><td class="num" id="LN2082">2082</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2083"><td class="num" id="LN2083">2083</td><td class="line"><span class='directive'>#ifdef ENABLE_INSTRUMENTATION</span></td></tr>
<tr class="codeline" data-linenumber="2084"><td class="num" id="LN2084">2084</td><td class="line">    getInstrumentStruct().rootNode.removeChilds();</td></tr>
<tr class="codeline" data-linenumber="2085"><td class="num" id="LN2085">2085</td><td class="line">    getInstrumentTLSStruct().pCurrentNode = &amp;getInstrumentStruct().rootNode;</td></tr>
<tr class="codeline" data-linenumber="2086"><td class="num" id="LN2086">2086</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2087"><td class="num" id="LN2087">2087</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2088"><td class="num" id="LN2088">2088</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2089"><td class="num" id="LN2089">2089</td><td class="line"><span class='keyword'>void</span> setFlags(FLAGS modeFlags)</td></tr>
<tr class="codeline" data-linenumber="2090"><td class="num" id="LN2090">2090</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2091"><td class="num" id="LN2091">2091</td><td class="line"><span class='directive'>#ifdef ENABLE_INSTRUMENTATION</span></td></tr>
<tr class="codeline" data-linenumber="2092"><td class="num" id="LN2092">2092</td><td class="line">    getInstrumentStruct().flags = modeFlags;</td></tr>
<tr class="codeline" data-linenumber="2093"><td class="num" id="LN2093">2093</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="2094"><td class="num" id="LN2094">2094</td><td class="line">    <span class='macro'>CV_UNUSED(modeFlags)<span class='macro_popup'>(void)modeFlags</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2095"><td class="num" id="LN2095">2095</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2096"><td class="num" id="LN2096">2096</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2097"><td class="num" id="LN2097">2097</td><td class="line">FLAGS getFlags()</td></tr>
<tr class="codeline" data-linenumber="2098"><td class="num" id="LN2098">2098</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2099"><td class="num" id="LN2099">2099</td><td class="line"><span class='directive'>#ifdef ENABLE_INSTRUMENTATION</span></td></tr>
<tr class="codeline" data-linenumber="2100"><td class="num" id="LN2100">2100</td><td class="line">    <span class='keyword'>return</span> (FLAGS)getInstrumentStruct().flags;</td></tr>
<tr class="codeline" data-linenumber="2101"><td class="num" id="LN2101">2101</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="2102"><td class="num" id="LN2102">2102</td><td class="line">    <span class='keyword'>return</span> (FLAGS)0;</td></tr>
<tr class="codeline" data-linenumber="2103"><td class="num" id="LN2103">2103</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2104"><td class="num" id="LN2104">2104</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2105"><td class="num" id="LN2105">2105</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2106"><td class="num" id="LN2106">2106</td><td class="line">NodeData::NodeData(<span class='keyword'>const</span> <span class='keyword'>char</span>* funName, <span class='keyword'>const</span> <span class='keyword'>char</span>* fileName, <span class='keyword'>int</span> lineNum, <span class='keyword'>void</span>* retAddress, <span class='keyword'>bool</span> alwaysExpand, cv::instr::TYPE instrType, cv::instr::IMPL implType)</td></tr>
<tr class="codeline" data-linenumber="2107"><td class="num" id="LN2107">2107</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2108"><td class="num" id="LN2108">2108</td><td class="line">    m_funName       = funName ? cv::String(funName) : cv::String();  <span class='comment'>// std::string doesn't accept NULL</span></td></tr>
<tr class="codeline" data-linenumber="2109"><td class="num" id="LN2109">2109</td><td class="line">    m_instrType     = instrType;</td></tr>
<tr class="codeline" data-linenumber="2110"><td class="num" id="LN2110">2110</td><td class="line">    m_implType      = implType;</td></tr>
<tr class="codeline" data-linenumber="2111"><td class="num" id="LN2111">2111</td><td class="line">    m_fileName      = fileName;</td></tr>
<tr class="codeline" data-linenumber="2112"><td class="num" id="LN2112">2112</td><td class="line">    m_lineNum       = lineNum;</td></tr>
<tr class="codeline" data-linenumber="2113"><td class="num" id="LN2113">2113</td><td class="line">    m_retAddress    = retAddress;</td></tr>
<tr class="codeline" data-linenumber="2114"><td class="num" id="LN2114">2114</td><td class="line">    m_alwaysExpand  = alwaysExpand;</td></tr>
<tr class="codeline" data-linenumber="2115"><td class="num" id="LN2115">2115</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2116"><td class="num" id="LN2116">2116</td><td class="line">    m_threads    = 1;</td></tr>
<tr class="codeline" data-linenumber="2117"><td class="num" id="LN2117">2117</td><td class="line">    m_counter    = 0;</td></tr>
<tr class="codeline" data-linenumber="2118"><td class="num" id="LN2118">2118</td><td class="line">    m_ticksTotal = 0;</td></tr>
<tr class="codeline" data-linenumber="2119"><td class="num" id="LN2119">2119</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2120"><td class="num" id="LN2120">2120</td><td class="line">    m_funError  = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="2121"><td class="num" id="LN2121">2121</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2122"><td class="num" id="LN2122">2122</td><td class="line">NodeData::NodeData(NodeData &amp;ref)</td></tr>
<tr class="codeline" data-linenumber="2123"><td class="num" id="LN2123">2123</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2124"><td class="num" id="LN2124">2124</td><td class="line">    *<span class='keyword'>this</span> = ref;</td></tr>
<tr class="codeline" data-linenumber="2125"><td class="num" id="LN2125">2125</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2126"><td class="num" id="LN2126">2126</td><td class="line">NodeData&amp; NodeData::<span class='keyword'>operator</span>=(<span class='keyword'>const</span> NodeData &amp;right)</td></tr>
<tr class="codeline" data-linenumber="2127"><td class="num" id="LN2127">2127</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2128"><td class="num" id="LN2128">2128</td><td class="line">    <span class='keyword'>this</span>-&gt;m_funName      = right.m_funName;</td></tr>
<tr class="codeline" data-linenumber="2129"><td class="num" id="LN2129">2129</td><td class="line">    <span class='keyword'>this</span>-&gt;m_instrType    = right.m_instrType;</td></tr>
<tr class="codeline" data-linenumber="2130"><td class="num" id="LN2130">2130</td><td class="line">    <span class='keyword'>this</span>-&gt;m_implType     = right.m_implType;</td></tr>
<tr class="codeline" data-linenumber="2131"><td class="num" id="LN2131">2131</td><td class="line">    <span class='keyword'>this</span>-&gt;m_fileName     = right.m_fileName;</td></tr>
<tr class="codeline" data-linenumber="2132"><td class="num" id="LN2132">2132</td><td class="line">    <span class='keyword'>this</span>-&gt;m_lineNum      = right.m_lineNum;</td></tr>
<tr class="codeline" data-linenumber="2133"><td class="num" id="LN2133">2133</td><td class="line">    <span class='keyword'>this</span>-&gt;m_retAddress   = right.m_retAddress;</td></tr>
<tr class="codeline" data-linenumber="2134"><td class="num" id="LN2134">2134</td><td class="line">    <span class='keyword'>this</span>-&gt;m_alwaysExpand = right.m_alwaysExpand;</td></tr>
<tr class="codeline" data-linenumber="2135"><td class="num" id="LN2135">2135</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2136"><td class="num" id="LN2136">2136</td><td class="line">    <span class='keyword'>this</span>-&gt;m_threads     = right.m_threads;</td></tr>
<tr class="codeline" data-linenumber="2137"><td class="num" id="LN2137">2137</td><td class="line">    <span class='keyword'>this</span>-&gt;m_counter     = right.m_counter;</td></tr>
<tr class="codeline" data-linenumber="2138"><td class="num" id="LN2138">2138</td><td class="line">    <span class='keyword'>this</span>-&gt;m_ticksTotal  = right.m_ticksTotal;</td></tr>
<tr class="codeline" data-linenumber="2139"><td class="num" id="LN2139">2139</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2140"><td class="num" id="LN2140">2140</td><td class="line">    <span class='keyword'>this</span>-&gt;m_funError    = right.m_funError;</td></tr>
<tr class="codeline" data-linenumber="2141"><td class="num" id="LN2141">2141</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2142"><td class="num" id="LN2142">2142</td><td class="line">    <span class='keyword'>return</span> *<span class='keyword'>this</span>;</td></tr>
<tr class="codeline" data-linenumber="2143"><td class="num" id="LN2143">2143</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2144"><td class="num" id="LN2144">2144</td><td class="line">NodeData::~NodeData()</td></tr>
<tr class="codeline" data-linenumber="2145"><td class="num" id="LN2145">2145</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2146"><td class="num" id="LN2146">2146</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2147"><td class="num" id="LN2147">2147</td><td class="line"><span class='keyword'>bool</span> <span class='keyword'>operator</span>==(<span class='keyword'>const</span> NodeData&amp; left, <span class='keyword'>const</span> NodeData&amp; right)</td></tr>
<tr class="codeline" data-linenumber="2148"><td class="num" id="LN2148">2148</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2149"><td class="num" id="LN2149">2149</td><td class="line">    <span class='keyword'>if</span>(left.m_lineNum == right.m_lineNum &amp;&amp; left.m_funName == right.m_funName &amp;&amp; left.m_fileName == right.m_fileName)</td></tr>
<tr class="codeline" data-linenumber="2150"><td class="num" id="LN2150">2150</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2151"><td class="num" id="LN2151">2151</td><td class="line">        <span class='keyword'>if</span>(left.m_retAddress == right.m_retAddress || !(cv::instr::getFlags()&amp;cv::instr::FLAGS_EXPAND_SAME_NAMES || left.m_alwaysExpand))</td></tr>
<tr class="codeline" data-linenumber="2152"><td class="num" id="LN2152">2152</td><td class="line">            <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="2153"><td class="num" id="LN2153">2153</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2154"><td class="num" id="LN2154">2154</td><td class="line">    <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="2155"><td class="num" id="LN2155">2155</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2156"><td class="num" id="LN2156">2156</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2157"><td class="num" id="LN2157">2157</td><td class="line"><span class='directive'>#ifdef ENABLE_INSTRUMENTATION</span></td></tr>
<tr class="codeline" data-linenumber="2158"><td class="num" id="LN2158">2158</td><td class="line">InstrStruct&amp; getInstrumentStruct()</td></tr>
<tr class="codeline" data-linenumber="2159"><td class="num" id="LN2159">2159</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2160"><td class="num" id="LN2160">2160</td><td class="line">    <span class='keyword'>static</span> InstrStruct instr;</td></tr>
<tr class="codeline" data-linenumber="2161"><td class="num" id="LN2161">2161</td><td class="line">    <span class='keyword'>return</span> instr;</td></tr>
<tr class="codeline" data-linenumber="2162"><td class="num" id="LN2162">2162</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2163"><td class="num" id="LN2163">2163</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2164"><td class="num" id="LN2164">2164</td><td class="line">InstrTLSStruct&amp; getInstrumentTLSStruct()</td></tr>
<tr class="codeline" data-linenumber="2165"><td class="num" id="LN2165">2165</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2166"><td class="num" id="LN2166">2166</td><td class="line">    <span class='keyword'>return</span> *getInstrumentStruct().tlsStruct.get();</td></tr>
<tr class="codeline" data-linenumber="2167"><td class="num" id="LN2167">2167</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2168"><td class="num" id="LN2168">2168</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2169"><td class="num" id="LN2169">2169</td><td class="line">InstrNode* getCurrentNode()</td></tr>
<tr class="codeline" data-linenumber="2170"><td class="num" id="LN2170">2170</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2171"><td class="num" id="LN2171">2171</td><td class="line">    <span class='keyword'>return</span> getInstrumentTLSStruct().pCurrentNode;</td></tr>
<tr class="codeline" data-linenumber="2172"><td class="num" id="LN2172">2172</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2173"><td class="num" id="LN2173">2173</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2174"><td class="num" id="LN2174">2174</td><td class="line">IntrumentationRegion::IntrumentationRegion(<span class='keyword'>const</span> <span class='keyword'>char</span>* funName, <span class='keyword'>const</span> <span class='keyword'>char</span>* fileName, <span class='keyword'>int</span> lineNum, <span class='keyword'>void</span> *retAddress, <span class='keyword'>bool</span> alwaysExpand, TYPE instrType, IMPL implType)</td></tr>
<tr class="codeline" data-linenumber="2175"><td class="num" id="LN2175">2175</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2176"><td class="num" id="LN2176">2176</td><td class="line">    m_disabled    = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="2177"><td class="num" id="LN2177">2177</td><td class="line">    m_regionTicks = 0;</td></tr>
<tr class="codeline" data-linenumber="2178"><td class="num" id="LN2178">2178</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2179"><td class="num" id="LN2179">2179</td><td class="line">    InstrStruct *pStruct = &amp;getInstrumentStruct();</td></tr>
<tr class="codeline" data-linenumber="2180"><td class="num" id="LN2180">2180</td><td class="line">    <span class='keyword'>if</span>(pStruct-&gt;useInstr)</td></tr>
<tr class="codeline" data-linenumber="2181"><td class="num" id="LN2181">2181</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2182"><td class="num" id="LN2182">2182</td><td class="line">        InstrTLSStruct *pTLS = &amp;getInstrumentTLSStruct();</td></tr>
<tr class="codeline" data-linenumber="2183"><td class="num" id="LN2183">2183</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2184"><td class="num" id="LN2184">2184</td><td class="line">        <span class='comment'>// Disable in case of failure</span></td></tr>
<tr class="codeline" data-linenumber="2185"><td class="num" id="LN2185">2185</td><td class="line">        <span class='keyword'>if</span>(!pTLS-&gt;pCurrentNode)</td></tr>
<tr class="codeline" data-linenumber="2186"><td class="num" id="LN2186">2186</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2187"><td class="num" id="LN2187">2187</td><td class="line">            m_disabled = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="2188"><td class="num" id="LN2188">2188</td><td class="line">            <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="2189"><td class="num" id="LN2189">2189</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2190"><td class="num" id="LN2190">2190</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2191"><td class="num" id="LN2191">2191</td><td class="line">        <span class='keyword'>int</span> depth = pTLS-&gt;pCurrentNode-&gt;getDepth();</td></tr>
<tr class="codeline" data-linenumber="2192"><td class="num" id="LN2192">2192</td><td class="line">        <span class='keyword'>if</span>(pStruct-&gt;maxDepth &amp;&amp; pStruct-&gt;maxDepth &lt;= depth)</td></tr>
<tr class="codeline" data-linenumber="2193"><td class="num" id="LN2193">2193</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2194"><td class="num" id="LN2194">2194</td><td class="line">            m_disabled = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="2195"><td class="num" id="LN2195">2195</td><td class="line">            <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="2196"><td class="num" id="LN2196">2196</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2197"><td class="num" id="LN2197">2197</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2198"><td class="num" id="LN2198">2198</td><td class="line">        NodeData payload(funName, fileName, lineNum, retAddress, alwaysExpand, instrType, implType);</td></tr>
<tr class="codeline" data-linenumber="2199"><td class="num" id="LN2199">2199</td><td class="line">        Node&lt;NodeData&gt;* pChild = <span class='macro'>NULL<span class='macro_popup'>__null</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2200"><td class="num" id="LN2200">2200</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2201"><td class="num" id="LN2201">2201</td><td class="line">        <span class='keyword'>if</span>(pStruct-&gt;flags&amp;FLAGS_MAPPING)</td></tr>
<tr class="codeline" data-linenumber="2202"><td class="num" id="LN2202">2202</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2203"><td class="num" id="LN2203">2203</td><td class="line">            <span class='comment'>// Critical section</span></td></tr>
<tr class="codeline" data-linenumber="2204"><td class="num" id="LN2204">2204</td><td class="line">            cv::AutoLock guard(pStruct-&gt;mutexCreate); <span class='comment'>// Guard from concurrent child creation</span></td></tr>
<tr class="codeline" data-linenumber="2205"><td class="num" id="LN2205">2205</td><td class="line">            pChild = pTLS-&gt;pCurrentNode-&gt;findChild(payload);</td></tr>
<tr class="codeline" data-linenumber="2206"><td class="num" id="LN2206">2206</td><td class="line">            <span class='keyword'>if</span>(!pChild)</td></tr>
<tr class="codeline" data-linenumber="2207"><td class="num" id="LN2207">2207</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="2208"><td class="num" id="LN2208">2208</td><td class="line">                pChild = <span class='keyword'>new</span> Node&lt;NodeData&gt;(payload);</td></tr>
<tr class="codeline" data-linenumber="2209"><td class="num" id="LN2209">2209</td><td class="line">                pTLS-&gt;pCurrentNode-&gt;addChild(pChild);</td></tr>
<tr class="codeline" data-linenumber="2210"><td class="num" id="LN2210">2210</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2211"><td class="num" id="LN2211">2211</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2212"><td class="num" id="LN2212">2212</td><td class="line">        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2213"><td class="num" id="LN2213">2213</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2214"><td class="num" id="LN2214">2214</td><td class="line">            pChild = pTLS-&gt;pCurrentNode-&gt;findChild(payload);</td></tr>
<tr class="codeline" data-linenumber="2215"><td class="num" id="LN2215">2215</td><td class="line">            <span class='keyword'>if</span>(!pChild)</td></tr>
<tr class="codeline" data-linenumber="2216"><td class="num" id="LN2216">2216</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="2217"><td class="num" id="LN2217">2217</td><td class="line">                m_disabled = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="2218"><td class="num" id="LN2218">2218</td><td class="line">                <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="2219"><td class="num" id="LN2219">2219</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2220"><td class="num" id="LN2220">2220</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2221"><td class="num" id="LN2221">2221</td><td class="line">        pTLS-&gt;pCurrentNode = pChild;</td></tr>
<tr class="codeline" data-linenumber="2222"><td class="num" id="LN2222">2222</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2223"><td class="num" id="LN2223">2223</td><td class="line">        m_regionTicks = getTickCount();</td></tr>
<tr class="codeline" data-linenumber="2224"><td class="num" id="LN2224">2224</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2225"><td class="num" id="LN2225">2225</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2226"><td class="num" id="LN2226">2226</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2227"><td class="num" id="LN2227">2227</td><td class="line">IntrumentationRegion::~IntrumentationRegion()</td></tr>
<tr class="codeline" data-linenumber="2228"><td class="num" id="LN2228">2228</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2229"><td class="num" id="LN2229">2229</td><td class="line">    InstrStruct *pStruct = &amp;getInstrumentStruct();</td></tr>
<tr class="codeline" data-linenumber="2230"><td class="num" id="LN2230">2230</td><td class="line">    <span class='keyword'>if</span>(pStruct-&gt;useInstr)</td></tr>
<tr class="codeline" data-linenumber="2231"><td class="num" id="LN2231">2231</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2232"><td class="num" id="LN2232">2232</td><td class="line">        <span class='keyword'>if</span>(!m_disabled)</td></tr>
<tr class="codeline" data-linenumber="2233"><td class="num" id="LN2233">2233</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2234"><td class="num" id="LN2234">2234</td><td class="line">            InstrTLSStruct *pTLS = &amp;getInstrumentTLSStruct();</td></tr>
<tr class="codeline" data-linenumber="2235"><td class="num" id="LN2235">2235</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2236"><td class="num" id="LN2236">2236</td><td class="line">            <span class='keyword'>if</span> (pTLS-&gt;pCurrentNode-&gt;m_payload.m_implType == cv::instr::IMPL_OPENCL &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="2237"><td class="num" id="LN2237">2237</td><td class="line">                (pTLS-&gt;pCurrentNode-&gt;m_payload.m_instrType == cv::instr::TYPE_FUN ||</td></tr>
<tr class="codeline" data-linenumber="2238"><td class="num" id="LN2238">2238</td><td class="line">                    pTLS-&gt;pCurrentNode-&gt;m_payload.m_instrType == cv::instr::TYPE_WRAPPER))</td></tr>
<tr class="codeline" data-linenumber="2239"><td class="num" id="LN2239">2239</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="2240"><td class="num" id="LN2240">2240</td><td class="line">                cv::ocl::finish(); <span class='comment'>// TODO Support "async" OpenCL instrumentation</span></td></tr>
<tr class="codeline" data-linenumber="2241"><td class="num" id="LN2241">2241</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2242"><td class="num" id="LN2242">2242</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2243"><td class="num" id="LN2243">2243</td><td class="line">            uint64 ticks = (getTickCount() - m_regionTicks);</td></tr>
<tr class="codeline" data-linenumber="2244"><td class="num" id="LN2244">2244</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="2245"><td class="num" id="LN2245">2245</td><td class="line">                cv::AutoLock guard(pStruct-&gt;mutexCount); <span class='comment'>// Concurrent ticks accumulation</span></td></tr>
<tr class="codeline" data-linenumber="2246"><td class="num" id="LN2246">2246</td><td class="line">                pTLS-&gt;pCurrentNode-&gt;m_payload.m_counter++;</td></tr>
<tr class="codeline" data-linenumber="2247"><td class="num" id="LN2247">2247</td><td class="line">                pTLS-&gt;pCurrentNode-&gt;m_payload.m_ticksTotal += ticks;</td></tr>
<tr class="codeline" data-linenumber="2248"><td class="num" id="LN2248">2248</td><td class="line">                pTLS-&gt;pCurrentNode-&gt;m_payload.m_tls.get()-&gt;m_ticksTotal += ticks;</td></tr>
<tr class="codeline" data-linenumber="2249"><td class="num" id="LN2249">2249</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2250"><td class="num" id="LN2250">2250</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2251"><td class="num" id="LN2251">2251</td><td class="line">            pTLS-&gt;pCurrentNode = pTLS-&gt;pCurrentNode-&gt;m_pParent;</td></tr>
<tr class="codeline" data-linenumber="2252"><td class="num" id="LN2252">2252</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2253"><td class="num" id="LN2253">2253</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2254"><td class="num" id="LN2254">2254</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2255"><td class="num" id="LN2255">2255</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2256"><td class="num" id="LN2256">2256</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2257"><td class="num" id="LN2257">2257</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2258"><td class="num" id="LN2258">2258</td><td class="line"><span class='keyword'>namespace</span> ipp</td></tr>
<tr class="codeline" data-linenumber="2259"><td class="num" id="LN2259">2259</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2260"><td class="num" id="LN2260">2260</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2261"><td class="num" id="LN2261">2261</td><td class="line"><span class='directive'>#ifdef HAVE_IPP</span></td></tr>
<tr class="codeline" data-linenumber="2262"><td class="num" id="LN2262">2262</td><td class="line"><span class='keyword'>struct</span> IPPInitSingleton</td></tr>
<tr class="codeline" data-linenumber="2263"><td class="num" id="LN2263">2263</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2264"><td class="num" id="LN2264">2264</td><td class="line"><span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="2265"><td class="num" id="LN2265">2265</td><td class="line">    IPPInitSingleton()</td></tr>
<tr class="codeline" data-linenumber="2266"><td class="num" id="LN2266">2266</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2267"><td class="num" id="LN2267">2267</td><td class="line">        useIPP         = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="2268"><td class="num" id="LN2268">2268</td><td class="line">        useIPP_NE      = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="2269"><td class="num" id="LN2269">2269</td><td class="line">        ippStatus      = 0;</td></tr>
<tr class="codeline" data-linenumber="2270"><td class="num" id="LN2270">2270</td><td class="line">        funcname       = <span class='macro'>NULL<span class='macro_popup'>__null</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2271"><td class="num" id="LN2271">2271</td><td class="line">        filename       = <span class='macro'>NULL<span class='macro_popup'>__null</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2272"><td class="num" id="LN2272">2272</td><td class="line">        linen          = 0;</td></tr>
<tr class="codeline" data-linenumber="2273"><td class="num" id="LN2273">2273</td><td class="line">        cpuFeatures    = 0;</td></tr>
<tr class="codeline" data-linenumber="2274"><td class="num" id="LN2274">2274</td><td class="line">        ippFeatures    = 0;</td></tr>
<tr class="codeline" data-linenumber="2275"><td class="num" id="LN2275">2275</td><td class="line">        ippTopFeatures = 0;</td></tr>
<tr class="codeline" data-linenumber="2276"><td class="num" id="LN2276">2276</td><td class="line">        pIppLibInfo    = <span class='macro'>NULL<span class='macro_popup'>__null</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2277"><td class="num" id="LN2277">2277</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2278"><td class="num" id="LN2278">2278</td><td class="line">        ippStatus = <span class='macro'>ippGetCpuFeatures<span class='macro_popup'>ippicvGetCpuFeatures</span></span>(&amp;cpuFeatures, <span class='macro'>NULL<span class='macro_popup'>__null</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2279"><td class="num" id="LN2279">2279</td><td class="line">        <span class='keyword'>if</span>(ippStatus &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="2280"><td class="num" id="LN2280">2280</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2281"><td class="num" id="LN2281">2281</td><td class="line">            std::cerr &lt;&lt; <span class='string_literal'>"ERROR: IPP cannot detect CPU features, IPP was disabled "</span> &lt;&lt; std::endl;</td></tr>
<tr class="codeline" data-linenumber="2282"><td class="num" id="LN2282">2282</td><td class="line">            useIPP = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="2283"><td class="num" id="LN2283">2283</td><td class="line">            <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="2284"><td class="num" id="LN2284">2284</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2285"><td class="num" id="LN2285">2285</td><td class="line">        ippFeatures = cpuFeatures;</td></tr>
<tr class="codeline" data-linenumber="2286"><td class="num" id="LN2286">2286</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2287"><td class="num" id="LN2287">2287</td><td class="line">        <span class='keyword'>const</span> <span class='keyword'>char</span>* pIppEnv = getenv(<span class='string_literal'>"OPENCV_IPP"</span>);</td></tr>
<tr class="codeline" data-linenumber="2288"><td class="num" id="LN2288">2288</td><td class="line">        cv::String env;</td></tr>
<tr class="codeline" data-linenumber="2289"><td class="num" id="LN2289">2289</td><td class="line">        <span class='keyword'>if</span>(pIppEnv != <span class='macro'>NULL<span class='macro_popup'>__null</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2290"><td class="num" id="LN2290">2290</td><td class="line">            env = pIppEnv;</td></tr>
<tr class="codeline" data-linenumber="2291"><td class="num" id="LN2291">2291</td><td class="line">        <span class='keyword'>if</span>(env.size())</td></tr>
<tr class="codeline" data-linenumber="2292"><td class="num" id="LN2292">2292</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2293"><td class="num" id="LN2293">2293</td><td class="line"><span class='directive'>#if <span class='macro'>IPP_VERSION_X100<span class='macro_popup'>(2020 * 100 + 0*10 + 0)</span></span> &gt;= 201900</span></td></tr>
<tr class="codeline" data-linenumber="2294"><td class="num" id="LN2294">2294</td><td class="line">            <span class='keyword'>const</span> Ipp64u minorFeatures = <span class='macro'>ippCPUID_MOVBE<span class='macro_popup'>0x00000020</span></span>|<span class='macro'>ippCPUID_AES<span class='macro_popup'>0x00000400</span></span>|<span class='macro'>ippCPUID_CLMUL<span class='macro_popup'>0x00000800</span></span>|<span class='macro'>ippCPUID_ABR<span class='macro_popup'>0x00001000</span></span>|<span class='macro'>ippCPUID_RDRAND<span class='macro_popup'>0x00002000</span></span>|<span class='macro'>ippCPUID_F16C<span class='macro_popup'>0x00004000</span></span>|</td></tr>
<tr class="codeline" data-linenumber="2295"><td class="num" id="LN2295">2295</td><td class="line">                <span class='macro'>ippCPUID_ADCOX<span class='macro_popup'>0x00010000</span></span>|<span class='macro'>ippCPUID_RDSEED<span class='macro_popup'>0x00020000</span></span>|<span class='macro'>ippCPUID_PREFETCHW<span class='macro_popup'>0x00040000</span></span>|<span class='macro'>ippCPUID_SHA<span class='macro_popup'>0x00080000</span></span>|<span class='macro'>ippCPUID_MPX<span class='macro_popup'>0x10000000</span></span>|<span class='macro'>ippCPUID_AVX512CD<span class='macro_popup'>0x00200000</span></span>|<span class='macro'>ippCPUID_AVX512ER<span class='macro_popup'>0x00400000</span></span>|</td></tr>
<tr class="codeline" data-linenumber="2296"><td class="num" id="LN2296">2296</td><td class="line">                <span class='macro'>ippCPUID_AVX512PF<span class='macro_popup'>0x00800000</span></span>|<span class='macro'>ippCPUID_AVX512BW<span class='macro_popup'>0x01000000</span></span>|<span class='macro'>ippCPUID_AVX512DQ<span class='macro_popup'>0x02000000</span></span>|<span class='macro'>ippCPUID_AVX512VL<span class='macro_popup'>0x04000000</span></span>|<span class='macro'>ippCPUID_AVX512VBMI<span class='macro_popup'>0x08000000</span></span>|<span class='macro'>ippCPUID_AVX512_4FMADDPS<span class='macro_popup'>0x20000000</span></span>|</td></tr>
<tr class="codeline" data-linenumber="2297"><td class="num" id="LN2297">2297</td><td class="line">                <span class='macro'>ippCPUID_AVX512_4VNNIW<span class='macro_popup'>0x40000000</span></span>|<span class='macro'>ippCPUID_AVX512IFMA<span class='macro_popup'>0x100000000LL</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2298"><td class="num" id="LN2298">2298</td><td class="line"><span class='directive'>#elif <span class='macro'>IPP_VERSION_X100<span class='macro_popup'>(2020 * 100 + 0*10 + 0)</span></span> &gt;= 201703</span></td></tr>
<tr class="codeline" data-linenumber="2299"><td class="num" id="LN2299">2299</td><td class="line">            <span class='keyword'>const</span> Ipp64u minorFeatures = <span class='macro'>ippCPUID_MOVBE<span class='macro_popup'>0x00000020</span></span>|<span class='macro'>ippCPUID_AES<span class='macro_popup'>0x00000400</span></span>|<span class='macro'>ippCPUID_CLMUL<span class='macro_popup'>0x00000800</span></span>|<span class='macro'>ippCPUID_ABR<span class='macro_popup'>0x00001000</span></span>|<span class='macro'>ippCPUID_RDRAND<span class='macro_popup'>0x00002000</span></span>|<span class='macro'>ippCPUID_F16C<span class='macro_popup'>0x00004000</span></span>|</td></tr>
<tr class="codeline" data-linenumber="2300"><td class="num" id="LN2300">2300</td><td class="line">                <span class='macro'>ippCPUID_ADCOX<span class='macro_popup'>0x00010000</span></span>|<span class='macro'>ippCPUID_RDSEED<span class='macro_popup'>0x00020000</span></span>|<span class='macro'>ippCPUID_PREFETCHW<span class='macro_popup'>0x00040000</span></span>|<span class='macro'>ippCPUID_SHA<span class='macro_popup'>0x00080000</span></span>|<span class='macro'>ippCPUID_MPX<span class='macro_popup'>0x10000000</span></span>|<span class='macro'>ippCPUID_AVX512CD<span class='macro_popup'>0x00200000</span></span>|<span class='macro'>ippCPUID_AVX512ER<span class='macro_popup'>0x00400000</span></span>|</td></tr>
<tr class="codeline" data-linenumber="2301"><td class="num" id="LN2301">2301</td><td class="line">                <span class='macro'>ippCPUID_AVX512PF<span class='macro_popup'>0x00800000</span></span>|<span class='macro'>ippCPUID_AVX512BW<span class='macro_popup'>0x01000000</span></span>|<span class='macro'>ippCPUID_AVX512DQ<span class='macro_popup'>0x02000000</span></span>|<span class='macro'>ippCPUID_AVX512VL<span class='macro_popup'>0x04000000</span></span>|<span class='macro'>ippCPUID_AVX512VBMI<span class='macro_popup'>0x08000000</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2302"><td class="num" id="LN2302">2302</td><td class="line"><span class='directive'>#elif <span class='macro'>IPP_VERSION_X100<span class='macro_popup'>(2020 * 100 + 0*10 + 0)</span></span> &gt;= 201700</span></td></tr>
<tr class="codeline" data-linenumber="2303"><td class="num" id="LN2303">2303</td><td class="line">            <span class='keyword'>const</span> Ipp64u minorFeatures = <span class='macro'>ippCPUID_MOVBE<span class='macro_popup'>0x00000020</span></span>|<span class='macro'>ippCPUID_AES<span class='macro_popup'>0x00000400</span></span>|<span class='macro'>ippCPUID_CLMUL<span class='macro_popup'>0x00000800</span></span>|<span class='macro'>ippCPUID_ABR<span class='macro_popup'>0x00001000</span></span>|<span class='macro'>ippCPUID_RDRAND<span class='macro_popup'>0x00002000</span></span>|<span class='macro'>ippCPUID_F16C<span class='macro_popup'>0x00004000</span></span>|</td></tr>
<tr class="codeline" data-linenumber="2304"><td class="num" id="LN2304">2304</td><td class="line">                <span class='macro'>ippCPUID_ADCOX<span class='macro_popup'>0x00010000</span></span>|<span class='macro'>ippCPUID_RDSEED<span class='macro_popup'>0x00020000</span></span>|<span class='macro'>ippCPUID_PREFETCHW<span class='macro_popup'>0x00040000</span></span>|<span class='macro'>ippCPUID_SHA<span class='macro_popup'>0x00080000</span></span>|<span class='macro'>ippCPUID_AVX512CD<span class='macro_popup'>0x00200000</span></span>|<span class='macro'>ippCPUID_AVX512ER<span class='macro_popup'>0x00400000</span></span>|</td></tr>
<tr class="codeline" data-linenumber="2305"><td class="num" id="LN2305">2305</td><td class="line">                <span class='macro'>ippCPUID_AVX512PF<span class='macro_popup'>0x00800000</span></span>|<span class='macro'>ippCPUID_AVX512BW<span class='macro_popup'>0x01000000</span></span>|<span class='macro'>ippCPUID_AVX512DQ<span class='macro_popup'>0x02000000</span></span>|<span class='macro'>ippCPUID_AVX512VL<span class='macro_popup'>0x04000000</span></span>|<span class='macro'>ippCPUID_AVX512VBMI<span class='macro_popup'>0x08000000</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2306"><td class="num" id="LN2306">2306</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="2307"><td class="num" id="LN2307">2307</td><td class="line">            <span class='keyword'>const</span> Ipp64u minorFeatures = 0;</td></tr>
<tr class="codeline" data-linenumber="2308"><td class="num" id="LN2308">2308</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2309"><td class="num" id="LN2309">2309</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2310"><td class="num" id="LN2310">2310</td><td class="line">            env = toLowerCase(env);</td></tr>
<tr class="codeline" data-linenumber="2311"><td class="num" id="LN2311">2311</td><td class="line">            <span class='keyword'>if</span>(env.substr(0, 2) == <span class='string_literal'>"ne"</span>)</td></tr>
<tr class="codeline" data-linenumber="2312"><td class="num" id="LN2312">2312</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="2313"><td class="num" id="LN2313">2313</td><td class="line">                useIPP_NE = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="2314"><td class="num" id="LN2314">2314</td><td class="line">                env = env.substr(3, env.size());</td></tr>
<tr class="codeline" data-linenumber="2315"><td class="num" id="LN2315">2315</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2316"><td class="num" id="LN2316">2316</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2317"><td class="num" id="LN2317">2317</td><td class="line">            <span class='keyword'>if</span>(env == <span class='string_literal'>"disabled"</span>)</td></tr>
<tr class="codeline" data-linenumber="2318"><td class="num" id="LN2318">2318</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="2319"><td class="num" id="LN2319">2319</td><td class="line">                std::cerr &lt;&lt; <span class='string_literal'>"WARNING: IPP was disabled by OPENCV_IPP environment variable"</span> &lt;&lt; std::endl;</td></tr>
<tr class="codeline" data-linenumber="2320"><td class="num" id="LN2320">2320</td><td class="line">                useIPP = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="2321"><td class="num" id="LN2321">2321</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="2322"><td class="num" id="LN2322">2322</td><td class="line">            <span class='keyword'>else</span> <span class='keyword'>if</span>(env == <span class='string_literal'>"sse42"</span>)</td></tr>
<tr class="codeline" data-linenumber="2323"><td class="num" id="LN2323">2323</td><td class="line">                ippFeatures = minorFeatures|<span class='macro'>ippCPUID_SSE2<span class='macro_popup'>0x00000004</span></span>|<span class='macro'>ippCPUID_SSE3<span class='macro_popup'>0x00000008</span></span>|<span class='macro'>ippCPUID_SSSE3<span class='macro_popup'>0x00000010</span></span>|<span class='macro'>ippCPUID_SSE41<span class='macro_popup'>0x00000040</span></span>|<span class='macro'>ippCPUID_SSE42<span class='macro_popup'>0x00000080</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2324"><td class="num" id="LN2324">2324</td><td class="line">            <span class='keyword'>else</span> <span class='keyword'>if</span>(env == <span class='string_literal'>"avx2"</span>)</td></tr>
<tr class="codeline" data-linenumber="2325"><td class="num" id="LN2325">2325</td><td class="line">                ippFeatures = minorFeatures|<span class='macro'>ippCPUID_SSE2<span class='macro_popup'>0x00000004</span></span>|<span class='macro'>ippCPUID_SSE3<span class='macro_popup'>0x00000008</span></span>|<span class='macro'>ippCPUID_SSSE3<span class='macro_popup'>0x00000010</span></span>|<span class='macro'>ippCPUID_SSE41<span class='macro_popup'>0x00000040</span></span>|<span class='macro'>ippCPUID_SSE42<span class='macro_popup'>0x00000080</span></span>|<span class='macro'>ippCPUID_AVX<span class='macro_popup'>0x00000100</span></span>|<span class='macro'>ippCPUID_AVX2<span class='macro_popup'>0x00008000</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2326"><td class="num" id="LN2326">2326</td><td class="line"><span class='directive'>#if <span class='macro'>IPP_VERSION_X100<span class='macro_popup'>(2020 * 100 + 0*10 + 0)</span></span> &gt;= 201700</span></td></tr>
<tr class="codeline" data-linenumber="2327"><td class="num" id="LN2327">2327</td><td class="line"><span class='directive'>#if defined (_M_AMD64) || defined (<span class='macro'>__x86_64__<span class='macro_popup'>1</span></span>)</span></td></tr>
<tr class="codeline" data-linenumber="2328"><td class="num" id="LN2328">2328</td><td class="line">            <span class='keyword'>else</span> <span class='keyword'>if</span>(env == <span class='string_literal'>"avx512"</span>)</td></tr>
<tr class="codeline" data-linenumber="2329"><td class="num" id="LN2329">2329</td><td class="line">                ippFeatures = minorFeatures|<span class='macro'>ippCPUID_SSE2<span class='macro_popup'>0x00000004</span></span>|<span class='macro'>ippCPUID_SSE3<span class='macro_popup'>0x00000008</span></span>|<span class='macro'>ippCPUID_SSSE3<span class='macro_popup'>0x00000010</span></span>|<span class='macro'>ippCPUID_SSE41<span class='macro_popup'>0x00000040</span></span>|<span class='macro'>ippCPUID_SSE42<span class='macro_popup'>0x00000080</span></span>|<span class='macro'>ippCPUID_AVX<span class='macro_popup'>0x00000100</span></span>|<span class='macro'>ippCPUID_AVX2<span class='macro_popup'>0x00008000</span></span>|<span class='macro'>ippCPUID_AVX512F<span class='macro_popup'>0x00100000</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2330"><td class="num" id="LN2330">2330</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2331"><td class="num" id="LN2331">2331</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2332"><td class="num" id="LN2332">2332</td><td class="line">            <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2333"><td class="num" id="LN2333">2333</td><td class="line">                std::cerr &lt;&lt; <span class='string_literal'>"ERROR: Improper value of OPENCV_IPP: "</span> &lt;&lt; env.c_str() &lt;&lt; <span class='string_literal'>". Correct values are: disabled, sse42, avx2, avx512 (Intel64 only)"</span> &lt;&lt; std::endl;</td></tr>
<tr class="codeline" data-linenumber="2334"><td class="num" id="LN2334">2334</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2335"><td class="num" id="LN2335">2335</td><td class="line">            <span class='comment'>// Trim unsupported features</span></td></tr>
<tr class="codeline" data-linenumber="2336"><td class="num" id="LN2336">2336</td><td class="line">            ippFeatures &amp;= cpuFeatures;</td></tr>
<tr class="codeline" data-linenumber="2337"><td class="num" id="LN2337">2337</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2338"><td class="num" id="LN2338">2338</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2339"><td class="num" id="LN2339">2339</td><td class="line">        <span class='comment'>// Disable AVX1 since we don't track regressions for it. SSE42 will be used instead</span></td></tr>
<tr class="codeline" data-linenumber="2340"><td class="num" id="LN2340">2340</td><td class="line">        <span class='keyword'>if</span>(cpuFeatures&amp;<span class='macro'>ippCPUID_AVX<span class='macro_popup'>0x00000100</span></span> &amp;&amp; !(cpuFeatures&amp;<span class='macro'>ippCPUID_AVX2<span class='macro_popup'>0x00008000</span></span>))</td></tr>
<tr class="codeline" data-linenumber="2341"><td class="num" id="LN2341">2341</td><td class="line">            ippFeatures &amp;= ~((Ipp64u)<span class='macro'>ippCPUID_AVX<span class='macro_popup'>0x00000100</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2342"><td class="num" id="LN2342">2342</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2343"><td class="num" id="LN2343">2343</td><td class="line">        <span class='comment'>// IPP integrations in OpenCV support only SSE4.2, AVX2 and AVX-512 optimizations.</span></td></tr>
<tr class="codeline" data-linenumber="2344"><td class="num" id="LN2344">2344</td><td class="line">        <span class='keyword'>if</span>(!(</td></tr>
<tr class="codeline" data-linenumber="2345"><td class="num" id="LN2345">2345</td><td class="line"><span class='directive'>#if <span class='macro'>IPP_VERSION_X100<span class='macro_popup'>(2020 * 100 + 0*10 + 0)</span></span> &gt;= 201700</span></td></tr>
<tr class="codeline" data-linenumber="2346"><td class="num" id="LN2346">2346</td><td class="line">            cpuFeatures&amp;<span class='macro'>ippCPUID_AVX512F<span class='macro_popup'>0x00100000</span></span> ||</td></tr>
<tr class="codeline" data-linenumber="2347"><td class="num" id="LN2347">2347</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2348"><td class="num" id="LN2348">2348</td><td class="line">            cpuFeatures&amp;<span class='macro'>ippCPUID_AVX2<span class='macro_popup'>0x00008000</span></span> ||</td></tr>
<tr class="codeline" data-linenumber="2349"><td class="num" id="LN2349">2349</td><td class="line">            cpuFeatures&amp;<span class='macro'>ippCPUID_SSE42<span class='macro_popup'>0x00000080</span></span></td></tr>
<tr class="codeline" data-linenumber="2350"><td class="num" id="LN2350">2350</td><td class="line">            ))</td></tr>
<tr class="codeline" data-linenumber="2351"><td class="num" id="LN2351">2351</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2352"><td class="num" id="LN2352">2352</td><td class="line">            useIPP = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="2353"><td class="num" id="LN2353">2353</td><td class="line">            <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="2354"><td class="num" id="LN2354">2354</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2355"><td class="num" id="LN2355">2355</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2356"><td class="num" id="LN2356">2356</td><td class="line">        <span class='keyword'>if</span>(ippFeatures == cpuFeatures)</td></tr>
<tr class="codeline" data-linenumber="2357"><td class="num" id="LN2357">2357</td><td class="line">            <span class='macro'>IPP_INITIALIZER(0)<span class='macro_popup'>{ if(0) ippicvSetCpuFeatures(0); else ippicvInit(); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2358"><td class="num" id="LN2358">2358</td><td class="line">        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2359"><td class="num" id="LN2359">2359</td><td class="line">            <span class='macro'>IPP_INITIALIZER(ippFeatures)<span class='macro_popup'>{ if(ippFeatures) ippicvSetCpuFeatures(ippFeatures); else ippicvInit<br>(); }</span></span></td></tr>
<tr class="codeline" data-linenumber="2360"><td class="num" id="LN2360">2360</td><td class="line">        ippFeatures = <span class='macro'>ippGetEnabledCpuFeatures<span class='macro_popup'>ippicvGetEnabledCpuFeatures</span></span>();</td></tr>
<tr class="codeline" data-linenumber="2361"><td class="num" id="LN2361">2361</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2362"><td class="num" id="LN2362">2362</td><td class="line">        <span class='comment'>// Detect top level optimizations to make comparison easier for optimizations dependent conditions</span></td></tr>
<tr class="codeline" data-linenumber="2363"><td class="num" id="LN2363">2363</td><td class="line"><span class='directive'>#if <span class='macro'>IPP_VERSION_X100<span class='macro_popup'>(2020 * 100 + 0*10 + 0)</span></span> &gt;= 201700</span></td></tr>
<tr class="codeline" data-linenumber="2364"><td class="num" id="LN2364">2364</td><td class="line">        <span class='keyword'>if</span>(ippFeatures&amp;<span class='macro'>ippCPUID_AVX512F<span class='macro_popup'>0x00100000</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2365"><td class="num" id="LN2365">2365</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2366"><td class="num" id="LN2366">2366</td><td class="line">            <span class='keyword'>if</span>((ippFeatures&amp;<span class='macro'>ippCPUID_AVX512_SKX<span class='macro_popup'>(0x00100000|0x00200000|0x04000000|0x01000000|0x02000000)</span></span>) == <span class='macro'>ippCPUID_AVX512_SKX<span class='macro_popup'>(0x00100000|0x00200000|0x04000000|0x01000000|0x02000000)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2367"><td class="num" id="LN2367">2367</td><td class="line">                ippTopFeatures = <span class='macro'>ippCPUID_AVX512_SKX<span class='macro_popup'>(0x00100000|0x00200000|0x04000000|0x01000000|0x02000000)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2368"><td class="num" id="LN2368">2368</td><td class="line">            <span class='keyword'>else</span> <span class='keyword'>if</span>((ippFeatures&amp;<span class='macro'>ippCPUID_AVX512_KNL<span class='macro_popup'>(0x00100000|0x00200000|0x00800000|0x00400000)</span></span>) == <span class='macro'>ippCPUID_AVX512_KNL<span class='macro_popup'>(0x00100000|0x00200000|0x00800000|0x00400000)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2369"><td class="num" id="LN2369">2369</td><td class="line">                ippTopFeatures = <span class='macro'>ippCPUID_AVX512_KNL<span class='macro_popup'>(0x00100000|0x00200000|0x00800000|0x00400000)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2370"><td class="num" id="LN2370">2370</td><td class="line">            <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2371"><td class="num" id="LN2371">2371</td><td class="line">                ippTopFeatures = <span class='macro'>ippCPUID_AVX512F<span class='macro_popup'>0x00100000</span></span>; <span class='comment'>// Unknown AVX512 configuration</span></td></tr>
<tr class="codeline" data-linenumber="2372"><td class="num" id="LN2372">2372</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2373"><td class="num" id="LN2373">2373</td><td class="line">        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2374"><td class="num" id="LN2374">2374</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2375"><td class="num" id="LN2375">2375</td><td class="line">        <span class='keyword'>if</span>(ippFeatures&amp;<span class='macro'>ippCPUID_AVX2<span class='macro_popup'>0x00008000</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2376"><td class="num" id="LN2376">2376</td><td class="line">            ippTopFeatures = <span class='macro'>ippCPUID_AVX2<span class='macro_popup'>0x00008000</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2377"><td class="num" id="LN2377">2377</td><td class="line">        <span class='keyword'>else</span> <span class='keyword'>if</span>(ippFeatures&amp;<span class='macro'>ippCPUID_SSE42<span class='macro_popup'>0x00000080</span></span>)</td></tr>
<tr class="codeline" data-linenumber="2378"><td class="num" id="LN2378">2378</td><td class="line">            ippTopFeatures = <span class='macro'>ippCPUID_SSE42<span class='macro_popup'>0x00000080</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2379"><td class="num" id="LN2379">2379</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2380"><td class="num" id="LN2380">2380</td><td class="line">        pIppLibInfo = <span class='macro'>ippiGetLibVersion<span class='macro_popup'>ippicviGetLibVersion</span></span>();</td></tr>
<tr class="codeline" data-linenumber="2381"><td class="num" id="LN2381">2381</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2382"><td class="num" id="LN2382">2382</td><td class="line">        <span class='comment'>// workaround: https://github.com/opencv/opencv/issues/12959</span></td></tr>
<tr class="codeline" data-linenumber="2383"><td class="num" id="LN2383">2383</td><td class="line">        std::string ippName(pIppLibInfo-&gt;Name ? pIppLibInfo-&gt;Name : <span class='string_literal'>""</span>);</td></tr>
<tr class="codeline" data-linenumber="2384"><td class="num" id="LN2384">2384</td><td class="line">        <span class='keyword'>if</span> (ippName.find(<span class='string_literal'>"SSE4.2"</span>) != std::string::npos)</td></tr>
<tr class="codeline" data-linenumber="2385"><td class="num" id="LN2385">2385</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2386"><td class="num" id="LN2386">2386</td><td class="line">            ippTopFeatures = <span class='macro'>ippCPUID_SSE42<span class='macro_popup'>0x00000080</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2387"><td class="num" id="LN2387">2387</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2388"><td class="num" id="LN2388">2388</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2389"><td class="num" id="LN2389">2389</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2390"><td class="num" id="LN2390">2390</td><td class="line"><span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="2391"><td class="num" id="LN2391">2391</td><td class="line">    <span class='keyword'>bool</span>        useIPP;</td></tr>
<tr class="codeline" data-linenumber="2392"><td class="num" id="LN2392">2392</td><td class="line">    <span class='keyword'>bool</span>        useIPP_NE;</td></tr>
<tr class="codeline" data-linenumber="2393"><td class="num" id="LN2393">2393</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2394"><td class="num" id="LN2394">2394</td><td class="line">    <span class='keyword'>int</span>         ippStatus;  <span class='comment'>// 0 - all is ok, -1 - IPP functions failed</span></td></tr>
<tr class="codeline" data-linenumber="2395"><td class="num" id="LN2395">2395</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>char</span> *funcname;</td></tr>
<tr class="codeline" data-linenumber="2396"><td class="num" id="LN2396">2396</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>char</span> *filename;</td></tr>
<tr class="codeline" data-linenumber="2397"><td class="num" id="LN2397">2397</td><td class="line">    <span class='keyword'>int</span>         linen;</td></tr>
<tr class="codeline" data-linenumber="2398"><td class="num" id="LN2398">2398</td><td class="line">    Ipp64u      ippFeatures;</td></tr>
<tr class="codeline" data-linenumber="2399"><td class="num" id="LN2399">2399</td><td class="line">    Ipp64u      cpuFeatures;</td></tr>
<tr class="codeline" data-linenumber="2400"><td class="num" id="LN2400">2400</td><td class="line">    Ipp64u      ippTopFeatures;</td></tr>
<tr class="codeline" data-linenumber="2401"><td class="num" id="LN2401">2401</td><td class="line">    <span class='keyword'>const</span> IppLibraryVersion *pIppLibInfo;</td></tr>
<tr class="codeline" data-linenumber="2402"><td class="num" id="LN2402">2402</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="2403"><td class="num" id="LN2403">2403</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2404"><td class="num" id="LN2404">2404</td><td class="line"><span class='keyword'>static</span> IPPInitSingleton&amp; getIPPSingleton()</td></tr>
<tr class="codeline" data-linenumber="2405"><td class="num" id="LN2405">2405</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2406"><td class="num" id="LN2406">2406</td><td class="line">    CV_SINGLETON_LAZY_INIT_REF(IPPInitSingleton, <span class='keyword'>new</span> IPPInitSingleton())</td></tr>
<tr class="codeline" data-linenumber="2407"><td class="num" id="LN2407">2407</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2408"><td class="num" id="LN2408">2408</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2409"><td class="num" id="LN2409">2409</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2410"><td class="num" id="LN2410">2410</td><td class="line"><span class='keyword'>unsigned</span> <span class='keyword'>long</span> <span class='keyword'>long</span> getIppFeatures()</td></tr>
<tr class="codeline" data-linenumber="2411"><td class="num" id="LN2411">2411</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2412"><td class="num" id="LN2412">2412</td><td class="line"><span class='directive'>#ifdef HAVE_IPP</span></td></tr>
<tr class="codeline" data-linenumber="2413"><td class="num" id="LN2413">2413</td><td class="line">    <span class='keyword'>return</span> getIPPSingleton().ippFeatures;</td></tr>
<tr class="codeline" data-linenumber="2414"><td class="num" id="LN2414">2414</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="2415"><td class="num" id="LN2415">2415</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="2416"><td class="num" id="LN2416">2416</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2417"><td class="num" id="LN2417">2417</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2418"><td class="num" id="LN2418">2418</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2419"><td class="num" id="LN2419">2419</td><td class="line"><span class='directive'>#ifdef HAVE_IPP</span></td></tr>
<tr class="codeline" data-linenumber="2420"><td class="num" id="LN2420">2420</td><td class="line"><span class='keyword'>unsigned</span> <span class='keyword'>long</span> <span class='keyword'>long</span> getIppTopFeatures()</td></tr>
<tr class="codeline" data-linenumber="2421"><td class="num" id="LN2421">2421</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2422"><td class="num" id="LN2422">2422</td><td class="line">    <span class='keyword'>return</span> getIPPSingleton().ippTopFeatures;</td></tr>
<tr class="codeline" data-linenumber="2423"><td class="num" id="LN2423">2423</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2424"><td class="num" id="LN2424">2424</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2425"><td class="num" id="LN2425">2425</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2426"><td class="num" id="LN2426">2426</td><td class="line"><span class='keyword'>void</span> setIppStatus(<span class='keyword'>int</span> status, <span class='keyword'>const</span> <span class='keyword'>char</span> * <span class='keyword'>const</span> _funcname, <span class='keyword'>const</span> <span class='keyword'>char</span> * <span class='keyword'>const</span> _filename, <span class='keyword'>int</span> _line)</td></tr>
<tr class="codeline" data-linenumber="2427"><td class="num" id="LN2427">2427</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2428"><td class="num" id="LN2428">2428</td><td class="line"><span class='directive'>#ifdef HAVE_IPP</span></td></tr>
<tr class="codeline" data-linenumber="2429"><td class="num" id="LN2429">2429</td><td class="line">    getIPPSingleton().ippStatus = status;</td></tr>
<tr class="codeline" data-linenumber="2430"><td class="num" id="LN2430">2430</td><td class="line">    getIPPSingleton().funcname = _funcname;</td></tr>
<tr class="codeline" data-linenumber="2431"><td class="num" id="LN2431">2431</td><td class="line">    getIPPSingleton().filename = _filename;</td></tr>
<tr class="codeline" data-linenumber="2432"><td class="num" id="LN2432">2432</td><td class="line">    getIPPSingleton().linen = _line;</td></tr>
<tr class="codeline" data-linenumber="2433"><td class="num" id="LN2433">2433</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="2434"><td class="num" id="LN2434">2434</td><td class="line">    <span class='macro'>CV_UNUSED(status)<span class='macro_popup'>(void)status</span></span>; <span class='macro'>CV_UNUSED(_funcname)<span class='macro_popup'>(void)_funcname</span></span>; <span class='macro'>CV_UNUSED(_filename)<span class='macro_popup'>(void)_filename</span></span>; <span class='macro'>CV_UNUSED(_line)<span class='macro_popup'>(void)_line</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2435"><td class="num" id="LN2435">2435</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2436"><td class="num" id="LN2436">2436</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2437"><td class="num" id="LN2437">2437</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2438"><td class="num" id="LN2438">2438</td><td class="line"><span class='keyword'>int</span> getIppStatus()</td></tr>
<tr class="codeline" data-linenumber="2439"><td class="num" id="LN2439">2439</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2440"><td class="num" id="LN2440">2440</td><td class="line"><span class='directive'>#ifdef HAVE_IPP</span></td></tr>
<tr class="codeline" data-linenumber="2441"><td class="num" id="LN2441">2441</td><td class="line">    <span class='keyword'>return</span> getIPPSingleton().ippStatus;</td></tr>
<tr class="codeline" data-linenumber="2442"><td class="num" id="LN2442">2442</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="2443"><td class="num" id="LN2443">2443</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="2444"><td class="num" id="LN2444">2444</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2445"><td class="num" id="LN2445">2445</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2446"><td class="num" id="LN2446">2446</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2447"><td class="num" id="LN2447">2447</td><td class="line">String getIppErrorLocation()</td></tr>
<tr class="codeline" data-linenumber="2448"><td class="num" id="LN2448">2448</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2449"><td class="num" id="LN2449">2449</td><td class="line"><span class='directive'>#ifdef HAVE_IPP</span></td></tr>
<tr class="codeline" data-linenumber="2450"><td class="num" id="LN2450">2450</td><td class="line">    <span class='keyword'>return</span> format(<span class='string_literal'>"%s:%d %s"</span>, getIPPSingleton().filename ? getIPPSingleton().filename : <span class='string_literal'>""</span>, getIPPSingleton().linen, getIPPSingleton().funcname ? getIPPSingleton().funcname : <span class='string_literal'>""</span>);</td></tr>
<tr class="codeline" data-linenumber="2451"><td class="num" id="LN2451">2451</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="2452"><td class="num" id="LN2452">2452</td><td class="line">    <span class='keyword'>return</span> String();</td></tr>
<tr class="codeline" data-linenumber="2453"><td class="num" id="LN2453">2453</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2454"><td class="num" id="LN2454">2454</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2455"><td class="num" id="LN2455">2455</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2456"><td class="num" id="LN2456">2456</td><td class="line">String getIppVersion()</td></tr>
<tr class="codeline" data-linenumber="2457"><td class="num" id="LN2457">2457</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2458"><td class="num" id="LN2458">2458</td><td class="line"><span class='directive'>#ifdef HAVE_IPP</span></td></tr>
<tr class="codeline" data-linenumber="2459"><td class="num" id="LN2459">2459</td><td class="line">    <span class='keyword'>const</span> IppLibraryVersion *pInfo = getIPPSingleton().pIppLibInfo;</td></tr>
<tr class="codeline" data-linenumber="2460"><td class="num" id="LN2460">2460</td><td class="line">    <span class='keyword'>if</span>(pInfo)</td></tr>
<tr class="codeline" data-linenumber="2461"><td class="num" id="LN2461">2461</td><td class="line">        <span class='keyword'>return</span> format(<span class='string_literal'>"%s %s %s"</span>, pInfo-&gt;Name, pInfo-&gt;Version, pInfo-&gt;BuildDate);</td></tr>
<tr class="codeline" data-linenumber="2462"><td class="num" id="LN2462">2462</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2463"><td class="num" id="LN2463">2463</td><td class="line">        <span class='keyword'>return</span> String(<span class='string_literal'>"error"</span>);</td></tr>
<tr class="codeline" data-linenumber="2464"><td class="num" id="LN2464">2464</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="2465"><td class="num" id="LN2465">2465</td><td class="line">    <span class='keyword'>return</span> String(<span class='string_literal'>"disabled"</span>);</td></tr>
<tr class="codeline" data-linenumber="2466"><td class="num" id="LN2466">2466</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2467"><td class="num" id="LN2467">2467</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2468"><td class="num" id="LN2468">2468</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2469"><td class="num" id="LN2469">2469</td><td class="line"><span class='keyword'>bool</span> useIPP()</td></tr>
<tr class="codeline" data-linenumber="2470"><td class="num" id="LN2470">2470</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2471"><td class="num" id="LN2471">2471</td><td class="line"><span class='directive'>#ifdef HAVE_IPP</span></td></tr>
<tr class="codeline" data-linenumber="2472"><td class="num" id="LN2472">2472</td><td class="line">    CoreTLSData&amp; data = getCoreTlsData();</td></tr>
<tr class="codeline" data-linenumber="2473"><td class="num" id="LN2473">2473</td><td class="line">    <span class='keyword'>if</span> (data.useIPP &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="2474"><td class="num" id="LN2474">2474</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2475"><td class="num" id="LN2475">2475</td><td class="line">        data.useIPP = getIPPSingleton().useIPP;</td></tr>
<tr class="codeline" data-linenumber="2476"><td class="num" id="LN2476">2476</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2477"><td class="num" id="LN2477">2477</td><td class="line">    <span class='keyword'>return</span> (data.useIPP &gt; 0);</td></tr>
<tr class="codeline" data-linenumber="2478"><td class="num" id="LN2478">2478</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="2479"><td class="num" id="LN2479">2479</td><td class="line">    <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="2480"><td class="num" id="LN2480">2480</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2481"><td class="num" id="LN2481">2481</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2482"><td class="num" id="LN2482">2482</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2483"><td class="num" id="LN2483">2483</td><td class="line"><span class='keyword'>void</span> setUseIPP(<span class='keyword'>bool</span> flag)</td></tr>
<tr class="codeline" data-linenumber="2484"><td class="num" id="LN2484">2484</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2485"><td class="num" id="LN2485">2485</td><td class="line">    CoreTLSData&amp; data = getCoreTlsData();</td></tr>
<tr class="codeline" data-linenumber="2486"><td class="num" id="LN2486">2486</td><td class="line"><span class='directive'>#ifdef HAVE_IPP</span></td></tr>
<tr class="codeline" data-linenumber="2487"><td class="num" id="LN2487">2487</td><td class="line">    data.useIPP = (getIPPSingleton().useIPP)?flag:<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="2488"><td class="num" id="LN2488">2488</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="2489"><td class="num" id="LN2489">2489</td><td class="line">    <span class='macro'>CV_UNUSED(flag)<span class='macro_popup'>(void)flag</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2490"><td class="num" id="LN2490">2490</td><td class="line">    data.useIPP = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="2491"><td class="num" id="LN2491">2491</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2492"><td class="num" id="LN2492">2492</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2493"><td class="num" id="LN2493">2493</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2494"><td class="num" id="LN2494">2494</td><td class="line"><span class='keyword'>bool</span> useIPP_NotExact()</td></tr>
<tr class="codeline" data-linenumber="2495"><td class="num" id="LN2495">2495</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2496"><td class="num" id="LN2496">2496</td><td class="line"><span class='directive'>#ifdef HAVE_IPP</span></td></tr>
<tr class="codeline" data-linenumber="2497"><td class="num" id="LN2497">2497</td><td class="line">    CoreTLSData&amp; data = getCoreTlsData();</td></tr>
<tr class="codeline" data-linenumber="2498"><td class="num" id="LN2498">2498</td><td class="line">    <span class='keyword'>if</span> (data.useIPP_NE &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="2499"><td class="num" id="LN2499">2499</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2500"><td class="num" id="LN2500">2500</td><td class="line">        data.useIPP_NE = getIPPSingleton().useIPP_NE;</td></tr>
<tr class="codeline" data-linenumber="2501"><td class="num" id="LN2501">2501</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2502"><td class="num" id="LN2502">2502</td><td class="line">    <span class='keyword'>return</span> (data.useIPP_NE &gt; 0);</td></tr>
<tr class="codeline" data-linenumber="2503"><td class="num" id="LN2503">2503</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="2504"><td class="num" id="LN2504">2504</td><td class="line">    <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="2505"><td class="num" id="LN2505">2505</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2506"><td class="num" id="LN2506">2506</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2507"><td class="num" id="LN2507">2507</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2508"><td class="num" id="LN2508">2508</td><td class="line"><span class='keyword'>void</span> setUseIPP_NotExact(<span class='keyword'>bool</span> flag)</td></tr>
<tr class="codeline" data-linenumber="2509"><td class="num" id="LN2509">2509</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2510"><td class="num" id="LN2510">2510</td><td class="line">    CoreTLSData&amp; data = getCoreTlsData();</td></tr>
<tr class="codeline" data-linenumber="2511"><td class="num" id="LN2511">2511</td><td class="line"><span class='directive'>#ifdef HAVE_IPP</span></td></tr>
<tr class="codeline" data-linenumber="2512"><td class="num" id="LN2512">2512</td><td class="line">    data.useIPP_NE = flag;</td></tr>
<tr class="codeline" data-linenumber="2513"><td class="num" id="LN2513">2513</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="2514"><td class="num" id="LN2514">2514</td><td class="line">    <span class='macro'>CV_UNUSED(flag)<span class='macro_popup'>(void)flag</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2515"><td class="num" id="LN2515">2515</td><td class="line">    data.useIPP_NE = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="2516"><td class="num" id="LN2516">2516</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2517"><td class="num" id="LN2517">2517</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2518"><td class="num" id="LN2518">2518</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2519"><td class="num" id="LN2519">2519</td><td class="line">} <span class='comment'>// namespace ipp</span></td></tr>
<tr class="codeline" data-linenumber="2520"><td class="num" id="LN2520">2520</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2521"><td class="num" id="LN2521">2521</td><td class="line">} <span class='comment'>// namespace cv</span></td></tr>
<tr class="codeline" data-linenumber="2522"><td class="num" id="LN2522">2522</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2523"><td class="num" id="LN2523">2523</td><td class="line"><span class='comment'>/* End of file. */</span></td></tr>
</table></body></html>
